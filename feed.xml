<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="ko"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://sweetlittlebird.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://sweetlittlebird.github.io/" rel="alternate" type="text/html" hreflang="ko" /><updated>2024-09-08T03:32:43+09:00</updated><id>https://sweetlittlebird.github.io/feed.xml</id><title type="html">Sweet Little Bird</title><subtitle>ê³µë¶€ ê¸°ë¡ê³¼ ê°œë°œ ì´ì•¼ê¸°ë¥¼ ë‹´ì€ ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.</subtitle><entry><title type="html">[KANS 3ê¸°] K8S Flannel CNI &amp;amp; PAUSE</title><link href="https://sweetlittlebird.github.io/posts/2024-09-07-KANS-Study-Week2/" rel="alternate" type="text/html" title="[KANS 3ê¸°] K8S Flannel CNI &amp;amp; PAUSE" /><published>2024-09-07T17:40:18+09:00</published><updated>2024-09-07T17:40:18+09:00</updated><id>https://sweetlittlebird.github.io/posts/KANS%20Study%20-%20Week2</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-09-07-KANS-Study-Week2/"><![CDATA[<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì§€ë‚œì£¼ì— ì´ì–´ ì´ë²ˆì£¼ì—ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ëŒ€í•´ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ê³  KIND, PAUSE ì»¨í…Œì´ë„ˆì™€ Flannel CNIì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
KANS 3ê¸° 2ì£¼ì°¨ ìŠ¤í„°ë””ë¥¼ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ì¿ ë²„ë„¤í‹°ìŠ¤-ì†Œê°œ">ì¿ ë²„ë„¤í‹°ìŠ¤ ì†Œê°œ</h2>

<ul>
  <li>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” êµ¬ê¸€ì—ì„œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê³µê°œí•œ ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìë™ìœ¼ë¡œ ë°°í¬, ìŠ¤ì¼€ì¼ë§ ë° ê´€ë¦¬í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼ì…ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_1.gif" alt="20240907_kans_w2_1.gif" class="image-center" />
<em class="image-caption">ì¶œì²˜: <a href="https://blog.naver.com/love_tolty/222167051615">https://blog.naver.com/love_tolty/222167051615</a></em></p>

<ul>
  <li>
    <p>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™ì´ ë‹¤ì–‘í•œ ì»´í¬ë„ŒíŠ¸ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤. ê° ìš”ì†Œë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>
  </li>
  <li><strong>Control Plane(ë§ˆìŠ¤í„° ë…¸ë“œ)</strong> : ë§ˆìŠ¤í„°ëŠ” ë‹¨ì¼ ì„œë²„ í˜¹ì€ ê³ ê°€ìš©ì„±ì„ ìœ„í•œ í´ëŸ¬ìŠ¤í„° ë§ˆìŠ¤í„°ë¡œ êµ¬ì¶•
    <ul>
      <li>kube-<strong>apiserver</strong> : <strong>ëª¨ë“  ìš”ì²­</strong>ì„ ë°›ì•„ ë“œë¦¬ëŠ” <strong>API ì„œë²„</strong></li>
      <li>etcd : í´ëŸ¬ìŠ¤í„°ë‚´ ëª¨ë“  ë©”íƒ€ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” key/value DB ì„œë¹„ìŠ¤</li>
      <li>kube-scheduler : ì»¨í…Œì´ë„ˆë¥¼ ì›Œì»¤ ë…¸ë“œì— ë°°ì¹˜í•˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬</li>
      <li>kube-controller-manager : í˜„ì¬ ìƒíƒœì™€ ë°”ë¼ëŠ” ìƒíƒœë¥¼ ì§€ì†ì ìœ¼ë¡œ í™•ì¸í•˜ë©° íŠ¹ì • ì´ë²¤íŠ¸ì— ë”°ë¼ íŠ¹ì • ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ - <a href="https://kubernetes.io/docs/concepts/architecture/controller/">ë§í¬</a></li>
      <li>cloud-controller-manager : (AWS, GCP, Azure ë“± í´ë¼ìš°ë“œ í”Œë«í¼ì— íŠ¹í™”ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ì œì–´í•˜ëŠ” í´ë¼ìš°ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ - <a href="https://kubernetes.io/docs/concepts/architecture/cloud-controller/">ë§í¬</a></li>
    </ul>
  </li>
  <li><strong>Worker Node(ì›Œì»¤ ë…¸ë“œ)</strong> - <a href="https://kubernetes.io/docs/concepts/architecture/nodes/">ë§í¬</a>
    <ul>
      <li>kubelet : ë§ˆìŠ¤í„°ì˜ ëª…ë ¹ì— ë”°ë¼ ì»¨í…Œì´ë„ˆì˜ ë¼ì´í”„ ì‚¬ì´í´ì„ ê´€ë¦¬í•˜ëŠ” ë…¸ë“œ ê´€ë¦¬ì</li>
      <li>kube-proxy : ì»¨í…Œì´ë„ˆì˜ ë„¤íŠ¸ì›Œí‚¹ì„ ì±…ì„ì§€ëŠ” í”„ë¡ì‹œ, ë„¤íŠ¸ì›Œí¬ ê·œì¹™ì„ ìœ ì§€ ê´€ë¦¬</li>
      <li>Container Runtime : ì‹¤ì œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í™˜ê²½, (ContainerD, CRI-O, â€¦) - <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/">ë§í¬</a></li>
    </ul>
  </li>
  <li><strong>Addon(ì• ë“œì˜¨)</strong>
    <ul>
      <li>CNI : Container Network Interface ëŠ” k8s ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ êµ¬ì„±í•´ì¤ë‹ˆë‹¤.
        <ul>
          <li>ì˜ˆ) Flannel, Calico, Weave Net, Cilium, â€¦</li>
        </ul>
      </li>
      <li>DNS : í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNS ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
        <ul>
          <li>ì˜ˆ) CoreDNS, Kube-DNS, â€¦</li>
        </ul>
      </li>
      <li>ê¸°íƒ€ : ëª¨ë‹ˆí„°ë§, ëŒ€ì‹œë³´ë“œ, ë¡œê¹… ë“±ë“±</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="kind-ì†Œê°œ-ë°-ì„¤ì¹˜">kind ì†Œê°œ ë° ì„¤ì¹˜</h2>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_2.png" alt="img.png" class="w-30 image-center" /></p>

<p>kindëŠ” <strong>K</strong>ubernetes <strong>IN</strong> <strong>D</strong>ockerì˜ ì•½ìë¡œ, ë¡œì»¬ í™˜ê²½ì—ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ Kubernetesë¥¼ Docker ì•ˆì—ì„œ DIND(Docker in Docker) ë°©ì‹ìœ¼ë¡œ êµ¬ë™ì‹œì¼œì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
minikubeë‚˜ k3s ë“±ê³¼ ë‹¬ë¦¬ <strong>Dockerë§Œ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì†ì‰½ê²Œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>kindì˜ êµ¬ì¡°ë¥¼ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w2/20240907_kans_w2_3.png" alt="img.png" class="image-center" />
<em class="image-caption">ì¶œì²˜ : <a href="[https://kind.sigs.k8s.io/docs/design/initial/">https://kind.sigs.k8s.io/docs/design/initial/</a></em></li>
</ul>

<h3 id="ì„¤ì¹˜">ì„¤ì¹˜</h3>

<p>ì œê°€ ì‚¬ìš©ì¤‘ì¸ macOSë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. macOSì—ì„œ í…Œë¼í¼ì„ ì„¤ì¹˜í•˜ë ¤ë©´ Homebrewë¥¼ ì´ìš©í•˜ì—¬ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
(í™ˆë¸Œë£¨ ì„¤ì¹˜ ë°©ë²•ì€ <a href="https://whalec.io/homebrew-ì„¤ì¹˜-ë°-ì‚¬ìš©-ë°©ë²•">https://whalec.io/homebrew-ì„¤ì¹˜-ë°-ì‚¬ìš©-ë°©ë²•</a> ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.)</p>

<ul>
  <li>kind ì„¤ì¹˜ ë° í•„ìˆ˜ íˆ´ ì„¤ì¹˜</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install Kind</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kind
<span class="nv">$ </span>kind <span class="nt">--version</span>
<span class="c"># =&gt; kind version 0.24.0</span>

<span class="c"># Install kubectl</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kubernetes-cli
<span class="nv">$ </span>kubectl version <span class="nt">--client</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># =&gt; Client Version: v1.31.0</span>
<span class="c">#    Kustomize Version: v5.4.2</span>

<span class="c"># Install Helm</span>
<span class="nv">$ </span>brew <span class="nb">install </span>helm
<span class="nv">$ </span>helm version
<span class="c"># =&gt; version.BuildInfo{Version:&amp;quot;v3.15.4&amp;quot;, GitCommit:&amp;quot;fa9efb07d9d8debbb4306d72af76a383895aa8c4&amp;quot;, GitTreeState:&amp;quot;clean&amp;quot;, GoVersion:&amp;quot;go1.22.6&amp;quot;}</span>

<span class="c"># Install Wireshark : ìº¡ì²˜ëœ íŒ¨í‚· í™•ì¸</span>
<span class="nv">$ </span>brew <span class="nb">install</span> <span class="nt">--cask</span> wireshark

<span class="c"># (ì„ íƒ) kubectl ì¶œë ¥ ì‹œ í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kubecolor
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"alias kubectl=kubecolor"</span> <span class="o">&gt;&gt;</span> ~/.zshrc
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"compdef kubecolor=kubectl"</span> <span class="o">&gt;&gt;</span> ~/.zshrc
</code></pre></div></div>

<h3 id="1-node-í´ëŸ¬ìŠ¤í„°-êµ¬ì„±-í…ŒìŠ¤íŠ¸">1-Node í´ëŸ¬ìŠ¤í„° êµ¬ì„± í…ŒìŠ¤íŠ¸</h3>

<ul>
  <li>ê°„ë‹¨í•œ í´ëŸ¬ìŠ¤í„°ë¥¼ ë§Œë“¤ê³  í…ŒìŠ¤íŠ¸ í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ ì „ í™•ì¸</span>
<span class="nv">$ </span>docker ps

<span class="c"># Create a cluster with kind</span>
<span class="nv">$ </span>kind create cluster
<span class="c"># =&gt; Creating cluster &amp;quot;kind&amp;quot; ...</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Ensuring node image (kindest/node:v1.31.0) ğŸ–¼</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Preparing nodes ğŸ“¦ </span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Writing configuration ğŸ“œ</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Starting control-plane ğŸ•¹ï¸</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Installing CNI ğŸ”Œ</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Installing StorageClass ğŸ’¾</span>
<span class="c">#    Set kubectl context to &amp;quot;kind-kind&amp;quot;</span>
<span class="c">#    You can now use your cluster with:</span>
<span class="c">#    </span>
<span class="c">#    kubectl cluster-info --context kind-kind </span>
<span class="c">#    </span>
<span class="c">#    Not sure what to do next? ğŸ˜…  Check out https://kind.sigs.k8s.io/docs/user/quick-start/</span>

<span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>kind get clusters
<span class="nv">$ </span>kind get nodes
<span class="nv">$ </span>kubectl cluster-info

<span class="c"># ë…¸ë“œ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-o</span> wide

<span class="c"># íŒŒë“œ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span>
<span class="nv">$ </span>kubectl get componentstatuses

<span class="c"># ì»¨íŠ¸ë¡¤í”Œë ˆì¸ (ì»¨í…Œì´ë„ˆ) ë…¸ë“œ 1ëŒ€ê°€ ì‹¤í–‰</span>
<span class="nv">$ </span>docker ps
<span class="nv">$ </span>docker images

<span class="c"># kube config íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config

<span class="c"># nginx íŒŒë“œ ë°°í¬ ë° í™•ì¸ : ì»¨íŠ¸ë¡¤í”Œë ˆì¸ ë…¸ë“œì¸ë° íŒŒë“œê°€ ë°°í¬ ë ê¹Œìš”?</span>
<span class="nv">$ </span>kubectl run nginx <span class="nt">--image</span><span class="o">=</span>nginx:alpine
<span class="nv">$ </span>kubectl get pod <span class="nt">-owide</span>

<span class="c"># ë…¸ë“œì— Taints ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe node | <span class="nb">grep </span>Taints
<span class="c"># =&gt; Taints:             &lt;none&gt;</span>

<span class="c"># í´ëŸ¬ìŠ¤í„° ì‚­ì œ</span>
<span class="nv">$ </span>kind delete cluster

<span class="c"># kube config ì‚­ì œ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config
</code></pre></div></div>

<ul>
  <li>í…ŒìŠ¤íŠ¸ ì¤‘ì— ë…¸ë“œê°€ ì»¤íŠ¸ë¡¤ í”Œë ˆì¸ í•˜ë‚˜ ë¿ì¸ë°ë„ íŒŒë“œê°€ ë°°í¬ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">kubectl describe node | grep Taints</code>ë¥¼ í†µí•´ í™•ì¸í•´ë³¸ ê²°ê³¼ <code class="language-plaintext highlighter-rouge">=&gt; Taints: &lt;none&gt;</code>ë¡œ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì— ë³´í†µ ê±¸ë ¤ìˆëŠ” taintê°€ ì—†ì–´ì„œ íŒŒë“œê°€ ë°°í¬ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_4.png" alt="img.png" /></p>

<h3 id="2-node-í´ëŸ¬ìŠ¤í„°-êµ¬ì„±-í…ŒìŠ¤íŠ¸">2-Node í´ëŸ¬ìŠ¤í„° êµ¬ì„± í…ŒìŠ¤íŠ¸</h3>

<ul>
  <li>ì´ë²ˆì—ëŠ” ì¢€ ë” ë‚˜ì•„ê°€ì„œ control-planeê³¼ workerì˜ 2ê°œì˜ ë…¸ë“œë¡œ êµ¬ì„±ëœ KIND í´ëŸ¬ìŠ¤í„°ë¥¼ ë§Œë“¤ê³ , í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ ì „ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span>

<span class="c"># kind ëŠ” ë³„ë„ ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ìƒì„± í›„ ì‚¬ìš© : ê¸°ë³¸ê°’ 172.18.0.0/16</span>
<span class="nv">$ </span>docker network <span class="nb">ls</span>
<span class="c"># =&gt; NETWORK ID     NAME                     DRIVER    SCOPE</span>
<span class="c">#    ...</span>
<span class="c">#    3bbcc6aa8f38   kind                     bridge    local</span>
<span class="c">#    ...</span>

<span class="nv">$ </span>docker inspect kind | jq
<span class="c"># =&gt; [</span>
<span class="c">#      {</span>
<span class="c">#        &amp;quot;Name&amp;quot;: &amp;quot;kind&amp;quot;,</span>
<span class="c">#        &amp;quot;Driver&amp;quot;: &amp;quot;bridge&amp;quot;,</span>
<span class="c">#        ...</span>
<span class="c">#        &amp;quot;IPAM&amp;quot;: {</span>
<span class="c">#          &amp;quot;Driver&amp;quot;: &amp;quot;default&amp;quot;,</span>
<span class="c">#          &amp;quot;Options&amp;quot;: {},</span>
<span class="c">#          &amp;quot;Config&amp;quot;: [</span>
<span class="c">#            {</span>
<span class="c">#              &amp;quot;Subnet&amp;quot;: &amp;quot;172.20.0.0/16&amp;quot;,</span>
<span class="c">#              &amp;quot;Gateway&amp;quot;: &amp;quot;172.20.0.1&amp;quot;</span>
<span class="c">#            }</span>
<span class="c">#          ]</span>
<span class="c">#        },</span>
<span class="c">#       ...</span>
<span class="c">#      }</span>
<span class="c">#    ]</span>

<span class="c"># KINDë¡œ control-plane, workerë¼ëŠ” 2ê°œì˜ ë…¸ë“œë¥¼ ê°€ì§„ í´ëŸ¬ìŠ¤í„° ë§Œë“¤ê¸°</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOT</span><span class="sh"> &gt; kind-2node.yaml 
# two node (one workers) cluster config
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
</span><span class="no">EOT
</span><span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-2node.yaml <span class="nt">--name</span> myk8s

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kind get nodes <span class="nt">--name</span> myk8s
<span class="c"># =&gt; myk8s-worker</span>
<span class="c">#    myk8s-control-plane</span>

<span class="c"># k8s api ì£¼ì†Œ í™•ì¸</span>
<span class="nv">$ </span>kubectl cluster-info
<span class="c"># =&gt; &lt;span style="color:green;"&gt;Kubernetes control plane&lt;/span&gt; is running at &lt;span style="color:olive;"&gt;https://127.0.0.1:58638&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:green;"&gt;CoreDNS&lt;/span&gt; is running at &lt;span style="color:olive;"&gt;https://127.0.0.1:58638/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy&lt;/span&gt;</span>
<span class="c">#    </span>
<span class="c">#    To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>

<span class="c"># í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì† í…ŒìŠ¤íŠ¸ </span>
<span class="nv">$ </span>curl <span class="nt">-k</span> https://localhost:58638
<span class="c"># =&gt; {</span>
<span class="c">#      &amp;quot;kind&amp;quot;: &amp;quot;Status&amp;quot;,</span>
<span class="c">#      &amp;quot;apiVersion&amp;quot;: &amp;quot;v1&amp;quot;,</span>
<span class="c">#      &amp;quot;metadata&amp;quot;: {},</span>
<span class="c">#      &amp;quot;status&amp;quot;: &amp;quot;Failure&amp;quot;,</span>
<span class="c">#      &amp;quot;message&amp;quot;: &amp;quot;forbidden: User \&amp;quot;system:anonymous\&amp;quot; cannot get path \&amp;quot;/\&amp;quot;&amp;quot;,</span>
<span class="c">#      &amp;quot;reason&amp;quot;: &amp;quot;Forbidden&amp;quot;,</span>
<span class="c">#      &amp;quot;details&amp;quot;: {},</span>
<span class="c">#      &amp;quot;code&amp;quot;: 403</span>
<span class="c">#    } # í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì†ì´ ë©ë‹ˆë‹¤! ì™œ ê·¸ëŸ´ê¹Œìš”?</span>

<span class="nv">$ </span>docker ps <span class="c"># í¬íŠ¸ í¬ì›Œë”© ì •ë³´ í™•ì¸</span>
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                  NAMES</span>
<span class="c">#    6228f280b992   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   3 minutes ago   Up 3 minutes   0.0.0.0:30000-30001-&amp;gt;30000-30001/tcp   myk8s-worker</span>
<span class="c">#    219113c36204   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   3 minutes ago   Up 3 minutes   127.0.0.1:58638-&amp;gt;6443/tcp              myk8s-control-plane</span>

<span class="c"># ë„ì»¤ì—ì„œ 127.0.0.1:58638-&amp;gt;6443/tcp ë¡œ í¬íŠ¸í¬ì›Œë”©ì„ í•˜ê¸° ë•Œë¬¸ì¸ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </span>

<span class="c"># apiserver í”„ë¡œì„¸ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane ss <span class="nt">-tnlp</span> | <span class="nb">grep </span>6443
<span class="c"># =&gt; LISTEN 0      4096               *:6443             *:*    users:((&amp;quot;kube-apiserver&amp;quot;,pid=584,fd=3)) </span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> <span class="nv">component</span><span class="o">=</span>kube-apiserver <span class="nt">-owide</span> <span class="c"># íŒŒë“œ IP í™•ì¸</span>
<span class="c"># =&gt; NAME                                 READY   STATUS    RESTARTS   AGE     IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    kube-apiserver-myk8s-control-plane   1/1     Running   0          5m39s   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c"># kube-apiserver íŒŒë“œ ìƒì„¸ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe  pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> <span class="nv">component</span><span class="o">=</span>kube-apiserver

<span class="c"># health check ì£¼ì†Œ ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane curl <span class="nt">-k</span> https://localhost:6443/livez <span class="p">;</span><span class="nb">echo</span>
<span class="c"># =&gt; ok</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane curl <span class="nt">-k</span> https://localhost:6443/readyz <span class="p">;</span><span class="nb">echo</span>
<span class="c"># =&gt; ok</span>

<span class="c"># ë…¸ë“œ ì •ë³´ í™•ì¸ : CRI ëŠ” containerd ì‚¬ìš©</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME                  STATUS   ROLES           AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION     CONTAINER-RUNTIME</span>
<span class="c">#    myk8s-control-plane   Ready    control-plane   7m15s   v1.31.0   172.20.0.2    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>
<span class="c">#    myk8s-worker          Ready    &amp;lt;none&amp;gt;          7m1s    v1.31.0   172.20.0.3    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>

<span class="c"># íŒŒë“œ ì •ë³´ í™•ì¸ : CNI ëŠ” kindnet ì‚¬ìš©</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>
<span class="c"># =&gt; NAMESPACE            NAME                                          READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    kube-system          coredns-6f6b679f8f-9gxnw                      1/1     Running   0          10m   10.244.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          etcd-myk8s-control-plane                      1/1     Running   0          10m   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kindnet-b5brb                                 1/1     Running   0          10m   172.20.0.3   myk8s-worker          &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-apiserver-myk8s-control-plane            1/1     Running   0          10m   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-controller-manager-myk8s-control-plane   1/1     Running   0          10m   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-proxy-tbh7b                              1/1     Running   0          10m   172.20.0.3   myk8s-worker          &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-scheduler-myk8s-control-plane            1/1     Running   0          10m   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    local-path-storage   local-path-provisioner-57c5987fd4-nfcv8       1/1     Running   0          10m   10.244.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    ...</span>

<span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸ </span>
<span class="nv">$ </span>kubectl get namespaces
<span class="c"># =&gt; NAME                 STATUS   AGE</span>
<span class="c">#    default              Active   11m</span>
<span class="c">#    kube-node-lease      Active   11m</span>
<span class="c">#    kube-public          Active   11m</span>
<span class="c">#    kube-system          Active   11m</span>
<span class="c">#    local-path-storage   Active   10m</span>

<span class="c"># ë””ë²„ê·¸ìš© ë‚´ìš© ì¶œë ¥ì— ~/.kube/config ê¶Œí•œ ì¸ì¦ ë¡œë“œ</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-v6</span>
<span class="c"># =&gt; I0907 21:08:08.698472   40997 loader.go:395] Config loaded from file:  /Users/psyche/.kube/config</span>
<span class="c">#    I0907 21:08:08.709347   40997 round_trippers.go:553] GET https://127.0.0.1:58638/api/v1/namespaces/default/pods?limit=500 200 OK in 8 milliseconds</span>
<span class="c">#    No resources found in default namespace.</span>

<span class="c"># kube config íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config

<span class="c"># local-path ë¼ëŠ” StorageClass ê°€ ì„¤ì¹˜, local-path ëŠ” ë…¸ë“œì˜ ë¡œì»¬ ì €ì¥ì†Œë¥¼ í™œìš©í•¨</span>
<span class="c"># ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì˜ path ë¥¼ ì§€ì •í•  í•„ìš” ì—†ì´ local-path provisioner ì´ ë³¼ë¥¨ì„ ê´€ë¦¬</span>
<span class="nv">$ </span>kubectl get sc
<span class="c"># =&gt; NAME                 PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span>
<span class="c">#    standard (default)   rancher.io/local-path   Delete          WaitForFirstConsumer   false                  12m</span>
<span class="nv">$ </span>kubectl get deploy <span class="nt">-n</span> local-path-storage
</code></pre></div></div>

<h3 id="ì¿ ë²„ë„¤í‹°ìŠ¤-ê´€ë ¨-ì •ë³´-ì¡°ì‚¬">ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì •ë³´ ì¡°ì‚¬</h3>

<p>ì´ë²ˆì—ëŠ” KIND ë‚´ë¶€ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì •ë³´ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
ì›í™œí•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í•„ìš”í•œ íˆ´ì„ ì„¤ì¹˜í•˜ê³ , KIND ë‚´ë¶€ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì •ë³´ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íˆ´ ì„¤ì¹˜</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump htop git nano -y'</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump htop git nano -y'</span>

<span class="c"># static pod manifest ìœ„ì¹˜ ì°¾ê¸°</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane <span class="nb">grep </span>staticPodPath /var/lib/kubelet/config.yaml
<span class="c"># =&gt; staticPodPath: /etc/kubernetes/manifests</span>

<span class="c"># static pod ì •ë³´ í™•ì¸ : kubectl ë° control plane ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•Šê³  kubelet ì„ í†µí•´ ì§€ì •í•œ ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane tree /etc/kubernetes/manifests/
<span class="c"># =&gt; /etc/kubernetes/manifests/</span>
<span class="c">#    |-- etcd.yaml</span>
<span class="c">#    |-- kube-apiserver.yaml</span>
<span class="c">#    |-- kube-controller-manager.yaml</span>
<span class="c">#    `-- kube-scheduler.yaml</span>

<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker tree /etc/kubernetes/manifests/
<span class="c"># =&gt; /etc/kubernetes/manifests/</span>

<span class="c"># ì›Œì»¤ ë…¸ë“œ(ì»¨í…Œì´ë„ˆ) bash ì§„ì…</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker bash
<span class="c"># ---------------------------------</span>
<span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; root</span>

<span class="c"># kubelet ìƒíƒœ í™•ì¸</span>
<span class="nv">$ </span>systemctl status kubelet
<span class="c"># =&gt; â— kubelet.service - kubelet: The Kubernetes Node Agent</span>
<span class="c">#         Loaded: loaded (/etc/systemd/system/kubelet.service; enabled; preset: enabled)</span>
<span class="c">#        Drop-In: /etc/systemd/system/kubelet.service.d</span>
<span class="c">#                 â””â”€10-kubeadm.conf, 11-kind.conf</span>
<span class="c">#         Active: active (running) since Sat 2024-09-07 11:56:44 UTC; 48min ago</span>
<span class="c">#           Docs: http://kubernetes.io/docs/</span>
<span class="c">#       Main PID: 236 (kubelet)</span>
<span class="c">#          Tasks: 15 (limit: 2254)</span>
<span class="c">#         Memory: 32.9M</span>
<span class="c">#            CPU: 1min 7.074s</span>
<span class="c">#         CGroup: /kubelet.slice/kubelet.service</span>
<span class="c">#                 â””â”€236 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/conf&gt;</span>
<span class="c">#    ...</span>

<span class="c"># ì»¨í…Œì´ë„ˆ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; bash: docker: command not found</span>
<span class="nv">$ </span>crictl ps
<span class="c"># =&gt; CONTAINER           IMAGE               CREATED             STATE               NAME                ATTEMPT             POD ID              POD</span>
<span class="c">#    dd7ff0509e335       6a23fa8fd2b78       49 minutes ago      Running             kindnet-cni         0                   99f981aced025       kindnet-b5brb</span>
<span class="c">#    41b224e66bc3c       c573e1357a14e       49 minutes ago      Running             kube-proxy          0                   8880634c13ba5       kube-proxy-tbh7b</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">docker ps</code>í–ˆì„ë•ŒëŠ” <code class="language-plaintext highlighter-rouge">command not found</code>ê°€ ë‚˜ì˜¤ê³  <code class="language-plaintext highlighter-rouge">crictl ps</code>ë¡œ í–ˆì„ë•Œ ì»¨í…Œì´ë„ˆ ì •ë³´ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³´ë©´, KINDëŠ” ì´ë¦„ê³¼ëŠ” ë‹¤ë¥´ê²Œ Docker ëŒ€ì‹  CRI(Container Runtime Interface)ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— <code class="language-plaintext highlighter-rouge">docker</code> ëª…ë ¹ì–´ ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">crictl</code> ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kube-proxy í™•ì¸</span>
<span class="nv">$ </span>pstree
<span class="c"># =&gt; systemd-+-containerd---15*[{containerd}]</span>
<span class="c">#            |-containerd-shim-+-kube-proxy---8*[{kube-proxy}]</span>
<span class="c">#            |                 |-pause</span>
<span class="c">#            |                 `-12*[{containerd-shim}]</span>
<span class="c">#            |-containerd-shim-+-kindnetd---11*[{kindnetd}]</span>
<span class="c">#            |                 |-pause</span>
<span class="c">#            |                 `-12*[{containerd-shim}]</span>
<span class="c">#            |-kubelet---14*[{kubelet}]</span>
<span class="c">#            `-systemd-journal</span>
<span class="nv">$ </span>pstree <span class="nt">-p</span>
<span class="c"># kube-proxy í”„ë¡œì„¸ìŠ¤ ì •ë³´</span>
<span class="nv">$ </span>ps afxuwww |grep proxy 
<span class="c"># =&gt; root         387  0.0  1.1 1290144 24112 ?       Ssl  11:56   0:02  \_ /usr/local/bin/kube-proxy --config=/var/lib/kube-proxy/config.conf --hostname-override=myk8s-worker</span>
<span class="c"># ë°©í™”ë²½ ì„¤ì • í™•ì¸</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> mangle <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> raw <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> security <span class="nt">-S</span>

<span class="c"># tcp listen í¬íŠ¸ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ss <span class="nt">-tnlp</span>

<span class="c"># ë¹ ì ¸ë‚˜ì˜¤ê¸°</span>
<span class="nv">$ </span><span class="nb">exit</span>
<span class="c"># ---------------------------------</span>
</code></pre></div></div>

<h3 id="íŒŒë“œ-ìƒì„±-ë°-í™•ì¸">íŒŒë“œ ìƒì„± ë° í™•ì¸</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íŒŒë“œ ìƒì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl create -f -
apiVersion: v1
kind: Pod
metadata:
  name: netpod
spec:
  containers:
  - name: netshoot-pod
    image: nicolaka/netshoot
    command: ["tail"]
    args: ["-f", "/dev/null"]
  terminationGracePeriodSeconds: 0
---
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx-pod
    image: nginx:alpine
  terminationGracePeriodSeconds: 0
</span><span class="no">EOF
</span><span class="c"># =&gt; pod/netpod created</span>
<span class="c">#    pod/nginx created</span>

<span class="c"># íŒŒë“œ í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-owide</span>
<span class="c"># =&gt; NAME     READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES</span>
<span class="c">#    netpod   1/1     Running   0          52s   10.244.1.3   myk8s-worker   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    nginx    1/1     Running   0          52s   10.244.1.2   myk8s-worker   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>

<span class="c"># netpod íŒŒë“œì—ì„œ nginx ì›¹ ì ‘ì†</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> netpod <span class="nt">--</span> curl <span class="nt">-s</span> <span class="si">$(</span>kubectl get pod nginx <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.status.podIP<span class="o">}</span><span class="si">)</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"&lt;title&gt;.*&lt;/title&gt;"</span>
<span class="c"># =&gt; &lt;title&gt;Welcome to nginx!&lt;/title&gt;</span>
</code></pre></div></div>

<h3 id="ì»¨íŠ¸ë¡¤-í”Œë ˆì¸-ì»¨í…Œì´ë„ˆ-ì •ë³´-í™•ì¸">ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì»¨í…Œì´ë„ˆ ì •ë³´ í™•ì¸</h3>

<p>ì´ë²ˆì—ëŠ” ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì»¨í…Œì´ë„ˆì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. kindëŠ” Docker IN Docker ë°©ì‹ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì„ êµ¬ì„±í•˜ê¸° ë•Œë¬¸ì—
ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì—ì„œ ì •ë³´ë¥¼ í™•ì¸í•  ë•Œì™€ í˜¸ìŠ¤íŠ¸ì—ì„œ docker ì •ë³´ë¥¼ í™•ì¸í• ë•Œì™€ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë„ì»¤ ì»¨í…Œì´ë„ˆ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED       STATUS       PORTS                                  NAMES</span>
<span class="c">#    6228f280b992   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   2 hours ago   Up 2 hours   0.0.0.0:30000-30001-&amp;gt;30000-30001/tcp   myk8s-worker</span>
<span class="c">#    219113c36204   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   2 hours ago   Up 2 hours   127.0.0.1:58638-&amp;gt;6443/tcp              myk8s-control-plane</span>

<span class="nv">$ </span>docker inspect myk8s-control-plane | jq
...
      <span class="s2">"Entrypoint"</span>: <span class="o">[</span>
        <span class="s2">"/usr/local/bin/entrypoint"</span>,
        <span class="s2">"/sbin/init"</span>
      <span class="o">]</span>,
...

<span class="c"># ì»¨íŠ¸ë¡¤í”Œë ˆì¸ ì»¨í…Œì´ë„ˆ bash ì ‘ì† í›„ í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane bash
<span class="nt">-------------------------------------------</span>
<span class="c"># CPU ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">arch</span>
<span class="c"># =&gt; aarch64      # intel í˜¸í™˜ CPUì¸ ê²½ìš° x86_64ê°€ í‘œì‹œë©ë‹ˆë‹¤.</span>

<span class="c"># ê¸°ë³¸ ì‚¬ìš©ì í™•ì¸</span>
<span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; root</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="c"># =&gt; lo               UNKNOWN        127.0.0.1/8</span>
<span class="c">#    vethfbd4a037@if4 UP             10.244.0.1/32</span>
<span class="c">#    veth50a51781@if4 UP             10.244.0.1/32</span>
<span class="c">#    veth1822edcc@if4 UP             10.244.0.1/32</span>
<span class="c">#    eth0@if17        UP             172.20.0.2/16</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> route
<span class="c"># =&gt; 10.244.0.2 dev vethfbd4a037 scope host</span>
<span class="c">#    10.244.0.3 dev veth50a51781 scope host</span>
<span class="c">#    10.244.0.4 dev veth1822edcc scope host</span>
<span class="c">#    10.244.1.0/24 via 172.20.0.3 dev eth0</span>
<span class="c">#    172.20.0.0/16 dev eth0 proto kernel scope link src 172.20.0.2</span>
<span class="nv">$ </span><span class="nb">cat</span> /etc/resolv.conf
<span class="c"># =&gt; nameserver 192.168.65.2</span>
<span class="c">#    options ndots:0</span>

<span class="c"># Entrypoint ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> /usr/local/bin/entrypoint

<span class="c"># í”„ë¡œì„¸ìŠ¤ í™•ì¸ : PID 1 ì€ /sbin/init</span>
<span class="nv">$ </span>ps <span class="nt">-ef</span>
<span class="c"># =&gt; UID          PID    PPID  C STIME TTY          TIME CMD</span>
<span class="c">#    root           1       0  0 11:56 ?        00:00:01 /sbin/init</span>
<span class="c">#    ...</span>

<span class="c"># kindëŠ” docker ì•ˆì—ì„œ dockerë¥¼ ìš´ì˜í•˜ê¸° ìœ„í•´ OSë¥¼ í‰ë‚´ë‚´ê¸° ìœ„í•´ ìì²´ì ìœ¼ë¡œ systemdë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—</span>
<span class="c"># ìœ„ì™€ ê°™ì´ PID 1ì´ /sbin/init ê°€ ë˜ê³ , systemctl ëª…ë ¹ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
 
<span class="c"># ì»¨í…Œì´í„° ëŸ°íƒ€ì„ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>systemctl status containerd

<span class="c"># DinD ì»¨í…Œì´ë„ˆ í™•ì¸ : crictl ì‚¬ìš©</span>
<span class="nv">$ </span>crictl version
<span class="c"># =&gt; Version:  0.1.0</span>
<span class="c">#    RuntimeName:  containerd</span>
<span class="c">#    RuntimeVersion:  v1.7.18</span>
<span class="c">#    RuntimeApiVersion:  v1</span>
<span class="nv">$ </span>crictl info
<span class="nv">$ </span>crictl ps <span class="nt">-o</span> json | jq <span class="nt">-r</span> <span class="s1">'.containers[] | {NAME: .metadata.name, POD: .labels["io.kubernetes.pod.name"]}'</span>
<span class="nv">$ </span>crictl ps
<span class="c"># =&gt; CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID              POD</span>
<span class="c">#    075e7a9f5f7a3       2437cf7621777       2 hours ago         Running             coredns                   0                   5e7c18501fc65       coredns-6f6b679f8f-9gxnw</span>
<span class="c">#    6f61738127a55       2437cf7621777       2 hours ago         Running             coredns                   0                   3b69c8d195b5d       coredns-6f6b679f8f-fk27q</span>
<span class="c">#    ...</span>

<span class="c"># íŒŒë“œ ì´ë¯¸ì§€ í™•ì¸</span>
<span class="nv">$ </span>crictl images
<span class="c"># =&gt; IMAGE                                           TAG                  IMAGE ID            SIZE</span>
<span class="c">#    docker.io/library/nginx                         alpine               9d6767b714bf1       20.2MB</span>
<span class="c">#    docker.io/nicolaka/netshoot                     latest               eead9e442471d       178MB</span>
<span class="c">#    ...</span>

<span class="c"># kubectl í™•ì¸</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-v6</span>
<span class="nv">$ </span><span class="nb">cat</span> /etc/kubernetes/admin.conf

<span class="nv">$ </span><span class="nb">exit</span>
<span class="nt">-------------------------------------------</span>

<span class="c"># ë„ì»¤ ì»¨í…Œì´ë„ˆ í™•ì¸ : ë‹¤ì‹œ í•œë²ˆ ìì‹ ì˜ í˜¸ìŠ¤íŠ¸PCì—ì„œ ë„ì»¤ ì»¨í…Œì´ë„ˆ í™•ì¸, DinD ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ì—ì„œ ë³´ì´ëŠ”ì§€ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED       STATUS       PORTS                                  NAMES</span>
<span class="c">#    6228f280b992   kindest/node:v1.31.0   "/usr/local/bin/entrâ€¦"   2 hours ago   Up 2 hours   0.0.0.0:30000-30001-&gt;30000-30001/tcp   myk8s-worker</span>
<span class="c">#    219113c36204   kindest/node:v1.31.0   "/usr/local/bin/entrâ€¦"   2 hours ago   Up 2 hours   127.0.0.1:58638-&gt;6443/tcp              myk8s-control-plane</span>
<span class="nv">$ </span>docker port myk8s-control-plane

<span class="c"># kubectl í™•ì¸ : k8s api í˜¸ì¶œ ì£¼ì†Œ í™•ì¸</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-v6</span> 
</code></pre></div></div>

<ul>
  <li>KINDì˜ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì—ì„œ <code class="language-plaintext highlighter-rouge">crictl ps</code>ë¡œ ì»¨í…Œì´ë„ˆë¥¼ í™•ì¸í• ë•Œì™€ í˜¸ìŠ¤íŠ¸ì—ì„œ <code class="language-plaintext highlighter-rouge">docker ps</code>ë¡œ í™•ì¸í• ë•Œì˜ ì°¨ì´ê°€ ë‚˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>
    <p>ì´ê²ƒì€ ì•ì—ì„œë„ docker ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ docker (ì •í™•íˆëŠ” containerd)ë¥¼ ë³„ë„ë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” í˜„ìƒì…ë‹ˆë‹¤. ì´ê²ƒì´ DIND(Docker IN Docker)ì…ë‹ˆë‹¤.
â€”ë§Œì•½ ê°™ì€ ì»¨í…Œì´ë„ˆê°€ ë‚˜ì˜¨ë‹¤ë©´ Docker OUT Dockerë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì¼ê²ƒì…ë‹ˆë‹¤â€”</p>
  </li>
  <li>í´ëŸ¬ìŠ¤í„°ë¥¼ ì‚­ì œí•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ì‚­ì œ</span>
<span class="nv">$ </span>kind delete cluster <span class="nt">--name</span> myk8s
<span class="c"># =&gt; Deleting cluster "myk8s" ...</span>
<span class="c">#    Deleted nodes: ["myk8s-worker" "myk8s-control-plane"]</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span>
</code></pre></div></div>

<h3 id="multi-node-í´ëŸ¬ìŠ¤í„°-with-kube-ops-view--mapping-ports">Multi-Node í´ëŸ¬ìŠ¤í„° with kube-ops-view &amp; mapping ports</h3>

<p>ì´ë²ˆì—ëŠ” KINDë¡œ Multi-Node í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ê³ , kube-ops-viewë¥¼ ì„¤ì¹˜í•˜ì—¬ í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ ì‹œê°í™”í•˜ê³ , í¬íŠ¸ ë§¤í•‘ì„ í†µí•´ í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>í´ëŸ¬ìŠ¤í„° êµ¬ì„± ë° ë…¸ë“œ ì •ë³´ í™•ì¸</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 'ì»¨íŠ¸ë¡¤í”Œë ˆì¸, ì›Œì»¤ ë…¸ë“œ 1ëŒ€' í´ëŸ¬ìŠ¤í„° ë°°í¬ : íŒŒë“œì— ì ‘ì†í•˜ê¸° ìœ„í•œ í¬íŠ¸ ë§µí•‘ ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh">&gt; kind-2node.yaml
# two node (one workers) cluster config
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
  extraPortMappings:
  - containerPort: 31000
    hostPort: 31000
    listenAddress: "0.0.0.0" # Optional, defaults to "0.0.0.0"
    protocol: tcp # Optional, defaults to tcp
  - containerPort: 31001
    hostPort: 31001
</span><span class="no">EOT

</span><span class="nv">$ CLUSTERNAME</span><span class="o">=</span>myk8s
<span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-2node.yaml <span class="nt">--name</span> <span class="nv">$CLUSTERNAME</span>
<span class="c"># =&gt; Creating cluster "myk8s" ...</span>
<span class="c">#     âœ“ Ensuring node image (kindest/node:v1.31.0) ğŸ–¼</span>
<span class="c">#     âœ“ Preparing nodes ğŸ“¦ ğŸ“¦</span>
<span class="c">#     âœ“ Writing configuration ğŸ“œ</span>
<span class="c">#     âœ“ Starting control-plane ğŸ•¹ï¸</span>
<span class="c">#     âœ“ Installing CNI ğŸ”Œ</span>
<span class="c">#     âœ“ Installing StorageClass ğŸ’¾</span>
<span class="c">#     âœ“ Joining worker nodes ğŸšœ</span>
<span class="c">#    Set kubectl context to "kind-myk8s"</span>
<span class="c">#    You can now use your cluster with:</span>
<span class="c">#    </span>
<span class="c">#    kubectl cluster-info --context kind-myk8s</span>
<span class="c">#    </span>
<span class="c">#    Have a nice day! ğŸ‘‹</span>

<span class="c"># ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>kind get clusters
<span class="c"># =&gt; myk8s</span>
<span class="nv">$ </span>kind get nodes <span class="nt">--name</span> <span class="nv">$CLUSTERNAME</span>
<span class="c"># =&gt; myk8s-control-plane</span>
<span class="c">#    myk8s-worker</span>

<span class="c"># ë…¸ë“œ í™•ì¸</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME                  STATUS   ROLES           AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION     CONTAINER-RUNTIME</span>
<span class="c">#    myk8s-control-plane   Ready    control-plane   2m12s   v1.31.0   172.20.0.2    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>
<span class="c">#    myk8s-worker          Ready    &amp;lt;none&amp;gt;          119s    v1.31.0   172.20.0.3    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>

<span class="c"># ë…¸ë“œì— Taints ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe node <span class="nv">$CLUSTERNAME</span><span class="nt">-control-plane</span> | <span class="nb">grep </span>Taints
<span class="c"># =&gt; Taints:             node-role.kubernetes.io/control-plane:NoSchedule</span>

<span class="nv">$ </span>kubectl describe node <span class="nv">$CLUSTERNAME</span><span class="nt">-worker</span> | <span class="nb">grep </span>Taints
<span class="c"># =&gt; Taints:             &amp;lt;none&amp;gt;</span>

<span class="c"># control-plane ë…¸ë“œì—ëŠ” taintsê°€ ê±¸ë ¤ìˆì–´ì„œ ìŠ¤ì¼€ì¥´ë§ì´ ë˜ì§€ ì•Šê³  </span>
<span class="c"># worker ë…¸ë“œì—ëŠ” taintsê°€ ì—†ì–´ì„œ ìŠ¤ì¼€ì¥´ë§ì´ ë  ê²ƒì„ ì˜ˆìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>

<span class="c"># ì»¨í…Œì´ë„ˆ í™•ì¸ : ì»¨í…Œì´ë„ˆ ê°¯ìˆ˜, ì»¨í…Œì´ë„ˆ ì´ë¦„ í™•ì¸</span>
<span class="c"># kind yaml ì— í¬íŠ¸ ë§µí•‘ ì •ë³´ ì²˜ëŸ¼, ìì‹ ì˜ PC í˜¸ìŠ¤íŠ¸ì— 31000 í¬íŠ¸ ì ‘ì† ì‹œ, ì›Œì»¤ë…¸ë“œ(ì‹¤ì œë¡œëŠ” ì»¨í…Œì´ë„ˆ)ì— TCP 31000 í¬íŠ¸ë¡œ ì—°ê²°</span>
<span class="c"># ì¦‰, ì›Œì»¤ë…¸ë“œì— NodePort TCP 31000 ì„¤ì • ì‹œ ìì‹ ì˜ PC í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì† ê°€ëŠ¥!</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                  NAMES</span>
<span class="c">#    7724a7ff92bb   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   6 minutes ago   Up 6 minutes   127.0.0.1:58498-&amp;gt;6443/tcp              myk8s-control-plane</span>
<span class="c">#    5b7fa2f98703   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   6 minutes ago   Up 6 minutes   0.0.0.0:31000-31001-&amp;gt;31000-31001/tcp   myk8s-worker</span>
<span class="nv">$ </span>docker port <span class="nv">$CLUSTERNAME</span><span class="nt">-worker</span>
<span class="c"># =&gt; 31000/tcp -&amp;gt; 0.0.0.0:31000</span>
<span class="c">#    31001/tcp -&amp;gt; 0.0.0.0:31001</span>

<span class="c"># ê° ë…¸ë“œë“¤ì˜ ì •ë³´ í™•ì¸ì„ dockerë¥¼ í†µí•´ì„œ í™•ì¸í•´ ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$CLUSTERNAME</span><span class="nt">-control-plane</span> ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$CLUSTERNAME</span><span class="nt">-worker</span>  ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
</code></pre></div></div>

<ul>
  <li>
    <p>ì´ë²ˆì— KINDë¥¼ í†µí•´ ë§Œë“  í´ëŸ¬ìŠ¤í„°ëŠ” í˜¸ìŠ¤íŠ¸ì—ì„œ 31000, 31001 í¬íŠ¸ë¡œ ì ‘ì†ì‹œ ì›Œì»¤ë…¸ë“œ(ì»¨í…Œì´ë„ˆ)ì˜ 31000, 31001 í¬íŠ¸ë¡œ 
ì—°ê²°ë˜ë„ë¡ ì„¤ì •ë˜ëŠ”ë°, ê·¸ ì´ìœ ëŠ” KIND í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í• ë•Œ ì•„ë˜ì™€ ê°™ì´ í¬íŠ¸ë¥¼ ì—´ê²ƒì„ ì§€ì •í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>

    <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">...</span>
<span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
  <span class="na">extraPortMappings</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">31000</span>
    <span class="na">hostPort</span><span class="pi">:</span> <span class="m">31000</span>
    <span class="na">listenAddress</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0"</span> <span class="c1"># Optional, defaults to "0.0.0.0"</span>
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">tcp</span> <span class="c1"># Optional, defaults to tcp</span>
  <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">31001</span>
    <span class="na">hostPort</span><span class="pi">:</span> <span class="m">31001</span>
<span class="nn">...</span>
</code></pre></div>    </div>
    <p>ì¶”ê°€ì ì¸ í¬íŠ¸ ë§¤í•‘ì´ í•„ìš”í•œ ê²½ìš° ìœ„ì™€ ê°™ì´ <code class="language-plaintext highlighter-rouge">extraPortMappings</code>ì— ì¶”ê°€í•˜ì—¬ í¬íŠ¸ë¥¼ ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>Kube-ops-view ì„¤ì¹˜ : Node port 31000</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kube-ops-view</span>
<span class="c"># helm show values geek-cookbook/kube-ops-view</span>
<span class="nv">$ </span>helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
<span class="nv">$ </span>helm <span class="nb">install </span>kube-ops-view geek-cookbook/kube-ops-view <span class="nt">--version</span> 1.2.2 <span class="nt">--set</span> service.main.type<span class="o">=</span>NodePort,service.main.ports.http.nodePort<span class="o">=</span>31000 <span class="nt">--set</span> env.TZ<span class="o">=</span><span class="s2">"Asia/Seoul"</span> <span class="nt">--namespace</span> kube-system

<span class="c"># ì„¤ì¹˜ í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,pod,svc,ep <span class="nt">-n</span> kube-system <span class="nt">-l</span> app.kubernetes.io/instance<span class="o">=</span>kube-ops-view
<span class="c"># =&gt; NAME                            READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    deployment.apps/kube-ops-view   0/1     1            0           18s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                 READY   STATUS              RESTARTS   AGE</span>
<span class="c">#    pod/kube-ops-view-657dbc6cd8-tmkl5   0/1     ContainerCreating   0          18s</span>
<span class="c">#    </span>
<span class="c">#    NAME                    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span>
<span class="c">#    service/kube-ops-view   NodePort   10.96.212.51   &amp;lt;none&amp;gt;        8080:31000/TCP   18s</span>
<span class="c">#    </span>
<span class="c">#    NAME                      ENDPOINTS   AGE</span>
<span class="c">#    endpoints/kube-ops-view   &amp;lt;none&amp;gt;      18s</span>

<span class="c"># kube-ops-view ì ‘ì† URL í™•ì¸ (1.5 , 2 ë°°ìœ¨)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:31000/#scale=1.5"</span>
<span class="c"># =&gt; KUBE-OPS-VIEW URL = http://localhost:31000/#scale=1.5</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:31000/#scale=2"</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_5.png" alt="img.png" /></p>

<p>í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì‹œ ë…¸ë“œì˜ 31000í¬íŠ¸ë¥¼ í˜¸ìŠ¤íŠ¸ì˜ 31000ì— ë§¤í•‘ì‹œì¼œì„œ í˜¸ìŠ¤íŠ¸ì—ì„œ ìœ„ì™€ ê°™ì´ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>nginx ì„¤ì¹˜ : NodePort 31001</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë””í”Œë¡œì´ë¨¼íŠ¸ì™€ ì„œë¹„ìŠ¤ ë°°í¬</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl create -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deploy-websrv
spec:
  replicas: 2
  selector:
    matchLabels:
      app: deploy-websrv
  template:
    metadata:
      labels:
        app: deploy-websrv
    spec:
      terminationGracePeriodSeconds: 0
      containers:
      - name: deploy-websrv
        image: nginx:alpine
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: deploy-websrv
spec:
  ports:
    - name: svc-webport
      port: 80
      targetPort: 80
      nodePort: 31001
  selector:
    app: deploy-websrv
  type: NodePort
</span><span class="no">EOF

</span><span class="c"># í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS                                  NAMES</span>
<span class="c">#    5b7fa2f98703   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   15 minutes ago   Up 15 minutes   0.0.0.0:31000-31001-&amp;gt;31000-31001/tcp   myk8s-worker</span>
<span class="c">#    ...</span>

<span class="nv">$ </span>kubectl get deploy,svc,ep deploy-websrv
<span class="c"># =&gt; ...</span>
<span class="c">#    NAME                    TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span>
<span class="c">#    service/deploy-websrv   NodePort   10.96.115.233   &amp;lt;none&amp;gt;        80:31001/TCP   47s</span>
<span class="c">#    ...</span>

<span class="c"># ìì‹ ì˜ PCì— í˜¸ìŠ¤íŠ¸ í¬íŠ¸ 31001 ì ‘ì† ì‹œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ì— ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>open http://localhost:31001
<span class="nv">$ </span>curl <span class="nt">-s</span> localhost:31001 | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"&lt;title&gt;.*&lt;/title&gt;"</span>
<span class="c"># =&gt; &lt;title&gt;Welcome to nginx!&lt;/title&gt;</span>

<span class="c"># ë””í”Œë¡œì´ë¨¼íŠ¸ì™€ ì„œë¹„ìŠ¤ ì‚­ì œ</span>
<span class="nv">$ </span>kubectl delete deploy,svc deploy-websrv
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_6.png" alt="img.png" class="image-center" />
<em class="image-caption">31001 í¬íŠ¸ë¡œ ì ‘ì†ì‹œ nginx í˜ì´ì§€ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</em></p>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_7.png" alt="img_1.png" />
<em class="image-caption">kube-ops-viewì—ì„œ deployëœ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</em></p>

<hr />

<h2 id="íŒŒë“œ--pause-ì»¨í…Œì´ë„ˆ">íŒŒë“œ &amp; PAUSE ì»¨í…Œì´ë„ˆ</h2>

<p><strong>íŒŒë“œ(pod)</strong>ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ <strong>ë°°í¬í•˜ëŠ” ìµœì†Œ ë‹¨ìœ„</strong>ì´ë©°, íŒŒë“œ ë‚´ë¶€ì—ëŠ” <strong>ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆê°€ í¬í•¨ë  ìˆ˜</strong> ìˆìŠµë‹ˆë‹¤. 
íŒŒë“œ ë‚´ë¶€ì—ëŠ” PAUSE ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬í•˜ë©°, <strong>PAUSE ì»¨í…Œì´ë„ˆ</strong>ëŠ” <strong>Network/IPC/UTS ë„¤ì„ìŠ¤í˜ì´ìŠ¤</strong>ë¥¼ <strong>ìƒì„±</strong>í•˜ê³  <strong>ìœ ì§€</strong>/<strong>ê³µìœ </strong>í•˜ëŠ” ì—­í• ìš¸ í•©ë‹ˆë‹¤. 
ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ ë„¤íŠ¸ì›Œí¬ ë“±ì— ëŒ€í•´ì„œëŠ” 1ì£¼ì°¨ì—ì„œ í•™ìŠµí•œ ë‚´ìš©ì´ ë§ì´ ë„ì›€ë˜ì—ˆìŠµë‹ˆë‹¤. <a href="https://sweetlittlebird.github.io/posts/2024-08-27-KANS-Study-Week1/">1ì£¼ì°¨ ë§í¬</a></p>

<h3 id="k8s-cri-container-runtime-interface">K8S CRI (Container Runtime Interface)</h3>

<p>ë¨¼ì € íŒŒë“œì™€ PAUSE ì»¨í…Œì´ë„ˆì— ëŒ€í•´ ì•Œì•„ë³´ê¸°ì „ì— ì•ì„  ì‹¤ìŠµì—ì„œ ë³´ì•˜ë˜ CRI(Container Runtime Interface)ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ <strong>CRI(Container Runtime Interface)</strong>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p>CRIì˜ íƒ„ìƒ ë°°ê²½ì€ ë¨¼ì € Dockerì—ì„œ ë¶€í„° ì°¾ì•„ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
Dockerê°€ ëŒ€ì„±ê³µí•˜ê³  ì»¨í…Œì´ë„ˆ ê¸°ìˆ ì´ í™•ì‚°ë˜ë©´ì„œ, ì¿ ë²„ë„¤í‹°ìŠ¤ë„ Dockerë¥¼ ê¸°ë³¸ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ Docker Incë¼ëŠ” íšŒì‚¬ì— ì¢…ì†ë˜ëŠ”ê²ƒì„ ìš°ë ¤í•˜ì—¬, í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ë‹¤ì–‘í•œ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì„ ì§€ì›í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ CRIê°€ íƒ„ìƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. CRIë¼ëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ë§Œ ì§€í‚¤ë©´ ì–´ë–¤ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì´ë¼ë„ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
ì´ ê³¼ì •ì—ì„œ ì•„ì‰¬ìš´ê±´ DockerëŠ” CRIë¥¼ ì§€ì›í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, Dockerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” Docker shimì´ë¼ëŠ” í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•´ì•¼ í–ˆì—ˆìŠµë‹ˆë‹¤.</p>

<h3 id="íŒŒë“œ-pod">íŒŒë“œ (Pod)</h3>

<p>ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ë³¸ ë‹¨ìœ„ë¥¼ íŒŒë“œ(Pod)ë¼ê³  ë¶€ë¥´ë©°, íŒŒë“œëŠ” 1ê°œ ì´ìƒì˜ ì»¨í…Œì´ë„ˆë¡œ êµ¬ì„±ëœ ì»¨í…Œì´ë„ˆì˜ ì§‘í•©ì…ë‹ˆë‹¤.</p>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_8.png" alt="img.png" /></p>

<ul>
  <li>PodëŠ” 1ê°œ ì´ìƒì˜ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>Podë‚´ì— ì‹¤í–‰ë˜ëŠ” ì»¨í…Œì´ë„ˆë“¤ì€ ë™ì¼í•œ ë…¸ë“œì— í• ë‹¹ë˜ë©° ë™ì¼í•œ ìƒëª… ì£¼ê¸°(Life-cycle)ë¥¼ ê°–ìŠµë‹ˆë‹¤.</li>
  <li>PodëŠ” ë…¸ë“œ IP ì™€ ë³„ê°œë¡œ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ IPë¥¼ í• ë‹¹ ë°›ìœ¼ë©°, ë‹¤ë¥¸ ë…¸ë“œì— ìœ„ì¹˜í•œ Pod ë„ <strong>CNIë¥¼ í†µí•´</strong> NAT ì—†ì´ Pod IPë¡œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
  <li>Podë‚´ì— ìˆëŠ” ì»¨í…Œì´ë„ˆë“¤ì€ ì„œë¡œ IPë¥¼ ê³µìœ í•©ë‹ˆë‹¤. ê°™ì€ Podë‚´ì˜ ì»¨í…Œì´ë„ˆë¼ë¦¬ëŠ” localhost í†µí•´ ì„œë¡œ ì ‘ê·¼ê°€ëŠ¥ í•©ë‹ˆë‹¤.
    <ul>
      <li><strong>pause</strong> ì»¨í…Œì´ë„ˆê°€ network ns ë¥¼ ë§Œë“¤ì–´ ì£¼ê³ , ë‚´ë¶€ì˜ ì»¨í…Œì´ë„ˆë“¤ì€ í•´ë‹¹ net ns ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— IPë¥¼ ê³µìœ í•˜ê²Œ ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Pod ì•ˆì˜ ì»¨í…Œì´ë„ˆë“¤ì€ ë™ì¼í•œ ë³¼ë¥¨ê³¼ ì—°ê²°ì´ ê°€ëŠ¥í•˜ì—¬ íŒŒì¼ ì‹œìŠ¤í…œì„ ê¸°ë°˜ìœ¼ë¡œ ì„œë¡œ íŒŒì¼ì„ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>PodëŠ” ë¦¬ì†ŒìŠ¤ ì œì•½ì´ ìˆëŠ” ê²©ë¦¬ëœ í™˜ê²½ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ ê·¸ë£¹ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.</li>
  <li>í¬ë“œë¥¼ ì‹œì‘í•˜ê¸° ì „ì— kubeletì€ RuntimeService.RunPodSandboxë¥¼ í˜¸ì¶œí•˜ì—¬ í™˜ê²½ì„ ë§Œë“­ë‹ˆë‹¤.</li>
  <li>Kubeletì€ RPCë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆì˜ ìˆ˜ëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ê³ , ì»¨í…Œì´ë„ˆ ìˆ˜ëª… ì£¼ê¸° í›„í¬ì™€ í™œì„±/ì¤€ë¹„ í™•ì¸ì„ ì‹¤í–‰í•˜ë©°, Podì˜ ì¬ì‹œì‘ ì •ì±…ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤</li>
</ul>

<h3 id="pause-ì»¨í…Œì´ë„ˆ">PAUSE ì»¨í…Œì´ë„ˆ</h3>

<ul>
  <li>ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ <strong>pause</strong> ì»¨í…Œì´ë„ˆëŠ” í¬ë“œì˜ ëª¨ë“  ì»¨í…Œì´ë„ˆì— ëŒ€í•œ â€œ<strong>ë¶€ëª¨ ì»¨í…Œì´ë„ˆ</strong>â€ ì—­í• ì„ í•©ë‹ˆë‹¤. - <a href="https://sklar.rocks/what-is-a-pod-sandbox/">Link</a></li>
  <li><strong>pause</strong> ì»¨í…Œì´ë„ˆì—ëŠ” ë‘ ê°€ì§€ í•µì‹¬ ì±…ì„ì´ ìˆìŠµë‹ˆë‹¤.
    <ol>
      <li>íŒŒë“œì—ì„œ Linux <strong>ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê³µìœ ì˜ ê¸°ë°˜</strong> ì—­í• ì„ í•©ë‹ˆë‹¤. (Network, IPC, UTS ë„¤ì„ìŠ¤í˜ì´ìŠ¤)</li>
      <li>PID(í”„ë¡œì„¸ìŠ¤ ID) ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê³µìœ ê°€ í™œì„±í™”ë˜ë©´ ê° í¬ë“œì— ëŒ€í•œ <strong>PID 1 ì—­í• </strong>ì„ í•˜ë©° <strong>ì¢€ë¹„ í”„ë¡œì„¸ìŠ¤ë¥¼ ê±°ë‘¡</strong>ë‹ˆë‹¤.</li>
    </ol>
  </li>
  <li>pauseì˜ í•µì‹¬ ì†ŒìŠ¤ì½”ë“œëŠ” <a href="https://github.com/kubernetes/kubernetes/blob/master/build/pause/linux/pause.c">ì—¬ê¸°</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ë§¤ìš° ì§§ì§€ë§Œ ì¤‘ìš”í•œ ì½”ë“œì…ë‹ˆë‹¤. ìƒì„¸í•˜ê²Œ ì½”ë“œë¶„ì„í•œ ë¶„ì´ ìˆì–´ì„œ ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ì‹  ë¶„ì€ ë‹¤ìŒ ë§í¬ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
<a href="https://mateon.tistory.com/127">í•œê¸€ ë§í¬</a>
<a href="https://www.ianlewis.org/en/almighty-pause-container">ì˜ë¬¸ ë§í¬</a></li>
</ul>

<h4 id="pause-ì»¨í…Œì´ë„ˆ-ì‹¤ìŠµ">Pause ì»¨í…Œì´ë„ˆ ì‹¤ìŠµ</h4>

<ul>
  <li>Pause ì»¨í…Œì´ë„ˆì˜ ë™ì‘ì— ëŒ€í•´ ì‹¤ìŠµí•˜ê¸° ìœ„í•œ í™˜ê²½ì„ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 'ì»¨íŠ¸ë¡¤í”Œë ˆì¸, ì›Œì»¤ ë…¸ë“œ 1ëŒ€' í´ëŸ¬ìŠ¤í„° ë°°í¬ : íŒŒë“œì— ì ‘ì†í•˜ê¸° ìœ„í•œ í¬íŠ¸ ë§µí•‘ ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh">&gt; kind-2node.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
</span><span class="no">EOT
</span><span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-2node.yaml <span class="nt">--name</span> myk8s

<span class="c"># íˆ´ ì„¤ì¹˜</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump htop git nano -y'</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker        sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump htop -y'</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-o</span> wide
<span class="nv">$ </span>docker ps
<span class="nv">$ </span>docker port myk8s-worker
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr

<span class="c"># kube-ops-view</span>
<span class="nv">$ </span>helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
<span class="nv">$ </span>helm <span class="nb">install </span>kube-ops-view geek-cookbook/kube-ops-view <span class="nt">--version</span> 1.2.2 <span class="nt">--set</span> service.main.type<span class="o">=</span>NodePort,service.main.ports.http.nodePort<span class="o">=</span>30000 <span class="nt">--set</span> env.TZ<span class="o">=</span><span class="s2">"Asia/Seoul"</span> <span class="nt">--namespace</span> kube-system

<span class="c"># ì„¤ì¹˜ í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,pod,svc,ep <span class="nt">-n</span> kube-system <span class="nt">-l</span> app.kubernetes.io/instance<span class="o">=</span>kube-ops-view

<span class="c"># kube-ops-view ì ‘ì† URL í™•ì¸ (1.5 , 2 ë°°ìœ¨)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:30000/#scale=1.5"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:30000/#scale=2"</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_9.png" alt="img.png" /></p>

<ul>
  <li>worker ë…¸ë“œì— ì§„ì… í›„ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê²©ë¦¬ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [í„°ë¯¸ë„1] myk8s-worker bash ì§„ì… í›„ ì‹¤í–‰ ë° í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker bash
<span class="nt">----------------------------------</span>
<span class="nv">$ </span>systemctl list-unit-files | <span class="nb">grep</span> <span class="s1">'enabled         enabled'</span>
<span class="c"># =&gt; containerd.service                                                                    enabled         enabled</span>
<span class="c">#    kubelet.service                                                                       enabled         enabled</span>
<span class="c">#    ...</span>

<span class="c"># í™•ì¸ : kubeletì— --container-runtime-endpoint=unix:///run/containerd/containerd.sock</span>
<span class="nv">$ </span>pstree <span class="nt">-aln</span>
<span class="c"># =&gt; systemd</span>
<span class="c">#      |-systemd-journal</span>
<span class="c">#      |-containerd</span>
<span class="c">#      |   `-15*[{containerd}]</span>
<span class="c">#      |-kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --container-runtime-endpoint=unix:///run/containerd/containerd.sock --node-ip=172.20.0.3 --node-labels= --pod-infra-container-image=registry.k8s.io/pause:3.10 --provider-id=kind://docker/myk8s/myk8s-worker --runtime-cgroups=/system.slice/containerd.service</span>
<span class="c">#      |   `-13*[{kubelet}]</span>
<span class="c">#      |-containerd-shim -namespace k8s.io -id 3368a087d8af3e241201257993e178d6a7d8ea23d3148cdf2ec5392f9db49832 -address /run/containerd/containerd.sock</span>
<span class="c">#      |   |-11*[{containerd-shim}]</span>
<span class="c">#      |   |-pause</span>
<span class="c">#      |   `-kindnetd</span>
<span class="c">#      |       `-11*[{kindnetd}]</span>
<span class="c">#      |-containerd-shim -namespace k8s.io -id e983e9fcff0162dec6128e014ae9092454fe0fd748ba237320aec17fa85fb17b -address /run/containerd/containerd.sock</span>
<span class="c">#      |   |-11*[{containerd-shim}]</span>
<span class="c">#      |   |-pause</span>
<span class="c">#      |   `-kube-proxy --config=/var/lib/kube-proxy/config.conf --hostname-override=myk8s-worker</span>
<span class="c">#      |       `-8*[{kube-proxy}]</span>
<span class="c">#      `-containerd-shim -namespace k8s.io -id 9cdabafac520e373ff0efdbbbe8b87bdfd7a0d02bd897863b609eefc4ae21b36 -address /run/containerd/containerd.sock</span>
<span class="c">#          |-12*[{containerd-shim}]</span>
<span class="c">#          |-pause</span>
<span class="c">#          `-python3 /usr/local/bin/python3 -m kube_ops_view</span>
<span class="c">#              `-2*[{python3}]</span>
          
<span class="c"># í™•ì¸ : íŒŒë“œë‚´ì— pause ì»¨í…Œì´ë„ˆì™€ kube_ops_view ì»¨í…Œì´ë„ˆ, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì •ë³´</span>
<span class="nv">$ </span>pstree <span class="nt">-aclnpsS</span>
<span class="c"># =&gt; ...</span>
<span class="c">#      `-containerd-shim,1089 -namespace k8s.io -id 9cdabafac520e373ff0efdbbbe8b87bdfd7a0d02bd897863b609eefc4ae21b36 -address /run/containerd/contai</span>
<span class="c">#    nerd.sock</span>
<span class="c">#          |-{containerd-shim},1090</span>
<span class="c">#          ...</span>
<span class="c">#          |-pause,1110,ipc,mnt,net,pid,uts</span>
<span class="c">#          |-python3,1173,cgroup,ipc,mnt,net,pid,uts /usr/local/bin/python3 -m kube_ops_view</span>
<span class="c">#          ...</span>
<span class="c">#    ...</span>
      
<span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸ : lsns - List system namespaces</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="nv">$$</span>
<span class="c"># =&gt;         NS TYPE   NPROCS PID USER COMMAND</span>
<span class="c">#    4026531834 time       15   1 root /sbin/init</span>
<span class="c">#    4026531837 user       15   1 root /sbin/init</span>
<span class="c">#    4026532329 mnt         9   1 root /sbin/init</span>
<span class="c">#    4026532330 uts        13   1 root /sbin/init</span>
<span class="c">#    4026532338 ipc         9   1 root /sbin/init</span>
<span class="c">#    4026532339 pid         9   1 root /sbin/init</span>
<span class="c">#    4026532341 net        13   1 root /sbin/init</span>
<span class="c">#    4026532417 cgroup     13   1 root /sbin/init</span>

<span class="c"># íŒŒë“œì˜ pause ì»¨í…Œì´ë„ˆëŠ” ë…¸ë“œì˜ NSì™€ ë‹¤ë¥¸ 5ê°œì˜ NSë¥¼ ê°€ì§ : mnt/pid ëŠ” pasue ìì‹ ë§Œ ì‚¬ìš©, net/uts/ipcëŠ” app ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•´ì„œ ë¨¼ì € ìƒì„±í•´ë‘ </span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1797  <span class="c"># kube_ops_view íŒŒë“œì˜ pause ì»¨í…Œì´ë„ˆ</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    4026531834 time       15     1 root  /sbin/init</span>
<span class="c">#    4026531837 user       15     1 root  /sbin/init</span>
<span class="c">#    4026532417 cgroup     13     1 root  /sbin/init </span>
<span class="c">#    4026532805 net         2  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„  </span>
<span class="c">#    4026532883 mnt         1  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„</span>
<span class="c">#    4026532884 uts         2  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„</span>
<span class="c">#    4026532885 ipc         2  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„</span>
<span class="c">#    4026532886 pid         1  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„</span>

<span class="c"># app ì»¨í…Œì´ë„ˆ(kube_ops_view)ëŠ” í˜¸ìŠ¤íŠ¸NSì™€ ë‹¤ë¥¸ 6ê°œì˜ NSë¥¼ ê°€ì§ : mnt/pid/cgroup ëŠ” ìì‹ ë§Œ ì‚¬ìš©, net/uts/ipcëŠ” pause ì»¨í…Œì´ë„ˆê°€ ìƒì„±í•œ ê²ƒì„ ê³µìœ  ì‚¬ìš©í•¨</span>
<span class="nv">$ </span>pgrep <span class="nt">-f</span> kube_ops_view
<span class="c"># =&gt; 1173</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="si">$(</span>pgrep <span class="nt">-f</span> kube_ops_view<span class="si">)</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    4026531834 time       15     1 root  /sbin/init</span>
<span class="c">#    4026531837 user       15     1 root  /sbin/init</span>
<span class="c">#    4026532805 net         2  1110 65535 /pause      # pause ì»¨í…Œì´ë„ˆì™€ ê³µìœ </span>
<span class="c">#    4026532884 uts         2  1110 65535 /pause      # pause ì»¨í…Œì´ë„ˆì™€ ê³µìœ </span>
<span class="c">#    4026532885 ipc         2  1110 65535 /pause      # pause ì»¨í…Œì´ë„ˆì™€ ê³µìœ </span>
<span class="c">#    4026532887 mnt         1  1173 1000  /usr/bin/qemu-x86_64 /usr/local/bin/python3 -m kube_ops_view  # ìì‹ ë§Œ ì‚¬ìš©</span>
<span class="c">#    4026532888 pid         1  1173 1000  /usr/bin/qemu-x86_64 /usr/local/bin/python3 -m kube_ops_view  # ìì‹ ë§Œ ì‚¬ìš©</span>
<span class="c">#    4026532889 cgroup      1  1173 1000  /usr/bin/qemu-x86_64 /usr/local/bin/python3 -m kube_ops_view  # ìì‹ ë§Œ ì‚¬ìš©</span>
</code></pre></div></div>

<ul>
  <li>ìœ„ì™€ ê°™ì´ íŒŒë“œ ë‚´ë¶€ì˜ pause ì»¨í…Œì´ë„ˆì™€ kube_ops_view ì»¨í…Œì´ë„ˆëŠ” net, uts, ipc ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ê³µìœ í•˜ê³ , mnt, pid, cgroup ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ê°ê°ì˜ ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ë ‡ê²Œ pause ì»¨í…Œì´ë„ˆê°€ íŒŒë“œ ë‚´ë¶€ì˜ ì»¨í…Œì´ë„ˆë“¤ì´ ê³µìœ í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ìœ ì§€í•˜ëŠ” ì—­í• ì„ í•˜ëŠ”ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</li>
  <li>ë§ˆì§€ë§‰ìœ¼ë¡œ DINDë¥¼ ìœ„í•œ containerd.sock ê³¼ cgroup2fs, sys, proc ë“±ì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># containerd.sock ì •ë³´ í™•ì¸ (docker.sockê³¼ ë¹„ìŠ·í•œ ì—­í• )</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /run/containerd/containerd.sock
<span class="c"># =&gt; srw-rw---- 1 root root 0 Sep  7 15:20 /run/containerd/containerd.sock</span>

<span class="c"># íŠ¹ì • ì†Œì¼“ íŒŒì¼ì„ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>lsof /run/containerd/containerd.sock
<span class="c"># =&gt; COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF   NODE NAME</span>
<span class="c">#    container 106 root    9u  unix 0x0000000000000000      0t0 726698 /run/containerd/containerd.sock type=STREAM (LISTEN)</span>
<span class="c">#    container 106 root   11u  unix 0x0000000000000000      0t0 734691 /run/containerd/containerd.sock type=STREAM (CONNECTED)</span>
<span class="c">#    container 106 root   12u  unix 0x0000000000000000      0t0 738482 /run/containerd/containerd.sock type=STREAM (CONNECTED)</span>
<span class="c">#    container 106 root   14u  unix 0x0000000000000000      0t0 736712 /run/containerd/containerd.sock type=STREAM (CONNECTED)</span>

<span class="c"># /sys ë””ë ‰í„°ë¦¬ í™•ì¸</span>
<span class="nv">$ </span>findmnt <span class="nt">-A</span>
<span class="c"># =&gt; TARGET                                                  SOURCE                 FSTYPE    OPTIONS</span>
<span class="c">#    /                                                       overlay                overlay   rw,relatime,lowerdir=/var/lib/docker/overlay2/l/5UMBJJ</span>
<span class="c">#    ...</span>
<span class="c">#    |-/sys                                                  sysfs                  sysfs     ro,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | |-/sys/kernel/tracing                                 tracefs                tracefs   rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | |-/sys/kernel/debug                                   debugfs                debugfs   rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | |-/sys/fs/fuse/connections                            fusectl                fusectl   rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | |-/sys/kernel/config                                  configfs               configfs  rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | `-/sys/fs/cgroup                                      cgroup                 cgroup2   rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    ...</span>

<span class="c"># cgroup ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>findmnt <span class="nt">-t</span> cgroup2
<span class="c"># =&gt; TARGET         SOURCE FSTYPE  OPTIONS</span>
<span class="c">#    /sys/fs/cgroup cgroup cgroup2 rw,nosuid,nodev,noexec,relatime</span>
<span class="nv">$ </span><span class="nb">grep </span>cgroup /proc/filesystems
<span class="c"># =&gt; nodev	cgroup</span>
<span class="c">#    nodev	cgroup2</span>
<span class="nv">$ </span><span class="nb">stat</span> <span class="nt">-fc</span> %T /sys/fs/cgroup/
<span class="c"># =&gt; cgroup2fs</span>

<span class="nv">$ </span><span class="nb">exit</span>
<span class="nt">----------------------------------</span>
</code></pre></div></div>

<ul>
  <li>ì‹ ê·œíŒŒë“œë¥¼ ë°°í¬í•˜ê³  í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [í„°ë¯¸ë„2] kubectl ëª…ë ¹ ì‹¤í–‰ ë° í™•ì¸</span>

<span class="c"># Pod ìƒì„± : YAML íŒŒì¼ì— ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•  í¬íŠ¸(TCP 80)ì„ ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: myweb
spec:
  containers:
  - image: nginx:alpine
    name: myweb-container
    ports:
    - containerPort: 80
      protocol: TCP
  terminationGracePeriodSeconds: 0
</span><span class="no">EOF

</span><span class="c"># Pod ì •ë³´ í™•ì¸ : pause ì»¨í…Œì´ë„ˆ ì •ë³´ê°€ ë³´ì´ëŠ”ì§€ í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME    READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES</span>
<span class="c">#    myweb   1/1     Running   0          15s   10.244.1.3   myk8s-worker   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="nv">$ </span>kubectl describe pod myweb | <span class="nb">grep</span> <span class="nt">-i</span> pause
<span class="nv">$ </span>kubectl get pod myweb <span class="nt">-o</span> json | <span class="nb">grep</span> <span class="nt">-i</span> pause

<span class="nt">---</span>

<span class="c"># [í„°ë¯¸ë„1] myk8s-worker bash ì§„ì… í›„ ì‹¤í–‰ ë° í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker bash
<span class="nt">----------------------------------</span>
<span class="nv">$ </span>crictl ps
<span class="nv">$ </span>pstree <span class="nt">-aln</span>
<span class="nv">$ </span>pstree <span class="nt">-aclnpsS</span> <span class="c"># íŒŒë“œë‚´ì— pause ì»¨í…Œì´ë„ˆì™€ app ì»¨í…Œì´ë„ˆ, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì •ë³´</span>
<span class="c"># =&gt;   `-containerd-shim,1673 -namespace k8s.io -id 482ba93ecf76d46938d60e58f363e63e681d8a779439f270ff9c8417ad25a641 -address /run/containerd/containerd.sock</span>
<span class="c">#          |-{containerd-shim},1674</span>
<span class="c">#          ...</span>
<span class="c">#          |-pause,1693,ipc,mnt,net,pid,uts</span>
<span class="c">#          |-nginx,1754,cgroup,ipc,mnt,net,pid,uts</span>

<span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸ : lsns - List system namespaces</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="nv">$$</span>
<span class="c"># =&gt;         NS TYPE   NPROCS PID USER COMMAND</span>
<span class="c">#    4026531834 time       25   1 root /sbin/init</span>
<span class="c">#    4026531837 user       25   1 root /sbin/init</span>
<span class="c">#    4026532329 mnt        10   1 root /sbin/init</span>
<span class="c">#    4026532330 uts        14   1 root /sbin/init</span>
<span class="c">#    4026532338 ipc        10   1 root /sbin/init</span>
<span class="c">#    4026532339 pid        10   1 root /sbin/init</span>
<span class="c">#    4026532341 net        14   1 root /sbin/init</span>
<span class="c">#    4026532417 cgroup     15   1 root /sbin/init</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1693 
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    4026531834 time       25     1 root  /sbin/init</span>
<span class="c">#    4026531837 user       25     1 root  /sbin/init</span>
<span class="c">#    4026532417 cgroup     15     1 root  /sbin/init</span>
<span class="c">#    4026532891 net         9  1693 65535 /pause</span>
<span class="c">#    4026532969 mnt         1  1693 65535 /pause</span>
<span class="c">#    4026532970 uts         9  1693 65535 /pause</span>
<span class="c">#    4026532971 ipc         9  1693 65535 /pause</span>
<span class="c">#    4026532972 pid         1  1693 65535 /pause</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="si">$(</span>pgrep <span class="nt">-n</span> nginx<span class="si">)</span> <span class="c"># app ì»¨í…Œì´ë„ˆ(nginx)</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    4026531834 time       25     1 root  /sbin/init</span>
<span class="c">#    4026531837 user       25     1 root  /sbin/init</span>
<span class="c">#    4026532891 net         9  1693 65535 /pause</span>
<span class="c">#    4026532970 uts         9  1693 65535 /pause</span>
<span class="c">#    4026532971 ipc         9  1693 65535 /pause</span>
<span class="c">#    4026532973 mnt         8  1754 root  nginx: master process nginx -g daemon off;</span>
<span class="c">#    4026532974 pid         8  1754 root  nginx: master process nginx -g daemon off;</span>
<span class="c">#    4026532975 cgroup      8  1754 root  nginx: master process nginx -g daemon off;</span>
<span class="nt">----------------------------------</span>
<span class="c"># [í„°ë¯¸ë„2] kubectl ëª…ë ¹ ì‹¤í–‰ ë° í™•ì¸</span>
<span class="nv">$ </span>kubectl delete pod myweb
</code></pre></div></div>

<ul>
  <li>ìœ„ì™€ ê°™ì´ <code class="language-plaintext highlighter-rouge">kubectl</code>ê³¼ ê°™ì€ high-levelì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">pause</code> ì»¨í…Œì´ë„ˆê°€ ë³´ì´ì§€ ì•Šì§€ë§Œ, <code class="language-plaintext highlighter-rouge">ps</code>ë‚˜ <code class="language-plaintext highlighter-rouge">lsns</code>ì™€ ê°™ì€ OSì— ì ‘ê·¼ ê°€ëŠ¥í•œ ëª…ë ¹ìœ¼ë¡œëŠ” 
<code class="language-plaintext highlighter-rouge">pause</code> ì»¨í…Œì´ë„ˆê°€ í™•ì¸ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ëŠ” pause ì»¨í…Œì´ë„ˆëŠ” ê³µê¸°ì™€ ê°™ì´ í•­ìƒ íŒŒë“œì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— êµ³ì´ ë³´ì—¬ì¤˜ì„œ í™”ë©´ë§Œ ë³µì¡í•˜ê²Œ í•  ë¿ ë³´ì—¬ì¤„ í•„ìš”ê°€ ì—†ë‹¤ íŒë‹¨í•œê²ƒ ê°™ìŠµë‹ˆë‹¤.</li>
  <li>PAUSE Containerê°€ nsë¥¼ ê³µìœ í•˜ëŠ” íŠ¹ì„±ì„ ì´ìš©í•˜ì—¬,
ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ëŸ°íƒ€ì„ ì˜ì¡´ì„±ë§Œ í¬í•¨í•˜ëŠ” ìµœì†Œí™”ëœ ì´ë¯¸ì§€ê¸°ë°˜ ì»¨í…Œì´ë„ˆì¸ Distroless Containerë¥¼ ëŒ€ìƒìœ¼ë¡œ
Ephemeral Containersì™€ ê°™ì€ í˜•íƒœë¡œ ë””ë²„ê¹…ì— í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://kubernetes.io/docs/concepts/workloads/pods/ephemeral-containers/">Link</a></li>
</ul>

<h2 id="cni-container-network-interface">CNI (Container Network Interface)</h2>

<ul>
  <li>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” CNI(Container Network Interface)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. 
CNIëŠ” ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ê³¼ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì„ ì—°ê²°í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , IP ì£¼ì†Œë¥¼ í• ë‹¹í•˜ë©°,
ë„¤íŠ¸ì›Œí¬ ì •ì±…ì„ ì ìš©í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li>
  <li>CNIì˜ ì£¼ìš” ê¸°ëŠ¥
    <ul>
      <li><strong>ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ìƒì„±</strong>: CNI í”ŒëŸ¬ê·¸ì¸ì€ ì»¨í…Œì´ë„ˆì— ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(ì˜ˆ: ê°€ìƒ ì´ë”ë„· ì¥ì¹˜)ë¥¼ ìƒì„±í•˜ê³  ì»¨í…Œì´ë„ˆ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì´ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.</li>
      <li><strong>IP ì£¼ì†Œ í• ë‹¹</strong>: í”ŒëŸ¬ê·¸ì¸ì€ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì— IP ì£¼ì†Œë¥¼ í• ë‹¹í•˜ê³ , í•„ìš”ì— ë”°ë¼ IP ì£¼ì†Œ ê´€ë¦¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</li>
      <li><strong>ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš©</strong>: ë„¤íŠ¸ì›Œí¬ ì •ì±…ì„ í†µí•´ íŠ¸ë˜í”½ì„ ì œì–´í•  ìˆ˜ ìˆìœ¼ë©°, CNI í”ŒëŸ¬ê·¸ì¸ì€ ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
      <li><strong>ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ ì§€ì›</strong>: ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ì™€ ìš”êµ¬ ì‚¬í•­ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ(ì˜ˆ: ë¸Œë¦¬ì§€, VLAN, ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ ë“±)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>CNIì˜ ì‘ë™ ë°©ì‹
    <ul>
      <li>CNIëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í”ŒëŸ¬ê·¸ì¸ ê¸°ë°˜ êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë„êµ¬ëŠ” íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ CNI í”ŒëŸ¬ê·¸ì¸ì„ í˜¸ì¶œí•˜ì—¬ í•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ê° CNI í”ŒëŸ¬ê·¸ì¸ì€ JSON í˜•ì‹ì˜ êµ¬ì„± íŒŒì¼ë¡œ ì •ì˜ë˜ë©°, ì´ë¥¼ í†µí•´ í”ŒëŸ¬ê·¸ì¸ì˜ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>CNI í”ŒëŸ¬ê·¸ì¸ì˜ ì¢…ë¥˜ : CNI í”ŒëŸ¬ê·¸ì¸ì€ ë‹¤ì–‘í•œ ì¢…ë¥˜ê°€ ìˆìœ¼ë©°, ê°ê¸° ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí‚¹ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚µë‹ˆë‹¤. ëŒ€í‘œì ì¸ CNI í”ŒëŸ¬ê·¸ì¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
    <ul>
      <li><strong>Flannel</strong>: ê°„ë‹¨í•˜ê³  ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
      <li><strong>Calico</strong>: ë„¤íŠ¸ì›Œí¬ ì •ì±…ê³¼ ë³´ì•ˆì„ ê°•ì¡°í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ, ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬ ë° ì •ì±… ì ìš©ì— ê°•ì ì´ ìˆìŠµë‹ˆë‹¤.</li>
      <li><strong>Weave</strong>: ìë™ ë©”ì‰¬ ë„¤íŠ¸ì›Œí¬ì™€ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ ì œê³µí•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
      <li><strong>Cilium</strong>: ê³ ì„±ëŠ¥ BPF ê¸°ë°˜ ë„¤íŠ¸ì›Œí‚¹ ë° ë³´ì•ˆì„ ì œê³µí•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
      <li><strong>Multus</strong>: ì—¬ëŸ¬ CNI í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆì— ì—¬ëŸ¬ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§€ì›í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h3 id="4ê°€ì§€-ìš”êµ¬ì‚¬í•­ê³¼-4ê°€ì§€-ë¬¸ì œ">4ê°€ì§€ ìš”êµ¬ì‚¬í•­ê³¼ 4ê°€ì§€ ë¬¸ì œ</h3>

<p>ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ ëª¨ë¸ì€ 4ê°€ì§€ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•´ì•„í•˜ë©° 4ê°€ì§€ ë¬¸ì œë¥¼ í•´ê²°í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<ul>
  <li>4ê°€ì§€ ìš”êµ¬ì‚¬í•­
    <ol>
      <li>íŒŒë“œì™€ íŒŒë“œ ê°„ í†µì‹  ì‹œ NAT(Network Address Translation) ì—†ì´ í†µì‹ ì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>ë…¸ë“œì˜ ì—ì´ì „íŠ¸(ì˜ˆ) kubelet, ì‹œìŠ¤í…œ ë°ëª¬)ëŠ” Podì™€ í†µì‹ ì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” íŒŒë“œëŠ” NAT ì—†ì´ íŒŒë“œì™€ í†µì‹ ì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>ì„œë¹„ìŠ¤ í´ëŸ¬ìŠ¤í„° IP ëŒ€ì—­ê³¼ íŒŒë“œê°€ ì‚¬ìš©í•˜ëŠ” IP ëŒ€ì—­ì€ ì¤‘ë³µë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.</li>
    </ol>
  </li>
  <li>í•´ê²°í•´ì•¼ í•˜ëŠ” ë¬¸ì œ
    <ol>
      <li>íŒŒë“œ ë‚´ ì»¨í…Œì´ë„ˆëŠ” Loopbackì„ í†µí•œ í†µì‹ ì„ í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>íŒŒë“œ ê°„ í†µì‹ ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ Serviceë¥¼ í†µí•œ í†µì‹ ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œ Serviceë¥¼ í†µí•œ í†µì‹ ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
    </ol>
  </li>
</ul>

<p>ìœ„ì™€ ê°™ì€ ìš”êµ¬ì‚¬í•­ê³¼ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì›í™œí•œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ìœ„í•´ CNI(Container Network Interface)ë¥¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤.
CNI í”ŒëŸ¬ê·¸ì¸ë“¤ì€ ì´ëŸ¬í•œ ìš”êµ¬ì‚¬í•­ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_10.png" alt="img.png" class="image-center" />
<em class="image-caption">CNI í”ŒëŸ¬ê·¸ì¸ ë™ì‘ (ì¶œì²˜: ì¶”ê°€ì˜ˆì •)</em></p>

<p>Kubeletì„ í†µí•´ íŒŒë“œê°€ ì‹ ê·œ ìƒì„±ë  ë•Œ ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì„¤ì • ì¶”ê°€ í•„ìš”í•©ë‹ˆë‹¤. 
CNI í”ŒëŸ¬ê·¸ì¸ì€ ì „ë‹¬ë˜ëŠ” ì„¤ì • ì •ì˜ì„œë¥¼ ë³´ê³  ì‹¤ì œ íŒŒë“œê°€ í†µì‹ í•˜ê¸° ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ë“¤ì„ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.
ë˜í•œ CNI í”ŒëŸ¬ê·¸ì¸ì€ IPAM(IP Address Management), 
ì¦‰ IP í• ë‹¹ ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•´ì•¼ í•˜ë©°, íŒŒë“œ ê°„ í†µì‹ ì„ ìœ„í•œ ë¼ìš°íŒ… ì„¤ì •ì„ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<h2 id="flannel">Flannel</h2>

<ul>
  <li>Flannelì€ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•˜ê³  ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
  <li>Flannelì€ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ë¥¼ ìƒì„±í•˜ì—¬ íŒŒë“œ ê°„ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ë©°, VXLAN, UDP, Host-GW ë“±ì˜ ë°±ì—”ë“œë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ VXLAN ì‚¬ìš©ì´ ê¶Œì¥ë©ë‹ˆë‹¤.</li>
  <li>VXLANì€ Virtual eXtensible Local Area Networkì˜ ì•½ìë¡œ, ë¬¼ë¦¬ì ì¸ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œ  ë…¼ë¦¬ì ì¸ ê°€ìƒì˜ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ ë§Œë“¤ì–´ ì£¼ëŠ” ê²ƒìœ¼ë¡œ, UDP 8472Â  í¬íŠ¸ë¥¼ í†µí•´ ë…¸ë“œ ê°„ í„°ë„ë§ ê¸°ë²•ìœ¼ë¡œ í†µì‹ í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.Â </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_11.png" alt="img.png" class="image-center" />
<em class="image-caption">Flannel êµ¬ì¡° (ì¶œì²˜: ì¶”ê°€ì˜ˆì •)</em></p>

<ul>
  <li>ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™ì´ íŒŒë“œì˜ eth0 ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ëŠ” í˜¸ìŠ¤íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ veth ì¸í„°í˜ì´ìŠ¤ì™€ ì—°ê²°ë˜ê³ ,
vethëŠ” cni0ì™€ ì—°ê²°ë©ë‹ˆë‹¤.</li>
  <li>ì´ë¥¼ í†µí•´ ê°™ì€ ë…¸ë“œì—ì„œ í†µì‹ ì‹œ cni0 ë¸Œë¦¿ì§€ë¥¼ í†µí•´ì„œ í†µì‹ í•˜ê³ , ë‹¤ë¥¸ ë…¸ë“œì™€ í†µì‹ ì‹œ VXLANì„ í†µí•´ í†µì‹ í•©ë‹ˆë‹¤.</li>
  <li>VXLANìœ¼ë¡œ ê°€ëŠ” ê³¼ì •ì€ cni0 ë¸Œë¦¿ì§€ë¥¼ í†µí•´ flannel.1 ì¸í„°í˜ì´ìŠ¤ë¡œ ê°€ê³ , flannel.1ì€ í˜¸ìŠ¤íŠ¸ì˜ eth0ì„ í†µí•´ ë‹¤ë¥¸ ë…¸ë“œì— ì „ì†¡ì„ í•©ë‹ˆë‹¤.
ì´ë•Œ <strong>flannel.1ì€ VTEP(Vxlan Tunnel End Point)</strong>ë¼ê³  í•˜ë©° íŒ¨í‚·ì„ ê°ì‹¸ì„œ ëª©í‘œ nodeì˜ IPë¡œ ì „ì†¡í•˜ë©´, ëª©í‘œ nodeì—ì„œ ê°ì‹¼ íŒ¨í‚·ì„ í’€ì–´ì„œ 
í•´ë‹¹ íŒŒë“œì˜ IPë¡œ ë‹¤ì‹œ ë³´ë‚´ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li>
  <li>ê° ë…¸ë“œë§ˆë‹¤ íŒŒë“œì— í• ë‹¹í•  ìˆ˜ ìˆëŠ” IP ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ì´ ìˆê³ , flannelì„ í†µí•˜ì—¬ ETCDë‚˜ Kubernetes APIì— ì „ë‹¬ë˜ì–´, ëª¨ë“  ë…¸ë“œëŠ” í•´ë‹¹ ì •ë³´ë¥¼ ìì‹ ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì— ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
ì´ë¥¼ í†µí•´ ê°ê° ë‹¤ë¥¸ ë…¸ë“œì˜ íŒŒë“œë¼ë¦¬ë„ ë‚´ë¶€ IP ì£¼ì†Œë¥¼ í†µí•´ í†µì‹ ì´ ê°€ëŠ¥í•˜ê²Œ ë©ë‹ˆë‹¤.</li>
</ul>

<h3 id="kind-ì™€-flannel-ì„¤ì¹˜">Kind ì™€ Flannel ì„¤ì¹˜</h3>

<ul>
  <li>Kind í´ëŸ¬ìŠ¤í„°ì— Flannelì„ ì„¤ì¹˜í•´ë³´ê² ìŠµë‹ˆë‹¤. kindëŠ” ê¸°ë³¸ CNIë¡œ kindnetì„ ì‚¬ìš©í•˜ëŠ”ë° ì‹¤ìŠµì„ ìœ„í•´ kindnetì„ ë„ê³  í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">&gt; kind-cni.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  labels:
    mynode: control-plane
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
  - containerPort: 30002
    hostPort: 30002
  kubeadmConfigPatches:
  - |
    kind: ClusterConfiguration
    controllerManager:
      extraArgs:
        bind-address: 0.0.0.0
    etcd:
      local:
        extraArgs:
          listen-metrics-urls: http://0.0.0.0:2381
    scheduler:
      extraArgs:
        bind-address: 0.0.0.0
  - |
    kind: KubeProxyConfiguration
    metricsBindAddress: 0.0.0.0
- role: worker
  labels:
    mynode: worker
- role: worker
  labels:
    mynode: worker2
networking:
  disableDefaultCNI: true
</span><span class="no">EOF
</span><span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-cni.yaml <span class="nt">--name</span> myk8s <span class="nt">--image</span> kindest/node:v1.30.4

<span class="c"># ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>kind get clusters
<span class="nv">$ </span>kind get nodes <span class="nt">--name</span> myk8s
<span class="nv">$ </span>kubectl cluster-info

<span class="c"># ë„¤íŠ¸ì›Œí¬ í™•ì¸</span>
<span class="nv">$ </span>kubectl cluster-info dump | <span class="nb">grep</span> <span class="nt">-m</span> 2 <span class="nt">-E</span> <span class="s2">"cluster-cidr|service-cluster-ip-range"</span>

<span class="c"># ë…¸ë“œ í™•ì¸ : CRI</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-o</span> wide

<span class="c"># ë…¸ë“œ ë¼ë²¨ í™•ì¸</span>
<span class="nv">$ </span>kubectl get nodes myk8s-control-plane <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.metadata.labels<span class="o">}</span> | jq
...
<span class="s2">"mynode"</span>: <span class="s2">"control-plane"</span>,
...

<span class="nv">$ </span>kubectl get nodes myk8s-worker <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.metadata.labels<span class="o">}</span> | jq
<span class="nv">$ </span>kubectl get nodes myk8s-worker2 <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.metadata.labels<span class="o">}</span> | jq

<span class="c"># ì»¨í…Œì´ë„ˆ í™•ì¸ : ì»¨í…Œì´ë„ˆ ê°¯ìˆ˜, ì»¨í…Œì´ë„ˆ ì´ë¦„ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="nv">$ </span>docker port myk8s-control-plane
<span class="nv">$ </span>docker port myk8s-worker
<span class="nv">$ </span>docker port myk8s-worker2

<span class="c"># ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2  ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr

<span class="c">#</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump iputils-ping htop git nano -y'</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump iputils-ping -y'</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump iputils-ping -y'</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_12.png" alt="img.png" /></p>

<ul>
  <li>ë‹¤ìŒ ëª…ë ¹ì„ í†µí•´ bridge ì‹¤í–‰íŒŒì¼ì„ ìƒì„±í•´ì„œ ê° ì¸ìŠ¤í„´ìŠ¤ë§ˆë‹¤ ë°°í¬í•´ì•¼í•©ë‹ˆë‹¤. ë¨¼ì € ë‹¤ìŒê³¼ ê°™ì´ bridge íŒŒì¼ì„ ìƒí— í›„ ë¡œì»¬ì— ë³µì‚¬í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane bash
<span class="nt">---------------------------------------</span>
<span class="c"># ë¹Œë“œí™˜ê²½ êµ¬ì„±</span>
<span class="nv">$ </span>apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install </span>golang git <span class="nt">-y</span>
<span class="nv">$ </span>git clone https://github.com/containernetworking/plugins
<span class="nv">$ </span><span class="nb">cd </span>plugins
<span class="nv">$ </span><span class="nb">chmod</span> +x build_linux.sh

<span class="c"># ë¹Œë“œ</span>
<span class="nv">$ </span>./build_linux.sh

<span class="c"># íŒŒì¼ ê¶Œí•œ í™•ì¸ 755</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> bin
<span class="c"># =&gt; -rwxr-xr-x 1 root root  4471145 Sep  7 16:53 bridge</span>
<span class="c">#    ...</span>

<span class="nv">$ </span><span class="nb">exit</span>
<span class="nt">---------------------------------------</span>

<span class="c"># ìì‹ ì˜ PCì— ë³µì‚¬ : -a ê¶Œí•œ ë³´ì¡´í•˜ì—¬ ë³µì‚¬(755)</span>
<span class="nv">$ </span>docker <span class="nb">cp</span> <span class="nt">-a</span> myk8s-control-plane:/plugins/bin/bridge <span class="nb">.</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> bridge
<span class="c"># =&gt; .rwxr-xr-x root staff 4.3 MB Sun Sep  0 00:00:00 2024 bridge</span>
</code></pre></div></div>

<ul>
  <li>ì´ì œ Flannelì„ ì„¤ì¹˜í•˜ê² ìŠµë‹ˆë‹¤. í˜„ì¬ ê¸°ë³¸ CNI ì¸ kindnet ì—†ì´ ì„¤ì¹˜í–ˆê¸° ë•Œë¬¸ì— nodeê°€ not ready ìƒíƒœì—¬ì„œ ìŠ¤ì¼€ì¥´ë§ì´ ì•ˆ ë˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>watch <span class="nt">-d</span> kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>

<span class="c">#</span>
<span class="nv">$ </span>kubectl describe pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> k8s-app<span class="o">=</span>kube-dns | <span class="nb">grep </span>Events: <span class="nt">-A</span> 6
<span class="c"># =&gt; Events:</span>
<span class="c">#      Type     Reason            Age                  From               Message</span>
<span class="c">#      ----     ------            ----                 ----               -------</span>
<span class="c">#      Warning  FailedScheduling  19m                  default-scheduler  0/1 nodes are available: 1 node(s) had untolerated taint {node.kubernetes.io/not-ready: }. preemption: 0/1 nodes are available: 1 Preemption is not helpful for scheduling.</span>

<span class="c"># ê¸°ë³¸ CNI ì¸ kindnet ì—†ì´ ì„¤ì¹˜í–ˆê¸° ë•Œë¬¸ì— nodeê°€ not ready ìƒíƒœì—¬ì„œ ìŠ¤ì¼€ì¥´ë§ì´ ì•ˆ ë˜ê³  ìˆìŠµë‹ˆë‹¤.</span>

<span class="c"># Flannel cni ì„¤ì¹˜</span>
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
<span class="c"># =&gt; namespace/kube-flannel created</span>
<span class="c">#    clusterrole.rbac.authorization.k8s.io/flannel created</span>
<span class="c">#    clusterrolebinding.rbac.authorization.k8s.io/flannel created</span>
<span class="c">#    serviceaccount/flannel created</span>
<span class="c">#    configmap/kube-flannel-cfg created</span>
<span class="c">#    daemonset.apps/kube-flannel-ds created</span>

<span class="c"># namespace ì— pod-security.kubernetes.io/enforce=privileged Label í™•ì¸ </span>
<span class="nv">$ </span>kubectl get ns <span class="nt">--show-labels</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    kube-flannel         Active   60s   k8s-app=flannel,kubernetes.io/metadata.name=kube-flannel,pod-security.kubernetes.io/enforce=privileged</span>
<span class="nv">$ </span>kubectl get ds,pod,cm <span class="nt">-n</span> kube-flannel <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE    CONTAINERS     IMAGES                              SELECTOR</span>
<span class="c">#    daemonset.apps/kube-flannel-ds   3         3         3       3            3           &amp;lt;none&amp;gt;          100s   kube-flannel   docker.io/flannel/flannel:v0.25.6   app=flannel</span>
<span class="c">#    </span>
<span class="c">#    NAME                        READY   STATUS    RESTARTS   AGE    IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    pod/kube-flannel-ds-2l9p6   1/1     Running   0          100s   172.20.0.2   myk8s-worker2         &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    pod/kube-flannel-ds-67ftf   1/1     Running   0          100s   172.20.0.3   myk8s-worker          &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    pod/kube-flannel-ds-87wv8   1/1     Running   0          100s   172.20.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    </span>
<span class="c">#    NAME                         DATA   AGE</span>
<span class="c">#    configmap/kube-flannel-cfg   2      100s</span>
<span class="c">#    configmap/kube-root-ca.crt   1      100s</span>

<span class="c"># kube-flannel-dsê°€ daemonsetìœ¼ë¡œ ë…¸ë“œë§ˆë‹¤ ì‹¤í–‰ì¤‘ì¸ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>

<span class="nv">$ </span>kubectl describe cm <span class="nt">-n</span> kube-flannel kube-flannel-cfg

<span class="nv">$ </span>kubectl describe ds <span class="nt">-n</span> kube-flannel kube-flannel-ds

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> ds/kube-flannel-ds <span class="nt">-n</span> kube-flannel <span class="nt">-c</span> kube-flannel <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-l</span> /etc/kube-flannel


<span class="c"># failed to find plugin "bridge" in path [/opt/cni/bin]</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>
<span class="nv">$ </span>kubectl describe pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> k8s-app<span class="o">=</span>kube-dns
<span class="c"># =&gt; Warning  FailedCreatePodSandBox  2m16s                   kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox "b0023dea7d730b58cfea0163318641ff1d000d368f8ad3b552c53040b371388c": plugin type="flannel" failed (add): failed to delegate add: failed to find plugin "bridge" in path [/opt/cni/bin]</span>
<span class="c">#    Warning  FailedCreatePodSandBox  2m15s                   kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox "0454cbf9ae3c434f163865f6cd261ef2fa298a2de107471600195ebffa0b44cc": plugin type="flannel" failed (add): failed to delegate add: failed to find plugin "bridge" in path [/opt/cni/bin]</span>
</code></pre></div></div>

<ul>
  <li>í˜„ì¬ /opt/cni/bin/bridge íŒŒì¼ì´ ì—†ì–´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ bridge íŒŒì¼ì„ ë³µì‚¬í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># bridge íŒŒì¼ ë³µì‚¬</span>
<span class="nv">$ </span>docker <span class="nb">cp </span>bridge myk8s-control-plane:/opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">cp </span>bridge myk8s-worker:/opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">cp </span>bridge myk8s-worker2:/opt/cni/bin/bridge

<span class="c"># ê¶Œí•œ ë¶€ì—¬</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane  <span class="nb">chmod </span>755 /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker         <span class="nb">chmod </span>755 /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2        <span class="nb">chmod </span>755 /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane  <span class="nb">chown </span>root:root /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker         <span class="nb">chown </span>root:root /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2        <span class="nb">chown </span>root:root /opt/cni/bin/bridge

<span class="c"># bridge íŒŒì¼ì´ ì˜ ë³µì‚¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane  <span class="nb">ls</span> <span class="nt">-l</span> /opt/cni/bin/
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  <span class="nb">ls</span> <span class="nt">-l</span> /opt/cni/bin/
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 <span class="nb">ls</span> <span class="nt">-l</span> /opt/cni/bin/
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>myk8s-control-plane myk8s-worker myk8s-worker2<span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; node </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$i</span> <span class="nb">ls</span> /opt/cni/bin/<span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done
</span>bridge	flannel  host-local  loopback  portmap	ptp

<span class="c">#</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>
<span class="c"># =&gt; NAMESPACE            NAME                                          READY   STATUS    RESTARTS   AGE     IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    ...</span>
<span class="c">#    kube-system          coredns-7db6d8ff4d-hjmjf                      1/1     Running   0          29m     10.244.1.4   myk8s-worker2         &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          coredns-7db6d8ff4d-lfmzj                      1/1     Running   0          29m     10.244.1.3   myk8s-worker2         &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    ...</span>
</code></pre></div></div>

<h3 id="flannel-ì„¤ì¹˜-í™•ì¸">Flannel ì„¤ì¹˜ í™•ì¸</h3>

<ul>
  <li>Flannel ì„¤ì¹˜ í›„ corednsê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ Flannelì´ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl get ds,pod,cm <span class="nt">-n</span> kube-flannel <span class="nt">-owide</span>
<span class="c"># =&gt; &lt;span style="font-weight:bold;"&gt;NAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE   CONTAINERS     IMAGES                              SELECTOR&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;daemonset.apps/kube-flannel-ds&lt;/span&gt;   &lt;span style="color:teal;"&gt;3&lt;/span&gt;         &lt;span style="color:gray;"&gt;3&lt;/span&gt;         &lt;span style="color:teal;"&gt;3&lt;/span&gt;       &lt;span style="color:gray;"&gt;3&lt;/span&gt;            &lt;span style="color:teal;"&gt;3&lt;/span&gt;           &lt;span style="color:gray;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;          &lt;span style="color:teal;"&gt;13m&lt;/span&gt;   &lt;span style="color:gray;"&gt;kube-flannel&lt;/span&gt;   &lt;span style="color:teal;"&gt;docker.io/flannel/flannel:v0.25.6&lt;/span&gt;   &lt;span style="color:gray;"&gt;app=flannel&lt;/span&gt;</span>
<span class="c">#    </span>
<span class="c">#    &lt;span style="font-weight:bold;"&gt;NAME                        READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;pod/kube-flannel-ds-2l9p6&lt;/span&gt;   &lt;span style="color:teal;"&gt;1/1&lt;/span&gt;     &lt;span style="color:green;"&gt;Running&lt;/span&gt;   &lt;span style="color:teal;"&gt;0&lt;/span&gt;          &lt;span style="color:gray;"&gt;13m&lt;/span&gt;   &lt;span style="color:teal;"&gt;172.20.0.2&lt;/span&gt;   &lt;span style="color:gray;"&gt;myk8s-worker2&lt;/span&gt;         &lt;span style="color:teal;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;           &lt;span style="color:gray;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;pod/kube-flannel-ds-67ftf&lt;/span&gt;   &lt;span style="color:teal;"&gt;1/1&lt;/span&gt;     &lt;span style="color:green;"&gt;Running&lt;/span&gt;   &lt;span style="color:teal;"&gt;0&lt;/span&gt;          &lt;span style="color:gray;"&gt;13m&lt;/span&gt;   &lt;span style="color:teal;"&gt;172.20.0.3&lt;/span&gt;   &lt;span style="color:gray;"&gt;myk8s-worker&lt;/span&gt;          &lt;span style="color:teal;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;           &lt;span style="color:gray;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;pod/kube-flannel-ds-87wv8&lt;/span&gt;   &lt;span style="color:teal;"&gt;1/1&lt;/span&gt;     &lt;span style="color:green;"&gt;Running&lt;/span&gt;   &lt;span style="color:teal;"&gt;0&lt;/span&gt;          &lt;span style="color:gray;"&gt;13m&lt;/span&gt;   &lt;span style="color:teal;"&gt;172.20.0.4&lt;/span&gt;   &lt;span style="color:gray;"&gt;myk8s-control-plane&lt;/span&gt;   &lt;span style="color:teal;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;           &lt;span style="color:gray;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;</span>
<span class="c">#    </span>
<span class="c">#    &lt;span style="font-weight:bold;"&gt;NAME                         DATA   AGE&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;configmap/kube-flannel-cfg&lt;/span&gt;   &lt;span style="color:teal;"&gt;2&lt;/span&gt;      &lt;span style="color:gray;"&gt;13m&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;configmap/kube-root-ca.crt&lt;/span&gt;   &lt;span style="color:teal;"&gt;1&lt;/span&gt;      &lt;span style="color:gray;"&gt;13m&lt;/span&gt;</span>

<span class="nv">$ </span>kubectl describe cm <span class="nt">-n</span> kube-flannel kube-flannel-cfg

<span class="c"># iptables ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>filter nat mangle raw <span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; IPTables Type : </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane  iptables <span class="nt">-t</span> <span class="nv">$i</span> <span class="nt">-S</span> <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>filter nat mangle raw <span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; IPTables Type : </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  iptables <span class="nt">-t</span> <span class="nv">$i</span> <span class="nt">-S</span> <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>filter nat mangle raw <span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; IPTables Type : </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 iptables <span class="nt">-t</span> <span class="nv">$i</span> <span class="nt">-S</span> <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>

<span class="c"># flannel ì •ë³´ í™•ì¸ : ëŒ€ì—­, MTU</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>myk8s-control-plane myk8s-worker myk8s-worker2<span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; node </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$i</span> <span class="nb">cat</span> /run/flannel/subnet.env <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; &gt;&gt; node myk8s-control-plane &lt;&lt;</span>
<span class="c">#    FLANNEL_NETWORK=10.244.0.0/16</span>
<span class="c">#    FLANNEL_SUBNET=10.244.0.1/24</span>
<span class="c">#    FLANNEL_MTU=1450</span>
<span class="c">#    FLANNEL_IPMASQ=true</span>
<span class="c">#    ...</span>

<span class="c"># ë…¸ë“œë§ˆë‹¤ í• ë‹¹ëœ dedicated subnet (podCIDR) í™•ì¸</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[*].spec.podCIDR}'</span> <span class="p">;</span><span class="nb">echo</span>
<span class="c"># =&gt; 10.244.0.0/24 10.244.2.0/24 10.244.1.0/24</span>

<span class="c"># ë…¸ë“œ ì •ë³´ ì¤‘ flannel ê´€ë ¨ ì •ë³´ í™•ì¸ : VXLAN ëª¨ë“œ ì •ë³´ì™€, VTEP ì •ë³´(ë…¸ë“œ IP, VtepMac) ë¥¼ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe node | <span class="nb">grep</span> <span class="nt">-A3</span> Annotations
<span class="c"># =&gt; Annotations:        flannel.alpha.coreos.com/backend-data: {&amp;quot;VNI&amp;quot;:1,&amp;quot;VtepMAC&amp;quot;:&amp;quot;6e:0e:72:1e:72:1d&amp;quot;}</span>
<span class="c">#                        flannel.alpha.coreos.com/backend-type: vxlan</span>
<span class="c">#                        flannel.alpha.coreos.com/kube-subnet-manager: true</span>
<span class="c">#                        flannel.alpha.coreos.com/public-ip: 172.20.0.4</span>
<span class="c">#    --</span>
<span class="c">#    Annotations:        flannel.alpha.coreos.com/backend-data: {&amp;quot;VNI&amp;quot;:1,&amp;quot;VtepMAC&amp;quot;:&amp;quot;ca:de:a3:b8:65:d8&amp;quot;}</span>
<span class="c">#                        flannel.alpha.coreos.com/backend-type: vxlan</span>
<span class="c">#                        flannel.alpha.coreos.com/kube-subnet-manager: true</span>
<span class="c">#                        flannel.alpha.coreos.com/public-ip: 172.20.0.3</span>
<span class="c">#    --</span>
<span class="c">#    Annotations:        flannel.alpha.coreos.com/backend-data: {&amp;quot;VNI&amp;quot;:1,&amp;quot;VtepMAC&amp;quot;:&amp;quot;1e:1e:b1:15:9e:d3&amp;quot;}</span>
<span class="c">#                        flannel.alpha.coreos.com/backend-type: vxlan</span>
<span class="c">#                        flannel.alpha.coreos.com/kube-subnet-manager: true</span>
<span class="c">#                        flannel.alpha.coreos.com/public-ip: 172.20.0.2</span>

<span class="c"># ê° ë…¸ë“œ(?) ë§ˆë‹¤ bash ì§„ì… í›„ ì•„ë˜ ê¸°ë³¸ ì •ë³´ í™•ì¸ : ë¨¼ì € worker ë¶€í„° bash ì§„ì… í›„ í™•ì¸í•˜ì</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker        bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2       bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane bash
<span class="nt">----------------------------------------</span>
<span class="c"># í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ NSì™€ flannel, kube-proxy ì»¨í…Œì´ë„ˆì˜ ë„¤íŠ¸ì›Œí¬ NS ë¹„êµ =&gt; ëª¨ë‘ ë™ì¼í•œ NSë¥¼ ê°€ì§‘ë‹ˆë‹¤. </span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1
<span class="c"># =&gt;         NS TYPE   NPROCS PID USER COMMAND</span>
<span class="c">#    ...</span>
<span class="c">#    4026532344 net        12   1 root /sbin/init</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="si">$(</span>pgrep flanneld<span class="si">)</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    ...</span>
<span class="c">#    4026532344 net        12     1 root  /sbin/init</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="si">$(</span>pgrep kube-proxy<span class="si">)</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    ...</span>
<span class="c">#    4026532344 net        12     1 root  /sbin/init</span>

<span class="c"># ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nt">-br</span> addr
<span class="c"># =&gt; lo               UNKNOWN        127.0.0.1/8 ::1/128</span>
<span class="c">#    flannel.1        UNKNOWN        10.244.2.0/32</span>
<span class="c">#    eth0@if37        UP             172.20.0.3/16 fc00:f853:ccd:e793::3/64 fe80::42:acff:fe14:3/64</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nb">link</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'flannel|cni|veth'</span> <span class="nt">-A1</span>
<span class="c"># =&gt; 4: flannel.1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default</span>
<span class="c">#       link/ether ca:de:a3:b8:65:d8 brd ff:ff:ff:ff:ff:ff</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> addr
<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nt">-d</span> addr show cni0     <span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê²©ë¦¬ íŒŒë“œê°€ 1ê°œ ì´ìƒ ë°°ì¹˜ ì‹œ í™•ì¸ë¨</span>
<span class="c"># =&gt; (ê³µë°±)</span>

<span class="c"># í˜„ì¬ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê²©ë¦¬ëœ íŒŒë“œê°€ ì—†ì–´ì„œ cni0 ì¸í„°í˜ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</span>

<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nt">-d</span> addr show flannel.1
<span class="c"># =&gt; 4: flannel.1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN group default</span>
<span class="c">#        link/ether ca:de:a3:b8:65:d8 brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535</span>
<span class="c">#        vxlan id 1 local 172.20.0.3 dev eth0 srcport 0 0 dstport 8472 nolearning ttl auto ageing 300 udpcsum noudp6zerocsumtx noudp6zerocsumrx numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535</span>
<span class="c">#        inet 10.244.2.0/32 scope global flannel.1</span>
<span class="c">#           valid_lft forever preferred_lft forever</span>
    
<span class="nv">$ </span>brctl show
<span class="c"># =&gt; (ê³µë°±)</span>

<span class="c"># ë¼ìš°íŒ… ì •ë³´ í™•ì¸ : ë‹¤ë¥¸ ë…¸ë“œì˜ íŒŒë“œ ëŒ€ì—­(podCIDR)ì˜ ë¼ìš°íŒ… ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì–´ ìˆìŒì„ í™•ì¸		</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> route
<span class="c"># =&gt; default via 172.20.0.1 dev eth0</span>
<span class="c">#    10.244.0.0/24 via 10.244.0.0 dev flannel.1 onlink</span>
<span class="c">#    10.244.1.0/24 via 10.244.1.0 dev flannel.1 onlink</span>
<span class="c">#    172.20.0.0/16 dev eth0 proto kernel scope link src 172.20.0.3</span>

<span class="c"># flannel.1 ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ARP í…Œì´ë¸” ì •ë³´ í™•ì¸ : ë‹¤ë¥¸ ë…¸ë“œì˜ flannel.1 IPì™€ MAC ì •ë³´ë¥¼ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> neigh show dev flannel.1
<span class="c"># =&gt; 10.244.1.0 lladdr 1e:1e:b1:15:9e:d3 PERMANENT</span>
<span class="c">#    10.244.0.0 lladdr 6e:0e:72:1e:72:1d PERMANENT</span>

<span class="c"># ë¸Œë¦¬ì§€ fdb ì •ë³´ì—ì„œ í•´ë‹¹ MAC ì£¼ì†Œì™€ í†µì‹  ì‹œ ê° ë…¸ë“œì˜ enp0s8 </span>
<span class="nv">$ </span>bridge fdb show dev flannel.1
<span class="c"># =&gt; 6e:0e:72:1e:72:1d dst 172.20.0.4 self permanent</span>
<span class="c">#    1e:1e:b1:15:9e:d3 dst 172.20.0.2 self permanent</span>

<span class="c"># ë‹¤ë¥¸ ë…¸ë“œì˜ flannel.1 ì¸í„°í˜ì´ìŠ¤ë¡œ ping í†µì‹  : VXLAN ì˜¤ë²„ë ˆì´ë¥¼ í†µí•´ì„œ í†µì‹ </span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 10.244.0.0
<span class="c"># =&gt; ...</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 10.244.1.0
<span class="c"># =&gt; ...</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 10.244.2.0
<span class="c"># =&gt; ...</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>

<span class="c"># ë‹¤ë¥¸ ë…¸ë“œì™€ VXLANì„ í†µí•´ì„œ ì˜ í†µì‹  ë©ë‹ˆë‹¤.</span>

<span class="c"># iptables í•„í„° í…Œì´ë¸” ì •ë³´ í™•ì¸ : íŒŒë“œì˜ 10.244.0.0/16 ëŒ€ì—­ ë¼ë¦¬ëŠ” ëª¨ë“  ë…¸ë“œì—ì„œ ì „ë‹¬ì´ ê°€ëŠ¥</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span> | <span class="nb">grep </span>10.244.0.0
<span class="c"># =&gt; -A FLANNEL-FWD -s 10.244.0.0/16 -m comment --comment "flanneld forward" -j ACCEPT</span>
<span class="c">#    -A FLANNEL-FWD -d 10.244.0.0/16 -m comment --comment "flanneld forward" -j ACCEPT</span>

<span class="c"># iptables NAT í…Œì´ë¸” ì •ë³´ í™•ì¸ : 10.244.0.0/16 ëŒ€ì—­ ë¼ë¦¬ í†µì‹ ì€ ë§ˆìŠ¤ì»¤ë ˆì´ë”© ì—†ì´ í†µì‹ ì„ í•˜ë©°,</span>
<span class="c"># 10.244.0.0/16 ëŒ€ì—­ì—ì„œ ë™ì¼ ëŒ€ì—­(10.244.0.0/16)ê³¼ ë©€í‹°ìºìŠ¤íŠ¸ ëŒ€ì—­(224.0.0.0/4) ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ (ì™¸ë¶€) í†µì‹  ì‹œì—ëŠ” ë§ˆìŠ¤ì»¤ë ˆì´ë”©ì„ ìˆ˜í–‰</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-S</span> | <span class="nb">grep</span> <span class="s1">'flanneld masq'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'! -s'</span>
<span class="c"># =&gt; -A POSTROUTING -m comment --comment "flanneld masq" -j FLANNEL-POSTRTG</span>
<span class="c">#    -A FLANNEL-POSTRTG -m mark --mark 0x4000/0x4000 -m comment --comment "flanneld masq" -j RETURN</span>
<span class="c">#    -A FLANNEL-POSTRTG -s 10.244.2.0/24 -d 10.244.0.0/16 -m comment --comment "flanneld masq" -j RETURN</span>
<span class="c">#    -A FLANNEL-POSTRTG -s 10.244.0.0/16 -d 10.244.2.0/24 -m comment --comment "flanneld masq" -j RETURN</span>
<span class="c">#    -A FLANNEL-POSTRTG -s 10.244.0.0/16 ! -d 224.0.0.0/4 -m comment --comment "flanneld masq" -j MASQUERADE --random-fully</span>

<span class="nt">----------------------------------------</span>
</code></pre></div></div>

<ul>
  <li>íŒŒë“œ 2ê°œë¥¼ ìƒì„±í•´ì„œ CNI ë„¤íŠ¸ì›Œí¬ ë¸Œë¦¬ì§€ì˜ ì •ë³´ë¥¼  í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [í„°ë¯¸ë„1,2] ì›Œì»¤ ë…¸ë“œ1,2 - ëª¨ë‹ˆí„°ë§</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 bash
<span class="nt">-----------------------------</span>
<span class="nv">$ </span>watch <span class="nt">-d</span> <span class="s2">"ip link | egrep 'cni|veth' ;echo; brctl show cni0"</span>
<span class="nt">-----------------------------</span>

<span class="c"># [í„°ë¯¸ë„3] cat &amp; here document ëª…ë ¹ ì¡°í•©ìœ¼ë¡œ ì¦‰ì„(?) ë¦¬ì†ŒìŠ¤ ìƒì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl create -f -
apiVersion: v1
kind: Pod
metadata:
  name: pod-1
  labels:
    app: pod
spec:
  nodeSelector:
    kubernetes.io/hostname: myk8s-worker
  containers:
  - name: netshoot-pod
    image: nicolaka/netshoot
    command: ["tail"]
    args: ["-f", "/dev/null"]
  terminationGracePeriodSeconds: 0
---
apiVersion: v1
kind: Pod
metadata:
  name: pod-2
  labels:
    app: pod
spec:
  nodeSelector:
    kubernetes.io/hostname: myk8s-worker2
  containers:
  - name: netshoot-pod
    image: nicolaka/netshoot
    command: ["tail"]
    args: ["-f", "/dev/null"]
  terminationGracePeriodSeconds: 0
</span><span class="no">EOF

</span><span class="c"># íŒŒë“œ í™•ì¸ : IP í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-o</span> wide
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_13.png" alt="img.png" /></p>

<ul>
  <li>CNI ê°€ ì—†ì—ˆëŠ”ë° íŒŒë“œ íŒ¨í¬í›„ CNI ë„¤íŠ¸ì›Œí¬ ë¸Œë¦¬ì§€ê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë³´ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 bash
<span class="nt">-----------------------------</span>
<span class="c"># ë¸Œë¦¬ì§€ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>brctl show cni0

<span class="c"># ë¸Œë¦¬ì§€ ì—°ê²° ë§í¬(veth) í™•ì¸</span>
<span class="nv">$ </span>bridge <span class="nb">link</span>

<span class="c"># ë¸Œë¦¬ì§€ VLAN ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>bridge vlan

<span class="c"># cbr(custom bridge) ì •ë³´ : kubenet CNIì˜ bridge - ë§í¬</span>
<span class="nv">$ </span>tree /var/lib/cni/networks/cbr0

<span class="c"># ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì •ë³´ë“¤ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> addr | <span class="nb">grep </span>veth <span class="nt">-A3</span>
<span class="nt">-----------------------------</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_14.png" alt="img.png" /></p>

<h3 id="í†µì‹ -íë¦„-ì´í•´">í†µì‹  íë¦„ ì´í•´</h3>

<ul>
  <li>Flannel ê¸°ë°˜ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì¶•í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¸ê°€ì§€ì˜ í†µì‹  ì‹œë‚˜ë¦¬ì˜¤ê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ol>
      <li>ë™ì¼ ë…¸ë“œì—ì„œ íŒŒë“œê°„ í†µì‹ í•˜ëŠ” ê²½ìš°
  <img src="/assets/2024/kans-3th/w2/20240907_kans_w2_15.png" alt="img.png" class="image-center" /></li>
      <li>íŒŒë“œì—ì„œ ì™¸ë¶€ì™€ í†µì‹ í•˜ëŠ” ê²½ìš°
  <img src="/assets/2024/kans-3th/w2/20240907_kans_w2_16.png" alt="img_1.png" class="image-center" /></li>
      <li>ì„œë¡œë‹¤ë¥¸ ë…¸ë“œì—ì„œ íŒŒë“œê°„ í†µì‹ í•˜ëŠ” ê²½ìš°
  <img src="/assets/2024/kans-3th/w2/20240907_kans_w2_17.png" alt="img_2.png" class="image-center" /></li>
    </ol>
  </li>
</ul>

<p>íŒŒë“œ ê°„ í†µì‹ , ì„œë¡œë‹¤ë¥¸ ë…¸ë“œì˜ íŒŒë“œê°„ í†µì‹ , ì™¸ë¶€ í†µì‹  ì—¬ë¶€ì— ëŒ€í•´ ì‚´í´ë³´ê³ , í†µì‹ ì´ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì˜ íŒ¨í‚·ì„ ìº¡ì²˜í•˜ë©´ì„œ Flannel networkì— ëŒ€í•´ ì´í•´í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> pod-1 <span class="nt">--</span> zsh
<span class="nt">-----------------------------</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> addr show eth0

<span class="c"># GW IPëŠ” ì–´ë–¤ ì¸í„°í˜ì´ìŠ¤ì¸ê°€? =&gt; cni0</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> route
<span class="nv">$ </span>route <span class="nt">-n</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 &lt;GW IP&gt;
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 &lt;pod-2 IP&gt;  <span class="c"># ë‹¤ë¥¸ ë…¸ë“œì— ë°°í¬ëœ íŒŒë“œ í†µì‹  í™•ì¸</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 8.8.8.8     <span class="c"># ì™¸ë¶€ ì¸í„°ë„· IP   ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>curl <span class="nt">-s</span> wttr.in/Seoul <span class="c"># ì™¸ë¶€ ì¸í„°ë„· ë„ë©”ì¸ ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> neigh
<span class="nv">$ </span><span class="nb">exit</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_18.png" alt="img.png" /></p>

<ul>
  <li>ì„œë¡œë‹¤ë¥¸ ë…¸ë“œê°„ íŒŒë“œì˜ í†µì‹ , ì™¸ë¶€ì™€ì˜ í†µì‹  ë“±ì´ ëª¨ë‘ ì˜ í†µì‹  ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ë²ˆì—ëŠ” ê° ë…¸ë“œì˜ cni0ì—ì„œ íŒ¨í‚· ìº¡ì³ë¥¼ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [í„°ë¯¸ë„1,2] ì›Œì»¤ ë…¸ë“œ1,2</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 bash
<span class="nt">-----------------------------</span>
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> cni0 <span class="nt">-nn</span> icmp
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> flannel.1 <span class="nt">-nn</span> icmp
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> eth0 <span class="nt">-nn</span> icmp
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> eth0 <span class="nt">-nn</span> udp port 8472 <span class="nt">-w</span> /root/vxlan.pcap 
<span class="c"># CTRL+C ì·¨ì†Œ í›„ í™•ì¸ : ls -l /root/vxlan.pcap</span>

<span class="nv">$ </span>conntrack <span class="nt">-L</span> | <span class="nb">grep</span> <span class="nt">-i</span> icmp
<span class="nt">-----------------------------</span>

<span class="c"># [í„°ë¯¸ë„3]</span>
<span class="nv">$ </span>docker <span class="nb">cp </span>myk8s-worker:/root/vxlan.pcap <span class="nb">.</span>
<span class="nv">$ </span>wireshark vxlan.pcap
</code></pre></div></div>

<ul>
  <li>Pod-1 =&gt; Pod-2 (cni0 ê´€ì )
    <ul>
      <li>ë¸Œë¦¿ì§€ë¥¼ í†µí•´ ê°ê° ì˜¤ê°€ëŠ” íŒ¨í‚·ì´ ì˜ ë³´ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_19.png" alt="img.png" /></p>

<ul>
  <li>Pod-1 =&gt; ì™¸ë¶€ (cni0 ê´€ì )
    <ul>
      <li>ê°™ì€ ë…¸ë“œì—ì„œëŠ” íŒ¨í‚·ì´ ì™¸ë¶€ë¡œ ë‚˜ê°”ë‹¤ ì˜¤ëŠ”ê²ƒì´ ì˜ ë³´ì…ë‹ˆë‹¤.</li>
      <li>í•˜ì§€ë§Œ ë‹¤ë¥¸ ë…¸ë“œ (worker2)ì—ì„œëŠ” ì™¸ë¶€ì™€ ì˜¤ê°€ëŠ” íŒ¨í‚·ì´ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_20.png" alt="img.png" /></p>

<ul>
  <li>Pod-1 =&gt; Pod-2 (flannel.1 ê´€ì )
    <ul>
      <li>flannel.1ì„ í†µí•´ ê°ê° ì˜¤ê°€ëŠ” íŒ¨í‚·ì´ ì˜ ë³´ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_21.png" alt="img.png" /></p>

<ul>
  <li>Pod-1 -&gt; ì™¸ë¶€ (flannel.1 ê´€ì )
    <ul>
      <li>ì•ì„  ê·¸ë¦¼ì—ì„œ ë³´ì•˜ë“¯ ì™¸ë¶€ì™€ í†µì‹ ì‹œ VTEPì¸ flannel.1ì„ ê±°ì¹˜ì§€ ì•Šê³  cni0ì—ì„œ í˜¸ìŠ¤íŠ¸ì˜ eth0ë¡œ ë°”ë¡œ ë‚˜ê°€ê¸° ë•Œë¬¸ì— íŒ¨í‚·ì´ ìº¡ì³ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_22.png" alt="img.png" /></p>

<ul>
  <li>Pod 1 -&gt; Pod 2 (eth0 ê´€ì )
    <ul>
      <li>eth0ì—ì„œ ë´¤ì„ë•ŒëŠ” ìº¡ì³ê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ìœ ëŠ” flannel.1ì„ í†µí•´ tcp íŒ¨í‚·ì´ ìº¡ìŠí™” ë˜ì–´ udp 8472ë¡œ eth0ë¥¼ í†µí•´ ì „ë‹¬ë˜ê¸° ë•Œë¬¸ì—
<code class="language-plaintext highlighter-rouge">-nn icmp</code> ì˜µì…˜ìœ¼ë¡œ icmp íŒ¨í‚· (ping)ë§Œ ìº¡ì³í• ë•ŒëŠ” ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_23.png" alt="img.png" /></p>

<ul>
  <li>Pod 1 -&gt; Pod 2 (eth0 ê´€ì , udp port 8472 ë¤í”„)
    <ul>
      <li>udp íŒ¨í‚·ì„ ìº¡ì³í•˜ì—¬ wiresharkë¡œ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_25.png" alt="img.png" /></p>

<ul>
  <li>udp 8472 í¬íŠ¸ë¥¼ í†µí•´ icmp (ping)ì´ ì˜¤ê°€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (8472ëŠ” VXLAN í¬íŠ¸ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì˜µì…˜ì—ì„œ VXLANì„ ì§€ì •í•´ì•¼ ë³´ì…ë‹ˆë‹¤.)</li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_26.png" alt="img_1.png" /></p>

<ul>
  <li>Pod 1 -&gt; 8.8.8.8(ì™¸ë¶€) (eth0 ê´€ì )
    <ul>
      <li>eth0ì—ì„œ ì™¸ë¶€ì™€ í†µì‹ í•˜ëŠ” íŒ¨í‚·ì´ ê°™ì€ ë…¸ë“œì—ì„œëŠ” ë³´ì´ê³ , ë‹¤ë¥¸ ë…¸ë“œì—ì„œëŠ” ì•ˆ ë³´ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_24.png" alt="img.png" /></p>

<hr />

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì´ë²ˆì£¼ì—ë„ ë§ì€ ë‚´ìš©ë“¤ì„ ìŠ¤í„°ë””í•´ë³´ì•˜ìŠµë‹ˆë‹¤. 
KINDë¥¼ ì•Œê²Œë˜ì–´ì„œ ì°¸ ì¢‹ì•˜ë˜ê²ƒ ê°™ìŠµë‹ˆë‹¤. 
ê¸°ì¡´ì— ì‚¬ë‚´ êµìœ¡ì„ ìœ„í•´ì„œ kubernetesë¥¼ ì„¤ì¹˜í•˜ë ¤ë©´ ê°–ì€ ì–´ë ¤ì›€ì´ ìˆì—ˆëŠ”ë°
dockerë§Œ ìˆìœ¼ë©´ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ ì°¸ ì¢‹ì€ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ë§‰ì—°í•˜ê²Œ ì•Œê³  ìˆì—ˆë˜ ë…¸ë“œê°„ì˜ íŒŒë“œì˜ í†µì‹ ì— ëŒ€í•´ì„œ ì•Œê²Œë˜ì—ˆê³ ,
ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ìš´ì˜ì¤‘ ë„¤íŠ¸ì›Œí¬ ì¥ì• ì— ëŒ€í•´ 1ì£¼ì°¨ ìŠ¤í„°ë””ì™€ ì´ë²ˆ ìŠ¤í„°ë””ë¥¼ í†µí•´
ìì‹ ê°ì´ ì¡°ê¸ˆ ìƒê²¼ìŠµë‹ˆë‹¤.
ë‚¨ì€ ìŠ¤í„°ë””ë„ ì—´ì‹¬íˆí•´ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´ ì¡°ê¸ˆ ì•„ëŠ” ì‚¬ëŒì´ ë˜ì–´ë³´ê² ìŠµë‹ˆë‹¤.</p>]]></content><author><name></name></author><category term="kans" /><category term="kubernetes," /><category term="network," /><category term="linux" /><summary type="html"><![CDATA[ì§€ë‚œì£¼ì— ì´ì–´ ì´ë²ˆì£¼ì—ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ëŒ€í•´ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ê³  KIND, PAUSE ì»¨í…Œì´ë„ˆì™€ Flannel CNIì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[KANS 3ê¸°] ì»¨í…Œì´ë„ˆ ê²©ë¦¬</title><link href="https://sweetlittlebird.github.io/posts/2024-08-27-KANS-Study-Week1/" rel="alternate" type="text/html" title="[KANS 3ê¸°] ì»¨í…Œì´ë„ˆ ê²©ë¦¬" /><published>2024-08-27T22:50:18+09:00</published><updated>2024-08-27T22:50:18+09:00</updated><id>https://sweetlittlebird.github.io/posts/KANS%20Study%20-%20Week1</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-08-27-KANS-Study-Week1/"><![CDATA[<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì§€ë‚œ í…Œë¼í¼ ìŠ¤í„°ë””ì— ì´ì–´ ì´ë²ˆ ì£¼ ë¶€í„° KANS ìŠ¤í„°ë””ë¥¼ ì‹œì‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤!
KANSëŠ” <strong>K</strong>ubernetes <strong>A</strong>dvanced <strong>N</strong>etworking <strong>S</strong>tudyì˜ ì¤„ì„ë§ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤íŠ¸ì›Œí‚¹ì— ëŒ€í•œ ì‹¬ë„ìˆê²Œ ê³µë¶€í•˜ëŠ” ìŠ¤í„°ë””ì…ë‹ˆë‹¤.
ì´ë²ˆ ìŠ¤í„°ë””ë„ ê³¼ì œí•  ê±±ì •ë„ :sweat: ë˜ì§€ë§Œ ì¬ë¯¸ìˆì„ê²ƒ ê°™ì•„ ê¸°ëŒ€ë©ë‹ˆë‹¤. :smile:</p>

<p>ì²« ì£¼ ìŠ¤í„°ë””ë„ ì»¨í…Œì´ë„ˆ ê²©ë¦¬ì™€ ë¦¬ëˆ…ìŠ¤ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´ ë§ì€ê²ƒì„ ë°°ì› ê³  ì´ ìë¦¬ì— ì •ë¦¬í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤. 
ì´ë²ˆ ìŠ¤í„°ë””ë„ ë‹¤ë“¤ ì™„ì£¼í•˜ê¸°ë¥¼ ê¸°ë„í•˜ë©° ìŠ¤í„°ë”” ì •ë¦¬ë¥¼ ì‹œì‘í•´ ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ë„ì»¤-ì†Œê°œ">ë„ì»¤ ì†Œê°œ</h2>

<h3 id="ë„ì»¤ë€-ë¬´ì—‡ì¸ê°€">ë„ì»¤ë€ ë¬´ì—‡ì¸ê°€?</h3>

<ul>
  <li>
    <p>ë„ì»¤(Docker)ëŠ” ì»¨í…Œì´ë„ˆ(Container)ë¼ê³  ë¶ˆë¦¬ëŠ” ê°€ìƒì‹¤í–‰ í™˜ê²½ì„ ì œê³µí•˜ê³ , 
ê·¸ ê°€ìƒí™˜ê²½ì—ì„œ ìœ ìš©í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼ì…ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ì»¨í…Œì´ë„ˆë¼ëŠ” ì´ë¦„ì˜ ê¸°ì›
ì»¨í…Œì´ë„ˆë¼ëŠ” ì´ë¦„ì€ ë°°ì— í™”ë¬¼ì„ ì‹¤ì„ë•Œ ì‚¬ìš©í•˜ëŠ” ê·¸ ì»¨í…Œì´ë„ˆì—ì„œ ì™”ìŠµë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w1/20240831_kans_w1_1.png" alt="ì»¨í…Œì´ë„ˆì„ " />
ê³¼ê±°ì— ì»¨í…Œì´ë„ˆê°€ ë°œëª…ë˜ê¸° ì´ì „ì—ëŠ” ì§ì˜ ë¶€í”¼ì™€ ëª¨ì–‘ì´ ì œê°ê°ì´ë¼ì„œ, í™”ë¬¼ì„ ì ì¬í•˜ê¸°ë„ ì–´ë µê³  
íŒŒë„ê°€ ì³ì„œ ë°°ê°€ í”ë“¤ë¦´ë•Œ ì§ì´ ì´ë¦¬ ì €ë¦¬ ì›€ì§ì—¬ì„œ íŒŒì†ë˜ëŠ” ê²½ìš°ê°€ ë§ì•˜ìŠµë‹ˆë‹¤.</p>

    <p>ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Malcom McLeanì´ë¼ëŠ” ë¶„ì´ ë°œëª…í•œê²ƒì´ ì§ìœ¡ë©´ì²´ì˜ ë°”ë¡œ ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤.<br />
<img src="/assets/2024/kans-3th/w1/20240831_kans_w1_2.png" alt="Shipping Container" />
ì§ìœ¡ë©´ì²´ì´ê¸° ë•Œë¬¸ì— ì ì¬ê°€ ì‰½ê³ , íŒŒë„ê°€ ì¹˜ë”ë¼ë„ ì•ˆì •ì ìœ¼ë¡œ í™”ë¬¼ì„ ìš´ë°˜í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 
ë˜í•œ í¬ê³  ì‘ì€ ë¬¼ê±´ë„ ì»¨í…Œì´ë„ˆ ì•ˆì— ë„£ì–´ì„œ ìš´ë°˜í•  ìˆ˜ ìˆì–´ì„œ í™”ë¬¼ì˜ ì¢…ë¥˜ì— ìƒê´€ì—†ì´ íš¨ìœ¨ì ìœ¼ë¡œ ìš´ë°˜í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

    <p>ì´ ê°œë…ì„ ì»´í“¨íŒ…ì— ë„ì…í•œê²ƒì´ ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤. 
ê¸°ì¡´ì—ëŠ” ê° ë¦¬ëˆ…ìŠ¤ ë²„ì „ë§ˆë‹¤, glibcëƒ muslì´ëƒ, debian ê¸°ë°˜ì´ëƒ redhat ê¸°ë°˜ì´ëƒ ë“±ë“± 
í”„ë¡œê·¸ë¨ì„ ë°°í¬í• ë•Œ í™˜ê²½ì„ ë§ì¶°ì•¼ í•˜ëŠ”ê²ƒì´ ë§ì•˜ìŠµë‹ˆë‹¤. ê·¸ ë¿ë§Œì•„ë‹ˆë¼ ê°ì¢… ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ë„ ì„¤ì¹˜í•´ì•¼ í•˜ê³ 
ì‹¬ì§€ì–´ í”„ë¡œê·¸ë¨ ë§ˆë‹¤ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ì´ ë‹¤ë¥¼ë•Œë„ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

    <p>ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸°ìœ„í•´ ë„ì»¤ë¼ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì´ìš©í•œ ê°€ìƒí™” ê¸°ìˆ ì´ ë“±ì¥í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
ë„ì»¤ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì—ëŠ” í”„ë¡œê·¸ë¨ ì‹¤í–‰ì— í•„ìš”í•œ ëª¨ë“ ê²ƒì´ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—
ë§ˆì¹˜ ì»¨í…Œì´ë„ˆì— í™”ë¬¼ì„ ì‹£ë“¯ì´ í”„ë¡œê·¸ë¨ì„ ë°°í¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. 
ë„ì»¤ì˜ ë¡œê³ ê°€ ì»¨í…Œì´ë„ˆë¥¼ ì‹£ê³  ìˆëŠ” ë°°ë¥¼ í˜•ìƒí™”í•œê²ƒë„ ì´ëŸ¬í•œ ì˜ë¯¸ì—ì„œ ë‚˜ì˜¨ê²ƒì…ë‹ˆë‹¤.</p>

    <p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_3.png" alt="Docker Logo" class="image-center" /></p>
  </li>
  <li>
    <p>ì»¨í…Œì´ë„ˆ ì´ì™¸ì—ë„ ê°€ìƒ ë¨¸ì‹ (Virtual Machine)ì´ë¼ëŠ” ê¸°ìˆ ì´ ìˆìŠµë‹ˆë‹¤. 
ê°€ìƒ ë¨¸ì‹ ì€ í•˜ì´í¼ë°”ì´ì €(Hypervisor)ë¥¼ ì´ìš©í•˜ì—¬ í˜¸ìŠ¤íŠ¸ OS ìœ„ì— ê²ŒìŠ¤íŠ¸ OSë¥¼ ì˜¬ë¦¬ëŠ” ë°©ì‹ìœ¼ë¡œ ê°€ìƒí™”ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
ê°€ìƒ ë¨¸ì‹ ì€ ê²ŒìŠ¤íŠ¸ OSë¥¼ ì˜¬ë¦¬ê¸° ë•Œë¬¸ì— ë¬´ê²ìŠµë‹ˆë‹¤. 
ë°˜ë©´ ì»¨í…Œì´ë„ˆëŠ” í˜¸ìŠ¤íŠ¸ OSì˜ ì»¤ë„ì„ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— ê°€ë³ìŠµë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w1/20240831_kans_w1_4.png" alt="img.png" /></p>
  </li>
</ul>

<h3 id="ì»¨í…Œì´ë„ˆì™€-ê°€ìƒ-ë¨¸ì‹ ">ì»¨í…Œì´ë„ˆì™€ ê°€ìƒ ë¨¸ì‹ </h3>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_5.png" alt="ê°€ìƒë¨¸ì‹ ê³¼ ì»¨í…Œì´ë„ˆ ë¹„êµ" /></p>

<ul>
  <li>ê°€ìƒë¨¸ì‹ ì€ í˜¸ìŠ¤íŠ¸ OS ìœ„ì— í•˜ì´í¼ë°”ì´ì €ë¥¼ ë‘ê³  í•˜ë“œì›¨ì–´ ì¼ë¶€(ë˜ëŠ” ì „ë¶€)ë¥¼ ê°€ìƒí™”í•˜ê³ , ê·¸ ìœ„ì— ê²ŒìŠ¤íŠ¸ OSë¥¼ ì˜¬ë¦½ë‹ˆë‹¤. ì¦‰, <strong>í•˜ë“œì›¨ì–´ ë ˆë²¨ì˜ ê°€ìƒí™”</strong>ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.</li>
  <li>ì»¨í…Œì´ë„ˆëŠ” í•˜ë“œì›¨ì–´ ê°€ìƒí™”ì™€ ê²ŒìŠ¤íŠ¸ OS ì—†ì´, í˜¸ìŠ¤íŠ¸ì˜ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì„ ê³µìœ í•˜ì—¬ ë°”ë¡œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ë‹¨, ê°ì¢… ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì‚¬ìš©ì í™˜ê²½(User Land)ëŠ” ì»¨í…Œì´ë„ˆ ë‹¨ìœ„ë¡œ íŒ¨í‚¤ì§•ë˜ì–´ <strong>OS ë ˆë²¨ì˜ ê°€ìƒí™”</strong>ë¥¼ ì§€ì›í•œë‹¤ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë”°ë¼ì„œ ì»¨í…Œì´ë„ˆëŠ” ê°€ìƒë¨¸ì‹ ë³´ë‹¤ ê°€ë³ê³  ë¹ ë¥´ë©°, ë‚®ì€ ê²©ë¦¬(Weak Isolation) ìˆ˜ì¤€ì„ ê°€ì§‘ë‹ˆë‹¤.</li>
  <li>ê°€ìƒë¨¸ì‹ ì€ ê²ŒìŠ¤íŠ¸ OSë¥¼ ì˜¬ë¦¬ê¸° ë•Œë¬¸ì— ë¬´ê²ê³  ëŠë¦¬ì§€ë§Œ, ë†’ì€ ê²©ë¦¬(Strong Isolation) ìˆ˜ì¤€ì„ ê°€ì§‘ë‹ˆë‹¤.
    <ul>
      <li>ë‚®ì€ ê²©ë¦¬ ìˆ˜ì¤€ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ ë¦¬ëˆ…ìŠ¤ì˜ pivot-root, namespace, cgroup ë“±ì˜ ê¸°ëŠ¥ë“¤ì„ í™œìš©í•¨ìœ¼ë¡œì¨ í”„ë¡œì„¸ìŠ¤ ë‹¨ìœ„ì˜ ê²©ë¦¬ í™˜ê²½ê³¼ ë¦¬ì†ŒìŠ¤ ì œì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w1/20240831_kans_w1_6.png" alt="img.png" class="image-center" /></li>
    </ul>
  </li>
</ul>

<h3 id="ë„ì»¤-ì•„í‚¤í…ì³">ë„ì»¤ ì•„í‚¤í…ì³</h3>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_7.png" alt="ë„ì»¤ ì•„í‚¤í…ì³" />
<a href="https://docs.docker.com/get-started/overview/#docker-architecture">https://docs.docker.com/get-started/overview/#docker-architecture</a></p>

<hr />

<h2 id="ë„ì»¤-ê¸°ë³¸-ì‚¬ìš©">ë„ì»¤ ê¸°ë³¸ ì‚¬ìš©</h2>

<h3 id="ë„ì»¤-ì„¤ì¹˜-ë°-í™•ì¸">ë„ì»¤ ì„¤ì¹˜ ë° í™•ì¸</h3>

<ul>
  <li>ë„ì»¤ ì„¤ì¹˜
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë°©ë²•1. debian ê³„ì—´ ë¦¬ëˆ…ìŠ¤ì—ì„œ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë¡œ ì„¤ì¹˜</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt-get update
<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> docker.io
  
<span class="c"># ë°©ë²•2. ê³µì‹ ì‚¬ì´íŠ¸ì—ì„œ ì„¤ì¹˜</span>
<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
<span class="nv">$ </span>curl <span class="nt">-fsSL</span> https://get.docker.com | sh
</code></pre></div>    </div>
  </li>
  <li>ê¸°ë³¸ì •ë³´ í™•ì¸
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë„ì»¤ ì •ë³´ í™•ì¸ : Client ì™€ Server , Storage Driver(overlay2), Cgroup Version(2), Default Runtime(runc)</span>
<span class="nv">$ </span><span class="nb">sudo </span>docker info
<span class="c">#    Client:</span>
<span class="c">#     Context:    default</span>
<span class="c">#     Debug Mode: false</span>
<span class="c">#    </span>
<span class="c">#    Server:</span>
<span class="c">#     Containers: 0</span>
<span class="c">#     ...</span>
<span class="c">#     Server Version: 20.10.25+dfsg1</span>
<span class="c">#     Storage Driver: overlay2</span>
<span class="c">#     ...</span>
<span class="c">#     Cgroup Driver: systemd</span>
<span class="c">#     Cgroup Version: 2</span>
<span class="c">#     ...</span>
<span class="c">#     containerd version: 1.6.24~ds1-2</span>
<span class="c">#     runc version: 1.1.12+ds1-5</span>
<span class="c">#     ...</span>
  
<span class="nv">$ </span><span class="nb">sudo </span>docker version
<span class="c"># =&gt; Client:</span>
<span class="c">#     Version:           20.10.25+dfsg1</span>
<span class="c">#     API version:       1.41</span>
<span class="c">#     Go version:        go1.22.3</span>
<span class="c">#     Git commit:        b82b9f3</span>
<span class="c">#     Built:             Tue May  7 10:33:18 2024</span>
<span class="c">#     OS/Arch:           linux/amd64</span>
<span class="c">#     Context:           default</span>
<span class="c">#     Experimental:      true</span>
<span class="c">#    </span>
<span class="c">#    Server:</span>
<span class="c">#     Engine:</span>
<span class="c">#      Version:          20.10.25+dfsg1</span>
<span class="c">#      API version:      1.41 (minimum version 1.12)</span>
<span class="c">#      Go version:       go1.22.3</span>
<span class="c">#      Git commit:       5df983c</span>
<span class="c">#      Built:            Tue May  7 10:33:18 2024</span>
<span class="c">#      OS/Arch:          linux/amd64</span>
<span class="c">#      Experimental:     false</span>
<span class="c">#    ...  </span>
  
<span class="c"># ë„ì»¤ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">sudo </span>systemctl status docker <span class="nt">-l</span> <span class="nt">--no-pager</span>
  
<span class="c"># ëª¨ë“  ì„œë¹„ìŠ¤ì˜ ìƒíƒœ í‘œì‹œ</span>
<span class="nv">$ </span>systemctl list-units <span class="nt">--type</span><span class="o">=</span>service
  
<span class="c"># ë„ì»¤ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ í™•ì¸ : Docker Root Dir(/var/lib/docker)</span>
<span class="nv">$ </span><span class="nb">sudo </span>tree <span class="nt">-L</span> 3 /var/lib/docker
<span class="c"># =&gt; /var/lib/docker</span>
<span class="c">#    |-- buildkit</span>
<span class="c">#    |   ...</span>
<span class="c">#    |-- containers</span>
<span class="c">#    |-- image</span>
<span class="c">#    |   `-- overlay2</span>
<span class="c">#    |       |-- distribution</span>
<span class="c">#    |       |-- imagedb</span>
<span class="c">#    |       |-- layerdb</span>
<span class="c">#    |       `-- repositories.json</span>
<span class="c">#    |-- network</span>
<span class="c">#    |   `-- files</span>
<span class="c">#    |       `-- local-kv.db</span>
<span class="c">#    |-- overlay2</span>
<span class="c">#    |   ...</span>
<span class="c">#    `-- volumes</span>
<span class="c">#        |-- backingFsBlockDev</span>
<span class="c">#        `-- metadata.db</span>
<span class="c">#    </span>
<span class="c">#    24 directories, 8 files</span>
</code></pre></div>    </div>
  </li>
  <li>ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í”„ë¡œì„¸ìŠ¤ í™•ì¸ - ì…¸ë³€ìˆ˜</span>
<span class="nv">$ </span>ps <span class="nt">-ef</span>      <span class="c"># í”„ë¡œì„¸ìŠ¤ ëª©ë¡ ë³´ê¸°</span>
<span class="nv">$ </span>pstree <span class="nt">-p</span>   <span class="c"># í”„ë¡œì„¸ìŠ¤ íŠ¸ë¦¬ë¡œ ë³´ê¸°</span>
  
<span class="nv">$ </span><span class="nb">df</span> <span class="nt">-hT</span>    <span class="c"># ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸. ë„ì»¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” docker0 ë„¤íŠ¸ì›Œí¬ê°€ ì¶”ê°€ë˜ì–´ìˆê³  í˜„ì¬ DOWN ìƒíƒœì…ë‹ˆë‹¤.</span>
<span class="c"># ì»¨í…Œì´ë„ˆê°€ ìˆìœ¼ë©´ UP ìƒíƒœë¡œ ë³€ê²½ë©ë‹ˆë‹¤.  </span>
<span class="nv">$ </span>ip <span class="nt">-br</span> <span class="nt">-c</span> addr
<span class="c"># =&gt; &lt;span style="color:teal;"&gt;lo               &lt;/span&gt;UNKNOWN        &lt;span style="color:purple;"&gt;127.0.0.1&lt;/span&gt;/8 &lt;span style="color:blue;"&gt;::1&lt;/span&gt;/128 </span>
<span class="c">#    &lt;span style="color:teal;"&gt;eth0             &lt;/span&gt;&lt;span style="color:green;"&gt;UP             &lt;/span&gt;&lt;span style="color:purple;"&gt;10.10.10.109&lt;/span&gt;/24 &lt;span style="color:purple;"&gt;10.10.10.51&lt;/span&gt;/24 &lt;span style="color:blue;"&gt;fe80::a70d:8639:be6:671e&lt;/span&gt;/64</span>
<span class="c">#    &lt;span style="color:teal;"&gt;docker0          &lt;/span&gt;&lt;span style="color:red;"&gt;DOWN           &lt;/span&gt;&lt;span style="color:purple;"&gt;172.17.0.1&lt;/span&gt;/16 &lt;span style="color:blue;"&gt;fe80::42:57ff:fe56:997c&lt;/span&gt;/64</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> addr
<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nb">link</span>
<span class="nv">$ </span>ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nb">link</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> route
  
<span class="c"># ì´ë”ë„· ë¸Œë¦¿ì§€ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>brctl show
<span class="c"># =&gt; bridge name	bridge id		STP enabled	interfaces</span>
<span class="c">#    docker0		8000.02425756997c	no</span>
  
<span class="c"># iptables ì •ì±… í™•ì¸</span>
<span class="c"># FORWARD ì •ì±…ì´ DROPìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆê³ , </span>
<span class="c"># docker0ì—ì„œ docker0 í˜¹ì€ ì™¸ë¶€ë¡œ ì „ë‹¬ë˜ëŠ” íŒ¨í‚·ì€ í—ˆìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">sudo </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span>
<span class="c"># =&gt; -P INPUT ACCEPT</span>
<span class="c">#    &lt;span style="color: red;"&gt;-P FORWARD DROP&lt;/span&gt;</span>
<span class="c">#    -P OUTPUT ACCEPT</span>
<span class="c">#    -N DOCKER</span>
<span class="c">#    -N DOCKER-ISOLATION-STAGE-1</span>
<span class="c">#    -N DOCKER-ISOLATION-STAGE-2</span>
<span class="c">#    -N DOCKER-USER</span>
<span class="c">#    -A FORWARD -j DOCKER-USER</span>
<span class="c">#    -A FORWARD -j DOCKER-ISOLATION-STAGE-1</span>
<span class="c">#    -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span>
<span class="c">#    -A FORWARD -o docker0 -j DOCKER</span>
<span class="c">#    &lt;span style="color: red;"&gt;-A FORWARD -i docker0 ! -o docker0 -j ACCEPT&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color: red;"&gt;-A FORWARD -i docker0 -o docker0 -j ACCEPT&lt;/span&gt;</span>
<span class="c">#    -A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span>
<span class="c">#    -A DOCKER-ISOLATION-STAGE-1 -j RETURN</span>
<span class="c">#    -A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span>
<span class="c">#    -A DOCKER-ISOLATION-STAGE-2 -j RETURN</span>
<span class="c">#    -A DOCKER-USER -j RETURN</span>

<span class="c"># NAT POSTROUTINGì— 172.17.0.0/16ì—ì„œ ì™¸ë¶€ë¡œ ì „ë‹¬ì‹œ MASQUERADE (SNAT) ì •ì±…ì´ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">sudo </span>iptables <span class="nt">-t</span> nat <span class="nt">-S</span>
<span class="c"># =&gt; -P PREROUTING ACCEPT</span>
<span class="c">#    -P INPUT ACCEPT</span>
<span class="c">#    -P OUTPUT ACCEPT</span>
<span class="c">#    -P POSTROUTING ACCEPT</span>
<span class="c">#    -N DOCKER</span>
<span class="c">#    -A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span>
<span class="c">#    -A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span>
<span class="c">#    &lt;span style="color: red;"&gt;-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE&lt;/span&gt;</span>
<span class="c">#    -A DOCKER -i docker0 -j RETURN</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="ë„ì»¤ë¥¼-ë¹„-root-ìœ ì €ë¡œ-ê´€ë¦¬í•˜ê¸°">ë„ì»¤ë¥¼ ë¹„ root ìœ ì €ë¡œ ê´€ë¦¬í•˜ê¸°</h3>

<p>ë„ì»¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ rootë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
rootê°€ ì•„ë‹Œ ìœ ì €ë¡œ docker ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; kali</span>

<span class="nv">$ </span>docker info
<span class="c"># =&gt; ...</span>
<span class="c">#    Server:</span>
<span class="c">#    ERROR: permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get &amp;quot;http://%2Fvar%2Frun%2Fdocker.sock/v1.24/info&amp;quot;: dial unix /var/run/docker.sock: connect: permission denied</span>
</code></pre></div></div>

<p>í•˜ì§€ë§Œ, ë‹¤ìŒì˜ ë°©ë²• ì²˜ëŸ¼ í˜„ì¬ ì‚¬ìš©ìë¥¼ docker ê·¸ë£¹ì— ì¶”ê°€í•˜ë©´, rootê°€ ì•„ë‹Œ ì¼ë°˜ ìœ ì €ë¡œë„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">whoami</span> 
<span class="c"># =&gt; kali</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$USER</span>
<span class="c"># =&gt; kali</span>

<span class="c"># ë„ì»¤ ê·¸ë£¹ ì¶”ê°€</span>
<span class="nv">$ </span><span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="nv">$USER</span>

<span class="c"># ê·¸ë£¹ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">groups</span> 
<span class="c"># =&gt; adm ... kaboxer</span>

<span class="c"># ë¡œê·¸ì•„ì›ƒ</span>
<span class="nb">exit</span> 

<span class="c"># ssh ì¬ì ‘ì† í›„ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">groups</span> 
<span class="c"># =&gt; adm ... kaboxer docker</span>

<span class="nv">$ </span>docker info
<span class="c"># =&gt; Client:</span>
<span class="c">#     Context:    default</span>
<span class="c">#     Debug Mode: false</span>
<span class="c">#    </span>
<span class="c">#    Server:</span>
<span class="c">#     Containers: 0</span>
<span class="c">#     ...</span>
<span class="c">#     Cgroup Version: 2</span>
<span class="c">#     ...</span>
<span class="c">#     Default Runtime: runc</span>
<span class="c">#     Init Binary: docker-init</span>
<span class="c">#     containerd version: 1.6.24~ds1-2</span>
<span class="c">#     runc version: 1.1.12+ds1-5</span>
<span class="c">#     ...    </span>

<span class="c"># ì»¨í…Œì´ë„ˆ í™•ì¸</span>
<span class="nv">$ </span>docker run <span class="nt">--rm</span> hello-world
<span class="c"># =&gt; Hello from Docker!</span>
<span class="c">#    This message shows that your installation appears to be working correctly.</span>
<span class="c">#    ...</span>

<span class="c"># ì‹¤í–‰ì¤‘ì¸ ë„ì»¤ ì»¨í…Œì´ë„ˆ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># ì „ì²´ ë„ì»¤ ì»¨í…Œì´ë„ˆ í™•ì¸</span>
<span class="nv">$ </span>docker ps <span class="nt">-a</span>
<span class="c"># ì´ë¯¸ì§€ ëª©ë¡ í™•ì¸</span>
<span class="nv">$ </span>docker images
<span class="c"># =&gt; REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span>
<span class="c">#    hello-world   latest    d2c94e258dcb   16 months ago   13.3kB</span>

<span class="c"># ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‚­ì œ</span>
<span class="nv">$ </span>docker ps <span class="nt">-aq</span>
<span class="nv">$ </span>docker <span class="nb">rm</span> <span class="nt">-f</span> <span class="si">$(</span>docker ps <span class="nt">-aq</span><span class="si">)</span>
<span class="nv">$ </span>docker ps <span class="nt">-a</span>
</code></pre></div></div>

<h3 id="ì»¨í…Œì´ë„ˆê°€-hostì˜-docker-socket-file-ê³µìœ ë¡œ-ë„ì»¤-ì‹¤í–‰">ì»¨í…Œì´ë„ˆê°€ hostì˜ docker socket file ê³µìœ ë¡œ ë„ì»¤ ì‹¤í–‰</h3>

<ul>
  <li>
    <p>ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ GUIë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” íˆ´ì¸ <a href="https://www.portainer.io/">portainer</a>ì²˜ëŸ¼ ë„ì»¤ ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ì˜ ë„ì»¤ ì†Œì¼“ íŒŒì¼ì„ ê³µìœ í•˜ì—¬ ë„ì»¤ë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ì‚¬ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰</span>
<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">-p</span> 9000:9000 <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock portainer/portainer-ce
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                    COMMAND        CREATED         STATUS         PORTS                                                           NAMES</span>
<span class="c">#    1495728fd014   portainer/portainer-ce   &amp;quot;/portainer&amp;quot;   2 minutes ago   Up 2 minutes   8000/tcp, 9443/tcp, 0.0.0.0:9000-&amp;gt;9000/tcp, :::9000-&amp;gt;9000/tcp   wizardly_ride</span>
  
</code></pre></div>    </div>

    <p><code class="language-plaintext highlighter-rouge">-v</code> ì˜µì…˜ìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ì˜ ë„ì»¤ ì†Œì¼“ íŒŒì¼ì„ ì»¨í…Œì´ë„ˆì˜ ë„ì»¤ ì†Œì¼“ íŒŒì¼ë¡œ ê³µìœ í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë„ì»¤ ì»¨í…Œì´ë„ˆì—ì„œ í˜¸ìŠ¤íŠ¸ì˜ ë„ì»¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_8.png" alt="ì†Œì¼“ ê³µìœ ë¥¼ í†µí•´ portainer ì‚¬ìš©" /></p>
  </li>
  <li>
    <p>ë˜í•œ Jenkins ê°™ì€ CI/CD íˆ´ì„ ì‚¬ìš©í• ë•Œë„ ë„ì»¤ ì†Œì¼“ íŒŒì¼ì„ ê³µìœ í•˜ì—¬ ë„ì»¤ ê¸°ë°˜ ì›Œì»¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
</ul>

<h3 id="cpu-ì•„í‚¤í…ì³">CPU ì•„í‚¤í…ì³</h3>

<ul>
  <li>ë„ì»¤ í—ˆë¸Œì— ë“±ë¡ëœ ì´ë¯¸ì§€ë“¤ì€ CPU ì•„í‚¤í…ì³ë³„ë¡œ ì´ë¯¸ì§€ë¥¼ ì œê³µí•˜ëŠ”ë°, <strong>í˜¸ìŠ¤íŠ¸ì˜ CPU ì•„í‚¤í…ì³ì™€ ë‹¤ë¥¸ ì´ë¯¸ì§€ëŠ” ë™ì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong></li>
  <li>ì•„ë˜ì™€ ê°™ì´ docker hubì—ì„œëŠ” ì§€ì› CPU ì•„í‚¤í…ì³ë³„ë¡œ í•„í„°ë§í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ë‹ˆ, íŠ¹ì • ì•„í‚¤í…ì³ì˜ ì´ë¯¸ì§€ê°€ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w1/20240831_kans_w1_9.png" alt="img.png" /></li>
  <li>ë˜í•œ ë„ì»¤ì´ë¯¸ì§€ í˜ì´ì§€ì˜ Tags íƒ­ì—ì„œ íƒœê·¸ì˜ ì§€ì›í•˜ëŠ” ì•„í‚¤í…ì³ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<img src="../../../assets/2024/kans-3th/w1/20240831_kans_w1_10.png" alt="20240831_kans_w1_10.png" /></li>
  <li>í˜„ì¬ ë¦¬ëˆ…ìŠ¤ì˜ CPU ì•„í‚¤í…ì³ë¥¼ í™•ì¸ í•´ë³´ê² ìŠµë‹ˆë‹¤.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>lscpu
<span class="c"># =&gt; Architecture:                       x86_64</span>
<span class="c">#    CPU op-mode(s):                     32-bit, 64-bit</span>
<span class="c">#    ...</span>
</code></pre></div>    </div>
    <p>ì‚¬ìš©ì¤‘ì¸ CPU ì•„í‚¤í…ì³ëŠ” x86_64 ì…ë‹ˆë‹¤.</p>
  </li>
  <li>í˜„ì¬ CPU ì•„í‚¤í…ì³ì™€ëŠ” ë‹¤ë¥¸ ì•„í‚¤í…ì³ì˜ ì´ë¯¸ì§€ë¥¼ ì„¤ì¹˜í•´ì„œ ì‹¤íŒ¨í•˜ëŠ”ê²ƒì„ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># arm64 ì‹¤í–‰ ì‹¤íŒ¨</span>
<span class="nv">$ </span>docker run <span class="nt">--rm</span> <span class="nt">-it</span> arm64v8/ubuntu bash
<span class="c"># =&gt; WARNING: The requested image's platform (linux/arm64/v8) does not match the detected host platform (linux/amd64) and no specific platform was requested</span>
<span class="c">#    exec /usr/bin/bash: exec format error</span>
  
<span class="c"># riscv64 ì‹¤í–‰ ì‹¤íŒ¨</span>
<span class="nv">$ </span>docker run <span class="nt">--rm</span> <span class="nt">-it</span> riscv64/ubuntu bash
<span class="c"># =&gt; WARNING: The requested image's platform (linux/riscv64) does not match the detected host platform (linux/amd64) and no specific platform was requested</span>
<span class="c">#    exec /usr/bin/bash: exec format error</span>
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="ì»¨í…Œì´ë„ˆ-ê²©ë¦¬">ì»¨í…Œì´ë„ˆ ê²©ë¦¬</h2>

<ul>
  <li>dockerëŠ” ë¦¬ëˆ…ìŠ¤ì˜ í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬ ê¸°ìˆ ì„ í™œìš©í•˜ëŠ”ë°, í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬ ê¸°ìˆ ì€ chrootì—ì„œ ë¶€í„° cgroup, namespace ë“±ì„ ê±°ì³ ë°œì „í•˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì£¼ìš” ê²©ë¦¬ ê¸°ìˆ ë“¤ì„ ì‹¤ìŠµí•´ë³´ë©° ì´í•´í•´ë³´ê² ìŠµë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w1/20240831_kans_w1_11.png" alt="img.png" />
<a href="https://speakerdeck.com/kakao/ige-dwaeyo-dokeo-eobsi-keonteineo-mandeulgi?slide=200">https://speakerdeck.com/kakao/ige-dwaeyo-dokeo-eobsi-keonteineo-mandeulgi?slide=200</a></li>
</ul>

<h3 id="chroot">chroot</h3>

<ul>
  <li>chrootëŠ” ë¦¬ëˆ…ìŠ¤ì˜ í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬ ê¸°ìˆ  ì¤‘ í•˜ë‚˜ë¡œ, í”„ë¡œì„¸ìŠ¤ê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” íŒŒì¼ ì‹œìŠ¤í…œì˜ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ë¥¼ ë³€ê²½í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.</li>
  <li>1979ë…„ì— ì²˜ìŒ ë“±ì¥í–ˆìœ¼ë©°, í•œê³„ê°€ ëšœë ·í•˜ì§€ë§Œ ë‹¤ì–‘í•œ ëª©ì ìœ¼ë¡œ í˜„ì¬ë„ í˜„ì—­ìœ¼ë¡œ ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ê´€ë¦¬ì ì „í™˜</span>
<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
<span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; root</span>

<span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="nv">$ </span><span class="nb">mkdir </span>myroot

<span class="c"># chroot ì‹¤í–‰ (chroot [ìƒˆ ë£¨íŠ¸] [ëª…ë ¹])</span>
<span class="nv">$ </span><span class="nb">chroot </span>myroot /bin/bash
<span class="c"># =&gt; chroot: failed to run command â€˜/bin/bashâ€™: No such file or directory</span>
</code></pre></div></div>

<ul>
  <li>/tmp/myroot ë¡œ chrootí•˜ë ¤ë‹ˆ bashê°€ ì—†ì–´ì„œ ì‹¤í–‰ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. bashë¥¼ ë³µì‚¬í•´ ë„£ì–´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># bashë¥¼ ì‹¤í–‰í•˜ëŠ”ë° í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>ldd /bin/bash
<span class="c"># =&gt; linux-vdso.so.1 (0x00007fffecfa8000)</span>
<span class="c">#    libtinfo.so.6 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.6 (0x00007fbfe6a4f000)</span>
<span class="c">#    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fbfe686a000)</span>
<span class="c">#    /lib64/ld-linux-x86-64.so.2 (0x00007fbfe6be0000)</span>

<span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> myroot/bin
<span class="nv">$ </span><span class="nb">cp</span> /bin/bash myroot/bin
<span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> myroot/<span class="o">{</span>lib64,lib/x86_64-linux-gnu<span class="o">}</span>
<span class="nv">$ </span><span class="nb">cp</span> /lib/x86_64-linux-gnu/libtinfo.so.6 myroot/lib/x86_64-linux-gnu
<span class="nv">$ </span><span class="nb">cp</span> /lib/x86_64-linux-gnu/libc.so.6 myroot/lib/x86_64-linux-gnu
<span class="nv">$ </span><span class="nb">cp</span> /lib64/ld-linux-x86-64.so.2 myroot/lib64
<span class="nv">$ </span>tree myroot
<span class="c"># =&gt; myroot</span>
<span class="c">#    |-- bin</span>
<span class="c">#    |   `-- bash</span>
<span class="c">#    |-- lib</span>
<span class="c">#    |   `-- x86_64-linux-gnu</span>
<span class="c">#    |       |-- libc.so.6</span>
<span class="c">#    |       `-- libtinfo.so.6</span>
<span class="c">#    `-- lib64</span>
<span class="c">#        `-- ld-linux-x86-64.so.2</span>
<span class="c">#    </span>
<span class="c">#    5 directories, 4 files</span>

<span class="nv">$ </span><span class="nb">chroot </span>myroot /bin/bash
<span class="c"># =&gt; bash-5.2# </span>
<span class="c"># bashì™€ bashì— í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„£ì–´ì£¼ë‹ˆ chrootë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
<span class="c"># lsë¥¼ ì‹¤í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">ls</span>
<span class="c"># =&gt; bash: ls: command not found</span>
<span class="c"># lsê°€ ì—†ì–´ì„œ ì‹¤í–‰ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. lsë¥¼ ë„£ê¸°ìœ„í•´ chrootì—ì„œ ë‚˜ì˜¤ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># ls ìœ„ì¹˜ í™•ì¸</span>
<span class="nv">$ </span>whereis <span class="nb">ls</span>
<span class="c"># =&gt; ls: /usr/bin/ls /usr/share/man/man1/ls.1.gz</span>
<span class="nv">$ </span>ldd /usr/bin/ls
<span class="c"># lddë¡œ í™•ì¸ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í¬í•¨í•´ lsë¥¼ myrootì— ë„£ì–´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">cp</span> /usr/bin/ls myroot/bin
<span class="nv">$ </span><span class="nb">cp</span> /lib/x86_64-linux-gnu/libselinux.so.1 myroot/lib/x86_64-linux-gnu
<span class="nv">$ </span><span class="nb">cp</span> /lib/x86_64-linux-gnu/libpcre2-8.so.0 myroot/lib/x86_64-linux-gnu

<span class="nv">$ </span><span class="nb">chroot </span>myroot /bin/bash
<span class="c"># lsì‹œ /tmp/myrootì— ìˆëŠ” íŒŒì¼ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">ls</span>
<span class="c"># =&gt; bin  lib  lib64</span>
<span class="c"># í˜„ì¬ ë””ë ‰í„°ë¦¬ í™•ì¸ì‹œ / ë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤. ì´ ì²˜ëŸ¼ chrootë¡œ ì¸í•´ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. </span>
<span class="nv">$ </span><span class="nb">pwd</span>
<span class="c"># =&gt; /</span>
<span class="nv">$ </span><span class="nb">cd</span> ../../..
<span class="nv">$ </span><span class="nb">ls</span>
<span class="c"># =&gt; bin lib lib64</span>

<span class="c"># chrootë¥¼ ì¢…ë£Œ í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">exit</span>
</code></pre></div></div>

<ul>
  <li>ì´ ì‘ì—…ì„ ë°˜ë³µí•˜ë©´ ê±°ì˜ ëª¨ë“  í”„ë¡œê·¸ë¨ì„ chrootë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ /proc, /dev ë“±ì˜ ê°€ìƒ ë””ë ‰í„°ë¦¬ëŠ” ë‹¤ìŒì˜ ë°©ë²•ìœ¼ë¡œ ë„£ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë‹¤ìŒ ë™ì‘ì€ chroot ë°–ì˜ í˜¸ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.</span>
<span class="c"># mount í•  ë””ë ‰í„°ë¦¬ ë§Œë“¤ì–´ì£¼ê¸°</span>
<span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> myroot/<span class="o">{</span>proc,dev<span class="o">}</span>

<span class="c"># /proc, /dev ë§ˆìš´íŠ¸</span>
<span class="nv">$ </span>mount <span class="nt">-t</span> proc none myroot/proc
<span class="nv">$ </span>mount <span class="nt">-o</span> <span class="nb">bind</span> /dev myroot/dev

<span class="c"># /proc í™•ì¸ì„ ìœ„í•´ psë„ chroot í™˜ê²½ì— ë„£ì–´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">cp</span> /usr/bin/ps myroot/bin
<span class="nv">$ </span><span class="nb">cp</span> /lib/x86_64-linux-gnu/<span class="o">{</span>libproc2.so.0,libc.so.6,libsystemd.so.0,libcap.so.2,libgcrypt.so.20,liblz4.so.1,liblzma.so.5,libzstd.so.1,libgpg-error.so.0<span class="o">}</span> myroot/lib/x86_64-linux-gnu/ 
<span class="nv">$ </span><span class="nb">cp</span> /lib64/ld-linux-x86-64.so.2 myroot/lib64/ 

<span class="nv">$ </span><span class="nb">chroot </span>myroot /bin/bash
<span class="nv">$ </span><span class="nb">ls</span> /proc
<span class="nv">$ </span>ps
<span class="c"># =&gt;    PID TTY          TIME CMD</span>
<span class="c">#    729517 ?        00:00:00 sudo</span>
<span class="c">#    741301 ?        00:00:00 bash</span>
<span class="c">#    741310 ?        00:00:00 ps</span>

<span class="c"># chroot ì¢…ë£Œ</span>
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># ë§ˆìš´íŠ¸ í•´ì œ</span>
<span class="nv">$ </span>mount <span class="nt">-t</span> proc
<span class="c"># =&gt; proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)</span>
<span class="c">#    none on /tmp/myroot/proc type proc (rw,relatime)</span>
<span class="nv">$ </span>umount myroot/proc
<span class="nv">$ </span>umount myroot/dev
<span class="nv">$ </span>mount <span class="nt">-t</span> proc
<span class="c"># =&gt; proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)</span>
</code></pre></div></div>

<ul>
  <li>ë„ì»¤ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì¶”ì¶œí•˜ì—¬ chrootë¡œ ì‹¤í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>nginx-root

<span class="c"># nginx ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì—ì„œ íŒŒì¼ë“¤ì„ ì¶”ì¶œí•˜ì—¬ nginx-rootì— ë„£ì–´ì¤ë‹ˆë‹¤.</span>
<span class="nv">$ </span>docker <span class="nb">export</span> <span class="si">$(</span>docker create nginx<span class="si">)</span> | <span class="nb">tar</span> <span class="nt">-C</span> nginx-root <span class="nt">-xvf</span> -
<span class="nv">$ </span>docker images

<span class="nv">$ </span>tree <span class="nt">-L</span> 2 nginx-root

<span class="c"># chrootë¡œ nginx-rootë¥¼ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">chroot </span>nginx-root /bin/bash
<span class="c"># nginxë¥¼ ì‹¤í–‰í•´ë´…ë‹ˆë‹¤.</span>
<span class="nv">$ </span>nginx <span class="nt">-g</span> <span class="s1">'daemon off;'</span>

<span class="c"># [í„°ë¯¸ë„2] í„°ë¯¸ë„ì„ í•˜ë‚˜ë” ì—´ê³  nginx ë™ì‘ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>ps <span class="nt">-f</span> <span class="nt">-C</span> nginx
<span class="nv">$ </span>curl localhost
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_12.png" alt="img.png" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìƒì„±ëœ docker ì»¨í…Œì´ë„ˆë¥¼ í™•ì¸í•©ë‹ˆë‹¤. docker create nginxë¡œ ì¸í•´ ì»¨í…Œì´ë„ˆê°€ ìƒê²¨ì ¸ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>docker ps <span class="nt">-a</span>
<span class="c"># =&gt; CONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS    PORTS     NAMES</span>
<span class="c">#    0b506af00006   nginx     "/docker-entrypoint.â€¦"   About a minute ago   Created             gifted_rosalind</span>

<span class="c"># ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë„ì»¤ì´ë¯¸ì§€ë¥¼ ì§€ì›Œì¤ë‹ˆë‹¤.</span>
<span class="nv">$ </span>docker <span class="nb">rm </span>0b5
</code></pre></div></div>

<ul>
  <li>ì•„ì‰½ê²Œë„ chrootëŠ” íƒˆì˜¥ì´ ê°€ëŠ¥í•˜ë‹¤ê³  í•©ë‹ˆë‹¤. ë‹¤ìŒ ì½”ë“œë¥¼ ì»´íŒŒì¼í•˜ì—¬ íƒˆì˜¥ì„ ì‹œë„í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">mkdir</span><span class="p">(</span><span class="s">".out"</span><span class="p">,</span> <span class="mo">0755</span><span class="p">);</span>
  <span class="n">chroot</span><span class="p">(</span><span class="s">".out"</span><span class="p">);</span>
  <span class="n">chdir</span><span class="p">(</span><span class="s">"../../../../../"</span><span class="p">);</span>
  <span class="n">chroot</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">execl</span><span class="p">(</span><span class="s">"/bin/sh"</span><span class="p">,</span> <span class="s">"-i"</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì»´íŒŒì¼</span>
<span class="nv">$ </span>gcc <span class="nt">-o</span> myroot/escape_chroot escape_chroot.c
<span class="nv">$ </span>file myroot/escape_chroot
<span class="c"># =&gt; myroot/escape_chroot: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=5a40e26463d1015f870c7f1b9db9be159727c250, for GNU/Linux 3.2.0, not stripped</span>

<span class="c"># chroot ì‹¤í–‰</span>
<span class="nv">$ </span><span class="nb">chroot </span>myroot /bin/bash
<span class="nv">$ </span><span class="nb">ls</span>
<span class="nv">$ </span><span class="nb">cd</span> ../../
<span class="nv">$ </span><span class="nb">cd</span> ../../
<span class="nv">$ </span><span class="nb">ls</span>
<span class="c"># ì¼ë°˜ì ì¸ ë°©ë²•ìœ¼ë¡œëŠ” myrootì—ì„œ ë²—ì–´ë‚  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.</span>

<span class="c"># escape_chroot ì‹¤í–‰í•´ì„œ íƒˆì˜¥í•´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>./escape_chroot
<span class="nv">$ </span><span class="nb">ls</span> /
<span class="c"># íƒˆì˜¥ì´ ì˜ ë˜ì—ˆìŠµë‹ˆë‹¤.</span>

<span class="c"># ì¢…ë£Œ</span>
<span class="nv">$ </span><span class="nb">exit</span>
<span class="nv">$ </span><span class="nb">exit</span>
</code></pre></div></div>

<h3 id="ë§ˆìš´íŠ¸-ë„¤ì„ìŠ¤í˜ì´ìŠ¤--pivot_root">ë§ˆìš´íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ + pivot_root</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pivot_root</code>ëŠ” ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì„ ë³€ê²½í•˜ëŠ” ì‹œìŠ¤í…œ ì½œë¡œ, ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ë¥¼ ë³€ê²½í•˜ëŠ” chrootì™€ ë‹¬ë¦¬ ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì„ ë³„ë„ì˜ ë””ë ‰í„°ë¦¬ë¡œ ì´ë™ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì•„ë˜ì˜ ê·¸ë¦¼ì—ì„œ ì²˜ëŸ¼ /tmp/new_rootê°€ ìˆê³  /tmp/new_root/put_old ë””ë ‰í„°ë¦¬ê°€ ìˆëŠ” ê²½ìš°, <code class="language-plaintext highlighter-rouge">pivot_root /tmp/new_root /tmp_new_root/put_old</code>ë¥¼ í•˜ë©´ 
/tmp/new_rootê°€ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ë¡œ ë³€ê²½ë˜ê³ , ì›ë˜ì˜ ë£¨íŠ¸ /ëŠ” /tmp/new_root/put_oldë¡œ ì´ë™ë©ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_13.png" alt="img.png" />
<a href="https://speakerdeck.com/kakao/ige-dwaeyo-dokeo-eobsi-keonteineo-mandeulgi?slide=80">https://speakerdeck.com/kakao/ige-dwaeyo-dokeo-eobsi-keonteineo-mandeulgi?slide=80</a></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pivot_root</code>ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">unshare</code> ëª…ë ¹ì„ í†µí•´ ë§ˆìš´íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ë§ˆìš´íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ, í”„ë¡œì„¸ìŠ¤ê°€ ë§ˆìš´íŠ¸ ì •ë³´ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê°€ì§ˆ ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.</li>
  <li>ë˜í•œ ë‹¤ìŒê³¼ ê°™ì€ ì œì•½ì‚¬í•­ì´ ì ìš© ë©ë‹ˆë‹¤.
    <ul>
      <li>new_rootì™€ put_oldê°€ ë””ë ‰í„°ë¦¬ì—¬ì•¼ í•œë‹¤.</li>
      <li>new_rootì™€ put_oldê°€ í˜„ì¬ ë£¨íŠ¸ì™€ ê°™ì€ ë§ˆìš´íŠ¸ ìƒì— ìˆì–´ì„  ì•ˆ ëœë‹¤.</li>
      <li>put_oldê°€ new_rootì™€ ê°™ê±°ë‚˜ ê·¸ ì•„ë˜ì— ìˆì–´ì•¼ í•œë‹¤. ì¦‰, put_oldê°€ ê°€ë¦¬í‚¤ëŠ” ê²½ë¡œëª… ì•ì— â€œ/..â€ë¥¼ 0ê°œ ì´ìƒ ë¶™ì—¬ì„œ new_rootì™€ ê°™ì€ ë””ë ‰í„°ë¦¬ê°€ ë‚˜ì™€ì•¼ í•œë‹¤.</li>
      <li>new_rootê°€ ë§ˆìš´íŠ¸ ì§€ì ì˜ ê²½ë¡œì—¬ì•¼ í•˜ë˜, â€œ/â€ì¼ ìˆ˜ ì—†ë‹¤. ë§ˆìš´íŠ¸ ì§€ì ì´ ì•„ë‹Œ ê²½ìš°ì—ëŠ” ê·¸ ê²½ë¡œë¥¼ ìŠ¤ìŠ¤ë¡œì—ê²Œ ë°”ì¸ë“œ ë§ˆìš´íŠ¸ í•´ì„œ ë§ˆìš´íŠ¸ ì§€ì ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.</li>
      <li>new_rootì˜ ë¶€ëª¨ ë§ˆìš´íŠ¸ ë° í˜„ì¬ ì‘ì—… ë””ë ‰í„°ë¦¬ì˜ ë¶€ëª¨ ë§ˆìš´íŠ¸ì˜ ì „íŒŒ ìœ í˜•ì´ MS_SHAREDì—¬ì„  ì•ˆ ëœë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ put_oldê°€ ê¸°ì¡´ ë§ˆìš´íŠ¸ ì§€ì ì¸ ê²½ìš° ê·¸ ì „íŒŒ ìœ í˜•ì´ MS_SHAREDì—¬ì„  ì•ˆ ëœë‹¤. ì´ ì œì•½ì€ pivot_root()ë¡œ ì¸í•´ ë‹¤ë¥¸ ë§ˆìš´íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ì–´ë–¤ ë³€í™”ë„ ì „íŒŒë˜ì§€ ì•Šê²Œ í•œë‹¤.</li>
      <li>í˜„ì¬ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ê°€ ë§ˆìš´íŠ¸ ì§€ì ì´ì–´ì•¼ í•œë‹¤.</li>
    </ul>
  </li>
  <li>ì‹¤ìŠµì„ í†µí•´ ë§ˆìš´íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ pivot_rootë¥¼ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<h4 id="ì‹¤ìŠµ">ì‹¤ìŠµ</h4>

<ul>
  <li>ë¨¼ì € pivot_rootë¡œ root ë””ë ‰í„°ë¦¬ë¡œ ë§Œë“¤ /tmp/new_rootë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ìœ„ì˜ ì œì•½ì‚¬í•­ ì¤‘ new_rootì™€ put_oldê°€ í˜„ì¬ ë£¨íŠ¸ì™€ ê°™ì€ ë§ˆìš´íŠ¸ ìƒì— ìˆì–´ì„œëŠ” ì•ˆ ë˜ê¸° ë•Œë¬¸ì— new_rootë¥¼ tmpfs ë¡œ ë§ˆìš´íŠ¸ í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> /tmp/new_root
<span class="c"># ë§ˆìš´íŠ¸</span>
<span class="nv">$ </span>mount <span class="nt">-t</span> tmpfs tmpfs /tmp/new_root 
<span class="c"># ê¸°ì¡´ ë£¨íŠ¸ë¥¼ ì´ë™ì‹œí‚¬ /tmp/new_root/put_old ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ê¸°</span>
<span class="nv">$ </span><span class="nb">mkdir</span> /tmp/new_root/put_old
<span class="c"># /bin, /lib, /lib64 ë“± chroot ì‹¤ìŠµë•Œ ì‚¬ìš©í–ˆë˜ /tmp/myrootë¥¼ /tmp/new_root ë¡œ ë³µì‚¬í•´ì„œ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-rv</span> /tmp/myroot/<span class="k">*</span> /tmp/new_root 

<span class="nv">$ </span>mount <span class="nt">-t</span> proc proc /tmp/new_root/proc

<span class="c"># unshare í•´ì„œ ë§ˆìš´íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</span>
<span class="nv">$ </span>unshare <span class="nt">--mount</span> /bin/bash 

<span class="nv">$ </span><span class="nb">cd</span> /tmp/new_root

<span class="c"># pivot_rootë¥¼ ì‹¤í–‰</span>
<span class="nv">$ </span>pivot_root <span class="nb">.</span> put_old

<span class="c"># ìƒˆë¡œìš´ ë£¨íŠ¸ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤.</span>

<span class="c"># ìƒˆ ë£¨íŠ¸ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">ls</span> / 
<span class="c"># =&gt; bin  dev  escape_chroot  lib  lib64  proc  put_old</span>

<span class="c"># ê¸°ì¡´ ë£¨íŠ¸ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">ls</span> /put_old
<span class="c"># =&gt; bin   dev  home        lib32  lost+found   mnt     proc  run   srv	  sys       usr  vmlinuz</span>
<span class="c">#    boot  etc  initrd.img  lib	   lib64        media   opt   root  sbin  swapfile  tmp  var  </span>
</code></pre></div></div>

<ul>
  <li>ìƒˆë¡œìš´ ë£¨íŠ¸ë¡œ ì´ë™ë˜ì—ˆì§€ë§Œ, ê¸°ì¡´ ë£¨íŠ¸ì— ìˆëŠ” íŒŒì¼ë“¤ì„ ì‚­ì œí•˜ê±°ë‚˜ ì´ë™í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— /put_oldë¡œ ê¸°ì¡´ ë£¨íŠ¸ì— ìˆëŠ” íŒŒì¼ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>í•˜ì§€ë§Œ umountë¥¼ ì‚¬ìš©í•˜ë©´ /put_oldì™€ ê¸°ì¡´ ë£¨íŠ¸ì˜ ì—°ê²°ì„ ëŠì–´ì„œ ê¸°ì¡´ ë£¨íŠ¸ë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>umount <span class="nt">-l</span> /put_old

<span class="nv">$ </span><span class="nb">ls</span> /put_old
<span class="c"># =&gt; (ê³µë°±)</span>
</code></pre></div></div>

<ul>
  <li>escape_rootë¥¼ í†µí•´ íƒˆì˜¥ì„ ì‹œë„í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íƒˆì˜¥ ì‹œë„</span>
<span class="nv">$ </span>/escape_chroot
<span class="nv">$ </span><span class="nb">ls</span> /
<span class="c"># =&gt; bin  dev  escape_chroot  lib  lib64  proc  put_old</span>
<span class="nv">$ </span><span class="nb">cd</span> ../../..
<span class="nv">$ </span>/escape_chroot
<span class="nv">$ </span><span class="nb">ls</span> /
<span class="c"># =&gt; bin  dev  escape_chroot  lib  lib64  proc  put_old</span>
</code></pre></div></div>

<ul>
  <li>chrootì™€ ë‹¬ë¦¬ pivot_rootëŠ” íƒˆì˜¥ì´ ë¶ˆê°€ëŠ¥í•˜ê³  í›¨ì”¬ ì•ˆì „í•œê²ƒ ê°™ìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_14.png" alt="img.png" /></p>

<h3 id="ë„¤ì„ìŠ¤í˜ì´ìŠ¤-namespace">ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (namespace)</h3>

<ul>
  <li>ì—¬ê¸°ì—ì„œì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ë“±ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ëŠ” ë‹¤ë¥¸,
ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì—ì„œ ì œê³µí•˜ëŠ” í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬ ê¸°ìˆ ë¡œ, í”„ë¡œì„¸ìŠ¤ê°€ ê°ì¢… ìì›ì„ ê²©ë¦¬í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.</li>
  <li>ì£¼ìš” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ìœ í˜•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
    <ul>
      <li>Mount Namespace (2002ë…„ ë„ì…)
        <ul>
          <li>pivot_root ì˜ˆì œì—ì„œ ì²˜ëŸ¼ ë§ˆìš´íŠ¸ ì •ë³´ë¥¼ ê²©ë¦¬í•©ë‹ˆë‹¤.</li>
          <li>ì¦‰, ì„œë¡œ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ë…ë¦½ì ìœ¼ë¡œ íŒŒì¼ ì‹œìŠ¤í…œì„ ë§ˆìš´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>UTS Namespace (2006ë…„ ë„ì…)
        <ul>
          <li>í˜¸ìŠ¤íŠ¸ ì´ë¦„ê³¼ NIS ë„ë©”ì¸ ì´ë¦„ì„ ê²©ë¦¬í•©ë‹ˆë‹¤. ê° ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ìì²´ í˜¸ìŠ¤íŠ¸ ì´ë¦„ê³¼ NIS ë„ë©”ì¸ ì´ë¦„ì„ ê°€ì§ˆ ìˆ˜ ìˆê³ ,
ì´ë¥¼ í†µí•´ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ë³€ê²½í•˜ë”ë¼ë„ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>IPC Namespace (2006ë…„ ë„ì…)
        <ul>
          <li>POSIX ë©”ì‹œì§€ í, ì„¸ë§ˆí¬ì–´, ê³µìœ  ë©”ëª¨ë¦¬ ê°™ì€ IPC ë¦¬ì†ŒìŠ¤ë¥¼ ê²©ë¦¬í•©ë‹ˆë‹¤.</li>
          <li>ì´ë¥¼ í†µí•´ ì„œë¡œ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ë…ë¦½ì ìœ¼ë¡œ System V IPC ê°ì²´ì™€ POSIX ë©”ì‹œì§€ íë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>PID Namespace (2008ë…„ ë„ì…)
        <ul>
          <li>í”„ë¡œì„¸ìŠ¤ IDë¥¼ ê²©ë¦¬í•©ë‹ˆë‹¤. ê° ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ìì²´ PIDë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìœ¼ë©° ìì²´ì ì¸ PID 1ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
          <li>í”„ë¡œì„¸ìŠ¤ IDê°€ 1ì¸ê²ƒì€ ì‹œìŠ¤í…œ ì‹œì‘ì‹œì— ìµœì´ˆë¡œ ì‹¤í–‰ëœ ê²ƒì´ë©° ì´ë¥¼ init í”„ë¡œì„¸ìŠ¤ë¼ê³  í•©ë‹ˆë‹¤. ì´ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ë©´ 
ì‹œìŠ¤í…œì´ ì¢…ë£Œë˜ê±°ë‚˜ ë‹¤ì‹œ ë¶€íŒ…ë©ë‹ˆë‹¤. ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì‹œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œê·¸ë¨ì´ PIDê°€ 1ì´ê³ , í•´ë‹¹ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë˜ë©° 
ì»¨í…Œì´ë„ˆë„ ì¢…ë£Œë˜ëŠ”ê²Œ ì´ë•Œë¬¸ì…ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>Network Namespace (2009ë…„ ë„ì…)
        <ul>
          <li>ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤, IP ì£¼ì†Œ, ë¼ìš°íŒ… í…Œì´ë¸”, ë°©í™”ë²½ ê·œì¹™ ë“± ë„¤íŠ¸ì›Œí¬ ë¦¬ì†ŒìŠ¤ë¥¼ ê²©ë¦¬í•©ë‹ˆë‹¤.</li>
          <li>ê° ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ìì²´ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤, IP ì£¼ì†Œ, ë¼ìš°íŒ… í…Œì´ë¸”, ë°©í™”ë²½ ê·œì¹™ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>USER Namespace (2012ë…„ ë„ì…)
        <ul>
          <li>ì‚¬ìš©ì IDì™€ ê·¸ë£¹ IDë¥¼ ê²©ë¦¬í•©ë‹ˆë‹¤. ê° ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ìì²´ ì‚¬ìš©ì IDì™€ ê·¸ë£¹ IDë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
          <li>ì´ë¥¼ í†µí•´ root ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìë„ ì¼ë°˜ ì‚¬ìš©ìë¡œ ê²©ë¦¬í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ì¼ë°˜ ì‚¬ìš©ìë„ root ì¸ê²ƒ ì²˜ëŸ¼ ë³´ì´ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
          <li>ì‹¤í–‰ ì¤‘ì¸ ë„ì»¤ì»¨í…Œì´ë„ˆì—ì„œëŠ” psë¡œ í™•ì¸ì‹œ rootë¡œ ì‹¤í–‰ ì¤‘ì¸ë°, í˜¸ìŠ¤íŠ¸ì—ì„œ psë¡œ í™•ì¸ì‹œ ì¼ë°˜ ì‚¬ìš©ìë¡œ ì‹¤í–‰ ì¤‘ì¸ê²ƒ ì²˜ëŸ¼ ë³´ì´ëŠ”ê²ƒë„ ì´ê²ƒ ë•Œë¬¸ì…ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>CGROUP Namespace (2016ë…„ ë„ì…)
        <ul>
          <li>CGROUPì€ í”„ë¡œì„¸ìŠ¤ì˜ ê·¸ë£¹ìœ¼ë¡œ CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ I/O, ë„¤íŠ¸ì›Œí¬ ë“±ì˜ ìì›ì„ ì œí•œí•˜ê±°ë‚˜ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
          <li>CGROUP NamespaceëŠ” CPU, ë©”ëª¨ë¦¬ ë“±ì˜ ìì›ì„ ì œí•œí•˜ê±°ë‚˜ í• ë‹¹í•  ìˆ˜ ìˆëŠ” CGROUPì„ ê²©ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="cgroup-ë¥¼-ì´ìš©í•œ-ìì›ê´€ë¦¬">cgroup ë¥¼ ì´ìš©í•œ ìì›ê´€ë¦¬</h3>

<ul>
  <li>cgroupsëŠ” control groupsì˜ ì¤„ì¼ë§ë¡œ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì—ì„œ ì œê³µí•˜ëŠ” ìì› ì œí•œ ë° í• ë‹¹ ê¸°ëŠ¥ìœ¼ë¡œ, CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ I/O, ë„¤íŠ¸ì›Œí¬ ë“±ì˜ ìì›ì„ ì œí•œí•˜ê±°ë‚˜ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>í”„ë¡œì„¸ìŠ¤ëŠ” ì‹¤í–‰ì¤‘ì¸ í”„ë¡œê·¸ë¨ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì˜ë¯¸í•˜ë©°, OSì—ì„œëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ í”„ë¡œì„¸ìŠ¤ ID(PID)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>cgroupsëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ì„œ ìì›ì„ ì œí•œí•˜ê±°ë‚˜ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>cgroupsëŠ” /sys/fs/cgroup ë””ë ‰í„°ë¦¬ì— ë§ˆìš´íŠ¸ë˜ì–´ ìˆìœ¼ë©°, cgroup v1ê³¼ cgroup v2ê°€ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cgroup ë²„ì „ í™•ì¸</span>
<span class="nv">$ </span>mount | <span class="nb">grep </span>cgroup
<span class="c"># =&gt; cgroup2 on /sys/fs/cgroup type cgroup2 (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot)</span>
</code></pre></div></div>

<ul>
  <li>í˜„ì¬ í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œì—ëŠ” cgroup v2ê°€ ì‚¬ìš©ë˜ê³  ìˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>cgroup v2ëŠ” v1ì— ë¹„í•´ ìì› ê³„ì¸µêµ¬ì¡°ì˜ ê°€ì‹œì„±ì´ í–¥ìƒ ë˜ì—ˆê³ , memoryQoS ë¼ëŠ” ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì–´ ì»¨í…Œì´ë„ˆì—ì„œ OOM(Out Of Memory)ì´
ë°œìƒê°€ëŠ¥ì„±ì„ ì¤„ì˜€ìŠµë‹ˆë‹¤. ìµœì‹  ë¦¬ëˆ…ìŠ¤ ë°°í¬íŒì€ ë³´í†µ cgroup v2ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ cgroup v2ë¡œ ì‹¤ìŠµì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.</li>
  <li>cgroupì˜ ê³„ì¸µ êµ¬ì¡°ëŠ” /sys/fs/cgroup ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>/procëŠ” ë³´ì•˜ì§€ë§Œ /sysëŠ” ëˆˆì— ìµì§€ ì•ŠìŠµë‹ˆë‹¤. ë¦¬ëˆ…ìŠ¤ ì»¤ë„ 3.x ë²„ì „ì—ì„œ ìƒê¸´ê²ƒìœ¼ë¡œ USER SPACE ìª½ì€ /procì— KERNEL SPACE ìª½ ì •ë³´ëŠ” /sysì— ë“¤ì–´ê°„ë‹¤ê³  í•©ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_23.png" alt="img.png" class="image-center" />
<em class="image-caption">ì¶œì²˜ : <a href="https://blog.naver.com/yu3papa/223562337709">https://blog.naver.com/yu3papa/223562337709</a></em></p>

<ul>
  <li>ì‹¤ìŠµì„ í†µí•´ cgroupì˜ ì •ë³´ë¥¼ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mount <span class="nt">-t</span> cgroup
<span class="nv">$ </span>mount <span class="nt">-t</span> cgroup2
<span class="c"># =&gt; cgroup2 on /sys/fs/cgroup type cgroup2 (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot)</span>

<span class="nv">$ </span>findmnt <span class="nt">-t</span> cgroup2
<span class="c"># =&gt; TARGET         SOURCE  FSTYPE  OPTIONS</span>
<span class="c">#    /sys/fs/cgroup cgroup2 cgroup2 rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot</span>

<span class="c"># cgroupv1 ë§Œ ì§€ì› ì‹œ, cgroup2 ì¶œë ¥ë˜ì§€ ì•ŠìŒ</span>
<span class="nv">$ </span><span class="nb">grep </span>cgroup /proc/filesystems
<span class="c"># =&gt; nodev   cgroup</span>
<span class="c">#    nodev   cgroup2</span>

<span class="nv">$ </span><span class="nb">stat</span> <span class="nt">-fc</span> %T /sys/fs/cgroup/
<span class="c"># =&gt; cgroup2fs</span>

<span class="c"># í„°ë¯¸ë„2</span>
<span class="nv">$ </span><span class="nb">sleep </span>100000

<span class="c"># í„°ë¯¸ë„1</span>
<span class="c"># /proc ì— cgroup ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> /proc/cgroups
<span class="nv">$ </span><span class="nb">cat</span> /proc/<span class="si">$(</span>pgrep <span class="nb">sleep</span><span class="si">)</span>/cgroup
<span class="c"># =&gt; 0::/user.slice/user-1000.slice/session-713.scope</span>

<span class="nv">$ </span>tree /proc/<span class="si">$(</span>pgrep <span class="nb">sleep</span><span class="si">)</span> <span class="nt">-L</span> 2
<span class="c"># =&gt; ...</span>
<span class="c">#    |-- &lt;span style="font-weight:bold;color:blue;"&gt;ns&lt;/span&gt;</span>
<span class="c">#    |   |-- &lt;span style="font-weight:bold;color:teal;"&gt;cgroup&lt;/span&gt; -&amp;gt; cgroup:[4026531835]</span>
<span class="c">#    |   |-- &lt;span style="font-weight:bold;color:teal;"&gt;ipc&lt;/span&gt; -&amp;gt; ipc:[4026531839]</span>
<span class="c">#    |   |-- &lt;span style="font-weight:bold;color:teal;"&gt;mnt&lt;/span&gt; -&amp;gt; mnt:[4026531841]</span>
<span class="c">#    |   |-- &lt;span style="font-weight:bold;color:teal;"&gt;net&lt;/span&gt; -&amp;gt; net:[4026531840]</span>
<span class="c">#    ...</span>

<span class="c"># cgroup ëª©ë¡ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">ls</span> /sys/fs/cgroup
<span class="nv">$ </span><span class="nb">cat</span> /sys/fs/cgroup/cgroup.controllers
<span class="c"># =&gt; cpuset cpu io memory hugetlb pids rdma misc</span>
<span class="nv">$ </span>tree /sys/fs/cgroup/ <span class="nt">-L</span> 1
<span class="nv">$ </span>tree /sys/fs/cgroup/ <span class="nt">-L</span> 2
<span class="nv">$ </span>tree /sys/fs/cgroup/user.slice <span class="nt">-L</span> 1
<span class="nv">$ </span>tree /sys/fs/cgroup/user.slice/user-1000.slice <span class="nt">-L</span> 1
</code></pre></div></div>

<ul>
  <li>ì´ë²ˆì—ëŠ” cgroupì„ ì´ìš©í•˜ì—¬ ìì›ì„ ì œí•œí•˜ëŠ” ì‹¤ìŠµì„ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„ 2ê°œë¥¼ ì—´ì–´ì„œ root ë¡œ ì‹¤ìŠµ í•˜ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
<span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; root</span>

<span class="c"># íˆ´ ì„¤ì¹˜</span>
<span class="nv">$ </span>apt <span class="nb">install</span> <span class="nt">-y</span> cgroup-tools stress htop

<span class="c"># í„°ë¯¸ë„2</span>
<span class="c"># CPU ì‚¬ìš©ë¥  í™•ì¸ì„ ìœ„í•´ htopì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>htop

<span class="c"># í„°ë¯¸ë„1ì—ì„œ ì‹¤ìŠµ ì§„í–‰</span>

<span class="c"># 1ê°œ CPU ì½”ì–´ì— ë¶€í•˜ ë°œìƒì„ ìœ„í•´ stressë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>stress <span class="nt">--cpu</span> 1
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_25.png" alt="img.png" /></p>

<ul>
  <li>CPU 0ë§Œ 100% ì‚¬ìš©ì¤‘ì¸ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /sys/fs/cgroup
<span class="nv">$ </span><span class="nb">mkdir </span>test_cgroup_parent <span class="o">&amp;&amp;</span> <span class="nb">cd </span>test_cgroup_parent
<span class="nv">$ </span>tree

<span class="c"># ì œì–´ê°€ëŠ¥í•œ í•­ëª© í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>cgroup.controllers
<span class="c"># =&gt; cpuset cpu io memory hugetlb pids rdma misc</span>

<span class="c"># cpuë¥¼ subtreeì´ ì¶”ê°€í•˜ì—¬ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆë„ë¡ ì„¤ì • : +/-(ì¶”ê°€/ì‚­ì œ) </span>
<span class="nv">$ </span><span class="nb">cat </span>cgroup.subtree_control
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"+cpu"</span> <span class="o">&gt;&gt;</span> /sys/fs/cgroup/test_cgroup_parent/cgroup.subtree_control

<span class="c"># cpu.max ì œí•œ ì„¤ì • : ì²« ë²ˆì¨° ê°’ì€ í—ˆìš©ëœ ì‹œê°„(ë§ˆì´í¬ë¡œì´ˆ) ë‘ ë²ˆì§¸ ê°’ì€ ì´ ê¸°ê°„ ê¸¸ì´ &gt; 1/10 ì‹¤í–‰ ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">echo </span>100000 1000000 <span class="o">&gt;</span> /sys/fs/cgroup/test_cgroup_parent/cpu.max

<span class="c"># testìš© ìì‹ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ê³ , pidë¥¼ ì¶”ê°€í•˜ì—¬ ì œí•œì„ ê±¸ì–´</span>
<span class="nv">$ </span><span class="nb">mkdir </span>test_cgroup_child <span class="o">&amp;&amp;</span> <span class="nb">cd </span>test_cgroup_child
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$$</span> <span class="o">&gt;</span> /sys/fs/cgroup/test_cgroup_parent/test_cgroup_child/cgroup.procs
<span class="nv">$ </span><span class="nb">cat</span> /sys/fs/cgroup/test_cgroup_parent/test_cgroup_child/cgroup.procs
<span class="c"># =&gt; 1947587</span>
<span class="c">#    2194781</span>
<span class="nv">$ </span><span class="nb">cat</span> /proc/<span class="nv">$$</span>/cgroup
<span class="c"># =&gt; 0::/test_cgroup_parent/test_cgroup_child</span>

<span class="c"># ë¶€í•˜ ë°œìƒ í™•ì¸ : í„°ë¯¸ë„2ì— htop í™•ì¸</span>
<span class="nv">$ </span>stress <span class="nt">--cpu</span> 1
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_26.png" alt="img.png" /></p>

<ul>
  <li>cpu.max ì œí•œ ì„¤ì •ì—ì„œ ì„¤ì •í•œ ëŒ€ë¡œ (100000/1000000 =&gt; 10%) CPU ì‚¬ìš©ëŸ‰ì´ 10%ë¡œ ì œí•œëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ê°’ ìˆ˜ì •ì„ í•´ì„œ 100%ë¡œ ë³€ê²½í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ê°’ ìˆ˜ì •</span>
<span class="nv">$ </span><span class="nb">echo </span>1000000 1000000 <span class="o">&gt;</span> /sys/fs/cgroup/test_cgroup_parent/cpu.max

<span class="c"># ë¶€í•˜ ë°œìƒ í™•ì¸ : í„°ë¯¸ë„2ì— htop í™•ì¸</span>
<span class="nv">$ </span>stress <span class="nt">--cpu</span> 1
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_27.png" alt="img.png" /></p>

<ul>
  <li>í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•œ cgroup ì„ ì‚­ì œí•˜ê³  ì‹¤ìŠµì„ ë§ˆë¬´ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">exit</span>
<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
<span class="nv">$ </span><span class="nb">rmdir</span> /sys/fs/cgroup/test_cgroup_parent/test_cgroup_child
<span class="nv">$ </span><span class="nb">rmdir</span> /sys/fs/cgroup/test_cgroup_parent
</code></pre></div></div>

<ul>
  <li>ì´ìƒê³¼ ê°™ì´ cgroupì„ ì‚¬ìš©í•˜ì—¬ cpu ìì›ì„ ì œí•œí•˜ëŠ”ê²ƒì„ ì‹¤ìŠµí•´ ë³´ì•˜ìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_24.png" alt="img.png" class="image-center" /></p>

<hr />

<h2 id="ì»¨í…Œì´ë„ˆ-ë„¤íŠ¸ì›Œí¬--iptables">ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ &amp; Iptables</h2>

<ul>
  <li>ë„ì»¤ëŠ” í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆê°„, ì»¨í…Œì´ë„ˆ ê°„ì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ì•ì—ì„œ ì‚´í´ë³¸ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ í†µí•´ ê²©ë¦¬í•©ë‹ˆë‹¤.</li>
  <li>ë˜í•œ iptablesë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ ì œì–´í•˜ê³ , ì»¨í…Œì´ë„ˆ ê°„ì˜ í†µì‹ ì„ ì œì–´í•©ë‹ˆë‹¤.</li>
  <li>ì‹¤ìŠµì„ í†µí•´ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ í†µí•œ ê²©ë¦¬ì™€ iptablesì˜ ì‚¬ìš©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<h3 id="red--blue-ë„¤íŠ¸ì›Œí¬-ë„¤ì„ìŠ¤í˜ì´ìŠ¤-ê°„-í†µì‹ ">Red &lt;=&gt; Blue ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê°„ í†µì‹ </h3>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_17.png" alt="img.png" />
<a href="https://www.slideshare.net/slideshow/make-container-withoutdocker6overlaynetwork1/248297122">ì¶œì²˜ : ë„ì»¤ì—†ì´ ì»¨í…Œì´ë„ˆ ë§Œë“¤ê¸°</a></p>

<ul>
  <li>ë¨¼ì € í„°ë¯¸ë„ 3ê°œë¥¼ ì—´ê³  ëª¨ë‘ ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
<span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; root</span>
</code></pre></div></div>

<ul>
  <li>veth (Virtual Ethernet)ë¥¼ ì‚¬ìš©í•˜ì—¬ Redì™€ Blue ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë§Œë“­ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ip <span class="nb">link </span>add veth0 <span class="nb">type </span>veth peer name veth1

<span class="c"># veth ìƒì„± í™•ì¸ (ìƒíƒœ DOWN)</span>
<span class="nv">$ </span>ip <span class="nb">link</span>
<span class="c"># =&gt; 22: &lt;span style="color:teal;"&gt;veth1@veth0: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,M-DOWN&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;mode DEFAULT group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;9e:74:34:5c:70:ef&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt;</span>
<span class="c">#    23: &lt;span style="color:teal;"&gt;veth0@veth1: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,M-DOWN&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;mode DEFAULT group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;72:c0:05:36:cd:1b&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt;</span>
<span class="nv">$ </span>ip addr | <span class="nb">grep </span>veth
<span class="c"># =&gt; 22: &lt;span style="color:teal;"&gt;veth1@veth0: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,M-DOWN&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;9e:74:34:5c:70:ef&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt;</span>
<span class="c">#    23: &lt;span style="color:teal;"&gt;veth0@veth1: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,M-DOWN&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;72:c0:05:36:cd:1b&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt;</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±</span>
<span class="nv">$ </span>ip netns add RED
<span class="nv">$ </span>ip netns add BLUE

<span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>ip netns
<span class="c"># =&gt; RED</span>
<span class="c">#    BLUE</span>

<span class="c"># veth0ì™€ veth1ì„ ê°ê° REDì™€ BLUE ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.</span>
<span class="nv">$ </span>ip <span class="nb">link set </span>veth0 netns RED  
<span class="nv">$ </span>ip <span class="nb">link set </span>veth1 netns BLUE

<span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸. id ë¼ëŠ”ê²ƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>ip netns list
<span class="c"># =&gt; RED (id: 0)</span>
<span class="c">#    BLUE (id: 1)</span>

<span class="c"># ip ë§í¬ë¥¼ í™•ì¸í•˜ë©´ veth0ì™€ veth1ì´ ê°ê° REDì™€ BLUE ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ì´ë™ë˜ì–´ ê¸°ë³¸ ëª…ë ¹ì—ì„œëŠ” ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>ip <span class="nb">link</span> | <span class="nb">grep</span> <span class="s2">"veth."</span>
<span class="c"># =&gt; (ê³µë°±)</span>

<span class="c"># ip netns exec [ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëª…] [ëª…ë ¹] ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED ip <span class="nb">link</span>
<span class="c"># =&gt; 1: &lt;span style="color:teal;"&gt;lo: &lt;/span&gt;&amp;lt;LOOPBACK&amp;gt; mtu 65536 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;mode DEFAULT group default qlen 1000</span>
<span class="c">#        link/loopback &lt;span style="color:olive;"&gt;00:00:00:00:00:00&lt;/span&gt; brd &lt;span style="color:olive;"&gt;00:00:00:00:00:00&lt;/span&gt;</span>
<span class="c">#    23: &lt;span style="color:teal;"&gt;veth0@if22: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;mode DEFAULT group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;72:c0:05:36:cd:1b&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netns BLUE</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip <span class="nb">link</span>
<span class="c"># =&gt; 1: &lt;span style="color:teal;"&gt;lo: &lt;/span&gt;&amp;lt;LOOPBACK&amp;gt; mtu 65536 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;mode DEFAULT group default qlen 1000</span>
<span class="c">#        link/loopback &lt;span style="color:olive;"&gt;00:00:00:00:00:00&lt;/span&gt; brd &lt;span style="color:olive;"&gt;00:00:00:00:00:00&lt;/span&gt;</span>
<span class="c">#    22: &lt;span style="color:teal;"&gt;veth1@if23: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;mode DEFAULT group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;9e:74:34:5c:70:ef&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netns RED</span>

<span class="c"># veth0ê³¼ veth1ì„ í™œì„±í™” (UP) ì‹œí‚¤ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED ip <span class="nb">link set </span>veth0 up
<span class="c"># veth0ì˜ IP í™•ì¸</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED ip addr
<span class="c"># =&gt; ...</span>
<span class="c">#    23: &lt;span style="color:teal;"&gt;veth0@if22: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state &lt;span style="color:green;"&gt;UP &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;72:c0:05:36:cd:1b&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netns BLUE</span>
<span class="c">#        inet6 &lt;span style="color:blue;"&gt;fe80::70c0:5ff:fe36:cd1b&lt;/span&gt;/64 scope link proto kernel_ll </span>
<span class="c">#           valid_lft forever preferred_lft forever</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip <span class="nb">link set </span>veth1 up
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip addr
<span class="c"># =&gt; ...</span>
<span class="c">#    22: &lt;span style="color:teal;"&gt;veth1@if23: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state &lt;span style="color:green;"&gt;UP &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;9e:74:34:5c:70:ef&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netns RED</span>
<span class="c">#        inet6 &lt;span style="color:blue;"&gt;fe80::9c74:34ff:fe5c:70ef&lt;/span&gt;/64 scope link proto kernel_ll </span>
<span class="c">#           valid_lft forever preferred_lft forever</span>

<span class="c"># UP ìƒíƒœë¡œ ë˜ì—ˆìœ¼ë‚˜ IPê°€ ì—†ìŠµë‹ˆë‹¤. IPë¥¼ í• ë‹¹í•´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED ip addr add 11.11.11.2/24 dev veth0
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip addr add 11.11.11.3/24 dev veth1

<span class="c"># IP ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED ip addr
<span class="c"># =&gt; ...</span>
<span class="c">#    23: &lt;span style="color:teal;"&gt;veth0@if22: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state &lt;span style="color:green;"&gt;UP &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;72:c0:05:36:cd:1b&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netns BLUE</span>
<span class="c">#        inet &lt;span style="color:purple;"&gt;11.11.11.2&lt;/span&gt;/24 scope global veth0</span>
<span class="c">#           valid_lft forever preferred_lft forever</span>
<span class="c">#        inet6 &lt;span style="color:blue;"&gt;fe80::70c0:5ff:fe36:cd1b&lt;/span&gt;/64 scope link proto kernel_ll </span>
<span class="c">#           valid_lft forever preferred_lft forever</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip addr
<span class="c"># =&gt; ...</span>
<span class="c">#    22: &lt;span style="color:teal;"&gt;veth1@if23: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state &lt;span style="color:green;"&gt;UP &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;9e:74:34:5c:70:ef&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netns RED</span>
<span class="c">#        inet &lt;span style="color:purple;"&gt;11.11.11.3&lt;/span&gt;/24 scope global veth1</span>
<span class="c">#           valid_lft forever preferred_lft forever</span>
<span class="c">#        inet6 &lt;span style="color:blue;"&gt;fe80::9c74:34ff:fe5c:70ef&lt;/span&gt;/64 scope link proto kernel_ll </span>
<span class="c">#           valid_lft forever preferred_lft forever</span>
</code></pre></div></div>

<ul>
  <li>ì´ì œ Redì™€ Blue ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê°„ì˜ í†µì‹ ì„ í…ŒìŠ¤íŠ¸ í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">nsenter</code> ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ì— attach í•˜ê³ , <code class="language-plaintext highlighter-rouge">tcpdump</code>ì™€ <code class="language-plaintext highlighter-rouge">ping</code>ì„ ì‚¬ìš©í•˜ì—¬ í†µì‹ ì„ í™•ì¸í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">tcpdump</code>ëŠ” ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ ìº¡ì²˜í•˜ëŠ” ëª…ë ¹ì–´ë¡œ, íŒ¨í‚·ì„ ìº¡ì²˜í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆê³ , <code class="language-plaintext highlighter-rouge">ping</code>ì€ ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tree /var/run/netns
<span class="c"># =&gt; &lt;span style="font-weight:bold;color:blue;"&gt;/var/run/netns&lt;/span&gt;</span>
<span class="c">#    |-- BLUE</span>
<span class="c">#    `-- RED</span>
<span class="c">#    </span>
<span class="c">#    1 directory, 2 files</span>

<span class="c"># í„°ë¯¸ë„ 1 (RED 11.11.11.2)</span>
<span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— attach. </span>
<span class="c"># ì´ë•Œ --net ì˜µì…˜ì„ ì‚¬ìš©í•´ ì•ì—ì„œ í™•ì¸í•œ /var/run/netns/REDë¥¼ ì‚¬ìš©í•´ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— attach í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>nsenter <span class="nt">--net</span><span class="o">=</span>/var/run/netns/RED
<span class="c"># ì´ì›ƒí•˜ëŠ” IP/ARP ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ip neigh
<span class="c"># =&gt; (ê³µë°±)</span>
<span class="c"># ë¼ìš°íŒ… ì •ë³´, iptables ì •ë³´</span>
<span class="nv">$ </span>ip route
<span class="c"># =&gt; &lt;span style="color:purple;"&gt;11.11.11.0/24 &lt;/span&gt;dev &lt;span style="color:teal;"&gt;veth0 &lt;/span&gt;proto kernel scope link src &lt;span style="color:purple;"&gt;11.11.11.2 &lt;/span&gt;</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-S</span> 

<span class="c"># í„°ë¯¸ë„ 2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒíƒœ í™•ì¸</span>
<span class="nv">$ </span>lsns <span class="nt">-t</span> net
<span class="c"># =&gt;         NS TYPE NPROCS     PID USER     NETNSID NSFS            COMMAND</span>
<span class="c">#    ...</span>
<span class="c">#    4026532444 net       1 1940569 root           0 /run/netns/RED  -zsh</span>
<span class="c">#    4026532527 net       0         root             /run/netns/BLUE</span>
<span class="c"># ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ip addr 
<span class="nv">$ </span>ip neigh
<span class="nv">$ </span>ip route
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-S</span> 

<span class="c"># í„°ë¯¸ë„ 3 (BLUE 11.11.11.3)</span>
<span class="nv">$ </span>nsenter <span class="nt">--net</span><span class="o">=</span>/var/run/netns/BLUE
<span class="nv">$ </span>ip neigh
<span class="nv">$ </span>ip route
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-S</span> 

<span class="c"># ping í†µì‹  í™•ì¸</span>

<span class="c"># í„°ë¯¸ë„3 (BLUE)</span>
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> veth1
<span class="nv">$ </span>ip <span class="nt">-c</span> neigh
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># í„°ë¯¸ë„1 (RED)</span>
<span class="nv">$ </span>ping 11.11.11.3 <span class="nt">-c</span> 1 
<span class="nv">$ </span>ip <span class="nt">-c</span> neigh
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ</span>
<span class="nv">$ </span>ip netns del RED
<span class="nv">$ </span>ip netns del BLUE 
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_15.png" alt="img.png" /></p>

<ul>
  <li>ìœ„ì˜ ìº¡ì³ì™€ ê°™ì´ í†µì‹ ì´ ë˜ì–´ì„œ tcpdumpì— ARP, ICMP íŒ¨í‚·ì´ ì¡íˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë˜í•œ <code class="language-plaintext highlighter-rouge">ip neigh</code> ëª…ë ¹ì„ í™•ì¸í–ˆì„ë•Œ ARP í…Œì´ë¸”ì— ìƒëŒ€ë°©ì˜ IPì™€ MAC ì£¼ì†Œê°€ ë“±ë¡ë˜ì–´ ìˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<h3 id="red---bridge-br0---blue-ë„¤íŠ¸ì›Œí¬-ë„¤ì„ìŠ¤í˜ì´ìŠ¤-ê°„-í†µì‹ ">Red &lt;- Bridge (br0) -&gt; Blue ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê°„ í†µì‹ </h3>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_16.png" alt="img.png" />
<a href="https://www.slideshare.net/slideshow/make-container-withoutdocker6overlaynetwork1/248297122">ì¶œì²˜ : ë„ì»¤ì—†ì´ ì»¨í…Œì´ë„ˆ ë§Œë“¤ê¸°</a></p>

<ul>
  <li>ì´ì „ ì‹¤ìŠµì—ì„œëŠ” Redì™€ Blueë¥¼ ì—°ê²°í•˜ì—¬ peer ë„¤íŠ¸ì›Œí¬ë¡œ êµ¬ì„±í•˜ì˜€ëŠ”ë°, 
ì´ë²ˆì—ëŠ” ê°ê° ë…ë¦½ì ì¸ ë„¤íŠ¸ì›Œí¬ë¡œ êµ¬ì„±í•˜ì—¬ Bridgeë¥¼ ì‚¬ìš©í•˜ì—¬ Redì™€ Blue ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê°„ì˜ í†µì‹ ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ì™œ Bridgeë¥¼ ë‘ëŠ”ê°€ í•˜ë©´, peer ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•  ê²½ìš° êµ¬ì„±ì›ë“¤ ê°„ì˜ í†µì‹ ì„ ìœ„í•´ì„œëŠ” ëª¨ë“  ë…¸ë“œê°€ ì„œë¡œì„œë¡œ ì—°ê²°ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w1/20240831_kans_w1_18.png" alt="img.png" class="image-center" /></li>
  <li>Bridgeë¥¼ ë‘ë©´ ê° ë…¸ë“œëŠ” Bridgeì™€ë§Œ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ í†µì‹ ì´ ê°€ëŠ¥í•˜ë¯€ë¡œ íš¨ìœ¨ì ì…ë‹ˆë‹¤.</li>
  <li>ì‹¤ìŠµì„ í†µí•´ ì•„ë˜ì˜ ê·¸ë¦¼ê³¼ ê°™ì´ ê²©ë¦¬ëœ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê³  ë¸Œë¦¿ì§€ë¥¼ í†µí•´ í†µì‹ í•´ë³´ê² ìŠµë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w1/20240831_kans_w1_19.png" alt="img.png" /></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„ 3ê°œë¥¼ root ë¡œ ì—½ë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
<span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; root</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë° veth ìƒì„±</span>
<span class="nv">$ </span>ip netns add RED
<span class="nv">$ </span>ip <span class="nb">link </span>add reth0 <span class="nb">type </span>veth peer name reth1
<span class="nv">$ </span>ip <span class="nb">link set </span>reth0 netns RED
<span class="nv">$ </span>ip netns add BLUE
<span class="nv">$ </span>ip <span class="nb">link </span>add beth0 <span class="nb">type </span>veth peer name beth1
<span class="nv">$ </span>ip <span class="nb">link set </span>beth0 netns BLUE

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>ip netns list
<span class="nv">$ </span>ip <span class="nb">link</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    26: &lt;span style="color:teal;"&gt;reth1@if27: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;mode DEFAULT group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;9a:1f:bf:6f:fe:64&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netns RED</span>
<span class="c">#    28: &lt;span style="color:teal;"&gt;beth1@if29: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;mode DEFAULT group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;7e:31:cf:5f:00:8f&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netns BLUE</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED ip addr
<span class="c"># =&gt; ...</span>
<span class="c">#    27: &lt;span style="color:teal;"&gt;reth0@if26: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;ea:7f:a0:1f:00:3d&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netnsid 0</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip addr
<span class="c"># =&gt; ...</span>
<span class="c">#    29: &lt;span style="color:teal;"&gt;beth0@if28: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc noop state &lt;span style="color:red;"&gt;DOWN &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;66:23:89:a6:f7:70&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt; link-netnsid 0</span>

<span class="c"># ë¸Œë¦¿ì§€ ì •ë³´ í™•ì¸ </span>
<span class="nv">$ </span>brctl show
<span class="c"># =&gt; bridge name	bridge id		STP enabled	interfaces</span>
<span class="c">#    docker0		8000.02425756997c	no		</span>

<span class="c"># br0 ë¸Œë¦¿ì§€ ìƒì„±</span>
<span class="nv">$ </span>ip <span class="nb">link </span>add br0 <span class="nb">type </span>bridge

<span class="c"># br0 ë¸Œë¦¿ì§€ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>brctl show br0
<span class="c"># =&gt; bridge name	bridge id		STP enabled	interfaces</span>
<span class="c">#    br0		8000.000000000000	no		</span>
<span class="nv">$ </span>brctl showmacs br0
<span class="nv">$ </span>brctl showstp br0

<span class="c"># reth1ê³¼ beth1ì„ br0 ë¸Œë¦¿ì§€ì— ì—°ê²°</span>
<span class="nv">$ </span>ip <span class="nb">link set </span>reth1 master br0
<span class="nv">$ </span>ip <span class="nb">link set </span>beth1 master br0
<span class="nv">$ </span>brctl show br0
<span class="c"># =&gt; bridge name     bridge id               STP enabled     interfaces</span>
<span class="c">#    br0             8000.7e31cf5f008f       no              beth1</span>
<span class="c">#                                                            reth1</span>
<span class="nv">$ </span>brctl showmacs br0
<span class="c"># =&gt; port no mac addr                is local?       ageing timer</span>
<span class="c">#      2     7e:31:cf:5f:00:8f       yes                0.00</span>
<span class="c">#      2     7e:31:cf:5f:00:8f       yes                0.00</span>
<span class="c">#      1     9a:1f:bf:6f:fe:64       yes                0.00</span>
<span class="c">#      1     9a:1f:bf:6f:fe:64       yes                0.00</span>
<span class="nv">$ </span>ip <span class="nt">-br</span> <span class="nb">link</span>
<span class="c"># =&gt; ... </span>
<span class="c">#    &lt;span style="color:teal;"&gt;reth1@if27       &lt;/span&gt;&lt;span style="color:red;"&gt;DOWN           &lt;/span&gt;&lt;span style="color:olive;"&gt;9a:1f:bf:6f:fe:64 &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; </span>
<span class="c">#    &lt;span style="color:teal;"&gt;beth1@if29       &lt;/span&gt;&lt;span style="color:red;"&gt;DOWN           &lt;/span&gt;&lt;span style="color:olive;"&gt;7e:31:cf:5f:00:8f &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; </span>
<span class="c">#    &lt;span style="color:teal;"&gt;br0              &lt;/span&gt;&lt;span style="color:red;"&gt;DOWN           &lt;/span&gt;&lt;span style="color:olive;"&gt;7e:31:cf:5f:00:8f &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST&amp;gt; </span>

<span class="c"># reth0ê³¼ beth0ì— IP ì„¤ì • ë° í™œì„±í™”(UP) ì‹œí‚¤ê³ , reth1, beth1, br0ë¥¼ í™œì„±í™”(UP) í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED  ip addr add 11.11.11.2/24 dev reth0
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip addr add 11.11.11.3/24 dev beth0
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED  ip <span class="nb">link set </span>reth0 up
<span class="nv">$ </span>ip <span class="nb">link set </span>reth1 up
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip <span class="nb">link set </span>beth0 up
<span class="nv">$ </span>ip <span class="nb">link set </span>beth1 up
<span class="nv">$ </span>ip <span class="nb">link set </span>br0 up
<span class="nv">$ </span>ip <span class="nt">-br</span> addr
<span class="c"># =&gt; ... </span>
<span class="c">#    &lt;span style="color:teal;"&gt;reth1@if27       &lt;/span&gt;&lt;span style="color:green;"&gt;UP             &lt;/span&gt;&lt;span style="color:blue;"&gt;fe80::981f:bfff:fe6f:fe64&lt;/span&gt;/64 </span>
<span class="c">#    &lt;span style="color:teal;"&gt;beth1@if29       &lt;/span&gt;&lt;span style="color:green;"&gt;UP             &lt;/span&gt;&lt;span style="color:blue;"&gt;fe80::7c31:cfff:fe5f:8f&lt;/span&gt;/64 </span>
<span class="c">#    &lt;span style="color:teal;"&gt;br0              &lt;/span&gt;&lt;span style="color:green;"&gt;UP             &lt;/span&gt;&lt;span style="color:blue;"&gt;fe80::7c31:cfff:fe5f:8f&lt;/span&gt;/64 </span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>RED ip <span class="nt">-br</span> addr
<span class="c"># =&gt; ...</span>
<span class="c">#    &lt;span style="color:teal;"&gt;reth0@if26       &lt;/span&gt;&lt;span style="color:green;"&gt;UP             &lt;/span&gt;&lt;span style="color:purple;"&gt;11.11.11.2&lt;/span&gt;/24 &lt;span style="color:blue;"&gt;fe80::e87f:a0ff:fe1f:3d&lt;/span&gt;/64 </span>
<span class="nv">$ </span>ip netns <span class="nb">exec </span>BLUE ip <span class="nt">-br</span> addr
<span class="c"># =&gt; ...</span>
<span class="c">#    &lt;span style="color:teal;"&gt;beth0@if28       &lt;/span&gt;&lt;span style="color:green;"&gt;UP             &lt;/span&gt;&lt;span style="color:purple;"&gt;11.11.11.3&lt;/span&gt;/24 &lt;span style="color:blue;"&gt;fe80::6423:89ff:fea6:f770&lt;/span&gt;/64 </span>

<span class="c"># í„°ë¯¸ë„1 (RED 11.11.11.2)</span>
<span class="nv">$ </span>nsenter <span class="nt">--net</span><span class="o">=</span>/var/run/netns/RED
<span class="nv">$ </span>ip <span class="nt">-c</span> a<span class="p">;</span><span class="nb">echo</span><span class="p">;</span> ip <span class="nt">-c</span> route<span class="p">;</span><span class="nb">echo</span><span class="p">;</span> ip <span class="nt">-c</span> neigh
<span class="c"># í˜„ì¬ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>ip netns identify <span class="nv">$$</span>
<span class="c"># =&gt; RED</span>

<span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="nv">$ </span>brctl showmacs br0
<span class="nv">$ </span>bridge fdb show
<span class="nv">$ </span>bridge fdb show dev br0

<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-L</span> <span class="nt">-n</span> <span class="nt">-v</span>

<span class="c"># í„°ë¯¸ë„3 (BLUE 11.11.11.3)</span>
<span class="nv">$ </span>nsenter <span class="nt">--net</span><span class="o">=</span>/var/run/netns/BLUE
<span class="nv">$ </span>ip <span class="nt">-c</span> a<span class="p">;</span><span class="nb">echo</span><span class="p">;</span> ip <span class="nt">-c</span> route<span class="p">;</span><span class="nb">echo</span><span class="p">;</span> ip <span class="nt">-c</span> neigh
<span class="c"># í˜„ì¬ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>ip netns identify <span class="nv">$$</span>
<span class="c"># =&gt; BLUE</span>

<span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="c"># ping í†µì‹  ì „ ì‚¬ì „ ì„¤ì •</span>
<span class="c">## iptables ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span> | <span class="nb">grep</span> <span class="s1">'\-P'</span>
<span class="c"># =&gt; -P INPUT ACCEPT</span>
<span class="c">#    -P FORWARD DROP</span>
<span class="c">#    -P OUTPUT ACCEPT</span>
<span class="nv">$ </span>iptables <span class="nt">-nvL</span> <span class="nt">-t</span> filter

<span class="c"># í˜¸ìŠ¤íŠ¸ì—ì„œ íŒ¨í‚· ë¼ìš°íŒ… ì„¤ì • í™•ì¸ - 0(off), 1(on)</span>
<span class="nv">$ </span><span class="nb">cat</span> /proc/sys/net/ipv4/ip_forward
<span class="c"># =&gt; 1</span>
<span class="c"># ìœ„ì˜ ê²°ê³¼ê°€ 0ì¸ ê²½ìš° ì•„ë˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰</span>
<span class="c"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span>

<span class="c"># ping í†µì‹  í™•ì¸</span>
<span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="nv">$ </span>tcpdump <span class="nt">-l</span> <span class="nt">-i</span> br0
<span class="c"># =&gt; tcpdump: verbose output suppressed, use -v[v]... for full protocol decode</span>
<span class="c">#    listening on br0, link-type EN10MB (Ethernet), snapshot length 262144 bytes</span>
<span class="c">#    (í„°ë¯¸ë„1ì—ì„œ ping ì‹¤í–‰ì‹œ)</span>
<span class="c">#    08:40:00.413198 IP 11.11.11.2 &gt; 11.11.11.3: ICMP echo request, id 41028, seq 1, length 64</span>
<span class="c">#    08:40:05.455528 ARP, Request who-has 11.11.11.3 tell 11.11.11.2, length 28</span>
<span class="c">#    08:40:05.455556 ARP, Reply 11.11.11.3 is-at 66:23:89:a6:f7:70 (oui Unknown), length 28</span>
<span class="nv">$ </span>watch <span class="nt">-d</span> <span class="s1">'iptables -v --numeric --table filter --list FORWARD'</span>
<span class="nv">$ </span>watch <span class="nt">-d</span> <span class="s1">'iptables -v --numeric --table filter --list FORWARD;echo;iptables -v --numeric --table filter --list DOCKER-USER;echo;iptables -v --numeric --table filter --list DOCKER-ISOLATION-STAGE-1'</span>

<span class="c"># í„°ë¯¸ë„3 (BLUE 11.11.11.3)</span>
<span class="nv">$ </span>tcpdump <span class="nt">-l</span> <span class="nt">-i</span> beth0

<span class="c"># í„°ë¯¸ë„1 (RED 11.11.11.2)</span>
<span class="nv">$ </span>ping 11.11.11.3 <span class="nt">-c</span> 1
<span class="c"># =&gt; ì‹¤íŒ¨</span>
</code></pre></div></div>

<p>ìœ„ì˜ ìº¡ì³ì™€ ê°™ì´ ë¸Œë¦¿ì§€ì—ì„œëŠ” íŒ¨í‚·ì´ ì¡íˆì§€ë§Œ, ë¸Œë¦¿ì§€ë¥¼ í†µí•´ Blueë¡œ íŒ¨í‚·ì´ ì „ë‹¬ë˜ì§€ ì•ŠëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ë ‡ë‹¤ë©´ ì™œ íŒ¨í‚·ì´ ì „ë‹¬ë˜ì§€ ì•Šì„ê¹Œìš”? ê·¸ê²ƒì€ <code class="language-plaintext highlighter-rouge">iptables -t filter -S | grep '\-P'</code> ëª…ë ¹ì„ í†µí•´ í™•ì¸í–ˆì„ë•Œ FORWARD ì²´ì¸ì´ DROPìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
íŒ¨í‚·ì´ ë¸Œë¦¿ì§€ë¥¼ í†µí•´ ì „ë‹¬ë˜ë ¤ë©´ FORWARD ì²´ì¸ì„ í†µí•´ì•¼ í•˜ëŠ”ë° DROPì´ë©´ íŒ¨í‚·ì´ ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_20.png" alt="img.png" class="image-center" />
<em class="image-caption">Iptables ì²˜ë¦¬ íë¦„ë„ (<a href="https://natnat1.medium.com/iptables-b9ce0602253f">https://natnat1.medium.com/iptables-b9ce0602253f</a>)</em></p>

<ul>
  <li>ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™ì´ iptablesëŠ” íŒ¨í‚·ì´ ë“¤ì–´ì˜¤ë©´ PREROUTING ì²´ì¸ì„ í†µí•´ íŒ¨í‚·ì„ ì²˜ë¦¬í•˜ê³ , FORWARD ì²´ì¸ì„ í†µí•´ íŒ¨í‚·ì„ ì „ë‹¬í•©ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_21.png" alt="img.png" /></p>

<ul>
  <li>br0 ì…ì¥ì—ì„œ ì‚´í´ë³´ë©´ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ 11.11.11.2 &lt;=&gt; 11.11.11.3ìœ¼ë¡œ FORWARDë¥¼ í—ˆìš©í•˜ë©´ ë˜ëŠ”ë° ë°©ë²•ì„ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
    <ul>
      <li>ì¶œë°œì§€ 11.11.11.2ì™€ 11.11.11.3 í—ˆìš©</li>
      <li>ë„ì°©ì§€ 11.11.11.0/24 ëŒ€ì—­ ì¶œë°œì§€ í—ˆìš©</li>
      <li>FORWARD ê¸°ë³¸ ì •ì±…ì„ ACCEPTë¡œ ë³€ê²½</li>
      <li>ë“±ë“± ê¸°íƒ€ ì–´ë–¤ ë°©ë²•ìœ¼ë¡œë“  11.11.11.2ì™€ 11.11.11.3ì´ FORWARD ì²´ì¸ì„ í†µí•´ íŒ¨í‚·ì´ ì „ë‹¬ë˜ë„ë¡ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì‹¤ìŠµì„ í†µí•´ iptablesë¥¼ í†µí•´ íŒ¨í‚·ì´ ì „ë‹¬ë˜ë„ë¡ ì„¤ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ë°©ë²•1. 11.11.11.2ì™€ 11.11.11.3 í—ˆìš©í•˜ê¸°
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="c"># ì¶œë°œì§€ 11.11.11.2 í—ˆìš©í•˜ê¸°</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-A</span> FORWARD <span class="nt">-s</span> 11.11.11.2/32 <span class="nt">-j</span> ACCEPT
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-A</span> FORWARD <span class="nt">-s</span> 11.11.11.3/32 <span class="nt">-j</span> ACCEPT
<span class="nv">$ </span>tcpdump <span class="nt">-l</span> <span class="nt">-i</span> br0
  
<span class="c"># í„°ë¯¸ë„3 (BLUE 11.11.11.3)</span>
<span class="nv">$ </span>tcpdump <span class="nt">-l</span> <span class="nt">-i</span> beth0
<span class="c"># =&gt; tcpdump: verbose output suppressed, use -v[v]... for full protocol decode</span>
<span class="c">#    listening on beth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes</span>
<span class="c">#    10:39:20.225225 IP 11.11.11.2 &gt; 11.11.11.3: ICMP echo request, id 33335, seq 1, length 64</span>
<span class="c">#    10:39:20.225233 IP 11.11.11.3 &gt; 11.11.11.2: ICMP echo reply, id 33335, seq 1, length 64</span>
  
<span class="c"># í„°ë¯¸ë„1 (RED 11.11.11.2)</span>
<span class="nv">$ </span>ping 11.11.11.3
<span class="c"># =&gt; PING 11.11.11.3 (11.11.11.3) 56(84) bytes of data.</span>
<span class="c">#    64 bytes from 11.11.11.3: icmp_seq=1 ttl=64 time=0.055 ms</span>
<span class="c">#    </span>
<span class="c">#    --- 11.11.11.3 ping statistics ---</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="c">#    rtt min/avg/max/mdev = 0.055/0.055/0.055/0.000 ms</span>
  
<span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="c"># í—ˆìš© ë£° ì œê±°</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-D</span> FORWARD <span class="nt">-s</span> 11.11.11.2/32 <span class="nt">-j</span> ACCEPT
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-D</span> FORWARD <span class="nt">-s</span> 11.11.11.3/32 <span class="nt">-j</span> ACCEPT
</code></pre></div>    </div>

    <p><img src="/assets/2024/kans-3th/w1/20240831_kans_w1_22.png" alt="img.png" /></p>
  </li>
  <li>ë°©ë²•2. ë„ì°©ì§€ 11.11.11.0/24 ëŒ€ì—­ í—ˆìš©í•˜ê¸°
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-A</span> FORWARD <span class="nt">-d</span> 11.11.11.0/24 <span class="nt">-j</span> ACCEPT
<span class="c"># í…ŒìŠ¤íŠ¸ í›„ í—ˆìš© ë£° ì œê±°</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-D</span> FORWARD <span class="nt">-d</span> 11.11.11.0/24 <span class="nt">-j</span> ACCEPT
</code></pre></div>    </div>
  </li>
  <li>ë°©ë²•3. FORWARD ê¸°ë³¸ ì •ì±…ì„ ACCEPTë¡œ ë³€ê²½í•˜ê¸°
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-P</span> FORWARD ACCEPT
<span class="c"># í…ŒìŠ¤íŠ¸ í›„ í—ˆìš© ë£° ì œê±°</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-P</span> FORWARD DROP
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="í˜¸ìŠ¤íŠ¸--redblue-ë„¤íŠ¸ì›Œí¬-ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ-ì ‘ê·¼í•˜ê¸°">í˜¸ìŠ¤íŠ¸ &lt;=&gt; RED/BLUE ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ì ‘ê·¼í•˜ê¸°</h3>

<ul>
  <li>â€œRed &lt;- Bridge (br0) -&gt; Blue ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê°„ í†µì‹ â€ì„ ì‹¤ìŠµí•œ í™˜ê²½ì— ì´ì–´ì„œ ì‹¤ìŠµí•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„1 (RED 11.11.11.2)</span>
<span class="nv">$ </span>nsenter <span class="nt">--net</span><span class="o">=</span>/var/run/netns/RED
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> any

<span class="c"># í„°ë¯¸ë„3ë¥¼ í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">exit</span>
<span class="nv">$ </span>ip netns identify <span class="nv">$$</span>
<span class="c"># =&gt; (ê³µë°±)</span>
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> br0 <span class="nt">-n</span>

<span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 11.11.11.2
<span class="c"># =&gt; 1 packets transmitted, 0 received, 100% packet loss, time 0ms</span>
<span class="c"># (ping ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤.)</span>
</code></pre></div></div>

<ul>
  <li>í˜¸ìŠ¤íŠ¸ì—ì„œ RED (11.11.11.2) ë¡œ pingì‹œ íŒ¨í‚·ì´ ì „ë‹¬ë˜ì§€ ì•ŠëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ê·¸ ì´ìœ ëŠ” RED ë„¤íŠ¸ì›Œí¬ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” br0ë¥¼ ê±°ì³ì„œ ì ‘ê·¼í•´ì•¼í•˜ëŠ”ë°, br0ëŠ” ipê°€ ì—†ê¸° ë•Œë¬¸ì— íŒ¨í‚·ì´ ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
  <li>br0ì— ipë¥¼ í• ë‹¹í•˜ê³ , REDì™€ BLUE ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ì ‘ê·¼í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="nv">$ </span>ip addr add 11.11.11.1/24 dev br0
<span class="nv">$ </span>ip addr
<span class="c"># =&gt; ...</span>
<span class="c">#    30: &lt;span style="color:teal;"&gt;br0: &lt;/span&gt;&amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state &lt;span style="color:green;"&gt;UP &lt;/span&gt;group default qlen 1000</span>
<span class="c">#        link/ether &lt;span style="color:olive;"&gt;7e:31:cf:5f:00:8f&lt;/span&gt; brd &lt;span style="color:olive;"&gt;ff:ff:ff:ff:ff:ff&lt;/span&gt;</span>
<span class="c">#        inet &lt;span style="color:purple;"&gt;11.11.11.1&lt;/span&gt;/24 scope global br0</span>
<span class="c">#           valid_lft forever preferred_lft forever</span>
<span class="nv">$ </span>ping 11.11.11.2 <span class="nt">-c</span> 1
<span class="c"># =&gt; PING 11.11.11.2 (11.11.11.2) 56(84) bytes of data.</span>
<span class="c">#    64 bytes from 11.11.11.2: icmp_seq=1 ttl=64 time=0.044 ms</span>
<span class="c">#    </span>
<span class="c">#    --- 11.11.11.2 ping statistics ---</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="c">#    rtt min/avg/max/mdev = 0.044/0.044/0.044/0.000 ms</span>
<span class="nv">$ </span>ping 11.11.11.3 <span class="nt">-c</span> 1
<span class="c"># =&gt; PING 11.11.11.3 (11.11.11.3) 56(84) bytes of data.</span>
<span class="c">#    64 bytes from 11.11.11.3: icmp_seq=1 ttl=64 time=0.052 ms</span>
<span class="c">#    </span>
<span class="c">#    --- 11.11.11.3 ping statistics ---</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="c">#    rtt min/avg/max/mdev = 0.052/0.052/0.052/0.000 ms</span>
</code></pre></div></div>

<ul>
  <li>ì´ë²ˆì—ëŠ” REDì—ì„œ í˜¸ìŠ¤íŠ¸ë¡œ pingì´ ë˜ëŠ”ê²ƒì„ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„1 (RED 11.11.11.2)</span>
<span class="c"># br0 ì— ping í…ŒìŠ¤íŠ¸</span>
<span class="nv">$ </span>ping 11.11.11.1 <span class="nt">-c</span> 1
<span class="c"># =&gt; PING 11.11.11.1 (11.11.11.1) 56(84) bytes of data.</span>
<span class="c">#    64 bytes from 11.11.11.1: icmp_seq=1 ttl=64 time=0.041 ms</span>
<span class="c">#    </span>
<span class="c">#    --- 11.11.11.1 ping statistics ---</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="c">#    rtt min/avg/max/mdev = 0.041/0.041/0.041/0.000 ms</span>

<span class="c"># í˜¸ìŠ¤íŠ¸ë¡œ ping í…ŒìŠ¤íŠ¸</span>
<span class="nv">$ </span>ping 10.10.10.51 <span class="nt">-c</span> 1
<span class="c"># =&gt; ping: connect: Network is unreachable</span>
</code></pre></div></div>

<ul>
  <li>br0ì—ëŠ” ping ì´ ì„±ê³µí•˜ëŠ”ë° í˜¸ìŠ¤íŠ¸ë¡œëŠ” Network is unreachable ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ê·¸ ì´ìœ ëŠ” 11.11.11.0/24ì—ì„œ í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ì¸ 10.10.10.0/24ë¡œ íŒ¨í‚·ì„ ë¼ìš°íŒ…í•˜ëŠ” ì •ë³´ê°€ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</li>
  <li>REDë‚˜ BLUEì—ì„œ í˜¸ìŠ¤íŠ¸ë¡œ íŒ¨í‚·ì„ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œëŠ” br0ë¥¼ í†µí•´ì•¼ í•˜ëŠ”ë°, REDì™€ BLUEì— ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ë¥¼ br0ë¡œ ì„¤ì •í•˜ì—¬ í…ŒìŠ¤íŠ¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„1 (RED 11.11.11.2)</span>
<span class="nv">$ </span>ip route add default via 11.11.11.1
<span class="nv">$ </span>ip route
<span class="c"># =&gt; default via 11.11.11.1 dev reth0</span>
<span class="c">#    11.11.11.0/24 dev reth0 proto kernel scope link src 11.11.11.2</span>
<span class="nv">$ </span>ping 10.10.10.51 <span class="nt">-c</span> 1
<span class="c"># =&gt; PING 10.10.10.51 (10.10.10.51) 56(84) bytes of data.</span>
<span class="c">#    64 bytes from 10.10.10.51: icmp_seq=1 ttl=64 time=0.041 ms</span>
<span class="c">#    </span>
<span class="c">#    --- 10.10.10.51 ping statistics ---</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># BLUEì—ì„œë„ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸í•´ë³´ê² ìŠµë‹ˆë‹¤</span>

<span class="c"># í„°ë¯¸ë„1 (BLUE 11.11.11.3)</span>
<span class="nv">$ </span>nsenter <span class="nt">--net</span><span class="o">=</span>/var/run/netns/BLUE
<span class="nv">$ </span>ip netns identify <span class="nv">$$</span>
<span class="c"># =&gt; BLUE</span>
<span class="nv">$ </span>ping 10.10.10.51 <span class="nt">-c</span> 1
<span class="c"># =&gt; ping: connect: Network is unreachable</span>
<span class="nv">$ </span>ip route add default via 11.11.11.1
<span class="nv">$ </span>ip route
<span class="c"># =&gt; default via 11.11.11.1 dev beth0</span>
<span class="c">#    11.11.11.0/24 dev beth0 proto kernel scope link src 11.11.11.3</span>
<span class="nv">$ </span>ping 10.10.10.51 <span class="nt">-c</span> 1
<span class="c"># =&gt; PING 10.10.10.51 (10.10.10.51) 56(84) bytes of data.</span>
<span class="c">#    64 bytes from 10.10.10.51: icmp_seq=1 ttl=64 time=0.049 ms</span>
<span class="c">#    </span>
<span class="c">#    --- 10.10.10.51 ping statistics ---</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="c">#    rtt min/avg/max/mdev = 0.049/0.049/0.049/0.000 ms</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ip route add default via 11.11.11.1</code> ë¡œ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ë¥¼ br0ë¡œ ì„¤ì •í•˜ê³ , í˜¸ìŠ¤íŠ¸ë¡œ pingì´ ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<h3 id="redblueì—ì„œ-ì™¸ë¶€-ì¸í„°ë„·-í†µì‹ ">RED/BLUEì—ì„œ ì™¸ë¶€ ì¸í„°ë„· í†µì‹ </h3>

<ul>
  <li>ì´ë²ˆì—ëŠ” REDì™€ BLUE ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì™¸ë¶€ ì¸í„°ë„·ìœ¼ë¡œ í†µì‹ í•˜ëŠ” ë°©ë²•ì„ ì‹¤ìŠµí•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„1 (RED 11.11.11.2)</span>
<span class="nv">$ </span>nsenter <span class="nt">--net</span><span class="o">=</span>/var/run/netns/RED
<span class="nv">$ </span>ping 8.8.8.8 <span class="nt">-c</span> 1
<span class="c"># =&gt; PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.</span>
<span class="c">#    </span>
<span class="c">#    --- 8.8.8.8 ping statistics ---</span>
<span class="c">#    1 packets transmitted, 0 received, 100% packet loss, time 0ms</span>
</code></pre></div></div>

<ul>
  <li>REDì—ì„œ ì™¸ë¶€ ì¸í„°ë„·ìœ¼ë¡œ pingì´ ë˜ì§€ ì•ŠëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>RED/BLUEì™€ ê°™ì´ í˜¸ìŠ¤íŠ¸ ì•„ë˜ì˜ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì™¸ë¶€ ì¸í„°ë„·ìœ¼ë¡œ íŒ¨í‚·ì„ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œëŠ”
í˜¸ìŠ¤íŠ¸ì˜ IPë¡œ íŒ¨í‚·ì„ ì „ë‹¬í•˜ê³ , ì‘ë‹µì„ í˜¸ìŠ¤íŠ¸ IPë¡œ ë°›ì•„ì„œ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬(RED/BLUE)ë¡œ ì „ë‹¬í•´ì•¼í•˜ëŠ”ë°, 
ì´ëŸ¬í•œ ê³¼ì •ì„ SNAT (Source Network Address Translation) ë˜ëŠ” MASQUERADEë¼ê³  í•©ë‹ˆë‹¤.</li>
  <li>nat í…Œì´ë¸”ì˜ POSTROUTING ì²´ì¸ì— MASQUERADE ë£°ì„ ì¶”ê°€í•˜ë©´ SNATì´ ì ìš©ë˜ì–´ì„œ ì™¸ë¶€ ì¸í„°ë„·ìœ¼ë¡œ íŒ¨í‚·ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„2 (í˜¸ìŠ¤íŠ¸)</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 11.11.11.0/24 <span class="nt">-j</span> MASQUERADE
<span class="c"># SNAT í†µê³„ ëª¨ë‹ˆí„°ë§</span>
<span class="nv">$ </span>watch <span class="nt">-d</span> <span class="s1">'iptables -v --numeric --table nat --list POSTROUTING'</span>
<span class="nv">$ </span>iptables <span class="nt">-nvL</span> <span class="nt">-t</span> nat
<span class="nv">$ </span>conntrack <span class="nt">-L</span> <span class="nt">--src-nat</span>
<span class="c"># =&gt; icmp     1 29 src=11.11.11.2 dst=8.8.8.8 type=8 code=0 id=62779 src=8.8.8.8 dst=10.10.10.109 type=0 code=0 id=62779 mark=0 use=1</span>
<span class="c">#    conntrack v1.4.8 (conntrack-tools): 1 flow entries have been shown.</span>

<span class="c"># í„°ë¯¸ë„1 (RED 11.11.11.2)</span>
<span class="nv">$ </span>ping 8.8.8.8 <span class="nt">-c</span> 1
<span class="c"># =&gt; PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.</span>
<span class="c">#    64 bytes from 8.8.8.8: icmp_seq=1 ttl=113 time=26.3 ms</span>
<span class="c">#    </span>
<span class="c">#    --- 8.8.8.8 ping statistics ---</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="c">#    rtt min/avg/max/mdev = 26.277/26.277/26.277/0.000 ms</span>
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># í„°ë¯¸ë„1 (BLUE 11.11.11.3)</span>
<span class="nv">$ </span>nsenter <span class="nt">--net</span><span class="o">=</span>/var/run/netns/BLUE
<span class="nv">$ </span>ip route add default via 11.11.11.1
<span class="nv">$ </span>ping 8.8.8.8 <span class="nt">-c</span> 1
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># ì‚­ì œ</span>
<span class="nv">$ </span>ip netns delete RED
<span class="nv">$ </span>ip netns delete BLUE
<span class="nv">$ </span>ip <span class="nb">link </span>delete br0

<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-D</span> POSTROUTING <span class="nt">-s</span> 11.11.11.0/24 <span class="nt">-j</span> MASQUERADE
</code></pre></div></div>

<ul>
  <li>SNAT ì¶”ê°€í•œ ì´í›„ pingì´ ì˜ ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</li>
</ul>

<hr />

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì²«ì£¼ë¶€í„° ì´ë¡ ê³¼ ì‹¤ìŠµí• ê²ƒì´ êµ‰ì¥íˆ ë§ì•˜ìŠµë‹ˆë‹¤. í…Œë¼í¼ ìŠ¤í„°ë””ê°€ ìˆœí•œë§›ìœ¼ë¡œ ë³´ì¼ ì •ë„ì…ë‹ˆë‹¤. ğŸ˜…
í•˜ì§€ë§Œ ê·¸ë™ì•ˆ ë§‰ì—°í•˜ê²Œ ì•Œê³  ìˆì—ˆë˜ ë„ì»¤ ì»¨í…Œì´ë„ˆì˜ ê²©ë¦¬ ì›ë¦¬ì™€ ë¦¬ëˆ…ìŠ¤ ë„¤íŠ¸ì›Œí¬ì™€ iptablesì— 
ëŒ€í•´ ë” ê¹Šê²Œ ì´í•´í•  ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ìŠµë‹ˆë‹¤.</p>

<p><del>ê°œì¸ì ìœ¼ë¡œ *BSDë¥¼ ì¢‹ì•„í•˜ëŠ”ë° ì´ ì •ë„ë©´ FreeBSDì—ì„œë„ BSDë§Œì˜ docker ê°™ì€ ì—ì½”ì‹œìŠ¤í…œ êµ¬ì¶•ì´ ê°€ëŠ¥í• ê²ƒ ê°™ì€ë°
ì™œ ëª»í•˜ê³  ìˆëŠ”ì§€ ì˜ë¬¸ì…ë‹ˆë‹¤. ë¹„ìŠ·í•˜ê²Œ ëŒë¦´ ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ì‹œë„ë“¤ì€ ë§ì€ë° íì§€ë¶€ì§€ ë˜ëŠ” ì´ìœ ëŠ” ëŒ€ì²´ ë¬´ì—‡ì¸ì§€..</del></p>

<p>í•­ìƒ ë¬´ì–¸ê°€ë¥¼ ë°°ìš°ëŠ”ê²ƒì€ ì¦ê²ìŠµë‹ˆë‹¤. ë‹¤ìŒ ìŠ¤í„°ë””ë„ ê¸°ëŒ€ë©ë‹ˆë‹¤! :smile:</p>]]></content><author><name></name></author><category term="kans" /><category term="kubernetes," /><category term="network," /><category term="linux" /><summary type="html"><![CDATA[ì§€ë‚œ í…Œë¼í¼ ìŠ¤í„°ë””ì— ì´ì–´ ì´ë²ˆ ì£¼ ë¶€í„° KANS ìŠ¤í„°ë””ë¥¼ ì‹œì‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤! KANSëŠ” Kubernetes Advanced Networking Studyì˜ ì¤„ì„ë§ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤íŠ¸ì›Œí‚¹ì— ëŒ€í•œ ì‹¬ë„ìˆê²Œ ê³µë¶€í•˜ëŠ” ìŠ¤í„°ë””ì…ë‹ˆë‹¤. ì´ë²ˆ ìŠ¤í„°ë””ë„ ê³¼ì œí•  ê±±ì •ë„ ë˜ì§€ë§Œ ì¬ë¯¸ìˆì„ê²ƒ ê°™ì•„ ê¸°ëŒ€ë©ë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[T101 4ê¸°] OpenTofu</title><link href="https://sweetlittlebird.github.io/posts/2024-08-03-T101-Study-Terraform-Week-8/" rel="alternate" type="text/html" title="[T101 4ê¸°] OpenTofu" /><published>2024-08-03T16:02:00+09:00</published><updated>2024-08-03T16:02:00+09:00</updated><id>https://sweetlittlebird.github.io/posts/T101%20Study%20-%20Terraform%20Week%208</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-08-03-T101-Study-Terraform-Week-8/"><![CDATA[<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì´ë²ˆ ì£¼ê°€ 8ì£¼ì°¨ì´ì ë²Œì¨ ë§ˆì§€ë§‰ì£¼ì°¨ì…ë‹ˆë‹¤. 
T101 4ê¸°ì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì•Œì•„ë³¼ ì£¼ì œëŠ” OpenTofuë¡œ Terraformì˜ 
ì˜¤í”ˆì†ŒìŠ¤ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ í¬í¬í•œ ë²„ì „ìœ¼ë¡œ ì•ìœ¼ë¡œê°€ ê¸°ëŒ€ë˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.
ì´ ë¸”ë¡œê·¸ ê¸€ì˜ ë‚´ìš©ì€ 
<a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a>ë¥¼ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" /></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a></p>
</blockquote>

<h2 id="opentofu">OpenTofu</h2>

<h3 id="ê°œìš”">ê°œìš”</h3>

<p><img src="/assets/2024/t101-4th/20240803_terraform_w8_opentofu_1.png" alt="OpenTofu ë¡œê³ " class="image-center" />
<em class="image-caption">OpenTofu ë¡œê³ </em></p>

<ul>
  <li>OpenTofuëŠ” HashiCorpê°€ Terraformì˜ ë¼ì´ì„¼ìŠ¤ë¥¼ MPL(Mozilla Public License)ì—ì„œ ë¹„ì˜¤í”ˆ ì†ŒìŠ¤ ë¼ì´ì„¼ìŠ¤ì¸ BUSL(Business Source License)ë¡œ ë³€ê²½í•œ ê²ƒì—
ë°˜ë°œí•˜ì—¬ ë§Œë“¤ì–´ì§„ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. BUSLë¡œ ë¼ì´ì„¼ìŠ¤ê°€ ë³€ê²½ë˜ê¸° ì „ì˜ ì†ŒìŠ¤ë¥¼ í¬í¬í•˜ì˜€ìœ¼ë©°, ì´ˆê¸°ì—ëŠ” OpenTF ë¼ëŠ” ì´ë¦„ì„ ì‚¬ìš©í•˜ë‹¤ê°€
OpenTofuë¡œ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤.
    <ul>
      <li>Terraform AWS Provider ë“±ì€ ì•„ì§ MPL ë²„ì „ì´ì–´ì„œ OpenTofuì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì´ˆê¸°ì—ëŠ” Terraformì˜ ì˜¤í”ˆì†ŒìŠ¤ë²„ì „ì„ ìœ ì§€í•˜ê¸° ìœ„í•œ í”„ë¡œì íŠ¸ì˜€ìœ¼ë‚˜, í˜„ì¬ëŠ” ìƒíƒœíŒŒì¼ ì•”í˜¸í™”ë‚˜ Backend ë¸”ë¡ì—ì„œ Variableì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ë“±
ë³¸ê°€ì˜ Terraform ì—ì„œ ì¡°ì°¨ ì§€ì›í•˜ì§€ ì•ŠëŠ” í¸ë¦¬í•œ ê¸°ëŠ¥ë“¤ì„ ì¶”ê°€í•˜ë©° ë°œì „í•´ê°€ê³  ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<h3 id="íŠ¹ì´ì‚¬í•­">íŠ¹ì´ì‚¬í•­</h3>

<ul>
  <li>OpenTofu 1.6.xëŠ” Terraform 1.6.xì™€ ê¸°ëŠ¥ì ìœ¼ë¡œ ë§¤ìš° ìœ ì‚¬í•˜ì§€ë§Œ, ì•ìœ¼ë¡œ ê¸°ëŠ¥ì¶”ê°€ ë“± ê°ê° ë…ìì ì¸ ë°©í–¥ìœ¼ë¡œ ë°œì „í•  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.</li>
  <li>Terraform 1.5.x ë° 1.6.x ì™€ ìƒë‹¹ ë¶€ë¶„ í˜¸í™˜ë˜ë¯€ë¡œ í•´ë‹¹ ë²„ì „ì„ ì‚¬ìš© ì¤‘ì´ì—ˆë‹¤ë©´ OpenTofuë¡œ ì „í™˜í•˜ê¸°ê°€ ì‰½ìŠµë‹ˆë‹¤.</li>
  <li>Terraform 1.5.x ê¹Œì§€ì™€ëŠ” ìƒíƒœ íŒŒì¼ ê·¸ëŒ€ë¡œ í˜¸í™˜ ë ì •ë„ì…ë‹ˆë‹¤.</li>
  <li>OpenTofuëŠ” í˜„ì¬ ìì²´ Providerê°€ ì—†ìœ¼ë©°, Terraformì˜ ProviderëŠ” ë¼ì´ì„¼ìŠ¤ê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ì´ìƒ ìµœì‹ ë²„ì „ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
  <li>í˜„ì¬ OpenTofuëŠ” Terraform ê³µê¸‰ìì™€ í•¨ê»˜ ë™ì‘í•  ìˆ˜ ìˆì§€ë§Œ ë³„ë„ì˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>OpenTofu 1.7 ë²„ì „ ë¶€í„°ëŠ” í”„ë¡œë•ì…˜í™˜ê²½ì—ì„œ ì“¸ ìˆ˜ ìˆëŠ” ë²„ì „ìœ¼ë¡œ ì•Œë ¤ì ¸ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<p>OpenTofuëŠ” Terraformê³¼ ìœ ì‚¬í•˜ì—¬ ë°”ë¡œ ì„¤ì¹˜ í›„ ì‹¤ìŠµì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.</p>

<h3 id="opentofu-ì„¤ì¹˜">OpenTofu ì„¤ì¹˜</h3>

<p>tenvë¥¼ ì‚¬ìš©í•˜ì—¬ OpenTofuë¥¼ ì„¤ì¹˜í•´ë³´ê² ìŠµë‹ˆë‹¤.
tenvëŠ” tfenvì™€ ìœ ì‚¬í•˜ë‚˜ Terraformë§Œ ê´€ë¦¬í•˜ëŠ” tfenvì™€ëŠ” ë‹¬ë¦¬ tenvëŠ”  Terraform ì™¸ì—ë„ OpenTofu, Terragrunt ë“±ì„ ì„¤ì¹˜í•˜ê³  ë²„ì „ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ê° íˆ´ë³„ë¡œ ëª…ë ¹ê³¼ í™˜ê²½ ë³€ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>

<table>
  <thead>
    <tr>
      <th>íˆ´</th>
      <th>ëª…ë ¹ì–´</th>
      <th>í™˜ê²½ë³€ìˆ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>OpenTofu</td>
      <td>tofu</td>
      <td>TOFUENV_</td>
    </tr>
    <tr>
      <td>Terraform</td>
      <td>terraform</td>
      <td>TFENV_</td>
    </tr>
    <tr>
      <td>Terragrunt</td>
      <td>terragrunt</td>
      <td>TG_</td>
    </tr>
    <tr>
      <td>Atmos</td>
      <td>atmos</td>
      <td>ATMOS_</td>
    </tr>
  </tbody>
</table>

<p>MacOSë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ì¹˜í•˜ê² ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>tenv ì„¤ì¹˜
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¨¼ì € tfenvë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>brew remove tfenv
  
<span class="c"># tenvë¥¼ ì„¤ì¹˜</span>
<span class="nv">$ </span>brew <span class="nb">install </span>tenv
  
<span class="nv">$ </span>tenv <span class="nt">--version</span>
<span class="c"># =&gt; tenv version 2.7.9</span>
  
<span class="nv">$ </span>tenv <span class="nt">-h</span>       <span class="c"># ë„ì›€ë§ ë³´ê¸° </span>
<span class="nv">$ </span>tenv tofu <span class="nt">-h</span>  <span class="c"># OpenTofu ë„ì›€ë§ ë³´ê¸°</span>
  
<span class="c"># (ì˜µì…˜) Install shell completion</span>
<span class="nv">$ </span>tenv completion zsh <span class="o">&gt;</span> ~/.tenv.completion.zsh
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"source '~/.tenv.completion.zsh'"</span> <span class="o">&gt;&gt;</span> ~/.zshrc
</code></pre></div>    </div>
  </li>
  <li>OpenTofu ì„¤ì¹˜
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tenv tofu list            <span class="c"># í˜„ì¬ ì„¤ì¹˜ëœ ëª©ë¡ í™•ì¸</span>
<span class="nv">$ </span>tenv tofu list-remote     <span class="c"># ì„¤ì¹˜ê°€ëŠ¥í•œ ëª©ë¡ í™•ì¸</span>
  
<span class="c"># ì„¤ì¹˜</span>
<span class="nv">$ </span>tenv tofu <span class="nb">install </span>1.7.3   <span class="c"># 1.8ì€ ë„ˆë¬´ ìµœì‹ ì´ì–´ì„œ ì•ˆì •ì ì¸ 1.7.3 ë²„ì „ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.</span>
<span class="c"># =&gt; Installation of OpenTofu 1.7.3 successful</span>
  
<span class="nv">$ </span>tenv tofu list            <span class="c"># ì„¤ì¹˜ëœ ëª©ë¡ í™•ì¸</span>
<span class="c"># =&gt; 1.7.3</span>
<span class="nv">$ </span>tenv tofu use 1.7.3       <span class="c"># ì‚¬ìš©í•  ë²„ì „ ì„ íƒ</span>
<span class="nv">$ </span>tenv tofu detect          <span class="c"># í˜„ì¬ ì‚¬ìš©í•˜ëŠ” ë²„ì „ì˜ ìœ„ì¹˜ë¥¼ í™•ì¸</span>
  
<span class="nv">$ </span>tofu version       <span class="c"># OpenTofu ë²„ì „ í™•ì¸</span>
<span class="c"># =&gt; OpenTofu v1.7.3</span>
<span class="c">#    on darwin_arm64</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="opentofu-17">OpenTofu 1.7</h3>

<h4 id="ì‹¤ìŠµ-provider-defined-functions">[ì‹¤ìŠµ] Provider-defined functions</h4>

<p>OpenTofuì—ì„œ Provider-defined functionsì„ ì‚¬ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.
FunctionsëŠ” í¬ê²Œ Built-in functionsì™€ Provider-defined functionsë¡œ ë‚˜ë‰©ë‹ˆë‹¤.
Built-in functionsëŠ” OpenTofu(Terraform)ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” í•¨ìˆ˜ì´ë©°, Provider-defined functionsëŠ” Providerì—ì„œ ì œê³µí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
ê°ê° ì•„ë˜ì˜ ë§í¬ì—ì„œ ëª©ë¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
  <li>Built-in functions: <a href="https://opentofu.org/docs/language/functions/">https://opentofu.org/docs/language/functions/</a></li>
  <li>Provider-defined functions: <a href="https://library.tf/providers">https://library.tf/providers</a> 
=&gt; (Providerë¥¼ ì„ íƒí•˜ê³  Functions íƒ­ì—ì„œ í™•ì¸)</li>
</ul>

<p>ì´ë²ˆ ì‹¤ìŠµì—ì„œ ì‚¬ìš©í•  í•¨ìˆ˜ëŠ” <a href="https://library.tf/providers/northwood-labs/corefunc/latest/docs/functions/str_snake">Provider::corefunc::str_snake</a>ìœ¼ë¡œ
ë¬¸ìì—´ì„ snake_caseë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.</p>

<ul>
  <li>main.tf ìƒì„±
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">corefunc</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"northwood-labs/corefunc"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"1.4.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">provider</span> <span class="s2">"corefunc"</span> <span class="p">{</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"test"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="k">provider</span><span class="err">::</span><span class="nx">corefunc</span><span class="err">::</span><span class="nx">str_snake</span><span class="p">(</span><span class="s2">"Hello world!"</span><span class="p">)</span>
  <span class="c1"># Prints: hello_world</span>
<span class="p">}</span>   
</code></pre></div>    </div>
  </li>
  <li>ì‹¤í–‰
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì´ˆê¸°í™” (í”„ë¡œë°”ì´ë” ë‹¤ìš´ë¡œë“œ ë“±)</span>
<span class="nv">$ </span>tofu init
  
<span class="c"># í”„ë¡œë°”ì´ë” ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>tree .terraform
<span class="c"># =&gt; .terraform</span>
<span class="c">#    â””â”€â”€ providers</span>
<span class="c">#        â””â”€â”€ registry.opentofu.org</span>
<span class="c">#            â””â”€â”€ northwood-labs</span>
<span class="c">#                â””â”€â”€ corefunc</span>
<span class="c">#                    ...  </span>
  
<span class="c"># ì‹¤í–‰ê³„íš ë³´ê¸°</span>
<span class="nv">$ </span>tofu plan
<span class="c"># ì ìš©</span>
<span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Outputs:</span>
<span class="c">#    test = "hello_world"</span>
  
<span class="nv">$ </span>tofu output
<span class="c"># =&gt; test = "hello_world"</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
</code></pre></div>    </div>
    <p>ëª…ë ¹ë§Œ terraformì—ì„œ tofuë¡œ ë°”ë€Œì—ˆì„ ë¿, ì‚¬ìš©ë²•ê³¼ ê²°ê³¼ëŠ” ê±°ì˜ ë™ì¼í•œê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>main.tf ë¥¼ ìˆ˜ì •í•˜ì—¬ str_camel í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ snake_caseë¥¼ camelCaseë¡œ ë³€í™˜í•´ë³´ê² ìŠµë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">corefunc</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"northwood-labs/corefunc"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"1.4.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">provider</span> <span class="s2">"corefunc"</span> <span class="p">{</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"test"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="k">provider</span><span class="err">::</span><span class="nx">corefunc</span><span class="err">::</span><span class="nx">str_camel</span><span class="p">(</span><span class="s2">"Hello world!"</span><span class="p">)</span>  <span class="c1"># str_snake =&gt; str_camelë¡œ ë³€ê²½</span>
  <span class="c1"># Prints: hello_world</span>
<span class="p">}</span>   
</code></pre></div>    </div>
  </li>
  <li>ì‹¤í–‰
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu plan
<span class="c"># =&gt; Changes to Outputs:</span>
<span class="c">#    ~ test = "hello_world" -&gt; "helloWorld"</span>
  
<span class="c"># ì ìš©</span>
<span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Outputs:</span>
<span class="c">#    test = "helloWorld"</span>
  
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> terraform.tfstate<span class="k">*</span>
<span class="c"># =&gt; -rw-r--r--  1 user  staff  255  8  3 16:02 terraform.tfstate</span>
<span class="c">#    -rw-r--r--  1 user  staff  256  8  3 16:02 terraform.tfstate.backup</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="ì‹¤ìŠµ-loopable-import-blocks">[ì‹¤ìŠµ] Loopable import blocks</h4>
<p><a href="https://opentofu.org/docs/v1.7/intro/whats-new/#loopable-import-blocks">ê´€ë ¨ë¬¸ì„œ</a></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">import</code> ë¸”ë¡ì€ `terraform import ëª…ë ¹ ì²˜ëŸ¼ ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì°¨ì´ì ì€ terraform ì„ ì–¸ íŒŒì¼ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</li>
  <li>ì•„ë˜ëŠ” aws_instance.example ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì˜ˆì œì…ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">import</code> ë¸”ë¡ì—ì„œ <code class="language-plaintext highlighter-rouge">id</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ì ¸ì˜¬ ë¦¬ì†ŒìŠ¤ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># import ë¸”ë¡ ì˜ˆì œ</span>
<span class="nx">import</span> <span class="p">{</span>
  <span class="nx">to</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span>
  <span class="nx">id</span> <span class="p">=</span> <span class="s2">"i-abcd1234"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"hashi"</span>
  <span class="c1"># (other resource arguments...)</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <p>ìœ„ì˜ ì˜ˆì œë¥¼ ìˆ˜í–‰í•˜ë©´ <code class="language-plaintext highlighter-rouge">aws_instance.example</code>ì€ ë§ˆì¹˜ <code class="language-plaintext highlighter-rouge">OpenTofu</code>ì—ì„œ í”„ë¡œë¹„ì €ë‹í•œê²ƒ ì²˜ëŸ¼ state íŒŒì¼ì— ì¶”ê°€ ë©ë‹ˆë‹¤.</p>
  </li>
  <li>ì´ë²ˆ ì‹¤ìŠµì—ì„œëŠ” ìœ„ì˜ <code class="language-plaintext highlighter-rouge">import</code> ë¸”ë¡ì„ Loopë¥¼ ëŒë ¤ì„œ ì—¬ëŸ¬ê°œì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì™€ ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ë¨¼ì € ì •ìƒì ìœ¼ë¡œ AWS ìƒì— EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.
    <ul>
      <li>main.tf ìƒì„±
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"ubuntu"</span> <span class="p">{</span>
    <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
    
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"virtualization-type"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"hvm"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"099720109477"</span><span class="p">]</span> <span class="c1"># Canonical</span>
<span class="p">}</span>
    
<span class="k">variable</span> <span class="s2">"instance_tags"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"web"</span><span class="p">,</span> <span class="s2">"app"</span><span class="p">]</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"this"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="nx">length</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">)</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">ubuntu</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t3.micro"</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>    
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì´ˆê¸°í™”</span>
<span class="nv">$ </span>tofu init
    
<span class="c"># í”„ë¡œë°”ì´ë” ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>tree .terraform
<span class="c"># =&gt; .terraform</span>
<span class="c">#    â””â”€â”€ providers</span>
<span class="c">#        â””â”€â”€ registry.opentofu.org</span>
<span class="c">#            â””â”€â”€ hashicorp</span>
<span class="c">#                â””â”€â”€ aws</span>
<span class="c">#                    â””â”€â”€ 5.60.0</span>
                              
<span class="c"># ì ìš©</span>
<span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span>
    
<span class="c"># EC2 í™•ì¸</span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>aws ec2 describe-instances <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"------------------------------"</span> <span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; app     3.36.26.23      running</span>
<span class="c">#    web     3.39.248.105    running</span>
    
<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>tofu state list
<span class="nv">$ </span>tofu state <span class="nb">ls</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.aws_ami.ubuntu"</span> | tofu console
<span class="nv">$ </span>tofu show          
</code></pre></div>        </div>
      </li>
      <li>tfstate íŒŒì¼ì„ ì‚­ì œí•˜ì—¬ ë¬¸ì œ ìƒí™©ì„ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¬¸ì œ ìƒí™© ë°œìƒ : tfstate íŒŒì¼ ì‚­ì œ</span>
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-r</span> .terraform<span class="k">*</span> terraform.tfstate<span class="k">*</span>
    
<span class="c"># EC2 ID í™•ì¸ : ID ë©”ëª¨ </span>
<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--query</span> <span class="s1">'Reservations[*].Instances[*].{InstanceID:InstanceId,PublicIP:PublicIpAddress,Name:Tags[?Key==`Name`]|[0].Value}'</span> <span class="nt">--output</span> json | jq <span class="nt">-r</span> <span class="s1">'.[][] | "\(.InstanceID)\t\(.PublicIP)\t\(.Name)"'</span>
<span class="c"># =&gt; i-051d42d1feafc4d4a     3.36.26.23      app</span>
<span class="c">#    i-0bb0a855d1749a7c2     3.39.248.105    web</span>
</code></pre></div>        </div>
      </li>
      <li>main.tf íŒŒì¼ ìˆ˜ì •í•˜ì—¬ instance idë¥¼ ìœ„ì—ì„œ í™•ì¸í•œ ID ê°’ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"ubuntu"</span> <span class="p">{</span>
    <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
    
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"virtualization-type"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"hvm"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"099720109477"</span><span class="p">]</span> <span class="c1"># Canonical</span>
<span class="p">}</span>
    
<span class="c1"># ì¶”ê°€ ì‹œì‘</span>
<span class="k">variable</span> <span class="s2">"instance_ids"</span> <span class="p">{</span>                                   
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"i-051d42d1feafc4d4a"</span><span class="p">,</span> <span class="s2">"i-0bb0a855d1749a7c2"</span><span class="p">]</span>
<span class="p">}</span>
<span class="c1"># ì¶”ê°€ ì¢…ë£Œ</span>
    
<span class="k">variable</span> <span class="s2">"instance_tags"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"web"</span><span class="p">,</span> <span class="s2">"app"</span><span class="p">]</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"this"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="nx">length</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">)</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">ubuntu</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t3.micro"</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="c1"># ì¶”ê°€ ì‹œì‘</span>
<span class="nx">import</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">for</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_ids</span> <span class="err">:</span> <span class="nx">idx</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">item</span> <span class="p">}</span>
  <span class="nx">to</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">this</span><span class="p">[</span><span class="nx">tonumber</span><span class="p">(</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="p">)]</span>
  <span class="nx">id</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
<span class="p">}</span>
<span class="c1"># ì¶”ê°€ ì¢…ë£Œ </span>
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì´ˆê¸°í™” </span>
<span class="nv">$ </span>tofu init
    
<span class="c"># import ì‹¤í–‰</span>
<span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Plan: 2 to import, 0 to add, 2 to change, 0 to destroy.</span>
<span class="c">#    aws_instance.this[1]: Importing... [id=i-0bb0a855d1749a7c2]</span>
<span class="c">#    aws_instance.this[1]: Import complete [id=i-0bb0a855d1749a7c2]</span>
<span class="c">#    aws_instance.this[0]: Importing... [id=i-051d42d1feafc4d4a]</span>
<span class="c">#    aws_instance.this[0]: Import complete [id=i-051d42d1feafc4d4a]</span>
<span class="c">#    aws_instance.this[0]: Modifying... [id=i-051d42d1feafc4d4a]</span>
<span class="c">#    aws_instance.this[1]: Modifying... [id=i-0bb0a855d1749a7c2]</span>
<span class="c">#    aws_instance.this[0]: Modifications complete after 1s [id=i-051d42d1feafc4d4a]</span>
<span class="c">#    aws_instance.this[1]: Modifications complete after 1s [id=i-0bb0a855d1749a7c2]</span>
<span class="c">#    Apply complete! Resources: 2 imported, 0 added, 2 changed, 0 destroyed.</span>
    
<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>tofu state <span class="nb">ls</span>
<span class="nv">$ </span>tofu show
    
<span class="c"># ìƒíƒœíŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq    
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<p>í…Œë¼í¼ì—ì„œ í•œë²ˆì— í•˜ë‚˜ì”©ë§Œ import í•  ìˆ˜ ìˆì—ˆëŠ”ë° OpenTofuì—ì„œëŠ” ì—¬ëŸ¬ ê±´ì„ í•œêº¼ë²ˆì— import í•  ìˆ˜ ìˆì–´ í¸ë¦¬í•œê²ƒ ê°™ìŠµë‹ˆë‹¤. 
í…Œë¼í¼ê³¼ OpenTofuì˜ ê²½ìŸì„ í†µí•´ ë”ìš± ë¹ ë¥´ê³  ê°•ë ¥í•˜ê²Œ ë ê²ƒê°™ì•„ ê¸°ëŒ€ë©ë‹ˆë‹¤.</p>

<h4 id="ì‹¤ìŠµ-state-file-encryption---local">[ì‹¤ìŠµ] State file encryption - Local</h4>

<ul>
  <li>OpenTofuì—ì„œëŠ” ìƒíƒœíŒŒì¼ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë° ë°±ì—”ë“œì—ì„œ ì•”í˜¸í™” í•˜ëŠ”ê²ƒì„ ì§€ì›í•©ë‹ˆë‹¤. ë˜í•œ <code class="language-plaintext highlighter-rouge">terraform_remote_state</code> ë°ì´í„° ì†ŒìŠ¤ì™€ í•¨ê»˜ ì•”í˜¸í™”ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì‚¬ìš© í˜•íƒœ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">encryption</span> <span class="p">{</span>
    <span class="nx">key_provider</span> <span class="s2">"some_key_provider"</span> <span class="s2">"some_name"</span> <span class="p">{</span>
      <span class="c1"># í‚¤ í”„ë¡œë°”ì´ë” ì˜µì…˜ ì§€ì • </span>
    <span class="p">}</span>
  
    <span class="nx">method</span> <span class="s2">"some_method"</span> <span class="s2">"some_method_name"</span> <span class="p">{</span>
      <span class="c1"># ë©”ì˜ë“œ ì˜µì…˜ ì§€ì •</span>
      <span class="nx">keys</span> <span class="p">=</span> <span class="nx">key_provider</span><span class="p">.</span><span class="nx">some_key_provider</span><span class="p">.</span><span class="nx">some_name</span>
    <span class="p">}</span>
  
    <span class="nx">state</span> <span class="p">{</span>
      <span class="c1"># ìƒíƒœë°ì´í„° ì•”í˜¸í™”/ë³µí˜¸í™”</span>
      <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">some_method</span><span class="p">.</span><span class="nx">some_method_name</span>   
        
      <span class="nx">fallback</span> <span class="p">{</span>     <span class="c1"># (ì„ íƒì‚¬í•­)</span>
        <span class="c1"># ìœ„ì˜ methodê°€ ì‹¤íŒ¨í•  ê²½ìš° ì‚¬ìš©í•  method</span>
        <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">some_method</span><span class="p">.</span><span class="nx">old_method_name</span>
      <span class="p">}</span>
    <span class="p">}</span>
  
    <span class="nx">plan</span> <span class="p">{</span>
      <span class="c1"># ê³„íš(plan) ë°ì´í„° ì•”í˜¸í™”/ë³µí˜¸í™”</span>
      <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">some_method</span><span class="p">.</span><span class="nx">some_method_name</span>
      <span class="nx">fallback</span> <span class="p">{</span>     <span class="c1"># (ì„ íƒì‚¬í•­)</span>
        <span class="c1"># ìœ„ì˜ methodê°€ ì‹¤íŒ¨í•  ê²½ìš° ì‚¬ìš©í•  method</span>
        <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">some_method</span><span class="p">.</span><span class="nx">old_method_name</span>
      <span class="p">}</span>
    <span class="p">}</span>
  
    <span class="nx">remote_state_data_sources</span> <span class="p">{</span>
      <span class="c1"># terraform_remote_state ë°ì´í„° ì†ŒìŠ¤ ì§€ì •</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>ìœ„ì˜ ì‚¬ìš© í˜•íƒœë¥¼ ì¡°ê¸ˆ ë” ìì„¸í•˜ê²Œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">encryption</span> <span class="p">{</span>
    <span class="c1">## Step 1: ì•”í˜¸í™” ë˜ì§€ ì•Šì€ method:</span>
    <span class="nx">method</span> <span class="s2">"unencrypted"</span> <span class="s2">"migrate"</span> <span class="p">{}</span>
  
    <span class="c1">## Step 2: key provider ì§€ì • - ì•„ë˜ì˜ ì˜ˆì œì—ì„œëŠ” pbkdf2 í‚¤ í”„ë¡œë°”ì´ë”ë¥¼ ì‚¬ìš©í•˜ê³  ë¦¬ì†ŒìŠ¤ ì´ë¦„ì„ mykeyë¡œ ì§€ì •í•©ë‹ˆë‹¤.</span>
    <span class="nx">key_provider</span> <span class="s2">"pbkdf2"</span> <span class="s2">"mykey"</span> <span class="p">{</span>
      <span class="c1"># ì•”í˜¸í™” í‚¤ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. (pbkdf2ëŠ” 16ì ì´ìƒ ì§€ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.)</span>
      <span class="nx">passphrase</span> <span class="p">=</span> <span class="s2">"correct-horse-battery-staple"</span>
  
      <span class="c1"># ì•”í˜¸í™” í‚¤ë¥¼ ì•”í˜¸í™” methodì— ë§ê²Œ ì¡°ì •í•©ë‹ˆë‹¤. (aes-gcmì€ 32ìë¡œ ì§€ì •í•©ë‹ˆë‹¤.)</span>
      <span class="nx">key_length</span> <span class="p">=</span> <span class="mi">32</span>
        
      <span class="c1"># Specify the number of iterations (min. 200.000, default: 600.000)</span>
        <span class="c1">## The work factor for PBKDF2 is implemented through an iteration count, which should set differently based on the internal hashing algorithm used.</span>
            <span class="c1">## PBKDF2-HMAC-SHA1: 1,300,000 iterations</span>
            <span class="c1">## PBKDF2-HMAC-SHA256: 600,000 iterations</span>
            <span class="c1">## PBKDF2-HMAC-SHA512: 210,000 iterations</span>
  
      <span class="c1"># PBKDF2ì—ì„œ ì‚¬ìš©í•  ë°˜ë³µ íšŸìˆ˜ë¥¼ ì§€ì •í•˜ì‹­ì‹œì˜¤ (ìµœì†Œ 200,000, ê¸°ë³¸ê°’: 600,000)</span>
            <span class="c1">## PBKDF2-HMAC-SHA1: 1,300,000 iterations</span>
            <span class="c1">## PBKDF2-HMAC-SHA256: 600,000 iterations</span>
            <span class="c1">## PBKDF2-HMAC-SHA512: 210,000 iterations</span>
      <span class="nx">iterations</span> <span class="p">=</span> <span class="mi">600000</span>
        
      <span class="c1"># ì•”í˜¸í™” salt ê¸¸ì´ë¥¼ byteë¡œ ì§€ì •í•˜ì‹­ì‹œì˜¤. (ê¸°ë³¸ê°’: 32)</span>
      <span class="nx">salt_length</span> <span class="p">=</span> <span class="mi">32</span>
        
      <span class="c1"># í•´ì‹œí•¨ìˆ˜ë¥¼ ì§€ì •í•˜ì‹­ì‹œì˜¤. (sha256 or sha512, default: sha512)</span>
      <span class="nx">hash_function</span> <span class="p">=</span> <span class="s2">"sha512"</span>  
    <span class="p">}</span>
  
    <span class="c1">## Step 3: ì•”í˜¸í™” methodë¥¼ ì§€ì •í•˜ì‹­ì‹œì˜¤ - ì•„ë˜ì˜ ì˜ˆì œì—ì„œëŠ” aes_gcm ì•”í˜¸í™” methodë¥¼ ì‚¬ìš©í•˜ê³  ë¦¬ì†ŒìŠ¤ ì´ë¦„ì„ new_methodë¡œ ì§€ì •í•©ë‹ˆë‹¤.</span>
    <span class="nx">method</span> <span class="s2">"aes_gcm"</span> <span class="s2">"new_method"</span> <span class="p">{</span>
      <span class="c1"># ì•”í˜¸í™” í‚¤ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì•ì—ì„œ ë§Œë“  my_key ë¦¬ì†ŒìŠ¤ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.</span>
      <span class="nx">keys</span> <span class="p">=</span> <span class="nx">key_provider</span><span class="p">.</span><span class="nx">pbkdf2</span><span class="p">.</span><span class="nx">mykey</span>
    <span class="p">}</span>
  
    <span class="nx">state</span> <span class="p">{</span>
      <span class="c1"># ìƒíƒœ íŒŒì¼ì˜ ì•”í˜¸í™” ë°©ë²•ì„ ì§€ì •í•©ë‹ˆë‹¤.</span>
  
      <span class="c1">## Step 4: ì•”í˜¸í™” methodë¥¼ ì§€ì •í•˜ì‹­ì‹œì˜¤.</span>
      <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">aes_gcm</span><span class="p">.</span><span class="nx">new_method</span>
  
      <span class="c1">## Step 5: Step 4ê°€ ì‹¤íŒ¨í•  ê²½ìš° ì‚¬ìš©í•  "fallback" methodë¥¼ ì§€ì •í•˜ì‹­ì‹œì˜¤.</span>
      <span class="nx">fallback</span> <span class="p">{</span>
        <span class="c1">## "unencrypted" methodë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</span>
        <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">unencrypted</span><span class="p">.</span><span class="nx">migrate</span>
      <span class="p">}</span>
  
      <span class="c1">## Step 6: "tofu apply" ì ìš©</span>
  
      <span class="c1">## Step 7: ì•”í˜¸í™”ë¥¼ ê°•ì œ í•˜ê³  ì‹¶ìœ¼ë©´ fallback ë¸”ë¡ì„ ì‚­ì œí•˜ê³  ì•„ë˜ì˜ enforce = true ì˜µì…˜ì„ ì¶”ê°€í•˜ì‹­ì‹œì˜¤.</span>
      <span class="c1"># enforced = true</span>
    <span class="p">}</span>
  
    <span class="c1">## Step 8: ê³„íš(plan)ë„ ì•”í˜¸í™” í•˜ê³  ì‹¶ë‹¤ë©´ Step 4 ~ 7ì„ ë°˜ë³µí•˜ì‹­ì‹œì˜¤.</span>
  <span class="p">}</span>
<span class="p">}</span>  
</code></pre></div>    </div>
  </li>
  <li>ì•”í˜¸í™” ì‹¤ìŠµ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
  
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">encryption</span> <span class="p">{</span>
    <span class="nx">key_provider</span> <span class="s2">"pbkdf2"</span> <span class="s2">"my_passphrase"</span> <span class="p">{</span>
      <span class="c1">## Enter a passphrase here:</span>
      <span class="nx">passphrase</span> <span class="p">=</span> <span class="s2">"ChangeIt_123abcd"</span>
    <span class="p">}</span>
  
    <span class="nx">method</span> <span class="s2">"aes_gcm"</span> <span class="s2">"my_method"</span> <span class="p">{</span>
      <span class="nx">keys</span> <span class="p">=</span> <span class="nx">key_provider</span><span class="p">.</span><span class="nx">pbkdf2</span><span class="p">.</span><span class="nx">my_passphrase</span>
    <span class="p">}</span>
  
    <span class="c1">## Remove this after the migration:</span>
    <span class="nx">method</span> <span class="s2">"unencrypted"</span> <span class="s2">"migration"</span> <span class="p">{</span>
    <span class="p">}</span>
  
    <span class="nx">state</span> <span class="p">{</span>
      <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">aes_gcm</span><span class="p">.</span><span class="nx">my_method</span>
  
      <span class="c1">## Remove the fallback block after migration:</span>
      <span class="nx">fallback</span><span class="p">{</span>
        <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">unencrypted</span><span class="p">.</span><span class="nx">migration</span>
      <span class="p">}</span>
      <span class="c1">## Enable this after migration:</span>
      <span class="c1">#enforced = true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu init <span class="o">&amp;&amp;</span> tofu apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>tofu state list 
<span class="nv">$ </span>tofu show 
    
<span class="c"># ìƒíƒœ íŒŒì¼ ì•”í˜¸í™” í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "serial": 1,</span>
<span class="c">#      "lineage": "35fa959f-d819-8d1b-e036-c81f4827cf21",</span>
<span class="c">#      "meta": {</span>
<span class="c">#        "key_provider.pbkdf2.my_passphrase": "eyJzYWx0IjoiRGJXSzhyR3hBSHdQOUoxSmZncTYyaEJFSW9LaVZGNy9GK2JjSmlxQTBiT</span>
<span class="c">#         T0iLCJpdGVyYXRpb25zIjo2MDAwMDAsImhhc2hfZnVuY3Rpb24iOiJzaGE1MTIiLCJrZXlfbGVuZ3RoIjozMn0="</span>
<span class="c">#      },</span>
<span class="c">#      "encrypted_data": "EIuEr7sU9kb37t11Oy2JmbI1F/WFOYPuBjUlVV//IlrXVQYWyhlgw+JXu8m+2cztDGbkNIZ5h/giflO4nCUESI3mSP</span>
<span class="c">#         D8ZGETc80hR/JptGIv03RnKcyYXqzwoFDHS/7D8I4E5/itpBnmWCAXsFUTpoJ/vKySl3DfUrd/KFDKm0Db5RK2BjYywF+BeexpL7l//EZM</span>
<span class="c">#         zvyXkz0Tx85b+7q6SopHwUm1FztxSjqL2yiz1uZlyv5cJgUFHpsYV4geF/geMmDc5Kf9sysRNiJYaEJSrg==",</span>
<span class="c">#      "encryption_version": "v0"</span>
<span class="c">#    }    </span>
</code></pre></div>        </div>
      </li>
      <li>ì•”í˜¸í™” ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ì•”í˜¸í™”ê°€ apply ëœ ì´í›„ì—ëŠ” <code class="language-plaintext highlighter-rouge">method "unencrypt"</code>ì™€ <code class="language-plaintext highlighter-rouge">fallback</code> ë¸”ë¡ì„ ì‚­ì œí•˜ê³ , <code class="language-plaintext highlighter-rouge">enforced = true</code> ì˜µì…˜ì„ ì¶”ê°€í•˜ì—¬ ì•”í˜¸í™”ë¥¼ ê°•ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ë³µí˜¸í™” ì‹¤ìŠµ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">encryption</span> <span class="p">{</span>
    <span class="nx">key_provider</span> <span class="s2">"pbkdf2"</span> <span class="s2">"my_passphrase"</span> <span class="p">{</span>
      <span class="c1">## Enter a passphrase here:</span>
      <span class="nx">passphrase</span> <span class="p">=</span> <span class="s2">"ChangeIt_123abcd"</span>
    <span class="p">}</span>
  
    <span class="nx">method</span> <span class="s2">"aes_gcm"</span> <span class="s2">"my_method"</span> <span class="p">{</span>
      <span class="nx">keys</span> <span class="p">=</span> <span class="nx">key_provider</span><span class="p">.</span><span class="nx">pbkdf2</span><span class="p">.</span><span class="nx">my_passphrase</span>
    <span class="p">}</span>
  
    <span class="c1">## Remove this after the migration:</span>
    <span class="nx">method</span> <span class="s2">"unencrypted"</span> <span class="s2">"migration"</span> <span class="p">{</span>
    <span class="p">}</span>
  
    <span class="nx">state</span> <span class="p">{</span>
      <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">unencrypted</span><span class="p">.</span><span class="nx">migration</span>
  
      <span class="c1">## Remove the fallback block after migration:</span>
      <span class="nx">fallback</span><span class="p">{</span>
        <span class="nx">method</span> <span class="p">=</span> <span class="nx">method</span><span class="p">.</span><span class="nx">aes_gcm</span><span class="p">.</span><span class="nx">my_method</span>
      <span class="p">}</span>
      <span class="c1"># Enable this after migration:</span>
      <span class="nx">enforced</span> <span class="p">=</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
    
<span class="c"># ìƒíƒœ íŒŒì¼ ë³µí˜¸í™” í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "version": 4,</span>
<span class="c">#      "terraform_version": "1.7.3",</span>
<span class="c">#      "serial": 1,</span>
<span class="c">#      "lineage": "35fa959f-d819-8d1b-e036-c81f4827cf21",</span>
<span class="c">#      "outputs": {},</span>
<span class="c">#      "resources": [],</span>
<span class="c">#      "check_results": null</span>
<span class="c">#    }    </span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ë³µí˜¸í™”ê°€ ì •ìƒì ìœ¼ë¡œ ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì‹¤ìŠµì—ì„œëŠ” ì•”í˜¸í™”í‚¤ë¥¼ í•˜ë“œì½”ë”©í•˜ì˜€ì§€ë§Œ,
ì‹¤ì œ ì‚¬ìš©í• ë•ŒëŠ” ì•”í˜¸í™” í‚¤ë¥¼ ë³€ìˆ˜ë¡œ ì…ë ¥ ë°›ë„ë¡ í•˜ê±°ë‚˜, AWS KMS ì™€ ê°™ì´ ê´€ë¦¬ë˜ëŠ” í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë³´ì•ˆì„±ì„ ë†’ì¼ ìˆ˜ ìˆì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.</li>
</ul>

<h4 id="ì‹¤ìŠµ-removed-block">[ì‹¤ìŠµ] Removed Block</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">removed</code> ë¸”ë¡ì„ ì‚¬ìš©í•˜ë©´ ì‹¤ì œ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì³ì— í”„ë¡œë¹„ì €ë‹ëœ ë¦¬ì†ŒìŠ¤ëŠ” ì‚­ì œí•˜ì§€ ì•Šê³  ìƒíƒœíŒŒì¼ì—ì„œë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì‚¬ìš© ë°©ë²•
    <ul>
      <li>ë¨¼ì € ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„± í•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"test"</span> <span class="p">{</span>
  <span class="nx">content</span> <span class="p">=</span> <span class="s2">"Hello world!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"test.txt"</span>
<span class="p">}</span> 
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">removed</code> ë¸”ë¡ì„ ì¶”ê°€í•˜ì—¬ ìƒíƒœíŒŒì¼ì—ì„œë§Œ ì‚­ì œí•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">removed</span> <span class="p">{</span>
  <span class="nx">from</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">test</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰ì„ í•˜ë©´ <code class="language-plaintext highlighter-rouge">local_file.test</code> ë¦¬ì†ŒìŠ¤ëŠ” ìƒíƒœ íŒŒì¼ì—ì„œ ì‚­ì œ ë˜ì§€ë§Œ, í”„ë¡œë¹„ì €ë‹ëœ test.txtëŠ” ê·¸ëŒ€ë¡œ ë‚¨ì•„ìˆìŒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">removed</code> ë¸”ë¡ì„ apply í•œ ì´í›„ì— <code class="language-plaintext highlighter-rouge">resource</code> ë¸”ë¡ì„ ì‚­ì œí•´ë„ ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"ubuntu"</span> <span class="p">{</span>
    <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
  
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"</span><span class="p">]</span>
    <span class="p">}</span>
  
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"virtualization-type"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"hvm"</span><span class="p">]</span>
    <span class="p">}</span>
  
    <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"099720109477"</span><span class="p">]</span> <span class="c1"># Canonical</span>
<span class="p">}</span>
  
<span class="k">variable</span> <span class="s2">"instance_tags"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"web"</span><span class="p">,</span> <span class="s2">"app"</span><span class="p">]</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"this"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="nx">length</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">)</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">ubuntu</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t3.micro"</span>
  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_ssm_parameter"</span> <span class="s2">"this"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="nx">length</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">)</span>
  <span class="nx">name</span>  <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
  <span class="nx">type</span>  <span class="p">=</span> <span class="s2">"String"</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">this</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">id</span>
<span class="p">}</span>    
</code></pre></div>    </div>
    <ul>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu init <span class="o">&amp;&amp;</span> tofu apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 4 added, 0 changed, 0 destroyed.</span>
    
<span class="nv">$ </span>tree .terraform
<span class="nv">$ </span>tofu state <span class="nb">ls</span>
<span class="nv">$ </span>tofu show
<span class="nv">$ </span>tofu state show <span class="s1">'aws_ssm_parameter.this[0]'</span>
    
<span class="c"># tfstate íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
    
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'"i-'</span>
<span class="c"># =&gt; "id": "i-036b9e057c2eb71d8",</span>
<span class="c">#    "id": "i-0f8f05caabc524b47",</span>
<span class="c">#    "value": "i-036b9e057c2eb71d8",</span>
<span class="c">#    "value": "i-0f8f05caabc524b47",    </span>
    
<span class="c"># parameters ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>aws ssm describe-parameters | jq
<span class="nv">$ </span>aws ssm get-parameter <span class="nt">--name</span> <span class="s2">"web"</span>
<span class="nv">$ </span>aws ssm get-parameter <span class="nt">--name</span> <span class="s2">"web"</span> <span class="nt">--query</span> <span class="s2">"Parameter.Value"</span> <span class="nt">--output</span> text
<span class="c"># =&gt; i-036b9e057c2eb71d8</span>
<span class="nv">$ </span>aws ssm get-parameter <span class="nt">--name</span> <span class="s2">"app"</span>
<span class="nv">$ </span>aws ssm get-parameter <span class="nt">--name</span> <span class="s2">"app"</span> <span class="nt">--query</span> <span class="s2">"Parameter.Value"</span> <span class="nt">--output</span> text
<span class="c"># =&gt; i-0f8f05caabc524b47</span>
    
<span class="c"># EC2 ëª©ë¡ í™•ì¸</span>
<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--query</span> <span class="s1">'Reservations[*].Instances[*].{InstanceID:InstanceId,PublicIP:PublicIpAddress,Name:Tags[?Key==`Name`]|[0].Value}'</span> <span class="nt">--output</span> json | jq <span class="nt">-r</span> <span class="s1">'.[][] | "\(.InstanceID)\t\(.PublicIP)\t\(.Name)"'</span>
<span class="c"># =&gt; i-036b9e057c2eb71d8     3.34.132.49     web</span>
<span class="c">#    i-0f8f05caabc524b47     3.35.51.118     app   </span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">removed</code> ë¸”ë¡ ì¶”ê°€í•˜ì—¬ ssm parameterì™€ EC2ë¥¼ ë¦¬ì†ŒìŠ¤ëŠ” ê·¸ëŒ€ë¡œ ë‘ê³  state íŒŒì¼ì—ì„œë§Œ ì‚­ì œí•˜ê² ìŠµë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"ubuntu"</span> <span class="p">{</span>
    <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
    
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"virtualization-type"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"hvm"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"099720109477"</span><span class="p">]</span> <span class="c1"># Canonical</span>
<span class="p">}</span>
    
<span class="k">variable</span> <span class="s2">"instance_tags"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"web"</span><span class="p">,</span> <span class="s2">"app"</span><span class="p">]</span>
<span class="p">}</span>
    
<span class="c1">## ë¦¬ì†ŒìŠ¤ ì •ì˜ íŒŒì¼ì—ì„œ ì£¼ì„ì²˜ë¦¬í•˜ì—¬ ì‚­ì œ</span>
<span class="c1"># resource "aws_instance" "this" {</span>
<span class="c1">#   count = length(var.instance_tags)</span>
<span class="c1">#   ami                    = data.aws_ami.ubuntu.id</span>
<span class="c1">#   instance_type          = "t3.micro"</span>
<span class="c1">#  </span>
<span class="c1">#   tags = {</span>
<span class="c1">#     Name = var.instance_tags[count.index]</span>
<span class="c1">#   }</span>
<span class="c1"># }</span>
    
<span class="c1">## ë¦¬ì†ŒìŠ¤ ì •ì˜ íŒŒì¼ì—ì„œ ì£¼ì„ì²˜ë¦¬í•˜ì—¬ ì‚­ì œ</span>
<span class="c1"># resource "aws_ssm_parameter" "this" {</span>
<span class="c1">#   count = length(var.instance_tags)</span>
<span class="c1">#   name  = var.instance_tags[count.index]</span>
<span class="c1">#   type  = "String"</span>
<span class="c1">#   value = aws_instance.this[count.index].id</span>
<span class="c1"># }    </span>
  
<span class="nx">removed</span> <span class="p">{</span> <span class="c1"># ì¶”ê°€</span>
  <span class="nx">from</span> <span class="p">=</span> <span class="nx">aws_ssm_parameter</span><span class="p">.</span><span class="nx">this</span>
<span class="p">}</span>
  
<span class="nx">removed</span> <span class="p">{</span> <span class="c1"># ì¶”ê°€</span>
  <span class="nx">from</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">this</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    # aws_ssm_parameter.this[0] will be removed from the OpenTofu state but will not be destroyed</span>
<span class="c">#    ...</span>
<span class="c">#    # aws_ssm_parameter.this[1] will be removed from the OpenTofu state but will not be destroyed</span>
<span class="c">#    Apply complete! Resources: 0 added, 0 changed, 0 destroyed.</span>

<span class="c"># tfstate íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
    
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'"i-'</span>
<span class="c"># =&gt; &lt;ê²°ê³¼ ì—†ìŒ&gt;         </span>
</code></pre></div>        </div>
        <p>ìƒíƒœíŒŒì¼ì—ì„œ ì‚­ì œëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. AWSì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws ssm describe-parameters | jq
<span class="nv">$ </span>aws ssm get-parameter <span class="nt">--name</span> <span class="s2">"web"</span>
<span class="nv">$ </span>aws ssm get-parameter <span class="nt">--name</span> <span class="s2">"web"</span> <span class="nt">--query</span> <span class="s2">"Parameter.Value"</span> <span class="nt">--output</span> text
<span class="c"># =&gt; i-036b9e057c2eb71d8</span>
<span class="nv">$ </span>aws ssm get-parameter <span class="nt">--name</span> <span class="s2">"app"</span>
<span class="nv">$ </span>aws ssm get-parameter <span class="nt">--name</span> <span class="s2">"app"</span> <span class="nt">--query</span> <span class="s2">"Parameter.Value"</span> <span class="nt">--output</span> text
<span class="c"># =&gt; i-0f8f05caabc524b47</span>
    
<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--query</span> <span class="s1">'Reservations[*].Instances[*].{InstanceID:InstanceId,PublicIP:PublicIpAddress,Name:Tags[?Key==`Name`]|[0].Value}'</span> <span class="nt">--output</span> json | jq <span class="nt">-r</span> <span class="s1">'.[][] | "\(.InstanceID)\t\(.PublicIP)\t\(.Name)"'</span>
<span class="c"># =&gt; i-036b9e057c2eb71d8     3.34.132.49     web</span>
<span class="c">#    i-0f8f05caabc524b47     3.35.51.118     app</span>
</code></pre></div>        </div>
        <p>ìƒíƒœ íŒŒì¼ì—ì„œëŠ” ì—†ì–´ì¡Œì§€ë§Œ AWSì— í”„ë¡œë¹„ì €ë‹ëœ ë¦¬ì†ŒìŠ¤ëŠ” ë‚¨ì•„ìˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </li>
      <li>ì´ë ‡ê²Œí•˜ì—¬ <code class="language-plaintext highlighter-rouge">removed</code> ë¸”ë¡ì„ ì‹¤ìŠµí•´ë³´ì•˜ìŠµë‹ˆë‹¤. AWSì—ì„œ ì‹¤ìŠµí•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê±°ë‚˜, 
ì¶”ê°€ì ìœ¼ë¡œ import ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ ìƒíƒœíŒŒì¼ì— ë‹¤ì‹œ ë„£ì€ ë‹¤ìŒ destroy í•˜ëŠ”ê²ƒì„ ì‹¤ìŠµí•´ë³´ëŠ”ê²ƒë„ ì¢‹ì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h4 id="ì‹¤ìŠµ-test">[ì‹¤ìŠµ] Test</h4>

<ul>
  <li>OpenTofuì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">tofu test</code>ë¼ëŠ” ëª…ë ¹ì„ í†µí•´ êµ¬ì„±íŒŒì¼ì˜ ë‚´ìš©ì„ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œ ì¸í”„ë¼ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê³  ì›í•˜ëŠ” ì¡°ê±´ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.
<code class="language-plaintext highlighter-rouge">postcondition</code>ê³¼ ìœ ì‚¬í•œë° <strong>ë‹¤ë¥¸ ì </strong>ì€ í…ŒìŠ¤íŠ¸ ì¤‘ì— <strong>ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ëŠ” ìë™ìœ¼ë¡œ ì‚­ì œëœë‹¤</strong>ëŠ” ê²ƒì…ë‹ˆë‹¤.</li>
  <li>ì‚¬ìš© ë°©ë²•
    <ul>
      <li>ë¨¼ì € êµ¬ì„±íŒŒì¼ê³¼ ê°™ì€ ë””ë ‰í„°ë¦¬ ë˜ëŠ” <code class="language-plaintext highlighter-rouge">tests</code> ë””ë ‰í„°ë¦¬ ì•„ë˜ì— <code class="language-plaintext highlighter-rouge">*.tftest.hcl</code> íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">*.tftest.hcl</code> íŒŒì¼ì— í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. ë˜í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë³€ìˆ˜íŒŒì¼ (.tfvars)ê°€ í•„ìš”í•˜ë©´ í•´ë‹¹ íŒŒì¼ë„ <code class="language-plaintext highlighter-rouge">tests</code> ë””ë ‰í„°ë¦¬ì— ë§Œë“¤ë©´ í…ŒìŠ¤íŠ¸ ì‹œì—ë§Œ ì‚¬ìš© ë©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">*.tftest.hcl</code> ì˜ í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">run</span> <span class="s2">"test"</span> <span class="p">{</span>
  <span class="nx">assert</span> <span class="p">{</span>
    <span class="nx">condition</span>     <span class="p">=</span> <span class="nx">file</span><span class="p">(</span><span class="nx">local_file</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">filename</span><span class="p">)</span> <span class="p">==</span> <span class="s2">"Hello world!"</span>
    <span class="nx">error_message</span> <span class="p">=</span> <span class="s2">"Incorrect content in </span><span class="k">${</span><span class="nx">local_file</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">filename</span><span class="k">}</span><span class="s2">."</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ
    <ul>
      <li>main.tf ì‘ì„±
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"test"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">string</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"this"</span> <span class="p">{</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/test.txt"</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">test</span>
<span class="p">}</span>     
</code></pre></div>        </div>
      </li>
      <li>tests/main.tftest.hcl ì‘ì„±
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># tests/main.tftest.hcl           </span>
<span class="nx">run</span> <span class="s2">"test"</span> <span class="p">{</span>
  <span class="nx">assert</span> <span class="p">{</span>
    <span class="nx">condition</span>     <span class="p">=</span> <span class="nx">file</span><span class="p">(</span><span class="nx">local_file</span><span class="p">.</span><span class="nx">this</span><span class="p">.</span><span class="nx">filename</span><span class="p">)</span> <span class="p">==</span> <span class="kd">var</span><span class="p">.</span><span class="nx">test</span>
    <span class="nx">error_message</span> <span class="p">=</span> <span class="s2">"Incorrect content in file"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰ í›„ í™•ì¸
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu init
<span class="nv">$ </span>tree .terraform
    
<span class="c"># Test ì‹¤í–‰</span>
<span class="nv">$ </span>tofu <span class="nb">test</span>
<span class="c"># =&gt; tests/main.tftest.hcl... fail</span>
<span class="c">#      run "test"... fail</span>
<span class="c">#      â”‚ Error: No value for required variable</span>
</code></pre></div>        </div>
      </li>
      <li>ë³€ìˆ˜ê°€ ì—†ë‹¤ë©° í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤. ë³€ìˆ˜ë¥¼ ë„£ì–´ì„œ ë‹¤ì‹œ ì‹¤í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤.
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë°©ë²•1. -var ë¡œ ë³€ìˆ˜ë¥¼ ë„£ì–´ì„œ ì‹¤í–‰</span>
<span class="nv">$ </span>tofu <span class="nb">test</span> <span class="nt">-var</span> <span class="s1">'test=Hello world!'</span>
<span class="c"># =&gt; tests/main.tftest.hcl... pass</span>
<span class="c">#      run "test"... pass</span>
<span class="c">#    Success! 1 passed, 0 failed.</span>
    
<span class="c"># ë°©ë²•2. tests/terraform.tfvars íŒŒì¼ ì‘ì„±</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'test = "T101 4th thank you!"'</span> <span class="o">&gt;</span> tests/terraform.tfvars 
<span class="nv">$ </span>tofu <span class="nb">test</span>
<span class="c"># =&gt; tests/main.tftest.hcl... pass</span>
<span class="c">#      run "test"... pass</span>
<span class="c">#    Success! 1 passed, 0 failed.</span>
    
<span class="nv">$ </span>tofu state list
<span class="c"># =&gt; No state file was found!</span>
<span class="c"># ìƒíƒœíŒŒì¼ì´ ì—†ë‹¤ê³  ë‚˜ì˜¤ëŠ”ë°, í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í”„ë¡œë¹„ì €ë‹í•œ ë¦¬ì†ŒìŠ¤ëŠ” ìë™ìœ¼ë¡œ ì‚­ì œë˜ì–´ì„œ ë³„ë„ë¡œ ìƒíƒœíŒŒì¼ì„ ìƒì„±í•˜ì§€ ì•ŠëŠ”ê²ƒ ê°™ìŠµë‹ˆë‹¤.</span>

<span class="nv">$ </span><span class="nb">cat </span>test.txt
<span class="c"># =&gt; cat: test.txt: No such file or directory</span>
<span class="c"># í…ŒìŠ¤íŠ¸ëœ íŒŒì¼ì€ ì‚­ì œëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
        
<span class="c"># Apply í™•ì¸</span>
<span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>tofu state list
<span class="c"># =&gt; local_file.this    </span>
<span class="nv">$ </span><span class="nb">cat </span>test.txt
<span class="c"># =&gt; T101 4th thank you!</span>
</code></pre></div>        </div>
      </li>
      <li>í˜¹ì‹œë‚˜ í•´ì„œ <code class="language-plaintext highlighter-rouge">tofu test</code>ë¥¼ í•œë²ˆë” ì‹¤í–‰í•œ ë‹¤ìŒ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu <span class="nb">test</span>
<span class="nv">$ </span>tofu state list
<span class="c"># =&gt; local_file.this</span>
<span class="nv">$ </span><span class="nb">cat </span>test.txt
<span class="c"># =&gt; cat: test.txt: No such file or directory</span>
</code></pre></div>        </div>
      </li>
      <li>ì´ë¯¸ í”„ë¡œë¹„ì €ë‹ ëœ ìƒíƒœì—ì„œ testë¥¼ í•  ê²½ìš° <strong>ìƒíƒœíŒŒì¼ì€ ë‚¨ì•„ìˆì§€ë§Œ ì‹¤ì œ ë¦¬ì†ŒìŠ¤(ì—¬ê¸°ì„œëŠ” íŒŒì¼)ì€ ì‚­ì œë˜</strong>ëŠ”ê²ƒ ê°™ìŠµë‹ˆë‹¤. 
í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©ì‹œ ì£¼ì˜ê°€ í•„ìš”í•´ë³´ì…ë‹ˆë‹¤. :sweat_smile:</li>
    </ul>
  </li>
</ul>

<h4 id="ì‹¤ìŠµ-terraformì„-opentofu-17ë¡œ-ì´ì „í•˜ê¸°">[ì‹¤ìŠµ] Terraformì„ OpenTofu 1.7ë¡œ ì´ì „í•˜ê¸°</h4>

<ul>
  <li>OpenTofu 1.7ë¡œ Terraformì„ ì´ì „í•˜ëŠ” ë°©ë²•ì„ ì‹¤ìŠµí•´ë³´ê² ìŠµë‹ˆë‹¤. Terraform ë²„ì „ì€ ìµœì†Œ 1.8.2 ì´ìƒì„ ì‚¬ìš©í• ê²ƒì„ ê¶Œê³ í•œë‹¤ í•©ë‹ˆë‹¤.
ì—¬ê¸°ì—ì„œëŠ” Terraform 1.8.5 ë²„ì „ìœ¼ë¡œ ì‹¤ìŠµí•´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>Tenvë¡œ Terraform 1.8.5 ì„¤ì¹˜
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tenv tf <span class="nb">install </span>1.8.5 
<span class="c"># =&gt; ...</span>
<span class="c">#    Installation of Terraform 1.8.5 successful</span>
<span class="nv">$ </span>tenv tf list
<span class="c"># =&gt;   1.8.5 (never used)</span>
<span class="nv">$ </span>tenv tf detect
</code></pre></div>    </div>
  </li>
  <li>main.tf íŒŒì¼ ì‘ì„±
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"ubuntu"</span> <span class="p">{</span>
    <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
  
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"</span><span class="p">]</span>
    <span class="p">}</span>
  
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"virtualization-type"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"hvm"</span><span class="p">]</span>
    <span class="p">}</span>
  
    <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"099720109477"</span><span class="p">]</span> <span class="c1"># Canonical</span>
<span class="p">}</span>
  
<span class="k">variable</span> <span class="s2">"instance_tags"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"web"</span><span class="p">,</span> <span class="s2">"app"</span><span class="p">]</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"this"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="nx">length</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">)</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">ubuntu</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t3.micro"</span>
  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_tags</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>ì‹¤í–‰ í›„ í™•ì¸
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì´ˆê¸°í™”</span>
<span class="nv">$ </span>terraform init
  
<span class="c"># í”„ë¡œë°”ì´ë” ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>tree .terraform 
<span class="c"># =&gt; .terraform</span>
<span class="c">#    â””â”€â”€ providers</span>
<span class="c">#        â””â”€â”€ registry.terraform.io</span>
<span class="c">#            â””â”€â”€ hashicorp</span>
<span class="c">#                â””â”€â”€ aws</span>
<span class="c">#                    â””â”€â”€ 5.61.0  </span>
                                 
<span class="c"># ì ìš©</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span>
  
<span class="c"># EC2 í™•ì¸</span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>aws ec2 describe-instances <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"------------------------------"</span> <span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; app     3.38.165.56     running</span>
<span class="c">#    web     43.203.241.233  running</span>
  
<span class="c"># ìƒíƒœ í™•ì¸</span>
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; data.aws_ami.ubuntu</span>
<span class="c">#    aws_instance.this[0]</span>
<span class="c">#    aws_instance.this[1]</span>
  
<span class="c"># tfstate íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
</code></pre></div>    </div>
  </li>
  <li>ë§ˆì´ê·¸ë ˆì´ì…˜
    <ul>
      <li>í˜„ì¬ ìµœì‹  ìƒíƒœì—¬ë¶€ í™•ì¸
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform plan 
<span class="c"># =&gt; No changes. Your infrastructure matches the configuration.</span>
</code></pre></div>        </div>
      </li>
      <li>tfstate íŒŒì¼ê³¼ êµ¬ì„± íŒŒì¼ ë°±ì—…
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp </span>terraform.tfstate terraform.tfstate.bak
<span class="nv">$ </span><span class="nb">cp </span>main.tf main.tf.bak
</code></pre></div>        </div>
      </li>
      <li>Terraformê³¼ OpenTofu ê°„ì˜ ì°¨ì´ë¡œ ì¸í•œ ìˆ˜ì •ì´ ë¶ˆê°€í”¼í•œ ì½”ë“œ ë³€ê²½
        <ul>
          <li>S3 Backend ì‚¬ìš©ì‹œ ë‹¤ìŒì˜ ë³€ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤.
            <ul>
              <li><code class="language-plaintext highlighter-rouge">skip_s3_checksum</code> ì˜µì…˜ì„ ì‚¬ìš©ì¤‘ì´ë¼ë©´ OpenTofuëŠ” í•„ìš”ë¡œ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì‚­ì œí•©ë‹ˆë‹¤.</li>
              <li><code class="language-plaintext highlighter-rouge">endpoints</code> =&gt; <code class="language-plaintext highlighter-rouge">sso</code> ì˜µì…˜ì„ ì‚¬ìš©ì¤‘ì´ê±°ë‚˜ <code class="language-plaintext highlighter-rouge">AWS_ENDPOINT_URL</code> í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©ì¤‘ì´ë¼ë©´ ì‚­ì œí•©ë‹ˆë‹¤.</li>
            </ul>
          </li>
          <li><code class="language-plaintext highlighter-rouge">removed</code> ë¸”ë¡ ì‚­ì œ : OpenTofuì˜ <code class="language-plaintext highlighter-rouge">removed</code> ë¸”ë¡ê³¼ëŠ” ë™ì‘ ë°©ì‹ ì°¨ì´ê°€ ìˆê¸° ë•Œë¬¸ì— ì‚­ì œí•©ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>OpenTofu ì´ˆê¸°í™” ë° Plan
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì´ˆê¸°í™”</span>
<span class="nv">$ </span>tofu init
<span class="nv">$ </span>tree .terraform <span class="nt">-L</span> 5 
<span class="c"># =&gt; .terraform</span>
<span class="c">#    â””â”€â”€ providers</span>
<span class="c">#        â”œâ”€â”€ registry.opentofu.org</span>
<span class="c">#        â”‚   â””â”€â”€ hashicorp</span>
<span class="c">#        â”‚       â””â”€â”€ aws</span>
<span class="c">#        â”‚           â””â”€â”€ 5.61.0</span>
<span class="c">#        â””â”€â”€ registry.terraform.io</span>
<span class="c">#            â””â”€â”€ hashicorp</span>
<span class="c">#                â””â”€â”€ aws</span>
<span class="c">#                    â””â”€â”€ 5.61.0</span>
    
<span class="c"># Plan</span>
<span class="nv">$ </span>tofu plan
<span class="c"># =&gt; No changes. Your infrastructure matches the configuration.</span>
</code></pre></div>        </div>
      </li>
      <li>ì •ìƒì ìœ¼ë¡œ Terraformì„ OpenTofuë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œí•œê²ƒ ê°™ìŠµë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">.terraform</code> ë””ë ‰í„°ë¦¬ì—ëŠ” Terraformìš© í”„ë¡œë°”ì´ë”ì™€ OpenTofuìš© í”„ë¡œë°”ì´ë” ë‘˜ ë‹¤ ì¡´ì¬í•˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ì´ì œ ì‹¤ì œ ì ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; No changes. Your infrastructure matches the configuration.</span>
<span class="c">#    OpenTofu has compared your real infrastructure against your configuration and found no differences, so no changes are needed.</span>
<span class="c">#    Apply complete! Resources: 0 added, 0 changed, 0 destroyed.</span>
    
<span class="c"># EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì‹ ê·œ íƒœê·¸ë¥¼ ì¶”ê°€ í›„ apply í•´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>vi main.tf 
...
tags <span class="o">=</span> <span class="o">{</span>
  Name <span class="o">=</span> var.instance_tags[count.index]
  T101 <span class="o">=</span> <span class="s2">"end"</span>
<span class="o">}</span>
...
    
<span class="c"># ì ìš©</span>
<span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
</code></pre></div>        </div>
        <p><img src="/assets/2024/t101-4th/20240803_terraform_w8_opentofu_2.png" alt="img.png" /></p>
      </li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤ ì‚­ì œ
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu destroy <span class="nt">-auto-approve</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="opentofu-18">OpenTofu 1.8</h3>

<ul>
  <li>OpenTofu 1.8ì´ ì§€ë‚œ 7ì›” 29ì¼ ì¶œì‹œ ë˜ì—ˆìŠµë‹ˆë‹¤. ìì„¸í•œ ì†Œì‹ì€ ì•„ë˜ì˜ ë¸”ë¡œê·¸ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li><a href="https://opentofu.org/blog/opentofu-1-8-0/">OpenTofu 1.8 ë¦´ë¦¬ì¦ˆ ë¸”ë¡œê·¸</a></li>
      <li><a href="https://github.com/opentofu/opentofu/releases/tag/v1.8.0">OpenTofu 1.8 Github</a></li>
    </ul>
  </li>
  <li>ì£¼ìš” ë³€ê²½ì ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
    <ul>
      <li>variableê³¼ localsë¥¼ module ì†ŒìŠ¤ì™€ backend ì„¤ì •ì— ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">.tofu</code> í™•ì¥ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">.tf</code> íŒŒì¼ì— ì¶”ê°€ì ìœ¼ë¡œ OpenTofu ì „ìš© ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” <code class="language-plaintext highlighter-rouge">override_resource</code>, <code class="language-plaintext highlighter-rouge">override_data</code>, <code class="language-plaintext highlighter-rouge">override_module</code>,
<code class="language-plaintext highlighter-rouge">mock_resource</code>, <code class="language-plaintext highlighter-rouge">mock_data</code>, <code class="language-plaintext highlighter-rouge">mock_module</code> ë“±ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
      <li>Deprecation : <code class="language-plaintext highlighter-rouge">use_legacy_workflow</code> ê°€ S3 backend ì„¤ì •ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>1.8.0 ì‚¬ìš© ì„¤ì •
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tenv tofu list
<span class="c"># =&gt; * 1.7.3</span>
<span class="nv">$ </span>tenv tofu list-remote 
<span class="c"># =&gt; ...</span>
<span class="c">#    1.7.3 (installed)</span>
<span class="c">#    ...</span>
<span class="c">#    1.8.0 </span>
  
<span class="c"># ì„¤ì¹˜</span>
<span class="nv">$ </span>tenv tofu <span class="nb">install </span>1.8.0
<span class="nv">$ </span>tenv tofu list
<span class="nv">$ </span>tenv tofu use 1.8.0
<span class="nv">$ </span>tenv tofu detect
  
<span class="c"># ë²„ì „ í™•ì¸</span>
<span class="nv">$ </span>tofu <span class="nt">-h</span>
<span class="nv">$ </span>tofu version
<span class="c"># =&gt; OpenTofu v1.8.0</span>
<span class="c">#    on darwin_arm64</span>
<span class="c">#    + provider registry.opentofu.org/hashicorp/aws v5.61.0</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="ì‹¤ìŠµ-early-variablelocals-evaluation">[ì‹¤ìŠµ] Early variable/locals evaluation</h4>

<p><img src="/assets/2024/t101-4th/20240803_terraform_w8_opentofu_3.png" alt="img.png" />
ê¸°ì¡´ì—ëŠ” variableì„ Backend ì„¤ì •ì´ë‚˜ mobule ë¸”ë¡, ì•”í˜¸í™” ì„¤ì • ë“±ì—ì„œ ì‚¬ìš©í•˜ì§€ ëª»í•˜ì˜€ëŠ”ë° OpenTofu 1.8ë¶€í„°ëŠ” ì‚¬ìš©í•  
ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ìŠµì„ í†µí•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>AWS S3 ë²„í‚· ìƒì„± : Backend State ì €ì¥ìš©ë„
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws s3 mb s3://&lt;ìƒì„±í•  ê³ ìœ í•œ S3 ë²„í‚·ëª…&gt; <span class="nt">--region</span> ap-northeast-2 
<span class="nv">$ </span>aws s3 mb s3://t101-4th-tofu-1-8 <span class="nt">--region</span> ap-northeast-2
  
<span class="c"># ë²„í‚· í™•ì¸</span>
<span class="nv">$ </span>aws s3 <span class="nb">ls</span> 
</code></pre></div>    </div>
  </li>
  <li>main.tf ìƒì„±
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tofu</span>
<span class="k">variable</span> <span class="s2">"s3bucket_myname"</span> <span class="p">{</span>
 <span class="nx">type</span> <span class="p">=</span> <span class="nx">string</span>
 <span class="nx">default</span> <span class="p">=</span> <span class="s2">"t101-4th-tofu-1-8"</span> <span class="c1"># ìƒì„±í•œ S3 ë²„í‚·ëª…</span>
<span class="p">}</span>
  
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">bucket</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">s3bucket_myname</span>
    <span class="nx">key</span> <span class="p">=</span> <span class="s2">"terraform.tfstate"</span>
    <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
    <span class="nx">encrypt</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"ubuntu"</span> <span class="p">{</span>
    <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
  
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"</span><span class="p">]</span>
    <span class="p">}</span>
  
    <span class="nx">filter</span> <span class="p">{</span>
        <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"virtualization-type"</span>
        <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"hvm"</span><span class="p">]</span>
    <span class="p">}</span>
  
    <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"099720109477"</span><span class="p">]</span> <span class="c1"># Canonical</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"this"</span> <span class="p">{</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">ubuntu</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t3.micro"</span>
  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"final-labs"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>ì´ˆê¸°í™” ë° í”„ë¡œë°”ì´ë” í™•ì¸
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í…Œë¼í¼ìœ¼ë¡œ í™•ì¸</span>
<span class="nv">$ </span>terraform init
<span class="c"># =&gt; Initializing the backend...</span>
<span class="c">#    â”‚ Error: Variables not allowed</span>
<span class="c">#    â”‚   on main.tf line 8, in terraform:</span>
<span class="c">#    â”‚    8:     bucket = var.s3bucket_myname</span>
<span class="c">#    â”‚ Variables may not be used here.</span>
  
<span class="c"># OpenTofu 1.7.xë¡œ í™•ì¸</span>
<span class="nv">$ </span>tenv tofu use 1.7.3
<span class="nv">$ </span>tofu version
<span class="c"># =&gt; OpenTofu v1.7.3</span>
<span class="c">#    on darwin_arm64</span>
<span class="nv">$ </span>tofu init
<span class="c"># =&gt; Initializing the backend...</span>
<span class="c">#    â”‚ Error: Variables not allowed</span>
<span class="c">#    â”‚   on main.tf line 8, in terraform:</span>
<span class="c">#    â”‚    8:     bucket = var.s3bucket_myname</span>
<span class="c">#    â”‚ Variables may not be used here.</span>
  
<span class="c"># OpenTofu 1.8.0ë¡œ í™•ì¸</span>
<span class="nv">$ </span>tenv tofu use 1.8.0
<span class="nv">$ </span>
<span class="c"># =&gt; OpenTofu v1.8.0</span>
<span class="c">#    on darwin_arm64</span>
<span class="nv">$ </span>tofu init
<span class="c"># =&gt; Initializing the backend...    </span>
<span class="c">#    ...</span>
<span class="c">#    OpenTofu has been successfully initialized!</span>
</code></pre></div>    </div>
    <p>Terraformì´ë‚˜ OpenTofu 1.7.xì—ì„œëŠ” Backend ì„¤ì •ì— variableì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆì§€ë§Œ, OpenTofu 1.8.0ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.
ì´ì œ ì ìš©ì„ í•´ì„œ ì‹¤ì œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>ì‹¤í–‰
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tofu apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span>
  
<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://t101-4th-tofu-1-8
<span class="c"># =&gt; 2024-08-03 21:04:56       4890 terraform.tfstate</span>
<span class="nv">$ </span><span class="nb">cat</span> .terraform/terraform.tfstate | <span class="nb">grep </span>bucket
<span class="c"># =&gt; "bucket": "t101-4th-tofu-1-8",  </span>
</code></pre></div>    </div>
    <p>ì˜ ë™ì‘í•˜ì—¬ ìƒíƒœíŒŒì¼ì´ S3 Backendì— ì˜ ì €ì¥ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤ ì‚­ì œ
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¦¬ì†ŒìŠ¤ ì‚­ì œ</span>
<span class="nv">$ </span>tofu apply <span class="nt">-destroy</span> <span class="nt">-auto-approve</span>
  
<span class="c"># ìƒíƒœíŒŒì¼ì€ ì•„ì§ ì¡´ì¬ í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://t101-4th-tofu-1-8
  
<span class="c"># ìƒíƒœíŒŒì¼ì„ ì‚­ì œí•˜ê³ </span>
<span class="nv">$ </span>aws s3 <span class="nb">rm </span>s3://t101-4th-tofu-1-8 <span class="nt">--recursive</span>
<span class="c"># ë²„í‚·ì„ ì‚­ì œí•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>aws s3 rb s3://t101-4th-tofu-1-8
  
<span class="c"># ë²„í‚·ì´ ì‚­ì œë˜ì—ˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>aws s3 <span class="nb">ls</span> 
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì´ë ‡ê²Œ OpenTofuì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
Terraformì´ ê³„ì† ì˜¤í”ˆì†ŒìŠ¤ ì»¤ë®¤ë‹ˆí‹°ì˜ ì‚¬ë‘ì„ ë°›ì•˜ì—ˆë‹¤ë©´ ì¢‹ì•˜ê² ì§€ë§Œ,
ê·¸ëŸ¬ì§€ ëª»í•˜ì—¬ OpenTofuê°€ ë‚˜ì˜¨ê²ƒì„ ë³´ë©´ ë‹¤ì†Œ ì”ì“¸í•©ë‹ˆë‹¤.
ì•„ë¬´ìª¼ë¡ ê²½ìŸì„ í†µí•´ ë‘˜ ë‹¤ ë°œì „í•˜ëŠ” ëª¨ìŠµì„ ë³´ì—¬ì£¼ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.</p>

<p>ì´ë²ˆ í…Œë¼í¼ ê¸°ì´ˆ ì…ë¬¸ ì‹¤ìŠµ ìŠ¤í„°ë”” 4ê¸° ê³¼ì •ì„ í†µí•´ IaCê°€ ë¬´ì—‡ì¸ì§€ì™€
Terraform ì‚¬ìš© ë°©ë²• ë“± ë§ì€ê²ƒì„ ë°°ìš¸ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ê°€ì¥ í° ê²°ì‹¤ì€ ë¸”ë¡œê·¸ë¥¼ ë§Œë“¤ì—ˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤!
íšŒì‚¬ íŒ€ì¥ë‹˜ì˜ ì¶”ì²œì— ì–¼ë–¨ê²°ì— ì‹œì‘í•˜ì˜€ê³ ,
ë§¤ì£¼ ë¸”ë¡œê·¸ ê¸€ ì“°ê¸°ê°€ ë²…ì°¨ì„œ ëª‡ ë²ˆì´ê³  í¬ê¸° í• ë»” í–ˆì§€ë§Œ 
ë¬´ì‚¬íˆ ë§ˆì¹  ìˆ˜ ìˆì–´ì„œ ê°ê°œë¬´ëŸ‰í•©ë‹ˆë‹¤. (ì´ë²ˆì£¼ë„ ë¬´ì‚¬íˆ ì§€ë‚˜ê°€ì•¼ í•˜ê¸´ í•©ë‹ˆë‹¤. :sweat_smile:)
ì•ìœ¼ë¡œë„ ê¾¸ì¤€íˆ ë°°ìš°ê³  ëˆ„êµ°ê°€ì—ê²Œ ë„ì›€ì´ ë  ìˆ˜ ìˆë„ë¡ 
ë¸”ë¡œê·¸ì— ê¸°ë¡í•˜ë©° ì„±ì¥í•´ ë‚˜ê°€ê² ìŠµë‹ˆë‹¤.</p>

<p>í•¨ê»˜ ê³ ìƒí•œ Gasidaë‹˜ì„ ë¹„ë¡¯í•œ T101 4ê¸° ë©¤ë²„ë¶„ë“¤ë„ ëª¨ë‘ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤.
íŠ¹íˆ ë§¤ì£¼ ì‹¤ìŠµì„ ì¤€ë¹„í•˜ê³ , ê°•ì˜ë¥¼ ì§„í–‰í•´ì£¼ì‹  Gasidaë‹˜ê³¼ ì¡°ë ¥ì ë¶„ë“¤ê»˜ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.
ë‹¤ìŒ ìŠ¤í„°ë””ë„ ì°¸ì—¬í•  ìˆ˜ ìˆë‹¤ë©´ ë˜ ì—´ì‹¬íˆ ë‹¬ë ¤ë³´ê² ìŠµë‹ˆë‹¤.
ë‹¤ë“¤ ê±´ê°•í•˜ì‹œê³  í–‰ë³µí•œ ëª¨ìŠµìœ¼ë¡œ ë‹¤ì‹œ ëµ™ê¸°ë¥¼ ê³ ëŒ€í•©ë‹ˆë‹¤! :smile:</p>]]></content><author><name></name></author><category term="terraform" /><category term="terraform," /><category term="cloud," /><category term="aws" /><summary type="html"><![CDATA[ì´ë²ˆ ì£¼ê°€ 8ì£¼ì°¨ì´ì ë²Œì¨ ë§ˆì§€ë§‰ì£¼ì°¨ì…ë‹ˆë‹¤. T101 4ê¸°ì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì•Œì•„ë³¼ ì£¼ì œëŠ” OpenTofuë¡œ Terraformì˜ ì˜¤í”ˆì†ŒìŠ¤ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ í¬í¬í•œ ë²„ì „ìœ¼ë¡œ ì•ìœ¼ë¡œê°€ ê¸°ëŒ€ë˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[T101 4ê¸°] í…Œë¼í¼ìœ¼ë¡œ AWS EKS ë°°í¬</title><link href="https://sweetlittlebird.github.io/posts/2024-07-27-T101-Study-Terraform-Week-7/" rel="alternate" type="text/html" title="[T101 4ê¸°] í…Œë¼í¼ìœ¼ë¡œ AWS EKS ë°°í¬" /><published>2024-07-27T16:02:00+09:00</published><updated>2024-07-27T16:02:00+09:00</updated><id>https://sweetlittlebird.github.io/posts/T101%20Study%20-%20Terraform%20Week%207</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-07-27-T101-Study-Terraform-Week-7/"><![CDATA[<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì´ë²ˆ ì£¼ì—ëŠ” í…Œë¼í¼ìœ¼ë¡œ AWS EKS ë°°í¬ë¥¼ í•˜ëŠ”ê²ƒì„
<a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a>ë¥¼ í†µí•´ ì•Œì•„ ë³´ê² ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" /></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a></p>
</blockquote>

<h2 id="amazon-eks-blueprints-for-terraform">Amazon EKS Blueprints for Terraform</h2>

<h3 id="ê°œìš”">ê°œìš”</h3>

<ul>
  <li><a href="https://aws-ia.github.io/terraform-aws-eks-blueprints/">Amazon EKS BluePrints ì†Œê°œ Link</a> / <a href="https://aws-ia.github.io/terraform-aws-eks-blueprints/faq/">FAQ Link</a></li>
  <li>Amazon EKS Blueprints for Terraformì€ Terraformìœ¼ë¡œ Amazon EKS í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ëŠ” íŒ¨í„´ë“¤ì˜ ëª¨ìŒì´ë©°, Amazon EKSë¥¼ ë„ì…í•˜ëŠ”ê²ƒì´ ì–¼ë§ˆë‚˜ ë¹ ë¥´ê³  ì‰¬ìš´ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.</li>
  <li>ì‚¬ìš© ë°©ë²•ì€ Amazon EKS Blueprintsë¥¼ <strong>ì°¸ê³ í•´ì„œ</strong> ì›í•˜ëŠ” íŒ¨í„´ì„ ì„ íƒí•˜ê³  Terraformì„ ì‚¬ìš©í•´ì„œ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ê³¼, í•„ìš”í•œ ìŠ¤ë‹ˆí«ë“¤ì„ <strong>ë³µì‚¬í•´ì„œ</strong> ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì£¼ì˜í•  ì 
    <ul>
      <li>Amazon EKS BlueprintsëŠ” <strong>AWS CloudFormation</strong>ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ <strong>Terraform</strong>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
      <li>ìˆëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©ë˜ëŠ”ê²ƒì„ ê¶Œì¥í•˜ì§€ ì•Šìœ¼ë©°, <strong>ì‚¬ìš©ìì˜ í™˜ê²½ì— ë§ê²Œ ìˆ˜ì •</strong>í•´ì„œ ì‚¬ìš©í•˜ëŠ”ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.</li>
      <li>íŒ¨í„´ê³¼ ìŠ¤ë‹ˆí«ì€ Terraform ëª¨ë“ˆë¡œ ì„¤ê³„ë˜ì§€ ì•Šì•˜ìœ¼ë©°, ëª¨ë“ˆí™”ë¥¼ í•˜ë ¤ë©´ëŠ” ì‚¬ìš©ìê°€ ì§ì ‘ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>Local ë¸”ë¡ì„ ì£¼ë¡œ ì‚¬ìš©í•˜ë©°, íŠ¹ì • ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° (Route 53 í˜¸ìŠ¤íŠ¸ ì˜ì—­ ID ë“±)ë§Œ Variable ë¸”ë¡ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
      <li>ë³µì¡ì„±ì„ ì¤„ì´ê¸°ìœ„í•´ variableê³¼ outputsê°€ ìµœëŒ€í•œ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h3 id="ì‹¤ìŠµ-eks-fargate-ë°-karpenter-ë°°í¬">[ì‹¤ìŠµ] EKS Fargate ë° Karpenter ë°°í¬</h3>

<p>ë¨¼ì € <code class="language-plaintext highlighter-rouge">EKS</code>ì™€ <code class="language-plaintext highlighter-rouge">Fargate</code>, <code class="language-plaintext highlighter-rouge">Karpenter</code>ì— ëŒ€í•´ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_1.png" alt="EKS ì†Œê°œ" />
<code class="language-plaintext highlighter-rouge">EKS</code>ëŠ” Elastic Kubernetes Serviceì˜ ì•½ìë¡œ, AWSì—ì„œ ì œê³µí•˜ëŠ” <strong>ê´€ë¦¬í˜• Kubernetes ì„œë¹„ìŠ¤</strong>ì…ë‹ˆë‹¤.
EKSë¥¼ ì‚¬ìš©í•˜ë©´ ì»¨í…Œì´ë„ˆ ì˜ˆì•½, ê°€ìš©ì„± ê´€ë¦¬, í´ëŸ¬ìŠ¤í„°ì˜ ë°ì´í„° ì €ì¥ ë° ë‹¤ë¥¸ ì£¼ìš” ì‘ì—…ì„ ë‹´ë‹¹í•˜ëŠ” Kubernetes ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì˜
ê°€ìš©ì„±ê³¼ í™•ì¥ì„±ì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. EKSëŠ” ì»¨í…Œì´ë„ˆë¥¼ EC2 ìƒì—ì„œ ìš´ì˜í•˜ê±°ë‚˜ Fargateë¥¼ í†µí•´ 
íƒ„ë ¥ì ìœ¼ë¡œ ì„œë²„ë¦¬ìŠ¤ ë°©ì‹ìœ¼ë¡œ ìš´ì˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
<a href="https://aws.amazon.com/ko/eks/">AWS EKS ì†Œê°œ</a></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_2.png" alt="Fargateì™€ ê¸°ì¡´ EC2 ë°©ì‹ì˜ ì»¨í…Œì´ë„ˆ ë°°í¬ì™€ ë¹„êµ" />
<code class="language-plaintext highlighter-rouge">Fargate</code>ëŠ” AWSì—ì„œ ì œê³µí•˜ëŠ” <strong>ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… ì—”ì§„</strong>ìœ¼ë¡œ, ì»¨í…Œì´ë„ˆë¥¼ ë³„ë„ì˜ <strong>ì„œë²„ ê´€ë¦¬ ì—†ì´, ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•œ ë§Œí¼ë§Œ</strong> ë¹„ìš©ì„ ì§€ë¶ˆí•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. <a href="https://aws.amazon.com/ko/fargate/">AWS Fargate ì†Œê°œ</a></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_36.png" alt="Karpenterì˜ ë™ì‘ ë°©ì‹ ì†Œê°œ" />
<code class="language-plaintext highlighter-rouge">Karpenter</code>ëŠ” Kubernetes í´ëŸ¬ìŠ¤í„°ì— ë™ì‘í•˜ëŠ” Nodeë¥¼ ìµœì í™”í•˜ì—¬ íš¨ìœ¨ì„±ê³¼ ë¹„ìš©ì„ ìµœì í™”í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.
KarpenterëŠ” Nodeì˜ ë¦¬ì†ŒìŠ¤ ë¶€ì¡±ìœ¼ë¡œ ìŠ¤ì¼€ì¥´ ë˜ì§€ ëª»í•œ podë“¤ì„ Nodeë¥¼ ì¶”ê°€í•˜ì—¬ ìŠ¤ì¼€ì¥´ë§í•˜ëŠ” Autoscaling ê¸°ëŠ¥ ë¿ë§Œ ì•„ë‹ˆë¼,
ê°ê° Nodeë“¤ì„ ì¡°ê°ëª¨ìŒ í•˜ë“¯ì´ ë” í¬ê³  ì €ë ´í•œ í•˜ë‚˜ì˜ ë…¸ë“œë¡œ êµì²´í•˜ëŠ” ë“±ì˜ ì „ëµì„ í†µí•´ ë¹„ìš©ì„ ìµœì í™”í•©ë‹ˆë‹¤.
<a href="https://aws.amazon.com/ko/blogs/containers/introducing-karpenter/">Karpenter ì†Œê°œ</a></p>

<ul>
  <li>ì´ë²ˆì— ì‹¤ìŠµí•  íŒ¨í„´ì€ <code class="language-plaintext highlighter-rouge">Karpenter</code>ë¥¼ í†µí•˜ì—¬ Fargateì— ì„œë²„ë¦¬ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ëŠ” ê²ƒìœ¼ë¡œ ë¨¼ì € EKSì™€ Fargateë¥¼ ë°°í¬í•˜ê³ , ê·¸ ë‹¤ìŒì— Karpenterë¥¼ ë°°í¬í•˜ëŠ” ê²ƒì„ ì‹¤ìŠµí•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<h4 id="ì‚¬ì „ì¤€ë¹„">ì‚¬ì „ì¤€ë¹„</h4>
<ul>
  <li>awscli, terraform, kubectl, helm ë“± ì„¤ì¹˜
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì„¤ì¹˜ëœ íŒŒì¼ ë²„ì „ í™•ì¸</span>
<span class="nv">$ </span>aws <span class="nt">--version</span>
<span class="c"># =&gt; aws-cli/2.17.14 Python/3.11.9 Darwin/22.6.0 source/arm64</span>
<span class="nv">$ </span>terraform <span class="nt">--version</span>
<span class="c"># =&gt; Terraform v1.8.5</span>
<span class="nv">$ </span>kubectl version <span class="nt">--client</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># =&gt; Client Version: version.Info{Major:"1", Minor:"22", GitVersion:"v1.22.5", GitCommit:"5c99e2ac2ff9a3c549d9ca665e7bc05a3e18f07e", GitTreeState:"clean", BuildDate:"2021-12-16T08:38:33Z", GoVersion:"go1.16.12", Compiler:"gc", Platform:"darwin/arm64"}</span>
<span class="nv">$ </span>helm version 
<span class="c"># =&gt; version.BuildInfo{Version:"v3.15.3", GitCommit:"3bb50bbbdd9c946ba9989fbe4fb4104766302a64", GitTreeState:"clean", GoVersion:"go1.22.5"}</span>
</code></pre></div>    </div>
  </li>
  <li>ì½”ë“œ ì¤€ë¹„ - <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints">Github</a>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/aws-ia/terraform-aws-eks-blueprints
<span class="nv">$ </span><span class="nb">cd </span>terraform-aws-eks-blueprints/patterns/karpenter
<span class="nv">$ </span>tree 
</code></pre></div>    </div>
    <ul>
      <li>versions.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_version</span> <span class="p">=</span> <span class="s2">"&gt;= 1.3"</span>
    
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"&gt;= 5.34"</span>
    <span class="p">}</span>
    <span class="nx">helm</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/helm"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"&gt;= 2.9"</span>
    <span class="p">}</span>
    <span class="nx">kubernetes</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/kubernetes"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"&gt;= 2.20"</span>
    <span class="p">}</span>
  <span class="p">}</span>
    
  <span class="c1"># ##  Used for end-to-end testing on project; update to suit your needs</span>
  <span class="c1"># backend "s3" {</span>
  <span class="c1">#   bucket = "terraform-ssp-github-actions-state"</span>
  <span class="c1">#   region = "us-west-2"</span>
  <span class="c1">#   key    = "e2e/karpenter/terraform.tfstate"</span>
  <span class="c1"># }</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>main.tf</p>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">region</span>
<span class="p">}</span>
    
<span class="c1"># Required for public ECR where Karpenter artifacts are hosted</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"us-east-1"</span>
  <span class="nx">alias</span>  <span class="p">=</span> <span class="s2">"virginia"</span>
<span class="p">}</span>
    
<span class="k">provider</span> <span class="s2">"kubernetes"</span> <span class="p">{</span>
  <span class="nx">host</span>                   <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_endpoint</span>
  <span class="nx">cluster_ca_certificate</span> <span class="p">=</span> <span class="nx">base64decode</span><span class="p">(</span><span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_certificate_authority_data</span><span class="p">)</span>
    
  <span class="nx">exec</span> <span class="p">{</span>
    <span class="nx">api_version</span> <span class="p">=</span> <span class="s2">"client.authentication.k8s.io/v1beta1"</span>
    <span class="nx">command</span>     <span class="p">=</span> <span class="s2">"aws"</span>
    <span class="c1"># This requires the awscli to be installed locally where Terraform is executed</span>
    <span class="nx">args</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"eks"</span><span class="p">,</span> <span class="s2">"get-token"</span><span class="p">,</span> <span class="s2">"--cluster-name"</span><span class="p">,</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_name</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">provider</span> <span class="s2">"helm"</span> <span class="p">{</span>
  <span class="nx">kubernetes</span> <span class="p">{</span>
    <span class="nx">host</span>                   <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_endpoint</span>
    <span class="nx">cluster_ca_certificate</span> <span class="p">=</span> <span class="nx">base64decode</span><span class="p">(</span><span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_certificate_authority_data</span><span class="p">)</span>
    
    <span class="nx">exec</span> <span class="p">{</span>
      <span class="nx">api_version</span> <span class="p">=</span> <span class="s2">"client.authentication.k8s.io/v1beta1"</span>
      <span class="nx">command</span>     <span class="p">=</span> <span class="s2">"aws"</span>
      <span class="c1"># This requires the awscli to be installed locally where Terraform is executed</span>
      <span class="nx">args</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"eks"</span><span class="p">,</span> <span class="s2">"get-token"</span><span class="p">,</span> <span class="s2">"--cluster-name"</span><span class="p">,</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_name</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">data</span> <span class="s2">"aws_ecrpublic_authorization_token"</span> <span class="s2">"token"</span> <span class="p">{</span>
  <span class="k">provider</span> <span class="p">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">virginia</span>
<span class="p">}</span>
    
<span class="k">data</span> <span class="s2">"aws_availability_zones"</span> <span class="s2">"available"</span> <span class="p">{}</span>
    
<span class="nx">locals</span> <span class="p">{</span>
  <span class="c1"># name   = "ex-${basename(path.cwd)}"</span>
  <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"t101-</span><span class="k">${</span><span class="nx">basename</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">cwd</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span>
  <span class="c1"># region = "us-west-2"</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
    
  <span class="nx">vpc_cidr</span> <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
  <span class="nx">azs</span>      <span class="p">=</span> <span class="nx">slice</span><span class="p">(</span><span class="k">data</span><span class="p">.</span><span class="nx">aws_availability_zones</span><span class="p">.</span><span class="nx">available</span><span class="p">.</span><span class="nx">names</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Blueprint</span>  <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">name</span>
    <span class="nx">GithubRepo</span> <span class="p">=</span> <span class="s2">"github.com/aws-ia/terraform-aws-eks-blueprints"</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="c1">################################################################################</span>
<span class="c1"># Cluster</span>
<span class="c1">################################################################################</span>
    
<span class="k">module</span> <span class="s2">"eks"</span> <span class="p">{</span>
  <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"terraform-aws-modules/eks/aws"</span>
  <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 20.11"</span>
    
  <span class="nx">cluster_name</span>                   <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">cluster_version</span>                <span class="p">=</span> <span class="s2">"1.30"</span>
  <span class="nx">cluster_endpoint_public_access</span> <span class="p">=</span> <span class="kc">true</span>
    
  <span class="nx">vpc_id</span>     <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">vpc_id</span>
  <span class="nx">subnet_ids</span> <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">private_subnets</span>
    
  <span class="c1"># Fargate profiles use the cluster primary security group so these are not utilized</span>
  <span class="nx">create_cluster_security_group</span> <span class="p">=</span> <span class="kc">false</span>
  <span class="nx">create_node_security_group</span>    <span class="p">=</span> <span class="kc">false</span>
    
  <span class="nx">enable_cluster_creator_admin_permissions</span> <span class="p">=</span> <span class="kc">true</span>
    
  <span class="nx">fargate_profiles</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">karpenter</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">selectors</span> <span class="p">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">namespace</span> <span class="p">=</span> <span class="s2">"karpenter"</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
    <span class="nx">kube_system</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="s2">"kube-system"</span>
      <span class="nx">selectors</span> <span class="p">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">namespace</span> <span class="p">=</span> <span class="s2">"kube-system"</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="nx">merge</span><span class="p">(</span><span class="kd">local</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1"># NOTE - if creating multiple security groups with this module, only tag the</span>
    <span class="c1"># security group that Karpenter should utilize with the following tag</span>
    <span class="c1"># (i.e. - at most, only one security group should have this tag in your account)</span>
    <span class="s2">"karpenter.sh/discovery"</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">})</span>
<span class="p">}</span>
    
<span class="c1">################################################################################</span>
<span class="c1"># EKS Blueprints Addons</span>
<span class="c1">################################################################################</span>
    
<span class="k">module</span> <span class="s2">"eks_blueprints_addons"</span> <span class="p">{</span>
  <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"aws-ia/eks-blueprints-addons/aws"</span>
  <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 1.16"</span>
    
  <span class="nx">cluster_name</span>      <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_name</span>
  <span class="nx">cluster_endpoint</span>  <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_endpoint</span>
  <span class="nx">cluster_version</span>   <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_version</span>
  <span class="nx">oidc_provider_arn</span> <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">oidc_provider_arn</span>
    
  <span class="c1"># We want to wait for the Fargate profiles to be deployed first</span>
  <span class="nx">create_delay_dependencies</span> <span class="p">=</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">prof</span> <span class="nx">in</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">fargate_profiles</span> <span class="err">:</span> <span class="nx">prof</span><span class="p">.</span><span class="nx">fargate_profile_arn</span><span class="p">]</span>
    
  <span class="nx">eks_addons</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">coredns</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">configuration_values</span> <span class="p">=</span> <span class="nx">jsonencode</span><span class="p">({</span>
        <span class="nx">computeType</span> <span class="p">=</span> <span class="s2">"Fargate"</span>
        <span class="c1"># Ensure that the we fully utilize the minimum amount of resources that are supplied by</span>
        <span class="c1"># Fargate https://docs.aws.amazon.com/eks/latest/userguide/fargate-pod-configuration.html</span>
        <span class="c1"># Fargate adds 256 MB to each pod's memory reservation for the required Kubernetes</span>
        <span class="c1"># components (kubelet, kube-proxy, and containerd). Fargate rounds up to the following</span>
        <span class="c1"># compute configuration that most closely matches the sum of vCPU and memory requests in</span>
        <span class="c1"># order to ensure pods always have the resources that they need to run.</span>
        <span class="nx">resources</span> <span class="p">=</span> <span class="p">{</span>
          <span class="nx">limits</span> <span class="p">=</span> <span class="p">{</span>
            <span class="nx">cpu</span> <span class="p">=</span> <span class="s2">"0.25"</span>
            <span class="c1"># We are targeting the smallest Task size of 512Mb, so we subtract 256Mb from the</span>
            <span class="c1"># request/limit to ensure we can fit within that task</span>
            <span class="nx">memory</span> <span class="p">=</span> <span class="s2">"256M"</span>
          <span class="p">}</span>
          <span class="nx">requests</span> <span class="p">=</span> <span class="p">{</span>
            <span class="nx">cpu</span> <span class="p">=</span> <span class="s2">"0.25"</span>
            <span class="c1"># We are targeting the smallest Task size of 512Mb, so we subtract 256Mb from the</span>
            <span class="c1"># request/limit to ensure we can fit within that task</span>
            <span class="nx">memory</span> <span class="p">=</span> <span class="s2">"256M"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">})</span>
    <span class="p">}</span>
    <span class="nx">vpc-cni</span>    <span class="p">=</span> <span class="p">{}</span>
    <span class="nx">kube-proxy</span> <span class="p">=</span> <span class="p">{}</span>
  <span class="p">}</span>
    
  <span class="nx">enable_karpenter</span> <span class="p">=</span> <span class="kc">true</span>
    
  <span class="nx">karpenter</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">repository_username</span> <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ecrpublic_authorization_token</span><span class="p">.</span><span class="nx">token</span><span class="p">.</span><span class="nx">user_name</span>
    <span class="nx">repository_password</span> <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ecrpublic_authorization_token</span><span class="p">.</span><span class="nx">token</span><span class="p">.</span><span class="nx">password</span>
  <span class="p">}</span>
    
  <span class="nx">karpenter_node</span> <span class="p">=</span> <span class="p">{</span>
    <span class="c1"># Use static name so that it matches what is defined in `karpenter.yaml` example manifest</span>
    <span class="nx">iam_role_use_name_prefix</span> <span class="p">=</span> <span class="kc">false</span>
  <span class="p">}</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">tags</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_eks_access_entry"</span> <span class="s2">"karpenter_node_access_entry"</span> <span class="p">{</span>
  <span class="nx">cluster_name</span>      <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_name</span>
  <span class="nx">principal_arn</span>     <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">eks_blueprints_addons</span><span class="p">.</span><span class="nx">karpenter</span><span class="p">.</span><span class="nx">node_iam_role_arn</span>
  <span class="nx">kubernetes_groups</span> <span class="p">=</span> <span class="p">[]</span>
  <span class="nx">type</span>              <span class="p">=</span> <span class="s2">"EC2_LINUX"</span>
<span class="p">}</span>
    
<span class="c1">################################################################################</span>
<span class="c1"># Supporting Resources</span>
<span class="c1">################################################################################</span>
    
<span class="k">module</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"terraform-aws-modules/vpc/aws"</span>
  <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 5.0"</span>
    
  <span class="nx">name</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">cidr</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">vpc_cidr</span>
    
  <span class="nx">azs</span>             <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">azs</span>
  <span class="nx">private_subnets</span> <span class="p">=</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">local</span><span class="p">.</span><span class="nx">azs</span> <span class="err">:</span> <span class="nx">cidrsubnet</span><span class="p">(</span><span class="kd">local</span><span class="p">.</span><span class="nx">vpc_cidr</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">k</span><span class="p">)]</span>
  <span class="nx">public_subnets</span>  <span class="p">=</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">local</span><span class="p">.</span><span class="nx">azs</span> <span class="err">:</span> <span class="nx">cidrsubnet</span><span class="p">(</span><span class="kd">local</span><span class="p">.</span><span class="nx">vpc_cidr</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="nx">k</span> <span class="err">+</span> <span class="mi">48</span><span class="p">)]</span>
    
  <span class="nx">enable_nat_gateway</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">single_nat_gateway</span> <span class="p">=</span> <span class="kc">true</span>
    
  <span class="nx">public_subnet_tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"kubernetes.io/role/elb"</span> <span class="p">=</span> <span class="mi">1</span>
  <span class="p">}</span>
    
  <span class="nx">private_subnet_tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"kubernetes.io/role/internal-elb"</span> <span class="p">=</span> <span class="mi">1</span>
    <span class="c1"># Tags subnets for Karpenter auto-discovery</span>
    <span class="s2">"karpenter.sh/discovery"</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">}</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">tags</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>output.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">output</span> <span class="s2">"configure_kubectl"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Configure kubectl: make sure you're logged in with the correct AWS profile and run the following command to update your kubeconfig"</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="s2">"aws eks --region </span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">region</span><span class="k">}</span><span class="s2"> update-kubeconfig --name </span><span class="k">${module</span><span class="p">.</span><span class="nx">eks</span><span class="p">.</span><span class="nx">cluster_name</span><span class="k">}</span><span class="s2">"</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>init
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="nv">$ </span>tree .terraform 
<span class="nv">$ </span><span class="nb">cat</span> .terraform/modules/modules.json | jq
<span class="nv">$ </span>tree .terraform/providers/registry.terraform.io/hashicorp <span class="nt">-L</span> 2
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="vpc-ë°°í¬">VPC ë°°í¬</h4>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># VPC ë°°í¬ì „ VPC í™•ì¸</span>
  <span class="nv">$ </span>aws ec2 describe-vpcs <span class="nt">--filter</span> <span class="s1">'Name=isDefault,Values=false'</span> <span class="nt">--output</span> yaml
  <span class="c"># =&gt; Vpcs: []</span>
  
  <span class="c"># vpc ë°°í¬</span>
  <span class="nv">$ </span>terraform apply <span class="nt">-target</span><span class="o">=</span><span class="s2">"module.vpc"</span> <span class="nt">-auto-approve</span>
  
  <span class="c"># ë°°í¬ í™•ì¸</span>
  <span class="nv">$ </span>terraform state list
  <span class="nv">$ </span>terraform show
  
  <span class="c"># VPC ì •ë³´ í™•ì¸</span>
  <span class="nv">$ </span>aws ec2 describe-vpcs <span class="nt">--filter</span> <span class="s1">'Name=isDefault,Values=false'</span> <span class="nt">--output</span> yaml
  <span class="c"># =&gt; Vpcs:</span>
  <span class="c">#    - CidrBlock: 10.10.0.0/16</span>
  <span class="c">#      CidrBlockAssociationSet:</span>
  <span class="c">#      - AssociationId: vpc-cidr</span>
  <span class="c">#    ...</span>
  
  <span class="c"># ìƒì„¸ì •ë³´ í™•ì¸</span>
  <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.aws_availability_zones.available"</span> | terraform console
  <span class="c"># =&gt; {</span>
  <span class="c">#      "all_availability_zones" = tobool(null)</span>
  <span class="c">#      "exclude_names" = toset(null) /* of string */</span>
  <span class="c">#      "exclude_zone_ids" = toset(null) /* of string */</span>
  <span class="c">#      "filter" = toset(null) /* of object */</span>
  <span class="c">#      "group_names" = toset([</span>
  <span class="c">#        "ap-northeast-2",</span>
  <span class="c">#      ])</span>
  <span class="c">#      "id" = "ap-northeast-2"</span>
  <span class="c">#      "names" = tolist([</span>
  <span class="c">#        "ap-northeast-2a",</span>
  <span class="c">#        "ap-northeast-2b",</span>
  <span class="c">#        "ap-northeast-2c",</span>
  <span class="c">#        "ap-northeast-2d",</span>
  <span class="c">#      ])</span>
  <span class="c">#      "state" = tostring(null)</span>
  <span class="c">#      "timeouts" = null /* object */</span>
  <span class="c">#      "zone_ids" = tolist([</span>
  <span class="c">#        "apne2-az1",</span>
  <span class="c">#        "apne2-az2",</span>
  <span class="c">#        "apne2-az3",</span>
  <span class="c">#        "apne2-az4",</span>
  <span class="c">#      ])</span>
  <span class="c">#    }</span>
  
  <span class="nv">$ </span>terraform state show <span class="s1">'module.vpc.aws_vpc.this[0]'</span>
  <span class="nv">$ VPCID</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s1">'module.vpc.vpc_id'</span> | terraform console<span class="si">)</span>
  <span class="nv">$ </span>aws ec2 describe-subnets <span class="nt">--filters</span> <span class="s2">"Name=vpc-id,Values=</span><span class="nv">$VPCID</span><span class="s2">"</span> | jq
  <span class="nv">$ </span>aws ec2 describe-subnets <span class="nt">--filters</span> <span class="s2">"Name=vpc-id,Values=</span><span class="nv">$VPCID</span><span class="s2">"</span> <span class="nt">--output</span> text

  <span class="c"># public ì„œë¸Œë„·ê³¼ private ì„œë¸Œë„· CIDR í™•ì¸</span>
  <span class="c">## private_subnets = [for k, v in local.azs : cidrsubnet(local.vpc_cidr, 4, k)]</span>
  <span class="c">## public_subnets  = [for k, v in local.azs : cidrsubnet(local.vpc_cidr, 8, k + 48)]</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.vpc.aws_subnet.public[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.vpc.aws_subnet.private[0]'</span>
</code></pre></div></div>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_3.png" alt="VPC ë°°í¬ ê²°ê³¼" class="image-center" />
<em class="image-caption">VPC ë°°í¬ ê²°ê³¼</em></p>

<h4 id="eks-ë°-fargate-ë°°í¬">EKS ë° Fargate ë°°í¬</h4>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># EKS ë°°í¬</span>
  <span class="nv">$ </span>terraform apply <span class="nt">-target</span><span class="o">=</span><span class="s2">"module.eks"</span> <span class="nt">-auto-approve</span>
  <span class="c"># =&gt; Apply complete! Resources: 24 added, 0 changed, 0 destroyed.</span>
  <span class="c">#    Outputs:</span>
  <span class="c">#    configure_kubectl = "aws eks --region ap-northeast-2 update-kubeconfig --name t101-karpenter"</span>
  
  <span class="c"># ë°°í¬ í™•ì¸</span>
  <span class="nv">$ </span>terraform state list
  <span class="c"># =&gt; data.aws_availability_zones.available</span>
  <span class="c">#    module.eks.data.aws_caller_identity.current</span>
  <span class="c">#    module.eks.data.aws_iam_policy_document.assume_role_policy[0]</span>
  <span class="c">#    module.eks.data.aws_iam_session_context.current</span>
  <span class="c">#    module.eks.data.aws_partition.current</span>
  <span class="c">#    module.eks.data.tls_certificate.this[0]</span>
  <span class="c">#    module.eks.aws_cloudwatch_log_group.this[0]</span>
  <span class="c">#    module.eks.aws_ec2_tag.cluster_primary_security_group["Blueprint"]</span>
  <span class="c">#    module.eks.aws_ec2_tag.cluster_primary_security_group["GithubRepo"]</span>
  <span class="c">#    module.eks.aws_ec2_tag.cluster_primary_security_group["karpenter.sh/discovery"]</span>
  <span class="c">#    module.eks.aws_eks_access_entry.this["cluster_creator"]</span>
  <span class="c">#    module.eks.aws_eks_access_policy_association.this["cluster_creator_admin"]</span>
  <span class="c">#    module.eks.aws_eks_cluster.this[0]</span>
  <span class="c">#    module.eks.aws_iam_openid_connect_provider.oidc_provider[0]</span>
  <span class="c">#    module.eks.aws_iam_policy.cluster_encryption[0]</span>
  <span class="c">#    module.eks.aws_iam_role.this[0]</span>
  <span class="c">#    module.eks.aws_iam_role_policy_attachment.cluster_encryption[0]</span>
  <span class="c">#    module.eks.aws_iam_role_policy_attachment.this["AmazonEKSClusterPolicy"]</span>
  <span class="c">#    module.eks.aws_iam_role_policy_attachment.this["AmazonEKSVPCResourceController"]</span>
  <span class="c">#    module.eks.time_sleep.this[0]</span>
  <span class="c">#    module.vpc.aws_default_network_acl.this[0]</span>
  <span class="c">#    module.vpc.aws_default_route_table.default[0]</span>
  <span class="c">#    module.vpc.aws_default_security_group.this[0]</span>
  <span class="c">#    module.vpc.aws_eip.nat[0]</span>
  <span class="c">#    module.vpc.aws_internet_gateway.this[0]</span>
  <span class="c">#    module.vpc.aws_nat_gateway.this[0]</span>
  <span class="c">#    module.vpc.aws_route.private_nat_gateway[0]</span>
  <span class="c">#    module.vpc.aws_route.public_internet_gateway[0]</span>
  <span class="c">#    module.vpc.aws_route_table.private[0]</span>
  <span class="c">#    module.vpc.aws_route_table.public[0]</span>
  <span class="c">#    module.vpc.aws_route_table_association.private[0]</span>
  <span class="c">#    module.vpc.aws_route_table_association.private[1]</span>
  <span class="c">#    module.vpc.aws_route_table_association.private[2]</span>
  <span class="c">#    module.vpc.aws_route_table_association.public[0]</span>
  <span class="c">#    module.vpc.aws_route_table_association.public[1]</span>
  <span class="c">#    module.vpc.aws_route_table_association.public[2]</span>
  <span class="c">#    module.vpc.aws_subnet.private[0]</span>
  <span class="c">#    module.vpc.aws_subnet.private[1]</span>
  <span class="c">#    module.vpc.aws_subnet.private[2]</span>
  <span class="c">#    module.vpc.aws_subnet.public[0]</span>
  <span class="c">#    module.vpc.aws_subnet.public[1]</span>
  <span class="c">#    module.vpc.aws_subnet.public[2]</span>
  <span class="c">#    module.vpc.aws_vpc.this[0]</span>
  <span class="c">#    module.eks.module.fargate_profile["karpenter"].data.aws_caller_identity.current</span>
  <span class="c">#    module.eks.module.fargate_profile["karpenter"].data.aws_iam_policy_document.assume_role_policy[0]</span>
  <span class="c">#    module.eks.module.fargate_profile["karpenter"].data.aws_partition.current</span>
  <span class="c">#    module.eks.module.fargate_profile["karpenter"].data.aws_region.current</span>
  <span class="c">#    module.eks.module.fargate_profile["karpenter"].aws_eks_fargate_profile.this[0]</span>
  <span class="c">#    module.eks.module.fargate_profile["karpenter"].aws_iam_role.this[0]</span>
  <span class="c">#    module.eks.module.fargate_profile["karpenter"].aws_iam_role_policy_attachment.this["AmazonEKSFargatePodExecutionRolePolicy"]</span>
  <span class="c">#    module.eks.module.fargate_profile["karpenter"].aws_iam_role_policy_attachment.this["AmazonEKS_CNI_Policy"]</span>
  <span class="c">#    module.eks.module.fargate_profile["kube_system"].data.aws_caller_identity.current</span>
  <span class="c">#    module.eks.module.fargate_profile["kube_system"].data.aws_iam_policy_document.assume_role_policy[0]</span>
  <span class="c">#    module.eks.module.fargate_profile["kube_system"].data.aws_partition.current</span>
  <span class="c">#    module.eks.module.fargate_profile["kube_system"].data.aws_region.current</span>
  <span class="c">#    module.eks.module.fargate_profile["kube_system"].aws_eks_fargate_profile.this[0]</span>
  <span class="c">#    module.eks.module.fargate_profile["kube_system"].aws_iam_role.this[0]</span>
  <span class="c">#    module.eks.module.fargate_profile["kube_system"].aws_iam_role_policy_attachment.this["AmazonEKSFargatePodExecutionRolePolicy"]</span>
  <span class="c">#    module.eks.module.fargate_profile["kube_system"].aws_iam_role_policy_attachment.this["AmazonEKS_CNI_Policy"]</span>
  <span class="c">#    module.eks.module.kms.data.aws_caller_identity.current[0]</span>
  <span class="c">#    module.eks.module.kms.data.aws_iam_policy_document.this[0]</span>
  <span class="c">#    module.eks.module.kms.data.aws_partition.current[0]</span>
  <span class="c">#    module.eks.module.kms.aws_kms_alias.this["cluster"]</span>
  <span class="c">#    module.eks.module.kms.aws_kms_key.this[0]</span>
  
  <span class="nv">$ </span>terraform output
  <span class="c"># =&gt; configure_kubectl = "aws eks --region ap-northeast-2 update-kubeconfig --name t101-karpenter"</span>
  
  <span class="c"># kubectl ì„¤ì •</span>
  <span class="nv">$ </span>aws eks <span class="nt">--region</span> ap-northeast-2 update-kubeconfig <span class="nt">--name</span> t101-karpenter
  <span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config
    
  <span class="c"># k8s ë…¸ë“œ, íŒŒë“œ ì •ë³´ í™•ì¸</span>
  <span class="nv">$ </span>kubectl cluster-info
  <span class="c"># =&gt; Kubernetes control plane is running at https://D858CEEA85279742B1B4738D555C8602.sk1.ap-northeast-2.eks.amazonaws.com</span>
  <span class="c">#    CoreDNS is running at https://D858CEEA85279742B1B4738D555C8602.sk1.ap-northeast-2.eks.amazonaws.com/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
  <span class="c">#    To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>
  <span class="nv">$ </span>kubectl get node
  <span class="c"># =&gt; No resources found</span>
  <span class="nv">$ </span>kubectl get pod <span class="nt">-A</span>
  <span class="c"># =&gt; NAMESPACE     NAME                      READY   STATUS    RESTARTS   AGE</span>
  <span class="c">#    kube-system   coredns-5b9dfbf96-24qbm   0/1     Pending   0          22m</span>
  <span class="c">#    kube-system   coredns-5b9dfbf96-8q225   0/1     Pending   0          22m</span>
  <span class="nv">$ </span>kubectl describe pod coredns-5b9dfbf96-24 <span class="nt">-n</span> kube-system
  <span class="c"># =&gt; ...</span>
  <span class="c">#    Type     Reason            Age                    From               Message</span>
  <span class="c">#    ----     ------            ----                   ----               -------</span>
  <span class="c">#    Warning  FailedScheduling  3m22s (x124 over 23m)  default-scheduler  no nodes available to schedule pods</span>
  
  <span class="c"># ìƒì„¸ ì •ë³´ í™•ì¸</span>
  <span class="nv">$ </span>terraform show
  <span class="nv">$ </span>terraform state list
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.data.aws_caller_identity.current'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.data.aws_iam_session_context.current'</span>
   
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_eks_cluster.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.data.tls_certificate.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_cloudwatch_log_group.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_eks_access_entry.this["cluster_creator"]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_iam_openid_connect_provider.oidc_provider[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.data.aws_partition.current'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_iam_policy.cluster_encryption[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_iam_role.this[0]'</span>
  
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.time_sleep.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.kms.aws_kms_key.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.fargate_profile["kube_system"].aws_eks_fargate_profile.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.fargate_profile["karpenter"].aws_eks_fargate_profile.this[0]'</span>
</code></pre></div></div>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_4.png" alt="EKS ë°°í¬ ê²°ê³¼" class="image-center" />
<em class="image-caption">EKS ë°°í¬ ê²°ê³¼</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_5.png" alt="EKS ë°°í¬ ê²°ê³¼ (Secret ì•”í˜¸í™” ê´€ë ¨ ì„¤ì •)" class="image-center" />
<em class="image-caption">EKS ë°°í¬ ê²°ê³¼ (Secret ì•”í˜¸í™” ê´€ë ¨) ì„¤ì •</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_6.png" alt="EKS ë°°í¬ ê²°ê³¼ (Secret ì•”í˜¸í™”ì— ì“°ì´ëŠ” KMS ì •ë³´)" class="image-center" />
<em class="image-caption">EKS ë°°í¬ ê²°ê³¼ (Secret ì•”í˜¸í™”ì— ì“°ì´ëŠ” KMS ì •ë³´)</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_8.png" alt="EKS ë°°í¬ ê²°ê³¼ (ë„¤íŠ¸ì›Œí‚¹ ì •ë³´)" class="image-center" />
<em class="image-caption">EKS ë°°í¬ ê²°ê³¼ (ë„¤íŠ¸ì›Œí‚¹ ì •ë³´)</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_9.png" alt="EKS ë°°í¬ ê²°ê³¼ (ì ‘ê·¼ IAM ì •ë³´)" class="image-center" />
<em class="image-caption">EKS ë°°í¬ ê²°ê³¼ (ì ‘ê·¼ IAM ì •ë³´)</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_10.png" alt="EKS ë°°í¬ ê²°ê³¼ (ë¡œê·¸ ì„¤ì •)" class="image-center" />
<em class="image-caption">EKS ë°°í¬ ê²°ê³¼ (ë¡œê·¸ ì„¤ì •)</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_11.png" alt="EKS ë°°í¬ ê²°ê³¼ (Cloud Watchë¥¼ í†µí•œ ë¡œê·¸ ê´€ë¦¬)" class="image-center" />
<em class="image-caption">EKS ë°°í¬ ê²°ê³¼ (Cloud Watchë¥¼ í†µí•œ ë¡œê·¸ ê´€ë¦¬)</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_7.png" alt="Fargate ë°°í¬ ê²°ê³¼" class="image-center" />
<em class="image-caption">Fargate ë°°í¬ ê²°ê³¼</em></p>

<h4 id="karpenter-ë°-ê¸°íƒ€-addon-ë°°í¬">Karpenter ë° ê¸°íƒ€ addon ë°°í¬</h4>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># ë°°í¬</span>
  <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
  
  <span class="c"># í™•ì¸</span>
  <span class="nv">$ </span>terraform state list
  <span class="c"># =&gt; data.aws_ecrpublic_authorization_token.token</span>
  <span class="c">#    aws_eks_access_entry.karpenter_node_access_entry</span>
  <span class="c">#    ...</span>
  <span class="c">#    module.eks_blueprints_addons.data.aws_caller_identity.current</span>
  <span class="c">#    module.eks_blueprints_addons.data.aws_eks_addon_version.this["coredns"]</span>
  <span class="c">#    module.eks_blueprints_addons.data.aws_eks_addon_version.this["kube-proxy"]</span>
  <span class="c">#    module.eks_blueprints_addons.data.aws_eks_addon_version.this["vpc-cni"]</span>
  <span class="c">#    module.eks_blueprints_addons.data.aws_iam_policy_document.karpenter[0]</span>
  <span class="c">#    module.eks_blueprints_addons.data.aws_iam_policy_document.karpenter_assume_role[0]</span>
  <span class="c">#    module.eks_blueprints_addons.data.aws_partition.current</span>
  <span class="c">#    module.eks_blueprints_addons.data.aws_region.current</span>
  <span class="c">#    module.eks_blueprints_addons.aws_cloudwatch_event_rule.karpenter["health_event"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_cloudwatch_event_rule.karpenter["instance_rebalance"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_cloudwatch_event_rule.karpenter["instance_state_change"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_cloudwatch_event_rule.karpenter["spot_interupt"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_cloudwatch_event_target.karpenter["health_event"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_cloudwatch_event_target.karpenter["instance_rebalance"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_cloudwatch_event_target.karpenter["instance_state_change"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_cloudwatch_event_target.karpenter["spot_interupt"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_eks_addon.this["coredns"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_eks_addon.this["kube-proxy"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_eks_addon.this["vpc-cni"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_iam_instance_profile.karpenter[0]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_iam_role.karpenter[0]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_iam_role_policy_attachment.karpenter["AmazonEC2ContainerRegistryReadOnly"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_iam_role_policy_attachment.karpenter["AmazonEKSWorkerNodePolicy"]</span>
  <span class="c">#    module.eks_blueprints_addons.aws_iam_role_policy_attachment.karpenter["AmazonEKS_CNI_Policy"]</span>
  <span class="c">#    module.eks_blueprints_addons.time_sleep.this</span>
  <span class="c">#    ...</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter.data.aws_caller_identity.current[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter.data.aws_iam_policy_document.assume[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter.data.aws_iam_policy_document.this[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter.data.aws_partition.current[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter.aws_iam_policy.this[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter.aws_iam_role.this[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter.aws_iam_role_policy_attachment.this[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter.helm_release.this[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter_sqs.data.aws_iam_policy_document.this[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter_sqs.aws_sqs_queue.this[0]</span>
  <span class="c">#    module.eks_blueprints_addons.module.karpenter_sqs.aws_sqs_queue_policy.this[0]</span>
  
  <span class="nv">$ </span>terraform show

  <span class="c"># k8s ë…¸ë“œ, íŒŒë“œ ì •ë³´ í™•ì¸</span>
  <span class="nv">$ </span>kubectl cluster-info
  <span class="c"># =&gt; Kubernetes control plane is running at https://D858CEEA85279742B1B4738D555C8602.sk1.ap-northeast-2.eks.amazonaws.com</span>
  <span class="c">#    CoreDNS is running at https://D858CEEA85279742B1B4738D555C8602.sk1.ap-northeast-2.eks.amazonaws.com/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
  <span class="c">#    </span>
  <span class="c">#    To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>
  
  <span class="nv">$ </span>kubectl get nodes <span class="nt">-L</span> node.kubernetes.io/instance-type <span class="nt">-L</span> topology.kubernetes.io/zone
  <span class="c"># =&gt; NAME                                                      STATUS   ROLES    AGE     VERSION               INSTANCE-TYPE   ZONE</span>
  <span class="c">#    fargate-ip-10-10-18-179.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   4m58s   v1.30.0-eks-404b9c6                   ap-northeast-2b</span>
  <span class="c">#    fargate-ip-10-10-26-139.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   4m58s   v1.30.0-eks-404b9c6                   ap-northeast-2b</span>
  <span class="c">#    fargate-ip-10-10-41-162.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   4m51s   v1.30.0-eks-404b9c6                   ap-northeast-2c</span>
  <span class="c">#    fargate-ip-10-10-44-218.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   4m57s   v1.30.0-eks-404b9c6                   ap-northeast-2c</span>
   
  <span class="c"># fargateë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê¸° ì „ì—ëŠ” ë…¸ë“œê°€ ì—†ì—ˆìœ¼ë‚˜, </span>
  <span class="c"># fargate í”„ë¡œë¹„ì €ë‹ í›„ ë…¸ë“œê°€ ìƒì„±ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
  
  <span class="nv">$ </span>kubectl get node <span class="nt">-owide</span>  
  <span class="c"># =&gt; NAME                                                      STATUS   ROLES    AGE     VERSION               INTERNAL-IP    EXTERNAL-IP   OS-IMAGE         KERNEL-VERSION                  CONTAINER-RUNTIME</span>
  <span class="c">#    fargate-ip-10-10-18-179.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   6m45s   v1.30.0-eks-404b9c6   10.10.18.179   &lt;none&gt;        Amazon Linux 2   5.10.220-209.867.amzn2.x86_64   containerd://1.7.11</span>
  <span class="c">#    fargate-ip-10-10-26-139.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   6m45s   v1.30.0-eks-404b9c6   10.10.26.139   &lt;none&gt;        Amazon Linux 2   5.10.220-209.867.amzn2.x86_64   containerd://1.7.11</span>
  <span class="c">#    fargate-ip-10-10-41-162.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   6m38s   v1.30.0-eks-404b9c6   10.10.41.162   &lt;none&gt;        Amazon Linux 2   5.10.220-209.867.amzn2.x86_64   containerd://1.7.11</span>
  <span class="c">#    fargate-ip-10-10-44-218.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   6m44s   v1.30.0-eks-404b9c6   10.10.44.218   &lt;none&gt;        Amazon Linux 2   5.10.220-209.867.amzn2.x86_64   containerd://1.7.11</span>
  
  <span class="nv">$ </span>kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>        
  <span class="c"># =&gt; NAMESPACE     NAME                         READY   STATUS    RESTARTS   AGE     IP             NODE                                                      NOMINATED NODE   READINESS GATES</span>
  <span class="c">#    karpenter     karpenter-7c5786cbc4-q5k7x   1/1     Running   0          8m42s   10.10.18.179   fargate-ip-10-10-18-179.ap-northeast-2.compute.internal   &lt;none&gt;           &lt;none&gt;</span>
  <span class="c">#    karpenter     karpenter-7c5786cbc4-vxlrq   1/1     Running   0          8m42s   10.10.26.139   fargate-ip-10-10-26-139.ap-northeast-2.compute.internal   &lt;none&gt;           &lt;none&gt;</span>
  <span class="c">#    kube-system   coredns-86dcddd859-2x2gf     1/1     Running   0          8m43s   10.10.41.162   fargate-ip-10-10-41-162.ap-northeast-2.compute.internal   &lt;none&gt;           &lt;none&gt;</span>
  <span class="c">#    kube-system   coredns-86dcddd859-xsdw5     1/1     Running   0          8m43s   10.10.44.218   fargate-ip-10-10-44-218.ap-northeast-2.compute.internal   &lt;none&gt;           &lt;none&gt;  </span>
  
  <span class="c"># nodeê°€ ì—†ì–´ì„œ podê°€ Pending ìƒíƒœì˜€ë˜ ê²ƒì´, </span>
  <span class="c"># fargateë¡œ í”„ë¡œë¹„ì €ë‹ë˜ë©´ì„œ fargate computing nodeê°€ ìƒê²¨ì„œ Running ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                            
  <span class="c"># helm chart í™•ì¸</span>
  <span class="nv">$ </span>helm list <span class="nt">-n</span> karpenter
  <span class="c"># =&gt; NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION</span>
  <span class="c">#    karpenter       karpenter       1               2024-07-25 23:54:59.19597 +0900 KST     deployed        karpenter-0.35.0        0.35.0</span>
  
  <span class="c"># ì‹œí¬ë¦¿ í™•ì¸ : kmsë¡œ ì•”í˜¸ ì²˜ë¦¬ë¨</span>
  <span class="nv">$ </span>kubectl get secret <span class="nt">-n</span> karpenter
  <span class="c"># =&gt; NAME                              TYPE                 DATA   AGE</span>
  <span class="c">#    sh.helm.release.v1.karpenter.v1   helm.sh/release.v1   1      12m</span>
  <span class="nv">$ </span>kubectl get secret <span class="nt">-n</span> karpenter sh.helm.release.v1.karpenter.v1 <span class="nt">-o</span> json | jq

  <span class="c"># ìƒì„¸ ì •ë³´ í™•ì¸</span>
  <span class="nv">$ </span>terraform state list
  <span class="nv">$ </span>terraform state show <span class="s1">'data.aws_ecrpublic_authorization_token.token'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'aws_eks_access_entry.karpenter_node_access_entry'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.data.aws_caller_identity.current'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.data.aws_eks_addon_version.this["coredns"]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.aws_cloudwatch_event_rule.karpenter["health_event"]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.aws_cloudwatch_event_target.karpenter["health_event"]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.aws_eks_addon.this["coredns"]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.aws_iam_role.karpenter[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.aws_iam_instance_profile.karpenter[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.module.karpenter.data.aws_iam_policy_document.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.module.karpenter.data.aws_iam_policy_document.assume[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.module.karpenter.aws_iam_policy.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.module.karpenter.helm_release.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.module.karpenter_sqs.aws_sqs_queue.this[0]'</span>
  <span class="nv">$ </span>terraform state show <span class="s1">'module.eks_blueprints_addons.module.karpenter_sqs.aws_sqs_queue_policy.this[0]'</span>
</code></pre></div></div>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_12.png" alt="Karpenter ë°°í¬ ê²°ê³¼" class="image-center" />
<em class="image-caption">Karpenter ë°°í¬ ê²°ê³¼</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_13.png" alt="Addon ì„¤ì¹˜ ê²°ê³¼" class="image-center" />
<em class="image-caption">Addon ì„¤ì¹˜ ê²°ê³¼</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_14.png" alt="Karpenter ë°°í¬ ê²°ê³¼ (ì ‘ê·¼ IAM ì •ë³´)" class="image-center" />
<em class="image-caption">Karpenter ë°°í¬ ê²°ê³¼ (ì ‘ê·¼ IAM ì •ë³´)</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_15.png" alt="EC2 ëª©ë¡ (ì•„ì§ì€ EC2 ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ìŒ)" class="image-center" />
<em class="image-caption">EC2 ëª©ë¡ (ì•„ì§ì€ EC2 ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ìŒ)</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_16.png" alt="Karpenterì˜ Autoscaling ê´€ë ¨ ë£°" class="image-center" />
<em class="image-caption">Karpenterì˜ Autoscaling ê´€ë ¨ ë£°</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_35.png" alt="Karpenterì˜ SQS Queue" />
<em class="image-caption">Karpenterì˜ SQS Queue</em></p>

<ul>
  <li>
    <p>eks-node-viewer ì„¤ì¹˜ ë° ì‚¬ìš©ë²•
<img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_17.png" alt="eks-node-viewer" class="image-center" />
<em class="image-caption">eks-node-viewer</em></p>

    <ul>
      <li>ë…¸ë“œ í• ë‹¹ ê°€ëŠ¥ ìš©ëŸ‰ê³¼ ìš”ì²­ request ë¦¬ì†ŒìŠ¤ í‘œì‹œí•´ì¤ë‹ˆë‹¤.</li>
      <li>ì‹¤ì œ íŒŒë“œì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ê³¼ëŠ” ì°¨ì´ê°€ ìˆìœ¼ë‹ˆ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì•¼ í• ê²ƒì…ë‹ˆë‹¤.</li>
      <li>ì„¤ì¹˜
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># MacOS ê¸°ì¤€ ì„¤ì¹˜</span>
<span class="nv">$ </span>brew tap aws/tap
<span class="nv">$ </span>brew <span class="nb">install </span>eks-node-viewer
</code></pre></div>        </div>
      </li>
      <li>ì‚¬ìš©
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [ì‹ ê·œ í„°ë¯¸ë„] Display both CPU and Memory Usage*</span>
eks-node-viewer <span class="nt">--resources</span> cpu,memory
    
<span class="c"># Standard usage</span>
eks-node-viewer
    
<span class="c"># Karpenter nodes only</span>
eks-node-viewer <span class="nt">--node-selector</span> karpenter.sh/nodepool
    
<span class="c"># Display extra labels, i.e. AZ</span>
eks-node-viewer <span class="nt">--extra-labels</span> topology.kubernetes.io/zone
    
<span class="c"># Sort by CPU usage in descending order</span>
eks-node-viewer <span class="nt">--node-sort</span><span class="o">=</span>eks-node-viewer/node-cpu-usage<span class="o">=</span>dsc
    
<span class="c"># Specify a particular AWS profile and region</span>
<span class="nv">AWS_PROFILE</span><span class="o">=</span>myprofile <span class="nv">AWS_REGION</span><span class="o">=</span>us-west-2
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>kube-ops-view ì„¤ì¹˜ ë° ì‚¬ìš©ë²•
<img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_20.png" alt="kube-ops-view" class="image-center" />
<em class="image-caption">kube-ops-view</em></p>

    <ul>
      <li>ë…¸ë“œì˜ íŒŒë“œ ìƒíƒœì •ë³´ë¥¼ ì›¹í˜ì´ì§€ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶œë ¥í•´ì¤ë‹ˆë‹¤.</li>
      <li>ì„¤ì¹˜ ë° ì‚¬ìš©
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
<span class="c"># =&gt; "geek-cookbook" has been added to your repositories</span>
    
<span class="nv">$ </span>helm <span class="nb">install </span>kube-ops-view geek-cookbook/kube-ops-view <span class="nt">--version</span> 1.2.2 <span class="nt">--set</span> env.TZ<span class="o">=</span><span class="s2">"Asia/Seoul"</span> <span class="nt">--namespace</span> kube-system

<span class="c"># í¬íŠ¸í¬ì›Œë”©</span>
<span class="nv">$ </span>kubectl port-forward deployment/kube-ops-view <span class="nt">-n</span> kube-system 8080:8080 &amp;

<span class="c"># ì ‘ì† ì£¼ì†Œ í™•ì¸ : ê°ê° 1ë°°, 1.5ë°°, 3ë°° í¬ê¸°</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:8080"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:8080/#scale=1.5"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:8080/#scale=3"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h3 id="ì‹¤ìŠµ-karpenter-on-eks-fargate">[ì‹¤ìŠµ] Karpenter on EKS Fargate</h3>

<p>ì´ë²ˆì—ëŠ” <code class="language-plaintext highlighter-rouge">Karpenter</code>ë¥¼ ì‚¬ìš©í•´ ì•ì„œ ì„¤ì¹˜í•œ EKSì™€ Fargateë¡œ êµ¬ì„±í•œ í´ëŸ¬ìŠ¤í„°ë¥¼ ê´€ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">Karpenter</code>ëŠ” AWSì—ì„œ ì œê³µí•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¡œ, Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” <strong>ì˜¤í† ìŠ¤ì¼€ì¼ë§ í”„ë¡œë¹„ì €ë‹ ì—”ì§„</strong>ì…ë‹ˆë‹¤. Node Auto Scalingê³¼ ë¹„ìŠ·í•˜ë‚˜
AWS APIë¥¼ í†µí•´ ë¹ ë¥´ê³  <strong>íš¨ìœ¨ì ìœ¼ë¡œ ì›Œì»¤ë…¸ë“œë¥¼ ìŠ¤ì¼€ì¼ë§</strong>í•˜ë©°, <strong>ë†’ì€ ê°€ìš©ì„±</strong>, <strong>ë¹„ìš©ìµœì í™”</strong>ë¥¼ ì œê³µí•©ë‹ˆë‹¤. <a href="https://karpenter.sh/">Karpenter ì†Œê°œ</a></p>

<p>ë¨¼ì € replicasê°€ 0ì¸ podë¥¼ ìƒì„±í•˜ê³ , replica ìˆ˜ë¥¼ ëŠ˜ë ¤ì„œ <code class="language-plaintext highlighter-rouge">Karpenter</code>ë¥¼ ì´ìš©í•˜ì—¬ autoscalingì„ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>karpenter.yml ìƒì„±
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># karpenter.yml</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">karpenter.k8s.aws/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">EC2NodeClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">amiFamily</span><span class="pi">:</span> <span class="s">AL2</span>
  <span class="na">role</span><span class="pi">:</span> <span class="s">karpenter-t101-karpenter</span>
  <span class="na">subnetSelectorTerms</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">tags</span><span class="pi">:</span>
        <span class="na">karpenter.sh/discovery</span><span class="pi">:</span> <span class="s">t101-karpenter</span>
  <span class="na">securityGroupSelectorTerms</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">tags</span><span class="pi">:</span>
        <span class="na">karpenter.sh/discovery</span><span class="pi">:</span> <span class="s">t101-karpenter</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="na">karpenter.sh/discovery</span><span class="pi">:</span> <span class="s">t101-karpenter</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">karpenter.sh/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodePool</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">nodeClassRef</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
      <span class="na">requirements</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">karpenter.k8s.aws/instance-category"</span>
          <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
          <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">c"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">m"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">r"</span><span class="pi">]</span>
        <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">karpenter.k8s.aws/instance-cpu"</span>
          <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
          <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">4"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">8"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">16"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">32"</span><span class="pi">]</span>
        <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">karpenter.k8s.aws/instance-hypervisor"</span>
          <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
          <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">nitro"</span><span class="pi">]</span>
        <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">karpenter.k8s.aws/instance-generation"</span>
          <span class="na">operator</span><span class="pi">:</span> <span class="s">Gt</span>
          <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">2"</span><span class="pi">]</span>
  <span class="na">limits</span><span class="pi">:</span>
    <span class="na">cpu</span><span class="pi">:</span> <span class="m">1000</span>
  <span class="na">disruption</span><span class="pi">:</span>
    <span class="na">consolidationPolicy</span><span class="pi">:</span> <span class="s">WhenEmpty</span>
    <span class="na">consolidateAfter</span><span class="pi">:</span> <span class="s">30s</span>   
</code></pre></div>    </div>
  </li>
  <li>example.yml ìƒì„±
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">inflate</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">inflate</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">inflate</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">0</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">inflate</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">public.ecr.aws/eks-distro/kubernetes/pause:3.7</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">1</span>     
</code></pre></div>    </div>
  </li>
  <li>karpenter ì‹¤í–‰
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> karpenter.yml                           
<span class="c"># =&gt; ec2nodeclass.karpenter.k8s.aws/default created</span>
<span class="c">#    nodepool.karpenter.sh/default created</span>
    
<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get ec2nodeclass,nodepool
<span class="c"># =&gt; NAME                                     AGE</span>
<span class="c">#    ec2nodeclass.karpenter.k8s.aws/default   98s</span>
<span class="c">#    </span>
<span class="c">#    NAME                            NODECLASS</span>
<span class="c">#    nodepool.karpenter.sh/default   default</span>
    
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> example.yml
    
<span class="nv">$ </span>kubectl get deploy
<span class="c"># =&gt; NAME      READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    inflate   0/0     0            0           11s</span>
    
<span class="nv">$ </span>karpenter ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œê·¸ í™•ì¸
<span class="nv">$ </span>kubectl logs <span class="nt">-f</span> <span class="nt">-n</span> karpenter <span class="nt">-l</span> app.kubernetes.io/name<span class="o">=</span>karpenter <span class="nt">-c</span> controller

<span class="c"># karpenterë¥¼ ì´ìš©í•œ autoscaling í™•ì¸</span>
<span class="nv">$ </span>kubectl scale deployment inflate <span class="nt">--replicas</span><span class="o">=</span>3 <span class="o">&amp;&amp;</span> kubectl get pod <span class="nt">-w</span>
<span class="c"># =&gt; deployment.apps/inflate scaled</span>
<span class="c">#    NAME                       READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    inflate-66fb68585c-8wnvs   0/1     Pending   0          0s</span>
<span class="c">#    inflate-66fb68585c-p5j7d   0/1     Pending   0          0s</span>
<span class="c">#    inflate-66fb68585c-sdqzz   0/1     Pending   0          0s</span>
</code></pre></div>    </div>

    <p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_25.png" alt="autoscaling ì´ ì§„í–‰ë˜ì§€ ì•Šê³  ëŒ€ê¸°ì¤‘ì¸ ëª¨ìŠµ" class="image-center" />
<em class="image-caption">autoscaling ì´ ì§„í–‰ë˜ì§€ ì•Šê³  ëŒ€ê¸°ì¤‘ì¸ ëª¨ìŠµ</em></p>

    <ul>
      <li>ìœ„ì˜ ê·¸ë¦¼ì²˜ëŸ¼ scaling í›„ pending ìƒíƒœë¡œ ì˜¤ë˜ ëŒ€ê¸°ì¤‘ì´ì–´ì„œ logë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># karpenter ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œê·¸ í™•ì¸</span>
<span class="nv">$ </span>kubectl logs <span class="nt">-f</span> <span class="nt">-n</span> karpenter <span class="nt">-l</span> app.kubernetes.io/name<span class="o">=</span>karpenter <span class="nt">-c</span> controller
<span class="c"># =&gt; {</span>
<span class="c">#      "level":"ERROR","time":"2024-07-25T15:36:58.791Z",</span>
<span class="c">#      ...</span>
<span class="c">#      "error":"launching nodeclaim, creating instance, with fleet error(s), </span>
<span class="c">#               AuthFailure.ServiceLinkedRoleCreationNotPermitted: </span>
<span class="c">#               The provided credentials do not have permission to </span>
<span class="c">#               create the service-linked role for EC2 Spot Instances."</span>
<span class="c">#    }</span>
</code></pre></div>        </div>
        <ul>
          <li>í˜„ì¬ ServiceLinkedRole ê´€ë ¨ ê¸°ëŠ¥ì´ ì—†ì–´ì„œ ìƒê¸°ëŠ” ë¬¸ì œ ì¸ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì•„ë˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ roleì´ ìƒì„±ë˜ë©´ì„œ ì˜¤í†  ìŠ¤ì¼€ì¼ë§ì´ ì§„í–‰ë©ë‹ˆë‹¤.
            <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws iam create-service-linked-role <span class="nt">--aws-service-name</span> spot.amazonaws.com
</code></pre></div>            </div>
          </li>
        </ul>

        <p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_26.png" alt="ì •ìƒì ìœ¼ë¡œ Autoscaling ëœ ê²°ê³¼" class="image-center" />
<em class="image-caption image-caption--img-shadow">ì •ìƒì ìœ¼ë¡œ Autoscaling ëœ ê²°ê³¼</em></p>

        <p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_30.png" alt="ì •ìƒì ìœ¼ë¡œ Autoscaling ëœ ê²°ê³¼ (Pod ìƒì„¸ ì •ë³´)" class="image-center" />
<em class="image-caption image-caption--img-shadow">ì •ìƒì ìœ¼ë¡œ Autoscaling ëœ ê²°ê³¼ (Pod ìƒì„¸ ì •ë³´)</em></p>

        <ul>
          <li>ìœ„ì˜ ê·¸ë¦¼ë“¤ ì²˜ëŸ¼ ì •ìƒì ìœ¼ë¡œ autoscalingì´ ì§„í–‰ë˜ê³ , 5ê°œ =&gt; 6ê°œë¡œ Node ê°€ ì¶”ê°€ë˜ê³  podê°€ ìƒì„±ë˜ì–´ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>karpenter ì‚­ì œ
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-L</span> karpenter.sh/nodepool <span class="nt">-L</span> node.kubernetes.io/instance-type <span class="nt">-L</span> topology.kubernetes.io/zone <span class="nt">-L</span> karpenter.sh/capacity-type
<span class="c"># =&gt; NAME                                                      STATUS   ROLES    AGE    VERSION               NODEPOOL   INSTANCE-TYPE   ZONE              CAPACITY-TYPE</span>
<span class="c">#    fargate-ip-10-10-18-179.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   53m    v1.30.0-eks-404b9c6                              ap-northeast-2b</span>
<span class="c">#    fargate-ip-10-10-25-19.ap-northeast-2.compute.internal    Ready    &lt;none&gt;   30m    v1.30.0-eks-404b9c6                              ap-northeast-2b</span>
<span class="c">#    fargate-ip-10-10-26-139.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   53m    v1.30.0-eks-404b9c6                              ap-northeast-2b</span>
<span class="c">#    fargate-ip-10-10-41-162.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   53m    v1.30.0-eks-404b9c6                              ap-northeast-2c</span>
<span class="c">#    fargate-ip-10-10-44-218.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   53m    v1.30.0-eks-404b9c6                              ap-northeast-2c</span>
<span class="c">#    ip-10-10-30-139.ap-northeast-2.compute.internal           Ready    &lt;none&gt;   2m3s   v1.30.0-eks-036c24b   default    c6gn.xlarge     ap-northeast-2b   spot</span>

<span class="c">#</span>
<span class="nv">$ </span>kubectl get nodeclaims
<span class="c"># =&gt; default-mkbpj   c6gn.xlarge   ap-northeast-2b   ip-10-10-30-139.ap-northeast-2.compute.internal   True    18m</span>
<span class="nv">$ </span>kubectl get nodeclaims <span class="nt">-o</span> yaml | kubectl neat
    
<span class="c"># deploy ì‚­ì œ &gt;&gt; ë…¸ë“œ ë³€í™” í™•ì¸ í•´ë³´ê¸°!</span>
<span class="nv">$ </span>kubectl delete <span class="nt">-f</span> example.yml
<span class="c"># =&gt; deployment.apps "inflate" deleted</span>
    
<span class="c"># karpenter ì •ì±… ì‚­ì œ</span>
<span class="nv">$ </span>kubectl delete <span class="nt">-f</span> karpenter.yml
<span class="c"># =&gt; ec2nodeclass.karpenter.k8s.aws "default" deleted</span>
<span class="c">#    nodepool.karpenter.sh "default" deleted</span>
</code></pre></div>    </div>
  </li>
  <li>ì‚­ì œ
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kube-ops-view ì‚­ì œ</span>
<span class="nv">$ </span>helm uninstall kube-ops-view <span class="nt">-n</span> kube-system
    
<span class="c"># addon &amp; karpenter helm ì‚­ì œ</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-target</span><span class="o">=</span><span class="s2">"module.eks_blueprints_addons"</span> <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Destroy complete! Resources: 24 destroyed.</span>
    
<span class="c"># EKS ì‚­ì œ</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-target</span><span class="o">=</span><span class="s2">"module.eks"</span> <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Destroy complete! Resources: 24 destroyed.</span>
    
<span class="c"># VPC ì‚­ì œ : vpc ì‚­ì œê°€ ì˜ ì•ˆë  ê²½ìš° aws ì½˜ì†”ì—ì„œ vpc ìˆ˜ë™ ì‚­ì œ -&gt; vnic ë“± ë‚¨ì•„ ìˆì„ ê²½ìš° í•´ë‹¹ vnic ê°•ì œ ì‚­ì œ</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Destroy complete! Resources: 23 destroyed.</span>
    
<span class="c"># VPC ì‚­ì œ í™•ì¸</span>
<span class="nv">$ </span>aws ec2 describe-vpcs <span class="nt">--filter</span> <span class="s1">'Name=isDefault,Values=false'</span> <span class="nt">--output</span> yaml
<span class="c"># =&gt; Vpcs: []</span>
    
<span class="c"># ì˜ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</span>
    
<span class="c"># kubeconfig ì‚­ì œ</span>
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> ~/.kube/config
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="eks-workshop">EKS Workshop</h2>

<ul>
  <li>ì´ë²ˆì—ëŠ” AWSì—ì„œ ì œê³µí•˜ëŠ” EKS Workshopì—ì„œ ì†Œê°œí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ EKSë¥¼ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.
    <ul>
      <li>ê´€ë ¨ë§í¬ :
<a href="https://eksworkshop.com/docs/introduction/">EKS Workshop ì†Œê°œ</a>, 
<a href="https://github.com/aws-samples/eks-workshop-v2">EKS Workshop Github</a>,
<a href="https://www.youtube.com/watch?v=E956xeOt050">ìœ íŠœë¸Œ</a></li>
    </ul>
  </li>
</ul>

<h3 id="ì‹¤ìŠµ-eks-ë°°í¬">[ì‹¤ìŠµ] EKS ë°°í¬</h3>

<h4 id="ì‚¬ì „ì¤€ë¹„-1">ì‚¬ì „ì¤€ë¹„</h4>

<ul>
  <li>awscli, terraform, kubectl ì„¤ì¹˜</li>
  <li>ì½”ë“œ ì¤€ë¹„ <a href="https://github.com/aws-samples/eks-workshop-v2">Github</a>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/aws-samples/eks-workshop-v2
<span class="nv">$ </span><span class="nb">cd </span>eks-workshop-v2/cluster/terraform
</code></pre></div>    </div>
    <ul>
      <li>providers.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">default_tags</span> <span class="p">{</span>
    <span class="nx">tags</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">tags</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"&gt;= 4.67.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
    
  <span class="nx">required_version</span> <span class="p">=</span> <span class="s2">"&gt;= 1.4.2"</span>
<span class="p">}</span> 
</code></pre></div>        </div>
      </li>
      <li>variables.tf - cluster ì´ë¦„, cluster ë²„ì „, ami ë²„ì „, vpc cidr ë³€ê²½ ê°€ëŠ¥
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">variable</span> <span class="s2">"cluster_name"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Name of the EKS cluster"</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"t101-eks-workshop"</span>
<span class="p">}</span>
    
<span class="k">variable</span> <span class="s2">"cluster_version"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"EKS cluster version."</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"1.30"</span>
<span class="p">}</span>
    
<span class="k">variable</span> <span class="s2">"ami_release_version"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Default EKS AMI release version for node groups"</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"1.30.0-20240625"</span>
<span class="p">}</span>
    
<span class="k">variable</span> <span class="s2">"vpc_cidr"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Defines the CIDR block used on Amazon VPC created for Amazon EKS."</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"10.42.0.0/16"</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>vpc.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">private_subnets</span> <span class="p">=</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">local</span><span class="p">.</span><span class="nx">azs</span> <span class="err">:</span> <span class="nx">cidrsubnet</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">vpc_cidr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">k</span> <span class="err">+</span> <span class="mi">3</span><span class="p">)]</span>
  <span class="nx">public_subnets</span>  <span class="p">=</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">local</span><span class="p">.</span><span class="nx">azs</span> <span class="err">:</span> <span class="nx">cidrsubnet</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">vpc_cidr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">k</span><span class="p">)]</span>
  <span class="nx">azs</span>             <span class="p">=</span> <span class="nx">slice</span><span class="p">(</span><span class="k">data</span><span class="p">.</span><span class="nx">aws_availability_zones</span><span class="p">.</span><span class="nx">available</span><span class="p">.</span><span class="nx">names</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">}</span>
    
<span class="k">data</span> <span class="s2">"aws_availability_zones"</span> <span class="s2">"available"</span> <span class="p">{</span>
  <span class="nx">state</span> <span class="p">=</span> <span class="s2">"available"</span>
<span class="p">}</span>
    
<span class="k">module</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"terraform-aws-modules/vpc/aws"</span>
  <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 5.1"</span>
    
  <span class="nx">name</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">cluster_name</span>
  <span class="nx">cidr</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">vpc_cidr</span>
    
  <span class="nx">azs</span>                   <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">azs</span>
  <span class="nx">public_subnets</span>        <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">public_subnets</span>
  <span class="nx">private_subnets</span>       <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">private_subnets</span>
  <span class="nx">public_subnet_suffix</span>  <span class="p">=</span> <span class="s2">"SubnetPublic"</span>
  <span class="nx">private_subnet_suffix</span> <span class="p">=</span> <span class="s2">"SubnetPrivate"</span>
    
  <span class="nx">enable_nat_gateway</span>   <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">create_igw</span>           <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">enable_dns_hostnames</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">single_nat_gateway</span>   <span class="p">=</span> <span class="kc">true</span>
    
  <span class="c1"># Manage so we can name</span>
  <span class="nx">manage_default_network_acl</span>    <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">default_network_acl_tags</span>      <span class="p">=</span> <span class="p">{</span> <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">cluster_name</span><span class="k">}</span><span class="s2">-default"</span> <span class="p">}</span>
  <span class="nx">manage_default_route_table</span>    <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">default_route_table_tags</span>      <span class="p">=</span> <span class="p">{</span> <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">cluster_name</span><span class="k">}</span><span class="s2">-default"</span> <span class="p">}</span>
  <span class="nx">manage_default_security_group</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">default_security_group_tags</span>   <span class="p">=</span> <span class="p">{</span> <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">cluster_name</span><span class="k">}</span><span class="s2">-default"</span> <span class="p">}</span>
    
  <span class="nx">public_subnet_tags</span> <span class="p">=</span> <span class="nx">merge</span><span class="p">(</span><span class="kd">local</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">"kubernetes.io/role/elb"</span> <span class="p">=</span> <span class="s2">"1"</span>
  <span class="p">})</span>
  <span class="nx">private_subnet_tags</span> <span class="p">=</span> <span class="nx">merge</span><span class="p">(</span><span class="kd">local</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">"karpenter.sh/discovery"</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">cluster_name</span>
  <span class="p">})</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">tags</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>main.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">created-by</span> <span class="p">=</span> <span class="s2">"eks-workshop-v2"</span>
    <span class="nx">study</span>      <span class="p">=</span> <span class="s2">"t101"</span>             <span class="c1"># íƒœê·¸ ì¶”ê°€</span>
    <span class="nx">for</span>        <span class="p">=</span> <span class="s2">"Sweet Little Bird"</span>
    <span class="nx">env</span>        <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">cluster_name</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>eks.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="s2">"eks"</span> <span class="p">{</span>
  <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"terraform-aws-modules/eks/aws"</span>
  <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 20.0"</span>
    
  <span class="nx">cluster_name</span>                   <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">cluster_name</span>
  <span class="nx">cluster_version</span>                <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">cluster_version</span>
  <span class="nx">cluster_endpoint_public_access</span> <span class="p">=</span> <span class="kc">true</span>
    
  <span class="nx">cluster_addons</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">vpc-cni</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">before_compute</span> <span class="p">=</span> <span class="kc">true</span>
      <span class="nx">most_recent</span>    <span class="p">=</span> <span class="kc">true</span>
      <span class="nx">configuration_values</span> <span class="p">=</span> <span class="nx">jsonencode</span><span class="p">({</span>
        <span class="nx">env</span> <span class="p">=</span> <span class="p">{</span>
          <span class="nx">ENABLE_POD_ENI</span>                    <span class="p">=</span> <span class="s2">"true"</span>
          <span class="nx">ENABLE_PREFIX_DELEGATION</span>          <span class="p">=</span> <span class="s2">"true"</span>
          <span class="nx">POD_SECURITY_GROUP_ENFORCING_MODE</span> <span class="p">=</span> <span class="s2">"standard"</span>
        <span class="p">}</span>
        <span class="nx">nodeAgent</span> <span class="p">=</span> <span class="p">{</span>
          <span class="nx">enablePolicyEventLogs</span> <span class="p">=</span> <span class="s2">"true"</span>
        <span class="p">}</span>
        <span class="nx">enableNetworkPolicy</span> <span class="p">=</span> <span class="s2">"true"</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
    
  <span class="nx">vpc_id</span>     <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">vpc_id</span>
  <span class="nx">subnet_ids</span> <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">private_subnets</span>
    
  <span class="nx">create_cluster_security_group</span> <span class="p">=</span> <span class="kc">false</span>
  <span class="nx">create_node_security_group</span>    <span class="p">=</span> <span class="kc">false</span>
    
  <span class="nx">eks_managed_node_groups</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">instance_types</span>       <span class="p">=</span> <span class="p">[</span><span class="s2">"m5.large"</span><span class="p">]</span>
      <span class="nx">force_update_version</span> <span class="p">=</span> <span class="kc">true</span>
      <span class="nx">release_version</span>      <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">ami_release_version</span>
    
      <span class="nx">min_size</span>     <span class="p">=</span> <span class="mi">3</span>
      <span class="nx">max_size</span>     <span class="p">=</span> <span class="mi">6</span>
      <span class="nx">desired_size</span> <span class="p">=</span> <span class="mi">3</span>
    
      <span class="nx">update_config</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">max_unavailable_percentage</span> <span class="p">=</span> <span class="mi">50</span>
      <span class="p">}</span>
    
      <span class="nx">labels</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">workshop-default</span> <span class="p">=</span> <span class="s2">"yes"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="nx">merge</span><span class="p">(</span><span class="kd">local</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">"karpenter.sh/discovery"</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">cluster_name</span>
  <span class="p">})</span>
<span class="p">}</span>    
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="terraform-init">terraform init</h4>

<p>í…Œë¼í¼ì„ ì‚¬ìš©í•˜ê¸°ìœ„í•´ ì´ˆê¸°í™”í•˜ê³ , ì„¤ì¹˜ëœ ëª¨ë“ˆ ë° í”„ë¡œë°”ì´ë” ì •ë³´ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="nv">$ </span>tree .terraform

<span class="c"># ì„¤ì¹˜ëœ ëª¨ë“ˆ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> .terraform/modules/modules.json | jq

<span class="c"># ì„¤ì¹˜ëœ í”„ë¡œë°”ì´ë” ë° ë²„ì „ í™•ì¸</span>
<span class="nv">$ </span>tree .terraform/providers/registry.terraform.io/hashicorp <span class="nt">-L</span> 2
<span class="c"># =&gt; .terraform/providers/registry.terraform.io/hashicorp</span>
<span class="c">#    â”œâ”€â”€ aws</span>
<span class="c">#    â”‚   â””â”€â”€ 5.60.0</span>
<span class="c">#    â”œâ”€â”€ cloudinit</span>
<span class="c">#    â”‚   â””â”€â”€ 2.3.4</span>
<span class="c">#    â”œâ”€â”€ null</span>
<span class="c">#    â”‚   â””â”€â”€ 3.2.2</span>
<span class="c">#    â”œâ”€â”€ time</span>
<span class="c">#    â”‚   â””â”€â”€ 0.12.0</span>
<span class="c">#    â””â”€â”€ tls</span>
<span class="c">#        â””â”€â”€ 4.0.5</span>
</code></pre></div></div>

<h4 id="vpc-ë°°í¬-1">VPC ë°°í¬</h4>

<p>VPCë¥¼ ë¨¼ì € ë°°í¬í•˜ê³  ê´€ë ¨ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.
EKSì™€ í•œêº¼ë²ˆì— ë°°í¬í•´ë„ ë˜ì§€ë§Œ ì§„í–‰ ìƒí™©ì„ í™•ì¸í•˜ê¸° ìœ„í•´ VPCë¥¼ ë¨¼ì € ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì„¤ì¹˜ì „ VPC ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>aws ec2 describe-vpcs <span class="nt">--filter</span> <span class="s1">'Name=isDefault,Values=false'</span> <span class="nt">--output</span> yaml
<span class="c"># =&gt; Vpcs: []     # í˜„ì¬ VPCê°€ ì—†ìŠµë‹ˆë‹¤.</span>

<span class="c"># VPC ë°°í¬</span>
<span class="nv">$ </span>terraform apply <span class="nt">-target</span><span class="o">=</span><span class="s2">"module.vpc"</span> <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 23 added, 0 changed, 0 destroyed.</span>

<span class="c"># ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform show
<span class="nv">$ </span>aws ec2 describe-vpcs <span class="nt">--filter</span> <span class="s1">'Name=isDefault,Values=false'</span> <span class="nt">--output</span> yaml
<span class="c"># =&gt; Vpcs:</span>
<span class="c">#    - CidrBlock: 10.42.0.0/16</span>
<span class="c">#      CidrBlockAssociationSet:</span>
<span class="c">#      - AssociationId: vpc-cidr-assoc-0c375c03935938c89</span>
<span class="c">#        CidrBlock: 10.42.0.0/16</span>
<span class="c">#      ...</span>
<span class="c">#      State: available</span>
<span class="c">#      Tags:</span>
<span class="c">#      ...</span>
<span class="c">#      - Key: study                   # ì¶”ê°€í•œ íƒœê·¸ í™•ì¸    </span>
<span class="c">#        Value: t101</span>
<span class="c">#      - Key: Name</span>
<span class="c">#        Value: t101-eks-workshop</span>
<span class="c">#      VpcId: vpc-0247fb591c49eab40</span>

<span class="c"># ì‚¬ìš©ê°€ëŠ¥í•œ ê°€ìš©ì„± ì¡´ í™•ì¸ </span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.aws_availability_zones.available"</span> | terraform console

<span class="c"># VPC/subnet ìƒì„¸ ì •ë³´ ë° tag í™•ì¸</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.vpc.aws_vpc.this[0]'</span>

<span class="nv">$ VPCID</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo </span>module.vpc.vpc_id | terraform console<span class="si">)</span>   <span class="c"># í˜„ì¬ VPC IDë¥¼ $VPCID ë³€ìˆ˜ì— ì €ì¥</span>
<span class="c"># VPC ì˜ Subnet ìƒì„¸ ì •ë³´ í™•ì¸ (json)</span>
<span class="nv">$ </span>aws ec2 describe-subnets <span class="nt">--filters</span> <span class="s2">"Name=vpc-id,Values=</span><span class="nv">$VPCID</span><span class="s2">"</span> | jq
<span class="c"># VPC ì˜ Subnet ìƒì„¸ ì •ë³´ í™•ì¸ (í…ìŠ¤íŠ¸)</span>
<span class="nv">$ </span>aws ec2 describe-subnets <span class="nt">--filters</span> <span class="s2">"Name=vpc-id,Values=</span><span class="nv">$VPCID</span><span class="s2">"</span> <span class="nt">--output</span> text

<span class="c"># public ì„œë¸Œë„·ê³¼ private ì„œë¸Œë„· CIDR í™•ì¸</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.vpc.aws_subnet.public[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.vpc.aws_subnet.private[0]'</span>
</code></pre></div></div>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_37.png" alt="VPC ë°°í¬ ê²°ê³¼ (subnet)" class="image-center" />
<em class="image-caption">VPC ë°°í¬ ê²°ê³¼ (subnet)</em></p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_38.png" alt="VPC ë°°í¬ ê²°ê³¼ (subnet íƒœê·¸ ì •ë³´)" class="image-center" />
<em class="image-caption">VPC ë°°í¬ ê²°ê³¼ (subnet íƒœê·¸ ì •ë³´)</em></p>

<h4 id="eks-ë°°í¬">EKS ë°°í¬</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># EKS ë°°í¬</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span> 
<span class="c"># =&gt; Apply complete! Resources: 24 added, 0 changed, 0 destroyed.</span>

<span class="c"># EKS ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; data.aws_availability_zones.available</span>
<span class="c">#    module.eks.data.aws_caller_identity.current</span>
<span class="c">#    module.eks.data.aws_eks_addon_version.this["vpc-cni"]</span>
<span class="c">#    module.eks.data.aws_iam_policy_document.assume_role_policy[0]</span>
<span class="c">#    module.eks.data.aws_iam_session_context.current</span>
<span class="c">#    module.eks.data.aws_partition.current</span>
<span class="c">#    module.eks.data.tls_certificate.this[0]</span>
<span class="c">#    module.eks.aws_cloudwatch_log_group.this[0]</span>
<span class="c">#    module.eks.aws_ec2_tag.cluster_primary_security_group["created-by"]</span>
<span class="c">#    module.eks.aws_ec2_tag.cluster_primary_security_group["env"]</span>
<span class="c">#    module.eks.aws_ec2_tag.cluster_primary_security_group["karpenter.sh/discovery"]</span>
<span class="c">#    module.eks.aws_ec2_tag.cluster_primary_security_group["study"]</span>
<span class="c">#    module.eks.aws_eks_addon.before_compute["vpc-cni"]</span>
<span class="c">#    module.eks.aws_eks_cluster.this[0]</span>
<span class="c">#    module.eks.aws_iam_openid_connect_provider.oidc_provider[0]</span>
<span class="c">#    module.eks.aws_iam_policy.cluster_encryption[0]</span>
<span class="c">#    module.eks.aws_iam_role.this[0]</span>
<span class="c">#    ...</span>
<span class="c">#    module.eks.module.kms.data.aws_caller_identity.current[0]</span>
<span class="c">#    module.eks.module.kms.data.aws_iam_policy_document.this[0]</span>
<span class="c">#    module.eks.module.kms.data.aws_partition.current[0]</span>
<span class="c">#    module.eks.module.kms.aws_kms_alias.this["cluster"]</span>
<span class="c">#    module.eks.module.kms.aws_kms_key.this[0]</span>
<span class="c">#    module.eks.module.eks_managed_node_group["default"].module.user_data.null_resource.validate_cluster_service_cidr</span>

<span class="c"># EKS ìê²© ì¦ëª… ì„¤ì • ë° í™•ì¸</span>
<span class="c">## aws eks --region &lt;REGION&gt; update-kubeconfig --name &lt;CLUSTER_NAME&gt; --alias &lt;CLUSTER_NAME&gt;</span>
<span class="nv">$ </span>aws eks <span class="nt">--region</span> ap-northeast-2 update-kubeconfig <span class="nt">--name</span> t101-eks-workshop
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config

<span class="c"># k8s í´ëŸ¬ìŠ¤í„° ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl cluster-info
<span class="c"># =&gt; error: You must be logged in to the server (Unauthorized)</span>
</code></pre></div></div>

<p>ì •ìƒì ìœ¼ë¡œ ë°°í¬í•˜ì˜€ê³  EKS ìê²©ì¦ëª…ì„ ì„¤ì •í•˜ì˜€ìŒì—ë„ kubectl ì‚¬ìš©ì‹œ ê¶Œí•œì´ ì—†ë‹¤ê³  ë‚˜ì˜µë‹ˆë‹¤.</p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_40.png" alt="EKS ë°°í¬ ê²°ê³¼ (IAM ê¶Œí•œ ì—†ìŒ)" class="image-center" /></p>

<p>ë˜í•œ EKS ì½˜ì†”ì—ì„œë„ ê¶Œí•œì´ ì—†ë‹¤ê³  ë‚˜ì˜µë‹ˆë‹¤.
ì´ëŠ” í˜„ì¬ ì‚¬ìš©ì¤‘ì¸ IAMì´ í•´ë‹¹ k8s í´ëŸ¬ìŠ¤í„°ì— ëŒ€í•œ ê¶Œí•œì´ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í•˜ê³  ê³„ì† ë°°í¬ìƒíƒœë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># EKS ê´€ë¦¬ìš© IAM User ì˜ access entry ìƒì„±</span>
<span class="nv">$ ACCOUNT_ID</span><span class="o">=</span><span class="si">$(</span>aws sts get-caller-identity <span class="nt">--query</span> <span class="s1">'Account'</span> <span class="nt">--output</span> text<span class="si">)</span>
<span class="c"># $ MYIAMUSER=&lt;ê°ì ìì‹ ì˜ IAM User&gt;</span>
<span class="nv">$ MYIAMUSER</span><span class="o">=</span>admin
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$ACCOUNT_ID</span> <span class="nv">$MYIAMUSER</span>
<span class="nv">$ </span>aws eks create-access-entry <span class="nt">--cluster-name</span> t101-eks-workshop <span class="nt">--principal-arn</span> arn:aws:iam::<span class="k">${</span><span class="nv">ACCOUNT_ID</span><span class="k">}</span>:user/<span class="k">${</span><span class="nv">MYIAMUSER</span><span class="k">}</span>
<span class="nv">$ </span>aws eks list-access-entries <span class="nt">--cluster-name</span> t101-eks-workshop

<span class="c"># EKS ê´€ë¦¬ìš© IAM Userì— AmazonEKSClusterAdminPolicy ì—°ë™</span>
<span class="nv">$ </span>aws eks associate-access-policy <span class="nt">--cluster-name</span> t101-eks-workshop <span class="nt">--principal-arn</span> arn:aws:iam::<span class="k">${</span><span class="nv">ACCOUNT_ID</span><span class="k">}</span>:user/<span class="k">${</span><span class="nv">MYIAMUSER</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--policy-arn</span> arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy <span class="nt">--access-scope</span> <span class="nb">type</span><span class="o">=</span>cluster

<span class="nv">$ </span>aws eks list-associated-access-policies <span class="nt">--cluster-name</span> t101-eks-workshop <span class="nt">--principal-arn</span> arn:aws:iam::<span class="k">${</span><span class="nv">ACCOUNT_ID</span><span class="k">}</span>:user/<span class="k">${</span><span class="nv">MYIAMUSER</span><span class="k">}</span> | jq
<span class="nv">$ </span>aws eks describe-access-entry <span class="nt">--cluster-name</span> t101-eks-workshop <span class="nt">--principal-arn</span> arn:aws:iam::<span class="k">${</span><span class="nv">ACCOUNT_ID</span><span class="k">}</span>:user/<span class="k">${</span><span class="nv">MYIAMUSER</span><span class="k">}</span> | jq
 
<span class="c"># (ì°¸ê³ ) context name ë³€ê²½</span>
<span class="nv">$ </span>kubectl config rename-context <span class="s2">"arn:aws:eks:ap-northeast-2:</span><span class="si">$(</span>aws sts get-caller-identity <span class="nt">--query</span> <span class="s1">'Account'</span> <span class="nt">--output</span> text<span class="si">)</span><span class="s2">:cluster/t101-eks-workshop"</span> <span class="s2">"T101-Lab"</span>
<span class="c"># =&gt; Context "arn:aws:eks:ap-northeast-2:123456:cluster/t101-eks-workshop" renamed to "T101-Lab".</span>

<span class="c"># k8s í´ëŸ¬ìŠ¤í„°, ë…¸ë“œ, íŒŒë“œ ì •ë³´ í™•ì¸ - ì´ì œ ì •ìƒì ìœ¼ë¡œ ì¡°íšŒ ë©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>kubectl cluster-info
<span class="c"># =&gt; Kubernetes control plane is running at https://79B209921C6987FCA6A542FDE1272C2E.gr7.ap-northeast-2.eks.amazonaws.com</span>
<span class="c">#    CoreDNS is running at https://79B209921C6987FCA6A542FDE1272C2E.gr7.ap-northeast-2.eks.amazonaws.com/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>

<span class="nv">$ </span>kubectl get node
<span class="nv">$ </span>kubectl get nodes <span class="nt">-L</span> node.kubernetes.io/instance-type <span class="nt">-L</span> topology.kubernetes.io/zone
<span class="c"># =&gt; NAME                                               STATUS   ROLES    AGE   VERSION               INSTANCE-TYPE   ZONE</span>
<span class="c">#    ip-10-42-103-44.ap-northeast-2.compute.internal    Ready    &lt;none&gt;   16m   v1.30.0-eks-036c24b   m5.large        ap-northeast-2a</span>
<span class="c">#    ip-10-42-153-180.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   16m   v1.30.0-eks-036c24b   m5.large        ap-northeast-2b</span>
<span class="c">#    ip-10-42-171-220.ap-northeast-2.compute.internal   Ready    &lt;none&gt;   16m   v1.30.0-eks-036c24b   m5.large        ap-northeast-2c</span>

<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span>
<span class="c"># =&gt; NAMESPACE     NAME                      READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    kube-system   aws-node-2jnd5            2/2     Running   0          16m</span>
<span class="c">#    kube-system   aws-node-ftb8g            2/2     Running   0          16m</span>
<span class="c">#    kube-system   aws-node-gn6nx            2/2     Running   0          16m</span>
<span class="c">#    kube-system   coredns-5b9dfbf96-f8bfr   1/1     Running   0          19m</span>
<span class="c">#    kube-system   coredns-5b9dfbf96-rtwfs   1/1     Running   0          19m</span>
<span class="c">#    kube-system   kube-proxy-5zkxj          1/1     Running   0          16m</span>
<span class="c">#    kube-system   kube-proxy-n645w          1/1     Running   0          16m</span>
<span class="c">#    kube-system   kube-proxy-rcbvk          1/1     Running   0          16m</span>
 
<span class="c"># ìƒì„¸ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>terraform show
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_ec2_tag.cluster_primary_security_group["study"]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_eks_addon.before_compute["vpc-cni"]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_eks_cluster.this[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_iam_openid_connect_provider.oidc_provider[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.aws_iam_policy.cluster_encryption[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.time_sleep.this[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.eks_managed_node_group["default"].aws_eks_node_group.this[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.eks_managed_node_group["default"].aws_iam_role.this[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.eks_managed_node_group["default"].aws_launch_template.this[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.eks_managed_node_group["default"].module.user_data.null_resource.validate_cluster_service_cidr'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.kms.aws_kms_key.this[0]'</span>
<span class="nv">$ </span>terraform state show <span class="s1">'module.eks.module.kms.aws_kms_alias.this["cluster"]'</span>
</code></pre></div></div>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_41.png" alt="EKS ë°°í¬ ê²°ê³¼ (ì •ìƒ)" class="image-center" /></p>

<h4 id="kube-ops-view-ì„¤ì¹˜-ë°-ì‚¬ìš©">kube-ops-view ì„¤ì¹˜ ë° ì‚¬ìš©</h4>
<p>ì•ì„œ ì„¤ì¹˜í•´ë³´ì•˜ë˜ kube-ops-viewë¥¼ ì´ë²ˆ kubernetes í´ëŸ¬ìŠ¤í„°ì—ë„ ì„¤ì¹˜í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_42.png" alt="kube-ops-view" class="image-center" />
  <em class="image-caption image-caption--img-shadow">kube-ops-view</em></p>

<ul>
  <li>ë…¸ë“œì˜ íŒŒë“œ ìƒíƒœì •ë³´ë¥¼ ì›¹í˜ì´ì§€ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶œë ¥í•´ì¤ë‹ˆë‹¤.</li>
  <li>ì„¤ì¹˜ ë° ì‚¬ìš©
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
<span class="c"># =&gt; "geek-cookbook" has been added to your repositories</span>
    
<span class="nv">$ </span>helm <span class="nb">install </span>kube-ops-view geek-cookbook/kube-ops-view <span class="nt">--version</span> 1.2.2 <span class="nt">--set</span> env.TZ<span class="o">=</span><span class="s2">"Asia/Seoul"</span> <span class="nt">--namespace</span> kube-system

<span class="c"># í¬íŠ¸í¬ì›Œë”©</span>
<span class="nv">$ </span>kubectl port-forward deployment/kube-ops-view <span class="nt">-n</span> kube-system 8080:8080 &amp;

<span class="c"># ì ‘ì† ì£¼ì†Œ í™•ì¸ : ê°ê° 1ë°°, 1.5ë°°, 3ë°° í¬ê¸°</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:8080"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:8080/#scale=1.5"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:8080/#scale=3"</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="pod-ë°°í¬">Pod ë°°í¬</h4>

<p>EKS Blueprintì—ì„œ ì œê³µí•˜ëŠ” ì˜ˆì œë¥¼ ì´ìš©í•˜ì—¬ Podë¥¼ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>example.yml ìƒì„±
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">inflate</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">inflate</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">inflate</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">0</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">inflate</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">public.ecr.aws/eks-distro/kubernetes/pause:3.7</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">1</span>     
</code></pre></div>    </div>
  </li>
  <li>Pod ë°°í¬ ì‹¤ìŠµ
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> example.yml
<span class="c"># =&gt; deployment.apps/inflate created</span>
  
<span class="nv">$ </span>kubectl get deploy   <span class="c"># replicasê°€ 0ì´ì–´ì„œ ìƒì„±ëœ podê°€ ì—†ìŠµë‹ˆë‹¤.</span>
<span class="c"># =&gt; NAME      READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    inflate   0/0     0            0           16s</span>
  
<span class="c"># 3ê°œë¡œ scale í•´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>kubectl scale deployment inflate <span class="nt">--replicas</span><span class="o">=</span>3 <span class="o">&amp;&amp;</span> kubectl get pod <span class="nt">-w</span>
<span class="c"># =&gt; deployment.apps/inflate scaled</span>
<span class="c">#    NAME                       READY   STATUS              RESTARTS   AGE</span>
<span class="c">#    inflate-66fb68585c-8j7wr   0/1     ContainerCreating   0          1s</span>
<span class="c">#    inflate-66fb68585c-j6bh4   0/1     ContainerCreating   0          1s</span>
<span class="c">#    inflate-66fb68585c-sqwmc   0/1     ContainerCreating   0          1s</span>
<span class="c">#    ... ì ì‹œí›„ ...</span>
<span class="c">#    inflate-66fb68585c-8j7wr   1/1     Running             0          4s</span>
<span class="c">#    inflate-66fb68585c-j6bh4   1/1     Running             0          5s</span>
<span class="c">#    inflate-66fb68585c-sqwmc   1/1     Running             0          5s</span>
</code></pre></div>    </div>
    <p><img src="/assets/2024/t101-4th/20240727_terraform_w7_eks_karpenter_43.png" alt="Pod ë°°í¬ ê²°ê³¼" class="image-center" />
<em class="image-caption image-caption--img-shadow">Pod ë°°í¬ ê²°ê³¼</em></p>
  </li>
</ul>

<h4 id="eks-í´ëŸ¬ìŠ¤í„°-ë°-vpc-ì‚­ì œ">EKS í´ëŸ¬ìŠ¤í„° ë° VPC ì‚­ì œ</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kube-ops-view ì‚­ì œ</span>
<span class="nv">$ </span>helm uninstall kube-ops-view <span class="nt">-n</span> kube-system
<span class="c"># =&gt; release "kube-ops-view" uninstalled</span>

<span class="c"># ì‚­ì œ : vpc ì‚­ì œê°€ ì˜ ì•ˆë  ê²½ìš° aws ì½˜ì†”ì—ì„œ vpc ìˆ˜ë™ ì‚­ì œ -&gt; vnic ë“± ë‚¨ì•„ ìˆì„ ê²½ìš° í•´ë‹¹ vnic ê°•ì œ ì‚­ì œ : 9ë¶„ ì†Œìš”</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Destroy complete! Resources: 47 destroyed.</span>

<span class="c"># VPC ì‚­ì œ í™•ì¸</span>
<span class="nv">$ </span>aws ec2 describe-vpcs <span class="nt">--filter</span> <span class="s1">'Name=isDefault,Values=false'</span> <span class="nt">--output</span> yaml
<span class="c"># =&gt; Vpcs: []</span>

<span class="c"># kubeconfig ì‚­ì œ</span>
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> ~/.kube/config
</code></pre></div></div>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì´ë²ˆ ì£¼ì—ëŠ” EKS Blueprintë¥¼ ì´ìš©í•œ ë°©ë²•ê³¼ EKS Workshopì„ ì´ìš©í•œ ë°©ë²•ì„ í†µí•´ Terraformì„ í™œìš©í•˜ì—¬ EKS ë°°í¬ë¥¼ ì§„í–‰í•´ë³´ì•˜ìŠµë‹ˆë‹¤.
ì´ë²ˆ ì‹¤ìŠµì„ í†µí•´ ë†€ë€ì ì€ <strong>EKS ë°°í¬ê°€ ì°¸ ë³µì¡í•˜ê³  ë§ì€ AWS ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”êµ¬ë‚˜</strong> í•˜ëŠ”ê²ƒê³¼
<strong>Terraformì„ í™œìš©í•˜ë©´ ì´ë ‡ê²Œ ì‰½ê²Œ í´ëŸ¬ìŠ¤í„°ë¥¼ ë°°í¬</strong> í•  ìˆ˜ ìˆêµ¬ë‚˜ í•˜ëŠ”ê²ƒì…ë‹ˆë‹¤.</p>

<p>ì•„ë¬´ë¦¬ ë³µì¡í•œ ë°°í¬ ê³¼ì •ì´ í•„ìš”í•˜ë”ë¼ë„ <strong>Terraform ëª¨ë“ˆì„ ì˜ ë§Œë“¤ì–´ë‘ë©´</strong>
ì´í›„ì—ëŠ” <strong>ëˆ„êµ¬ë¼ë„ ì‰½ê²Œ</strong> ëª‡ ì¤„ì˜ ëª…ë ¹ì–´ ë§Œìœ¼ë¡œ ë°°í¬ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ ëŠê¼ˆê³ 
Terraformì˜ ê°•ë ¥í•¨ì„ ëŠê¼ˆìŠµë‹ˆë‹¤.</p>

<p>ì´ë²ˆ ì‹¤ìŠµì„ ê±°ì¹˜ë©´ì„œ AWSì™€ Terraformì— ëŒ€í•´ ì¡°ê¸ˆë” ì•Œê²Œ ë˜ì—ˆê³ , í•œ ë°œìêµ­ ë” ê°€ê¹Œì›Œì§„ ëŠë‚Œì…ë‹ˆë‹¤.
ì¢‹ì€ ì‹¤ìŠµ ê¸°íšŒë¥¼ ì£¼ì‹  ê°€ì‹œë‹¤ ë‹˜ê³¼ Terraform 101 ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•˜ì‹  ë¶„ë“¤ê»˜ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.
ë‹¤ìŒ ìŠ¤í„°ë””ê°€ ë§ˆì§€ë§‰ì´ì–´ì„œ ì•„ì‰½ê¸°ë„ í•˜ë©´ì„œ ê¸°ëŒ€ë„ ë©ë‹ˆë‹¤. ë§ˆì§€ë§‰ê¹Œì§€ ì—´ì‹¬íˆ ë‹¬ë ¤ë³´ê² ìŠµë‹ˆë‹¤.</p>]]></content><author><name></name></author><category term="terraform" /><category term="terraform," /><category term="cloud," /><category term="aws" /><summary type="html"><![CDATA[ì´ë²ˆ ì£¼ì—ëŠ” í…Œë¼í¼ìœ¼ë¡œ AWS EKS ë°°í¬ë¥¼ í•˜ëŠ”ê²ƒì„ í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaCë¥¼ í†µí•´ ì•Œì•„ ë³´ê² ìŠµë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[T101 4ê¸°] Runner</title><link href="https://sweetlittlebird.github.io/posts/2024-07-13-T101-Study-Terraform-Week-5b/" rel="alternate" type="text/html" title="[T101 4ê¸°] Runner" /><published>2024-07-13T02:08:00+09:00</published><updated>2024-07-13T02:08:00+09:00</updated><id>https://sweetlittlebird.github.io/posts/T101%20Study%20-%20Terraform%20Week%205b</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-07-13-T101-Study-Terraform-Week-5b/"><![CDATA[<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì´ë²ˆ ì£¼ì—ëŠ” <code class="language-plaintext highlighter-rouge">Module</code>ê³¼ <code class="language-plaintext highlighter-rouge">Runner</code>ì— ëŒ€í•´
<a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a>ë¥¼ í†µí•´ ì•Œì•„ ë³´ëŠ” ì¤‘ì…ë‹ˆë‹¤.
ê³„ì†í•´ì„œ Terraform Runnerì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" /></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a></p>
</blockquote>

<h2 id="terraform-runner">Terraform Runner</h2>

<ul>
  <li>Terraform RunnerëŠ” Terraformì„ ì‚¬ìš©í•˜ì—¬ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ
ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ì½”ë“œì˜ ë°°í¬ë¥¼ ê°„ì†Œí™”í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
  <li>íŠ¹íˆ GitOps ë“±ì„ í†µí•œ CI/CD íŒŒì´í”„ë¼ì¸ ë‚´ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ë©°,
ì½”ë“œ ë³€ê²½ ì‚¬í•­ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  ì ìš©í•˜ì—¬ ì¸í”„ë¼ì˜ ìƒíƒœë¥¼ ìµœì‹  ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤. 
ì´ë¥¼ í†µí•´ ê°œë°œìì™€ ìš´ì˜íŒ€ì€ ì¸í”„ë¼ ê´€ë¦¬ë¥¼ ë” íš¨ìœ¨ì ì´ê³  ì•ˆì •ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì°¸ê³  ë§í¬
    <ul>
      <li>êµ­ë‚´
        <ul>
          <li>Terraformì„ GitOps ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë„êµ¬ ì„ íƒ - <a href="https://nangman14.tistory.com/109">Link</a></li>
          <li>Atlantis ë€? (Terraform Pull Request Automation) - <a href="https://kim-dragon.tistory.com/253">Link</a></li>
          <li>í«í”„ë Œì¦ˆê°€ DevOps ì¡°ì§ì—†ì´ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²• - <a href="https://techblog.pet-friends.co.kr/%ED%8E%AB%ED%94%84%EB%A0%8C%EC%A6%88%EA%B0%80-devops-%EC%A1%B0%EC%A7%81%EC%97%86%EC%9D%B4-%EC%9D%B8%ED%94%84%EB%9D%BC%EB%A5%BC-%EA%B4%80%EB%A6%AC%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95-ce27449bc201">Link</a></li>
          <li>Atlantis ë°°í¬í•˜ê¸° - <a href="https://devops-art-factory.gitbook.io/devops-workshop/terraform/atlantis/atlantis-main">Link</a></li>
          <li>Githubì—ì„œ Atlantisë¥¼ ì´ìš©í•œ  Terraform í˜‘ì—… í™˜ê²½ êµ¬ì¶• - <a href="https://isn-t.tistory.com/46">Link</a> <a href="https://github.com/TAEKnical/Terraform_study/">Github</a></li>
          <li>Jenkins + terraform + tfsec ë¡œ ì •ì  ë¶„ì„ ìë™í™” êµ¬ì„± í•˜ê¸° - <a href="https://devocean.sk.com/blog/techBoardDetail.do?ID=163872">Link</a></li>
        </ul>
      </li>
      <li>í•´ì™¸
        <ul>
          <li>install-atlantis-docker-container-in-amazon-linux-integrate - <a href="https://www.easydeploy.io/blog/install-atlantis-docker-container-in-amazon-linux-integrate/">Link</a> <a href="https://github.com/easydeploy-cloud/atlantis-blog">Github</a></li>
          <li>Hacking Atlantis - <a href="https://www.youtube.com/watch?v=S1-vGf_ao1s&amp;t=896s">Youtube</a></li>
          <li>[CNCF] How Breaking up Our Infrastructure Monorepos Saved Us from Pulâ€¦ Donnie Laughton - <a href="https://www.youtube.com/watch?v=5dAUDpwZTQ8">Youtube</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Terraform RunnerëŠ” ë‹¤ìˆ˜ì˜ ì¢…ë¥˜ê°€ ìˆëŠ”ë° ê·¸ ì¤‘ì—ì„œ Atlantisë¥¼ ì‚¬ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<h3 id="atlantis-ë€">Atlantis ë€?</h3>

<ul>
  <li><strong>Atlantis</strong>ëŠ” <strong>Terraform Pull Request Automation</strong> ë„êµ¬ë¡œ,
Terraform ì½”ë“œë¥¼ GitOps ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤. Terraform Pull Request Automationë€ ê°œë°œìì™€ ìš´ì˜ìê°€ <strong>í’€ ë¦¬í€˜ìŠ¤íŠ¸ì—ì„œ ì§ì ‘ terraform planê³¼ applyë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ</strong> í•˜ì—¬
Terraform ì›Œí¬í”Œë¡œìš°ì˜ í˜‘ì—…ê³¼ ì•ˆì „ì„±ì„ ê°œì„ í•©ë‹ˆë‹¤.</li>
  <li>ì´ëŠ” ê°œë°œìê°€ ìê²© ì¦ëª… ì—†ì´ Terraformì„ ì‘ì„±í•˜ê³  ì ìš©í•  ìˆ˜ ìˆë„ë¡ ë•ê³ , íš¨ê³¼ì ì¸ í˜‘ì—… ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒ ë§í¬ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://www.runatlantis.io/">Link</a></li>
  <li>ëŒ€ëµì ì¸ ë™ì‘ ë°©ì‹ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_1.png" alt="img.png" class="image-center" />
<em class="image-caption">ì¶œì²˜ : <a href="https://isn-t.tistory.com/46">https://isn-t.tistory.com/46</a></em></li>
</ul>

<h3 id="atlantis-ì„¤ì¹˜">Atlantis ì„¤ì¹˜</h3>

<ul>
  <li>AtlantisëŠ” ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì¤‘ì—ì„œ Githubë¥¼ ì‚¬ìš©í•˜ê³  Dockerë¥¼ ì‚¬ìš©í•œ ì„¤ì¹˜ ë°©ë²•ì„ ì†Œê°œí•©ë‹ˆë‹¤.</li>
  <li>ì„¤ì¹˜ ìˆœì„œ
    <ol>
      <li>github ì— repository ìƒì„±í•©ë‹ˆë‹¤. (private/public ê´€ê³„ ì—†ìŒ)</li>
      <li>Personal Access Tokenì„ ìƒì„±í•©ë‹ˆë‹¤.
        <ul>
          <li>í”„ë¡œí•„ ì‚¬ì§„ í´ë¦­ &gt; Settings &gt; Developer settings &gt; Personal access tokens &gt; Fine-grained tokens &gt; Generate new token</li>
          <li>ì´ë¦„ ë¶€ì—¬</li>
          <li>Only select repositories ì„ íƒ</li>
          <li>ê¶Œí•œì„ ì¤„ ì €ì¥ì†Œ ì„ íƒ (1. ì—ì„œ ë§Œë“  repository)</li>
          <li>Repository Permissionsì˜ Contents ì— Read &amp; write ì„ íƒ</li>
          <li>Generate token ë²„íŠ¼ í´ë¦­</li>
          <li>ìƒì„±ëœ í† í°ì„ ë³µì‚¬í•©ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>ê³µì¸ IPê°€ ìˆëŠ” ì„œë²„ì— Dockerë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. (ê³µìœ ê¸°ë¡œ í¬íŠ¸í¬ì›Œë”© í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.)
        <ul>
          <li>Docker ì„¤ì¹˜ ë°©ë²•ì€ ë‹¤ì–‘í•˜ê²Œ ìˆìŠµë‹ˆë‹¤. <a href="https://docs.docker.com/get-docker/">Docker ì„¤ì¹˜</a> Dockerê°€ ì„¤ì¹˜ ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>Dockerì—ì„œ atlantis ì‹¤í–‰
        <ul>
          <li>docker-compose.yml ì‘ì„±
            <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">atlantis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/runatlantis/atlantis:v0.28-alpine</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">4141:4141"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ATLANTIS_GH_WEBHOOK_SECRET=&lt;GITHUBì—°ë™ìš© ëœë¤ê°’&gt;</span>
      <span class="pi">-</span> <span class="s">ATLANTIS_GH_USER=&lt;GITHUB ì•„ì´ë””&gt;</span>
      <span class="pi">-</span> <span class="s">ATLANTIS_GH_TOKEN=&lt;2.ì—ì„œ ìƒì„±í•œ í† í°&gt;</span>
      <span class="pi">-</span> <span class="s">ATLANTIS_REPO_ALLOWLIST=&lt;1.ì—ì„œ ìƒì„±í•œ repository ì´ë¦„&gt;</span>
</code></pre></div>            </div>
          </li>
          <li>docker-compose ì‹¤í–‰
            <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker compose up <span class="nt">-d</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>Atlantis ì ‘ì† í…ŒìŠ¤íŠ¸
        <ul>
          <li>ë¸Œë¼ìš°ì €ì—ì„œ <code class="language-plaintext highlighter-rouge">http://&lt;ì„œë²„ IP&gt;:4141</code>ë¡œ ì ‘ì†í•˜ì—¬ í™•ì¸í•©ë‹ˆë‹¤.</li>
          <li>Atlantisê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆë‹¤ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
 <img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_2.png" alt="img.png" /></li>
        </ul>
      </li>
      <li>Githubì— Webhook ì„¤ì •
        <ul>
          <li>1.ì—ì„œ ìƒì„±í•œ ì €ì¥ì†Œì— ì ‘ì†í•©ë‹ˆë‹¤.</li>
          <li>Settings &gt; Webhooks &gt; Add webhook í´ë¦­í•©ë‹ˆë‹¤.</li>
          <li>Payload URLì— ì•ì„œ ì ‘ì† í…ŒìŠ¤íŠ¸í•œ <code class="language-plaintext highlighter-rouge">http://&lt;ì„œë²„ IP&gt;:4141/events</code> ë¥¼ ê¸°ì…í•©ë‹ˆë‹¤.
            <ul>
              <li><code class="language-plaintext highlighter-rouge">/events</code> ë¡œ ëë‚˜ëŠ”ì§€ ë°˜ë“œì‹œ í™•ì¸í•©ë‹ˆë‹¤. íŠ¹íˆ 405 ì—ëŸ¬ê°€ ë‚˜ë©´ ë”ìš± ê·¸ëŸ¬í•©ë‹ˆë‹¤.</li>
            </ul>
          </li>
          <li>Content typeì— <code class="language-plaintext highlighter-rouge">application/json</code> ì„ ì„ íƒí•©ë‹ˆë‹¤.</li>
          <li>Secretì— 4.ì—ì„œ ë“±ë¡í•œ <code class="language-plaintext highlighter-rouge">&lt;GITHUBì—°ë™ìš© ëœë¤ê°’&gt;</code>ì„ ê¸°ì…í•©ë‹ˆë‹¤.</li>
          <li>Let me select individual eventsë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</li>
          <li>ë‹¤ìŒ í•­ëª©ë“¤ì„ ì²´í¬í•©ë‹ˆë‹¤.
            <ul>
              <li>Pull request reviews</li>
              <li>Pushes</li>
              <li>Issue comments</li>
              <li>Pull requests</li>
            </ul>
          </li>
          <li>Activeë¥¼ ì²´í¬í•©ë‹ˆë‹¤.</li>
          <li>Add webhook ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>ì„¤ì¹˜ê³¼ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ Terraform ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  PRì„ ìƒì„±í•˜ì—¬ Atlantisë¥¼ í†µí•´ Terraform ì½”ë“œë¥¼ ê´€ë¦¬í•´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<h3 id="atlantis-ì‹¤ìŠµ">Atlantis ì‹¤ìŠµ</h3>

<h4 id="ì‘ì—…-1-null-provider">ì‘ì—… 1. null provider</h4>

<ul>
  <li>
    <p>Localì—ì„œ git ì½”ë“œ ì‘ì—…</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># git clone</span>
<span class="nv">$ </span>git clone https://github.com/sweetlittlebird/terraform-atlantis-test <span class="o">&amp;&amp;</span> <span class="nb">cd </span>terraform-atlantis-test <span class="o">&amp;&amp;</span> tree
  
<span class="c"># feature branch ìƒì„±</span>
<span class="nv">$ </span>git branch <span class="nb">test</span> <span class="o">&amp;&amp;</span> git checkout <span class="nb">test</span> <span class="o">&amp;&amp;</span> git branch
  
<span class="c"># main.tf íŒŒì¼ ì‘ì„±</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'resource "null_resource" "example" {}'</span> <span class="o">&gt;</span> main.tf
  
<span class="c"># add commit push</span>
<span class="nv">$ </span>git add main.tf <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"add main.tf"</span> <span class="o">&amp;&amp;</span> git push origin <span class="nb">test</span> 
</code></pre></div>    </div>
  </li>
  <li>
    <p>Github PR ìƒì„± =&gt; Atlantis í™•ì¸</p>
    <ul>
      <li>ì„œë²„ì—ì„œ ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 watch <span class="nt">-n</span> 1 tree /home/atlantis/.atlantis
</code></pre></div>        </div>
      </li>
      <li>Github ì—ì„œ Compare &amp; Pull requestë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_3.png" alt="img.png" /></li>
      <li>Create pull request : title ( create null resource )
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_4.png" alt="img.png" /></li>
      <li>plan ìë™ ìˆ˜í–‰ í™•ì¸
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_5.png" alt="img.png" />
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_6.png" alt="img.png" /></li>
      <li>ì„œë²„ ëª¨ë‹ˆí„°ë§ ê²°ê³¼ init ê³¼ plan ì´ ì‹¤í–‰ëœê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 watch <span class="nt">-n</span> 1 tree /home/atlantis/.atlantis    
<span class="c"># =&gt; /home/atlantis/.atlantis</span>
<span class="c">#    â”œâ”€â”€ atlantis.db</span>
<span class="c">#    â”œâ”€â”€ bin</span>
<span class="c">#    â”œâ”€â”€ plugin-cache</span>
<span class="c">#    â”‚   â””â”€â”€ registry.terraform.io</span>
<span class="c">#    â”‚       â””â”€â”€ hashicorp</span>
<span class="c">#    â”‚           â””â”€â”€ null</span>
<span class="c">#    â”‚               â””â”€â”€ 3.2.2</span>
<span class="c">#    â”‚                   â””â”€â”€ linux_amd64</span>
<span class="c">#    â”‚                       â””â”€â”€ terraform-provider-null_v3.2.2_x5</span>
<span class="c">#    â””â”€â”€ repos</span>
<span class="c">#        â””â”€â”€ sweetlittlebird</span>
<span class="c">#            â””â”€â”€ terraform-atlantis-test</span>
<span class="c">#                â””â”€â”€ 2</span>
<span class="c">#                    â””â”€â”€ default</span>
<span class="c">#                        â”œâ”€â”€ default.tfplan</span>
<span class="c">#                        â””â”€â”€ main.tf                                        </span>
    
<span class="c"># github repoì—ì„œ ì½”ë“œë¥¼ ê°€ì ¸ì˜¨ê²ƒì„ í™•ì¸                          </span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 <span class="nb">cat</span> /home/atlantis/.atlantis/repos/sweetlittlebird/terraform-atlantis-test/2/default/main.tf
</code></pre></div>        </div>
      </li>
      <li>PR ì½”ë©˜íŠ¸ì— ì´ê²ƒì €ê²ƒ ëª…ë ¹ì„ ë„£ì–´ë´…ë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_7.png" alt="20240711_terraform_w5_atlantis_7.png" />
        <ul>
          <li><code class="language-plaintext highlighter-rouge">atlantis help</code>ëŠ” ì‘ë‹µì´ ì˜¤ì§€ë§Œ <code class="language-plaintext highlighter-rouge">cat /etc/passwd</code>ëŠ” ë°˜ì‘ì´ ì—†ìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>PR ì½”ë©˜íŠ¸ì— ëª…ë ¹ì„ ì¡°í•©í•´ì„œ ì†ì´ë ¤ê³  í•´ë„ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_8.png" alt="20240711_terraform_w5_atlantis_8.png" /></li>
      <li>ì´ì œ apply í•´ë³´ê² ìŠµë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>atlantis plan <span class="nt">-d</span> <span class="nb">.</span>
atlantis apply <span class="nt">-d</span> <span class="nb">.</span>
</code></pre></div>        </div>
        <p><img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_9.png" alt="20240711_terraform_w5_atlantis_9.png" /></p>
      </li>
      <li>ì•„í‹€ë€í‹°ìŠ¤ ì›¹ì—ì„œ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_10.png" alt="img.png" /></li>
      <li>planê³¼ applyê°€ ì˜ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ë§Œì•½ Locksì— í•­ëª©ì´ ìˆê³ , ì–´ë–¤ ì˜ë„ì—ì„œë“  planì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ê³  ì‹¶ë‹¤ë©´ í´ë¦­í•´ì„œ <strong>Discard Plan &amp; Unlock</strong> í•˜ì‹­ì‹œì˜¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Lock ëœ planìœ¼ë¡œ apply ë©ë‹ˆë‹¤. pull requestë¥¼ merge í•˜ë©´ Lock ì´ í•´ì œë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h5 id="atlantisì˜-auto-plan-manual-plan-apply">atlantisì˜ Auto plan, Manual plan, Apply</h5>

<ul>
  <li>auto plan
    <ul>
      <li>AtlantisëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìë™ìœ¼ë¡œ planì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>manual plan
    <ul>
      <li>variableì˜ ê°’ì„ ë„˜ê¸°ê±°ë‚˜ í•˜ê³  ì‹¶ë‹¤ë©´ ìˆ˜ë™ plan ì‹¤í–‰ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
      <li>PR ì½”ë©˜íŠ¸ì— ë‹¤ìŒ ëª…ë ¹ë“¤ì„ ì‹¤í–‰í•˜ë©´ ìˆ˜ë™ planì´ ì‹¤í–‰ë©ë‹ˆë‹¤. (ë‹¨, Lockì´ ê±¸ë ¤ìˆì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.)
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>atlantis plan <span class="nt">-d</span> <span class="nb">dir</span>      <span class="c"># ë””ë ‰í„°ë¦¬</span>
atlantis plan <span class="nt">-w</span> staging  <span class="c"># ì›Œí¬ìŠ¤í˜ì´ìŠ¤</span>
atlantis plan <span class="nt">--</span> <span class="nt">-target</span><span class="o">=</span>resource <span class="nt">-var</span> <span class="s1">'foo=bar'</span>  <span class="c"># -varë¡œ variable ê°’ ë„˜ê¸°ê¸°</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>apply
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>atlantis apply             <span class="c"># ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ì—ì„œ ì‹¤í–‰</span>
atlantis apply <span class="nt">-d</span> <span class="nb">dir</span>      <span class="c"># ë””ë ‰í„°ë¦¬</span>
atlantis apply <span class="nt">-w</span> staging  <span class="c"># ì›Œí¬ìŠ¤í˜ì´ìŠ¤</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="ì‘ì—…-2-aws-iam-user-ìƒì„±">ì‘ì—… 2. aws iam user ìƒì„±</h4>

<ul>
  <li>AWS S3 ë²„í‚· ìƒì„± : Terraform Backend state ì €ì¥ìš©ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws s3 <span class="nb">ls</span> 
  
<span class="c"># aws s3 mb s3://&lt;ìœ ì¼í•œ ì‚¬ìš©í•  S3 ë²„í‚·ëª…&gt; --region ap-northeast-2</span>
aws s3 mb s3://sweetlittlebird-terraform-state <span class="nt">--region</span> ap-northeast-2 <span class="c"># S3 ë²„í‚· ìƒì„±</span>
  
aws s3 <span class="nb">ls</span>  <span class="c"># ìƒì„± í™•ì¸</span>
</code></pre></div>    </div>
  </li>
  <li>Localì—ì„œ Git ì½”ë“œ ì‘ì—…
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># feature branch ìƒì„±</span>
<span class="nv">$ </span>git branch iam <span class="o">&amp;&amp;</span> git checkout iam <span class="o">&amp;&amp;</span> git branch
  
<span class="c"># ë””ë ‰í„°ë¦¬ ìƒì„±</span>
<span class="nv">$ </span><span class="nb">mkdir </span>iam <span class="o">&amp;&amp;</span> <span class="nb">cd </span>iam
  
<span class="c"># main.tf íŒŒì¼ ì‘ì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt; main.tf
terraform {
  backend "s3" {
    bucket = "sweetlittlebird-terraform-state"  # ì•ì„œ ìƒì„±í•œ S3 ë²„í‚·ëª…
    key    = "terraform.tfstate"
    region = "ap-northeast-2"
  }
}
         
provider "aws" {
  region = "ap-southeast-1"
}  
  
resource "aws_iam_user" "myuser" {
  name = "t101user"
}
</span><span class="no">EOF
  
</span><span class="c"># add commit push</span>
git add main.tf <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"add main.tf"</span> <span class="o">&amp;&amp;</span> git push origin iam
</code></pre></div>    </div>
  </li>
  <li>Githubì—ì„œ PR ìƒì„± ë° Atlantis í™•ì¸
    <ul>
      <li>ì„œë²„ì—ì„œ ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 watch <span class="nt">-n</span> 1 tree /home/atlantis/.atlantis
</code></pre></div>        </div>
      </li>
      <li>Github ì—ì„œ Compare &amp; Pull requestë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</li>
      <li>Create pull request : title ( create iam user )</li>
      <li>plan ìë™ ìˆ˜í–‰ í™•ì¸</li>
      <li>ì„œë²„ ëª¨ë‹ˆí„°ë§ ê²°ê³¼ init ê³¼ plan ì´ ì‹¤í–‰ëœê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 watch <span class="nt">-n</span> 1 tree /home/atlantis/.atlantis
    
<span class="c"># =&gt; /home/atlantis/.atlantis</span>
<span class="c">#    ...</span>
<span class="c">#    â””â”€â”€ repos</span>
<span class="c">#        â””â”€â”€ sweetlittlebird</span>
<span class="c">#            â””â”€â”€ terraform-atlantis-test</span>
<span class="c">#                â””â”€â”€ 3</span>
<span class="c">#                    â””â”€â”€ default</span>
<span class="c">#                        â”œâ”€â”€ iam</span>
<span class="c">#                        â”‚   â”œâ”€â”€ default.tfplan</span>
<span class="c">#                        â”‚   â””â”€â”€ main.tf</span>
<span class="c">#                        â””â”€â”€ main.tf</span>
    
<span class="c"># github repoì—ì„œ ì½”ë“œë¥¼ ê°€ì ¸ì˜¨ê²ƒì„ í™•ì¸                          </span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 <span class="nb">cat</span> /home/atlantis/.atlantis/repos/sweetlittlebird/terraform-atlantis-test/3/default/iam/main.tf
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>S3 ë²„í‚· í™•ì¸
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://sweetlittlebird-terraform-state
<span class="c"># =&gt; 2024-07-XX 00:00:00        180 terraform.tfstate  </span>
</code></pre></div>    </div>
  </li>
  <li>apply í•˜ê¸°
    <ul>
      <li>PR ì½”ë©˜íŠ¸ì— ì•„ë˜ì˜ ëª…ë ¹ì„ ë„£ì–´ apply í•©ë‹ˆë‹¤.
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>atlantis plan <span class="nt">-d</span> iam
    
atlantis apply <span class="nt">-d</span> iam
</code></pre></div>        </div>
        <p><img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_12.png" alt="img.png" /></p>
      </li>
    </ul>
  </li>
  <li>S3 ë²„í‚· í™•ì¸ - apply í•˜ë©´ì„œ ì ìš©ëœ ìµœì¢… ìƒíƒœê°’ì„ ì €ì¥í•˜ì—¬ í¬ê¸°ê°€ ì»¤ì§„ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://sweetlittlebird-terraform-state
<span class="c"># =&gt; 2024-07-14 02:12:56        862 terraform.tfstate</span>
</code></pre></div>    </div>
  </li>
  <li>Atlantis ì›¹ì—ì„œ apply ë¨ì„ í™•ì¸í•©ë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_11.png" alt="img.png" /></li>
  <li>Merge Pull request =&gt; Confirm merge
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 watch <span class="nt">-n</span> 1 tree /home/atlantis/.atlantis
  
<span class="c"># =&gt; /home/atlantis/.atlantis</span>
<span class="c">#    ...</span>
<span class="c">#    â””â”€â”€ repos</span>
<span class="c">#        â””â”€â”€ sweetlittlebird</span>
<span class="c">#            â””â”€â”€ terraform-atlantis-test</span>
</code></pre></div>    </div>
    <p>terraform-atlantis-test ì´í•˜ì˜ ë””ë ‰í„°ë¦¬ì™€ íŒŒì¼ë“¤ì´ ì •ë¦¬ë˜ì–´ ì‚­ì œëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>Merge requestëœ ì‚¬í•­ì„ Local git main ì—ì„œ pull ë°›ì•„ì„œ í™•ì¸í•©ë‹ˆë‹¤.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git checkout main
<span class="nv">$ </span>git pull origin main
<span class="nv">$ </span><span class="nb">cd</span> ..
<span class="nv">$ </span>tree
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="ì‘ì—…-3-ì‘ì—…-2ì—ì„œ-ìƒì„±í•œ-ë¦¬ì†ŒìŠ¤-ì‚­ì œ">ì‘ì—… 3. ì‘ì—… 2ì—ì„œ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</h4>
<ul>
  <li>Localì—ì„œ Git ì½”ë“œ ì‘ì—…
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># feature branch ìƒì„±</span>
git branch deleteiam <span class="o">&amp;&amp;</span> git checkout deleteiam <span class="o">&amp;&amp;</span> git branch
  
<span class="c"># ë””ë ‰í„°ë¦¬ ìƒì„±</span>
<span class="nb">mkdir </span>deleteiam <span class="o">&amp;&amp;</span> <span class="nb">cd </span>deleteiam
  
<span class="c"># main.tf íŒŒì¼ ì‘ì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt; main.tf
terraform {
  backend "s3" {
    bucket = "sweetlittlebird-terraform-state"  # ì•ì„œ ìƒì„±í•œ S3 ë²„í‚·ëª…
    key    = "terraform.tfstate"
    region = "ap-northeast-2"
  }
}
</span><span class="no">EOF
  
</span><span class="c"># add commit push</span>
git add main.tf <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"add main.tf"</span> <span class="o">&amp;&amp;</span> git push origin deleteiam
</code></pre></div>    </div>
  </li>
  <li>Githubì—ì„œ PR ìƒì„± ë° Atlantis í™•ì¸
    <ul>
      <li>ì„œë²„ì—ì„œ ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 watch <span class="nt">-n</span> 1 tree /home/atlantis/.atlantis
</code></pre></div>        </div>
      </li>
      <li>Github ì—ì„œ Compare &amp; Pull requestë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</li>
      <li>Create pull request : title ( delete iam user )</li>
      <li>plan ìë™ ìˆ˜í–‰ í™•ì¸
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_13.png" alt="20240711_terraform_w5_atlantis_13.png" /></li>
      <li>ì„œë²„ ëª¨ë‹ˆí„°ë§ ê²°ê³¼ init ê³¼ plan ì´ ì‹¤í–‰ëœê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 watch <span class="nt">-n</span> 1 tree /home/atlantis/.atlantis
    
<span class="c"># =&gt; /home/atlantis/.atlantis</span>
<span class="c">#    ...</span>
<span class="c">#    â””â”€â”€ repos</span>
<span class="c">#        â””â”€â”€ sweetlittlebird</span>
<span class="c">#            â””â”€â”€ terraform-atlantis-test</span>
<span class="c">#                â””â”€â”€ 4</span>
<span class="c">#                    â””â”€â”€ default</span>
<span class="c">#                        â”œâ”€â”€ deleteiam</span>
<span class="c">#                        â”‚   â”œâ”€â”€ default.tfplan</span>
<span class="c">#                        â”‚   â””â”€â”€ main.tf</span>
<span class="c">#                        â”œâ”€â”€ iam</span>
<span class="c">#                        â”‚   â””â”€â”€ main.tf</span>
<span class="c">#                        â””â”€â”€ main.tf</span>
    
<span class="c"># github repoì—ì„œ ì½”ë“œë¥¼ ê°€ì ¸ì˜¨ê²ƒì„ í™•ì¸                          </span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 <span class="nb">cat</span> /home/atlantis/.atlantis/repos/sweetlittlebird/terraform-atlantis-test/4/default/deleteiam/main.tf
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>S3 ë²„í‚· í™•ì¸
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://sweetlittlebird-terraform-state
<span class="c"># =&gt; 2024-07-14 02:12:56        862 terraform.tfstate</span>
</code></pre></div>    </div>
  </li>
  <li>apply í•˜ê¸°
    <ul>
      <li>PR ì½”ë©˜íŠ¸ì— ì•„ë˜ì˜ ëª…ë ¹ì„ ë„£ì–´ apply í•©ë‹ˆë‹¤.
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>atlantis apply <span class="nt">-d</span> deleteiam
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>AWS ì½˜ì†”ì—ì„œ IAMì´ ì‚­ì œë¨ì„ í™•ì¸í•©ë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_15.png" alt="20240711_terraform_w5_atlantis_15.png" /></li>
  <li>S3 ë²„í‚· í™•ì¸ - apply í•˜ë©´ì„œ ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ì–´ ìƒíƒœíŒŒì¼ í¬ê¸°ê°€ ì¤„ì–´ë“ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://sweetlittlebird-terraform-state
<span class="c"># =&gt; 2024-07-14 02:35:09        180 terraform.tfstate</span>
</code></pre></div>    </div>
  </li>
  <li>Atlantis ì›¹ì—ì„œ apply ë¨ì„ í™•ì¸í•©ë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240711_terraform_w5_atlantis_14.png" alt="img.png" /></li>
  <li>Merge Pull request =&gt; Confirm merge
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> docker-atlantis-1 watch <span class="nt">-n</span> 1 tree /home/atlantis/.atlantis
  
<span class="c"># =&gt; /home/atlantis/.atlantis</span>
<span class="c">#    ...</span>
<span class="c">#    â””â”€â”€ repos</span>
<span class="c">#        â””â”€â”€ sweetlittlebird</span>
<span class="c">#            â””â”€â”€ terraform-atlantis-test</span>
</code></pre></div>    </div>
    <p>terraform-atlantis-test ì´í•˜ì˜ ë””ë ‰í„°ë¦¬ì™€ íŒŒì¼ë“¤ì´ ì •ë¦¬ë˜ì–´ ì‚­ì œëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>Merge requestëœ ì‚¬í•­ì„ Local git main ì—ì„œ pull ë°›ì•„ì„œ í™•ì¸í•©ë‹ˆë‹¤.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git checkout main <span class="o">&amp;&amp;</span> git pull <span class="o">&amp;&amp;</span> <span class="nb">cd</span> .. <span class="o">&amp;&amp;</span> tree
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì´ìƒê³¼ ê°™ì´ Atlantisë¥¼ ì‚¬ìš©í•˜ì—¬ Terraform ì½”ë“œë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
íŒ€ìœ¼ë¡œ ì‘ì—…ì„ í•  ë•Œ ì°¸ ìœ ìš©í•œ ê¸°ëŠ¥ì¸ê²ƒ ê°™ìŠµë‹ˆë‹¤. 
ë˜í•œ ì´ë²ˆì£¼ ìŠ¤í„°ë””ë¥¼ í†µí•´ Terraformì˜ ìƒíƒœê³„ê°€ ì°¸ ë‹¤ì–‘í•˜ê³  í¬êµ¬ë‚˜ í•˜ëŠ”ê²ƒì„ ëŠê¼ˆìŠµë‹ˆë‹¤.</p>

<p>ê³µë¶€í•  ìˆ˜ë¡ ì…ë¬¸í•˜ê¸°ëŠ” ì‰½ì§€ë§Œ ë§ˆìŠ¤í„°í•˜ê¸°ëŠ” ì–´ë µë‹¤ëŠ”ê²ƒì„ ëŠë‚ë‹ˆë‹¤.
â€”ì• ì´ˆì— ë§ˆìŠ¤í„°í•œë‹¤ë¼ëŠ” ê°œë…ì´ ì¡´ì¬í•˜ëŠ”ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤â€”
ê³„ì† ê³µë¶€í•˜ê³  ì ìš©í•˜ê³  ë°˜ë³µí•˜ëŠ”ê²ƒì´ ì¤‘ìš”í•œê²ƒ ê°™ë‹¤ë¼ëŠ”ê²ƒì„ 
ì´ë²ˆ T101 4ê¸° ìŠ¤í„°ë””ë¥¼ í†µí•´ ë‹¤ì‹œ í•œë²ˆ ëŠë‚ë‹ˆë‹¤.</p>

<p>ê¸°ë³¸ ìƒíƒœì—ì„œëŠ” ëˆ„êµ¬ë‚˜ Atlantis í˜ì´ì§€ì— ì ‘ì†í•´ì„œ ì´ë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ì„œ
ì—¼ë ¤ë˜ëŠ”ë° í•´ë‹¹ ë¶€ë¶„ì— ëŒ€í•´  ë³´ì™„í•  ë°©ë²•ì„ ì¡°ê¸ˆë” ì°¾ì•„ë´ì•¼ í• ê²ƒ ê°™ìŠµë‹ˆë‹¤.
ì´ë²ˆ ì£¼ ìˆ˜ì—…ë„ ê¸°ëŒ€ë©ë‹ˆë‹¤. ì™„ì£¼ê¹Œì§€ í™”ì´íŒ…ì…ë‹ˆë‹¤.</p>]]></content><author><name></name></author><category term="terraform" /><category term="terraform," /><category term="cloud," /><category term="aws" /><summary type="html"><![CDATA[ì´ë²ˆ ì£¼ì—ëŠ” Moduleê³¼ Runnerì— ëŒ€í•´ í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaCë¥¼ í†µí•´ ì•Œì•„ ë³´ëŠ” ì¤‘ì…ë‹ˆë‹¤. ê³„ì†í•´ì„œ Terraform Runnerì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[T101 4ê¸°] Module</title><link href="https://sweetlittlebird.github.io/posts/2024-07-10-T101-Study-Terraform-Week-5/" rel="alternate" type="text/html" title="[T101 4ê¸°] Module" /><published>2024-07-10T02:08:00+09:00</published><updated>2024-07-10T02:08:00+09:00</updated><id>https://sweetlittlebird.github.io/posts/T101%20Study%20-%20Terraform%20Week%205</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-07-10-T101-Study-Terraform-Week-5/"><![CDATA[<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì´ë²ˆ ì£¼ì—ëŠ” <code class="language-plaintext highlighter-rouge">Module</code>ê³¼ <code class="language-plaintext highlighter-rouge">Runner</code>ì— ëŒ€í•´
<a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a>ë¥¼ í†µí•´ ì•Œì•„ ë³´ê² ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" /></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a></p>
</blockquote>

<h2 id="module">Module</h2>

<h3 id="moduleì˜-ê°œìš”">Moduleì˜ ê°œìš”</h3>

<p>í…Œë¼í¼ìœ¼ë¡œ ì¸í”„ë¼ì™€ ì„œë¹„ìŠ¤ë¥¼ ì˜¤ëœ ê¸°ê°„ ê´€ë¦¬í•˜ë‹¤ë³´ë©´ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ëŠ˜ì–´ë‚˜ë©´ì„œ êµ¬ì„±ì´ ë³µì¡í•´ì§‘ë‹ˆë‹¤. ë§ˆì¹˜ í•¨ìˆ˜ í•˜ë‚˜ê°€ ìˆ˜ì²œì¤„ ì½”ë“œë¡œ êµ¬ì„±ëœ C ì½”ë“œì²˜ëŸ¼, ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p>
<ol>
  <li>ì›í•˜ëŠ” í•­ëª©ì„ ì°¾ê¸° ì–´ë µê³ , ìˆ˜ì •í•˜ê¸° ì–´ë ¤ì›Œì§</li>
  <li>ë¦¬ì†ŒìŠ¤ê°„ì˜ ì—°ê´€ ê´€ê³„ê°€ ë³µì¡í•´ì ¸ì„œ ìˆ˜ì •í•˜ê¸° ì–´ë ¤ì›Œì§</li>
  <li>ê°œë°œ/ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜ í™˜ê²½ë“±ìœ¼ë¡œ êµ¬ë¶„ëœ ê²½ìš° ì½”ë“œ ì¤‘ë³µìœ¼ë¡œ ì—…ë¬´íš¨ìœ¨ì´ ì¤„ì–´ë“¬</li>
  <li>ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•  ê²½ìš° ê¸°ì¡´ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ ìˆ˜ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰ë˜ì–´ ì½”ë“œ ì¤‘ë³µì´ ë°œìƒí•˜ê³  ì¢…ì†ì„± íŒŒì•…ì´ ì–´ë ¤ì›€</li>
</ol>

<p>ëª¨ë“ˆì€ í…Œë¼í¼ ì½”ë“œë¥¼ <strong>êµ¬ì¡°í™”</strong>í•˜ê³  <strong>ì¬ì‚¬ìš© ê°€ëŠ¥</strong>í•œ ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆê²Œ í•˜ì—¬ ì´ëŸ¬í•œ <strong>ë¬¸ì œì ë“¤ì„ í•´ì†Œ</strong>í•´ì¤ë‹ˆë‹¤.</p>

<p><img src="/assets/2024/t101-4th/20240711_terraform_w5_module.png" alt="ëª¨ë“ˆê³¼ ëª¨ë“ˆê°„ ì •ì˜ë¥¼ í†µí•œ í”„ë¡œë¹„ì €ë‹ ê³¼ì •" class="image-center" />
<em class="image-caption">ëª¨ë“ˆê³¼ ëª¨ë“ˆê°„ ì •ì˜ë¥¼ í†µí•œ í”„ë¡œë¹„ì €ë‹ ê³¼ì •</em></p>

<p>ëª¨ë“ˆì„ í†µí•œ í”„ë¡œë¹„ì €ë‹ ê³¼ì •ì€ ìœ„ì™€ ê°™ìœ¼ë©°, ë£¨íŠ¸ ëª¨ë“ˆì´ ìì‹ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡œë¹„ì €ë‹ì„ í•˜ê²Œ ë˜ëŠ”ë° ì´ êµ¬ì¡°ì— ëŒ€í•´ ì‚´í´ ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h4 id="moduleì˜-êµ¬ì„±">Moduleì˜ êµ¬ì„±</h4>

<p>ëª¨ë“ˆì€ í¬ê²Œ ë£¨íŠ¸ ëª¨ë“ˆê³¼ ìì‹ ëª¨ë“ˆë¡œ ë‚˜ë‰©ë‹ˆë‹¤.</p>

<ul>
  <li>ë£¨íŠ¸ ëª¨ë“ˆ (Root Module) : í…Œë¼í¼ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ìµœìƒìœ„ ëª¨ë“ˆ</li>
  <li>ìì‹ ëª¨ë“ˆ (Child Module) : ë£¨íŠ¸ ëª¨ë“ˆì—ì„œ í˜¸ì¶œë˜ëŠ” ëª¨ë“ˆ</li>
</ul>

<p>ëª¨ë“ˆì€ ë£¨íŠ¸ ëª¨ë“ˆê³¼ ìì‹ ëª¨ë“ˆì€ ëª¨ë‘ <strong>ì…ë ¥ ë³€ìˆ˜</strong>ë¥¼ ë°›ì•„ì„œ Providerë¥¼ í†µí•´ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ í•˜ê³  <strong>ê²°ê³¼ë¥¼ ì¶œë ¥</strong>í•˜ëŠ” êµ¬ì¡°ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.</p>

<p><img src="/assets/2024/t101-4th/20240711_terraform_w5_module_root_module.png" alt="20240711_terraform_w5_module_root_module.png" class="image-center" />
<em class="image-caption">ëª¨ë“ˆì˜ ê¸°ë³¸ êµ¬ì¡°</em></p>

<p>ìœ„ì˜ ê·¸ë¦¼ì²˜ëŸ¼ ëª¨ë“ˆì€ ë ˆê³  ë¸”ëŸ­ê°™ì´ ì—¬ëŸ¬ê°œë¥¼ ì¡°í•©í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë£¨íŠ¸ ëª¨ë“ˆì€ ìì‹ ëª¨ë“ˆì„ í˜¸ì¶œí•˜ê³ , ìì‹ ëª¨ë“ˆì€ ë‹¤ë¥¸ ìì‹ ëª¨ë“ˆì„ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ë ‡ê²Œ ëª¨ë“ˆë¡œ ë§Œë“œëŠ”ê²ƒì„ <strong>ëª¨ë“ˆí™”</strong>ë¼ê³  í•˜ë©°, ì´ë¥¼ í†µí•´ ì¬ì‚¬ìš©ì„±ê³¼ í‘œì¤€í™”ëœ êµ¬ì¡°ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/2024/t101-4th/20240711_terraform_w5_module_composite.png" alt="20240711_terraform_w5_module_composite.png" class="image-center" />
<em class="image-caption">ë£¨íŠ¸ ëª¨ë“ˆê³¼ ìì‹ ëª¨ë“ˆ</em></p>

<p>ë˜í•œ  ê¸°ì¡´ì— ì‘ì„±ëœ ëª¨ë“ˆì„ ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì°¸ì¡°í•´ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ë¦¬ì†ŒìŠ¤ì™€ ìœ ì‚¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h4 id="moduleì˜-ì¥ì ">Moduleì˜ ì¥ì </h4>

<p>ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ê´€ë¦¬ì„± : ì½”ë“œë¥¼ êµ¬ì¡°í™”í•˜ì—¬ ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ì¶”ê°€í•˜ê±°ë‚˜ ì‚­ì œí•˜ê¸° ì‰¬ì›Œ ê´€ë¦¬ê°€ ìš©ì´í•´ì§‘ë‹ˆë‹¤.</li>
  <li>ì¬ì‚¬ìš©ì„± : ëª¨ë“ˆì„ í†µí•´ ì½”ë“œë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆì–´ ê°œë°œ ì‹œê°„ì„ ë‹¨ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ parameterì™€ output ê°’ì„ í†µí•´ ë‹¤ì–‘í•œ ëª©ì ìœ¼ë¡œ ì¬í™œìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
  <li>ìº¡ìŠí™” : ê° ëª¨ë“ˆì€ ë…¼ë¦¬ì ìœ¼ë¡œ ë¬¶ì—¬ì ¸ ë…ë¦½ì ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ ë° ê´€ë¦¬ë˜ë©°, í•„ìš”í•œ í•­ëª©ë§Œ ì™¸ë¶€ì— ë…¸ì¶œ ì‹œì¼œì„œ ë‹¤ë¥¸ ëª¨ë“ˆê³¼ ì˜ì¡´ì„±ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì¼ê´€ì„±ê³¼ í‘œì¤€í™” : ëª¨ë“ˆì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì¤‘ë³µì„ ì¤„ì´ê³ , êµ¬ì„±ì„ ì¼ê´€ì„± ìˆê²Œ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ê²€ì¦ëœ ëª¨ë“ˆì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í‘œì¤€í™”ëœ êµ¬ì„±ì„ ìœ ì§€í•˜ê³  ë³´ì•ˆ ì‚¬ê³ ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<h3 id="ëª¨ë“ˆ-ì‘ì„±ì˜-ê¸°ë³¸-ì›ì¹™">ëª¨ë“ˆ ì‘ì„±ì˜ ê¸°ë³¸ ì›ì¹™</h3>

<p>ëª¨ë“ˆì„ ì œëŒ€ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ ì›ì¹™ì„ ì§€í‚¤ê¸¸ ì¶”ì²œí•©ë‹ˆë‹¤.</p>

<ul>
  <li><strong>ëª¨ë“ˆ ë””ë ‰í„°ë¦¬ í˜•ì‹ì„ <code class="language-plaintext highlighter-rouge">terraform-&lt;í”„ë¡œë°”ì´ë” ì´ë¦„&gt;-&lt;ëª¨ë“ˆ ì´ë¦„&gt;</code> í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°</strong> :
ì´ í˜•ì‹ì€ Terraform Cloud, Terraform Enterpriseì—ì„œë„ ì‚¬ìš©ë˜ëŠ” ë°©ì‹ìœ¼ë¡œ, 
í…Œë¼í¼ì„ ìœ„í•œ ê²ƒì„ì„ ë°íˆê³ , ì–´ë–¤ í”„ë¡œë°”ì´ë” ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€, ì–´ë–¤ ëª¨ë“ˆì¸ì§€ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li><strong>ëª¨ë“ˆì„ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸°</strong> : ë¦¬ëª¨íŠ¸ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ í•˜ìœ„ ëª¨ë“ˆì„ ì„œë¸Œ ë””ë ‰í„°ë¦¬ì— ë‹´ì§€ ì•Šê³ ,
ë…ë¦½ëœ ëª¨ë“ˆë¡œ ì¡´ì¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ”ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œë„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ ,
VCSë¥¼ í†µí•´ ë²„ì „ê´€ë¦¬í•˜ê¸°ë„ ìˆ˜ì›”í•©ë‹ˆë‹¤.</li>
  <li><strong>ëª¨ë“ˆ ë””ë ‰í„°ë¦¬ ë‚´ì— <code class="language-plaintext highlighter-rouge">main.tf</code>, <code class="language-plaintext highlighter-rouge">variables.tf</code>, <code class="language-plaintext highlighter-rouge">outputs.tf</code> íŒŒì¼ì„ í¬í•¨í•˜ê¸°</strong> :
ì´ íŒŒì¼ë“¤ì€ í…Œë¼í¼ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” íŒŒì¼ë“¤ë¡œ, ëª¨ë“ˆì„ ì‚¬ìš©í•˜ëŠ” ì‚¬ëŒì´ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.</li>
  <li><strong>ì–¸ì œë‚˜ ëª¨ë“ˆí™”ê°€ ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ ì‘ì„±í•˜ê¸°</strong> : í…Œë¼í¼ ë¦¬ì†ŒìŠ¤ êµ¬ì„± íŒŒì¼ì„ ì‘ì„±ì‹œ í•­ìƒ ëª¨ë“ˆí™” í•  ê°€ëŠ¥ì„±ì„ ì—¼ë‘í•´ë‘ê³ <br />
ì‘ì„±í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë¦¬ì†ŒìŠ¤ êµ¬ì„± íŒŒì¼ì„ ëª¨ë“ˆí™” í•  ë•Œ ì¶”ê°€ì ì¸ ì‘ì—…ì´ ì¤„ì–´ë“¤ê³ , ì¼ê´€ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤ë‹ˆë‹¤.</li>
</ul>

<p>ì´ì™¸ì—ë„ <strong>ê³µê°œëœ í…Œë¼í¼ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì˜ ëª¨ë“ˆ ì°¸ê³ í•˜ê¸°</strong>, <strong>ì‘ì„±ëœ ëª¨ë“ˆì„ íŒ€ ë˜ëŠ” ì»¤ë®¤ë‹ˆí‹°ì™€ ê³µìœ í•˜ê¸°</strong>ë„ ì¶”ì²œí•©ë‹ˆë‹¤.</p>

<p>ëª¨ë“ˆì„ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë£¨íŠ¸ ëª¨ë“ˆì˜ í•˜ìœ„ ë””ë ‰í„°ë¦¬ì— ë‘ê¸° ë³´ë‹¤ëŠ”,
ë£¨íŠ¸ ëª¨ë“ˆê³¼ ê°™ì€ ë ˆë²¨ì— <code class="language-plaintext highlighter-rouge">modules</code> ë””ë ‰í„°ë¦¬ë¥¼ ë‘ê³ , ì•„ë˜ì— ê°ê°ì˜ ëª¨ë“ˆì„ ê´€ë¦¬í•˜ê¸°ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.
ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 06-module-training
 â”œâ”€â”€ modules                    <span class="c"># child module home</span>
 â”‚   â””â”€â”€ terraform-random-pwgen
 â”‚       â”œâ”€â”€ main.tf
 â”‚       â”œâ”€â”€ outputs.tf
 â”‚       â””â”€â”€ variables.tf
 â””â”€â”€ 06-01-basic                <span class="c"># root-module</span>
     â””â”€â”€ main.tf
</code></pre></div></div>

<h3 id="ëª¨ë“ˆí™”-í•´ë³´ê¸°">ëª¨ë“ˆí™” í•´ë³´ê¸°</h3>

<h4 id="ì‹¤ìŠµ-1-ë¹„ë°€ë²ˆí˜¸-ìƒì„±í•˜ê¸°">ì‹¤ìŠµ 1. ë¹„ë°€ë²ˆí˜¸ ìƒì„±í•˜ê¸°</h4>

<p>ëª¨ë“ˆì„ ë§Œë“œëŠ” ê²ƒì„ ì‹¤ìŠµí•˜ê¸° ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ëŠ” ëª¨ë“ˆì„ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>06-module-training/modules/terraform-random-pwgen/ ë””ë ‰í„°ë¦¬ì— main.tf, variable.tf, output.tf íŒŒì¼ì„ ìƒì„±
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"random_pet"</span> <span class="s2">"name"</span> <span class="p">{</span>
  <span class="nx">keepers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">ami_id</span> <span class="p">=</span> <span class="nx">timestamp</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"random_password"</span> <span class="s2">"password"</span> <span class="p">{</span>
  <span class="nx">length</span>           <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">isDB</span> <span class="err">?</span> <span class="mi">16</span> <span class="err">:</span> <span class="mi">10</span>
  <span class="nx">special</span>          <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">isDB</span> <span class="err">?</span> <span class="kc">true</span> <span class="err">:</span> <span class="kc">false</span>
  <span class="nx">override_special</span> <span class="p">=</span> <span class="s2">"!#</span><span class="err">$</span><span class="s2">%*?"</span>
<span class="p">}</span> 
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># variable.tf</span>
<span class="k">variable</span> <span class="s2">"isDB"</span> <span class="p">{</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="nx">bool</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="kc">false</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"íŒ¨ìŠ¤ì›Œë“œ ëŒ€ìƒì˜ DB ì—¬ë¶€"</span>
<span class="p">}</span>  
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># output.tf</span>
<span class="k">output</span> <span class="s2">"id"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">random_pet</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"pw"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">nonsensitive</span><span class="p">(</span><span class="nx">random_password</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span> 
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>ìì‹ ëª¨ë“ˆ í…ŒìŠ¤íŠ¸
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan
  
<span class="c"># ë³€ìˆ˜ ì§€ì •ì—†ì´ apply</span>
  
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    id = "awaited-dodo"</span>
<span class="c">#    pw = "1tz5Cf4cuL"        # var.isDBê°€ ê¸°ë³¸ê°’ false ì—¬ì„œ 10ìë¦¬ ë¹„ë°€ë²ˆí˜¸ê°€ ìƒì„±ë¨</span>
  
<span class="c"># var.isDB=true ë¡œ í•˜ì—¬ apply</span>
  
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span> <span class="nt">-var</span><span class="o">=</span><span class="nv">isDB</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># =&gt; Apply complete! Resources: 2 added, 0 changed, 2 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    id = "flying-gorilla"</span>
<span class="c">#    pw = "8LMyxla5fK$WP8x?"  # var.isDBë¥¼ trueë¡œ ì£¼ì–´ 16ìë¦¬ ë¹„ë°€ë²ˆí˜¸ê°€ ìƒì„±ë¨</span>
  
<span class="c"># ìƒíƒœ í™•ì¸</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show random_pet.name
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"random_pet.name.id"</span> | terraform console
<span class="c"># =&gt; "flying-gorilla"</span>
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"random_pet.name.keepers"</span> | terraform console
<span class="c"># =&gt; tomap({</span>
<span class="c">#      "ami_id" = "2024-07-11T15:04:58Z"</span>
<span class="c">#    })</span>
  
<span class="nv">$ </span>terraform state show random_password.password
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"random_password.password.length"</span> | terraform console
<span class="c"># =&gt; 16</span>
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"random_password.password.special"</span> | terraform console
<span class="c"># =&gt; true</span>
  
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate| <span class="nb">grep </span>result
  
<span class="c"># ìƒíƒœíŒŒì¼ì—ëŠ” í˜„ì¬ module ì— ëŒ€í•œ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module
  
<span class="c"># graph í™•ì¸</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>    </div>
  </li>
</ul>
<div class="graphviz max-w-100 image-center"><svg width="970pt" viewbox="0.00 0.00 970.18 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<polygon fill="white" stroke="none" points="-4,4 -4,-256 966.18,-256 966.18,4 -4,4"></polygon>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="node1" class="node">
<title>[root] provider["registry.terraform.io/hashicorp/random"]</title>
<polygon fill="none" stroke="black" points="353.04,-36 68.35,-18 353.04,0 637.74,-18 353.04,-36"></polygon>
<text text-anchor="middle" x="353.04" y="-12.95" font-family="Times,serif" font-size="14.00">provider["registry.terraform.io/hashicorp/random"]</text>
</g>
<!-- [root] random_password.password (expand) -->
<g id="node2" class="node">
<title>[root] random_password.password (expand)</title>
<polygon fill="none" stroke="black" points="686.29,-108 515.79,-108 515.79,-72 686.29,-72 686.29,-108"></polygon>
<text text-anchor="middle" x="601.04" y="-84.95" font-family="Times,serif" font-size="14.00">random_password.password</text>
</g>
<!-- [root] random_password.password (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge5" class="edge">
<title>[root] random_password.password (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M539.1,-71.52C500.97,-60.75 452.3,-47.02 414.3,-36.29"></path>
<polygon fill="black" stroke="black" points="415.41,-32.97 404.83,-33.62 413.51,-39.7 415.41,-32.97"></polygon>
</g>
<!-- [root] var.isDB -->
<g id="node4" class="node">
<title>[root] var.isDB</title>
<polygon fill="none" stroke="black" points="714.04,-36 656.04,-36 656.04,0 720.04,0 720.04,-30 714.04,-36"></polygon>
<polyline fill="none" stroke="black" points="714.04,-36 714.04,-30"></polyline>
<polyline fill="none" stroke="black" points="720.04,-30 714.04,-30"></polyline>
<text text-anchor="middle" x="688.04" y="-12.95" font-family="Times,serif" font-size="14.00">var.isDB</text>
</g>
<!-- [root] random_password.password (expand)&#45;&gt;[root] var.isDB -->
<g id="edge6" class="edge">
<title>[root] random_password.password (expand)-&gt;[root] var.isDB</title>
<path fill="none" stroke="black" d="M622.55,-71.7C633.11,-63.2 646.02,-52.81 657.58,-43.51"></path>
<polygon fill="black" stroke="black" points="659.71,-46.29 665.31,-37.3 655.32,-40.84 659.71,-46.29"></polygon>
</g>
<!-- [root] random_pet.name (expand) -->
<g id="node3" class="node">
<title>[root] random_pet.name (expand)</title>
<polygon fill="none" stroke="black" points="410.54,-108 295.54,-108 295.54,-72 410.54,-72 410.54,-108"></polygon>
<text text-anchor="middle" x="353.04" y="-84.95" font-family="Times,serif" font-size="14.00">random_pet.name</text>
</g>
<!-- [root] random_pet.name (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge7" class="edge">
<title>[root] random_pet.name (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M353.04,-71.7C353.04,-64.41 353.04,-55.73 353.04,-47.54"></path>
<polygon fill="black" stroke="black" points="356.54,-47.62 353.04,-37.62 349.54,-47.62 356.54,-47.62"></polygon>
</g>
<!-- [root] output.id (expand) -->
<g id="node5" class="node">
<title>[root] output.id (expand)</title>
<ellipse fill="none" stroke="black" cx="103.04" cy="-162" rx="103.04" ry="18"></ellipse>
<text text-anchor="middle" x="103.04" y="-156.95" font-family="Times,serif" font-size="14.00">[root] output.id (expand)</text>
</g>
<!-- [root] output.id (expand)&#45;&gt;[root] random_pet.name (expand) -->
<g id="edge1" class="edge">
<title>[root] output.id (expand)-&gt;[root] random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M156.06,-146.15C193.48,-135.68 243.95,-121.55 284.44,-110.21"></path>
<polygon fill="black" stroke="black" points="285.16,-113.64 293.85,-107.57 283.28,-106.9 285.16,-113.64"></polygon>
</g>
<!-- [root] output.pw (expand) -->
<g id="node6" class="node">
<title>[root] output.pw (expand)</title>
<ellipse fill="none" stroke="black" cx="855.04" cy="-162" rx="107.14" ry="18"></ellipse>
<text text-anchor="middle" x="855.04" y="-156.95" font-family="Times,serif" font-size="14.00">[root] output.pw (expand)</text>
</g>
<!-- [root] output.pw (expand)&#45;&gt;[root] random_password.password (expand) -->
<g id="edge2" class="edge">
<title>[root] output.pw (expand)-&gt;[root] random_password.password (expand)</title>
<path fill="none" stroke="black" d="M800.87,-146.07C764.24,-135.98 715.42,-122.52 675.2,-111.44"></path>
<polygon fill="black" stroke="black" points="676.13,-108.06 665.56,-108.78 674.27,-114.81 676.13,-108.06"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close) -->
<g id="node7" class="node">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)</title>
<ellipse fill="none" stroke="black" cx="477.04" cy="-162" rx="252.49" ry="18"></ellipse>
<text text-anchor="middle" x="477.04" y="-156.95" font-family="Times,serif" font-size="14.00">[root] provider["registry.terraform.io/hashicorp/random"] (close)</text>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] random_password.password (expand) -->
<g id="edge3" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] random_password.password (expand)</title>
<path fill="none" stroke="black" d="M507.7,-143.7C523.64,-134.69 543.35,-123.57 560.53,-113.87"></path>
<polygon fill="black" stroke="black" points="562.01,-117.05 569,-109.09 558.57,-110.96 562.01,-117.05"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] random_pet.name (expand) -->
<g id="edge4" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M446.39,-143.7C430.45,-134.69 410.74,-123.57 393.55,-113.87"></path>
<polygon fill="black" stroke="black" points="395.52,-110.96 385.09,-109.09 392.08,-117.05 395.52,-110.96"></polygon>
</g>
<!-- [root] root -->
<g id="node8" class="node">
<title>[root] root</title>
<ellipse fill="none" stroke="black" cx="477.04" cy="-234" rx="49.3" ry="18"></ellipse>
<text text-anchor="middle" x="477.04" y="-228.95" font-family="Times,serif" font-size="14.00">[root] root</text>
</g>
<!-- [root] root&#45;&gt;[root] output.id (expand) -->
<g id="edge8" class="edge">
<title>[root] root-&gt;[root] output.id (expand)</title>
<path fill="none" stroke="black" d="M433.78,-224.9C372.47,-213.43 259.27,-192.24 182.58,-177.89"></path>
<polygon fill="black" stroke="black" points="183.5,-174.5 173.03,-176.1 182.21,-181.38 183.5,-174.5"></polygon>
</g>
<!-- [root] root&#45;&gt;[root] output.pw (expand) -->
<g id="edge9" class="edge">
<title>[root] root-&gt;[root] output.pw (expand)</title>
<path fill="none" stroke="black" d="M520.41,-224.97C582.05,-213.55 696.13,-192.43 773.78,-178.05"></path>
<polygon fill="black" stroke="black" points="774.28,-181.52 783.48,-176.25 773.01,-174.63 774.28,-181.52"></polygon>
</g>
<!-- [root] root&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close) -->
<g id="edge10" class="edge">
<title>[root] root-&gt;[root] provider["registry.terraform.io/hashicorp/random"] (close)</title>
<path fill="none" stroke="black" d="M477.04,-215.7C477.04,-208.41 477.04,-199.73 477.04,-191.54"></path>
<polygon fill="black" stroke="black" points="480.54,-191.62 477.04,-181.62 473.54,-191.62 480.54,-191.62"></polygon>
</g>
</g>
</svg></div>
<p><em class="image-caption">ëª¨ë“ˆ ê·¸ë˜í”„</em></p>

<h4 id="ì‹¤ìŠµ-2-ë¹„ë°€ë²ˆí˜¸-ìƒì„±í•˜ëŠ”-ëª¨ë“ˆì„-ë£¨íŠ¸-ëª¨ë“ˆì—ì„œ-í˜¸ì¶œí•˜ê¸°">ì‹¤ìŠµ 2. ë¹„ë°€ë²ˆí˜¸ ìƒì„±í•˜ëŠ” ëª¨ë“ˆì„ ë£¨íŠ¸ ëª¨ë“ˆì—ì„œ í˜¸ì¶œí•˜ê¸°</h4>

<ul>
  <li>ìì‹ ëª¨ë“ˆì„ í˜¸ì¶œí•˜ëŠ” Root Module ìƒì„±í•˜ê¸° ìœ„í•´ 06-module-training/06-01-basic/main.tf íŒŒì¼ì„ ìƒì„±
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 06-module-training/06-01-basic/main.tf</span>
<span class="k">module</span> <span class="s2">"mypw1"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-random-pwgen"</span>
<span class="p">}</span>
  
<span class="k">module</span> <span class="s2">"mypw2"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-random-pwgen"</span>
  <span class="nx">isDB</span>   <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"mypw1"</span> <span class="p">{</span>
  <span class="nx">value</span>  <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">mypw1</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"mypw2"</span> <span class="p">{</span>
  <span class="nx">value</span>  <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">mypw2</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>ì‹¤í–‰
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì‹¤í–‰</span>
  
<span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 4 added, 0 changed, 0 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    mypw1 = {</span>
<span class="c">#      "id" = "absolute-goat"</span>
<span class="c">#      "pw" = "yntpOjuyqm"</span>
<span class="c">#    }</span>
<span class="c">#    mypw2 = {</span>
<span class="c">#      "id" = "intense-imp"</span>
<span class="c">#      "pw" = "0IlU7A?uqfKR0P81"</span>
<span class="c">#    } </span>
  
<span class="c"># ìƒíƒœ í™•ì¸</span>
<span class="nv">$ </span>terraform state list
  
<span class="c"># ëª¨ë“ˆì •ë³´ í™•ì¸. </span>
  
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module
<span class="c"># =&gt; "module": "module.mypw1",   # í•˜ìœ„ ëª¨ë“ˆì˜ ì •ë³´ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.	</span>
<span class="c">#    "module": "module.mypw1",</span>
<span class="c">#    "module": "module.mypw2",</span>
<span class="c">#    "module": "module.mypw2",</span>
  
<span class="c"># terraform init ì‹œ ìƒì„±ë˜ëŠ” module.json í™•ì¸</span>
  
<span class="nv">$ </span>tree .terraform
<span class="c"># =&gt; .terraform</span>
<span class="c">#    â”œâ”€â”€ modules</span>
<span class="c">#    â”‚   â””â”€â”€ modules.json</span>
<span class="c">#    â””â”€â”€ ...</span>
  
<span class="c"># module.json ë‚´ìš© í™•ì¸. ëª¨ë“ˆ ì‚¬ìš© ì •ë³´ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.</span>
  
<span class="nv">$ </span><span class="nb">cat</span> .terraform/modules/modules.json | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "Modules": [</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "",</span>
<span class="c">#          "Source": "",</span>
<span class="c">#          "Dir": "."</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "mypw1",</span>
<span class="c">#          "Source": "../modules/terraform-random-pwgen",</span>
<span class="c">#          "Dir": "../modules/terraform-random-pwgen"</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "mypw2",</span>
<span class="c">#          "Source": "../modules/terraform-random-pwgen",</span>
<span class="c">#          "Dir": "../modules/terraform-random-pwgen"</span>
<span class="c">#        }</span>
<span class="c">#      ]</span>
<span class="c">#    }</span>
  
<span class="c"># ìì‹ ëª¨ë“ˆì˜ output ê°’ì€ module.&lt;ëª¨ë“ˆ ì´ë¦„&gt;.&lt;output ì´ë¦„&gt;ìœ¼ë¡œ ì¡°íšŒ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"module.mypw1.id"</span> | terraform console
<span class="c"># =&gt; "absolute-goat"</span>
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"module.mypw2.pw"</span> | terraform console
<span class="c"># =&gt; "0IlU7A?uqfKR0P81"</span>
  
<span class="c"># graph í™•ì¸</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>    </div>
  </li>
</ul>

<div class="graphviz"><svg width="1917pt" viewbox="0.00 0.00 1917.02 476.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 472)">
<polygon fill="white" stroke="none" points="-4,4 -4,-472 1913.02,-472 1913.02,4 -4,4"></polygon>
<!-- [root] module.mypw1.random_password.password (expand) -->
<g id="node1" class="node">
<title>[root] module.mypw1.random_password.password (expand)</title>
<polygon fill="none" stroke="black" points="656.81,-180 396.31,-180 396.31,-144 656.81,-144 656.81,-180"></polygon>
<text text-anchor="middle" x="526.56" y="-156.95" font-family="Times,serif" font-size="14.00">module.mypw1.random_password.password</text>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="node5" class="node">
<title>[root] provider["registry.terraform.io/hashicorp/random"]</title>
<polygon fill="none" stroke="black" points="1030.56,-108 745.86,-90 1030.56,-72 1315.25,-90 1030.56,-108"></polygon>
<text text-anchor="middle" x="1030.56" y="-84.95" font-family="Times,serif" font-size="14.00">provider["registry.terraform.io/hashicorp/random"]</text>
</g>
<!-- [root] module.mypw1.random_password.password (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge6" class="edge">
<title>[root] module.mypw1.random_password.password (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M652.44,-143.52C739.32,-131.45 853.15,-115.64 933.13,-104.53"></path>
<polygon fill="black" stroke="black" points="933.26,-108.05 942.68,-103.2 932.3,-101.11 933.26,-108.05"></polygon>
</g>
<!-- [root] module.mypw1.var.isDB (expand) -->
<g id="node9" class="node">
<title>[root] module.mypw1.var.isDB (expand)</title>
<ellipse fill="none" stroke="black" cx="525.56" cy="-90" rx="163.95" ry="18"></ellipse>
<text text-anchor="middle" x="525.56" y="-84.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1.var.isDB (expand)</text>
</g>
<!-- [root] module.mypw1.random_password.password (expand)&#45;&gt;[root] module.mypw1.var.isDB (expand) -->
<g id="edge5" class="edge">
<title>[root] module.mypw1.random_password.password (expand)-&gt;[root] module.mypw1.var.isDB (expand)</title>
<path fill="none" stroke="black" d="M526.31,-143.7C526.2,-136.41 526.08,-127.73 525.96,-119.54"></path>
<polygon fill="black" stroke="black" points="529.46,-119.57 525.82,-109.62 522.46,-119.67 529.46,-119.57"></polygon>
</g>
<!-- [root] module.mypw1.random_pet.name (expand) -->
<g id="node2" class="node">
<title>[root] module.mypw1.random_pet.name (expand)</title>
<polygon fill="none" stroke="black" points="881.06,-180 676.06,-180 676.06,-144 881.06,-144 881.06,-180"></polygon>
<text text-anchor="middle" x="778.56" y="-156.95" font-family="Times,serif" font-size="14.00">module.mypw1.random_pet.name</text>
</g>
<!-- [root] module.mypw1.random_pet.name (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge8" class="edge">
<title>[root] module.mypw1.random_pet.name (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M841.5,-143.52C880.41,-132.71 930.13,-118.9 968.81,-108.15"></path>
<polygon fill="black" stroke="black" points="969.26,-111.66 977.95,-105.61 967.38,-104.92 969.26,-111.66"></polygon>
</g>
<!-- [root] module.mypw1 (expand) -->
<g id="node10" class="node">
<title>[root] module.mypw1 (expand)</title>
<ellipse fill="none" stroke="black" cx="621.56" cy="-18" rx="128.63" ry="18"></ellipse>
<text text-anchor="middle" x="621.56" y="-12.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1 (expand)</text>
</g>
<!-- [root] module.mypw1.random_pet.name (expand)&#45;&gt;[root] module.mypw1 (expand) -->
<g id="edge7" class="edge">
<title>[root] module.mypw1.random_pet.name (expand)-&gt;[root] module.mypw1 (expand)</title>
<path fill="none" stroke="black" d="M765.18,-143.83C750.1,-125.06 724.31,-94.62 698.56,-72 686.41,-61.33 672.06,-50.94 659.06,-42.23"></path>
<polygon fill="black" stroke="black" points="660.98,-39.31 650.7,-36.75 657.14,-45.16 660.98,-39.31"></polygon>
</g>
<!-- [root] module.mypw2.random_password.password (expand) -->
<g id="node3" class="node">
<title>[root] module.mypw2.random_password.password (expand)</title>
<polygon fill="none" stroke="black" points="1251.81,-180 991.31,-180 991.31,-144 1251.81,-144 1251.81,-180"></polygon>
<text text-anchor="middle" x="1121.56" y="-156.95" font-family="Times,serif" font-size="14.00">module.mypw2.random_password.password</text>
</g>
<!-- [root] module.mypw2.random_password.password (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge15" class="edge">
<title>[root] module.mypw2.random_password.password (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M1099.06,-143.7C1087.37,-134.7 1072.93,-123.6 1060.33,-113.9"></path>
<polygon fill="black" stroke="black" points="1062.8,-111.39 1052.74,-108.07 1058.54,-116.94 1062.8,-111.39"></polygon>
</g>
<!-- [root] module.mypw2.var.isDB (expand) -->
<g id="node14" class="node">
<title>[root] module.mypw2.var.isDB (expand)</title>
<ellipse fill="none" stroke="black" cx="1497.56" cy="-90" rx="163.95" ry="18"></ellipse>
<text text-anchor="middle" x="1497.56" y="-84.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2.var.isDB (expand)</text>
</g>
<!-- [root] module.mypw2.random_password.password (expand)&#45;&gt;[root] module.mypw2.var.isDB (expand) -->
<g id="edge14" class="edge">
<title>[root] module.mypw2.random_password.password (expand)-&gt;[root] module.mypw2.var.isDB (expand)</title>
<path fill="none" stroke="black" d="M1215.47,-143.52C1273.48,-132.72 1347.6,-118.92 1405.31,-108.17"></path>
<polygon fill="black" stroke="black" points="1405.94,-111.62 1415.13,-106.34 1404.66,-104.73 1405.94,-111.62"></polygon>
</g>
<!-- [root] module.mypw2.random_pet.name (expand) -->
<g id="node4" class="node">
<title>[root] module.mypw2.random_pet.name (expand)</title>
<polygon fill="none" stroke="black" points="1679.06,-180 1474.06,-180 1474.06,-144 1679.06,-144 1679.06,-180"></polygon>
<text text-anchor="middle" x="1576.56" y="-156.95" font-family="Times,serif" font-size="14.00">module.mypw2.random_pet.name</text>
</g>
<!-- [root] module.mypw2.random_pet.name (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge17" class="edge">
<title>[root] module.mypw2.random_pet.name (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M1473.86,-147.83C1376.39,-135.34 1230.71,-116.66 1133.25,-104.17"></path>
<polygon fill="black" stroke="black" points="1133.77,-100.7 1123.41,-102.9 1132.88,-107.65 1133.77,-100.7"></polygon>
</g>
<!-- [root] module.mypw2 (expand) -->
<g id="node15" class="node">
<title>[root] module.mypw2 (expand)</title>
<ellipse fill="none" stroke="black" cx="1593.56" cy="-18" rx="128.63" ry="18"></ellipse>
<text text-anchor="middle" x="1593.56" y="-12.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2 (expand)</text>
</g>
<!-- [root] module.mypw2.random_pet.name (expand)&#45;&gt;[root] module.mypw2 (expand) -->
<g id="edge16" class="edge">
<title>[root] module.mypw2.random_pet.name (expand)-&gt;[root] module.mypw2 (expand)</title>
<path fill="none" stroke="black" d="M1628.7,-143.72C1645.02,-135.57 1661.2,-124.01 1670.56,-108 1678.63,-94.18 1678,-86.16 1670.56,-72 1664.07,-59.66 1653.26,-49.63 1641.76,-41.75"></path>
<polygon fill="black" stroke="black" points="1643.63,-38.79 1633.3,-36.44 1639.91,-44.72 1643.63,-38.79"></polygon>
</g>
<!-- [root] module.mypw1 (close) -->
<g id="node6" class="node">
<title>[root] module.mypw1 (close)</title>
<ellipse fill="none" stroke="black" cx="519.56" cy="-306" rx="120.96" ry="18"></ellipse>
<text text-anchor="middle" x="519.56" y="-300.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1 (close)</text>
</g>
<!-- [root] module.mypw1.output.id (expand) -->
<g id="node7" class="node">
<title>[root] module.mypw1.output.id (expand)</title>
<ellipse fill="none" stroke="black" cx="519.56" cy="-234" rx="164.46" ry="18"></ellipse>
<text text-anchor="middle" x="519.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1.output.id (expand)</text>
</g>
<!-- [root] module.mypw1 (close)&#45;&gt;[root] module.mypw1.output.id (expand) -->
<g id="edge1" class="edge">
<title>[root] module.mypw1 (close)-&gt;[root] module.mypw1.output.id (expand)</title>
<path fill="none" stroke="black" d="M519.56,-287.7C519.56,-280.41 519.56,-271.73 519.56,-263.54"></path>
<polygon fill="black" stroke="black" points="523.06,-263.62 519.56,-253.62 516.06,-263.62 523.06,-263.62"></polygon>
</g>
<!-- [root] module.mypw1.output.pw (expand) -->
<g id="node8" class="node">
<title>[root] module.mypw1.output.pw (expand)</title>
<ellipse fill="none" stroke="black" cx="168.56" cy="-234" rx="168.56" ry="18"></ellipse>
<text text-anchor="middle" x="168.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1.output.pw (expand)</text>
</g>
<!-- [root] module.mypw1 (close)&#45;&gt;[root] module.mypw1.output.pw (expand) -->
<g id="edge2" class="edge">
<title>[root] module.mypw1 (close)-&gt;[root] module.mypw1.output.pw (expand)</title>
<path fill="none" stroke="black" d="M449.37,-291C394.11,-279.98 316.75,-264.56 257.22,-252.68"></path>
<polygon fill="black" stroke="black" points="257.92,-249.25 247.42,-250.73 256.55,-256.12 257.92,-249.25"></polygon>
</g>
<!-- [root] module.mypw1.output.id (expand)&#45;&gt;[root] module.mypw1.random_pet.name (expand) -->
<g id="edge3" class="edge">
<title>[root] module.mypw1.output.id (expand)-&gt;[root] module.mypw1.random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M579.3,-216.85C616.17,-206.89 663.79,-194.02 703.23,-183.36"></path>
<polygon fill="black" stroke="black" points="703.92,-186.8 712.66,-180.81 702.1,-180.04 703.92,-186.8"></polygon>
</g>
<!-- [root] module.mypw1.output.pw (expand)&#45;&gt;[root] module.mypw1.random_password.password (expand) -->
<g id="edge4" class="edge">
<title>[root] module.mypw1.output.pw (expand)-&gt;[root] module.mypw1.random_password.password (expand)</title>
<path fill="none" stroke="black" d="M247.12,-217.64C299.7,-207.36 369.38,-193.73 426,-182.66"></path>
<polygon fill="black" stroke="black" points="426.52,-186.13 435.66,-180.77 425.17,-179.26 426.52,-186.13"></polygon>
</g>
<!-- [root] module.mypw1.var.isDB (expand)&#45;&gt;[root] module.mypw1 (expand) -->
<g id="edge9" class="edge">
<title>[root] module.mypw1.var.isDB (expand)-&gt;[root] module.mypw1 (expand)</title>
<path fill="none" stroke="black" d="M549.29,-71.7C561.26,-62.97 575.97,-52.24 588.98,-42.75"></path>
<polygon fill="black" stroke="black" points="590.86,-45.72 596.88,-37 586.73,-40.06 590.86,-45.72"></polygon>
</g>
<!-- [root] module.mypw2 (close) -->
<g id="node11" class="node">
<title>[root] module.mypw2 (close)</title>
<ellipse fill="none" stroke="black" cx="1393.56" cy="-306" rx="120.96" ry="18"></ellipse>
<text text-anchor="middle" x="1393.56" y="-300.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2 (close)</text>
</g>
<!-- [root] module.mypw2.output.id (expand) -->
<g id="node12" class="node">
<title>[root] module.mypw2.output.id (expand)</title>
<ellipse fill="none" stroke="black" cx="1744.56" cy="-234" rx="164.46" ry="18"></ellipse>
<text text-anchor="middle" x="1744.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2.output.id (expand)</text>
</g>
<!-- [root] module.mypw2 (close)&#45;&gt;[root] module.mypw2.output.id (expand) -->
<g id="edge10" class="edge">
<title>[root] module.mypw2 (close)-&gt;[root] module.mypw2.output.id (expand)</title>
<path fill="none" stroke="black" d="M1463.74,-291C1519.19,-279.95 1596.88,-264.45 1656.5,-252.56"></path>
<polygon fill="black" stroke="black" points="1657.18,-255.99 1666.31,-250.61 1655.81,-249.13 1657.18,-255.99"></polygon>
</g>
<!-- [root] module.mypw2.output.pw (expand) -->
<g id="node13" class="node">
<title>[root] module.mypw2.output.pw (expand)</title>
<ellipse fill="none" stroke="black" cx="1393.56" cy="-234" rx="168.56" ry="18"></ellipse>
<text text-anchor="middle" x="1393.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2.output.pw (expand)</text>
</g>
<!-- [root] module.mypw2 (close)&#45;&gt;[root] module.mypw2.output.pw (expand) -->
<g id="edge11" class="edge">
<title>[root] module.mypw2 (close)-&gt;[root] module.mypw2.output.pw (expand)</title>
<path fill="none" stroke="black" d="M1393.56,-287.7C1393.56,-280.41 1393.56,-271.73 1393.56,-263.54"></path>
<polygon fill="black" stroke="black" points="1397.06,-263.62 1393.56,-253.62 1390.06,-263.62 1397.06,-263.62"></polygon>
</g>
<!-- [root] module.mypw2.output.id (expand)&#45;&gt;[root] module.mypw2.random_pet.name (expand) -->
<g id="edge12" class="edge">
<title>[root] module.mypw2.output.id (expand)-&gt;[root] module.mypw2.random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M1704.32,-216.23C1681.74,-206.83 1653.31,-194.98 1629,-184.85"></path>
<polygon fill="black" stroke="black" points="1630.49,-181.68 1619.91,-181.07 1627.8,-188.14 1630.49,-181.68"></polygon>
</g>
<!-- [root] module.mypw2.output.pw (expand)&#45;&gt;[root] module.mypw2.random_password.password (expand) -->
<g id="edge13" class="edge">
<title>[root] module.mypw2.output.pw (expand)-&gt;[root] module.mypw2.random_password.password (expand)</title>
<path fill="none" stroke="black" d="M1330.81,-216.85C1291.93,-206.85 1241.65,-193.91 1200.13,-183.22"></path>
<polygon fill="black" stroke="black" points="1201.24,-179.89 1190.68,-180.79 1199.5,-186.67 1201.24,-179.89"></polygon>
</g>
<!-- [root] module.mypw2.var.isDB (expand)&#45;&gt;[root] module.mypw2 (expand) -->
<g id="edge18" class="edge">
<title>[root] module.mypw2.var.isDB (expand)-&gt;[root] module.mypw2 (expand)</title>
<path fill="none" stroke="black" d="M1521.29,-71.7C1533.26,-62.97 1547.97,-52.24 1560.98,-42.75"></path>
<polygon fill="black" stroke="black" points="1562.86,-45.72 1568.88,-37 1558.73,-40.06 1562.86,-45.72"></polygon>
</g>
<!-- [root] output.mypw1 (expand) -->
<g id="node16" class="node">
<title>[root] output.mypw1 (expand)</title>
<ellipse fill="none" stroke="black" cx="661.56" cy="-378" rx="124.03" ry="18"></ellipse>
<text text-anchor="middle" x="661.56" y="-372.95" font-family="Times,serif" font-size="14.00">[root] output.mypw1 (expand)</text>
</g>
<!-- [root] output.mypw1 (expand)&#45;&gt;[root] module.mypw1 (close) -->
<g id="edge19" class="edge">
<title>[root] output.mypw1 (expand)-&gt;[root] module.mypw1 (close)</title>
<path fill="none" stroke="black" d="M627.54,-360.23C608.31,-350.75 584.05,-338.8 563.41,-328.62"></path>
<polygon fill="black" stroke="black" points="565.16,-325.58 554.65,-324.3 562.07,-331.86 565.16,-325.58"></polygon>
</g>
<!-- [root] output.mypw2 (expand) -->
<g id="node17" class="node">
<title>[root] output.mypw2 (expand)</title>
<ellipse fill="none" stroke="black" cx="1250.56" cy="-378" rx="124.03" ry="18"></ellipse>
<text text-anchor="middle" x="1250.56" y="-372.95" font-family="Times,serif" font-size="14.00">[root] output.mypw2 (expand)</text>
</g>
<!-- [root] output.mypw2 (expand)&#45;&gt;[root] module.mypw2 (close) -->
<g id="edge20" class="edge">
<title>[root] output.mypw2 (expand)-&gt;[root] module.mypw2 (close)</title>
<path fill="none" stroke="black" d="M1284.81,-360.23C1304.18,-350.75 1328.6,-338.8 1349.4,-328.62"></path>
<polygon fill="black" stroke="black" points="1350.78,-331.84 1358.22,-324.3 1347.7,-325.55 1350.78,-331.84"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close) -->
<g id="node18" class="node">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)</title>
<ellipse fill="none" stroke="black" cx="954.56" cy="-234" rx="252.49" ry="18"></ellipse>
<text text-anchor="middle" x="954.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] provider["registry.terraform.io/hashicorp/random"] (close)</text>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] module.mypw1.random_password.password (expand) -->
<g id="edge21" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] module.mypw1.random_password.password (expand)</title>
<path fill="none" stroke="black" d="M856.63,-216.98C793.52,-206.66 711.1,-193.18 644.4,-182.27"></path>
<polygon fill="black" stroke="black" points="645.34,-178.88 634.91,-180.72 644.21,-185.79 645.34,-178.88"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] module.mypw1.random_pet.name (expand) -->
<g id="edge22" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] module.mypw1.random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M911.5,-215.88C887.81,-206.46 858.19,-194.67 832.92,-184.62"></path>
<polygon fill="black" stroke="black" points="834.38,-181.44 823.79,-180.99 831.79,-187.94 834.38,-181.44"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] module.mypw2.random_password.password (expand) -->
<g id="edge23" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] module.mypw2.random_password.password (expand)</title>
<path fill="none" stroke="black" d="M995.41,-215.88C1017.78,-206.5 1045.74,-194.78 1069.65,-184.76"></path>
<polygon fill="black" stroke="black" points="1070.7,-188.11 1078.57,-181.02 1067.99,-181.66 1070.7,-188.11"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] module.mypw2.random_pet.name (expand) -->
<g id="edge24" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] module.mypw2.random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M1086.09,-218.2C1197.71,-205.64 1356.22,-187.8 1462.54,-175.83"></path>
<polygon fill="black" stroke="black" points="1462.9,-179.31 1472.44,-174.72 1462.11,-172.36 1462.9,-179.31"></polygon>
</g>
<!-- [root] root -->
<g id="node19" class="node">
<title>[root] root</title>
<ellipse fill="none" stroke="black" cx="954.56" cy="-450" rx="49.3" ry="18"></ellipse>
<text text-anchor="middle" x="954.56" y="-444.95" font-family="Times,serif" font-size="14.00">[root] root</text>
</g>
<!-- [root] root&#45;&gt;[root] output.mypw1 (expand) -->
<g id="edge25" class="edge">
<title>[root] root-&gt;[root] output.mypw1 (expand)</title>
<path fill="none" stroke="black" d="M914.12,-439.34C868.06,-428.33 791.83,-410.12 735.15,-396.58"></path>
<polygon fill="black" stroke="black" points="736.1,-393.21 725.56,-394.29 734.48,-400.02 736.1,-393.21"></polygon>
</g>
<!-- [root] root&#45;&gt;[root] output.mypw2 (expand) -->
<g id="edge26" class="edge">
<title>[root] root-&gt;[root] output.mypw2 (expand)</title>
<path fill="none" stroke="black" d="M995.09,-439.41C1041.63,-428.41 1118.92,-410.13 1176.32,-396.56"></path>
<polygon fill="black" stroke="black" points="1177.12,-399.96 1186.04,-394.26 1175.51,-393.15 1177.12,-399.96"></polygon>
</g>
<!-- [root] root&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close) -->
<g id="edge27" class="edge">
<title>[root] root-&gt;[root] provider["registry.terraform.io/hashicorp/random"] (close)</title>
<path fill="none" stroke="black" d="M954.56,-431.85C954.56,-395.14 954.56,-308.66 954.56,-263.53"></path>
<polygon fill="black" stroke="black" points="958.06,-263.75 954.56,-253.75 951.06,-263.75 958.06,-263.75"></polygon>
</g>
</g>
</svg></div>

<h3 id="ëª¨ë“ˆ-ì‚¬ìš©-ë°©ì‹">ëª¨ë“ˆ ì‚¬ìš© ë°©ì‹</h3>

<h4 id="ëª¨ë“ˆê³¼-í”„ë¡œë°”ì´ë”">ëª¨ë“ˆê³¼ í”„ë¡œë°”ì´ë”</h4>

<ul>
  <li>ëª¨ë“ˆì—ì„œ ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ë¦¬ì†ŒìŠ¤ëŠ” ê´€ë ¨ í”„ë¡œë°”ì´ë”ì˜ ì •ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. í”„ë¡œë°”ì´ë”ì˜ ì •ì˜ë¥¼ ëª¨ë“ˆ ì•ˆì— ë‘ëŠëƒ, ë£¨íŠ¸ ëª¨ë“ˆì—ì„œ ì •ì˜í•˜ëŠëƒì— ë”°ë¼ ëª¨ë“ˆì˜ ì¬ì‚¬ìš©ì„±ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</li>
</ul>

<h5 id="ìœ í˜•-1-ìì‹-ëª¨ë“ˆì—ì„œ-í”„ë¡œë°”ì´ë”-ì •ì˜">ìœ í˜• 1. ìì‹ ëª¨ë“ˆì—ì„œ í”„ë¡œë°”ì´ë” ì •ì˜</h5>

<ul>
  <li>ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡œë°”ì´ë”ì˜ ë²„ì „ê³¼ ìƒì„¸ êµ¬ì„±ì„ ìì‹ ëª¨ë“ˆì— ê³ ì •í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
    <ul>
      <li>í”„ë¡œë°”ì´ë” ë²„ì „ê³¼ êµ¬ì„±ì— ë¯¼ê°í•˜ê±°ë‚˜, ë£¨íŠ¸ ëª¨ë“ˆê³¼ ê´€ê³„ì—†ì´ ë…ë¦½ì ì¸ êµ¬ì¡°ì¼ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
      <li>í•˜ì§€ë§Œ ë™ì¼ í”„ë¡œë°”ì´ë”ê°€ ë£¨íŠ¸ ëª¨ë“ˆê³¼ ìì‹ ëª¨ë“ˆ ì–‘ìª½, ë˜ëŠ” ì„œë¡œ ë‹¤ë¥¸ ìì‹ ëª¨ë“ˆì— ë²„ì „ ì¡°ê±´ í•©ì˜ê°€ ì•ˆ ë˜ë©´,
ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³  ëª¨ë“ˆì—ì„œ ë°˜ë³µë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ë‹¨ì ì´ ìˆì–´ ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h5 id="ìœ í˜•-2-ë£¨íŠ¸-ëª¨ë“ˆì—ì„œ-í”„ë¡œë°”ì´ë”-ì •ì˜-ì¶”ì²œ">ìœ í˜• 2. ë£¨íŠ¸ ëª¨ë“ˆì—ì„œ í”„ë¡œë°”ì´ë” ì •ì˜ (ì¶”ì²œ)</h5>

<ul>
  <li>ìì‹ ëª¨ë“ˆì€ ë£¨íŠ¸ ëª¨ë“ˆì˜ í”„ë¡œë°”ì´ë”ì— ì¢…ì†ë˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</li>
  <li>ë””ë ‰í„°ë¦¬ êµ¬ì¡°ëŠ” ë¶„ë¦¬ë˜ì–´ ìˆì§€ë§Œ, ì‹¤í–‰ ë‹¨ê³„ì—ì„œëŠ” ë™ì¼ ê³„ì¸µìœ¼ë¡œ í•´ì„ë˜ì–´ì„œ <strong>í”„ë¡œë°”ì´ë” ë²„ì „ê³¼ êµ¬ì„±ì€ ë£¨íŠ¸ ëª¨ë“ˆì˜ ì„¤ì •ì´ ì ìš©</strong>ë©ë‹ˆë‹¤.</li>
  <li>í”„ë¡œë°”ì´ë”ë¥¼ ëª¨ë“ˆ ë‚´ ë¦¬ì†ŒìŠ¤ì™€ ë°ì´í„° ì†ŒìŠ¤ì— ì¼ê´„ ì ìš©í•˜ê³ , ìì‹ ëª¨ë“ˆì— ëŒ€í•œ ë°˜ë³µë¬¸ì„ ììœ ë¡­ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ê²ƒì´ ì¥ì ì…ë‹ˆë‹¤.</li>
</ul>

<h5 id="ë£¨íŠ¸-ëª¨ë“ˆì—ì„œ-í”„ë¡œë°”ì´ë”-ì •ì˜-ì‹¤ìŠµ">ë£¨íŠ¸ ëª¨ë“ˆì—ì„œ í”„ë¡œë°”ì´ë” ì •ì˜ ì‹¤ìŠµ</h5>

<ul>
  <li>ì‹¤ìŠµì„ ìœ„í•œ ë””ë ‰í„°ë¦¬ êµ¬ì„±
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 06-module-training
 â”œâ”€â”€ modules                    <span class="c"># child module home</span>
 â”‚   â””â”€â”€ terraform-aws-ec2
 â”‚       â”œâ”€â”€ main.tf
 â”‚       â”œâ”€â”€ outputs.tf
 â”‚       â””â”€â”€ variables.tf
 â””â”€â”€ multi_provider_for_module 	<span class="c"># root-module</span>
     â”œâ”€â”€ main.tf
     â””â”€â”€ outputs.tf
</code></pre></div>    </div>
  </li>
  <li>06-module-traning/modules/terraform-aws-ec2/main.tf, variable.tf, output.tf íŒŒì¼ ìƒì„±
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_default_vpc"</span> <span class="s2">"default"</span> <span class="p">{}</span>
  
<span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"default"</span> <span class="p">{</span>
  <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">owners</span>      <span class="p">=</span> <span class="p">[</span><span class="s2">"amazon"</span><span class="p">]</span>
  
  <span class="nx">filter</span> <span class="p">{</span>
    <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"owner-alias"</span>
    <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"amazon"</span><span class="p">]</span>
  <span class="p">}</span>
  
  <span class="nx">filter</span> <span class="p">{</span>
    <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
    <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"amzn2-ami-hvm*"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"default"</span> <span class="p">{</span>
  <span class="nx">depends_on</span>    <span class="p">=</span> <span class="p">[</span><span class="nx">aws_default_vpc</span><span class="p">.</span><span class="nx">default</span><span class="p">]</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">default</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_type</span>
  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_name</span>
  <span class="p">}</span>
<span class="p">}</span>  
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># variable.tf</span>
<span class="k">variable</span> <span class="s2">"instance_type"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"vm ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ì •ì˜"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"t2.micro"</span>
<span class="p">}</span>
  
<span class="k">variable</span> <span class="s2">"instance_name"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"vm ì¸ìŠ¤í„´ìŠ¤ ì´ë¦„ ì •ì˜"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"my_ec2"</span>
<span class="p">}</span> 
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># output.tf</span>
<span class="k">output</span> <span class="s2">"private_ip"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">default</span><span class="p">.</span><span class="nx">private_ip</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ì‘ì„±ëœ ëª¨ë“ˆì„ ì‚¬ìš©í•  ë£¨íŠ¸ëª¨ë“ˆ 06-module-traning/multi_provider_for_module/main.tf, output.tf íŒŒì¼ ìƒì„±</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># main.tf</span>
  <span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
      <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-southeast-1"</span>  
  <span class="p">}</span>
	
  <span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
      <span class="nx">alias</span>  <span class="p">=</span> <span class="s2">"seoul"</span>
      <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>  
  <span class="p">}</span>
	
  <span class="k">module</span> <span class="s2">"ec2_singapore"</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
  <span class="p">}</span>
	
  <span class="k">module</span> <span class="s2">"ec2_seoul"</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
      <span class="nx">providers</span> <span class="p">=</span> <span class="p">{</span>
          <span class="nx">aws</span> <span class="p">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">seoul</span>
      <span class="p">}</span>
      <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t3.small"</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># output.tf</span>
  <span class="k">output</span> <span class="s2">"module_output_singapore"</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">ec2_singapore</span><span class="p">.</span><span class="nx">private_ip</span>
  <span class="p">}</span>
	
  <span class="k">output</span> <span class="s2">"module_output_seoul"</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">ec2_seoul</span><span class="p">.</span><span class="nx">private_ip</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ì‹¤í–‰</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="nv">$ </span><span class="nb">cat</span> .terraform/modules/modules.json | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "Modules": [</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "",</span>
<span class="c">#          "Source": "",</span>
<span class="c">#          "Dir": "."</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "ec2_seoul",</span>
<span class="c">#          "Source": "../modules/terraform-aws-ec2",</span>
<span class="c">#          "Dir": "../modules/terraform-aws-ec2"</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "ec2_singapore",</span>
<span class="c">#          "Source": "../modules/terraform-aws-ec2",</span>
<span class="c">#          "Dir": "../modules/terraform-aws-ec2"</span>
<span class="c">#        }</span>
<span class="c">#      ]</span>
<span class="c">#    }  </span>
  
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 4 added, 0 changed, 0 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    module_output_seoul = "172.31.0.75"</span>
<span class="c">#    module_output_singapore = "172.31.17.130"</span>
  
<span class="nv">$ </span>terraform output
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show module.ec2_seoul.data.aws_ami.default
  
<span class="c"># ìƒíƒœíŒŒì¼ì—ì„œ ëª¨ë“ˆ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module
<span class="c"># =&gt; "module_output_seoul": {</span>
<span class="c">#    "module_output_singapore": {</span>
<span class="c">#      "module": "module.ec2_seoul",</span>
<span class="c">#      "module": "module.ec2_seoul",</span>
<span class="c">#      "module": "module.ec2_seoul",</span>
<span class="c">#            "module.ec2_seoul.aws_default_vpc.default",</span>
<span class="c">#            "module.ec2_seoul.data.aws_ami.default"</span>
<span class="c">#      "module": "module.ec2_singapore",</span>
<span class="c">#      "module": "module.ec2_singapore",</span>
<span class="c">#      "module": "module.ec2_singapore",</span>
<span class="c">#            "module.ec2_singapore.aws_default_vpc.default",</span>
<span class="c">#            "module.ec2_singapore.data.aws_ami.default"</span>
  
<span class="c"># ê·¸ë˜í”„ í™•ì¸</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>    </div>
  </li>
</ul>

<div class="graphviz image-center"><svg width="379pt" viewbox="0.00 0.00 378.75 290.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 286)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-286 374.75,-286 374.75,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_module.ec2_seoul</title>
<polygon fill="none" stroke="black" points="8,-8 8,-137 362.75,-137 362.75,-8 8,-8"></polygon>
<text text-anchor="middle" x="185.38" y="-119.7" font-family="sans-serif" font-size="14.00">module.ec2_seoul</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_module.ec2_singapore</title>
<polygon fill="none" stroke="black" points="8,-145 8,-274 362.75,-274 362.75,-145 8,-145"></polygon>
<text text-anchor="middle" x="185.38" y="-256.7" font-family="sans-serif" font-size="14.00">module.ec2_singapore</text>
</g>
<!-- module.ec2_seoul.data.aws_ami.default -->
<g id="node1" class="node">
<title>module.ec2_seoul.data.aws_ami.default</title>
<polygon fill="none" stroke="black" points="168.5,-52 24.25,-52 24.25,-16 168.5,-16 168.5,-52"></polygon>
<text text-anchor="middle" x="96.38" y="-28.2" font-family="sans-serif" font-size="14.00">data.aws_ami.default</text>
</g>
<!-- module.ec2_seoul.aws_default_vpc.default -->
<g id="node2" class="node">
<title>module.ec2_seoul.aws_default_vpc.default</title>
<polygon fill="none" stroke="black" points="176.75,-106 16,-106 16,-70 176.75,-70 176.75,-106"></polygon>
<text text-anchor="middle" x="96.38" y="-82.2" font-family="sans-serif" font-size="14.00">aws_default_vpc.default</text>
</g>
<!-- module.ec2_seoul.aws_instance.default -->
<g id="node3" class="node">
<title>module.ec2_seoul.aws_instance.default</title>
<polygon fill="none" stroke="black" points="354.75,-79 212.75,-79 212.75,-43 354.75,-43 354.75,-79"></polygon>
<text text-anchor="middle" x="283.75" y="-55.2" font-family="sans-serif" font-size="14.00">aws_instance.default</text>
</g>
<!-- module.ec2_seoul.aws_instance.default&#45;&gt;module.ec2_seoul.data.aws_ami.default -->
<g id="edge1" class="edge">
<title>module.ec2_seoul.aws_instance.default-&gt;module.ec2_seoul.data.aws_ami.default</title>
<path fill="none" stroke="black" d="M212.4,-50.75C201.84,-49.21 190.86,-47.62 180.06,-46.04"></path>
<polygon fill="black" stroke="black" points="180.8,-42.61 170.4,-44.64 179.79,-49.54 180.8,-42.61"></polygon>
</g>
<!-- module.ec2_seoul.aws_instance.default&#45;&gt;module.ec2_seoul.aws_default_vpc.default -->
<g id="edge2" class="edge">
<title>module.ec2_seoul.aws_instance.default-&gt;module.ec2_seoul.aws_default_vpc.default</title>
<path fill="none" stroke="black" d="M212.4,-71.25C204.54,-72.39 196.44,-73.57 188.36,-74.75"></path>
<polygon fill="black" stroke="black" points="187.87,-71.28 178.48,-76.19 188.88,-78.21 187.87,-71.28"></polygon>
</g>
<!-- module.ec2_singapore.data.aws_ami.default -->
<g id="node4" class="node">
<title>module.ec2_singapore.data.aws_ami.default</title>
<polygon fill="none" stroke="black" points="168.5,-189 24.25,-189 24.25,-153 168.5,-153 168.5,-189"></polygon>
<text text-anchor="middle" x="96.38" y="-165.2" font-family="sans-serif" font-size="14.00">data.aws_ami.default</text>
</g>
<!-- module.ec2_singapore.aws_default_vpc.default -->
<g id="node5" class="node">
<title>module.ec2_singapore.aws_default_vpc.default</title>
<polygon fill="none" stroke="black" points="176.75,-243 16,-243 16,-207 176.75,-207 176.75,-243"></polygon>
<text text-anchor="middle" x="96.38" y="-219.2" font-family="sans-serif" font-size="14.00">aws_default_vpc.default</text>
</g>
<!-- module.ec2_singapore.aws_instance.default -->
<g id="node6" class="node">
<title>module.ec2_singapore.aws_instance.default</title>
<polygon fill="none" stroke="black" points="354.75,-216 212.75,-216 212.75,-180 354.75,-180 354.75,-216"></polygon>
<text text-anchor="middle" x="283.75" y="-192.2" font-family="sans-serif" font-size="14.00">aws_instance.default</text>
</g>
<!-- module.ec2_singapore.aws_instance.default&#45;&gt;module.ec2_singapore.data.aws_ami.default -->
<g id="edge3" class="edge">
<title>module.ec2_singapore.aws_instance.default-&gt;module.ec2_singapore.data.aws_ami.default</title>
<path fill="none" stroke="black" d="M212.4,-187.75C201.84,-186.21 190.86,-184.62 180.06,-183.04"></path>
<polygon fill="black" stroke="black" points="180.8,-179.61 170.4,-181.64 179.79,-186.54 180.8,-179.61"></polygon>
</g>
<!-- module.ec2_singapore.aws_instance.default&#45;&gt;module.ec2_singapore.aws_default_vpc.default -->
<g id="edge4" class="edge">
<title>module.ec2_singapore.aws_instance.default-&gt;module.ec2_singapore.aws_default_vpc.default</title>
<path fill="none" stroke="black" d="M212.4,-208.25C204.54,-209.39 196.44,-210.57 188.36,-211.75"></path>
<polygon fill="black" stroke="black" points="187.87,-208.28 178.48,-213.19 188.88,-215.21 187.87,-208.28"></polygon>
</g>
</g>
</svg></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># aws clië¡œ ec2 í™•ì¸</span>
<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--region</span> ap-northeast-2 <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text
<span class="c"># =&gt; my_ec2  43.202.2.105    running</span>

<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--region</span> ap-southeast-1 <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text
<span class="c"># =&gt; my_ec2  18.139.217.84   running</span>

<span class="c"># ì‹¤ìŠµ ì™„ë£Œ í›„ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div></div>

<h5 id="ëª¨ë“ˆì˜-ë°˜ë³µë¬¸">ëª¨ë“ˆì˜ ë°˜ë³µë¬¸</h5>

<ul>
  <li>ëª¨ë“ˆë„ ë¦¬ì†ŒìŠ¤ì—ì„œ ë°˜ë³µë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ëª¨ë“ˆì´ë¼ëŠ” ì˜ ì •ì˜ë˜ê³  í…ŒìŠ¤íŠ¸ëœ ë‹¨ìœ„ë¡œ ì›í•˜ëŠ” ìˆ˜ëŸ‰ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ì„ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ëª¨ë“ˆì—†ì´ êµ¬ì„±í•˜ëŠ”ê²ƒê³¼ ëŒ€ë¹„í•´ì„œ ë¦¬ì†ŒìŠ¤ ì¢…ì†ì„± ê´€ë¦¬ì™€ ìœ ì§€ë³´ìˆ˜ì— ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. 
<code class="language-plaintext highlighter-rouge">count</code>ë¥¼ ì‚¬ìš©í•œ ë°˜ë³µë¬¸ì€ ë¦¬ì†ŒìŠ¤ì™€ ìœ ì‚¬í•˜ê²Œ <code class="language-plaintext highlighter-rouge">module</code> ë¸”ë¡ ë‚´ì— ì„ ì–¸í•©ë‹ˆë‹¤.</li>
</ul>

<h6 id="countë¥¼-ì‚¬ìš©í•œ-ëª¨ë“ˆ-ë°˜ë³µë¬¸-ì‹¤ìŠµ">countë¥¼ ì‚¬ìš©í•œ ëª¨ë“ˆ ë°˜ë³µë¬¸ ì‹¤ìŠµ</h6>

<ul>
  <li>
    <p>06-module-traning/module_loop_count/main.tf íŒŒì¼ ìƒì„±</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>  
<span class="p">}</span>
  
<span class="k">module</span> <span class="s2">"ec2_seoul"</span> <span class="p">{</span>
  <span class="nx">count</span>  <span class="p">=</span> <span class="mi">2</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t3.small"</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"module_output"</span> <span class="p">{</span>
  <span class="nx">value</span>  <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">ec2_seoul</span><span class="p">[*].</span><span class="nx">private_ip</span>   
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ì‹¤í–‰ : ëª¨ë“ˆì˜ ë°˜ë³µë¬¸ í…ŒìŠ¤íŠ¸</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init 
<span class="nv">$ </span><span class="nb">cat</span> .terraform/modules/modules.json | jq
  
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 4 added, 0 changed, 0 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    module_output = [</span>
<span class="c">#      "172.31.4.243",</span>
<span class="c">#      "172.31.8.11",</span>
<span class="c">#    ]  </span>
<span class="c"># count = 2 í•œë§Œí¼ 2ê°œì˜ EC2 ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë¨</span>
  
<span class="nv">$ </span>terraform output
<span class="nv">$ </span>terraform state list
  
<span class="c"># ìƒíƒœíŒŒì¼ì—ì„œ ëª¨ë“ˆì •ë³´ í™•ì¸ </span>
<span class="c"># (ì•ì„œ ì‚´í´ë³¸ cat .terraform/modules/modules.json | jq ì—ì„œëŠ” ëª¨ë“ˆì´ 1ê°œë§Œ ë‚˜ì˜¤ì§€ë§Œ, </span>
<span class="c">#  ì—¬ê¸°ì—ì„œëŠ” count ë§Œí¼ ë³´ì—¬ì§)</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module
  
<span class="c"># ê·¸ë˜í”„ í™•ì¸</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>    </div>
  </li>
</ul>

<div class="graphviz image-center"><svg width="379pt" viewbox="0.00 0.00 378.75 153.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 149)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-149 374.75,-149 374.75,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_module.ec2_seoul</title>
<polygon fill="none" stroke="black" points="8,-8 8,-137 362.75,-137 362.75,-8 8,-8"></polygon>
<text text-anchor="middle" x="185.38" y="-119.7" font-family="sans-serif" font-size="14.00">module.ec2_seoul</text>
</g>
<!-- module.ec2_seoul.data.aws_ami.default -->
<g id="node1" class="node">
<title>module.ec2_seoul.data.aws_ami.default</title>
<polygon fill="none" stroke="black" points="168.5,-52 24.25,-52 24.25,-16 168.5,-16 168.5,-52"></polygon>
<text text-anchor="middle" x="96.38" y="-28.2" font-family="sans-serif" font-size="14.00">data.aws_ami.default</text>
</g>
<!-- module.ec2_seoul.aws_default_vpc.default -->
<g id="node2" class="node">
<title>module.ec2_seoul.aws_default_vpc.default</title>
<polygon fill="none" stroke="black" points="176.75,-106 16,-106 16,-70 176.75,-70 176.75,-106"></polygon>
<text text-anchor="middle" x="96.38" y="-82.2" font-family="sans-serif" font-size="14.00">aws_default_vpc.default</text>
</g>
<!-- module.ec2_seoul.aws_instance.default -->
<g id="node3" class="node">
<title>module.ec2_seoul.aws_instance.default</title>
<polygon fill="none" stroke="black" points="354.75,-79 212.75,-79 212.75,-43 354.75,-43 354.75,-79"></polygon>
<text text-anchor="middle" x="283.75" y="-55.2" font-family="sans-serif" font-size="14.00">aws_instance.default</text>
</g>
<!-- module.ec2_seoul.aws_instance.default&#45;&gt;module.ec2_seoul.data.aws_ami.default -->
<g id="edge1" class="edge">
<title>module.ec2_seoul.aws_instance.default-&gt;module.ec2_seoul.data.aws_ami.default</title>
<path fill="none" stroke="black" d="M212.4,-50.75C201.84,-49.21 190.86,-47.62 180.06,-46.04"></path>
<polygon fill="black" stroke="black" points="180.8,-42.61 170.4,-44.64 179.79,-49.54 180.8,-42.61"></polygon>
</g>
<!-- module.ec2_seoul.aws_instance.default&#45;&gt;module.ec2_seoul.aws_default_vpc.default -->
<g id="edge2" class="edge">
<title>module.ec2_seoul.aws_instance.default-&gt;module.ec2_seoul.aws_default_vpc.default</title>
<path fill="none" stroke="black" d="M212.4,-71.25C204.54,-72.39 196.44,-73.57 188.36,-74.75"></path>
<polygon fill="black" stroke="black" points="187.87,-71.28 178.48,-76.19 188.88,-78.21 187.87,-71.28"></polygon>
</g>
</g>
</svg></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># aws clië¡œ ec2 í™•ì¸</span>
  <span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--region</span> ap-northeast-2 <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text
  
  <span class="c"># ì‹¤ìŠµ ì™„ë£Œ í›„ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</span>
  <span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div></div>

<h6 id="for_eachë¥¼-ì‚¬ìš©í•œ-ëª¨ë“ˆ-ë°˜ë³µë¬¸-ì‹¤ìŠµ">for_eachë¥¼ ì‚¬ìš©í•œ ëª¨ë“ˆ ë°˜ë³µë¬¸ ì‹¤ìŠµ</h6>

<ul>
  <li>
    <p>06-module-traning/module_loop_for_each/main.tf íŒŒì¼ ìƒì„±</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf </span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">env</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">dev</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">type</span> <span class="p">=</span> <span class="s2">"t3.nano"</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="s2">"dev_ec2"</span>
    <span class="p">}</span>
    <span class="nx">prod</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">type</span> <span class="p">=</span> <span class="s2">"t3.micro"</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="s2">"prod_ec2"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">module</span> <span class="s2">"ec2_seoul"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">env</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">type</span>
  <span class="nx">instance_name</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">name</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"module_output"</span> <span class="p">{</span>
  <span class="nx">value</span>  <span class="p">=</span> <span class="p">[</span>
    <span class="nx">for</span> <span class="nx">k</span> <span class="nx">in</span> <span class="k">module</span><span class="p">.</span><span class="nx">ec2_seoul</span><span class="err">:</span> <span class="nx">k</span><span class="p">.</span><span class="nx">private_ip</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ì‹¤í–‰ : for_eachë¥¼ ì‚¬ìš©í•œ ëª¨ë“ˆ ë°˜ë³µë¬¸ í…ŒìŠ¤íŠ¸</p>
  </li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform output
<span class="c"># =&gt; module_output = [</span>
<span class="c">#      "172.31.13.57",</span>
<span class="c">#      "172.31.12.95",</span>
<span class="c">#    ]</span>

<span class="nv">$ </span>terraform state list

<span class="c"># ìƒíƒœíŒŒì¼ì—ì„œ ëª¨ë“ˆì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module

<span class="c"># aws clië¡œ ec2 í™•ì¸</span>
<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--region</span> ap-northeast-2 <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text
<span class="c"># =&gt; dev_ec2    3.36.76.84      running</span>
<span class="c">#    prod_ec2   52.79.44.76     running</span>

<span class="c"># ì‹¤ìŠµ ì™„ë£Œ í›„ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div></div>

<h3 id="ëª¨ë“ˆ-ì†ŒìŠ¤-ê´€ë¦¬">ëª¨ë“ˆ ì†ŒìŠ¤ ê´€ë¦¬</h3>

<ul>
  <li>ëª¨ë“ˆ ì†ŒìŠ¤ ê´€ë¦¬ ë°©ë²•ì€ í¬ê²Œ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>ë¡œì»¬ ë””ë ‰í„°ë¦¬ ê²½ë¡œ</li>
      <li>í…Œë¼í¼ ë ˆì§€ìŠ¤íŠ¸ë¦¬ (Terraform Registry)</li>
      <li>VCS (Git, GitHub, GitLab, Bitbucket ë“±)</li>
      <li>HTTP urls</li>
      <li>Object Storage (S3 Bucket, GCS Bucket ë“±)</li>
    </ul>
  </li>
</ul>

<h4 id="ì°¸ì¡°-ì˜ˆì œ">ì°¸ì¡° ì˜ˆì œ</h4>

<ul>
  <li>ë¡œì»¬ ë””ë ‰í„°ë¦¬
    <ul>
      <li>ëŒ€ìƒ ëª¨ë“ˆì´ ê°™ì€ ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì— ìˆìœ¼ë¯€ë¡œ ë‹¤ìš´ë¡œë“œ ì—†ì´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ì¬ì‚¬ìš©ì„±ì„ ê³ ë ¤í•œë‹¤ë©´ ì•ì„œ ì‹¤ìŠµì—ì„œ ì²˜ëŸ¼ ìƒìœ„ ë””ë ‰í„°ë¦¬ì— modules ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ê³  ë³„ë„ë¡œ ê´€ë¦¬í•˜ëŠ”ê²ƒì„ ê¶Œì¥í•˜ë©°,<br />
í•­ìƒ ë£¨íŠ¸ëª¨ë“ˆê³¼ í•¨ê»˜ ë™ì‘í•˜ëŠ” ê²½ìš° í•˜ìœ„ ë””ë ‰í„°ë¦¬ì— ëª¨ë“ˆì„ ì •ì˜í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.</li>
      <li>ì˜ˆì‹œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìƒìœ„ ë””ë ‰í„°ë¦¬ì— ë³„ë„ ê´€ë¦¬ì‹œ ì˜ˆì œ </span>
<span class="k">module</span> <span class="s2">"local_dir_module"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
<span class="p">}</span>
    
<span class="c1"># í•˜ìœ„ ë””ë ‰í„°ë¦¬ì— ê´€ë¦¬ì‹œ ì˜ˆì œ</span>
<span class="k">module</span> <span class="s2">"local_subdir_module"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"./terraform-aws-ec2"</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>í…Œë¼í¼ ë ˆì§€ìŠ¤íŠ¸ë¦¬
    <ul>
      <li>í…Œë¼í¼ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡ëœ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ê³µê°œ ëª¨ë“ˆê³¼ Terraform Cloud, Terraform Enterpriseì˜ ë¹„ê³µê°œ ëª¨ë“ˆì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ê³µê°œëœ ëª¨ë“ˆì€ <a href="https://registry.terraform.io/browse/modules">https://registry.terraform.io/browse/modules</a> ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ëª¨ë“ˆ ëª…ì€ <code class="language-plaintext highlighter-rouge">&lt;ë„¤ì„ìŠ¤í˜ì´ìŠ¤&gt;/&lt;ì´ë¦„&gt;/&lt;í”„ë¡œë°”ì´ë”&gt;</code>ì˜ í˜•íƒœë¥¼ ë”°ë¦…ë‹ˆë‹¤.</li>
      <li>ì˜ˆì‹œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"terraform-aws-modules/vpc/aws"</span>
  <span class="nx">version</span> <span class="p">=</span> <span class="s2">"5.1.0"</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>VCS ì‚¬ìš© (github ì˜ˆì‹œ)
    <ul>
      <li>Gitì˜ ì›ê²© ì €ì¥ì†Œë¡œ ìœ ëª…í•œ ê¹ƒí—ˆë¸ŒëŠ” í…Œë¼í¼ êµ¬ì„±ì— ëŒ€í•œ CI ë¡œë„ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ëª¨ë“ˆ ì†ŒìŠ¤ë¥¼ ì—…ë¡œë“œ í•˜ì—¬ ì‚¬ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ì•ì„œ ë§Œë“  06-module-traning/modules/terraform-aws-ec2/ ë¥¼ ê¹ƒí—ˆë¸Œì— ì—…ë¡œë“œí•˜ëŠ” ê³¼ì •
        <ol>
          <li>ê¹ƒí—ˆë¸Œì— ë¡œê·¸ì¸</li>
          <li>ìƒˆë¡œìš´ ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œ ìƒì„± [New repository]
            <ul>
              <li>Owner : ì›í•˜ëŠ” ì†Œìœ ì ì„ íƒ</li>
              <li>Repository name : ì˜ˆì‹œ) <strong>terraform-module-repo</strong></li>
              <li>Public ì„ íƒ</li>
              <li>Add .gitignoreì˜ ë“œë¡­ë°•ìŠ¤ì—ì„œ [Terraform]ì„ ì„ íƒ</li>
            </ul>
          </li>
          <li>ë§¨ ì•„ë˜ [Create repository] í´ë¦­</li>
          <li>í•´ë‹¹ ì €ì¥ì†Œì— ì˜ˆì‹œ) â€˜<strong>terraform-aws-ec2</strong>â€™ ë””ë ‰í„°ë¦¬ ìƒì„± í›„ main.tf , variable.tf, output.tf ì¶”ê°€ í›„ ì—…ë¡œë“œ</li>
        </ol>
      </li>
      <li>ëª¨ë“ˆ ì‚¬ìš© ì˜ˆì‹œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-southeast-1"</span>  
<span class="p">}</span>
    
<span class="k">module</span> <span class="s2">"ec2_seoul"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"github.com/sweetlittlebird/terraform-module-repo/terraform-aws-ec2"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t3.small"</span>
<span class="p">}</span>     
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
    
<span class="c"># ìƒíƒœ í™•ì¸</span>
<span class="nv">$ </span>tree .terraform/modules
.terraform/modules
â”œâ”€â”€ ec2_seoul
â”‚   â””â”€â”€ terraform-aws-ec2
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ output.tf
â”‚       â””â”€â”€ variable.tf
â””â”€â”€ modules.json
    
<span class="c"># ë°°í¬</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Downloading git::https://github.com/sweetlittlebird/terraform-module-repo.git for ec2_seoul...</span>
<span class="c">#    ...</span>
<span class="c">#    Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; module.ec2_seoul.data.aws_ami.default</span>
<span class="c">#    module.ec2_seoul.aws_default_vpc.default</span>
<span class="c">#    module.ec2_seoul.aws_instance.default</span>
    
<span class="c"># ì‹¤ìŠµ ì™„ë£Œ í›„ ì‚­ì œ</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>5ì£¼ì°¨ëŠ” ë‘í¸ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. ì²«ë²ˆì§¸ í¸ì—ì„œëŠ” ëª¨ë“ˆí™”ì— ëŒ€í•´ ì•Œì•„ë³´ê³ , ëª¨ë“ˆì„ ë§Œë“¤ê³  ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì‹¤ìŠµí•´ ë³´ì•˜ìŠµë‹ˆë‹¤.
ë‘ë²ˆì§¸ í¸ì—ì„œëŠ” Terraform Runnerì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<p><a href="/posts/2024-07-13-T101-Study-Terraform-Week-5b/">[T101 4ê¸°] Runner ë°”ë¡œê°€ê¸°</a></p>]]></content><author><name></name></author><category term="terraform" /><category term="terraform," /><category term="cloud," /><category term="aws" /><summary type="html"><![CDATA[ì´ë²ˆ ì£¼ì—ëŠ” Moduleê³¼ Runnerì— ëŒ€í•´ í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaCë¥¼ í†µí•´ ì•Œì•„ ë³´ê² ìŠµë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[T101 4ê¸°] Provider &amp;amp; State</title><link href="https://sweetlittlebird.github.io/posts/2024-07-06-T101-Study-Terraform-Week-4/" rel="alternate" type="text/html" title="[T101 4ê¸°] Provider &amp;amp; State" /><published>2024-07-06T02:08:00+09:00</published><updated>2024-07-06T02:08:00+09:00</updated><id>https://sweetlittlebird.github.io/posts/T101%20Study%20-%20Terraform%20Week%204</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-07-06-T101-Study-Terraform-Week-4/"><![CDATA[<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ë“œë””ì–´ HCL ê¸°ë³¸ ë¬¸ë²• ìŠ¤í„°ë””ê°€ ëë‚˜ê³  ë‹¤ë¥¸ ì£¼ì œë¡œ ë„˜ì–´ê°€ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
ë¬¼ë¡  HCL ë¬¸ë²•ì„ ê³„ì† ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì´ìƒ ì§€ì†ì ì¸ ê³µë¶€ì™€ ì¶”ê°€/ë³€ê²½ë˜ëŠ” ë¬¸ë²•ì„ ê³„ì†
íŒ”ë¡œìš° í•´ì•¼ê² ì§€ë§Œ, í•œ ë‹¨ê³„ë¥¼ ë„˜ê²¼ë‹¤ëŠ” ëŠë‚Œì— ë¿Œë“¯í•©ë‹ˆë‹¤. :thumbsup:</p>

<p>ì´ë²ˆ ì£¼ì—ëŠ” ê³„ì† ì‚¬ìš©ì€ í•´ì™”ì§€ë§Œ ì˜ì€ ëª¨ë¥´ê³  ìˆë˜ <code class="language-plaintext highlighter-rouge">Provider</code>ì™€ <code class="language-plaintext highlighter-rouge">State</code>ì— ëŒ€í•´
<a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a>ë¥¼ í†µí•´ ì•Œì•„ ë³´ê² ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" /></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a></p>
</blockquote>

<h2 id="í”„ë¡œë°”ì´ë”-provider">í”„ë¡œë°”ì´ë” (Provider)</h2>

<ul>
  <li>í…Œë¼í¼ì€ ë‹¤ì–‘í•œ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì™€ SaaS ë“±ì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ <code class="language-plaintext highlighter-rouge">Provider</code>ì…ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">Provider</code>ëŠ” í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë‚˜ SaaSë¥¼ ì§€ì›í•˜ëŠ” í…Œë¼í¼ì˜ í”ŒëŸ¬ê·¸ì¸ì´ë©° ê° ì„œë¹„ìŠ¤ì˜ API ì™€ í†µì‹ í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Provider</code>ëŠ” ë‹¤ìŒì˜ 3ê°€ì§€ ë“±ê¸‰ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.</p>

    <table>
      <thead>
        <tr>
          <th>ë“±ê¸‰</th>
          <th>ì„¤ëª…</th>
          <th>ë„¤ì„ìŠ¤í˜ì´ìŠ¤</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Official</td>
          <td>í…Œë¼í¼ íŒ€ì—ì„œ ì œê³µí•˜ëŠ” ê³µì‹ í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</td>
          <td>hashicorp</td>
        </tr>
        <tr>
          <td>Partner</td>
          <td>í…Œë¼í¼ê³¼ íŒŒíŠ¸ë„ˆì‹­ì„ ë§ºì€ íšŒì‚¬ì—ì„œ ì œê³µí•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ì£¼ë¡œ í•´ë‹¹ íŒŒíŠ¸ë„ˆì˜ í´ë¼ìš°ë“œ/SaaS ì œí’ˆì— ëŒ€í•œ ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.<br />Partner í”„ë¡œë°”ì´ë”ê°€ ë˜ë ¤ë©´ HarshiCorp Technology Partnet Program ì— ê°€ì…ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</td>
          <td>ê²Œì‹œí•œ ì¡°ì§ ì´ë¦„<br />(mongodb/mongodbatlas)</td>
        </tr>
        <tr>
          <td>Community</td>
          <td>ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì œê³µí•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ê°œë³„ ê´€ë¦¬ìì™€ ê·¸ë£¹ì—ì„œ ë“±ë¡í•œ í”„ë¡œë°”ì´ë” ì…ë‹ˆë‹¤.<br />ì‚¬ìš©ì‹œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</td>
          <td>ê°œì¸ ë° ì¡°ì  ê³„ì • ì´ë¦„<br />(DeviaVir/gsuite)</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>ì¶”ê°€ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">Archived</code> ë“±ê¸‰ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë©°, ë”ì´ìƒ ìœ ì§€ë³´ìˆ˜ ë˜ì§€ ì•ŠëŠ” ì´ì „ ë²„ì „ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">Community</code> ì œê³µ <code class="language-plaintext highlighter-rouge">Provider</code>ëŠ” <strong>ì¶©ë¶„íˆ ê²€ì¦ë˜ì§€ ì•Šê±°ë‚˜, ì‹ ë¢°ì„±ì´ ì¶©ë¶„íˆ ì…ì¦ë˜ì§€ ì•Šì€</strong> ê°œì¸(ë˜ëŠ” ì¡°ì§)ì´
ë“±ë¡í•œ ê²½ìš°ë„ ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©ì‹œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. íŠ¹íˆ ë³´ì•ˆì— ë¯¼ê°í•œ ì •ë³´ë¥¼ ë‹¤ë£¨ëŠ” ê²½ìš°ì—ëŠ” íŠ¹íˆ <strong>ì£¼ì˜í•´ì•¼</strong> í•©ë‹ˆë‹¤.
githubì˜ star ìˆ˜, issue, PR ë“±ì„ í™•ì¸í•˜ì—¬ ì‹ ë¢°ì„±ì„ íŒë‹¨í•œ ë‹¤ìŒ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</li>
  <li>ì‚¬ìš©ê°€ëŠ¥í•œ <code class="language-plaintext highlighter-rouge">Provider</code>ì˜ ëª©ë¡ì€ ë‹¤ìŒì˜ ë§í¬ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li><a href="https://registry.terraform.io/browse/providers">Terraform Providers</a></li>
    </ul>
  </li>
</ul>

<h3 id="provider-ì„¤ì •">Provider ì„¤ì •</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Provider</code> ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ì´ <code class="language-plaintext highlighter-rouge">provider</code> ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ ì„¤ì •í•©ë‹ˆë‹¤. (1ì£¼ì°¨ ì°¸ì¡°)
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_version</span> <span class="p">=</span> <span class="s2">"~&gt; 1.3.0"</span> <span class="c1"># í…Œë¼í¼ ë²„ì „</span>
  
  <span class="nx">required_providers</span> <span class="p">{</span> <span class="c1"># í”„ë¡œë°”ì´ë” ë²„ì „ì„ ë‚˜ì—´</span>
    <span class="nx">random</span> <span class="p">=</span> <span class="p">{</span>
      <span class="c1"># Official TierëŠ” sourceë¥¼ ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
    <span class="p">}</span>
    <span class="nx">architech-http</span> <span class="p">=</span> <span class="p">{</span>
      <span class="c1"># Official Tier ê°€ ì•„ë‹Œ ê²½ìš° sourceë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"architect-team/http"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 3.0"</span>
    <span class="p">}</span>
    <span class="nx">my-peter-aws</span> <span class="p">=</span> <span class="p">{</span>   <span class="c1"># í”„ë¡œë°”ì´ë”ì˜ ë¡œì»¬ ì´ë¦„ì€ ì„ì˜ë¡œ ì§€ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.</span>
                       <span class="c1"># ì›ë˜ëŠ” aws = { version = "~&gt; 5.56.1" } ê³¼ ê°™ì´</span>
                       <span class="c1"># ì‚¬ìš©í–ˆê² ì§€ë§Œ ì´ë ‡ê²Œ ì´ë¦„ì„ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 5.56.1"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">...</span> 
<span class="p">}</span> 
<span class="err">...</span>
</code></pre></div>    </div>
    <ul>
      <li>ìœ„ì˜ ì˜ˆì œì—ì„œ <code class="language-plaintext highlighter-rouge">random</code>ì€ Official Tier ì´ë¯€ë¡œ <code class="language-plaintext highlighter-rouge">source</code>ë¥¼ ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>í•˜ì§€ë§Œ <code class="language-plaintext highlighter-rouge">architech-team/http</code>ëŠ” Official Tierê°€ ì•„ë‹ˆë¯€ë¡œ <code class="language-plaintext highlighter-rouge">source</code>ë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">my-peter-aws</code> ì²˜ëŸ¼ providerëŠ” ë¡œì»¬ ì´ë¦„ì„ ì„ì˜ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ íŠ¹ë³„í•œ ì´ìœ ê°€ ì—†ë‹¤ë©´ <code class="language-plaintext highlighter-rouge">aws</code>ì™€ ê°™ì€ ê¸°ë³¸ ì´ë¦„ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h4 id="ë¡œì»¬-ì´ë¦„ê³¼-ëª…ì‹œì -í”„ë¡œë°”ì´ë”-ì§€ì •">ë¡œì»¬ ì´ë¦„ê³¼ ëª…ì‹œì  í”„ë¡œë°”ì´ë” ì§€ì •</h4>
<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">architect-http</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"architect-team/http"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 3.0"</span>
    <span class="p">}</span>
    <span class="nx">http</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"hashicorp/http"</span>
    <span class="p">}</span>
    <span class="nx">aws-http</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"terraform-aws-modules/http"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">data</span> <span class="s2">"http"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="k">provider</span> <span class="p">=</span> <span class="nx">aws-http</span>
  <span class="nx">url</span> <span class="p">=</span> <span class="s2">"https://checkpoint-api.hashicorp.com/v1/check/terraform"</span>

  <span class="nx">request_headers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Accept</span> <span class="p">=</span> <span class="s2">"application/json"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li>ë¡œì»¬ì´ë¦„
    <ul>
      <li>ìœ„ì˜ ì˜ˆì œì—ì„œ <code class="language-plaintext highlighter-rouge">architect-http = { ... }</code>ì˜ <code class="language-plaintext highlighter-rouge">architect-http</code>, 
<code class="language-plaintext highlighter-rouge">http = { ... }</code>ì˜ <code class="language-plaintext highlighter-rouge">http</code>, <code class="language-plaintext highlighter-rouge">aws-http = { ... }</code>ì˜ <code class="language-plaintext highlighter-rouge">aws-http</code>ëŠ” ë¡œì»¬ ì´ë¦„ì…ë‹ˆë‹¤.</li>
      <li>ì•ì„œ ë§ì”€ë“œë¦°ê²ƒ ì²˜ëŸ¼ ë¡œì»¬ì´ë¦„ì€ ì„ì˜ë¡œ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë‚˜ íŠ¹ë³„í•œ ì´ìœ ê°€ ì—†ë‹¤ë©´ â€œuse providerâ€ì—ì„œ ê¶Œì¥í•˜ëŠ” ê¸°ë³¸ ì´ë¦„ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ëª…ì‹œì  í”„ë¡œë°”ì´ë” ì§€ì •
    <ul>
      <li>ìœ„ì˜ ì˜ˆì œì²˜ëŸ¼ <code class="language-plaintext highlighter-rouge">http</code>ë¼ëŠ” ë™ì¼í•œ ì´ë¦„ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì§„ ê²½ìš° <code class="language-plaintext highlighter-rouge">data</code> ë‚˜ <code class="language-plaintext highlighter-rouge">resource</code> ë¸”ë¡ì—ì„œ <code class="language-plaintext highlighter-rouge">provider</code>ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        <ul>
          <li>ìœ„ì˜ ì˜ˆì œì—ì„œ <code class="language-plaintext highlighter-rouge">data.http.example</code>ì€ <code class="language-plaintext highlighter-rouge">aws-http</code>ë¡œ ì§€ì •ëœ <code class="language-plaintext highlighter-rouge">provider</code>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
          <li>ë§Œì•½ <code class="language-plaintext highlighter-rouge">data "http" "example" {</code>ì—ì„œ <code class="language-plaintext highlighter-rouge">provider = aws-http</code>ë¥¼ ìƒëµí–ˆë‹¤ë©´, ìœ„ì˜ <code class="language-plaintext highlighter-rouge">required_providers</code>ì—ì„œ 
<code class="language-plaintext highlighter-rouge">http</code>ë¼ëŠ” ë¡œì»¬ ì´ë¦„ì„ ì§€ì •í•œ <code class="language-plaintext highlighter-rouge">hashicorp/http</code> í”„ë¡œë°”ì´ë”ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="ë‹¨ì¼-í”„ë¡œë°”ì´ë”ì˜-ë‹¤ì¤‘-ì •ì˜">ë‹¨ì¼ í”„ë¡œë°”ì´ë”ì˜ ë‹¤ì¤‘ ì •ì˜</h4>

<ul>
  <li>ë™ì¼í•œ í”„ë¡œë°”ì´ë”ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ ë‹¤ë¥¸ ì„¤ì •ì„ í•„ìš”ë¡œ í•˜ëŠ” ê²½ìš°, 
ë¦¬ì†ŒìŠ¤ë§ˆë‹¤ ë³„ë„ë¡œ ì„ ì–¸ëœ í”„ë¡œë°”ì´ë”ë¥¼ ì§€ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì˜ˆë¥¼ë“¤ì–´ì„œ <code class="language-plaintext highlighter-rouge">aws</code> í”„ë¡œë°”ì´ë”ë¥¼ ì‚¬ìš©í• ë•Œ ë‘ê°œ ì´ìƒì˜ <code class="language-plaintext highlighter-rouge">region</code>ì´ë‚˜
<code class="language-plaintext highlighter-rouge">access_key</code>, <code class="language-plaintext highlighter-rouge">secret_key</code> ë“±ì´ ë‹¤ë¥¸ í™˜ê²½ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ìˆëŠ”ë° ì´ë•Œ ì•„ë˜ì™€ ê°™ì´ ì •ì˜ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-southeast-1"</span>
<span class="p">}</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">alias</span>  <span class="p">=</span> <span class="s2">"seoul"</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"app_server1"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-06b79cf2aee0d5c92"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"app_server2"</span> <span class="p">{</span>
  <span class="k">provider</span>      <span class="p">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">seoul</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-0ea4d4b8dc1e46212"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
<span class="p">}</span>  
</code></pre></div>    </div>
    <p>ì²« aws í”„ë¡œë°”ì´ë”ëŠ” <code class="language-plaintext highlighter-rouge">alias</code> ì—†ì´ ì‚¬ìš©ë˜ê³ 
ë‘ë²ˆì§¸ aws í”„ë¡œë°”ì´ë”ëŠ” â€œseoulâ€ì´ë¼ëŠ” <code class="language-plaintext highlighter-rouge">alias</code>ë¥¼ ì‚¬ìš©í•˜ì˜€ê³ , <code class="language-plaintext highlighter-rouge">aws.seoul</code>ê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    <ul>
      <li>ì‹¤í–‰ ê²°ê³¼
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply
<span class="nv">$ </span>terraform state list 
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.app_server1.public_ip"</span> | terraform console
<span class="c"># =&gt; "13.215.47.148"</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.app_server1.availability_zone"</span> | terraform console
<span class="c"># =&gt; "ap-southeast-1b"</span>
     
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.app_server2.public_ip"</span> | terraform console
<span class="c"># =&gt; "43.203.243.238"</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.app_server2.availability_zone"</span> | terraform console    
<span class="c"># =&gt; "ap-northeast-2a"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="í”„ë¡œë°”ì´ë”-ìš”êµ¬ì‚¬í•­-ì •ì˜">í”„ë¡œë°”ì´ë” ìš”êµ¬ì‚¬í•­ ì •ì˜</h4>

<ul>
  <li>í…Œë¼í¼ ì‹¤í–‰ì‹œ ìš”êµ¬ë˜ëŠ” í”„ë¡œë°”ì´ë” ìš”êµ¬ì‚¬í•­ì€ <code class="language-plaintext highlighter-rouge">terraform</code>ë¸”ë¡ì˜ <code class="language-plaintext highlighter-rouge">required_providers</code> ë¸”ë¡ì— ì—¬ëŸ¬ê°œë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">source</code>ì—ëŠ” í”„ë¡œë°”ì´ë” ë‹¤ìš´ë¡œë“œ ê²½ë¡œë¥¼ ì§€ì •í•˜ê³  <code class="language-plaintext highlighter-rouge">version</code>ì€ ë²„ì „ ì œì•½ì„ ëª…ì‹œí•©ë‹ˆë‹¤.</li>
  <li>í”„ë¡œë°”ì´ë” ìš”êµ¬ì‚¬í•­ ì •ì˜ ë¸”ë¡
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="err">&lt;í”„ë¡œë°”ì´ë”</span> <span class="err">ë¡œì»¬</span> <span class="err">ì´ë¦„&gt;</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="p">[</span><span class="err">&lt;í˜¸ìŠ¤íŠ¸</span> <span class="err">ì£¼ì†Œ&gt;</span><span class="p">/]</span><span class="err">&lt;ë„¤ì„ìŠ¤í˜ì´ìŠ¤&gt;</span><span class="p">/</span><span class="err">&lt;ìœ í˜•&gt;</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="err">&lt;ë²„ì „</span> <span class="err">ì œì•½&gt;</span>
    <span class="p">}</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div>    </div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">source</code> : í”„ë¡œë°”ì´ë”ê°€ í˜¸ìŠ¤íŒ…ë˜ëŠ” ì£¼ì†Œì™€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ìœ í˜•ì„ ì§€ì •í•©ë‹ˆë‹¤.
        <ul>
          <li>í˜¸ìŠ¤íŠ¸ ì£¼ì†Œ : í”„ë¡œë°”ì´ë”ê°€ í˜¸ìŠ¤íŒ…ë˜ëŠ” ì£¼ì†Œë¡œ, í•„ìˆ˜ëŠ” ì•„ë‹ˆë©° ê¸°ë³¸ê°’ì€ <code class="language-plaintext highlighter-rouge">registry.terraform.io</code> ì…ë‹ˆë‹¤.</li>
          <li>ë„¤ì„ìŠ¤í˜ì´ìŠ¤ : í”„ë¡œë°”ì´ë”ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ, ê³µê°œëœ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë° Terraform Cloudì˜ ë¹„ê³µê°œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì˜ í”„ë¡œë°”ì´ë”ë¥¼ ê²Œì‹œí•˜ëŠ” ì¡°ì§ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤..</li>
          <li>ìœ í˜• : í”„ë¡œë°”ì´ë”ì—ì„œ ê´€ë¦¬ë˜ëŠ” í”Œë«í¼ì´ë‚˜ ì„œë¹„ìŠ¤ ì´ë¦„ì…ë‹ˆë‹¤.</li>
          <li>ì˜ˆì œ)
            <ul>
              <li><code class="language-plaintext highlighter-rouge">source = "hashicorp/aws"</code> ëŠ” <code class="language-plaintext highlighter-rouge">hashicorp</code> ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">aws</code> í”„ë¡œë°”ì´ë”ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. í˜¸ìŠ¤íŠ¸ ì£¼ì†Œê°€ ìƒëµë˜ì–´ <code class="language-plaintext highlighter-rouge">registry.terraform.io</code>ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.</li>
              <li><code class="language-plaintext highlighter-rouge">source = "mycorp.com/myns/mytype"</code> ëŠ” <code class="language-plaintext highlighter-rouge">mycorp.com</code> í˜¸ìŠ¤íŠ¸ ì£¼ì†Œì˜ <code class="language-plaintext highlighter-rouge">myns</code> ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">mytype</code>ë¼ëŠ” í”„ë¡œë°”ì´ë”ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">version</code> : ë²„ì „ ì œì•½ì€ <a href="/posts/2024-06-11-T101-Study-Terraform-Week-1/#terraform-%EB%B8%94%EB%A1%9D">1ì£¼ì°¨</a>ì—ì„œ ì„¤ëª…í•œ ê²ƒê³¼ ë™ì¼í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h4 id="í”„ë¡œë°”ì´ë”-ì„¤ì¹˜">í”„ë¡œë°”ì´ë” ì„¤ì¹˜</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">terraform init</code> ëª…ë ¹ì„ ì‹¤í–‰ì‹œ ì§€ì •ëœ <code class="language-plaintext highlighter-rouge">source</code>ì—ì„œ <code class="language-plaintext highlighter-rouge">version</code>ì˜ ë²„ì „ ì œì•½ì— ë§ëŠ” í”„ë¡œë°”ì´ë”ë¥¼ ë‹¤ìš´ë¡œë“œ í•©ë‹ˆë‹¤.</li>
  <li>í•­ìƒ ì§€ì •í•œ íŠ¹ì • ë²„ì „ì„ ì‚¬ìš©í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">terraform</code> ë¸”ë¡ì—ì„œ ì •ì˜í•˜ê±°ë‚˜ <code class="language-plaintext highlighter-rouge">.terraform.lock.hcl</code> ì ê¸ˆíŒŒì¼ì„ ì½”ë“œ ì €ì¥ì†Œì— ê³µìœ í•˜ëŠ” ë“±ì˜ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">required_providers</code> ë¸”ë¡ì„ ì‚¬ìš©í•˜ë©´ ì‹¤ì œë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ ì„¤ì¹˜ê°€ ë˜ë©°, <code class="language-plaintext highlighter-rouge">required_providers</code> ë¸”ë¡ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œ í…Œë¼í¼ì´ ì¶”ë¡ í•´ì„œ ìµœì‹  ë²„ì „ì˜ í”„ë¡œë°”ì´ë”ë¥¼ ì„¤ì¹˜ê°€ ì§„í–‰ë©ë‹ˆë‹¤.</li>
</ul>

<h4 id="í”„ë¡œë°”ì´ë”-ê°„-ì „í™˜-ì—¬ë¶€">í”„ë¡œë°”ì´ë” ê°„ ì „í™˜ ì—¬ë¶€</h4>

<ul>
  <li>AWS, GCP ê°™ì€ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì™€ ê°™ì´ ìœ ì‚¬í•œ ì„œë¹„ìŠ¤ë“¤ì„ ì œê³µí•˜ëŠ” ê²½ìš° í”„ë¡œë°”ì´ë”ë¥¼ ë°”ê¿”ì„œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”? ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
  <li>ê° í”„ë¡œë°”ì´ë” ë³„ë¡œ ë¦¬ì†ŒìŠ¤ ì´ë¦„ë„ ë‹¤ë¥´ê³  ì„¤ì •ë„ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— í”„ë¡œë°”ì´ë”ë¥¼ ë°”ê¾¸ëŠ” ê²ƒì€ ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
  <li>í•˜ì§€ë§Œ 1:1ë¡œ ë§¤ì¹­ ë˜ì§€ëŠ” ì•Šì§€ë§Œ, ìœ ì‚¬ í”„ë¡œë°”ì´ë” ê°„ì—ëŠ” ë¦¬ì†ŒìŠ¤ ëª…ì´ë‚˜ ì˜µì…˜ì—ë„ ìœ ì‚¬ì ì´ ìˆê¸° ë•Œë¬¸ì—
ì´ì ì€ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<h3 id="í”„ë¡œë°”ì´ë”-ì—ì½”-ì‹œìŠ¤í…œ">í”„ë¡œë°”ì´ë” ì—ì½” ì‹œìŠ¤í…œ</h3>

<ul>
  <li>í…Œë¼í¼ì˜ ì—ì½”ì‹œìŠ¤í…œì€ ì‚¬ìš©ìê°€ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ê³¼ êµ¬ì¡°ì— ë”°ë¼ í…Œë¼í¼ì„ ì ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240704_terraform_w4_provider_ecosystem.png" alt="img.png" /></li>
  <li>í…Œë¼í¼ì˜ ì—ì½”ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ëŠ” íŒŒíŠ¸ë„ˆëŠ” í¬ê²Œ ì›Œí¬í”Œë¡œìš° íŒŒíŠ¸ë„ˆì™€ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì³ íŒŒíŠ¸ë„ˆë¡œ ë‚˜ë‰©ë‹ˆë‹¤.
    <ul>
      <li>ì›Œí¬í”Œë¡œìš° íŒŒíŠ¸ë„ˆ : í…Œë¼í¼ í´ë¼ìš°ë“œì™€ í…Œë¼í¼ ì—”í„°í”„ë¼ì´ì¦ˆì— ëŒ€í•œ ì§€ì›ì„ ì œê³µí•˜ëŠ” íŒŒíŠ¸ë„ˆë¡œ, ì£¼ë¡œ ìì‹ ë“¤ì˜
ê¸°ì¡´ í”Œë«í¼ì„ í…Œë¼í¼ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” íŒŒíŠ¸ë„ˆì…ë‹ˆë‹¤.
ëŒ€í‘œì ìœ¼ë¡œ Github, Gitlab, Jenkins, CircleCI, TravisCI, Datadog, NewRelic ë“±ì´ ìˆìŠµë‹ˆë‹¤.
        <ul>
          <li>ì›Œí¬ í”Œë¡œìš° íŒŒíŠ¸ë„ˆì˜ ìœ í˜•
            <ul>
              <li><strong>ì½”ë“œ ìŠ¤ìºë‹</strong> : IaC êµ¬ì„±ì„ ê²€í† í•˜ì—¬ ì˜¤ë¥˜ë‚˜ ë³´ì•ˆ ë¬¸ì œë¥¼ ë°©ì§€í•˜ëŠ” ë„êµ¬ë¥¼ ì œê³µí•˜ëŠ” íŒŒíŠ¸ë„ˆ</li>
              <li><strong>ë¹„ìš© ê´€ë¦¬</strong> : ìƒˆë¡œìš´ ì¸í”„ë¼ì˜ ë¹„ìš© ì˜í–¥ì„ ë¶„ì„í•˜ê³  ë¹„ìš© ê´€ë¦¬ë¥¼ ì ìš©í•˜ëŠ” íŒŒíŠ¸ë„ˆ</li>
              <li><strong>ê´€ì°°ì„±/ëª¨ë‹ˆí„°ë§</strong> : ì„±ëŠ¥ì˜ ê°€ì‹œì„±ì„ ì œê³µí•˜ê±°ë‚˜ ì¸í”„ë¼ ë³€ê²½ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ìµœì ì˜ ê´€ì°°ì„±ì„ ë³´ì¥í•˜ëŠ” ë° ì¤‘ì ì„ ë‘” íŒŒíŠ¸ë„ˆ</li>
              <li><strong>ë³´ì•ˆ</strong> : ë³´ì•ˆ ë° ì¤€ìˆ˜ ì •ì±…ì— ë§ì§€ ì•ŠëŠ” Terraform êµ¬ì„± ì˜¤ë¥˜ë¥¼ ê°ì§€í•˜ëŠ” íŒŒíŠ¸ë„ˆ</li>
              <li><strong>ê°ì‚¬</strong> : ë©€í‹° í´ë¼ìš°ë“œ ì¸í”„ë¼ ìì›ì„ ê´€ë¦¬í•˜ì—¬ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì„ ë°©ì§€í•˜ê³ , ê±°ë²„ë„ŒìŠ¤ë¥¼ ê°œì„ í•˜ë©°, íš¨ìœ¨ì„±ì„ ë†’ì´ëŠ” ë° ë„ì›€ì„ ì£¼ëŠ” íŒŒíŠ¸ë„ˆ</li>
              <li><strong>ë…¸ ì½”ë“œ/ë¡œìš° ì½”ë“œ</strong> : IT, ê³µê¸‰ë§, ìš´ì˜ ê´€ë¦¬, ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ë¦¬ ë° ê¸°íƒ€ ì›Œí¬í”Œë¡œìš°ì˜ êµ¬í˜„, ë°°í¬ ë° ì „ë‹¬ì— ì¤‘ì ì„ ë‘” íŒŒíŠ¸ë„ˆ</li>
              <li><strong>SSO(Single Sign On)</strong> : ìµœì¢… ì‚¬ìš©ìê°€ ì•ˆì „í•˜ê²Œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡ ì¸ì¦ì— ì¤‘ì ì„ ë‘” íŒŒíŠ¸ë„ˆ</li>
              <li><strong>CI/CD</strong> : ì§€ì†ì  í†µí•© ë° ì§€ì†ì  ì „ë‹¬/ë°°í¬ì— ì¤‘ì ì„ ë‘” íŒŒíŠ¸ë„ˆ</li>
              <li><strong>VCS</strong> : ì†Œí”„íŠ¸ì›¨ì–´ ì½”ë“œ ë³€ê²½ì„ ì¶”ì í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë° ì¤‘ì ì„ ë‘” íŒŒíŠ¸ë„ˆ</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ íŒŒíŠ¸ë„ˆ : ëª¨ë“  í…Œë¼í¼ ì—ë””ì…˜ì„ ì§€ì›í•˜ë©°, ìì‹ ë“¤ì˜ í”Œë«í¼ì˜ APIë¥¼ í†µí•´ ë¦¬ì†ŒìŠ¤ë¥¼ í™œìš©í•  ìˆ˜ ìˆê²Œ
í•˜ëŠ” íŒŒíŠ¸ë„ˆì…ë‹ˆë‹¤. ëŒ€í‘œì ìœ¼ë¡œ í¼ë¸”ë¦­ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ì—…ì²´ì¸ AWS, Azure, GCPì™€ PaaS ì¸ Heroku, SaaS ì„œë¹„ìŠ¤ì¸
DNSimple, CloudFlare ë“±ì´ ìˆìŠµë‹ˆë‹¤.
        <ul>
          <li>ì›Œí¬ í”Œë¡œìš° íŒŒíŠ¸ë„ˆì˜ ìœ í˜•
            <ul>
              <li><strong>í¼ë¸”ë¦­ í´ë¼ìš°ë“œ</strong> : ëŒ€ê·œëª¨ ê¸€ë¡œë²Œ í´ë¼ìš°ë“œ ì œê³µì—…ì²´ë¡œ IaaS, SaaS, PaaSë¥¼ í¬í•¨í•œ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µ</li>
              <li><strong>ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜</strong> : ì»¨í…Œì´ë„ˆ í”„ë¡œë¹„ì €ë‹ ë° ë°°í¬ë¥¼ ê´€ë¦¬</li>
              <li><strong>IaaS(Infrastructure-as-a-Service)</strong> : ìŠ¤í† ë¦¬ì§€, ë„¤íŠ¸ì›Œí‚¹, ê°€ìƒí™”ì™€ ê°™ì€ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ëŠ” ì¸í”„ë¼ ë° IaaS ì œê³µ</li>
              <li><strong>ë³´ì•ˆ ë° ì¸ì¦</strong> : ì¸ì¦ ë° ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ í”Œë«í¼ì„ ì œê³µ</li>
              <li><strong>ìì‚° ê´€ë¦¬</strong> : ì†Œí”„íŠ¸ì›¨ì–´ ë¼ì´ì„ ìŠ¤, í•˜ë“œì›¨ì–´ ìì‚°, í´ë¼ìš°ë“œ ë¦¬ì†ŒìŠ¤ë¥¼ í¬í•¨í•œ ì£¼ìš” ì¡°ì§ ë° IT ë¦¬ì†ŒìŠ¤ì˜ ìì‚° ê´€ë¦¬ë¥¼ ì œê³µ</li>
              <li><strong>CI/CD</strong> : ì§€ì†ì  í†µí•© ë° ì§€ì†ì  ì „ë‹¬/ë°°í¬</li>
              <li><strong>ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§</strong> : ë¡œê±°, ë©”íŠ¸ë¦­ ë„êµ¬, ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ì™€ ê°™ì€ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì„±í•˜ê³  ê´€ë¦¬</li>
              <li><strong>ìœ í‹¸ë¦¬í‹°</strong> : ëœë¤ ê°’ ìƒì„±, íŒŒì¼ ìƒì„±, http ìƒí˜¸ì‘ìš©, ì‹œê°„ ê¸°ë°˜ ë¦¬ì†ŒìŠ¤ì™€ ê°™ì€ ë„ì›€ ê¸°ëŠ¥ì„ ì œê³µ</li>
              <li><strong>í´ë¼ìš°ë“œ ìë™í™”</strong> : êµ¬ì„± ê´€ë¦¬ì™€ ê°™ì€ íŠ¹ìˆ˜ í´ë¼ìš°ë“œ ì¸í”„ë¼ ìë™í™” ê´€ë¦¬</li>
              <li><strong>ë°ì´í„° ê´€ë¦¬</strong> : ë°ì´í„° ì„¼í„° ì €ì¥ì†Œ, ë°±ì—…, ë³µêµ¬ ì†”ë£¨ì…˜ ì œê³µ</li>
              <li><strong>ë„¤íŠ¸ì›Œí‚¹</strong> : ë¼ìš°íŒ…, ìŠ¤ìœ„ì¹­, ë°©í™”ë²½, SD-WAN ì†”ë£¨ì…˜ê³¼ ê°™ì€ ë„¤íŠ¸ì›Œí¬ íŠ¹ì • í•˜ë“œì›¨ì–´ ë° ê°€ìƒí™” ì œí’ˆê³¼ í†µí•©</li>
              <li><strong>VCS(Version Control System)</strong> : Terraform ë‚´ì—ì„œ VCS í”„ë¡œì íŠ¸, íŒ€, ì €ì¥ì†Œì— ì¤‘ì ì„ ë‘ </li>
              <li><strong>í†µì‹  ë° ë©”ì‹œì§•</strong> : í†µì‹ , ì´ë©”ì¼, ë©”ì‹œì§• í”Œë«í¼ê³¼ í†µí•©</li>
              <li><strong>ë°ì´í„°ë² ì´ìŠ¤</strong> : ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê³  êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µ</li>
              <li><strong>PaaS(Platform-as-a-Service)</strong> : ì´ë“¤ì€ í•˜ë“œì›¨ì–´, ì†Œí”„íŠ¸ì›¨ì–´, ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ ë„êµ¬ë¥¼ í¬í•¨í•œ ë‹¤ì–‘í•œ ë²”ìœ„ë¥¼ ì œê³µí•˜ëŠ” í”Œë«í¼ ë° PaaS ì œê³µ</li>
              <li><strong>ì›¹ ì„œë¹„ìŠ¤</strong> : ì›¹ í˜¸ìŠ¤íŒ…, ì›¹ ì„±ëŠ¥, CDN ë° DNS ì„œë¹„ìŠ¤</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ìƒíƒœ-state">ìƒíƒœ (State)</h2>

<h3 id="stateì˜-ëª©ì ê³¼-ì˜ë¯¸">Stateì˜ ëª©ì ê³¼ ì˜ë¯¸</h3>

<p>í…Œë¼í¼ì˜ <code class="language-plaintext highlighter-rouge">State</code>ëŠ” í…Œë¼í¼ì´ ê´€ë¦¬í•˜ëŠ” ì¸í”„ë¼ì˜ í˜„ì¬ ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.
ê·¸ ë™ì‘ì˜ íŠ¹ì§•ì„ ì•Œì•„ ë³´ê¸°ìœ„í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ <code class="language-plaintext highlighter-rouge">State</code>ì˜ ëª©ì ê³¼ ì˜ë¯¸ë¥¼ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
ê¸°ë³¸ì ìœ¼ë¡œ `terraform.tfstate íŒŒì¼ì— ì €ì¥ë˜ë©°, ì´ íŒŒì¼ì€ JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</p>
<ul>
  <li>ì‹¤ìŠµ
    <ul>
      <li>main.tf ìƒì„±
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span>  <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span>       <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-study"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
    
<span class="c"># ìƒíƒœ íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate  
<span class="c"># =&gt; ...</span>
<span class="c">#    "serial": 1,</span>
<span class="c">#    ...</span>
<span class="c">#    "instances": [ </span>
<span class="c">#       { "id": "vpc-0bebcf57eff3753a3",</span>
<span class="c">#         "tags": { "Name": "t101-study" }, </span>
<span class="c">#    ...</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.id"</span> | terraform console
<span class="c"># =&gt; "vpc-0bebcf57eff3753a3"</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.tags.Name"</span> | terraform console
<span class="c"># =&gt; "t101-study"</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">main.tf</code>ì˜ íƒœê·¸ ìˆ˜ì • ìˆ˜ì •
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span>  <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span>       <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"Warmachine Rox"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
    
<span class="c"># ìƒíƒœ íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate  
<span class="c"># =&gt; ...</span>
<span class="c">#    "serial": 1,</span>
<span class="c">#    ...</span>
<span class="c">#    "instances": [ </span>
<span class="c">#       { "id": "vpc-0bebcf57eff3753a3",</span>
<span class="c">#         "tags": { "Name": "Warmachine Rox" }, </span>
<span class="c">#    ...</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.id"</span> | terraform console
<span class="c"># =&gt; "vpc-0bebcf57eff3753a3"</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.tags.Name"</span> | terraform console
<span class="c"># =&gt; "Warmachine Rox"</span>
</code></pre></div>        </div>
      </li>
      <li>ìƒíƒœë¹„êµ
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff terraform.tfstate terraform.tfstate.backup
4c4
&lt;   <span class="s2">"serial"</span>: 3,
<span class="nt">---</span>
<span class="o">&gt;</span>   <span class="s2">"serial"</span>: 1,
39c39
&lt;               <span class="s2">"Name"</span>: <span class="s2">"Warmachine Rox"</span>
<span class="nt">---</span>
<span class="o">&gt;</span>               <span class="s2">"Name"</span>: <span class="s2">"t101-study"</span>
42c42
&lt;               <span class="s2">"Name"</span>: <span class="s2">"Warmachine Rox"</span>
<span class="nt">---</span>
<span class="o">&gt;</span>               <span class="s2">"Name"</span>: <span class="s2">"t101-study"</span> 
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ìœ„ì™€ ê°™ì´ ìƒíƒœê°€ ê´€ë¦¬ë˜ëŠ” íŒŒì¼ì¸ <code class="language-plaintext highlighter-rouge">terraform.tfstate</code>ì— ìµœê·¼ ì ìš© ìƒíƒœê°€ ì ìš©ë©ë‹ˆë‹¤.</li>
</ul>

<h4 id="ë©±ë“±ì„±-idempotency">ë©±ë“±ì„± (Idempotency)</h4>
<ul>
  <li>ì´ë ‡ê²Œ ì €ì¥ëœ ìƒíƒœëŠ” ë©±ë“±ì„±ë¥¼ ì œê³µí•˜ëŠ”ë° í™œìš©ë©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">terraform plan</code>ì´ë‚˜ <code class="language-plaintext highlighter-rouge">terraform apply</code>ë¥¼ í–ˆì„ë•Œ, í”„ë¡œë¹„ì €ë‹ëœ ë¦¬ì†ŒìŠ¤ì™€ <code class="language-plaintext highlighter-rouge">.tf</code> íŒŒì¼ì˜ ë¦¬ì†ŒìŠ¤ê°€ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´
í…Œë¼í¼ì€ <code class="language-plaintext highlighter-rouge">.tf</code> íŒŒì¼ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ í”„ë¡œë¹„ì €ë‹ëœ ë¦¬ì†ŒìŠ¤ì™€ ì¼ì¹˜í•˜ë„ë¡ ë³€ê²½í•©ë‹ˆë‹¤.
ì´ë•Œ í”„ë¡œë¹„ì €ë‹ëœ ë¦¬ì†ŒìŠ¤ì™€ <code class="language-plaintext highlighter-rouge">.tf</code> íŒŒì¼ì˜ ë¦¬ì†ŒìŠ¤ê°€ ê°™ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ë¦¬í‚¤ê³  ìˆëŠ”ì§€ ì•„ëŠ”ë°
<code class="language-plaintext highlighter-rouge">id</code>ê°’ ë“±ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>ì¦‰, ìƒíƒœ íŒŒì¼ì— ë¬¸ì œê°€ ìƒê¸¸ ê²½ìš° ê¸°ì¡´ì— ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì¶”ì ì´ ë¶ˆê°€ëŠ¥í•´ì ¸ì„œ
ì‹¤ì œë¡œëŠ” ë¦¬ì†ŒìŠ¤ê°€ ì¡´ì¬í•´ë„ í…Œë¼í¼ ì…ì¥ì—ì„œëŠ” ì—†ëŠ”ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ê°€ ë©ë‹ˆë‹¤.</li>
  <li>ì´ë ‡ê²Œ ì¤‘ìš”í•˜ê¸° ë•Œë¬¸ì— ìƒíƒœ íŒŒì¼ì€ í…Œë¼í¼ì—ì„œë§Œ ê´€ë¦¬ë˜ë„ë¡ í•˜ê³ ,
<strong>ì§ì ‘ í¸ì§‘í•˜ê±°ë‚˜ ì‘ì„±í•˜ê±°ë‚˜ ì‚­ì œí•˜ë©´ ì•ˆë©</strong>ë‹ˆë‹¤.</li>
</ul>

<h4 id="ìƒíƒœ-íŒŒì¼ì„-íŒ€-ë‹¨ìœ„ì—ì„œ-í…Œë¼í¼-ìš´ì˜ì‹œ-ë¬¸ì œì ">ìƒíƒœ íŒŒì¼ì„ íŒ€ ë‹¨ìœ„ì—ì„œ í…Œë¼í¼ ìš´ì˜ì‹œ ë¬¸ì œì </h4>
<ul>
  <li>ë¡œì»¬ì˜ ìƒíƒœ íŒŒì¼ì€ íŒ€ ë‹¨ìœ„ì—ì„œ ìš´ì˜ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ì–´ë ¤ì›€ì´ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>ìƒíƒœ íŒŒì¼ì€ ìµœì¢… ìƒíƒœë¥¼ ê°–ê³  ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ëª¨ë“  íŒ€ì›ë“¤ì´ ë™ì¼í•œ ìƒíƒœ íŒŒì¼ì„ ê°–ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>ë‘ëª…ì´ìƒì´ ë™ì‹œì— ì ìš©í•˜ëŠ”ê²ƒì„ ë§‰ê¸° ìœ„í•´ ìƒíƒœ íŒŒì¼ì„ ì ê·¸ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
      <li>ê°œë°œ ë‹¨ê³„, ìŠ¤í…Œì´ì§• ë‹¨ê³„, í”„ë¡œë•ì…˜ ë‹¨ê³„ ë“± ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ ê° í™˜ê²½ë³„ë¡œ ìƒíƒœíŒŒì¼ì„ ê²©ë¦¬í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ìƒíƒœíŒŒì¼ì—ëŠ” <code class="language-plaintext highlighter-rouge">sensitive=true</code>ì¸ ë¯¼ê°í•œ ê°’ë„ í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ìƒíƒœíŒŒì¼ì„ VCSë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì˜ ë¬¸ì œì 
    <ul>
      <li>ìˆ˜ë™ ì˜¤ë¥˜
        <ul>
          <li>ìƒíƒœ íŒŒì¼ì˜ ìµœì‹  ë³€ê²½ ì‚¬í•­ì„ ê°€ì ¸ì˜¤ê±°ë‚˜, ë³€ê²½ ë˜ì—ˆì„ë•Œ push í•˜ëŠ”ê²ƒì„ ìŠê¸° ì‰½ìŠµë‹ˆë‹¤.</li>
          <li>ìƒíƒœ íŒŒì¼ì„ ì˜ëª» ë³‘í•©í•˜ê±°ë‚˜, ì˜ëª»ëœ ìƒíƒœ íŒŒì¼ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>ì ê¸ˆ
        <ul>
          <li>VCS ì‚¬ìš©ì‹œ ì ê¸ˆ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>ë¯¼ê°í•œ ì •ë³´
        <ul>
          <li>ë¯¼ê°í•œ ì •ë³´ê°€ í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë˜ì–´ VCS ì— ê¶Œí•œì´ ìˆëŠ” ì‚¬ëŒì€ ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆì–´ì„œ ë…¸ì¶œ ìœ„í˜‘ì´ ìˆìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•´ í…Œë¼í¼ í´ë¼ìš°ë“œì—ì„œëŠ” ì•ˆì „í•˜ê²Œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
</ul>

<h4 id="ì›ê²©ì§€ì›-ë°±ì—”ë“œ">ì›ê²©ì§€ì› ë°±ì—”ë“œ</h4>
<ul>
  <li>í…Œë¼í¼ í´ë¼ìš°ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ” ì›ê²© ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì–´ëŠì •ë„ í•´ê²°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    <ul>
      <li>ìˆ˜ë™ ì˜¤ë¥˜ í•´ê²° : plan/apply ì‹œ ë°±ì—”ë“œì— ìµœì‹ ì˜ ìƒíƒœê°€ ì €ì¥ ë©ë‹ˆë‹¤.</li>
      <li>ì ê¸ˆ : ë°±ì—”ë“œì—ì„œ ì ê¸ˆ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">-lock-timeout=&lt;TIME&gt;</code>ë¡œ ì ê¸ˆ ëŒ€ê¸° ì‹œê°„ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ë¯¼ê°í•œ ì •ë³´ : ëŒ€ë¶€ë¶„ì˜ ë°±ì—”ë“œëŠ” ë¯¼ê°í•œ ì •ë³´ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤. ë˜í•œ ê¶Œí•œê´€ë¦¬ ê¸°ëŠ¥ìœ¼ë¡œ ìƒíƒœ íŒŒì¼ì— ëŒ€í•œ ì ‘ê·¼ì„ ì°¨ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì›ê²© ë°±ì—”ë“œ ì¢…ë¥˜ : AWS S3, Azure Blob Storage, Google Cloud Storage, HashiCorp Consul ë“±</li>
</ul>

<h4 id="state-ë™ê¸°í™”">State ë™ê¸°í™”</h4>

<ul>
  <li>í…Œë¼í¼ì€ êµ¬ì„± íŒŒì¼ê³¼ ê¸°ì¡´ Stateì™€ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì„ ë¹„êµí•˜ì—¬ ë³€ê²½ ì‚¬í•­ì„ ì°¾ì•„ë‚´ê³  ì ìš©í•©ë‹ˆë‹¤.
    <ul>
      <li>í…Œë¼í¼ êµ¬ì„±ê³¼ State íë¦„
<img src="/assets/2024/t101-4th/20240704_terraform_w4_state_sync.png" alt="img.png" />
ì¶œì²˜ : <a href="https://kschoi728.tistory.com/135">https://kschoi728.tistory.com/135</a>
        <ul>
          <li>planê³¼ apply ì¤‘ ë¦¬ì†ŒìŠ¤ì— ë°œìƒí•  ìˆ˜ ìˆëŠ” ë„¤ ê°€ì§€ ë³€ê²½ ì‚¬í•­ì´ ìˆê³ , ì•„ë˜ì˜ ì¶œë ¥ ê¸°í˜¸ë¡œ í‘œì‹œ ë˜ì—ˆìŠµë‹ˆë‹¤.
            <ul>
              <li><code class="language-plaintext highlighter-rouge">+ create</code> : ë¦¬ì†ŒìŠ¤ì˜ ìƒì„±</li>
              <li><code class="language-plaintext highlighter-rouge">- destroy</code> : ë¦¬ì†ŒìŠ¤ì˜ ì‚­ì œ</li>
              <li><code class="language-plaintext highlighter-rouge">-/+ replace</code> : ì‚­ì œ í›„ ìƒì„± (<code class="language-plaintext highlighter-rouge">lifecycle</code>ì˜ <code class="language-plaintext highlighter-rouge">create_before_destroy</code> ì„¤ì •ì‹œ ìƒì„± í›„ ì‚­ì œ ì„¤ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.)</li>
              <li><code class="language-plaintext highlighter-rouge">~ update in-place</code> : ë¦¬ì†ŒìŠ¤ê°€ ìˆëŠ” ìƒíƒœì—ì„œ ì¼ë¶€ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ìœ í˜•ë³„ ì‹¤ìŠµ + ë¬¸ì œì‚¬í•­ -&gt; ë³µêµ¬ import
    <ul>
      <li>
        <p>í…Œë¼í¼ êµ¬ì„±ì— ì¶”ê°€ëœ ë¦¬ì†ŒìŠ¤ì™€ Stateì— ë”°ë¼ ì–´ë–¤ ë™ì‘ì´ ë°œìƒí•˜ëŠ”ì§€ í‘œë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

        <table>
          <thead>
            <tr>
              <th>ìœ í˜•</th>
              <th>êµ¬ì„± ë¦¬ì†ŒìŠ¤ ì •ì˜(.tf)</th>
              <th>State êµ¬ì„± ë°ì´í„°</th>
              <th>ì‹¤ì œ ë¦¬ì†ŒìŠ¤</th>
              <th>ê¸°ë³¸ ì˜ˆìƒ ë™ì‘</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>ìˆìŒ</td>
              <td>Â </td>
              <td>Â </td>
              <td>ë¦¬ì†ŒìŠ¤ ìƒì„±</td>
            </tr>
            <tr>
              <td>2</td>
              <td>ìˆìŒ</td>
              <td>ìˆìŒ</td>
              <td>Â </td>
              <td>ë¦¬ì†ŒìŠ¤ ìƒì„±</td>
            </tr>
            <tr>
              <td>3</td>
              <td>ìˆìŒ</td>
              <td>ìˆìŒ</td>
              <td>ìˆìŒ</td>
              <td>ë™ì‘ ì—†ìŒ</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Â </td>
              <td>ìˆìŒ</td>
              <td>ìˆìŒ</td>
              <td>ë¦¬ì†ŒìŠ¤ ì‚­ì œ</td>
            </tr>
            <tr>
              <td>5</td>
              <td>Â </td>
              <td>Â </td>
              <td>ìˆìŒ</td>
              <td>ë™ì‘ ì—†ìŒ</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>ìœ í˜• 1 : ì‹ ê·œ ë¦¬ì†ŒìŠ¤ ì •ì˜ -&gt; Apply -&gt; ë¦¬ì†ŒìŠ¤ ìƒì„±
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"peter_test"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_iam_user"</span> <span class="s2">"peter_iamuser1"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">1"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_iam_user"</span> <span class="s2">"peter_iamuser2"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">2"</span>
<span class="p">}</span>     
</code></pre></div>        </div>
        <ul>
          <li>ì‹¤í–‰
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì²«ë²ˆì§¸ ì‹¤í–‰. ê¸°ì¡´ì— iam ì´ ì—†ê¸° ë•Œë¬¸ì— ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.</span>
      
<span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span>
      
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> terraform.tfstate
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq 
      
<span class="c"># main.tf ìˆ˜ì •ì—†ì´ ë‘ë²ˆì§¸ ì‹¤í–‰. ë³€ê²½ì‚¬í•­ì´ ì—†ê¸° ë•Œë¬¸ì— ì•„ë¬´ëŸ° ë™ì‘ì„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ìœ í˜• 3)</span>
      
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; No changes. Your infrastructure matches the configuration.</span>
<span class="c">#    ...</span>
<span class="c">#    Apply complete! Resources: 0 added, 0 changed, 0 destroyed.</span>
      
<span class="c"># iam ì‚¬ìš©ì ë¦¬ìŠ¤íŠ¸ í™•ì¸</span>
<span class="nv">$ </span>aws iam list-users | jq
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>ìœ í˜• 2 : ì‹¤ì œ ë¦¬ì†ŒìŠ¤ ìˆ˜ë™ì œê±° -&gt; Apply =&gt; ë¦¬ì†ŒìŠ¤ ìƒì„±
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì‹¤ì œ ë¦¬ì†ŒìŠ¤ ìˆ˜ë™ ì œê±°</span>
<span class="nv">$ </span>aws iam delete-user <span class="nt">--user-name</span> peter_test1
<span class="nv">$ </span>aws iam delete-user <span class="nt">--user-name</span> peter_test2
    
<span class="c"># iam ì‚¬ìš©ì ë¦¬ìŠ¤íŠ¸ì—ì„œ ì‹¤ì œ ì‚­ì œë¨ì„ í™•ì¸ </span>
<span class="nv">$ </span>aws iam list-users | jq
    
<span class="nv">$ </span>terraform plan
<span class="c"># =&gt; ...</span>
<span class="c">#    Plan: 2 to add, 0 to change, 0 to destroy.</span>
</code></pre></div>        </div>
        <p>ì´ì™€ ê°™ì´ ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì •ì˜(main.tf)ì„ ìˆ˜ì •í•˜ì§€ ì•Šê³  ì‹¤ì œ ë¦¬ì†ŒìŠ¤ê°€ ì œê±°ë˜ë©´
í…Œë¼í¼ì´ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ì™€ ìƒíƒœ íŒŒì¼ì„ ë¹„êµí•´ì„œ ì°¨ì´ë¥¼ ì¸ì§€í•˜ê³  ë™ì¼í•˜ê²Œ ìƒíƒœë¥¼ ë§Œë“¤ê¸°ìœ„í•´ 
ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ë ¤ í•©ë‹ˆë‹¤.</p>
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform plan <span class="nt">-refresh</span><span class="o">=</span><span class="nb">false</span>
<span class="c"># =&gt; No changes. Your infrastructure matches the configuration.</span>
</code></pre></div>        </div>
        <p>í•˜ì§€ë§Œ <code class="language-plaintext highlighter-rouge">-refresh=false</code> ì˜µì…˜ì„ ì£¼ì–´ ê°•ì œë¡œ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ë¥¼ refresh í•˜ì§€ ì•Šë„ë¡ í•˜ë©´
ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì •ì˜ì™€ ìƒíƒœ íŒŒì¼ë§Œì„ ë¹„êµí•˜ê²Œ ë©ë‹ˆë‹¤.
<code class="language-plaintext highlighter-rouge">-refresh=false</code> ì„ ì¤€ ìƒíƒœì—ì„œëŠ” ìƒíƒœíŒŒì¼ê³¼ ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì •ì˜ê°€ ì¼ì¹˜í•˜ë¯€ë¡œ ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>

        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Apply complete! Resources: 2 added, 0 changed, 0 destroyed. </span>
</code></pre></div>        </div>
        <p><code class="language-plaintext highlighter-rouge">-refresh=false</code> ì˜µì…˜ì„ ì£¼ì§€ ì•Šê³  <code class="language-plaintext highlighter-rouge">apply</code> ì‹œí‚¤ë©´ í…Œë¼í¼ì´ ë˜‘ë˜‘í•˜ê²Œ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ì™€ì˜ ì°¨ì´ë¥¼ ì¸ì‹í•˜ì—¬
ìˆ˜ë™ ì œê±°ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
      </li>
      <li>ìœ í˜• 3 : ì½”ë“œ, ìƒíƒœ, ì‹¤ì œ ë¦¬ì†ŒìŠ¤ê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq .serial
<span class="c"># =&gt; 8 </span>

<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq .serial
<span class="c"># =&gt; 8 </span>

<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq .serial
<span class="c"># =&gt; 8 </span>
</code></pre></div>        </div>
        <p>ì½”ë“œ, ìƒíƒœ, ì‹¤ì œ ë¦¬ì†ŒìŠ¤ê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš° ì•„ë¬´ ë™ì‘ì„ í•˜ì§€ ì•Šìœ¼ë©° ìƒíƒœíŒŒì¼ì˜ <code class="language-plaintext highlighter-rouge">serial</code>ë„ ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      </li>
      <li>ìœ í˜• 4 : ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì •ì˜ì—ì„œ ì¼ë¶€ ë¦¬ì†ŒìŠ¤ ì‚­ì œ -&gt; Apply
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf </span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"peter_test"</span>
<span class="p">}</span>
      
<span class="k">resource</span> <span class="s2">"aws_iam_user"</span> <span class="s2">"peter_iamuser1"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">1"</span>
<span class="p">}</span>
      
<span class="c1"># peter_test2 ë¦¬ì†ŒìŠ¤ë¥¼ êµ¬ì„±ì •ì˜ì—ì„œ ì‚­ì œ</span>
</code></pre></div>        </div>
        <ul>
          <li>ì‹¤í–‰
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Apply complete! Resources: 0 added, 0 changed, 1 destroyed.</span>
        
<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.tfstate
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
             
<span class="c"># iam ì‚¬ìš©ì ë¦¬ìŠ¤íŠ¸ì—ì„œ ì‚­ì œë¨ì„ í™•ì¸</span>
<span class="nv">$ </span>aws iam list-users | jq
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>ìœ í˜• 5 : ì‹¤ì œ ë¦¬ì†ŒìŠ¤ë§Œ ì¡´ì¬í•˜ëŠ” ê²½ìš°
ìƒíƒœíŒŒì¼ì—ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ì¡´ì¬í•˜ì§€ ì•Šì§€ë§Œ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ëŠ” ì¡´ì¬í•˜ëŠ” ê²½ìš°
í…Œë¼í¼ê³¼ ì—°ê²°ê³ ë¦¬ê°€ ì—†ê¸° ë•Œë¬¸ì—, ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ëŠ” í…Œë¼í¼ì—ì„œëŠ” ì—†ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.
ë˜í•œ ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì •ì˜ íŒŒì¼ì—ë„ ì—†ê¸° ë•Œë¬¸ì— ì•„ë¬´ëŸ° ë™ì‘ì„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
      <li>ìœ í˜• 6 : ì‹¤ìˆ˜ë¡œ tfstate íŒŒì¼ì´ ì‚­ì œ ëœ ê²½ìš°
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform state list
<span class="c"># =&gt; aws_iam_user.peter_iamuser1</span>
    
<span class="c"># ìƒíƒœ íŒŒì¼ ì‚­ì œ</span>
<span class="nv">$ </span><span class="nb">rm </span>terraform.tfstate<span class="k">*</span>
    
<span class="c"># terraform planì‹œ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ì— ì—°ê²°ê³ ë¦¬ê°€ ì—†ê¸° ë•Œë¬¸ì—, ì‹¤ì œ ë¦¬ì†ŒìŠ¤ê°€ ì—†ë‹¤ê³  íŒí•œí•˜ê³  ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ë ¤ í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>terraform plan
<span class="c"># =&gt; Plan: 1 to add, 0 to change, 0 to destroy.</span>
    
<span class="c"># ì‹¤ì œ ë¦¬ì†ŒìŠ¤ë¥¼ í™•ì¸í•´ë³´ë©´ ì¡´ì¬í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>aws iam list-users | jq 
    
<span class="c"># í˜„ì¬ ìƒíƒœì—ì„œ ì ìš©ì‹œ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” IAMì„ ë§Œë“¤ë ¤í•œë‹¤ê³  ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Error: creating IAM User (peter_test1): operation error IAM: CreateUser, ...</span>
    
<span class="c"># ìƒíƒœ ë³´ê¸°ë¥¼ í•˜ë©´ ìƒíƒœ íŒŒì¼ì´ ì—†ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; No state file was found!</span>
</code></pre></div>        </div>
        <p>ìƒíƒœ íŒŒì¼ì´ ì‚­ì œë˜ë©´ ì—°ê²°ê³ ë¦¬ê°€ ì—†ì–´ì§€ë©´ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ë ¤ í•˜ì§€ë§Œ, ì‹¤ì œ ë¦¬ì†ŒìŠ¤ì— ë™ì¼í•œ ì´ë¦„ì˜ IAMì´ ì¡´ì¬í•˜ì—¬ ì‹¤íŒ¨í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
        <ul>
          <li>í•´ê²° ë°©ë²• : <code class="language-plaintext highlighter-rouge">import</code> ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ state íŒŒì¼ì„ ë³µêµ¬í•©ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>ìœ í˜• 7 : ì‹¤ìˆ˜ë¡œ ì‚­ì œëœ tfstateë¥¼ importë¡œ ë³µêµ¬
        <ul>
          <li><code class="language-plaintext highlighter-rouge">terraform import</code> ëª…ë ¹ì€ ê¸°ì¡´ì— ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ë¥¼ í…Œë¼í¼ì˜ ìƒíƒœ íŒŒì¼ì— ì¶”ê°€í•˜ëŠ” ëª…ë ¹ì…ë‹ˆë‹¤.
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì‹¤ì œ IAM ì‚¬ìš©ì ë¦¬ìŠ¤íŠ¸ í™•ì¸</span>
<span class="nv">$ </span>aws iam list-users | jq
      
<span class="c"># ì‹¤ì œ IAM ì‚¬ìš©ìì˜ ì´ë¦„ì„ ê°€ì ¸ì™€ì„œ import ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>terraform import aws_iam_user.peter_iamuser1 peter_test1
<span class="c"># =&gt; aws_iam_user.peter_iamuser1: Importing from ID "peter_test1"...</span>
<span class="c">#    aws_iam_user.peter_iamuser1: Import prepared!</span>
<span class="c">#    Prepared aws_iam_user for import</span>
<span class="c">#    aws_iam_user.peter_iamuser1: Refreshing state... [id=peter_test1]</span>
<span class="c">#    </span>
<span class="c">#    Import successful!</span>
<span class="c">#    </span>
<span class="c">#    The resources that were imported are shown above. These resources are now in</span>
<span class="c">#    your Terraform state and will henceforth be managed by Terraform.</span>
      
<span class="c"># ìƒíƒœ íŒŒì¼ í™•ì¸í•˜ë©´ ìƒíƒœíŒŒì¼ì´ ìˆê³ , aws_iam_user ë¦¬ì†ŒìŠ¤ê°€ ì¶”ê°€ëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
      
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; aws_iam_user.peter_iamuser1</span>
      
<span class="c"># ì‹¤ì œ ë¦¬ì†ŒìŠ¤ì™€ ìƒíƒœ íŒŒì¼ì´ ì¼ì¹˜í•˜ì—¬ ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
</code></pre></div>            </div>
            <p>ì´ì™€ ê°™ì´ <code class="language-plaintext highlighter-rouge">terraform import</code> ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤ìˆ˜ë¡œ ì‚­ì œëœ ìƒíƒœ íŒŒì¼ì„ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ <code class="language-plaintext highlighter-rouge">import</code> ëª…ë ¹ì€ ì§€ì •í•œ ë¦¬ì†ŒìŠ¤ë§Œ ë³µêµ¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, <strong>ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë¥¼ ë³µêµ¬í•  ê²½ìš° ì–´ë ¤ì›€</strong>ì´ ë”°ë¦…ë‹ˆë‹¤.</p>
          </li>
          <li>ë”°ë¼ì„œ ìƒíƒœíŒŒì¼ì„ S3ì˜ ë²„ì „ê´€ë¦¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ë“± <strong>ìƒì–´ë²„ë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜</strong>í•´ì•¼ í•©ë‹ˆë‹¤.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="terraform-backend--aws-s3--dynamodb">Terraform Backend : AWS S3 + DynamoDB</h3>

<ul>
  <li>ì•ì„œ ì–¸ê¸‰í•œê²ƒ ì²˜ëŸ¼ ë¡œì»¬ì—ì„œ ìƒíƒœíŒŒì¼ì„ ê´€ë¦¬í•  ê²½ìš° ì—¬ëŸ¬ ë¬¸ì œì ì´ ìˆì–´ì„œ ê·¸ê²ƒì„ í•´ê²°í•˜ê¸° ìœ„í•´ AWS S3 ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ 
ëª¨ë“  íŒ€ì›ë“¤ì´ í•˜ë‚˜ì˜ ìƒíƒœë¥¼ ê³µìœ í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë‹¨, AWS <strong>S3ë§Œ ì‚¬ìš©ì‹œ ë™ì‹œì„± ì ê¸ˆ ê´€ë¦¬ê°€ ë˜ì§€ ì•Šê¸°</strong> ë•Œë¬¸ì—, <strong>DynamoDB ë¥¼ ì‚¬ìš©í•˜ì—¬ ì ê¸ˆì„ ìˆ˜í–‰í•˜ì—¬ ë³´ì™„</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<h4 id="ì•…ë¶„ë‹˜-ì‹¤ìŠµ-ë”°ë¼í•˜ê¸°">ì•…ë¶„ë‹˜ ì‹¤ìŠµ ë”°ë¼í•˜ê¸°</h4>

<p>AWS S3ì™€ DynamoDBë¥¼ ì‚¬ìš©í•œ ìƒíƒœ íŒŒì¼ ê´€ë¦¬ë¥¼ ì•…ë¶„ë‹˜ì´ ì •ë¦¬í•´ì£¼ì‹  ì‹¤ìŠµì„ ë”°ë¼í•˜ë©° ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
<a href="https://malwareanalysis.tistory.com/633#8.-state-%EB%B0%B1%EC%97%94%EB%93%9C">ì•…ë¶„ë‹˜ ë¸”ë¡œê·¸ ë§í¬</a></p>

<ul>
  <li>ì‚¬ì „ì¤€ë¹„ ë¦¬ëª¨íŠ¸ ê³µìš© ì €ì¥ì†Œ AWS S3 ìƒì„±
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/sungwook-practice/t101-study.git example
<span class="nv">$ </span><span class="nb">cd </span>example/state/step3_remote_backend/s3_backend 
  
<span class="c"># terraform.tfvars íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ ë²„í‚·ëª…ì„ bucket_name = "&lt;ë‹‰ë„¤ì„&gt;-hello-tf1014-remote-backend" ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.</span>
<span class="c"># ì €ì˜ ê²½ìš°ëŠ” bucket_name = "peter-hello-tf1014-remote-backend" ê°€ ë˜ê² ìŠµë‹ˆë‹¤.</span>
  
<span class="c"># S3 ë²„í‚· ìƒì„±</span>
<span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
  
<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>aws s3 <span class="nb">ls</span>
<span class="c"># =&gt; 2024-07-XX 01:07:50 peter-hello-tf1014-remote-backend </span>
</code></pre></div>    </div>
  </li>
  <li>í…Œë¼í¼ ë°±ì—”ë“œë¥¼ AWS S3ë¡œ ì„¤ì •
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> ../vpc
<span class="nv">$ </span><span class="nb">ls</span>
<span class="nv">$ </span><span class="nb">cat </span>provider.tf
</code></pre></div>    </div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">provider.tf</code> íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ ë°±ì—”ë“œë¥¼ S3ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
  <span class="c1"># bucket       = "&lt;ë‹‰ë„¤ì„&gt;-hello-tf1014-remote-backend"</span>
  <span class="nx">bucket</span>         <span class="p">=</span> <span class="s2">"peter-hello-tf1014-remote-backend"</span>
  <span class="nx">key</span>            <span class="p">=</span> <span class="s2">"terraform/state-test/terraform.tfstate"</span>
  <span class="nx">region</span>         <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
  <span class="c1"># dynamodb_table = "terraform-lock"</span>
<span class="p">}</span>
<span class="err">...</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">terraform init</code> ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ë°±ì—”ë“œ ì„¤ì •ì´ ì ìš©ë©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="c"># =&gt; Initializing the backend...</span>
<span class="c">#    Successfully configured the backend "s3"! Terraform will automatically</span>
<span class="c">#    ...    </span>
    
<span class="c"># ë¦¬ì†ŒìŠ¤ ìƒì„± </span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
    
<span class="nv">$ </span>terraform state list
    
<span class="c"># ìƒíƒœëŠ” ìˆì§€ë§Œ ìƒíƒœíŒŒì¼(terraform.tfstate)ì´ ì—†ìŒì„ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.tfstate
<span class="c"># =&gt; íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</span>
    
<span class="c"># AWS S3 ë²„í‚· ë‚´ì— tfstate íŒŒì¼ í™•ì¸</span>
<span class="nv">$ MYBUCKET</span><span class="o">=</span>peter-hello-tf1014-remote-backend
<span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://<span class="nv">$MYBUCKET</span> <span class="nt">--recursive</span> <span class="nt">--human-readable</span> <span class="nt">--summarize</span>
<span class="c"># =&gt; 2024-07-07 01:23:35    1.7 KiB terraform/state-test/terraform.tfstate</span>
<span class="c">#    Total Objects: 1</span>
<span class="c">#    Total Size: 1.7 KiB</span>
</code></pre></div>        </div>
        <p>ìƒíƒœê°€ ë¡œì»¬ íŒŒì¼ì´ ì•„ë‹Œ S3ì— ì €ì¥ë¨ì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ìƒíƒœì—ì„œëŠ” ë™ì‹œì„± ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— DynamoDBë¥¼ ì¶”ê°€í•˜ì—¬ ì ê¸ˆì„ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.</p>
      </li>
    </ul>
  </li>
  <li>DynamoDB ìƒì„±
    <ul>
      <li>í…Œë¼í¼ì—ì„œ DynamoDB ì ê¸ˆì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” LockID ë¼ëŠ” ê¸°ë³¸ í‚¤ê°€ ìˆëŠ” í…Œì´ë¸”ì„ ìƒì„±í•´ì•¼ ë©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> ../dynamodb
<span class="nv">$ </span><span class="nb">ls</span> 
<span class="nv">$ </span><span class="nb">cat </span>main.tf  
  
<span class="c"># DynamoDB ìƒì„±</span>
<span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
  
<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show aws_dynamodb_table.terraform_state_lock
  
<span class="c"># DynamoDB í…Œì´ë¸” í™•ì¸</span>
<span class="nv">$ </span>aws dynamodb list-tables <span class="nt">--output</span> text
<span class="c"># =&gt; TABLENAMES   terraform-lock</span>
<span class="nv">$ </span>aws dynamodb describe-table <span class="nt">--table-name</span> terraform-lock | jq
<span class="nv">$ </span>aws dynamodb describe-table <span class="nt">--table-name</span> terraform-lock <span class="nt">--output</span> table
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>í…Œë¼í¼ ë°±ì—”ë“œ ì„¤ì •ì— dynamodb_table ì†ì„±ì„ ì ìš©
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> ../vpc 
  
<span class="c"># vscodeì—ì„œ provider.tf ìˆ˜ì •</span>
<span class="nv">$ </span>code provider.tf 
</code></pre></div>    </div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">provider.tf</code> íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ <code class="language-plaintext highlighter-rouge">dynamodb_table = "terraform-lock"</code>ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
  <span class="nx">bucket</span>         <span class="p">=</span> <span class="s2">"peter-hello-tf1014-remote-backend"</span>
  <span class="nx">key</span>            <span class="p">=</span> <span class="s2">"terraform/state-test/terraform.tfstate"</span>
  <span class="nx">region</span>         <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
  <span class="nx">dynamodb_table</span> <span class="p">=</span> <span class="s2">"terraform-lock"</span>   <span class="c1"># ì¶”ê°€</span>
<span class="p">}</span>
<span class="err">...</span>
</code></pre></div>        </div>
      </li>
      <li>ë°±ì—”ë“œ ì„¤ì •ì´ ë°”ê¼ˆìœ¼ë¯€ë¡œ <code class="language-plaintext highlighter-rouge">terraform init</code> ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="nt">-migrate-state</span>
<span class="c"># =&gt; Initializing the backend...</span>
<span class="c">#    Backend configuration changed!</span>
<span class="c">#    ...</span>
</code></pre></div>        </div>
      </li>
      <li>VPCì˜ tag ìˆ˜ì • í›„ applyì™€ Locking í™•ì¸
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf ìˆ˜ì • </span>
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">vpc_cidr</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="c1"># Name = "terraform VPC"</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"terraform VPC 2"</span> <span class="c1"># 2ì¶”ê°€</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">apply</code>ë¥¼ ì‹¤í–‰í•˜ê³  â€œEnter a value:â€ì—ì„œ ëŒ€ê¸°í•˜ë©´ì„œ Dynamo DB í…Œì´ë¸”ì„ í™•ì¸í•©ë‹ˆë‹¤.
            <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply
<span class="c"># =&gt; ...</span>
<span class="c">#    Enter a value: &lt;ì…ë ¥í•˜ì§€ ì•Šê³  ëŒ€ê¸°&gt;</span>
</code></pre></div>            </div>
          </li>
          <li>
            <p>AWS Consoleì—ì„œ DynamoDBì˜ lock í…Œì´ë¸”ì„ í™•ì¸í•©ë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240704_terraform_w4_dynamo_lock.png" alt="20240704_terraform_w4_dynamo_lock.png" /></p>

            <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ID"</span><span class="p">:</span><span class="s2">"d210a853-3361-527a-dc34-8f6b310ba77b"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Operation"</span><span class="p">:</span><span class="s2">"OperationTypeApply"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Info"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Who"</span><span class="p">:</span><span class="s2">"peter"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"1.8.5"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Created"</span><span class="p">:</span><span class="s2">"2024-07-XXT16:38:55.21022Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Path"</span><span class="p">:</span><span class="s2">"peter-hello-tf1014-remote-backend/terraform/state-test/terraform.tfstate"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>            </div>
          </li>
          <li><code class="language-plaintext highlighter-rouge">apply</code>ì˜ â€œEnter a value:â€ì— <code class="language-plaintext highlighter-rouge">yes</code>ë¥¼ ì…ë ¥í•˜ì—¬ applyí•˜ë©´ ë½ì´ í•´ì œë©ë‹ˆë‹¤. ì´ ìƒíƒœì—ì„œ dynamodbë¥¼ í™•ì¸í•˜ë©´ lockì´ í•´ì œëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240704_terraform_w4_dynamo_unlock.png" alt="20240704_terraform_w4_dynamo_unlock.png" /></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>S3 ë²„ì €ë‹ ì •ë³´ í™•ì¸
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># S3 ë²„í‚·ì˜ íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://<span class="nv">$MYBUCKET</span> <span class="nt">--recursive</span> <span class="nt">--human-readable</span> <span class="nt">--summarize</span>
<span class="c"># =&gt; 2024-07-07 01:50:50    1.7 KiB terraform/state-test/terraform.tfstate</span>
<span class="c"># </span>
<span class="c">#    Total Objects: 1</span>
<span class="c">#    Total Size: 1.7 KiB</span>
  
<span class="c"># ë²„ì €ë‹ëœ íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span>aws s3api list-object-versions <span class="nt">--bucket</span> <span class="nv">$MYBUCKET</span> | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "Versions": [</span>
<span class="c">#        {</span>
<span class="c">#          "ETag": "\"f223f4da33dcd26ee1ee736212d57604\"",</span>
<span class="c">#          ...</span>
<span class="c">#          "Key": "terraform/state-test/terraform.tfstate",</span>
<span class="c">#          "VersionId": "wMK8alO1E2luobYHL1Bqj4RdbV1rLrv3",</span>
<span class="c">#          "IsLatest": true,</span>
<span class="c">#          "LastModified": "2024-07-XXT16:50:50+00:00",</span>
<span class="c">#          ...</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "ETag": "\"16bd360e57c83dee7ad657086cc8fc49\"",</span>
<span class="c">#          ...</span>
<span class="c">#          "Key": "terraform/state-test/terraform.tfstate",</span>
<span class="c">#          "VersionId": "8iagh8nWNMXeI.Ax5oEZJ38N684s5N3D",</span>
<span class="c">#          "IsLatest": false,</span>
<span class="c">#          "LastModified": "2024-07-XXT16:23:35+00:00",</span>
<span class="c">#          ...</span>
<span class="c">#        }</span>
<span class="c">#      ],</span>
<span class="c">#      "RequestCharged": null</span>
<span class="c">#    }</span>
</code></pre></div>    </div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">apply</code> ë˜ì–´ ìƒíƒœê°€ ë³€ê²½ ë˜ë©´ S3ì— ë²„ì €ë‹ëœ íŒŒì¼ì´ ìƒì„±ë¨ì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>S3 ì½˜ì†”ì˜ ë²„í‚·ì—ì„œë„ ë²„ì „ í‘œì‹œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240704_terraform_w4_backend_s3.png" alt="20240704_terraform_w4_backend_s3" /></li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤ ì‚­ì œ : ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ì§€ ì•Šìœ¼ë©´ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¼¼ê¼¼í•˜ê²Œ ì˜ ì‚­ì œí•˜ì—¬ ìš”ê¸ˆ í­íƒ„ì„ ë§‰ìì‹œë‹¤.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># vpc ì‚­ì œ : í˜„ì¬ vpc ë””ë ‰í„°ë¦¬</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
  
<span class="c"># dynamoDB ì‚­ì œ</span>
<span class="nv">$ </span><span class="nb">cd</span> ../dynamodb
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
  
<span class="c"># S3 ì‚­ì œ</span>
<span class="nv">$ </span><span class="nb">cd</span> ../s3_backend
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Error : (ë²„í‚·ì´ ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©° ì˜¤ë¥˜ ë°œìƒí•©ë‹ˆë‹¤.)</span>
  
<span class="c"># ë²„í‚· ë‚´ìš©ì„ ë¨¼ì € ì‚­ì œ í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>aws s3api delete-objects <span class="se">\</span>
    <span class="nt">--bucket</span> <span class="nv">$MYBUCKET</span> <span class="se">\</span>
    <span class="nt">--delete</span> <span class="s2">"</span><span class="si">$(</span>aws s3api list-object-versions <span class="se">\</span>
    <span class="nt">--bucket</span> <span class="s2">"</span><span class="nv">$MYBUCKET</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">--output</span><span class="o">=</span>json <span class="se">\</span>
    <span class="nt">--query</span><span class="o">=</span><span class="s1">'{Objects: Versions[].{Key:Key,VersionId:VersionId}}'</span><span class="si">)</span><span class="s2">"</span>
  
<span class="c"># S3 ë²„í‚·ì— ì‚­ì œë§ˆì»¤ ì‚­ì œ</span>
<span class="nv">$ </span>aws s3api delete-objects <span class="nt">--bucket</span> <span class="nv">$MYBUCKET</span> <span class="se">\</span>
    <span class="nt">--delete</span> <span class="s2">"</span><span class="si">$(</span>aws s3api list-object-versions <span class="nt">--bucket</span> <span class="s2">"</span><span class="nv">$MYBUCKET</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">--query</span><span class="o">=</span><span class="s1">'{Objects: DeleteMarkers[].{Key:Key,VersionId:VersionId}}'</span><span class="si">)</span><span class="s2">"</span>
  
<span class="c"># S3 ì‚­ì œ</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="í…Œë¼í¼-ë°±ì—”ë“œì˜-ë‹¨ì ">í…Œë¼í¼ ë°±ì—”ë“œì˜ ë‹¨ì </h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">backend</code> ë¸”ë¡ì—ëŠ” ë³€ìˆ˜ë‚˜ ì°¸ì¡°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
  <li>ë”°ë¼ì„œ S3 ë²„í‚· ì´ë¦„, ë¦¬ì „, DynamoDB í…Œì´ë¸” ì´ë¦„ì„ í•˜ë“œì½”ë”©í•´ì•¼ í•©ë‹ˆë‹¤. ì‹¬ì§€ì–´ key ê°’ì€ ì¤‘ë³µì´ ë˜ë©´ ì•ˆ ë˜ë©° ê³ ìœ í•´ì•¼ í•©ë‹ˆë‹¤.</li>
  <li>í•˜ì§€ë§Œ partial configuration ì„ ì‚¬ìš©í•˜ì—¬ ì¼ë¶€ ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì „ë‹¬í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># backend.hcl</span>
<span class="nx">bucket</span> <span class="err">=</span> <span class="s2">"terraform-up-and-running-state"</span>
<span class="nx">region</span> <span class="err">=</span> <span class="s2">"us-east-2"</span>
<span class="nx">dynamodb_table</span> <span class="err">=</span> <span class="s2">"terraform-Up-and-running-locks"</span>
<span class="nx">encrypt</span> <span class="err">=</span> <span class="kc">true</span> 
</code></pre></div>    </div>
    <ul>
      <li>ì´ ê²½ìš°ì—ë„ ëª¨ë“ˆë§ˆë‹¤ ë‹¤ë¥¸ key ê°’ì„ ê°€ì ¸ì•¼ í•˜ë¯€ë¡œ key ë§¤ê°œ ë³€ìˆ˜ëŠ” í…Œë¼í¼ ì½”ë“œì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">key</span> <span class="p">=</span> <span class="s2">"example/terraform.tfstate"</span>
  <span class="p">}</span>
<span class="p">}</span>   
</code></pre></div>        </div>
      </li>
      <li>ë¶€ë¶„ì ìœ¼ë¡œ êµ¬ì„±í•œ ê²ƒì„ ì‚¬ìš©í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">terraform init -backend-config=backend.hcl</code> ëª…ë ¹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="nt">-backend-config</span><span class="o">=</span>backend.hcl
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ì´ëŸ¬í•œ ë‹¨ì ì„ ë³´ì™„í•´ì£¼ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ í…Œë¼ê·¸ëŸ°íŠ¸(Terragrunt)ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ <a href="https://terragrunt.gruntwork.io/">ë§í¬</a>ë¥¼ ì°¸ê³ í•˜ì‹­ì‹œì˜¤.</li>
</ul>

<h3 id="ì›Œí¬ìŠ¤í˜ì´ìŠ¤">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</h3>

<ul>
  <li>ì¸í”„ë¼ë¥¼ êµ¬ì¶•í• ë•ŒëŠ” dev(ê°œë°œ), stage(ìŠ¤í…Œì´ì§€), prod(í”„ë¡œë•ì…˜) ë“± ê°œë°œ ë‹¨ê³„ë³„ë¡œ ê°ê° ë‹¤ë¥¸ í™˜ê²½ì„ êµ¬ì¶•í•´ì•¼ í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ëŸ¬í•œ í™˜ê²½ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ì„œëŠ” íŒŒì¼ ë ˆì´ì•„ì›ƒì„ ì‚¬ìš©í•˜ì—¬ ê²©ë¦¬í•˜ê±°ë‚˜ í…Œë¼í¼ì˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>íŒŒì¼ ë ˆì´ì•„ì›ƒì„ ì´ìš©í•œ ê²©ë¦¬ (Isolation via file layout)
    <ul>
      <li>íŒŒì¼ ë ˆì´ì•„ì›ƒì„ ì‚¬ìš©í•˜ì—¬ ê° í™˜ê²½ë³„ë¡œ ë””ë ‰í„°ë¦¬ë¥¼ ë‚˜ëˆ„ì–´ êµ¬ì„±í•˜ë©´ ê° í™˜ê²½ë³„ë¡œ êµ¬ì„±ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tree
<span class="c"># =&gt; .</span>
<span class="c">#    â”œâ”€â”€ common</span>
<span class="c">#    â”‚   â””â”€â”€ variables.tf</span>
<span class="c">#    â”œâ”€â”€ dev</span>
<span class="c">#    â”‚   â”œâ”€â”€ vpc</span>
<span class="c">#    â”‚   â”‚   â”œâ”€â”€ main.tf</span>
<span class="c">#    â”‚   â”‚   â””â”€â”€ variables.tf</span>
<span class="c">#    â”‚   â”œâ”€â”€ main.tf</span>
<span class="c">#    â”‚   â””â”€â”€ variables.tf</span>
<span class="c">#    â”œâ”€â”€ prod</span>
<span class="c">#    â”‚   â”œâ”€â”€ vpc</span>
<span class="c">#    â”‚   â”‚   â”œâ”€â”€ main.tf</span>
<span class="c">#    â”‚   â”‚   â””â”€â”€ variables.tf</span>
<span class="c">#    â”‚   â”œâ”€â”€ main.tf</span>
<span class="c">#    â”‚   â””â”€â”€ variables.tf</span>
<span class="c">#    â””â”€â”€ stage</span>
<span class="c">#        â”œâ”€â”€ vpc</span>
<span class="c">#        â”‚   â”œâ”€â”€ main.tf</span>
<span class="c">#        â”‚   â””â”€â”€ variables.tf</span>
<span class="c">#        â”œâ”€â”€ main.tf</span>
<span class="c">#        â””â”€â”€ variables.tf</span>
</code></pre></div>        </div>
      </li>
      <li>í™˜ê²½ë³„ë¡œ ì™„ì „íˆ ë…ë¦½ì‹œì¼œ ì›í•˜ëŠ” ë°ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë°©ë²•ì´ì§€ë§Œ, 
ë™ì¼í•œ íŒŒì¼ë„ í™˜ê²½ë³„ë¡œ ë³µì‚¬í•´ì•¼ í•  ìˆ˜ ìˆìœ¼ë©°, ë”°ë¼ì„œ ë¦¬ì†ŒìŠ¤ ìˆ˜ê°€ ë§ì•„ì§€ë©´ ê´€ë¦¬ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ê³µìš© .tf íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ê° í™˜ê²½ë³„ë¡œ ì‚¬ìš©í•˜ë©´ ì¤‘ë³µì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>í…Œë¼í¼ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê¸°ëŠ¥ì„ í†µí•œ ê²©ë¦¬ (Isolation via workspaces)
    <ul>
      <li>ë™ì¼í•œ êµ¬ì„±ì—ì„œ ë¹ ë¥´ê³  ê²©ë¦¬ëœ í™˜ê²½ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ì‹¤ìŠµ
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ëª©ë¡ í™•ì¸</span>
<span class="nv">$ </span>terraform workspace list 
<span class="c"># =&gt; * default</span>
</code></pre></div>        </div>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">main.tf</code> ìƒì„±
            <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"peter_srv1"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-0ea4d4b8dc1e46212"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-study"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>            </div>
          </li>
          <li>ì‹¤í–‰
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
      
<span class="nv">$ </span>terraform state list 
      
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 43.201.149.141</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.private_ip'</span>
<span class="c"># =&gt; 172.31.8.91</span>
      
<span class="c"># ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>terraform workspace list
<span class="c"># =&gt; * default</span>
      
<span class="c"># graph í™•ì¸</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>            </div>

            <svg width="173pt" height="44pt" viewBox="0.00 0.00 173.25 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<polygon fill="white" stroke="none" points="-4,4 -4,-40 169.25,-40 169.25,4 -4,4" />
<!-- aws_instance.peter_srv1 -->
<g id="node1" class="node">
<polygon fill="none" stroke="black" points="165.25,-36 0,-36 0,0 165.25,0 165.25,-36" />
<text text-anchor="middle" x="82.62" y="-12.2" font-family="sans-serif" font-size="14.00">aws_instance.peter_srv1</text>
</g>
</g>
</svg>
          </li>
          <li>ì‹ ê·œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„±
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìƒˆ ì‘ì—… ê³µê°„ workspace ìƒì„± : mywork1</span>
<span class="nv">$ </span>terraform workspace new mywork1
<span class="nv">$ </span>terraform workspace show               
<span class="c"># =&gt; mywork1</span>
      
<span class="c"># ì„œë¸Œ ë””ë ‰í„°ë¦¬ í™•ì¸</span>
<span class="nv">$ </span>tree terraform.tfstate.d
<span class="c"># =&gt; terraform.tfstate.d</span>
<span class="c">#    â””â”€â”€ mywork1</span>
      
<span class="c"># plan ì‹œ ìƒˆë¡œìš´ ì‘ì—…ê³µê°„ì´ë¼ì„œ ë³„ë„ì˜ ìƒíƒœíŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê³„íšì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.</span>
<span class="nv">$ </span>terraform plan
<span class="c"># =&gt; ...</span>
<span class="c">#    Plan: 1 to add, 0 to change, 0 to destroy.</span>
      
<span class="c"># apply í•´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
            
<span class="c"># ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>terraform workspace list
<span class="c"># =&gt;   default</span>
<span class="c">#    * mywork1</span>
      
<span class="c"># ìƒíƒœ íŒŒì¼ì„ í™•ì¸í•©ë‹ˆë‹¤.</span>
<span class="c"># default(ê¸°ë³¸) ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ìƒíƒœ íŒŒì¼ì€ terraform.tfstateì´ê³ , mywork1 ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ìƒíƒœ íŒŒì¼ì€ terraform.tfstate.d/mywork1/terraform.tfstate ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</span>
      
<span class="c"># default ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ìƒíƒœ íŒŒì¼ì—ì„œ ip í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 43.201.149.141          </span>
      
<span class="c"># mywork1 ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ìƒíƒœ íŒŒì¼ì—ì„œ ip í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate.d/mywork1/terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 13.125.64.96</span>
      
<span class="c"># graph í™•ì¸</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
            
<span class="c"># ìƒˆ ì‘ì—… ê³µê°„ workspace ìƒì„± : mywork2</span>
<span class="nv">$ </span>terraform workspace new mywork2
      
<span class="c"># ì„œë¸Œ ë””ë ‰í„°ë¦¬ í™•ì¸</span>
<span class="nv">$ </span>tree terraform.tfstate.d
<span class="c"># =&gt; terraform.tfstate.d</span>
<span class="c">#    â”œâ”€â”€ mywork1</span>
<span class="c">#    â”‚   â””â”€â”€ terraform.tfstate</span>
<span class="c">#    â””â”€â”€ mywork2</span>
      
<span class="c"># plan &amp; apply</span>
<span class="nv">$ </span>terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
      
<span class="c"># mywork2ì—ì„œ apply í›„ ì„œë¸Œ ë””ë ‰í„°ë¦¬ í™•ì¸</span>
<span class="nv">$ </span>tree terraform.tfstate.d
<span class="c"># =&gt; terraform.tfstate.d</span>
<span class="c">#    â”œâ”€â”€ mywork1</span>
<span class="c">#    â”‚   â””â”€â”€ terraform.tfstate</span>
<span class="c">#    â””â”€â”€ mywork2</span>
<span class="c">#        â””â”€â”€ terraform.tfstate</span>
      
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 43.201.149.141</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate.d/mywork1/terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 13.125.64.96</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate.d/mywork2/terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 13.124.42.129</span>
      
<span class="c"># workspace ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>terraform workspace show
<span class="c"># =&gt; mywork2</span>
<span class="nv">$ </span>terraform workspace list
<span class="c"># =&gt;   default</span>
<span class="c">#      mywork1</span>
<span class="c">#    * mywork2</span>
      
<span class="c"># ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</span>
<span class="nv">$ </span>terraform workspace <span class="k">select </span>default
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
      
<span class="nv">$ </span>terraform workspace <span class="k">select </span>mywork1
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
      
<span class="nv">$ </span>terraform workspace <span class="k">select </span>mywork2
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>      
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li><strong>ì¥ì </strong>
        <ul>
          <li>í•˜ë‚˜ì˜ <strong>ë£¨íŠ¸ ëª¨ë“ˆ</strong>ì—ì„œ ë‹¤ë¥¸ í™˜ê²½ì„ ìœ„í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ë™ì¼í•œ <strong>í…Œë¼í¼ êµ¬ì„±</strong>ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</li>
          <li>ê¸°ì¡´ í”„ë¡œë¹„ì €ë‹ëœ í™˜ê²½ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  ë³€ê²½ ì‚¬í•­ ì‹¤í—˜ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
          <li>ê¹ƒì˜ ë¸Œëœì¹˜ ì „ëµì²˜ëŸ¼ ë™ì¼í•œ êµ¬ì„±ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ ê²°ê³¼ ê´€ë¦¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li><strong>ë‹¨ì </strong>
        <ul>
          <li>Stateê°€ ë™ì¼í•œ ì €ì¥ì†Œ(ë¡œì»¬ ë˜ëŠ” ë°±ì—”ë“œ)ì— ì €ì¥ë˜ì–´ State ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
          <li>ëª¨ë“  í™˜ê²½ì´ ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”êµ¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í…Œë¼í¼ êµ¬ì„±ì— ë¶„ê¸° ì²˜ë¦¬ê°€ ë‹¤ìˆ˜ ë°œìƒ ê°€ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.</li>
          <li>í”„ë¡œë¹„ì €ë‹ ëŒ€ìƒì— ëŒ€í•œ ì¸ì¦ ìš”ì†Œë¥¼ ì™„ë²½íˆ ë¶„ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
          <li>ê°€ì¥ <strong>í° ë‹¨ì ì€ ì™„ë²½í•œ ê²©ë¦¬ê°€ ë¶ˆê°€ëŠ¥</strong>í•˜ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
            <ul>
              <li>ë³´ì™„ ë°©ë²•
                <ol>
                  <li>í•´ê²°í•˜ê¸° ìœ„í•´ ë£¨íŠ¸ ëª¨ë“ˆì„ ë³„ë„ë¡œ êµ¬ì„±í•˜ëŠ” ë””ë ‰í„°ë¦¬ ê¸°ë°˜ì˜ ë ˆì´ì•„ì›ƒì„ ì‚¬ìš©</li>
                  <li>Terraform Cloud í™˜ê²½ì˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ í™œìš©</li>
                </ol>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì´ë²ˆ ì£¼ì—ëŠ” í”„ë¡œë°”ì´ë”ì™€ ìƒíƒœì— ëŒ€í•´ ë³´ë‹¤ ìì„¸íˆ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.
3ì£¼ ë™ì•ˆ ë§‰ì—°í•˜ê²Œ ì‚¬ìš©í•˜ë˜ í”„ë¡œë°”ì´ë”ì™€ ìƒíƒœì— ëŒ€í•´ ì¢€ë” ëª…í™•í•˜ê²Œ ì´í•´í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<p>ìƒíƒœ ê´€ë¦¬ì— ëŒ€í•´ì„œëŠ” ì‹¤ë¬´ì—ì„œ íŒ€, íšŒì‚¬ ë‹¨ìœ„ì—ì„œ í…Œë¼í¼ì„ ì‚¬ìš©í• ë•Œ ì–´ë ¤ì›€ì„ ë§ì´ ê²ªì„ ìˆ˜ ìˆê² ë‹¤ ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.
ë°˜ë³µëœ êµìœ¡ê³¼ ì‚¬ìš©ìœ¼ë¡œ ë‚´ì œí™” ë˜ê¸°ì „ì—ëŠ” ì‹œí–‰ ì°©ì˜¤ë¥¼ ë§ì´ ê±°ì³ì•¼í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤. 
ì´ë²ˆ ìŠ¤í„°ë””ë¥¼ í†µí•´ì„œ ìƒë‹¹ìˆ˜ì˜ ì‹œí–‰ ì°©ì˜¤ëŠ” ë‹¨ì¶•í•  ìˆ˜ ìˆì—ˆë˜ê±° ê°™ìŠµë‹ˆë‹¤.</p>

<p>ì •ë§ ì¢‹ì€ ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•´ ì£¼ì‹œëŠ” Gasidaë‹˜ê³¼ ì‹¤ìŠµì„ ë§Œë“¤ì–´ì£¼ì‹  ì•…ë¶„ë‹˜ê»˜ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. :pray:</p>]]></content><author><name></name></author><category term="terraform" /><category term="terraform," /><category term="cloud," /><category term="aws" /><summary type="html"><![CDATA[ë“œë””ì–´ HCL ê¸°ë³¸ ë¬¸ë²• ìŠ¤í„°ë””ê°€ ëë‚˜ê³  ë‹¤ë¥¸ ì£¼ì œë¡œ ë„˜ì–´ê°€ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë¬¼ë¡  HCL ë¬¸ë²•ì„ ê³„ì† ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì´ìƒ ì§€ì†ì ì¸ ê³µë¶€ì™€ ì¶”ê°€/ë³€ê²½ë˜ëŠ” ë¬¸ë²•ì„ ê³„ì† íŒ”ë¡œìš° í•´ì•¼ê² ì§€ë§Œ, í•œ ë‹¨ê³„ë¥¼ ë„˜ê²¼ë‹¤ëŠ” ëŠë‚Œì— ë¿Œë“¯í•©ë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[T101 4ê¸°] í…Œë¼í¼ ê¸°ë³¸ ì‚¬ìš©ë²• 3/3</title><link href="https://sweetlittlebird.github.io/posts/2024-06-30-T101-Study-Terraform-Week-3/" rel="alternate" type="text/html" title="[T101 4ê¸°] í…Œë¼í¼ ê¸°ë³¸ ì‚¬ìš©ë²• 3/3" /><published>2024-06-30T02:08:00+09:00</published><updated>2024-06-30T02:08:00+09:00</updated><id>https://sweetlittlebird.github.io/posts/T101%20Study%20-%20Terraform%20Week%203</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-06-30-T101-Study-Terraform-Week-3/"><![CDATA[<ul id="toc" class="section-nav">
</ul>

<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>í…Œë¼í¼ ê¸°ì´ˆ ì…ë¬¸ ì‹¤ìŠµ ìŠ¤í„°ë”” 3ì£¼ì°¨ì´ê³ , ê¸°ë³¸ ì‚¬ìš©ë²• ë§ˆì§€ë§‰ ì£¼ì°¨ì…ë‹ˆë‹¤.
ì´ë²ˆ ì£¼ì—ë„ í•™ìŠµí•´ì•¼ í•˜ëŠ” ë‚´ìš©ì´ ë§ì•„ì„œ ë¶€ì§€ëŸ°íˆ ë‹¬ë ¤ë³´ê² ìŠµë‹ˆë‹¤.
â€œí…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaCâ€ ì±…ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" /></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a></p>
</blockquote>

<h2 id="hcl-ê³„ì†">HCL (ê³„ì†)</h2>

<p>ì´ë²ˆì£¼ì—ë„ HCL(HashiCorp Configuration Language) ì˜ ë¬¸ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h3 id="ë°˜ë³µë¬¸-22">ë°˜ë³µë¬¸ (2/2)</h3>

<h4 id="for_each">for_each</h4>

<ul>
  <li>ë°˜ë³µë¬¸ì´ë©° ì„ ì–¸ëœ key ê°’ ê°œìˆ˜ë§Œí¼ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">for_each</code> ëŠ” <code class="language-plaintext highlighter-rouge">count</code> ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ, <code class="language-plaintext highlighter-rouge">count</code> ëŠ” ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  <code class="language-plaintext highlighter-rouge">for_each</code> ëŠ” í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">each</code> object ë¥¼ ì‚¬ìš©í•˜ì—¬ <code class="language-plaintext highlighter-rouge">key</code> ì™€ <code class="language-plaintext highlighter-rouge">value</code> ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">each.key</code> : <code class="language-plaintext highlighter-rouge">key</code> ê°’</li>
      <li><code class="language-plaintext highlighter-rouge">each.value</code> : <code class="language-plaintext highlighter-rouge">value</code> ê°’ (<code class="language-plaintext highlighter-rouge">set</code> íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ <code class="language-plaintext highlighter-rouge">each.key</code> ì™€ ê°™ìŠµë‹ˆë‹¤.)</li>
    </ul>
  </li>
  <li>for_each ëŠ” <strong><code class="language-plaintext highlighter-rouge">map</code>ê³¼ <code class="language-plaintext highlighter-rouge">set</code> íƒ€ì…ë§Œì„ í—ˆìš©</strong>í•©ë‹ˆë‹¤. ë”°ë¼ì„œ <code class="language-plaintext highlighter-rouge">map</code>ê³¼ <code class="language-plaintext highlighter-rouge">set</code> íƒ€ì…ì´ ì•„ë‹Œ í‘œí˜„ì‹ì€ <code class="language-plaintext highlighter-rouge">tomap()</code>, <code class="language-plaintext highlighter-rouge">toset()</code> ë“±ì„ í†µí•´ ë³€í™˜í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì‹¤ìŠµ 1. <code class="language-plaintext highlighter-rouge">for_each</code> ì‚¬ìš©í•˜ê¸°
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="c1"># map íƒ€ì…ìœ¼ë¡œ ì„ ì–¸</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">tomap</span><span class="p">({</span>
    <span class="nx">a</span> <span class="p">=</span> <span class="s2">"content a"</span>
    <span class="nx">b</span> <span class="p">=</span> <span class="s2">"content b"</span>
  <span class="p">})</span>
  
  <span class="c1"># íŒŒì¼ ì œëª©ì€ key ê°’ìœ¼ë¡œ ì„¤ì • (a, b)</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>

  <span class="c1"># íŒŒì¼ ë‚´ìš©ì€ value ê°’ìœ¼ë¡œ ì„¤ì • (content a, content b)</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="c1"># toset() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ set íƒ€ì…ìœ¼ë¡œ ë³€í™˜</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">toset</span><span class="p">([</span><span class="s2">"ccc"</span><span class="p">,</span> <span class="s2">"ddd"</span><span class="p">,</span> <span class="s2">"eee"</span><span class="p">])</span>
  
  <span class="c1"># íŒŒì¼ ì œëª©ì€ key ê°’ìœ¼ë¡œ ì„¤ì •</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
  
  <span class="c1"># íŒŒì¼ ë‚´ìš©ì€ value ê°’ìœ¼ë¡œ ì„¤ì • (setì˜ ê²½ìš° valueì™€ keyê°€ ê°™ìŒ)</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ì‹¤í–‰ ê²°ê³¼
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; local_file.abc["a"]</span>
<span class="c">#    local_file.abc["b"]</span>
<span class="c">#    local_file.def["ccc"]</span>
<span class="c">#    local_file.def["ddd"]</span>
<span class="c">#    local_file.def["eee"]</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'local_file.abc["a"]'</span> | terraform console
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'local_file.abc["a"].content'</span> | terraform console
<span class="c"># =&gt; "content a"</span>
    
<span class="nv">$ </span><span class="nb">cat </span>a.txt
<span class="c"># =&gt; content a</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'local_file.def["ccc"].content'</span> | terraform console
<span class="nv">$ </span><span class="nb">cat </span>ccc.txt
<span class="c"># =&gt; "ccc"   # keyì™€ valueê°€ ê°™ìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ  </span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ 2. <code class="language-plaintext highlighter-rouge">variable</code> ë¸”ë¡ì„ ì‚¬ìš©í•´ ì„ ì–¸ëœ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ <code class="language-plaintext highlighter-rouge">local_file.abc</code> ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê³ , <code class="language-plaintext highlighter-rouge">local_file.abc</code> ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ <code class="language-plaintext highlighter-rouge">local_file.def</code> ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"names"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="p">=</span> <span class="s2">"content a"</span>
    <span class="nx">b</span> <span class="p">=</span> <span class="s2">"content b"</span>
    <span class="nx">c</span> <span class="p">=</span> <span class="s2">"content c"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">names</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc-</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="c1"># ì•ì—ì„œ ë§Œë“  local_file.abc ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span>  
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">content</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/def-</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ê²°ê³¼
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; local_file.abc["a"]</span>
<span class="c">#    local_file.abc["b"]</span>
<span class="c">#    local_file.abc["c"]</span>
<span class="c">#    local_file.def["a"]</span>
<span class="c">#    local_file.def["b"]</span>
<span class="c">#    local_file.def["c"]</span>
    
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-1</span> <span class="k">*</span>.txt
<span class="c"># =&gt; abc-a.txt</span>
<span class="c">#    abc-b.txt    </span>
<span class="c">#    abc-c.txt    </span>
<span class="c">#    def-a.txt    </span>
<span class="c">#    def-b.txt    </span>
<span class="c">#    def-c.txt</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'local_file.abc["a"].content'</span> | terraform console
<span class="c"># =&gt; "content a"    </span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>ì‹¤ìŠµ 3. â€œì‹¤ìŠµ 2â€ì—ì„œ <code class="language-plaintext highlighter-rouge">names</code> ë³€ìˆ˜ì˜ b ê°’ì„ ì‚­ì œí•˜ê³  <code class="language-plaintext highlighter-rouge">terraform apply</code> ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. 
<code class="language-plaintext highlighter-rouge">count</code>ì™€ëŠ” ë‹¬ë¦¬ ì¤‘ê°„ì˜ í•­ëª©ì´ ì‚­ì œë˜ì–´ë„ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"names"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="p">=</span> <span class="s2">"content a"</span>
    <span class="nx">c</span> <span class="p">=</span> <span class="s2">"content c"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">names</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc-</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="c1"># ì•ì—ì„œ ë§Œë“  local_file.abc ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span>  
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">content</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/def-</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ê²°ê³¼
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#      # local_file.abc["b"] will be destroyed</span>
<span class="c">#    ...</span>
<span class="c">#      # local_file.def["b"] will be destroyed</span>
<span class="c">#    ...</span>
<span class="c">#    Apply complete! Resources: 0 added, 0 changed, 2 destroyed.</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; local_file.abc["a"]</span>
<span class="c">#    local_file.abc["c"]</span>
<span class="c">#    local_file.def["a"]</span>
<span class="c">#    local_file.def["c"]</span>
    
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-1</span> <span class="k">*</span>.txt
<span class="c"># =&gt; abc-a.txt</span>
<span class="c">#    abc-c.txt</span>
<span class="c">#    def-a.txt</span>
<span class="c">#    def-c.txt    </span>
</code></pre></div>        </div>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">count</code>ì™€ëŠ” ë‹¤ë¥´ê²Œ ì¤‘ê°„ì˜ í•­ëª©ì´ ì‚­ì œë˜ì–´ë„ ì œëŒ€ë¡œ ë™ì‘í•˜ì—¬ í‚¤ê°€ <code class="language-plaintext highlighter-rouge">b</code>ì¸ ê²ƒì— ê´€ë ¨ëœ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="for-expression">for Expression</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">for</code> Expressionì€ <code class="language-plaintext highlighter-rouge">for</code> ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ <code class="language-plaintext highlighter-rouge">set</code>ì´ë‚˜ <code class="language-plaintext highlighter-rouge">list</code>, <code class="language-plaintext highlighter-rouge">map</code>ì˜ í•­ëª©ë“¤ì— ëŒ€í•´ ë°˜ë³µì ìœ¼ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>pythonì˜ <code class="language-plaintext highlighter-rouge">list comprehension</code>ê³¼ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
  <li>ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
    <ul>
      <li>ë¦¬í„´ íƒ€ì…ì´ tuple ì¸ ê²½ìš°
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nx">for</span> <span class="err">&lt;í•­ëª©ì˜</span> <span class="err">ë³€ìˆ˜ëª…&gt;</span> <span class="nx">in</span> <span class="err">&lt;</span><span class="nx">set</span><span class="p">,</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">map</span> <span class="err">ë“±ì˜</span> <span class="err">ì½œë ‰ì…˜&gt;</span> <span class="err">:</span> <span class="err">&lt;í•­ëª©ì˜</span> <span class="err">ë³€ìˆ˜ëª…ì„</span> <span class="err">ê°€ê³µí•˜ëŠ”</span> <span class="err">í‘œí˜„ì‹&gt;</span><span class="p">]</span>
</code></pre></div>        </div>
      </li>
      <li>ë¦¬í„´ íƒ€ì…ì´ object ì¸ ê²½ìš°
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nx">for</span> <span class="err">&lt;í•­ëª©ì˜</span> <span class="err">ë³€ìˆ˜ëª…&gt;</span> <span class="nx">in</span> <span class="err">&lt;</span><span class="nx">set</span><span class="p">,</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">map</span> <span class="err">ë“±ì˜</span> <span class="err">ì½œë ‰ì…˜&gt;</span> <span class="err">:</span> <span class="err">&lt;ê²°ê³¼</span> <span class="err">í‚¤&gt;</span> <span class="p">=</span><span class="err">&gt;</span> <span class="err">&lt;ê²°ê³¼</span> <span class="err">ê°’&gt;</span><span class="p">}</span>
</code></pre></div>        </div>
        <p>ë¦¬í„´ë˜ëŠ” í‚¤ì™€ ê°’ì€ <code class="language-plaintext highlighter-rouge">=&gt;</code> ë¡œ êµ¬ë¶„í•©ë‹ˆë‹¤.</p>
      </li>
      <li>ì½œë ‰ì…˜ì´ <code class="language-plaintext highlighter-rouge">list</code> ìœ í˜•ì¸ ê²½ìš° <code class="language-plaintext highlighter-rouge">&lt;í•­ëª©ì˜ ë³€ìˆ˜ëª…&gt;</code>ì´ <strong>í•˜ë‚˜ì¸ ê²½ìš° ê°’</strong>ì„, <strong>ë‘ê°œì¸ ê²½ìš° â€œ,â€ (ì‰¼í‘œ)ë¡œ êµ¬ë¶„í•˜ì—¬, ì•ì˜ ì¸ìˆ˜ê°€ ì¸ë±ìŠ¤, ë’¤ì˜ ì¸ìˆ˜ê°€ ê°’</strong>ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
        <ul>
          <li>ê´€ìš©ì ìœ¼ë¡œ ì¸ë±ìŠ¤ëŠ” <code class="language-plaintext highlighter-rouge">i</code>, ê°’ì€ <code class="language-plaintext highlighter-rouge">v</code>ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.
            <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
      
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tolist</span><span class="p">([</span><span class="s2">"aa"</span><span class="p">,</span> <span class="s2">"bb"</span><span class="p">,</span> <span class="s2">"cc"</span><span class="p">,</span> <span class="s2">"dd"</span><span class="p">])</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [ "Aa", "Bb", "Cc", "Dd" ]    </span>
      
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tolist</span><span class="p">([</span><span class="s2">"aa"</span><span class="p">,</span> <span class="s2">"bb"</span><span class="p">,</span> <span class="s2">"cc"</span><span class="p">,</span> <span class="s2">"dd"</span><span class="p">])</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">i</span><span class="k">}</span><span class="s2"> =&gt; </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [ "0 =&gt; Aa", "1 =&gt; Bb", "2 =&gt; Cc", "3 =&gt; Dd" ]    </span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>ì½œë ‰ì…˜ì´ <code class="language-plaintext highlighter-rouge">map</code> ìœ í˜•ì¸ ê²½ìš° <code class="language-plaintext highlighter-rouge">&lt;í•­ëª©ì˜ ë³€ìˆ˜ëª…&gt;</code>ì´ <strong>í•˜ë‚˜ì¸ ê²½ìš° ê°’</strong>ì„, <strong>ë‘ê°œì¸ ê²½ìš° â€œ,â€ (ì‰¼í‘œ)ë¡œ êµ¬ë¶„í•˜ì—¬, ì•ì˜ ì¸ìˆ˜ê°€ í‚¤, ë’¤ì˜ ì¸ìˆ˜ê°€ ê°’</strong>ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
        <ul>
          <li>ê´€ìš©ì ìœ¼ë¡œ í‚¤ëŠ” <code class="language-plaintext highlighter-rouge">k</code>, ê°’ì€ <code class="language-plaintext highlighter-rouge">v</code>ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.
            <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>

<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">upper</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      "234",</span>
<span class="c1">#      "GILDONG"</span>
<span class="c1">#    ]</span>
            
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">upper</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span><span class="k">}</span><span class="s2"> =&gt; </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      "AGE =&gt; 234",</span>
<span class="c1">#      "NAME =&gt; Gildong",</span>
<span class="c1">#    ]</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">if</code> ë¥¼ í†µí•´ íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê°’ë§Œ ê°€ê³µí•˜ì—¬ ë¦¬í„´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
    
<span class="c1"># ì§ìˆ˜ì¸ ê²½ìš°ë§Œ ì œê³±í•œ ê°’ì„ ë¦¬í„´</span>
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tolist</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">pow</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span> <span class="nx">if</span> <span class="nx">v</span> <span class="err">%</span> <span class="mi">2</span> <span class="err">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># =&gt; [ 4, 16 ]</span>
    
<span class="c1"># í‚¤ê°€ "age"ì¸ ê²½ìš° ì œì™¸í•˜ê³  ê°€ê³µ</span>
<span class="err">&gt;</span> <span class="p">{</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="nx">upper</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">title</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="nx">if</span> <span class="nx">k</span> <span class="err">!</span><span class="p">=</span> <span class="s2">"age"</span><span class="p">}</span>
<span class="c1"># =&gt; { "NAME" = "Gildong" }</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ
    <ul>
      <li>ê°„ë‹¨í•œ for í‘œí˜„ì‹ ì‹¤ìŠµ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
    
<span class="c1"># 1. tuple íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ for í‘œí˜„ì‹ ì‚¬ìš©</span>
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">value</span> <span class="nx">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="err">:</span> <span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">value</span> <span class="p">*</span> <span class="nx">value</span><span class="p">)</span> <span class="p">]</span>
<span class="c1"># =&gt; [ 1, 2, 16, 512 ]</span>
    
<span class="c1"># 2. set íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ for í‘œí˜„ì‹ ì‚¬ìš©</span>
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">name</span> <span class="nx">in</span> <span class="nx">toset</span><span class="p">([</span><span class="s2">"gildong"</span><span class="p">,</span> <span class="s2">"sejong"</span><span class="p">])</span> <span class="err">:</span> <span class="s2">"Hi, </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="k">}</span><span class="s2">!"</span> <span class="p">]</span>
<span class="c1"># =&gt; [ "Hi, Gildong!", "Hi, Sejong!", ]</span>
    
<span class="c1"># 3. map íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ for í‘œí˜„ì‹ ì‚¬ìš©</span>
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">upper</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="k">}</span><span class="s2"> =&gt; </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      "AGE =&gt; 234",</span>
<span class="c1">#      "NAME =&gt; Gildong",</span>
<span class="c1">#    ]</span>
    
<span class="c1"># 4. íƒ€ì… í™•ì¸</span>
<span class="err">&gt;</span> <span class="nx">type</span><span class="err">(</span><span class="p">[</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">upper</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="k">}</span><span class="s2"> =&gt; </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span><span class="err">)</span>
<span class="c1"># =&gt; tuple([</span>
<span class="c1">#      string,</span>
<span class="c1">#      string,</span>
<span class="c1">#    ])</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>ì•…ë¶„ë‹˜ for expression ì‹¤ìŠµ</p>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># main.tf </span>
 <span class="k">variable</span> <span class="s2">"fruits_set"</span> <span class="p">{</span>
   <span class="nx">type</span>        <span class="p">=</span> <span class="nx">set</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
   <span class="nx">default</span>     <span class="p">=</span> <span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">]</span>
   <span class="nx">description</span> <span class="p">=</span> <span class="s2">"fruit example"</span>
 <span class="p">}</span>
      
 <span class="k">variable</span> <span class="s2">"fruits_list"</span> <span class="p">{</span>
   <span class="nx">type</span>        <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
   <span class="nx">default</span>     <span class="p">=</span> <span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">]</span>
   <span class="nx">description</span> <span class="p">=</span> <span class="s2">"fruit example"</span>
 <span class="p">}</span>
      
 <span class="k">variable</span> <span class="s2">"fruits_map"</span> <span class="p">{</span>
   <span class="nx">type</span>        <span class="p">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
   <span class="nx">default</span>     <span class="p">=</span> <span class="p">{</span><span class="s2">"first"</span><span class="err">:</span> <span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"second"</span><span class="err">:</span> <span class="s2">"banana"</span><span class="p">}</span>
   <span class="nx">description</span> <span class="p">=</span> <span class="s2">"fruit example"</span>
 <span class="p">}</span>  
</code></pre></div>        </div>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
      
 <span class="kd">var</span><span class="err">.</span><span class="nx">fruits_set</span>                                        <span class="c1"># =&gt; toset(["apple", "banana"]) </span>
 <span class="kd">var</span><span class="err">.</span><span class="nx">fruits_list</span>                                       <span class="c1"># =&gt; tolist(["apple", "banana"]) </span>
 <span class="kd">var</span><span class="err">.</span><span class="nx">fruits_map</span>                                        <span class="c1"># =&gt; tomap({"first" = "apple", "second" = "banana"})</span>
                                                            
 <span class="nx">type</span><span class="err">(</span><span class="kd">var</span><span class="err">.</span><span class="nx">fruits_set</span><span class="err">)</span>                                  <span class="c1"># =&gt; set(string)</span>
 <span class="nx">type</span><span class="err">(</span><span class="kd">var</span><span class="err">.</span><span class="nx">fruits_list</span><span class="err">)</span>                                 <span class="c1"># =&gt; list(string)</span>
 <span class="nx">type</span><span class="err">(</span><span class="kd">var</span><span class="err">.</span><span class="nx">fruits_map</span><span class="err">)</span>                                  <span class="c1"># =&gt; map(string)</span>
      
 <span class="c1"># for item in var.fruits_set: item                    # ì˜¤ë¥˜ ë°œìƒ! []ë¡œ ê°ì‹¸ì•¼í•¨ </span>
 <span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_set</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span>                    <span class="c1"># =&gt; ["apple", "banana"]</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_set</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span><span class="err">)</span>              <span class="c1"># =&gt; tuple([string, string])</span>
      
 <span class="c1"># {for item in var.fruits_set: item}                  # ì˜¤ë¥˜ ë°œìƒ! {}ë¡œ ê°ì‹¸ì¡Œìœ¼ë‚˜ ê²°ê³¼ ê°’ì´ key, value í˜•íƒœê°€ ì•„ë‹˜</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_set</span><span class="err">:</span> <span class="nx">key</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">value</span><span class="p">}</span>       <span class="c1"># =&gt; { "apple" = "apple", "banana" = "banana" }</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">{</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_set</span><span class="err">:</span> <span class="nx">key</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">value</span><span class="p">}</span><span class="err">)</span> <span class="c1"># =&gt; object({apple: string, banana: string})</span>
      
 <span class="c1"># for item in var.fruits_list: item                   # ì˜¤ë¥˜ ë°œìƒ! []ë¡œ ê°ì‹¸ì•¼í•¨</span>
 <span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span>                   <span class="c1"># =&gt; ["apple", "banana"]</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span><span class="err">)</span>             <span class="c1"># =&gt; tuple([string, string])</span>
      
 <span class="c1"># {for item in var.fruits_list: item}                 # ì˜¤ë¥˜ ë°œìƒ! {}ë¡œ ê°ì‹¸ì¡Œìœ¼ë‚˜ ê²°ê³¼ ê°’ì´ key, value í˜•íƒœê°€ ì•„ë‹˜</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">key</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">value</span><span class="p">}</span>      <span class="c1"># =&gt; { "0" = "apple", "1" = "banana" }</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">i</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">v</span><span class="p">}</span>                 <span class="c1"># =&gt; { "0" = "apple", "1" = "banana" }</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">{</span><span class="nx">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">i</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">v</span><span class="p">}</span><span class="err">)</span>           <span class="c1"># =&gt; object({0: string, 1: string})</span>
          
 <span class="c1"># for item in var.fruits_map: item                    # ì˜¤ë¥˜ ë°œìƒ! []ë¡œ ê°ì‹¸ì•¼í•¨</span>
 <span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span>                    <span class="c1"># =&gt; ["apple", "banana"]</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span><span class="err">)</span>              <span class="c1"># =&gt; tuple([string, string])</span>
          
 <span class="c1"># {for item in var.fruits_map: item}                  # ì˜¤ë¥˜ ë°œìƒ! {}ë¡œ ê°ì‹¸ì¡Œìœ¼ë‚˜ ê²°ê³¼ ê°’ì´ key, value í˜•íƒœê°€ ì•„ë‹˜</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">key</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">value</span><span class="p">}</span>       <span class="c1"># =&gt; { "first" = "apple", "second" = "banana" }</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">k</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">v</span><span class="p">}</span>                  <span class="c1"># =&gt; { "first" = "apple", "second" = "banana" }</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">{</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">k</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">v</span><span class="p">}</span><span class="err">)</span>            <span class="c1"># =&gt; object({first: string, second: string}) </span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="dynamic">dynamic</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">count</code>ë‚˜ <code class="language-plaintext highlighter-rouge">for_each</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ì „ì²´ë¥¼ ì—¬ëŸ¬ê°œ ìƒì„±í•˜ëŠ”ê²ƒ ì™¸ì—ë„ ë¦¬ì†ŒìŠ¤ ë‚´ë¶€ì˜ ì†ì„± ë¸”ë¡ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì˜ˆë¥¼ ë“¤ì–´ archive í”„ë¡œë°”ì´ë”ì˜ <code class="language-plaintext highlighter-rouge">archive_file</code> ë¦¬ì†ŒìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">source</code> ì†ì„±ì— ì—¬ëŸ¬ íŒŒì¼ì„ ë™ì ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>dynamicì„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">data</span> <span class="s2">"archive_file"</span> <span class="s2">"files"</span> <span class="p">{</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="s2">"zip"</span>
  <span class="nx">output_path</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/files.zip"</span>
    
  <span class="nx">source</span> <span class="p">{</span>
    <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"hello a"</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"a.txt"</span>
  <span class="p">}</span>
    
  <span class="nx">source</span> <span class="p">{</span>
    <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"hello b"</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"b.txt"</span>
  <span class="p">}</span>
    
  <span class="nx">source</span> <span class="p">{</span>
    <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"hello c"</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"c.txt"</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div>        </div>
        <ul>
          <li>ì‹¤í–‰ í›„ í™•ì¸
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show data.archive_file.files

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"tolist(data.archive_file.files.source)[0].filename"</span> | terraform console
<span class="c"># =&gt; "a.txt"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"tolist(data.archive_file.files.source)[0].content"</span> | terraform console
<span class="c"># =&gt; "hello a"      </span>
<span class="nv">$ </span>unzip files.zip
<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.txt
<span class="c"># =&gt; a.txt b.txt c.txt</span>
<span class="nv">$ </span><span class="nb">cat </span>a.txt
<span class="c"># =&gt; hello a</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>dynamicì„ ì‚¬ìš©í–ˆì„ ë•Œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"files"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">object</span><span class="p">({</span> <span class="nx">content</span>  <span class="p">=</span> <span class="nx">string</span> <span class="p">}))</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"a.txt"</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">content</span> <span class="p">=</span> <span class="s2">"hello a"</span> <span class="p">}</span>
    <span class="s2">"b.txt"</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">content</span> <span class="p">=</span> <span class="s2">"hello b"</span> <span class="p">}</span>
    <span class="s2">"c.txt"</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">content</span> <span class="p">=</span> <span class="s2">"hello c"</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">data</span> <span class="s2">"archive_file"</span> <span class="s2">"files"</span> <span class="p">{</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="s2">"zip"</span>
  <span class="nx">output_path</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/files.zip"</span>
    
  <span class="nx">dynamic</span> <span class="s2">"source"</span> <span class="p">{</span>
    <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">files</span>
    
    <span class="nx">content</span> <span class="p">{</span>
      <span class="nx">filename</span> <span class="p">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">key</span>
      <span class="nx">content</span>  <span class="p">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">content</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>ì‹¤í–‰ í›„ í™•ì¸
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show data.archive_file.files

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"tolist(data.archive_file.files.source)[0].filename"</span> | terraform console
<span class="c"># =&gt; "a.txt"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"tolist(data.archive_file.files.source)[0].content"</span> | terraform console
<span class="c"># =&gt; "hello a"      </span>
<span class="nv">$ </span>unzip files.zip
<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.txt
<span class="c"># =&gt; a.txt b.txt c.txt</span>
<span class="nv">$ </span><span class="nb">cat </span>a.txt
<span class="c"># =&gt; hello a</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ì´ì™€ ê°™ì´ <code class="language-plaintext highlighter-rouge">dynamic</code>ì„ ì‚¬ìš©í•˜ë©´ ë°˜ë³µë˜ëŠ” ìˆ˜ê°€ ë§ì•„ì ¸ë„ ë°ì´í„°ë§Œ ë°”ê¾¸ë©´ ë˜ë‹ˆ ì½”ë“œ ì¤‘ë³µì„ ì¤„ì¼ ìˆ˜ ìˆê³ , ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•´ì§‘ë‹ˆë‹¤.
    <ul>
      <li>ë˜í•œ <code class="language-plaintext highlighter-rouge">dynamic</code>ì€ ë‹¤ìŒê³¼ ê°™ì´ <code class="language-plaintext highlighter-rouge">dynamic</code>ì•ˆì— ë˜ <code class="language-plaintext highlighter-rouge">dynamic</code>ì„ ì‚¬ìš©í•˜ì—¬ ì¤‘ì²©í•  ìˆ˜ ìˆì–´ì„œ ìƒë‹¹íˆ í¸ë¦¬í•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="err">...</span>
  <span class="nx">dynamic</span> <span class="s2">"origin_group"</span> <span class="p">{</span>
    <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">load_balancer_origin_groups</span>
    <span class="nx">content</span> <span class="p">{</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="nx">origin_group</span><span class="p">.</span><span class="nx">key</span>
  
      <span class="nx">dynamic</span> <span class="s2">"origin"</span> <span class="p">{</span>
        <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">origin_group</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">origins</span>
        <span class="nx">content</span> <span class="p">{</span>
          <span class="nx">hostname</span> <span class="p">=</span> <span class="nx">origin</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">hostname</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> 
  <span class="err">...</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h3 id="ì¡°ê±´ë¬¸-conditional-expression">ì¡°ê±´ë¬¸ (Conditional Expression)</h3>
<ul>
  <li>ì¡°ê±´ë¬¸ì€ í…Œë¼í¼ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ 3í•­ ì—°ì‚°ì í˜•íƒœë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">&lt;</span><span class="nx">condition</span><span class="err">&gt;</span> <span class="err">?</span> <span class="err">&lt;</span><span class="nx">condition</span><span class="err">ì´</span> <span class="err">ì°¸ì¼ë•Œ</span> <span class="err">ê°’&gt;</span> <span class="err">:</span> <span class="err">&lt;</span><span class="nx">condition</span><span class="err">ì´</span> <span class="err">ê±°ì§“ì¼ë•Œ</span> <span class="err">ê°’&gt;</span>
</code></pre></div>    </div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">?</code>ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¢Œì¸¡ì—ëŠ” ì¡°ê±´ì´ë©°, ìš°ì¸¡ì—ëŠ” <code class="language-plaintext highlighter-rouge">:</code> ê¸°í˜¸ë£° ê¸°ì¤€ìœ¼ë¡œ ì¢Œì¸¡ì€ ì¡°ê±´ì— ëŒ€í•´ ì°¸ì¼ ë•Œì˜ ê°’, ìš°ì¸¡ì€ ê±°ì§“ì¼ ë•Œì˜ ê°’ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</li>
      <li>ì¦‰ <code class="language-plaintext highlighter-rouge">?</code> ì¢Œì¸¡ì˜ ì¡°ê±´ì´ ì°¸ì¼ë•ŒëŠ” <code class="language-plaintext highlighter-rouge">:</code> ì•ì˜ ì°¸ ê°’ì„, ê±°ì§“ ì¼ë•ŒëŠ” <code class="language-plaintext highlighter-rouge">:</code> ë’¤ì˜ ê±°ì§“ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.</li>
      <li>ë‹¤ìŒì˜ ì˜ˆì—ì„œ var.a ê°€ ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹ˆë©´ var.aë¥¼, ë¹ˆ ë¬¸ìì—´ì´ë©´ â€œdefaultâ€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">!=</span> <span class="s2">""</span> <span class="err">?</span> <span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">:</span> <span class="s2">"default"</span>
<span class="err">...</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
  
<span class="err">&gt;</span> <span class="mi">1</span> <span class="err">==</span> <span class="mi">1</span> <span class="err">?</span> <span class="s2">"1ê³¼ 1ì€ ê°™ë‹¤"</span> <span class="err">:</span> <span class="s2">"1ê³¼ 1ì€ ë‹¤ë¥´ë‹¤"</span>
<span class="c1"># =&gt; "1ê³¼ 1ì€ ê°™ë‹¤" </span>

<span class="err">&gt;</span> <span class="mi">1</span> <span class="err">==</span> <span class="mi">2</span> <span class="err">?</span> <span class="s2">"1ê³¼ 2ëŠ” ê°™ë‹¤"</span> <span class="err">:</span> <span class="s2">"1ê³¼ 2ëŠ” ë‹¤ë¥´ë‹¤"</span>
<span class="c1"># =&gt; "1ê³¼ 2ëŠ” ë‹¤ë¥´ë‹¤"</span>
</code></pre></div>    </div>
  </li>
  <li>ì¡°ê±´ì´ ì°¸ì¼ë•Œì˜ ê°’ê³¼ ê±°ì§“ì¼ë•Œì˜ ê°’ì˜ íƒ€ì…ì´ ë‹¤ë¥¼ ê²½ìš°, í…Œë¼í¼ì€ ìë™ìœ¼ë¡œ ë¬¸ìì—´ íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>

<span class="err">&gt;</span> <span class="mi">3</span> <span class="err">==</span> <span class="mi">4</span> <span class="err">?</span> <span class="mi">3</span> <span class="err">:</span> <span class="mi">4</span>
<span class="c1"># =&gt; 4</span>
  
<span class="err">&gt;</span> <span class="mi">1</span> <span class="err">==</span> <span class="mi">1</span> <span class="err">?</span> <span class="mi">1</span> <span class="err">:</span> <span class="s2">"two"</span>
<span class="c1"># =&gt; "1"</span>
  
<span class="err">&gt;</span> <span class="mi">1</span> <span class="err">==</span> <span class="mi">2</span> <span class="err">?</span> <span class="mi">1</span> <span class="err">:</span> <span class="s2">"two"</span>
<span class="c1"># =&gt; "two"</span>
</code></pre></div>    </div>
    <p>ìœ„ì˜ ì˜ˆì œì™€ ê°™ì´ 1 == 1 ì¼ë•Œ ê°’ì´ ìˆ«ì 1ì´ì§€ë§Œ ë¬¸ìì—´ â€œ1â€ì„ ë°˜í™˜í•¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>ê°€ëŠ¥í•˜ë©´ ëª…ì‹œì ìœ¼ë¡œ íƒ€ì…ì„ ì§€ì •í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
  
<span class="err">&gt;</span> <span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">?</span> <span class="mi">1</span> <span class="err">:</span> <span class="s2">"two"</span>            <span class="c1"># ë¹„ê¶Œì¥</span>
<span class="err">&gt;</span> <span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">?</span> <span class="s2">"1"</span> <span class="err">:</span> <span class="s2">"two"</span>          <span class="c1"># ê¶Œì¥</span>
<span class="err">&gt;</span> <span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">?</span> <span class="nx">tostring</span><span class="err">(</span><span class="mi">1</span><span class="err">)</span> <span class="err">:</span> <span class="s2">"two"</span>  <span class="c1"># ê¶Œì¥</span>
</code></pre></div>    </div>
  </li>
  <li>ì¡°ê±´ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ìƒì„± ì—¬ë¶€ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"enable"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">enable</span> <span class="err">?</span> <span class="mi">1</span> <span class="err">:</span> <span class="mi">0</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"content abc"</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ì‹¤í–‰ ê²°ê³¼
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; local_file.abc[0]</span>
<span class="nv">$ </span><span class="nb">cat </span>abc.txt
<span class="c"># =&gt; content abc</span>
    
<span class="c"># ë³€ìˆ˜ì˜ default ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ í™˜ê²½ë³€ìˆ˜ë¥¼ í†µí•´ enable ë³€ìˆ˜ë¥¼ falseë¡œ ë³€ê²½</span>
    
<span class="nv">$ </span><span class="nb">export </span><span class="nv">TF_VAR_enable</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; ì—†ìŒ</span>
<span class="nv">$ </span><span class="nb">cat </span>abc.txt
<span class="c"># =&gt; cat: abc.txt: No such file or directory </span>
</code></pre></div>        </div>
        <p>ìœ„ì™€ ê°™ì´ var.enable ë³€ìˆ˜ ê°’ì— ë”°ë¼ true ì¼ë•ŒëŠ” íŒŒì¼ì´ ìƒì„±ë˜ê³ , false ì¼ë•ŒëŠ” íŒŒì¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="í•¨ìˆ˜-function">í•¨ìˆ˜ (Function)</h3>

<ul>
  <li>í…Œë¼í¼ì—ì„œëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ì²˜ëŸ¼ ê°’ì˜ ìœ í˜•ì„ ë³€ê²½í•˜ê±°ë‚˜ ê°€ê³µí•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë‚´ì¥ í•¨ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
  <li>ì „ì²´ í•¨ìˆ˜ ëª©ë¡ì€ <a href="https://www.terraform.io/docs/language/functions/index.html">ê³µì‹ë¬¸ì„œ</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ëŠ” ì§€ì›í•˜ì§€ ì•Šìœ¼ë©°, ìˆ«ì, ë¬¸ìì—´, ì»¬ë ‰ì…˜, ì¸ì½”ë”©, ë‚ ì§œ, íŒŒì¼, ë„¤íŠ¸ì›Œí¬ ë“± ë‹¤ì–‘í•œ í•¨ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
  <li>ì‹¤ìŠµ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
  
<span class="err">&gt;</span> <span class="nx">upper</span><span class="err">(</span><span class="s2">"hello"</span><span class="err">)</span>                          <span class="c1"># =&gt; "HELLO"</span>
<span class="err">&gt;</span> <span class="nx">title</span><span class="err">(</span><span class="s2">"hello world"</span><span class="err">)</span>                    <span class="c1"># =&gt; "Hello World"</span>
<span class="err">&gt;</span> <span class="nx">max</span><span class="err">(</span><span class="mi">1</span><span class="err">,</span> <span class="mi">20</span><span class="err">,</span> <span class="mi">3</span><span class="err">,</span> <span class="mi">40</span><span class="err">,</span> <span class="mi">5</span><span class="err">)</span>                    <span class="c1"># =&gt; 40</span>
<span class="err">&gt;</span> <span class="nx">cidrnetmask</span><span class="err">(</span><span class="s2">"172.16.0.0/12"</span><span class="err">)</span>            <span class="c1"># =&gt; "255.240.0.0"</span>
<span class="err">&gt;</span> <span class="nx">cidrsubnet</span><span class="err">(</span><span class="s2">"1.1.1.0/24"</span><span class="err">,</span> <span class="mi">1</span><span class="err">,</span> <span class="mi">0</span><span class="err">)</span>          <span class="c1"># =&gt; "1.1.1.0/25"</span>
<span class="err">&gt;</span> <span class="nx">cidrsubnet</span><span class="err">(</span><span class="s2">"1.1.1.0/24"</span><span class="err">,</span> <span class="mi">1</span><span class="err">,</span> <span class="mi">1</span><span class="err">)</span>          <span class="c1"># =&gt; "1.1.1.128/25"</span>
<span class="err">&gt;</span> <span class="nx">cidrsubnets</span><span class="err">(</span><span class="s2">"10.1.0.0/16"</span><span class="err">,</span> <span class="mi">4</span><span class="err">,</span> <span class="mi">4</span><span class="err">,</span> <span class="mi">8</span><span class="err">,</span> <span class="mi">4</span><span class="err">)</span>  <span class="c1"># =&gt; tolist([</span>
                                          <span class="c1">#      "10.1.0.0/20",</span>
                                          <span class="c1">#      "10.1.16.0/20",</span>
                                          <span class="c1">#      "10.1.32.0/24",</span>
                                          <span class="c1">#      "10.1.48.0/20",</span>
                                          <span class="c1">#    ])  </span>
<span class="err">&gt;</span> <span class="nx">timestamp</span><span class="err">()</span>                             <span class="c1"># =&gt; "2024-06-27T14:00:00Z"</span>
<span class="err">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="s2">"hello world again"</span><span class="p">)</span><span class="k">}</span><span class="s2">!!"</span>       <span class="c1"># =&gt; "Hello World Again!!"</span>
  
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">a</span> <span class="nx">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="err">:</span> <span class="nx">cidrsubnet</span><span class="p">(</span><span class="s2">"1.1.1.0/24"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">a</span><span class="p">)]</span>  <span class="c1"># =&gt; [</span>
                                                         <span class="c1">#      "1.1.1.0/26",</span>
                                                         <span class="c1">#      "1.1.1.64/26",</span>
                                                         <span class="c1">#      "1.1.1.128/26",</span>
                                                         <span class="c1">#      "1.1.1.192/26",</span>
                                                         <span class="c1">#    ]</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="í”„ë¡œë¹„ì €ë„ˆ-provisioner">í”„ë¡œë¹„ì €ë„ˆ (provisioner)</h3>
<ul>
  <li>í”„ë¡œë¹„ì €ë„ˆëŠ” ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ëœ í›„ì— ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ì„¤ì •ì´ë‚˜ ì´ˆê¸°í™” ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.</li>
  <li>í”„ë¡œë°”ì´ë”ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ëª…ë ¹ì–´ ì‹¤í–‰ê³¼ íŒŒì¼ ë³µì‚¬ ê°™ì€ ì—­í• ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë‹¨, í”„ë¡œë¹„ì €ë„ˆë¥¼ í†µí•œ ì‘ì—…ì€ <strong>ìƒíƒœ(state)ê°€ ê´€ë¦¬ ë˜ì§€ ì•Šìœ¼ë©°</strong>, <strong>í”„ë¡œë¹„ì €ë‹ì— ëŒ€í•œ ê²°ê³¼ê°€ í•­ìƒ ê°™ë‹¤ê³  ë³´ì¥í•  ìˆ˜ ì—†ê¸°ì—</strong>
ë‹¤ë¥¸ ë°©ì•ˆì´ ì—†ì„ë•Œ ìµœí›„ì˜ ìˆ˜ë‹¨ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
    <ul>
      <li>í”„ë¡œë¹„ì €ë„ˆì˜ ëŒ€ì•ˆ
        <ul>
          <li>AWS EC2ì˜ ê²½ìš° í…Œë¼í¼ ì½”ë“œ <code class="language-plaintext highlighter-rouge">user_data</code> ì‚¬ìš©
            <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="err">...</span>
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"..."</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
      
  <span class="nx">user_data</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
  #!/bin/bash
  echo "Hello, World" &gt; index.html
  nohup busybox httpd -f -p 8080 &amp;
</span><span class="no">  EOF
</span><span class="p">}</span>   
</code></pre></div>            </div>
          </li>
          <li><a href="https://developer.hashicorp.com/terraform/tutorials/provision/cloud-init">cloud-init</a>,
<a href="https://developer.hashicorp.com/terraform/tutorials/provision/packer">packer</a>,
<a href="https://developer.hashicorp.com/terraform/language/resources/provisioners/connection">provisioner connections</a> ë“±ì„ ì‚¬ìš©</li>
          <li>ë³„ë„ì˜ ì„¤ì • ê´€ë¦¬íˆ´ ì‚¬ìš© (Ansible, Chef, Puppet ë“±)</li>
        </ul>
      </li>
      <li>ì´ì „ì—ëŠ” <code class="language-plaintext highlighter-rouge">local-exec</code> í”„ë¡œë¹„ì €ë„ˆë¥¼ í†µí•´ì„œ ansibleê³¼ ì—°ë™í•˜ì—¬ ì¸í”„ë¼ í”„ë¡œë¹„ì €ë‹ í›„ êµ¬ì„±ì„ ê´€ë¦¬í•˜ì˜€ìœ¼ë‚˜, 
ìµœê·¼ì—ëŠ” ì´ë¥¼ ê°œì„ í•˜ì—¬ <a href="https://registry.terraform.io/providers/ansible/ansible/latest/docs">terraform-provider-ansible</a>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h4 id="local-exec-í”„ë¡œë¹„ì €ë„ˆ">local-exec í”„ë¡œë¹„ì €ë„ˆ</h4>
<ul>
  <li>í…Œë¼í¼ì´ ì‹¤í–‰ë˜ëŠ” ë¡œì»¬ì—ì„œ ì‹¤í–‰ë˜ëŠ” ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë¦¬ëˆ…ìŠ¤ë‚˜ ìœˆë„ìš° ë“± ì‹¤í–‰ í™˜ê²½ì— ë§ê²Œ ì»¤ë§¨ë“œë¥¼ ì •ì˜í•´ì•¼ í•˜ë©°, ë‹¤ìŒì˜ ì¸ìˆ˜ ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">command</code> (í•„ìˆ˜) : ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. Â«EOFë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ì¤„ë¡œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">working_dir</code> (ì„ íƒ) : ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë””ë ‰í† ë¦¬ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">interpreter</code> (ì„ íƒ) : ë°°ì—´ë¡œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ì¸í„°í”„ë¦¬í„°ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì²«ë²ˆì§¸ ì¸ìˆ˜ëŠ” ì¸í„°í”„ë¦¬í„° ëª…ë ¹ì–´ ì´ë¦„ì´ê³ , ë‘ë²ˆì§¸ ë¶€í„°ëŠ” ì¸ìˆ˜ ê°’ì…ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">environment</code> (ì„ íƒ) : ì‹¤í–‰ì‹œì˜ í™˜ê²½ ë³€ìˆ˜ì— ì¶”ê°€ì ì¸ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. key = value í˜•íƒœë¡œ ì •ì˜í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">on_failure</code> (ì„ íƒ) : ëª…ë ¹ì–´ ì‹¤í–‰ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì˜ˆì‹œ
    <ul>
      <li>Unix/Linux/macOS
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="k">provisioner</span> <span class="s2">"local-exec"</span> <span class="p">{</span>
    <span class="nx">command</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
      echo "Hello, World $FOO"
</span><span class="no">      EOF
</span>    <span class="nx">interpreter</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"bash"</span><span class="p">,</span> <span class="s2">"-c"</span><span class="p">]</span>
    <span class="nx">working_dir</span> <span class="p">=</span> <span class="s2">"/tmp"</span>
    <span class="nx">environment</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">FOO</span> <span class="p">=</span> <span class="s2">"bar"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>ì‹¤í–‰ê²°ê³¼
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    null_resource.example: Provisioning with 'local-exec'...</span>
<span class="c">#    null_resource.example (local-exec): Executing: ["bash" "-c" "          echo \"Hello, World $FOO\"\n"]</span>
<span class="c">#    null_resource.example (local-exec): Hello, World bar</span>
      
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show null_resource.example
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate 
</code></pre></div>            </div>
            <p>ëª…ë ¹ì´ ì‹¤í–‰ì€ ë˜ë‚˜ ìƒíƒœ íŒŒì¼ì—ëŠ” í”„ë¡œë¹„ì €ë‹ì— ëŒ€í•œ ì •ë³´ê°€ ì €ì¥ë˜ì§€ ì•ŠìŒì„ í™•ì•ˆ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          </li>
        </ul>
      </li>
      <li>Windows
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="k">provisioner</span> <span class="s2">"local-exec"</span> <span class="p">{</span>
    <span class="nx">command</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
      echo "Hello, World %FOO%"
</span><span class="no">      EOF
</span>    <span class="nx">interpreter</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"PowerShell"</span><span class="p">,</span> <span class="s2">"-Command"</span><span class="p">]</span>
    <span class="nx">working_dir</span> <span class="p">=</span> <span class="s2">"C:</span><span class="se">\\</span><span class="s2">windows</span><span class="se">\\</span><span class="s2">temp"</span>
    <span class="nx">environment</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">FOO</span> <span class="p">=</span> <span class="s2">"bar"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="ì›ê²©ì§€-ì—°ê²°">ì›ê²©ì§€ ì—°ê²°</h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">remote-exec</code>ì™€ <code class="language-plaintext highlighter-rouge">file</code> í”„ë¡œë¹„ì €ë„ˆë¥¼ ì‚¬ìš©í•˜ì—¬ ì›ê²©ì§€ ì„œë²„ì— ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ íŒŒì¼ì„ ë³µì‚¬í•˜ë ¤ë©´ ì›ê²©ì§€ ì—°ê²°í•  SSH ë˜ëŠ” WinRM (windows ì„œë²„ì˜ ê²½ìš°) ì—°ê²° ì •ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
    <ul>
      <li><a href="https://developer.hashicorp.com/terraform/language/resources/provisioners/connection">ì°¸ì¡° ë¬¸ì„œ ë§í¬</a></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">connection</code> ë¸”ë¡ì€ ë¦¬ì†ŒìŠ¤ ë‚´ì—ì„œ ì„ ì–¸ì‹œ í•´ë‹¹ ë¸”ë¡ ë‚´ì˜ í”„ë¡œë¹„ì €ë„ˆì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ë©°, í”„ë¡œë¹„ì €ë„ˆ ë‚´ì—ì„œ ì„ ì–¸ ë˜ëŠ” ê²½ìš° í•´ë‹¹ í”„ë¡œë¹„ì €ë„ˆì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="c1"># connection ë¸”ë¡ìœ¼ë¡œ ì›ê²©ì§€ ì—°ê²° ì •ì˜</span>
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"example1"</span> <span class="p">{</span>
    
  <span class="nx">connection</span> <span class="p">{</span>
    <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"ssh"</span>
    <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"root"</span>
    <span class="nx">password</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">root_password</span>
    <span class="nx">host</span>     <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">host</span>
  <span class="p">}</span>
    
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"conf/myapp.conf"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/etc/myapp.conf"</span>
  <span class="p">}</span>
    
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"conf/myapp.conf"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"C:/App/myapp.conf"</span>
      
    <span class="nx">connection</span> <span class="p">{</span>
        <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"winrm"</span>
        <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"Administrator"</span>
        <span class="nx">password</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">admin_password</span>
        <span class="nx">host</span>     <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">host</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>   
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">connection</code> ì ìš© ì¸ìˆ˜ì™€ ì„¤ëª…</p>

    <table>
      <thead>
        <tr>
          <th>ì¸ìˆ˜</th>
          <th>ì—°ê²° íƒ€ì…</th>
          <th>ì„¤ëª…</th>
          <th>ê¸°ë³¸ê°’</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>type</td>
          <td>SSH/WinRM</td>
          <td>ì—°ê²° ìœ í˜•ìœ¼ë¡œ ssh ë˜ëŠ” winrm</td>
          <td>ssh</td>
        </tr>
        <tr>
          <td>user</td>
          <td>SSH/WinRM</td>
          <td>ì—°ê²°ì— ì‚¬ìš©ë˜ëŠ” ì‚¬ìš©ì</td>
          <td>ssh: root, winrm: Administrator</td>
        </tr>
        <tr>
          <td>password</td>
          <td>SSH/WinRM</td>
          <td>ì—°ê²°ì— ì‚¬ìš©ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>host</td>
          <td>SSH/WinRM</td>
          <td>(í•„ìˆ˜) ì—°ê²° ëŒ€ìƒ ì£¼ì†Œ</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>port</td>
          <td>SSH/WinRM</td>
          <td>ì—°ê²° ëŒ€ìƒì˜ íƒ€ì…ë³„ ì‚¬ìš© í¬íŠ¸</td>
          <td>ssh: 22, winrm: 5985</td>
        </tr>
        <tr>
          <td>timeout</td>
          <td>SSH/WinRM</td>
          <td>ì—°ê²° ì‹œë„ì— ëŒ€í•œ ëŒ€ê¸° ê°’</td>
          <td>5m</td>
        </tr>
        <tr>
          <td>script_path</td>
          <td>SSH/WinRM</td>
          <td>ìŠ¤í¬ë¦½íŠ¸ ë³µì œ ì‹œ ìƒì„±ë˜ëŠ” ê²½ë¡œ</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>private_key</td>
          <td>SSH</td>
          <td>ì—°ê²° ì‹œ ì‚¬ìš©í•  SSH keyë¥¼ ì§€ì •í•˜ë©°, password ì¸ìˆ˜ë³´ë‹¤ ìš°ì„ í•¨</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>certificate</td>
          <td>SSH</td>
          <td>ì„œëª…ëœ CA ì¸ì¦ì„œë¡œ ì‚¬ìš© ì‹œ private_keyì™€ í•¨ê»˜ ì‚¬ìš©</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>agent</td>
          <td>SSH</td>
          <td>ssh-agentë¥¼ ì‚¬ìš©í•´ ì¸ì¦í•˜ì§€ ì•ŠëŠ” ê²½ ìš° falseë¡œ ì„¤ì •í•˜ë©° Windowsì˜ ê²½ìš° Pageantë§Œ ì‚¬ìš© ê°€ëŠ¥</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>agent_identity</td>
          <td>SSH</td>
          <td>ì¸ì¦ì„ ìœ„í•œ ssh-agentì˜ ê¸°ë³¸ ì‚¬ìš©ì</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>host_key</td>
          <td>SSH</td>
          <td>ì›ê²© í˜¸ìŠ¤íŠ¸ ë˜ëŠ” ì„œëª…ëœ CAì˜ ì—°ê²°ì„ í™•ì¸ í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê³µê°œí‚¤</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>target_platform</td>
          <td>SSH</td>
          <td>ì—°ê²° ëŒ€ìƒ í”Œë«í¼ìœ¼ë¡œ windows ë˜ëŠ” unix</td>
          <td>unix</td>
        </tr>
        <tr>
          <td>https</td>
          <td>WinRM</td>
          <td>trueì¸ ê²½ìš° HTTPSë¡œ ì—°ê²°</td>
          <td>false</td>
        </tr>
        <tr>
          <td>insecure</td>
          <td>WinRM</td>
          <td>trueì¸ ê²½ìš° HTTPS ìœ íš¨ì„± ë¬´ì‹œ</td>
          <td>false</td>
        </tr>
        <tr>
          <td>use_ntlm</td>
          <td>WinRM</td>
          <td>trueì¸ ê²½ìš° NTLM ì¸ì¦ì„ ì‚¬ìš©</td>
          <td>false</td>
        </tr>
        <tr>
          <td>cacert</td>
          <td>WinRM</td>
          <td>ìœ íš¨ì„± ê²€ì¦ì„ ìœ„í•œ CA ì¸ì¦ì„œ</td>
          <td>Â </td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>ì›ê²©ì—°ê²°ì´ ìš”êµ¬ë˜ëŠ” í”„ë¡œë¹„ì €ë„ˆì˜ ê²½ìš° ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ì›ê²© ì‹œìŠ¤í…œì— ì—…ë¡œë“œí•˜ì—¬ í•´ë‹¹ ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ì‰˜ì—ì„œ ì‹¤í–‰í•˜ë„ë¡ í•˜ë¯€ë¡œ 
<code class="language-plaintext highlighter-rouge">script_path</code>ì— ì ì ˆí•œ ìœ„ì¹˜ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ê²½ë¡œëŠ” ë‚œìˆ˜ì¸ %RAND% ê²½ë¡œê°€ í¬í•¨ë˜ì–´ ìƒì„±ë©ë‹ˆë‹¤.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Unix/Linux/macOS : /tmp/terraform_%RAND%.sh
Windows(cmd) : C:/windows/temp/terraform_%RAND%.cmd
Windows(PowerShell) : C:/windows/temp/terraform_%RAND%.ps1
</code></pre></div>    </div>
  </li>
  <li>
    <p>ë² ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ë¥¼ í†µí•œ ì—°ê²°ì˜ ê²½ìš° ê´€ë ¨ ì¸ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤. <a href="https://developer.hashicorp.com/terraform/language/resources/provisioners/connection#connecting-through-a-bastion-host-with-ssh">ì°¸ê³ ìë£Œ ë§í¬</a></p>

    <table>
      <thead>
        <tr>
          <th>ì¸ìˆ˜</th>
          <th>ì„¤ëª…</th>
          <th>ê¸°ë³¸ê°’</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>bastion_host</td>
          <td>ì„¤ì •í•˜ê²Œ ë˜ë©´ ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ ì—°ê²°ì´ í™œì„±í™”ë˜ë©°, ì—°ê²° ëŒ€ìƒ í˜¸ìŠ¤íŠ¸ë¥¼ ì§€ì •</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>bastion_host_key</td>
          <td>í˜¸ìŠ¤íŠ¸ ì—°ê²°ì„ ìœ„í•œ ê³µê°œí‚¤</td>
          <td>Â </td>
        </tr>
        <tr>
          <td>bastion_port</td>
          <td>ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ì— ì—°ê²°í•  í¬íŠ¸</td>
          <td>port ì¸ìˆ˜ ê°’</td>
        </tr>
        <tr>
          <td>bastion_user</td>
          <td>ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ì— ì—°ê²°í•  ì‚¬ìš©ì</td>
          <td>user ì¸ìˆ˜ ê°’</td>
        </tr>
        <tr>
          <td>bastion_password</td>
          <td>ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ ì—°ê²°ì— ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸</td>
          <td>password ì¸ìˆ˜ ê°’</td>
        </tr>
        <tr>
          <td>bastion_private key</td>
          <td>ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ ì—°ê²°ì— ì‚¬ìš©í•  SSH í‚¤íŒŒì¼</td>
          <td>private key ì¸ìˆ˜ ê°’</td>
        </tr>
        <tr>
          <td>bastion_certificate</td>
          <td>ì„œëª…ëœ CA ì¸ì¦ì„œ ë‚´ìš©ìœ¼ë¡œ bastion_private_keyì™€ í•¨ê»˜ ì‚¬ìš©</td>
          <td>Â </td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<h4 id="file-í”„ë¡œë¹„ì €ë„ˆ">file í”„ë¡œë¹„ì €ë„ˆ</h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">file</code> í”„ë¡œë¹„ì €ë„ˆëŠ” ë¡œì»¬ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ë¥¼ ì›ê²©ì§€ ì„œë²„ë¡œ ë³µì‚¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
  <li>ì‚¬ìš©ë˜ëŠ” ì¸ìˆ˜
    <ul>
      <li><code class="language-plaintext highlighter-rouge">source</code> (ì„ íƒ) : ë¡œì»¬ íŒŒì¼ ë˜ëŠ” ë””ë ‰í„°ë¦¬ì˜ ê²½ë¡œë¥¼ ì§€ì •í•˜ë©° <strong>ìƒëŒ€ ê²½ë¡œ ë˜ëŠ” ì ˆëŒ€ ê²½ë¡œ</strong>ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">content</code> (ì„ íƒ) : íŒŒì¼ì˜ ë‚´ìš©ì„ ì§ì ‘ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, <code class="language-plaintext highlighter-rouge">source</code>ì™€ <code class="language-plaintext highlighter-rouge">content</code> ì¤‘ í•˜ë‚˜ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ìƒì´ ë””ë ‰í„°ë¦¬ì¸ ê²½ìš° tf-file-content íŒŒì¼ë¡œ ìƒì„±ë˜ê³ , ëŒ€ìƒì´ íŒŒì¼ì¸ ê²½ìš° í•´ë‹¹ íŒŒì¼ì— ë‚´ìš©ì´ ê¸°ë¡ë©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">destination</code> (í•„ìˆ˜) : ì›ê²©ì§€ ì„œë²„ì— ë³µì‚¬ë  íŒŒì¼ ë˜ëŠ” ë””ë ‰í„°ë¦¬ì˜ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤. í•­ìƒ <strong>ì ˆëŒ€ ê²½ë¡œ</strong>ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">destination</code> ì§€ì •ì‹œ ì£¼ì˜í•  ì ì€ ssh ì—°ê²°ì˜ ê²½ìš° ë””ë ‰í„°ë¦¬ê°€ ì¡´ì¬í•´ì•¼ í•˜ë©°, WinRM ì—°ê²°ì˜ ê²½ìš° ë””ë ‰í„°ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.</li>
  <li>ë˜í•œ ë””ë ‰í„°ë¦¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•  ê²½ìš° <code class="language-plaintext highlighter-rouge">source</code> ê²½ë¡œì— ë”°ë¼ íŒŒì¼ ë˜ëŠ” ë””ë ‰í„°ë¦¬ë¡œ ë³µì‚¬ë©ë‹ˆë‹¤.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">destination</code>ì´ /tmp ì¼ ë•Œ <code class="language-plaintext highlighter-rouge">source</code>ê°€ ë””ë ‰í„°ë¦¬ë¡œ <code class="language-plaintext highlighter-rouge">/foo</code> ì²˜ëŸ¼ ë§ˆì§€ë§‰ì— <code class="language-plaintext highlighter-rouge">/</code> ê°€ ì—†ëŠ” ê²½ìš° ëŒ€ìƒ ë””ë ‰í„°ë¦¬ì— ì§€ì •ëœ ë””ë ‰í„°ë¦¬ê°€ ì—…ë¡œë“œ ë˜ì–´ /tmp/foo í˜•íƒœë¡œ ì—…ë¡œë“œ ë©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">destination</code>ì´ /tmp ì¼ ë•Œ <code class="language-plaintext highlighter-rouge">source</code>ê°€ ë””ë ‰í„°ë¦¬ë¡œ <code class="language-plaintext highlighter-rouge">/foo/</code> ì²˜ëŸ¼ ë§ˆì§€ë§‰ì— <code class="language-plaintext highlighter-rouge">/</code> ê°€ ìˆëŠ” ê²½ìš° ëŒ€ìƒ ë””ë ‰í„°ë¦¬ì— ì§€ì •ëœ ë””ë ‰í„°ë¦¬ê°€ ì—…ë¡œë“œ ë˜ì–´ /tmp/foo í˜•íƒœë¡œ ì—…ë¡œë“œ ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì˜ˆì œ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"foo"</span> <span class="p">{</span>    
  <span class="c1"># connection ë¸”ë¡ìœ¼ë¡œ ì›ê²©ì§€ ì •ì˜</span>
  <span class="nx">connection</span> <span class="p">{</span>
    <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"ssh"</span>
    <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"root"</span>
    <span class="nx">password</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">root_password</span>
    <span class="nx">host</span>     <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">host</span>
  <span class="p">}</span>
  
  <span class="c1"># myapp.conf íŒŒì¼ì´ /etc/myapp.conf ë¡œ ì—…ë¡œë“œ</span>
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"conf/myapp.conf"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/etc/myapp.conf"</span>
  <span class="p">}</span>
    
  <span class="c1"># contentì˜ ë‚´ìš©ì´ /tmp/file.log íŒŒì¼ë¡œ ìƒì„±</span>
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">content</span>     <span class="p">=</span> <span class="s2">"ami used: ami"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/tmp/file.log"</span>
  <span class="p">}</span>
    
  <span class="c1"># configs.d ë””ë ‰í„°ë¦¬ê°€ /etc/configs.d ë¡œ ì—…ë¡œë“œ</span>
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"conf/configs.d"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/etc"</span>
  <span class="p">}</span>
    
  <span class="c1"># apps/app1 ë””ë ‰í„°ë¦¬ ë‚´ì˜ íŒŒì¼ë“¤ë§Œ D:/IIS/webapp1 ë””ë ‰í„°ë¦¬ ë‚´ì— ì—…ë¡œë“œ</span>
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"apps/app1/"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"D:/IIS/webapp1"</span>
  <span class="p">}</span>
<span class="p">}</span>  
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="remote_exec-í”„ë¡œë¹„ì €ë„ˆ">remote_exec í”„ë¡œë¹„ì €ë„ˆ</h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">remote-exec</code> í”„ë¡œë¹„ì €ë„ˆëŠ” ì›ê²©ì§€ ì„œë²„ì— ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ AWSì˜ EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ VMì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>ì‚¬ìš©í•˜ëŠ” ì¸ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ê³ , ìƒí˜¸ ë°°íƒ€ì ìœ¼ë¡œ í•˜ë‚˜ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">inline</code> : ëª…ë ¹ì–´ì— ëŒ€í•œ ëª©ë¡ìœ¼ë¡œ [ ] ë¸”ë¡ ë‚´ì— â€œ â€œ ë¡œ ë¬¶ì¸ ë‹¤ìˆ˜ì˜ ëª…ë ¹ì„ , ë¡œ êµ¬ë¶„í•˜ì—¬ ì§€ì •í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">script</code> : ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì€ ë¡œì»¬ íŒŒì¼ë¡œ ì§€ì •í•˜ë©°, ì›ê²©ì§€ ì„œë²„ë¡œ ë³µì‚¬ë˜ì–´ ì‹¤í–‰ë©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">scripts</code> : ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì˜ ëª©ë¡ìœ¼ë¡œ [ ] ë¸”ë¡ ë‚´ì— â€œ â€œ ë¡œ ë¬¶ì¸ ë‹¤ìˆ˜ì˜ íŒŒì¼ì„ , ë¡œ êµ¬ë¶„í•˜ì—¬ ì§€ì •í•©ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ ë¡œì»¬ íŒŒì¼ë¡œ ì§€ì •í•˜ë©°, ì›ê²©ì§€ ì„œë²„ë¡œ ë³µì‚¬ë˜ì–´ ì‹¤í–‰ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">script</code>ë‚˜ <code class="language-plaintext highlighter-rouge">scripts</code>ëŠ” ì¸ìˆ˜ë¥¼ ì§€ì •í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì¸ìˆ˜ê°€ í•„ìš”í•œ ê²½ìš° <code class="language-plaintext highlighter-rouge">file</code> í”„ë¡œë°”ì´ë”ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—…ë¡œë“œí•˜ê³  <code class="language-plaintext highlighter-rouge">inline</code> ì¸ìˆ˜ë¡œ ìŠ¤í¬ë¦½íŠ¸ì— ì¸ìˆ˜ë¥¼ ì¶”ê°€í•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.</li>
  <li>ì˜ˆì œ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="c1"># ...</span>
  
  <span class="c1"># Establishes connection to be used by all</span>
  <span class="c1"># generic remote provisioners (i.e. file/remote-exec)</span>
  <span class="nx">connection</span> <span class="p">{</span>
    <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"ssh"</span>
    <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"root"</span>
    <span class="nx">password</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">root_password</span>
    <span class="nx">host</span>     <span class="p">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="p">}</span>
  
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"script.sh"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/tmp/script.sh"</span>
  <span class="p">}</span>
  
  <span class="k">provisioner</span> <span class="s2">"remote-exec"</span> <span class="p">{</span>
    <span class="nx">inline</span> <span class="p">=</span> <span class="p">[</span>
      <span class="s2">"chmod +x /tmp/script.sh"</span><span class="p">,</span>
      <span class="s2">"/tmp/script.sh args"</span><span class="p">,</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="null_resourceì™€-terraform_data">null_resourceì™€ terraform_data</h3>
<h4 id="null_resource">null_resource</h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">null_resource</code> ë¸”ë¡ì€ ìì²´ì ìœ¼ë¡œëŠ” ì•„ë¬´ê²ƒë„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    <ul>
      <li>ì´ëŸ° ë¦¬ì†ŒìŠ¤ê°€ í•„ìš”í•œ ì´ìœ ëŠ” ì‚¬ìš©ìê°€ ì˜ë„ì ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ ë™ì‘ì„ ì¡°ìœ¨í•´ì•¼ í•˜ëŠ” ìƒí™©ì—ì„œ, í”„ë¡œë°”ì´ë”ê°€ ì œê³µí•˜ëŠ” ë¦¬ì†ŒìŠ¤ ìˆ˜ëª…ì£¼ê¸°ê´€ë¦¬ë§Œìœ¼ë¡œëŠ” í•´ê²°í•˜ê¸° ì–´ë ¤ìš¸ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
      <li>ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
        <ul>
          <li>í”„ë¡œë¹„ì €ë‹ ìˆ˜í–‰ ê³¼ì •ì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰</li>
          <li>í”„ë¡œë¹„ì €ë„ˆì™€ í•¨ê»˜ ì‚¬ìš©</li>
          <li>ëª¨ë“ˆ, ë°˜ë³µë¬¸, ë°ì´í„° ì†ŒìŠ¤, ë¡œì»¬ ë³€ìˆ˜ì™€ í•¨ê»˜ ì‚¬ìš©</li>
          <li>ì¶œë ¥ì„ ìœ„í•œ ë°ì´í„° ê°€ê³µ</li>
        </ul>
      </li>
      <li>ì˜ˆì œ
        <ul>
          <li>ë‹¤ìŒ ìƒí™©ì„ ê°€ì •
            <ul>
              <li>AWS EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ë©´ì„œ ì›¹ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ì‹¶ë‹¤.</li>
              <li>ì›¹ì„œë¹„ìŠ¤ ì„¤ì •ì—ëŠ” ë…¸ì¶œë˜ì–´ì•¼ í•˜ëŠ” ê³ ì •ëœ ì™¸ë¶€ IPê°€ í¬í•¨ëœ êµ¬ì„±ì´ í•„ìš”í•˜ë‹¤. ë”°ë¼ì„œ aws_eip ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤.</li>
            </ul>
          </li>
          <li>AWS EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê¸° ìœ„í•´ aws_instance ë¦¬ì†ŒìŠ¤ êµ¬ì„± ì‹œ ì•ì„œ í™•ì¸í•œ í”„ë¡œë¹„ì €ë„ˆë¥¼ í™œìš©í•˜ì—¬ ì›¹ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ê³ ì í•œë‹¤</li>
          <li>1ì°¨ ì‹œë„
            <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
      
<span class="k">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"instance"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"t101sg"</span>
      
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
      
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
      
<span class="p">}</span>
      
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="s2">"ami-0c9c942bd7bf113a2"</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">subnet_id</span>              <span class="p">=</span> <span class="s2">"subnet-dbc571b0"</span>  <span class="c1"># ê°ì default VPCì— subnet ID ì•„ë¬´ê±°ë‚˜</span>
  <span class="nx">private_ip</span>             <span class="p">=</span> <span class="s2">"172.31.1.100"</span>
  <span class="nx">vpc_security_group_ids</span> <span class="p">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
      
  <span class="nx">user_data</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
              #!/bin/bash
              echo "Hello, T101 Study" &gt; index.html
              nohup busybox httpd -f -p 80 &amp;
</span><span class="no">              EOF
      
</span>  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"Single-WebSrv"</span>
  <span class="p">}</span>
      
  <span class="k">provisioner</span> <span class="s2">"remote-exec"</span> <span class="p">{</span>
    <span class="nx">inline</span> <span class="p">=</span> <span class="p">[</span>
      <span class="s2">"echo </span><span class="k">${</span><span class="nx">aws_eip</span><span class="p">.</span><span class="nx">myeip</span><span class="p">.</span><span class="nx">public_ip</span><span class="k">}</span><span class="s2">"</span>
     <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
      
<span class="k">resource</span> <span class="s2">"aws_eip"</span> <span class="s2">"myeip"</span> <span class="p">{</span>
  <span class="c1">#vpc = true</span>
  <span class="nx">instance</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">associate_with_private_ip</span> <span class="p">=</span> <span class="s2">"172.31.1.100"</span>
<span class="p">}</span>
      
<span class="k">output</span> <span class="s2">"public_ip"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The public IP of the Instance"</span>
<span class="p">}</span>      
</code></pre></div>            </div>
            <ul>
              <li>aws_eipê°€ ìƒì„±ë˜ëŠ” ê³ ì •ëœ IPë¥¼ í• ë‹¹í•˜ê¸° ìœ„í•´ì„œëŠ” ëŒ€ìƒì¸ aws_instanceì˜ idê°’ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
              <li>aws_instanceì˜ í”„ë¡œë¹„ì €ë„ˆ ë™ì‘ì—ì„œëŠ” aws_eipê°€ ìƒì„±í•˜ëŠ” ì†ì„± ê°’ì¸ public_ipê°€ í•„ìš”í•©ë‹ˆë‹¤.</li>
              <li>applyì‹œ aws_eipì™€ aws_instanceê°€ ì„œë¡œë¥¼ ì°¸ì¡°í•˜ì—¬ ìˆœí™˜ ì°¸ì¡° ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
                <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="nv">$ </span>terraform plan 
<span class="c"># =&gt; Error: Cycle: aws_eip.myeip, aws_instance.example</span>
</code></pre></div>                </div>
              </li>
            </ul>
          </li>
          <li>2ì°¨ ì‹œë„
            <ul>
              <li>ë‘˜ì¤‘ì˜ í•˜ë‚˜ì˜ ì‹¤í–‰ ì‹œì ì„ ë’¤ë¡œ ë¯¸ë¤„ì•¼ í•©ë‹ˆë‹¤.</li>
              <li>ì´ëŸ´ë•Œ null_resourceë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘˜ ì¤‘ í•˜ë‚˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë’¤ë¡œ ë¯¸ë¤„ ìˆœí™˜ ì°¸ì¡°ë¥¼ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
        
<span class="k">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"instance"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"t101sg"</span>
        
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
        
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
        
<span class="p">}</span>
        
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="s2">"ami-0c9c942bd7bf113a2"</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">subnet_id</span>              <span class="p">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">peter_subnet</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">private_ip</span>             <span class="p">=</span> <span class="s2">"172.31.0.100"</span>
  <span class="nx">key_name</span>               <span class="p">=</span> <span class="s2">"aws-ec2"</span> <span class="c1"># ê°ì ìì‹ ì˜ EC2 SSH Keypair ì´ë¦„ ì§€ì •</span>
  <span class="nx">vpc_security_group_ids</span> <span class="p">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
        
  <span class="nx">user_data</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
              #!/bin/bash
              echo "Hello, T101 4th Study" &gt; index.html
              nohup busybox httpd -f -p 80 &amp;
</span><span class="no">              EOF
        
</span>  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"Single-WebSrv"</span>
  <span class="p">}</span>
        
<span class="p">}</span>
        
<span class="k">resource</span> <span class="s2">"aws_eip"</span> <span class="s2">"myeip"</span> <span class="p">{</span>
  <span class="c1">#vpc = true</span>
  <span class="nx">instance</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">associate_with_private_ip</span> <span class="p">=</span> <span class="s2">"172.31.0.100"</span>
<span class="p">}</span>
        
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"echomyeip"</span> <span class="p">{</span>
  <span class="k">provisioner</span> <span class="s2">"remote-exec"</span> <span class="p">{</span>
    <span class="nx">connection</span> <span class="p">{</span>
      <span class="nx">host</span> <span class="p">=</span> <span class="nx">aws_eip</span><span class="p">.</span><span class="nx">myeip</span><span class="p">.</span><span class="nx">public_ip</span>
      <span class="nx">type</span> <span class="p">=</span> <span class="s2">"ssh"</span>
      <span class="nx">user</span> <span class="p">=</span> <span class="s2">"ubuntu"</span>
      <span class="nx">private_key</span> <span class="p">=</span>  <span class="nx">file</span><span class="p">(</span><span class="s2">"/Users/admin/.ssh/aws-ec2-key.cer"</span><span class="p">)</span> <span class="c1"># ê°ì ìì‹ ì˜ EC2 SSH Keypair íŒŒì¼ ìœ„ì¹˜ ì§€ì •</span>
      <span class="c1">#password = "qwe123"</span>
    <span class="p">}</span>
    <span class="nx">inline</span> <span class="p">=</span> <span class="p">[</span>
      <span class="s2">"echo </span><span class="k">${</span><span class="nx">aws_eip</span><span class="p">.</span><span class="nx">myeip</span><span class="p">.</span><span class="nx">public_ip</span><span class="k">}</span><span class="s2">;"</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
        
<span class="k">output</span> <span class="s2">"public_ip"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The public IP of the Instance"</span>
<span class="p">}</span>
        
<span class="k">output</span> <span class="s2">"eip"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_eip</span><span class="p">.</span><span class="nx">myeip</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The EIP of the Instance"</span>
<span class="p">}</span>
</code></pre></div>                </div>
              </li>
              <li>ìœ„ì™€ ê°™ì´ null_resourceë¥¼ ì‚¬ìš©í•˜ì—¬ aws_eip ë¦¬ì†ŒìŠ¤ë¥¼ ë’¤ë¡œ ë¯¸ë£¨ê³ , aws_instance ë¦¬ì†ŒìŠ¤ê°€ ë¨¼ì € ìƒì„±ë˜ë„ë¡ í•˜ì—¬ ìˆœí™˜ ì°¸ì¡° ì˜¤ë¥˜ë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
              <li>ì‹¤í–‰ ê²°ê³¼
                <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Outputs:</span>
<span class="c">#    </span>
<span class="c">#    eip = "43.202.208.93"</span>
<span class="c">#    public_ip = "43.202.208.93"</span>
        
<span class="nv">$ </span>terraform state list

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_eip.myeip.private_ip"</span> | terraform console
<span class="c"># =&gt; "172.31.0.100"</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_eip.myeip.public_ip"</span> | terraform console
<span class="c"># =&gt; "43.202.208.93"</span>

<span class="nv">$ </span>terraform output
<span class="c"># =&gt; eip = "43.202.208.93"</span>
<span class="c">#    public_ip = "43.202.208.93" </span>
        
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div>                </div>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<svg width="1076pt" height="206pt" viewBox="0.00 0.00 1075.75 206.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 202)">
<polygon fill="white" stroke="none" points="-4,4 -4,-202 1071.75,-202 1071.75,4 -4,4" />
<!-- aws_eip.myeip -->
<g id="node1" class="node">
<polygon fill="none" stroke="black" points="865,-36 759,-36 759,0 865,0 865,-36" />
<text text-anchor="middle" x="812" y="-12.2" font-family="sans-serif" font-size="14.00">aws_eip.myeip</text>
</g>
<!-- aws_instance.example -->
<g id="node2" class="node">
<polygon fill="none" stroke="black" points="645.75,-36 492.5,-36 492.5,0 645.75,0 645.75,-36" />
<text text-anchor="middle" x="569.12" y="-12.2" font-family="sans-serif" font-size="14.00">aws_instance.example</text>
</g>
<!-- aws_eip.myeip&#45;&gt;aws_instance.example -->
<g id="edge1" class="edge">
<path fill="none" stroke="black" d="M758.73,-18C729.15,-18 691.38,-18 657.42,-18" />
<polygon fill="black" stroke="black" points="657.58,-14.5 647.58,-18 657.58,-21.5 657.58,-14.5" />
</g>
<!-- aws_security_group.instance -->
<g id="node7" class="node">
<polygon fill="none" stroke="black" points="368.38,-36 178.38,-36 178.38,0 368.38,0 368.38,-36" />
<text text-anchor="middle" x="273.38" y="-12.2" font-family="sans-serif" font-size="14.00">aws_security_group.instance</text>
</g>
<!-- aws_instance.example&#45;&gt;aws_security_group.instance -->
<g id="edge2" class="edge">
<path fill="none" stroke="black" d="M492.1,-18C457.97,-18 417.14,-18 380.1,-18" />
<polygon fill="black" stroke="black" points="380.26,-14.5 370.26,-18 380.26,-21.5 380.26,-14.5" />
</g>
<!-- aws_subnet.peter_subnet -->
<g id="node8" class="node">
<polygon fill="none" stroke="black" points="358.62,-90 188.12,-90 188.12,-54 358.62,-54 358.62,-90" />
<text text-anchor="middle" x="273.38" y="-66.2" font-family="sans-serif" font-size="14.00">aws_subnet.peter_subnet</text>
</g>
<!-- aws_instance.example&#45;&gt;aws_subnet.peter_subnet -->
<g id="edge3" class="edge">
<path fill="none" stroke="black" d="M492.1,-31.98C454.88,-38.82 409.69,-47.12 370.15,-54.39" />
<polygon fill="black" stroke="black" points="369.58,-50.94 360.37,-56.19 370.84,-57.83 369.58,-50.94" />
</g>
<!-- aws_internet_gateway.peter_igw -->
<g id="node3" class="node">
<polygon fill="none" stroke="black" points="379.25,-198 167.5,-198 167.5,-162 379.25,-162 379.25,-198" />
<text text-anchor="middle" x="273.38" y="-174.2" font-family="sans-serif" font-size="14.00">aws_internet_gateway.peter_igw</text>
</g>
<!-- aws_vpc.peter_vpc -->
<g id="node9" class="node">
<polygon fill="none" stroke="black" points="131.5,-117 0,-117 0,-81 131.5,-81 131.5,-117" />
<text text-anchor="middle" x="65.75" y="-93.2" font-family="sans-serif" font-size="14.00">aws_vpc.peter_vpc</text>
</g>
<!-- aws_internet_gateway.peter_igw&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge4" class="edge">
<path fill="none" stroke="black" d="M192.43,-161.56C183.92,-158.97 175.47,-156.11 167.5,-153 146.54,-144.82 124.38,-133.3 106.2,-122.99" />
<polygon fill="black" stroke="black" points="107.99,-119.98 97.58,-118.02 104.49,-126.05 107.99,-119.98" />
</g>
<!-- aws_route.peter_defaultroute -->
<g id="node4" class="node">
<polygon fill="none" stroke="black" points="664.88,-184 473.38,-184 473.38,-148 664.88,-148 664.88,-184" />
<text text-anchor="middle" x="569.12" y="-160.2" font-family="sans-serif" font-size="14.00">aws_route.peter_defaultroute</text>
</g>
<!-- aws_route.peter_defaultroute&#45;&gt;aws_internet_gateway.peter_igw -->
<g id="edge5" class="edge">
<path fill="none" stroke="black" d="M473.16,-170.53C446.93,-171.78 418.18,-173.15 390.88,-174.45" />
<polygon fill="black" stroke="black" points="391.03,-170.94 381.21,-174.91 391.36,-177.93 391.03,-170.94" />
</g>
<!-- aws_route_table.peter_rt -->
<g id="node5" class="node">
<polygon fill="none" stroke="black" points="356,-144 190.75,-144 190.75,-108 356,-108 356,-144" />
<text text-anchor="middle" x="273.38" y="-120.2" font-family="sans-serif" font-size="14.00">aws_route_table.peter_rt</text>
</g>
<!-- aws_route.peter_defaultroute&#45;&gt;aws_route_table.peter_rt -->
<g id="edge6" class="edge">
<path fill="none" stroke="black" d="M473.16,-153.07C439.27,-148.45 401.16,-143.26 367.44,-138.67" />
<polygon fill="black" stroke="black" points="368.06,-135.22 357.68,-137.34 367.12,-142.16 368.06,-135.22" />
</g>
<!-- aws_route_table.peter_rt&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge7" class="edge">
<path fill="none" stroke="black" d="M190.52,-115.25C174.83,-113.19 158.47,-111.04 142.98,-109.01" />
<polygon fill="black" stroke="black" points="143.74,-105.58 133.37,-107.75 142.83,-112.52 143.74,-105.58" />
</g>
<!-- aws_route_table_association.peter_rtassociation -->
<g id="node6" class="node">
<polygon fill="none" stroke="black" points="723,-117 415.25,-117 415.25,-81 723,-81 723,-117" />
<text text-anchor="middle" x="569.12" y="-93.2" font-family="sans-serif" font-size="14.00">aws_route_table_association.peter_rtassociation</text>
</g>
<!-- aws_route_table_association.peter_rtassociation&#45;&gt;aws_route_table.peter_rt -->
<g id="edge8" class="edge">
<path fill="none" stroke="black" d="M414.8,-113.09C398.72,-114.57 382.75,-116.04 367.66,-117.43" />
<polygon fill="black" stroke="black" points="367.44,-113.93 357.8,-118.33 368.08,-120.9 367.44,-113.93" />
</g>
<!-- aws_route_table_association.peter_rtassociation&#45;&gt;aws_subnet.peter_subnet -->
<g id="edge9" class="edge">
<path fill="none" stroke="black" d="M414.8,-84.91C399.65,-83.51 384.59,-82.13 370.27,-80.81" />
<polygon fill="black" stroke="black" points="370.75,-77.34 360.47,-79.91 370.11,-84.31 370.75,-77.34" />
</g>
<!-- aws_security_group.instance&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge10" class="edge">
<path fill="none" stroke="black" d="M192.43,-36.44C183.92,-39.03 175.47,-41.89 167.5,-45 146.54,-53.18 124.38,-64.7 106.2,-75.01" />
<polygon fill="black" stroke="black" points="104.49,-71.95 97.58,-79.98 107.99,-78.02 104.49,-71.95" />
</g>
<!-- aws_subnet.peter_subnet&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge11" class="edge">
<path fill="none" stroke="black" d="M187.85,-83.1C172.93,-85.06 157.48,-87.09 142.82,-89.01" />
<polygon fill="black" stroke="black" points="142.73,-85.49 133.27,-90.26 143.64,-92.43 142.73,-85.49" />
</g>
<!-- null_resource.echomyeip -->
<g id="node10" class="node">
<polygon fill="none" stroke="black" points="1067.75,-36 901,-36 901,0 1067.75,0 1067.75,-36" />
<text text-anchor="middle" x="984.38" y="-12.2" font-family="sans-serif" font-size="14.00">null_resource.echomyeip</text>
</g>
<!-- null_resource.echomyeip&#45;&gt;aws_eip.myeip -->
<g id="edge12" class="edge">
<path fill="none" stroke="black" d="M900.68,-18C892.59,-18 884.48,-18 876.62,-18" />
<polygon fill="black" stroke="black" points="876.84,-14.5 866.84,-18 876.84,-21.5 876.84,-14.5" />
</g>
</g>
</svg>

<ul>
  <li><code class="language-plaintext highlighter-rouge">null_resource</code>ëŠ” ì •ì˜ëœ ì†ì„±ì´ <code class="language-plaintext highlighter-rouge">id</code>ê°€ ì „ë¶€ì´ë¯€ë¡œ, ì„ ì–¸ëœ ë‚´ë¶€ì˜ êµ¬ì„±ì´ ë³€ê²½ë˜ë”ë¼ë„ ìƒˆë¡œìš´ Plan ê³¼ì •ì—ì„œ ì‹¤í–‰ ê³„íšì— í¬í•¨ë˜ì§€ ëª»í•©ë‹ˆë‹¤.</li>
  <li>ë”°ë¼ì„œ ì‚¬ìš©ìê°€ <code class="language-plaintext highlighter-rouge">null_resourceì—</code> ì •ì˜ëœ ë‚´ìš©ì„ ê°•ì œë¡œ ë‹¤ì‹œ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì¸ìˆ˜ë¡œ <code class="language-plaintext highlighter-rouge">trigger</code>ê°€ ì œê³µë©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">trigger</code>ëŠ” ì„ì˜ì˜ <code class="language-plaintext highlighter-rouge">string</code> í˜•íƒœì˜ <code class="language-plaintext highlighter-rouge">map</code> ë°ì´í„°ë¥¼ ì •ì˜í•˜ëŠ”ë°, ì •ì˜ëœ ê°’ì´ ë³€ê²½ë˜ë©´ <code class="language-plaintext highlighter-rouge">null_resource</code> ë‚´ë¶€ì— ì •ì˜ëœ í–‰ìœ„ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">trigger</code> ì •ì˜ì™€ ë™ì‘ ì˜ˆì œ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"foo"</span> <span class="p">{</span>
  <span class="nx">triggers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">ec2_id</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">bar</span><span class="p">.</span><span class="nx">id</span> <span class="c1"># instanceì˜ idê°€ ë³€ê²½ë˜ëŠ” ê²½ìš° ì¬ì‹¤í–‰</span>
  <span class="p">}</span>
  <span class="p">...</span><span class="err">ìƒëµ</span><span class="p">...</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"bar"</span> <span class="p">{</span>
  <span class="nx">triggers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">ec2_id</span> <span class="p">=</span> <span class="nx">time</span><span class="p">()</span> <span class="c1"># í…Œë¼í¼ìœ¼ë¡œ ì‹¤í–‰ ê³„íšì„ ìƒì„±í•  ë–„ë§ˆë‹¤ ì¬ì‹¤í–‰</span>
  <span class="p">}</span>
  <span class="p">...</span><span class="err">ìƒëµ</span><span class="p">...</span>
<span class="p">}</span>  
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="terraform_data">terraform_data</h4>
<ul>
  <li>í…Œë¼í¼ 1.4 ì´í›„ì—ëŠ” <code class="language-plaintext highlighter-rouge">null_resource</code> ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">terraform_data</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ë¬´ ì‘ì—…ë„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ êµ¬í˜„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
  <li>ì´í›„ì—ëŠ” ê°€ëŠ¥í•œ <code class="language-plaintext highlighter-rouge">null_resource</code> ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">terraform_data</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</li>
  <li>ì´ ë¦¬ì†ŒìŠ¤ ë˜í•œ ìì²´ì ìœ¼ë¡œ ì•„ë¬´ê²ƒë„ ìˆ˜í–‰í•˜ì§€ ì•Šì§€ë§Œ <code class="language-plaintext highlighter-rouge">null_resource</code>ëŠ” <strong>ë³„ë„ì˜ í”„ë¡œë°”ì´ë” êµ¬ì„±ì´ í•„ìš”</strong>í•˜ë‹¤ëŠ” ì ê³¼ ë¹„êµí•˜ì—¬ ì¶”ê°€ í”„ë¡œë°”ì´ë” ì—†ì´ í…Œë¼í¼ ìì²´ì— í¬í•¨ëœ <strong>ê¸°ë³¸ ìˆ˜ëª…ì£¼ê¸° ê´€ë¦¬ì</strong>ê°€ ì œê³µëœë‹¤ëŠ” ê²ƒì´ ì¥ì ì…ë‹ˆë‹¤.</li>
  <li>ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ëŠ” ê¸°ë³¸ null_resourcrì™€ ë™ì¼í•˜ë©° ê°•ì œ ì¬ì‹¤í–‰ì„ ìœ„í•œ <code class="language-plaintext highlighter-rouge">trigger_replace</code>ì™€ ìƒíƒœ ì €ì¥ì„ ìœ„í•œ <code class="language-plaintext highlighter-rouge">input</code> ì¸ìˆ˜ì™€ <code class="language-plaintext highlighter-rouge">input</code>ì— ì €ì¥ëœ ê°’ì„ ì¶œë ¥í•˜ëŠ” <code class="language-plaintext highlighter-rouge">output</code> ì†ì„±ì´ ì œê³µë©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">triggers_replace</code>ì— ì •ì˜ë˜ëŠ” ê°’ì´ ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">map</code> í˜•íƒœì—ì„œ <code class="language-plaintext highlighter-rouge">tuple</code>ë¡œ ë³€ê²½ë˜ì–´ ì“°ì„ì´ ë” ê°„ë‹¨í•´ì¡ŒìŠµë‹ˆë‹¤.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">terraform_data</code> ë¦¬ì†ŒìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">trigger_replace</code> ì •ì˜ì™€ ë™ì‘ ì˜ˆì œ</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="c1"># ...</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"database"</span> <span class="p">{</span>
  <span class="c1"># ...</span>
<span class="p">}</span>
  
<span class="c1"># A use-case for terraform_data is as a do-nothing container</span>
<span class="c1"># for arbitrary actions taken by a provisioner.</span>
<span class="k">resource</span> <span class="s2">"terraform_data"</span> <span class="s2">"bootstrap"</span> <span class="p">{</span>
  <span class="nx">triggers_replace</span> <span class="p">=</span> <span class="p">[</span>
    <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">database</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">]</span>
  
  <span class="k">provisioner</span> <span class="s2">"local-exec"</span> <span class="p">{</span>
    <span class="nx">command</span> <span class="p">=</span> <span class="s2">"bootstrap-hosts.sh"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"terraform_data"</span> <span class="s2">"foo"</span> <span class="p">{</span>
  <span class="nx">triggers_replace</span> <span class="p">=</span> <span class="p">[</span>
    <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">bar</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">]</span>
  
  <span class="nx">input</span> <span class="p">=</span> <span class="s2">"world"</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"terraform_data_output"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">terraform_data</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="k">output</span>  <span class="c1"># ì¶œë ¥ ê²°ê³¼ëŠ” "world"</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="moved-ë¸”ë¡">moved ë¸”ë¡</h3>

<ul>
  <li>í…Œë¼í¼ì€ stateì— ê¸°ë¡ë˜ëŠ” ë¦¬ì†ŒìŠ¤ì˜ ì´ë¦„ì´ ë³€ê²½ë˜ë©´ ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ëŠ” ì‚­ì œë˜ê³ , ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
  <li>í…Œë¼í¼ ë¦¬ì†ŒìŠ¤ë¥¼ ì„ ì–¸í•˜ë‹¤ë³´ë©´ ì´ë¦„ì„ ë³€ê²½í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒë˜ë©° ë‹¤ìŒê³¼ ê°™ì€ ì˜ˆë“¤ì´ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>ë¦¬ì†ŒìŠ¤ ì´ë¦„ ë³€ê²½</li>
      <li><code class="language-plaintext highlighter-rouge">count</code>ë¡œ ì²˜ë¦¬í•˜ë˜ ë°˜ë³µë¬¸ì„ <code class="language-plaintext highlighter-rouge">for_each</code>ë¡œ ë³€ê²½</li>
      <li>ë¦¬ì†ŒìŠ¤ê°€ ëª¨ë“ˆë¡œ ì´ë™í•˜ì—¬ ì°¸ì¡°ë˜ëŠ” ì£¼ì†Œê°€ ë³€ê²½</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">moved</code> ë¸”ë¡ì€ ë¦¬ì†ŒìŠ¤ì˜ ì´ë™ì„ í‘œí˜„í•˜ëŠ” ë¸”ë¡ìœ¼ë¡œ, ì‹¤ì œ ë¦¬ì†ŒìŠ¤ëŠ” ë³€ê²½ì´ ì—†ìœ¼ë©´ì„œ í…Œë¼í¼ì—ì„œ ê´€ë¦¬ë˜ëŠ” ì´ë¦„ë§Œ ë³€ê²½ë˜ëŠ”ê²ƒì„ í…Œë¼í¼ì—ê²Œ ì•Œë ¤ì£¼ê³ 
ë¶ˆí•„ìš”í•œ ë¦¬ì†ŒìŠ¤ì˜ ì¬ìƒì„±ì„ ë°©ì§€í•©ë‹ˆë‹¤.</li>
  <li>ì˜ˆì œ
    <ul>
      <li>main.tf ìƒì„±
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"a"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"foo!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/foo.bar"</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"file_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>ì‹¤í–‰
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span><span class="nb">cat </span>foo.bar
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.a"</span> | terraform console
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.a.id"</span> | terraform console
<span class="c"># =&gt; "4bf3e335199107182c6f7638efaad377acc7f452"</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>main.tfì˜ local_fileì˜ ì´ë¦„ì„ a =&gt; b ë¡œ ë³€ê²½
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"b"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"foo!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/foo.bar"</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"file_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">b</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>plan í™•ì¸ì‹œ ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ aë¥¼ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤ bë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform plan
<span class="c"># =&gt; ...</span>
<span class="c">#      # local_file.a will be destroyed</span>
<span class="c">#    ...</span>
<span class="c">#      # local_file.b will be created</span>
<span class="c">#    ...</span>
<span class="c">#    Plan: 1 to add, 0 to change, 1 to destroy.</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">moved</code> ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ì˜ ì´ë¦„ ë³€ê²½ì„ í‘œí˜„
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"b"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"foo!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/foo.bar"</span>
<span class="p">}</span>

<span class="nx">moved</span> <span class="p">{</span>
  <span class="nx">from</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">a</span>
  <span class="nx">to</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">b</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"file_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">b</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>plan ê³¼ applyì‹œ ì œê±°ë‚˜ ìƒì„±ì´ ì—†ê³  <code class="language-plaintext highlighter-rouge">id</code>ë„ <code class="language-plaintext highlighter-rouge">local_file.a</code> ì¼ë•Œì™€ ë™ì¼í•©ë‹ˆë‹¤.
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform plan
<span class="c"># =&gt; ... </span>
     Plan: 0 to add, 0 to change, 0 to destroy.
      
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.b.id"</span> | terraform console 
<span class="c"># =&gt; "4bf3e335199107182c6f7638efaad377acc7f452"</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">local_file.a</code>ì¼ë•Œì™€ <code class="language-plaintext highlighter-rouge">local_file.b</code>ì¼ë•Œì˜ <code class="language-plaintext highlighter-rouge">terraform.tfstate</code> íŒŒì¼ì„ ë¹„êµí•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff terraform.tfstate.a terraform.tfstate 
</code></pre></div>        </div>

        <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">4c4
</span><span class="gd">&lt;   "serial": 1,
</span><span class="p">---
</span><span class="gi">&gt;   "serial": 2,
</span><span class="p">16c16
</span><span class="gd">&lt;       "name": "a",
</span><span class="p">---
</span><span class="gi">&gt;       "name": "b",    
</span></code></pre></div>        </div>
        <p><code class="language-plaintext highlighter-rouge">name</code>ë§Œ <code class="language-plaintext highlighter-rouge">a</code>ì—ì„œ <code class="language-plaintext highlighter-rouge">b</code>ë¡œ ë³€ê²½ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </li>
      <li>ë§ˆì§€ë§‰ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">moved</code> ë¸”ë¡ì´ ì ìš©ë˜ë©´, <code class="language-plaintext highlighter-rouge">moved</code> ë¸”ë¡ì€ ë”ì´ìƒ í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì‚­ì œí•´ì„œ ë¦¬íŒ©í† ë§ì„ ì™„ë£Œí•©ë‹ˆë‹¤.
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf  </span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"b"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"foo!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/foo.bar"</span>
<span class="p">}</span>

<span class="c1"># moved {</span>
<span class="c1">#   from = local_file.a</span>
<span class="c1">#   to = local_file.b</span>
<span class="c1"># }</span>
    
<span class="k">output</span> <span class="s2">"file_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">b</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h2 id="clië¥¼-ìœ„í•œ-ì‹œìŠ¤í…œ-í™˜ê²½-ë³€ìˆ˜">CLIë¥¼ ìœ„í•œ ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜</h2>
<ul>
  <li>í…Œë¼í¼ì€ ë‹¤ì–‘í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë¡œì»¬ ì‘ì—…í™˜ê²½ ë³„ í™˜ê²½ë³€ìˆ˜ ì§€ì • ë°©ë²•
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mac/ë¦¬ëˆ…ìŠ¤/ìœ ë‹‰ìŠ¤: <span class="nb">export</span> &lt;í™˜ê²½ ë³€ìˆ˜ ì´ë¦„&gt;<span class="o">=</span>&lt;ê°’&gt;
Windows CMD: <span class="nb">set</span> &lt;í™˜ê²½ ë³€ìˆ˜ ì´ë¦„&gt;<span class="o">=</span>&lt;ê°’&gt;
Windows PowerShell: <span class="nv">$Env</span>:&lt;í™˜ê²½ ë³€ìˆ˜ ì´ë¦„&gt;<span class="o">=</span><span class="s1">'&lt;ê°’&gt;'</span>
</code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">TF_LOG</code> : í…Œë¼í¼ì˜ stderr ë¡œê·¸ì— ëŒ€í•œ ë ˆë²¨ì„ ì •ì˜ í•©ë‹ˆë‹¤.
    <ul>
      <li>trace, debug, info, warn, error, offë¥¼ ì„¤ì •í•  ìˆ˜ ìˆê³  ê´€ë ¨ í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ëŠ” ê²½ìš° offì™€ ë™ì¼í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">TF_LOG</code>ë¥¼ infoë¡œ ì„¤ì •í•˜ê³  <code class="language-plaintext highlighter-rouge">terraform plan</code> ë™ì‘ì„ í•˜ë©´ í…Œë¼í¼ ì¶œë ¥ì— ê´€ë ¨ ë¡œê·¸ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">TF_LOG</span><span class="o">=</span>info
<span class="nv">$ </span>terraform plan
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">TF_LOG_PATH</code> : ë¡œê·¸ ì¶œë ¥ íŒŒì¼ ìœ„ì¹˜ ì§€ì •í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">TF_LOG_CORE</code> : TF_LOGì™€ ë³„ë„ë¡œ í…Œë¼í¼ ìì²´ ì½”ì–´ì— ëŒ€í•œ ë¡œê¹… ë ˆë²¨ ì§€ì • ë˜ëŠ” í•´ì œí•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">TF_LOG_PROVIDER</code> : TF_LOGì™€ ë³„ë„ë¡œ í…Œë¼í¼ì—ì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡œë°”ì´ë”ì— ëŒ€í•œ ë¡œê¹… ë ˆë²¨ ì§€ì • ë˜ëŠ” í•´ì œí•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">TF_INPUT</code> : ê°’ì„ false ë˜ëŠ” 0ìœ¼ë¡œ ì„¤ì •í•˜ë©´ í…Œë¼í¼ ì‹¤í–‰ ì‹œ ì¸ìˆ˜ì— -input=false ë¥¼ ì¶”ê°€í•œ ê²ƒê³¼ ë™ì¼í•œ ìˆ˜í–‰ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>ë‹¨, <code class="language-plaintext highlighter-rouge">TF_INPUT=0</code>ìœ¼ë¡œ í•˜ê³  <code class="language-plaintext highlighter-rouge">terraform plan</code>ì„ ì‹¤í–‰í–ˆì„ë•Œ ì…ë ¥ë³€ìˆ˜ë¥¼ ë°˜ë“œì‹œ ì…ë ¥ ë°›ì•„ì•¼ í•˜ëŠ” ê²½ìš° ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ TF_INPUT</span><span class="o">=</span>0  terraform plan
<span class="c"># =&gt; Error: No value for required variable</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">TF_VAR_name</code> : <code class="language-plaintext highlighter-rouge">TF_VAR_&lt;ë³€ìˆ˜ì´ë¦„&gt;</code>ì„ ì‚¬ìš©í•˜ë©´ ì…ë ¥ì‹œ ë˜ëŠ” <code class="language-plaintext highlighter-rouge">default</code>ë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ê°’ì„ ëŒ€ì²´í•©ë‹ˆë‹¤. (2ì£¼ì°¨ â€œë³€ìˆ˜ ì…ë ¥ ë°©ì‹ê³¼ ìš°ì„  ìˆœìœ„â€ ë¶€ë¶„ ì°¸ê³ )</li>
  <li><code class="language-plaintext highlighter-rouge">TF_CLI_ARGS</code> / <code class="language-plaintext highlighter-rouge">TF_CLI_ARGS_subcommand</code> : í…Œë¼í¼ ì‹¤í–‰ ì‹œ ì¶”ê°€í•  ì¸ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># TF_CLI_ARGS="-input=false" terraform apply -auto-approve ëŠ” terraform apply -input=false -auto-approve ì™€ ê°™ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ TF_CLI_ARGS</span><span class="o">=</span><span class="s2">"-input=false"</span> terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Error: No value for required variable</span>
  
<span class="c"># TF_CLI_ARGS_applyë¡œ ì¸ìˆ˜ë¥¼ ì •ì˜í•˜ë©´ terraform apply ì»¤ë§¨ë“œ ìˆ˜í–‰ ì‹œì—ë§Œ ë™ì‘í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">TF_CLI_ARGS_apply</span><span class="o">=</span><span class="s2">"-input=false"</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; &lt;ì—ëŸ¬&gt;</span>
  
<span class="nv">$ </span>terraform plan
<span class="c"># =&gt; &lt;ì •ìƒ ê³„íš ì˜ˆì¸¡ ì¶œë ¥&gt; </span>
</code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">TF_DATA_DIR</code> : <code class="language-plaintext highlighter-rouge">State</code> ì €ì¥ ë°±ì—”ë“œ ì„¤ì •ê³¼ ê°™ì€ ì‘ì—… ë””ë ‰í„°ë¦¬ë³„ ë°ì´í„°ë¥¼ ë³´ê´€í•˜ëŠ” ìœ„ì¹˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
    <ul>
      <li>ì´ ë°ì´í„°ëŠ” <code class="language-plaintext highlighter-rouge">.terraform</code> ë””ë ‰í„°ë¦¬ ìœ„ì¹˜ì— ê¸°ë¡ë˜ì§€ë§Œ <code class="language-plaintext highlighter-rouge">TF_DATA_DIR</code>ì— ê²½ë¡œê°€ ì •ì˜ë˜ë©´ ê¸°ë³¸ ê²½ë¡œë¥¼ ëŒ€ì²´í•˜ì—¬ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
      <li>ì¼ê´€ëœ í…Œë¼í¼ ì‚¬ìš©ì„ ìœ„í•´ì„œ í•´ë‹¹ ë³€ìˆ˜ëŠ” ì‹¤í–‰ ì‹œë§ˆë‹¤ ì¼ê´€ë˜ê²Œ ì ìš©ë  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</li>
      <li>ì„¤ì • ê°’ì´ ì´ì „ ì‹¤í–‰ ì‹œì—ë§Œ ì ìš©ë˜ëŠ” ê²½ìš° init ëª…ë ¹ìœ¼ë¡œ ìˆ˜í–‰ëœ ëª¨ë“ˆ, ì•„í‹°íŒ©íŠ¸ ë“±ì˜ íŒŒì¼ì„ ì°¾ì§€ ëª»í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>
<p>ì§€ê¸ˆê¹Œì§€ 3ì£¼ê°„ì— ê±¸ì²˜ í…Œë¼í¼ HCLì˜ ê¸°ë³¸ ë¬¸ë²•ê³¼ ê¸°ëŠ¥ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
ë‚´ìš©ë„ ë§ê³  ì‹¤ìŠµí•´ë³¼ê²ƒë„ ë§ê³ , ë¸”ë¡œê·¸ë„ ì¨ì•¼í•˜ê³  ë‹¤ì†Œ í˜ë“¤ì—ˆì§€ë§Œ :cry:, ë‹¤ìŒ ì£¼ì°¨ ìˆ˜ì—…ë¶€í„° ì‹¤ì œ ì‘ìš©ì„ ë°°ìš¸ ìƒê°ì„ í•˜ë‹ˆ ë‘ê·¼ ê±°ë¦½ë‹ˆë‹¤.</p>

<p>ì´ë²ˆ ì£¼ë„ ê³¼ì œê°€ ë¬´ì‚¬íˆ í†µê³¼ë˜ê¸¸ ê¸°ë„:pray:í•˜ë©° ì´ë²ˆ ë¸”ë¡œê·¸ë¥¼ ë§ˆì¹©ë‹ˆë‹¤.</p>]]></content><author><name></name></author><category term="terraform" /><category term="terraform," /><category term="cloud," /><category term="aws" /><summary type="html"><![CDATA[í…Œë¼í¼ ê¸°ì´ˆ ì…ë¬¸ ì‹¤ìŠµ ìŠ¤í„°ë”” 3ì£¼ì°¨ì´ê³ , ê¸°ë³¸ ì‚¬ìš©ë²• ë§ˆì§€ë§‰ ì£¼ì°¨ì…ë‹ˆë‹¤. ì´ë²ˆ ì£¼ì—ë„ í•™ìŠµí•´ì•¼ í•˜ëŠ” ë‚´ìš©ì´ ë§ì•„ì„œ ë¶€ì§€ëŸ°íˆ ë‹¬ë ¤ë³´ê² ìŠµë‹ˆë‹¤. "í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" ì±…ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[T101 4ê¸°] í…Œë¼í¼ ê¸°ë³¸ ì‚¬ìš©ë²• 2/3</title><link href="https://sweetlittlebird.github.io/posts/2024-06-23-T101-Study-Terraform-Week-2/" rel="alternate" type="text/html" title="[T101 4ê¸°] í…Œë¼í¼ ê¸°ë³¸ ì‚¬ìš©ë²• 2/3" /><published>2024-06-23T00:52:00+09:00</published><updated>2024-06-23T00:52:00+09:00</updated><id>https://sweetlittlebird.github.io/posts/T101%20Study%20-%20Terraform%20Week%202</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-06-23-T101-Study-Terraform-Week-2/"><![CDATA[<ul id="toc" class="section-nav">
</ul>

<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>í…Œë¼í¼ ê¸°ì´ˆ ì…ë¬¸ ì‹¤ìŠµ ìŠ¤í„°ë”” 2ì£¼ì°¨ ì…ë‹ˆë‹¤.
1ì£¼ì°¨ì— ì´ì–´ í…Œë¼í¼ì˜ ê¸°ë³¸ ì‚¬ìš©ë²•ì— ëŒ€í•´ ì‹¤ìŠµí•´ë³´ë ¤ í•©ë‹ˆë‹¤.
ì´ë²ˆ ì£¼ì—ë„ â€œí…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaCâ€ ì±…ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" /></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a></p>
</blockquote>

<h2 id="hcl-ê³„ì†">HCL (ê³„ì†)</h2>

<p>ì§€ë‚œì£¼ì— ì´ì–´ì„œ HCL(HashiCorp Configuration Language) ì˜ ë¬¸ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h3 id="í…Œë¼í¼-ë¸”ë¡">í…Œë¼í¼ ë¸”ë¡</h3>

<h4 id="data-ë¸”ë¡">data ë¸”ë¡</h4>

<ul>
  <li>ë°ì´í„° ì†ŒìŠ¤ëŠ” í…Œë¼í¼ìœ¼ë¡œ ì •ì˜ë˜ì§€ ì•Šì€ ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ì™€ ì €ì¥ëœ ì •ë³´ë¥¼ ì°¸ì¡°í• ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">data</code> ë¸”ë¡ ì„ ì–¸ ë°©ë²•</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">data</span> <span class="s2">"&lt;í”„ë¡œë°”ì´ë”ì´ë¦„_ë¦¬ì†ŒìŠ¤ìœ í˜•&gt;"</span> <span class="s2">"&lt;ì´ë¦„&gt;"</span> <span class="p">{</span>
      <span class="err">&lt;ì¸ìˆ˜&gt;</span> <span class="p">=</span> <span class="err">&lt;ê°’&gt;</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <p>ì´ë•Œ ì¸ìˆ˜ëŠ” ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì°¸ì¡°í• ë•Œ ì‚¬ìš©í•  ì¸ìˆ˜ì´ë©° ì•„ë˜ì˜ â€œë°ì´í„° ì†ŒìŠ¤ ì°¸ì¡° ë°©ë²•â€ì—ì„œì˜ ì†ì„±ê³¼ëŠ” ë‹¤ë¥¸ ê°’ì…ë‹ˆë‹¤.
  ì´ ì¸ìˆ˜ë¡œ ì°¸ì¡°ëœ ë°ì´í„°ì˜ ì†ì„± ê°’ì„ ì•„ë˜ì˜ ë°©ë²•ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ë°ì´í„° ì†ŒìŠ¤ ì°¸ì¡° ë°©ë²•</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># ë°ì´í„° ì†ŒìŠ¤ ì°¸ì¡°</span>
  <span class="k">data</span><span class="err">.&lt;í”„ë¡œë°”ì´ë”ì´ë¦„</span><span class="nx">_</span><span class="err">ë¦¬ì†ŒìŠ¤ìœ í˜•&gt;.&lt;ì´ë¦„&gt;.&lt;ì†ì„±&gt;</span>  
</code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">data</code> ë¸”ë¡ ì‚¬ìš© ì˜ˆì‹œ
    <ol>
      <li>í˜„ì¬ regionì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•œ availability zone ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸°
        <ul>
          <li>main.tf</li>
        </ul>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># main.tf</span>
 <span class="k">data</span> <span class="s2">"aws_availability_zones"</span> <span class="s2">"available_zones"</span> <span class="p">{</span>
     <span class="nx">state</span> <span class="p">=</span> <span class="s2">"available"</span>   <span class="c1"># í˜„ì¬ regionì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•œ availability zone ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸°</span>
 <span class="p">}</span>
</code></pre></div>        </div>

        <ul>
          <li>ì‹¤í–‰ ê²°ê³¼ í™•ì¸</li>
        </ul>

        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c"># main.tf ì ìš©</span>
 <span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
      
 <span class="c"># state í™•ì¸</span>
 <span class="nv">$ </span>terraform state list      
 <span class="c"># =&gt; data.aws_availability_zones.available_zones</span>
      
 <span class="c"># í…Œë¼í¼ ì½˜ì†”ì—ì„œ í™•ì¸</span>
 <span class="nv">$ </span>terraform console
 <span class="o">&gt;</span> <span class="c"># &lt;í™•ì¸í•˜ê³  ì‹¶ì€ ì†ì„±&gt; </span>
 <span class="o">&gt;</span> data.aws_availability_zones.available_zones       <span class="c"># =&gt; ...</span>
 <span class="o">&gt;</span> data.aws_availability_zones.available_zones.id    <span class="c"># =&gt; "ap-northeast-2"</span>
 <span class="o">&gt;</span> data.aws_availability_zones.available_zones.names <span class="c"># =&gt; AZ ì´ë¦„ ëª©ë¡...</span>
 <span class="o">&gt;</span> data.aws_availability_zones.available_zones.zone_ids <span class="c"># =&gt; AZ ID ëª©ë¡...</span>
      
 <span class="c"># tip. echo &lt;í™•ì¸í•˜ê³  ì‹¶ì€ ì†ì„±&gt; || terraform console ë¡œ ê°’ í™•ì¸</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.aws_availability_zones.available_zones"</span> | terraform console     <span class="c"># =&gt; ...</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.aws_availability_zones.available_zones.id"</span> | terraform console   <span class="c"># =&gt; "ap-northeast-2"</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.aws_availability_zones.available_zones.names"</span> | terraform console <span class="c"># =&gt; AZ ì´ë¦„ ëª©ë¡...</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.aws_availability_zones.available_zones.zone_ids"</span> | terraform console <span class="c"># =&gt; AZ ID ëª©ë¡...</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.aws_availability_zones.available_zones.zone_ids[0]"</span> | terraform console <span class="c"># =&gt; "apne2-az1"</span>
</code></pre></div>        </div>
      </li>
      <li>ë¡œì»¬ íŒŒì¼ì˜ ë‚´ìš© ì½ê¸°
        <ul>
          <li>main.tf</li>
        </ul>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># main.tf</span>
 <span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
     <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"Hello world!!"</span>
     <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
 <span class="p">}</span>
        
 <span class="k">data</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
     <span class="nx">filename</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span><span class="p">.</span><span class="nx">filename</span>
 <span class="p">}</span>
        
 <span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
     <span class="nx">content</span>  <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span><span class="p">.</span><span class="nx">content</span>
     <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/def.txt"</span>
 <span class="p">}</span>
</code></pre></div>        </div>

        <ul>
          <li>
            <p>ì‹¤í–‰ ê²°ê³¼ í™•ì¸</p>

            <svg width="389pt" height="44pt" viewBox="0.00 0.00 389.00 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
              <polygon fill="white" stroke="none" points="-4,4 -4,-40 385,-40 385,4 -4,4" />
  <!-- data.local_file.abc -->
  <g id="node1" class="node">
              <polygon fill="none" stroke="black" points="254,-36 130,-36 130,0 254,0 254,-36" />
  <text text-anchor="middle" x="192" y="-12.2" font-family="sans-serif" font-size="14.00">data.local_file.abc</text>
  </g>
  <!-- local_file.abc -->
  <g id="node2" class="node">
              <polygon fill="none" stroke="black" points="94,-36 0,-36 0,0 94,0 94,-36" />
  <text text-anchor="middle" x="47" y="-12.2" font-family="sans-serif" font-size="14.00">local_file.abc</text>
  </g>
  <!-- data.local_file.abc&#45;&gt;local_file.abc -->
  <g id="edge1" class="edge">
              <path fill="none" stroke="black" d="M129.53,-18C121.59,-18 113.49,-18 105.62,-18" />
  <polygon fill="black" stroke="black" points="105.82,-14.5 95.82,-18 105.82,-21.5 105.82,-14.5" />
  </g>
  <!-- local_file.def -->
  <g id="node3" class="node">
              <polygon fill="none" stroke="black" points="381,-36 290,-36 290,0 381,0 381,-36" />
  <text text-anchor="middle" x="335.5" y="-12.2" font-family="sans-serif" font-size="14.00">local_file.def</text>
  </g>
  <!-- local_file.def&#45;&gt;data.local_file.abc -->
  <g id="edge2" class="edge">
              <path fill="none" stroke="black" d="M289.73,-18C282.08,-18 273.96,-18 265.8,-18" />
  <polygon fill="black" stroke="black" points="265.81,-14.5 255.81,-18 265.81,-21.5 265.81,-14.5" />
  </g>
  </g>
  </svg>
          </li>
        </ul>

        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c"># main.tf ì ìš©</span>
 <span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
        
 <span class="c"># state í™•ì¸</span>
 <span class="nv">$ </span>terraform state list      
 <span class="c"># =&gt; data.local_file.abc</span>
 <span class="c">#    local_file.abc</span>
 <span class="c">#    local_file.def</span>
        
 <span class="c"># graph í™•ì¸</span>
 <span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
       
 <span class="c"># ë°ì´í„° ì†ŒìŠ¤ ì°¸ì¡° í™•ì¸</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"data.local_file.abc.content"</span> | terraform console
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ul>

<h4 id="variable-ë¸”ë¡">variable ë¸”ë¡</h4>

<ul>
  <li>ë³€ìˆ˜(variable)ë¸”ë¡ì€ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•˜ëŠ”ë° í•„ìš”í•œ ì†ì„± ê°’ì„ ì •ì˜í•´ ì½”ë“œì˜ ë³€ê²½ ì—†ì´ ì—¬ëŸ¬ ì¸í”„ë¼ë¥¼ ìƒì„±í•˜ëŠ”ë° ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>í…Œë¼í¼ì—ì„œì˜ variable ë¸”ë¡ì„ ì…ë ¥ ë³€ìˆ˜, ì¦‰ input variableë¼ í•©ë‹ˆë‹¤.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">variable</code> ë¸”ë¡ ì„ ì–¸ ë°©ë²•</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">variable</span> <span class="s2">"&lt;ì´ë¦„&gt;"</span> <span class="p">{</span>
      <span class="err">&lt;ì¸ìˆ˜&gt;</span> <span class="p">=</span> <span class="err">&lt;ê°’&gt;</span>
      <span class="err">&lt;ë©”íƒ€ë³€ìˆ˜&gt;</span> <span class="p">=</span> <span class="err">&lt;ë©”íƒ€ë³€ìˆ˜</span> <span class="err">ê°’&gt;</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">source</code>, <code class="language-plaintext highlighter-rouge">version</code>, <code class="language-plaintext highlighter-rouge">providers</code> ë“±ì˜ ì˜ˆì•½ì–´ëŠ” ë³€ìˆ˜ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
    <p>ë³€ìˆ˜ ì°¸ì¡° ë°©ë²•</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># ë³€ìˆ˜ ì°¸ì¡°</span>
  <span class="kd">var</span><span class="err">.&lt;ì´ë¦„&gt;</span>
  
  <span class="c1"># ë°°ì—´ì¸ ê²½ìš° [&lt;ì¸ë±ìŠ¤&gt;] ë¡œ ì°¸ì¡°</span>
  <span class="kd">var</span><span class="err">.&lt;ì´ë¦„&gt;</span><span class="p">[</span><span class="err">&lt;ì¸ë±ìŠ¤&gt;</span><span class="p">]</span>
  
  <span class="c1"># ë°°ì—´ì˜ 10ë²ˆì§¸ í•­ëª© ì°¸ì¡° ì˜ˆì‹œ</span>
  <span class="kd">var</span><span class="err">.&lt;ì´ë¦„&gt;</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>  
</code></pre></div>    </div>
  </li>
</ul>

<h5 id="variable-ë¸”ë¡ì—ì„œ-ì‚¬ìš©-ê°€ëŠ¥í•œ-ë©”íƒ€ë³€ìˆ˜">variable ë¸”ë¡ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ë©”íƒ€ë³€ìˆ˜</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">variable</code> ë¸”ë¡ì—ì„œëŠ” ë‹¤ìŒì˜ ë©”íƒ€ë³€ìˆ˜ë¥¼ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>ë©”íƒ€ë³€ìˆ˜</th>
      <th>ì„¤ëª…</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>default</td>
      <td>ê¸°ë³¸ê°’ì„ ì§€ì •í•©ë‹ˆë‹¤. ê¸°ë³¸ê°’ë„ ì—†ê³ , ë‹¤ë¥¸ ë°©ë²•ë“¤ë¡œ ì§€ì •ë˜ì§€ ì•Šìœ¼ë©´ ëŒ€í™”ì‹ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ë¬»ìŠµë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>type</td>
      <td>ë³€ìˆ˜ ìœ í˜•ì„ ì§€ì •í•©ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>description</td>
      <td>ì…ë ¥ë³€ìˆ˜ì˜ ì„¤ëª…ì„ ê¸°ì…í•©ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>validation</td>
      <td>ë³€ìˆ˜ì˜ ì œì•½ ì¡°ê±´ì„ ë¶€ì—¬í•˜ê³  ìœ íš¨ì„± ê²€ì‚¬ ê·œì¹™ì„ ì •ì˜í•©ë‹ˆë‹¤. <a href="https://honglab.tistory.com/217">ì°¸ê³ </a></td>
    </tr>
    <tr>
      <td>sensitive</td>
      <td>ë¹„ë°€ë²ˆí˜¸ ë“±ì˜ ë¯¼ê°í•œ ë³€ìˆ˜ì„ì„ í‘œì‹œí•˜ê³  ì¶œë ¥ë¬¸ì—ì„œ ê°’ ë…¸ì¶œì„ ì œí•œí•©ë‹ˆë‹¤. <a href="https://daaa0555.tistory.com/371">ì°¸ê³ </a></td>
    </tr>
    <tr>
      <td>nullable</td>
      <td>ë³€ìˆ˜ì— ê°’ì´ ì—†ì–´ë„ ë¨ì„ ì§€ì •í•©ë‹ˆë‹¤.</td>
    </tr>
  </tbody>
</table>

<h5 id="ì…ë ¥-ë³€ìˆ˜-ìœ í˜•">ì…ë ¥ ë³€ìˆ˜ ìœ í˜•</h5>

<table>
  <thead>
    <tr>
      <th>ìœ í˜•</th>
      <th>ì„¤ëª…</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>string</td>
      <td>ë¬¸ìì—´ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>number</td>
      <td>ìˆ«ìë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>bool</td>
      <td>true, falseì˜ ë¶ˆë¦¬ì–¸ ê°’ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>list(<ìœ í˜•>)</ìœ í˜•></td>
      <td>ë¦¬ìŠ¤íŠ¸ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>map(<ìœ í˜•>)</ìœ í˜•></td>
      <td>ë§µì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>set(<ìœ í˜•>)</ìœ í˜•></td>
      <td>ì§‘í•©ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>object({<ì¸ìˆ˜ ì´ë¦„="">=<ìœ í˜•>, ...})</ìœ í˜•></ì¸ìˆ˜></td>
      <td>ê°ì²´ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td>tuple([<ìœ í˜•>, ...])</ìœ í˜•></td>
      <td>íŠœí”Œì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>ì…ë ¥ ë³€ìˆ˜ ì‚¬ìš© ì˜ˆì‹œ
    <ol>
      <li><code class="language-plaintext highlighter-rouge">number</code> ë³€ìˆ˜ ì˜ˆì‹œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">variable</span> <span class="s2">"number"</span> <span class="p">{</span>
   <span class="nx">type</span>    <span class="p">=</span> <span class="nx">number</span>
   <span class="nx">default</span> <span class="p">=</span> <span class="mi">10</span>
  <span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">list</code> ë³€ìˆ˜ ì˜ˆì‹œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">variable</span> <span class="s2">"list"</span> <span class="p">{</span>
   <span class="nx">type</span>    <span class="p">=</span> <span class="nx">list</span>
   <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
  <span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">list</code>ì˜ ê°’ìœ¼ë¡œ numberë¡œ ë°›ëŠ” ì¡°ê±´ ê²°í•© ì˜ˆì‹œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">variable</span> <span class="s2">"list"</span> <span class="p">{</span>
   <span class="nx">type</span>        <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">number</span><span class="p">)</span>
   <span class="nx">default</span>     <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
   <span class="c1"># default = [1, "two", 3] ê³¼ ê°™ì´ ì§€ì •ëœ number íƒ€ì…ì´ ì•„ë‹Œ ê²½ìš° ì˜¤ë¥˜ ë°œìƒ       </span>
  <span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>ëª¨ë“  ê°’ì´ string ì¸ map ì˜ˆì‹œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">variable</span> <span class="s2">"map"</span> <span class="p">{</span>
   <span class="nx">type</span>    <span class="p">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
   <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
       <span class="nx">key1</span> <span class="p">=</span> <span class="s2">"value1"</span>
       <span class="nx">key2</span> <span class="p">=</span> <span class="s2">"value2"</span>
   <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">object</code> ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³µì¡í•œ êµ¬ì¡°ì  ìœ í˜• (structural type) ì‘ì„± ì˜ˆì‹œ
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">variable</span> <span class="s2">"object_example"</span> <span class="p">{</span>
   <span class="nx">type</span> <span class="p">=</span> <span class="nx">object</span><span class="p">({</span>
       <span class="nx">name</span>    <span class="p">=</span> <span class="nx">string</span>
       <span class="nx">age</span>     <span class="p">=</span> <span class="nx">number</span>
       <span class="nx">tags</span>    <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
       <span class="nx">enabled</span> <span class="p">=</span> <span class="nx">bool</span>
   <span class="p">})</span>
        
   <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
       <span class="nx">name</span>    <span class="p">=</span> <span class="s2">"value1"</span>
       <span class="nx">age</span>     <span class="p">=</span> <span class="mi">42</span>
       <span class="nx">tags</span>    <span class="p">=</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">]</span>
       <span class="nx">enabled</span> <span class="p">=</span> <span class="kc">true</span>
   <span class="p">}</span>
  <span class="p">}</span> 
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ul>

<h5 id="ìœ íš¨ì„±-ê²€ì‚¬">ìœ íš¨ì„± ê²€ì‚¬</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">variable</code> ì„ ì–¸ì‹œ ë³€ìˆ˜ íƒ€ì… ì´ì™¸ì—ë„ ì‚¬ìš©ì ì§€ì • ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>
    <p>ìœ íš¨ì„± ê²€ì‚¬ ì‘ì„± ë°©ë²•</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">variable</span> <span class="s2">"image_id"</span> <span class="p">{</span>
    <span class="nx">type</span>        <span class="p">=</span> <span class="nx">string</span>
    <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The id of the machine image (AMI) to use for the server."</span>
    
    <span class="nx">validation</span> <span class="p">{</span>
      <span class="nx">condition</span>     <span class="p">=</span> <span class="nx">length</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">image_id</span><span class="p">)</span> <span class="err">&gt;</span> <span class="mi">4</span>    <span class="c1"># true ë˜ëŠ” falseë¥¼ ë°˜í™˜í•˜ëŠ” ê·œì¹™ </span>
      <span class="nx">error_message</span> <span class="p">=</span> <span class="s2">"The image_id value must exceed 4."</span> <span class="c1"># falseì¼ ë•Œ ì¶œë ¥í•  ì˜¤ë¥˜ ë©”ì‹œì§€</span>
    <span class="p">}</span>
    
    <span class="nx">validation</span> <span class="p">{</span>
      <span class="nx">condition</span>     <span class="p">=</span> <span class="nx">can</span><span class="p">(</span><span class="nx">regex</span><span class="p">(</span><span class="s2">"^ami-"</span><span class="p">,</span> <span class="kd">var</span><span class="p">.</span><span class="nx">image_id</span><span class="p">))</span>  <span class="c1"># ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•œ ì˜ˆì‹œ</span>
      <span class="nx">error_message</span> <span class="p">=</span> <span class="s2">"The image_id value must starting with </span><span class="se">\"</span><span class="s2">ami-</span><span class="se">\"</span><span class="s2">."</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">variable</code> ë¸”ë¡ ë‚´ë¶€ì— <code class="language-plaintext highlighter-rouge">validation</code> ë¸”ë¡ì„ ë„£ê³ , ê·¸ ì•ˆì— <code class="language-plaintext highlighter-rouge">condition</code>ê³¼ <code class="language-plaintext highlighter-rouge">error_message</code>ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">condition</code> : ìœ íš¨ì„± ê²€ì‚¬ ì¡°ê±´ì„ ì§€ì •í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">error_message</code> : ì¡°ê±´ì´ ë§Œì¡±í•˜ì§€ ì•Šì„ ë•Œ ì¶œë ¥í•  ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.</li>
      <li>í™•ì¸
        <ul>
          <li>ì•„ë˜ì™€ ê°™ì´ ì¡°ê±´ì— ë§ì§€ ì•ŠëŠ” ami ì…ë ¥ì‹œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ë§Œì¡±í•˜ì§€ ëª»í•˜ì—¬ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>terraform plan
  <span class="c"># =&gt; var.image_id</span>
  <span class="c">#      The id of the machine image (AMI) to use for the server.</span>
  <span class="c">#    </span>
  <span class="c">#      Enter a value: ami</span>
  <span class="c">#    ...</span>
  <span class="c">#    </span>
  <span class="c">#    The image_id value must exceed 4.</span>
  <span class="c">#    </span>
  <span class="c">#    This was checked by the validation rule at main.tf:5,7-17.</span>
  <span class="c">#</span>
  <span class="c">#    ...    </span>
  <span class="c">#    </span>
  <span class="c">#    The image_id value must starting with "ami-".</span>
  <span class="c">#    </span>
  <span class="c">#    This was checked by the validation rule at main.tf:10,7-17.</span>
</code></pre></div>            </div>
          </li>
          <li>ìœ íš¨ì„± ê²€ì‚¬ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ami-1234 ì…ë ¥ì‹œ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>terraform plan
  <span class="c"># =&gt; var.image_id</span>
  <span class="c">#    The id of the machine image (AMI) to use for the server.</span>
  <span class="c">#    </span>
  <span class="c">#    Enter a value: ami-1234</span>
  <span class="c">#    </span>
  <span class="c">#    local_file.abc: Refreshing state... [id=3ee66cf7a43f216ff7060c2bd85758424f7f18b3]</span>
  <span class="c">#    </span>
  <span class="c">#    No changes. Your infrastructure matches the configuration.</span>
  <span class="c">#    </span>
  <span class="c">#    Terraform has compared your real infrastructure against your configuration and found no differences, so no changes are needed.        </span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="sensitive-ë©”íƒ€ë³€ìˆ˜ë¥¼-ì‚¬ìš©í•œ-ë¯¼ê°í•œ-ë³€ìˆ˜ê°’-ì²˜ë¦¬">sensitive ë©”íƒ€ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•œ ë¯¼ê°í•œ ë³€ìˆ˜ê°’ ì²˜ë¦¬</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sensitive = true</code>ë¥¼ <code class="language-plaintext highlighter-rouge">variable</code> ë¸”ë¡ì— ë„£ì–´ì„œ í•´ë‹¹ ë³€ìˆ˜ê°€ ë¯¼ê°í•œ ê°’ì„ ê°–ê³  ìˆìŒì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>
    <p>ë¯¼ê°í•œ ë³€ìˆ˜ê°’ì€ ì¶œë ¥ë¬¸ì—ì„œ ë…¸ì¶œë˜ì§€ ì•Šê³  <code class="language-plaintext highlighter-rouge">(sensitive value)</code> ë¼ëŠ” ë‚´ìš©ìœ¼ë¡œ ê°ì¶°ì§‘ë‹ˆë‹¤.</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># main.tf</span>
  <span class="k">variable</span> <span class="s2">"my_password"</span> <span class="p">{</span>
      <span class="nx">default</span> <span class="p">=</span> <span class="s2">"supersecret"</span>
      <span class="nx">sensitive</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span> 
    
  <span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
    <span class="nx">content</span>  <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">my_password</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>í™•ì¸
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># 1. terraform apply ì‹¤í–‰ì‹œ my_password ë³€ìˆ˜ê°’ì´ ë¯¼ê°í•œ ê°’ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ ì¶œë ¥ë©ë‹ˆë‹¤.</span>
  <span class="nv">$ </span>terraform apply <span class="nt">--auto-approve</span>
  <span class="c"># =&gt; ...</span>
  <span class="c">#          + content              = (sensitive value)</span>
  <span class="c">#    ...</span>
      
  <span class="c"># 2. terraform consoleë¡œ í™•ì¸ì‹œì—ë„ ë¯¼ê°í•œ ê°’ìœ¼ë¡œ í•„í„°ë§ ë˜ì–´ ì¶œë ¥ë©ë‹ˆë‹¤.</span>
  <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
  <span class="c"># =&gt; (sensitive value)</span>
      
  <span class="c"># 3. íŒŒì¼ ë‚´ìš©ì€ ì‹¤ì œ ê°’ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.</span>
  <span class="nv">$ </span><span class="nb">cat </span>abc.txt 
  <span class="c"># =&gt; supersecret</span>
      
  <span class="c"># 4. terraform.tfstate íŒŒì¼ì€ ì‹¤ì œê°’ì´ ë“¤ì–´ê°€ ìˆìŠµë‹ˆë‹¤. .tfstate íŒŒì¼ì„ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•´ì•¼ í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.</span>
  <span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate| <span class="nb">grep</span> <span class="s2">"content"</span>
  <span class="c"># =&gt; "content": "supersecret",</span>
</code></pre></div>        </div>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">terraform.tfstate</code> ì—ì„œëŠ” sensitive ê°’ì´ ë…¸ì¶œë˜ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">terraform.tfstate</code> íŒŒì¼ì„ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒì˜ ë°©ë²• ë“±ì´ ìˆìŠµë‹ˆë‹¤.
            <ol>
              <li>AWS S3 ë“±ì˜ ì™¸ë¶€ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ê³ , ê¶Œí•œì„ ì œí•œ</li>
              <li>ë¯¼ê°í•œ ì •ë³´ë¥¼ <code class="language-plaintext highlighter-rouge">variable</code>ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ (ì˜ˆ) íŒŒì¼ ë“±) ë„˜ê¸°ê±°ë‚˜, ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ì¦‰ì‹œ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ê²½ìš° ì‚¬ìš©</li>
              <li>ë¯¼ê°í•œ ì •ë³´ëŠ” Terraformì— ë„˜ê¸¸ë•Œ ì•”í˜¸í™” í•˜ì—¬ ì‚¬ìš©í•˜ê³ , provisioningì‹œ ë³µí˜¸í™”í•˜ì—¬ ì‚¬ìš©</li>
            </ol>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="ë³€ìˆ˜-ì…ë ¥-ë°©ì‹ê³¼-ìš°ì„ -ìˆœìœ„">ë³€ìˆ˜ ì…ë ¥ ë°©ì‹ê³¼ ìš°ì„  ìˆœìœ„</h5>

<ul>
  <li>ë³€ìˆ˜ ì…ë ¥ ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ì•„ë˜ë¡œ ê°ˆ ìˆ˜ë¡ ìš°ì„ ìˆœìœ„ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.
    <ol>
      <li>ì‹¤í–‰ í›„ ëŒ€í™”ì‹ ì…ë ¥
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
 <span class="c"># =&gt; var.my_var</span>
 <span class="c">#    Enter a value: abcd</span>
      
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "abcd"</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">variable</code> ë¸”ë¡ì— <code class="language-plaintext highlighter-rouge">default</code>ë¡œ ì§€ì •ëœ ê°’
        <ul>
          <li><code class="language-plaintext highlighter-rouge">main.tf</code> ì‘ì„±
            <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># main.tf</span>
  <span class="k">variable</span> <span class="s2">"my_var"</span> <span class="p">{</span>
      <span class="nx">default</span> <span class="p">=</span> <span class="s2">"default value"</span>
  <span class="p">}</span>
</code></pre></div>            </div>
          </li>
          <li>ì‹¤í–‰
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
  <span class="c"># =&gt; ...</span>
  <span class="c"># =&gt; Apply complete! Resources: 1 added, 0 changed, 1 destroyed.</span>
         
  <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
  <span class="c"># =&gt; "default value"</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>í™˜ê²½ ë³€ìˆ˜ë¡œ ì…ë ¥
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">export </span><span class="nv">TF_VAR_my_var</span><span class="o">=</span><span class="s2">"í™˜ê²½ë³€ìˆ˜"</span>
 <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "í™˜ê²½ë³€ìˆ˜"</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">terraform.tfvars</code> íŒŒì¼ì„ í†µí•´ ë³€ìˆ˜ íŒŒì¼ë¡œ ì…ë ¥
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'my_var = "terraform.tfvars ê°’"'</span> <span class="o">&gt;</span> terraform.tfvars
 <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "terraform.tfvars ê°’"</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">terraform.tfvars.json</code> íŒŒì¼ì„ í†µí•´ ë³€ìˆ˜ íŒŒì¼ë¡œ ì…ë ¥
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'{ "my_var": "terraform.tfvars.json ê°’" }'</span> <span class="o">&gt;</span> terraform.tfvars.json
 <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "terraform.tfvars.json ê°’"</span>
</code></pre></div>        </div>
      </li>
      <li><code class="language-plaintext highlighter-rouge">*.auto.tfvars</code> ë˜ëŠ” <code class="language-plaintext highlighter-rouge">*.auto.tfvars.json</code> ì„ í†µí•´ ë³€ìˆ˜ íŒŒì¼ë¡œ ì…ë ¥
        <ul>
          <li>ë‹¨, íŒŒì¼ëª…ì˜ ì •ë ¬ ìˆœì„œì— ë”°ë¼ <code class="language-plaintext highlighter-rouge">*.auto.tfvars</code> íŒŒì¼ê°„ì˜ ìš°ì„ ìˆœìœ„ê¸° ì ìš©ë©ë‹ˆë‹¤.</li>
        </ul>

        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'my_var = "eeee.auto.tfvars ê°’"'</span> <span class="o">&gt;</span> eeee.auto.tfvars
 <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "eeee.auto.tfvars ê°’"</span>

 <span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'my_var = "zzzz.auto.tfvars ê°’"'</span> <span class="o">&gt;</span> zzzz.auto.tfvars
 <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "zzzz.auto.tfvars ê°’"</span>

 <span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'my_var = "aaaa.auto.tfvars ê°’"'</span> <span class="o">&gt;</span> aaaa.auto.tfvars
 <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "zzzz.auto.tfvars ê°’"</span>
</code></pre></div>        </div>
        <ul>
          <li>ìœ„ì˜ ì˜ˆì œì—ì„œ ë³´ëŠ”ê²ƒê³¼ ê°™ì´ ì •ë ¬ ìˆœì„œì—ì„œ ë’¤ë¡œ ê°ˆ ìˆ˜ë¡ ìš°ì„ ìˆœìœ„ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤. zê°€ aë‚˜ e ë³´ë‹¤ ë’¤ì´ê¸° ë•Œë¬¸ì— zzzz.auto.tfvars ê°’ì´ ìš°ì„ í•˜ê²Œ ì ìš©ë©ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">terraform apply</code> ì‹œ <code class="language-plaintext highlighter-rouge">-var</code> ë˜ëŠ” <code class="language-plaintext highlighter-rouge">-var-file</code>ë¡œ íŒŒì¼ ì§€ì • ëª…ë ¹í–‰ ì¸ìˆ˜ ì‚¬ìš©
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span> <span class="nt">-var</span><span class="o">=</span><span class="s1">'my_var=ëª…ë ¹í–‰ ì¸ìˆ˜ ê°’'</span> <span class="nt">-var</span><span class="o">=</span><span class="s2">"addtional_var=ì¶”ê°€ ë³€ìˆ˜ ê°’"</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "ëª…ë ¹í–‰ ì¸ìˆ˜ ê°’"</span>
     
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'my_var="-var-file ê°’"'</span> <span class="o">&gt;</span> varfiletest.txt
 <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span> <span class="nt">-var-file</span><span class="o">=</span>varfiletest.txt
 <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
 <span class="c"># =&gt; "-var-file ê°’"</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ul>

<h4 id="locals-ì§€ì—­-ê°’-ë¸”ë¡">locals ì§€ì—­ ê°’ ë¸”ë¡</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">locals</code> ë¸”ë¡ì€ í…Œë¼í¼ ì½”ë“œ ë‚´ì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì§€ì—­ ë³€ìˆ˜ë¥¼ ì •ì˜í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">variable</code> ê³¼ëŠ” ë‹¬ë¦¬ ì„ ì–¸ëœ ëª¨ë“ˆ ë‚´ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, ì‹¤í–‰ì‹œì— ì…ë ¥ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
  <li>ë‹¨ì ìœ¼ë¡œëŠ” ì‹¤ì œ ê°’ì— ëŒ€í•œ ì¶”ì ì´ ì–´ë ¤ì›Œ ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">locals</code> ë¸”ë¡ ì„ ì–¸ ë°©ë²•</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">locals</span> <span class="p">{</span>
      <span class="err">&lt;ì¸ìˆ˜&gt;</span> <span class="p">=</span> <span class="err">&lt;ê°’&gt;</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">source</code>, <code class="language-plaintext highlighter-rouge">version</code>, <code class="language-plaintext highlighter-rouge">providers</code> ë“±ì˜ ì˜ˆì•½ì–´ëŠ” ë³€ìˆ˜ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
    <p>ì°¸ì¡° ë°©ë²•</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># ë³€ìˆ˜ ì°¸ì¡°</span>
  <span class="kd">local</span><span class="err">.&lt;ì´ë¦„&gt;</span>
  
  <span class="c1"># ë°°ì—´ì¸ ê²½ìš° [&lt;ì¸ë±ìŠ¤&gt;] ë¡œ ì°¸ì¡°</span>
  <span class="kd">local</span><span class="err">.&lt;ì´ë¦„&gt;</span><span class="p">[</span><span class="err">&lt;ì¸ë±ìŠ¤&gt;</span><span class="p">]</span>
  
  <span class="c1"># ë°°ì—´ì˜ 10ë²ˆì§¸ í•­ëª© ì°¸ì¡° ì˜ˆì‹œ</span>
  <span class="kd">local</span><span class="err">.&lt;ì´ë¦„&gt;</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>  
</code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">locals</code> ë¸”ë¡ ì‚¬ìš© ì˜ˆì‹œ
    <ul>
      <li><code class="language-plaintext highlighter-rouge">main.tf</code> ì‘ì„±
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># main.tf</span>
  <span class="k">variable</span> <span class="s2">"prefix"</span> <span class="p">{</span>
      <span class="nx">type</span>    <span class="p">=</span> <span class="nx">string</span>
      <span class="nx">default</span> <span class="p">=</span> <span class="s2">"hello"</span>
  <span class="p">}</span>
    
  <span class="nx">locals</span> <span class="p">{</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="s2">"terraform"</span>
      <span class="nx">content</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">prefix</span><span class="k">}</span><span class="s2"> </span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">"</span>
      <span class="nx">my_info</span> <span class="p">=</span> <span class="p">{</span>
          <span class="nx">age</span> <span class="p">=</span> <span class="mi">20</span>
          <span class="nx">region</span> <span class="p">=</span> <span class="s2">"KR"</span>
      <span class="p">}</span>
      <span class="nx">my_nums</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
  <span class="p">}</span>
    
  <span class="nx">locals</span> <span class="p">{</span>
      <span class="nx">my_string</span> <span class="p">=</span> <span class="s2">"string </span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">content</span><span class="k">}</span><span class="s2">"</span>
      <span class="c1"># content = "content2" # ìœ„ì˜ localsì— ë“±ë¡ë˜ì–´ì„œ ë¡œì»¬ë³€ìˆ˜ëª…ì´ ì¤‘ë³µë˜ì–´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.    </span>
  <span class="p">}</span>
      
  <span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
      <span class="nx">content</span>  <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">content</span>
      <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
  <span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>ì‹¤í–‰ ê²°ê³¼ í™•ì¸
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
        
  <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.abc.content"</span> | terraform console
  <span class="c"># =&gt; "hello terraform"</span>
    
  <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local.my_string"</span> | terraform console
  <span class="c"># =&gt; "string hello terraform"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="output-ì¶œë ¥-ê°’-ë¸”ë¡">output ì¶œë ¥ ê°’ ë¸”ë¡</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">output</code> ë¸”ë¡ì€ í…Œë¼í¼ ì½”ë“œ í”„ë¡œë¹„ì €ë‹ ìˆ˜í–‰ í›„ ê²°ê³¼ ì†ì„± ê°’ì„ í™•ì¸í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>ì¶œë ¥ ê°’ì€ ë‹¤ìŒì˜ ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>ë£¨íŠ¸ ëª¨ë“ˆì—ì„œ ì‚¬ìš©ìê°€ í™•ì¸í•˜ê³ ì í•˜ëŠ” íŠ¹ì • ì†ì„± ì¶œë ¥</li>
      <li>ìì‹ ëª¨ë“ˆì˜ íŠ¹ì •ê°’ì„ ì •ì˜í•˜ê³  ë£¨íŠ¸ ëª¨ë“ˆì—ì„œ ê²°ê³¼ë¥¼ ì°¸ì¡°</li>
      <li>ë£¨íŠ¸ ëª¨ë“ˆ ê°„ì˜ ê²°ê³¼ë¥¼ ì›ê²©ìœ¼ë¡œ ì½ê¸° ìœ„í•œ ì ‘ê·¼ ìš”ì†Œ</li>
    </ul>
  </li>
  <li>output ë¸”ë¡ ì„ ì–¸ ë°©ë²•
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">output</span> <span class="s2">"&lt;ì´ë¦„&gt;"</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="p">=</span> <span class="err">&lt;ê°’&gt;</span>
      <span class="err">&lt;ë©”íƒ€ë³€ìˆ˜&gt;</span> <span class="p">=</span> <span class="err">&lt;ë©”íƒ€ë³€ìˆ˜</span> <span class="err">ê°’&gt;</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h5 id="output-ë¸”ë¡ì—ì„œ-ì‚¬ìš©-ê°€ëŠ¥í•œ-ë©”íƒ€ë³€ìˆ˜">output ë¸”ë¡ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ë©”íƒ€ë³€ìˆ˜</h5>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">output</code> ë¸”ë¡ì—ì„œëŠ” ë‹¤ìŒì˜ ë©”íƒ€ë³€ìˆ˜ë¥¼ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

    <table>
      <thead>
        <tr>
          <th>ë©”íƒ€ë³€ìˆ˜</th>
          <th>ì„¤ëª…</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>description</td>
          <td>ì¶œë ¥ê°’ì˜ ì„¤ëª…ì„ ê¸°ì…í•©ë‹ˆë‹¤.</td>
        </tr>
        <tr>
          <td>sensitive</td>
          <td>ë¹„ë°€ë²ˆí˜¸ ë“±ì˜ ë¯¼ê°í•œ ê°’ì„ì„ í‘œì‹œí•˜ê³  ì¶œë ¥ë¬¸ì—ì„œ ê°’ ë…¸ì¶œì„ ì œí•œí•©ë‹ˆë‹¤.</td>
        </tr>
        <tr>
          <td>depends_on</td>
          <td>valueì— ë‹´ê¸¸ ê°’ì´ ì¢…ì†ì„±ì´ ìˆëŠ” ê²½ìš° ì§€ì •í•˜ë©´ ìƒì„± ìˆœì„œê°€ ì¡°ì •ë©ë‹ˆë‹¤.</td>
        </tr>
        <tr>
          <td>precondition</td>
          <td>ì¶œë ¥ì „ì— ì§€ì •ëœ ì¡°ê±´ì„ ê²€ì¦í•©ë‹ˆë‹¤.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>ì¶œë ¥ ê°’ ì‚¬ìš© ì˜ˆì‹œ</p>
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># main.tf</span>
  <span class="nx">locals</span> <span class="p">{</span>
    <span class="nx">content</span> <span class="p">=</span> <span class="s2">"local content"</span>
  <span class="p">}</span>
    
  <span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
    <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">content</span><span class="k">}</span><span class="s2">"</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
  <span class="p">}</span>
    
  <span class="k">output</span> <span class="s2">"file_id"</span> <span class="p">{</span>
    <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">depends_on</span> <span class="p">=</span> <span class="p">[</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span> <span class="p">]</span>
  <span class="p">}</span>
    
  <span class="k">output</span> <span class="s2">"file_abspath"</span> <span class="p">{</span>
    <span class="nx">value</span> <span class="p">=</span> <span class="nx">abspath</span><span class="p">(</span><span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span><span class="p">.</span><span class="nx">filename</span><span class="p">)</span>
    <span class="nx">description</span> <span class="p">=</span> <span class="s2">"íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œ"</span>
  <span class="p">}</span>
    
  <span class="k">output</span> <span class="s2">"local_content"</span> <span class="p">{</span>
    <span class="nx">value</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">content</span>
    <span class="nx">sensitive</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>ì‹¤í–‰ ê²°ê³¼</li>
    </ul>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">$</span> <span class="k">terraform</span> <span class="nx">apply</span> <span class="nx">-auto-approve</span>
  <span class="c1"># =&gt; ...</span>
  <span class="c1">#    Outputs:</span>
  <span class="c1">#    </span>
  <span class="c1">#    file_abspath = ".../week-2/mytest7-output/abc.txt"</span>
  <span class="c1">#    file_id = "094f587b52451d1d5f3ef42a921fc877d8b18c1b"</span>
  <span class="c1">#    local_content = &lt;sensitive&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h3 id="ë°˜ë³µë¬¸-12">ë°˜ë³µë¬¸ (1/2)</h3>

<ul>
  <li>list í˜•íƒœì˜ ê°’ ëª©ë¡ì´ë‚˜ Key-Value í˜•íƒœì˜ ë§µì„ í•­ëª© ë§Œí¼ ë°˜ë³µí•˜ì—¬ ì¸í”„ë¼ êµ¬ì„± ì •ì˜ë¥¼ í•­ëª© ê°œìˆ˜ë§Œí¼ ë°˜ë³µì ìœ¼ë¡œ ì‘ì„±í•˜ì§€ ì•Šê³ ,
  ë°˜ë³µë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>í…Œë¼í¼ì˜ HCLì—ëŠ” <code class="language-plaintext highlighter-rouge">count</code>ì™€ <code class="language-plaintext highlighter-rouge">for_each</code> ë‘ ê°€ì§€ ë°˜ë³µë¬¸ì´ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ë²ˆ ì£¼ì°¨ì—ëŠ” <code class="language-plaintext highlighter-rouge">count</code> ë°˜ë³µë¬¸ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.</li>
</ul>

<h4 id="count-ë°˜ë³µë¬¸">count ë°˜ë³µë¬¸</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">count</code>ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì˜ <code class="language-plaintext highlighter-rouge">for</code>ë¬¸ ì²˜ëŸ¼ ì •ìˆ˜ê°’ë§Œí¼ ë°˜ë³µí•©ë‹ˆë‹¤.</li>
  <li>ê¸°ë³¸ ì ì¸ ì‚¬ìš©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"&lt;í”„ë¡œë°”ì´ë”ì´ë¦„_ë¦¬ì†ŒìŠ¤ìœ í˜•&gt;"</span> <span class="s2">"&lt;ì´ë¦„&gt;"</span> <span class="p">{</span>
    <span class="nx">count</span> <span class="p">=</span> <span class="err">&lt;ë°˜ë³µíšŸìˆ˜&gt;</span>
    <span class="nx">content</span> <span class="p">=</span> <span class="s2">"Index = </span><span class="k">${</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="k">}</span><span class="s2">"</span> <span class="c1"># count.index ë¡œ í˜„ì¬ ë°˜ë³µ ì¸ë±ìŠ¤ë¥¼ ì°¸ì¡°</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>ìœ„ì˜ ì½”ë“œì—ì„œ <code class="language-plaintext highlighter-rouge">count</code> íšŸìˆ˜ ë§Œí¼ ë°˜ë³µí•´ì„œ resourceë‚˜ ëª¨ë“ˆì„ ìƒì„±í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">count</code>ì˜ ë°˜ë³µíšŸìˆ˜ ì°¸ê³ ê°’ì€ <code class="language-plaintext highlighter-rouge">count.index</code>ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, 0ë¶€í„° ì‹œì‘í•´ì„œ 1ì”© ì¦ê°€í•©ë‹ˆë‹¤.</li>
  <li>ì‚¬ìš© ì˜ˆì œ
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"fruits"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="s2">"kiwi"</span><span class="p">]</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"fruit_files"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="nx">length</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">fruits</span><span class="p">)</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/i_love_</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">fruits</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span><span class="k">}</span><span class="s2">.txt"</span>
  <span class="nx">content</span> <span class="p">=</span> <span class="s2">"I love </span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">fruits</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span><span class="k">}</span><span class="s2">!"</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ì‹¤í–‰ ê²°ê³¼
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">apply</span> <span class="nx">-auto-approve</span>
     
<span class="nx">$</span> <span class="nx">ls</span> <span class="nx">-1</span>
<span class="c1"># =&gt; i_love_apple.txt</span>
<span class="c1">#    i_love_banana.txt</span>
<span class="c1">#    i_love_kiwi.txt</span>
    
<span class="nx">$</span> <span class="nx">cat</span> <span class="nx">i_love_apple</span><span class="err">.</span><span class="nx">txt</span>
<span class="c1"># =&gt; I love apple!</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="ë„ì „ê³¼ì œ">ë„ì „ê³¼ì œ</h3>

<h4 id="ë„ì „ê³¼ì œ-1-ë¦¬ì „-ë‚´ì—ì„œ-ì‚¬ìš©-ê°€ëŠ¥í•œ-ê°€ìš©ì˜ì—­-ëª©ë¡-ê°€ì ¸ì˜¤ê¸°ë¥¼-ì‚¬ìš©í•œ-vpc-ë¦¬ì†ŒìŠ¤-ìƒì„±-ì‹¤ìŠµ-ì§„í–‰">ë„ì „ê³¼ì œ 1. ë¦¬ì „ ë‚´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ê°€ìš©ì˜ì—­ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°ë¥¼ ì‚¬ìš©í•œ VPC ë¦¬ì†ŒìŠ¤ ìƒì„± ì‹¤ìŠµ ì§„í–‰</h4>
<ul>
  <li>ê°€ìš©ì˜ì—­ ëª©ë¡ì„ ê°€ì ¸ì™€ì„œ VPCë¥¼ ë§Œë“¤ê³ , ì‚¬ìš© ê°€ëŠ¥í•œ ì²«ë²ˆì§¸ ê°€ìš©ì˜ì—­ì— subnetì„ ë§Œë“œëŠ” ì‹¤ìŠµì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.</li>
  <li>ì†ŒìŠ¤
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">data</span> <span class="s2">"aws_availability_zones"</span> <span class="s2">"available"</span> <span class="p">{</span>
  <span class="nx">state</span> <span class="p">=</span> <span class="s2">"available"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.0.0.0/16"</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"challenge1 vpc"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"peter_subnet"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">availability_zone</span> <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_availability_zones</span><span class="p">.</span><span class="nx">available</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.0.1.0/24"</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"challenge1 subnet"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
</code></pre></div>    </div>
  </li>
  <li>ì‹¤í–‰ ê²°ê³¼
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    aws_vpc.peter_vpc: Creating...</span>
<span class="c">#    aws_vpc.peter_vpc: Creation complete after 1s [id=vpc-0e6762235c588581b]</span>
<span class="c">#    aws_subnet.peter_subnet: Creating...</span>
<span class="c">#    aws_subnet.peter_subnet: Creation complete after 0s [id=subnet-06888df37bc01ab4c]</span>
  
<span class="c"># ê²°ê³¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.id"</span> | terraform console
<span class="c"># =&gt; "vpc-0e6762235c588581b"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_subnet.peter_subnet.id"</span> | terraform console
<span class="c"># =&gt; "subnet-06888df37bc01ab4c"</span>
</code></pre></div>    </div>
    <ul>
      <li>AWS ì½˜ì†”ì—ì„œ VPC ìƒì„± í™•ì¸
<img src="/assets/2024/t101-4th/20240622_terraform_w2_vpc.png" alt="20240622_terraform_w2_vpc.png" /></li>
      <li>AWS ì½˜ì†”ì—ì„œ Subnet ìƒì„± í™•ì¸
<img src="/assets/2024/t101-4th/20240622_terraform_w2_subnet.png" alt="20240622_terraform_w2_subnet.png" /></li>
    </ul>
  </li>
  <li>
    <p>ê·¸ë˜í”„</p>

    <svg width="455pt" height="98pt" viewBox="0.00 0.00 454.75 98.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 94)">
  <polygon fill="white" stroke="none" points="-4,4 -4,-94 450.75,-94 450.75,4 -4,4" />
<!-- data.aws_availability_zones.available -->
<g id="node1" class="node">
  <polygon fill="none" stroke="black" points="240.25,-90 0,-90 0,-54 240.25,-54 240.25,-90" />
<text text-anchor="middle" x="120.12" y="-66.2" font-family="sans-serif" font-size="14.00">data.aws_availability_zones.available</text>
</g>
<!-- aws_subnet.peter_subnet -->
<g id="node2" class="node">
  <polygon fill="none" stroke="black" points="446.75,-63 276.25,-63 276.25,-27 446.75,-27 446.75,-63" />
<text text-anchor="middle" x="361.5" y="-39.2" font-family="sans-serif" font-size="14.00">aws_subnet.peter_subnet</text>
</g>
<!-- aws_subnet.peter_subnet&#45;&gt;data.aws_availability_zones.available -->
<g id="edge1" class="edge">
  <path fill="none" stroke="black" d="M275.77,-54.56C268,-55.43 260.01,-56.33 251.96,-57.24" />
<polygon fill="black" stroke="black" points="251.59,-53.76 242.05,-58.36 252.38,-60.72 251.59,-53.76" />
</g>
<!-- aws_vpc.peter_vpc -->
<g id="node3" class="node">
  <polygon fill="none" stroke="black" points="185.88,-36 54.38,-36 54.38,0 185.88,0 185.88,-36" />
<text text-anchor="middle" x="120.12" y="-12.2" font-family="sans-serif" font-size="14.00">aws_vpc.peter_vpc</text>
</g>
<!-- aws_subnet.peter_subnet&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge2" class="edge">
  <path fill="none" stroke="black" d="M275.77,-35.44C250.23,-32.56 222.36,-29.42 197.4,-26.6" />
<polygon fill="black" stroke="black" points="197.99,-23.15 187.66,-25.5 197.2,-30.1 197.99,-23.15" />
</g>
</g>
</svg>
  </li>
</ul>

<h4 id="ë„ì „ê³¼ì œ-2-ìœ„-3ê°œ-ì½”ë“œ-íŒŒì¼-ë‚´ìš©ì—-ë¦¬ì†ŒìŠ¤ì˜-ì´ë¦„myvpc-mysubnet1-ë“±ì„-ë°˜ë“œì‹œ-ê¼­-ìì‹ ì˜-ë‹‰ë„¤ì„ìœ¼ë¡œ-ë³€ê²½í•´ì„œ-ë°°í¬-ì‹¤ìŠµí•´ë³´ì„¸ìš”">ë„ì „ê³¼ì œ 2. ìœ„ 3ê°œ ì½”ë“œ íŒŒì¼ ë‚´ìš©ì— ë¦¬ì†ŒìŠ¤ì˜ ì´ë¦„(myvpc, mysubnet1 ë“±)ì„ ë°˜ë“œì‹œ! ê¼­! ìì‹ ì˜ ë‹‰ë„¤ì„ìœ¼ë¡œ ë³€ê²½í•´ì„œ ë°°í¬ ì‹¤ìŠµí•´ë³´ì„¸ìš”!</h4>

<ul>
  <li>vpc.tf ìƒì„±
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># vpc.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
    <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="p">=</span> <span class="s2">"t101-study"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ì‹¤í–‰
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Plan: 1 to add, 0 to change, 0 to destroy.</span>
<span class="c">#    aws_vpc.peter_vpc: Creating...</span>
<span class="c">#    aws_vpc.peter_vpc: Creation complete after 2s [id=vpc-0e1ad43009a8fe8fa]</span>
<span class="c">#    </span>
<span class="c">#    Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.id"</span> | terraform console
<span class="c"># =&gt; "vpc-0e1ad43009a8fe8fa"</span>
   
<span class="nv">$ </span>aws ec2 describe-vpcs <span class="nt">--filter</span> <span class="s1">'Name=isDefault,Values=false'</span> | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "Vpcs": [</span>
<span class="c">#        {</span>
<span class="c">#          "CidrBlock": "10.10.0.0/16",</span>
<span class="c">#          "DhcpOptionsId": "dopt-0c264ef627294fd1f",</span>
<span class="c">#          "State": "available",</span>
<span class="c">#          "VpcId": "vpc-0e1ad43009a8fe8fa",</span>
<span class="c">#          "OwnerId": "123456789012",</span>
<span class="c">#          "InstanceTenancy": "default",</span>
<span class="c">#          "CidrBlockAssociationSet": [</span>
<span class="c">#            {</span>
<span class="c">#              "AssociationId": "vpc-cidr-assoc-0e9adafb317c75f4f",</span>
<span class="c">#              "CidrBlock": "10.10.0.0/16",</span>
<span class="c">#              "CidrBlockState": {</span>
<span class="c">#                "State": "associated"</span>
<span class="c">#              }</span>
<span class="c">#            }</span>
<span class="c">#          ],</span>
<span class="c">#          "IsDefault": false,</span>
<span class="c">#          "Tags": [</span>
<span class="c">#            {</span>
<span class="c">#              "Key": "name",</span>
<span class="c">#              "Value": "t101-study"</span>
<span class="c">#            }</span>
<span class="c">#          ]</span>
<span class="c">#        }</span>
<span class="c">#      ]</span>
<span class="c">#    }</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>AWS ì½˜ì†”ì—ì„œ VPC ìƒì„±ì •ë³´ í™•ì¸ : DNS ì˜µì…˜ê°’ í™•ì¸
    <ul>
      <li>ì•„ë˜ì˜ ìº¡ì³ì™€ ê°™ì´ DNS hostnamesëŠ” Disabled, DNS resolutionì€ Enabled ëœ ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240622_terraform_w2_c2_p1_1.png" alt="20240622_terraform_w2_c2_p1_1.png" /></li>
    </ul>
  </li>
  <li>vpc.tfì˜ DNS ì˜µì…˜ì„ ìˆ˜ì •í•˜ì—¬ ë‘ DNS ì˜µì…˜ê°’ì„ enabled ë¡œ ë³€ê²½
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># vpc.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
  <span class="nx">enable_dns_support</span> <span class="p">=</span> <span class="kc">true</span>   <span class="c1"># ì¶”ê°€</span>
  <span class="nx">enable_dns_hostnames</span> <span class="p">=</span> <span class="kc">true</span> <span class="c1"># ì¶”ê°€</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-study"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>ìˆ˜ì •ëœ vpc.tf ì ìš©
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
</code></pre></div>    </div>
  </li>
  <li>AWS ì½˜ì†”ì—ì„œ VPC ìƒì„±ì •ë³´ í™•ì¸ : DNS ì˜µì…˜ê°’ í™•ì¸
    <ul>
      <li>ì•„ë˜ì™€ ê°™ì´ DNS hostnames ë„ Enabled ë˜ì—ˆìŠµë‹ˆë‹¤.
<img src="/assets/2024/t101-4th/20240622_terraform_w2_c2_p1_2.png" alt="20240622_terraform_w2_c2_p1_2.png" /></li>
    </ul>
  </li>
  <li>vpc.tf ì½”ë“œ ë‚´ìš© ìˆ˜ì • : ì„œë¸Œë„· 2ê°œ ìƒì„± ì¶”ê°€
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
    <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
  <span class="nx">enable_dns_support</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">enable_dns_hostnames</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-study"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"peter_subnet1"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>     <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.10.1.0/24"</span>
  
  <span class="nx">availability_zone</span> <span class="p">=</span> <span class="s2">"ap-northeast-2a"</span>
  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-subnet1"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"peter_subnet2"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>     <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.10.2.0/24"</span>
  
  <span class="nx">availability_zone</span> <span class="p">=</span> <span class="s2">"ap-northeast-2c"</span>
  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-subnet2"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"aws_vpc_id"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>ì‹¤í–‰ ê²°ê³¼ í™•ì¸
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; aws_subnet.peter_subnet1</span>
<span class="c">#    aws_subnet.peter_subnet2</span>
<span class="c">#    aws_vpc.peter_vpc</span>
    
<span class="nv">$ </span>terraform output
<span class="c"># =&gt; aws_vpc_id = "vpc-0e1ad43009a8fe8fa"</span>
    
<span class="nv">$ </span>terraform output aws_vpc_id
<span class="c"># =&gt; "vpc-0e1ad43009a8fe8fa"</span>
    
<span class="nv">$ </span>terraform output <span class="nt">-raw</span> aws_vpc_id
<span class="c"># =&gt; vpc-0e1ad43009a8fe8fa</span>
    
<span class="nv">$ VPCID</span><span class="o">=</span><span class="si">$(</span>terraform output <span class="nt">-raw</span> aws_vpc_id<span class="si">)</span>
    
<span class="nv">$ </span>aws ec2 describe-subnets <span class="nt">--filters</span> <span class="s2">"Name=vpc-id,Values=</span><span class="nv">$VPCID</span><span class="s2">"</span> <span class="nt">--output</span> table
</code></pre></div>        </div>
        <p><img src="/assets/2024/t101-4th/20240622_terraform_w2_c2_p1_3.png" alt="20240622_terraform_w2_c2_p1_3.png" /></p>

        <p><code class="language-plaintext highlighter-rouge">terraform output</code> ì‹œ <code class="language-plaintext highlighter-rouge">-raw</code> ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ â€œ(ë”°ì˜´í‘œ) ì—†ì´ ì¶œë ¥ê°’ë§Œì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ì‹œ ìœ ìš©í• ë“¯í•©ë‹ˆë‹¤.</p>
      </li>
      <li>
        <p>ê·¸ë˜í”„</p>

        <svg width="354pt" height="98pt" viewBox="0.00 0.00 353.50 98.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 94)">
    <polygon fill="white" stroke="none" points="-4,4 -4,-94 349.5,-94 349.5,4 -4,4" />
<!-- aws_subnet.peter_subnet1 -->
<g id="node1" class="node">
    <polygon fill="none" stroke="black" points="345.5,-90 167.5,-90 167.5,-54 345.5,-54 345.5,-90" />
<text text-anchor="middle" x="256.5" y="-66.2" font-family="sans-serif" font-size="14.00">aws_subnet.peter_subnet1</text>
</g>
<!-- aws_vpc.peter_vpc -->
<g id="node3" class="node">
    <polygon fill="none" stroke="black" points="131.5,-63 0,-63 0,-27 131.5,-27 131.5,-63" />
<text text-anchor="middle" x="65.75" y="-39.2" font-family="sans-serif" font-size="14.00">aws_vpc.peter_vpc</text>
</g>
<!-- aws_subnet.peter_subnet1&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge1" class="edge">
    <path fill="none" stroke="black" d="M167.2,-59.37C159.21,-58.23 151.16,-57.07 143.28,-55.95" />
<polygon fill="black" stroke="black" points="143.78,-52.48 133.38,-54.53 142.79,-59.41 143.78,-52.48" />
</g>
<!-- aws_subnet.peter_subnet2 -->
<g id="node2" class="node">
    <polygon fill="none" stroke="black" points="345.5,-36 167.5,-36 167.5,0 345.5,0 345.5,-36" />
<text text-anchor="middle" x="256.5" y="-12.2" font-family="sans-serif" font-size="14.00">aws_subnet.peter_subnet2</text>
</g>
<!-- aws_subnet.peter_subnet2&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge2" class="edge">
    <path fill="none" stroke="black" d="M167.2,-30.63C159.21,-31.77 151.16,-32.93 143.28,-34.05" />
<polygon fill="black" stroke="black" points="142.79,-30.59 133.38,-35.47 143.78,-37.52 142.79,-30.59" />
</g>
</g>
</svg>
      </li>
    </ul>
  </li>
  <li>ì´í›„ ë‹¤ìŒì˜ ì‘ì—…ì„ ì¶”ê°€ ì ìš© í•˜ì˜€ìŠµë‹ˆë‹¤.
    <ul>
      <li>IGW ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ì¶”ê°€</li>
      <li>IGW ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ë¡œ ì „ë‹¬í•˜ëŠ” ë””í´íŠ¸ ë¼ìš°íŒ… ì •ë³´ ì¶”ê°€</li>
      <li>ë³´ì•ˆê·¸ë£¹/EC2 ë°°í¬</li>
    </ul>
  </li>
  <li>ìµœì¢… ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
    <ul>
      <li>vpc.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># vpc.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
    <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
  <span class="nx">enable_dns_support</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">enable_dns_hostnames</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-study"</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"peter_subnet1"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>     <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.10.1.0/24"</span>
    
  <span class="nx">availability_zone</span> <span class="p">=</span> <span class="s2">"ap-northeast-2a"</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-subnet1"</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"peter_subnet2"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>     <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.10.2.0/24"</span>
    
  <span class="nx">availability_zone</span> <span class="p">=</span> <span class="s2">"ap-northeast-2c"</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-subnet2"</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_internet_gateway"</span> <span class="s2">"peter_igw"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-igw"</span>
  <span class="p">}</span>
<span class="p">}</span>
    
    
<span class="k">resource</span> <span class="s2">"aws_route_table"</span> <span class="s2">"peter_rt"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-rt"</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_route_table_association"</span> <span class="s2">"peter_rtassociation1"</span> <span class="p">{</span>
  <span class="nx">subnet_id</span>      <span class="p">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">peter_subnet1</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">route_table_id</span> <span class="p">=</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">peter_rt</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_route_table_association"</span> <span class="s2">"peter_rtassociation2"</span> <span class="p">{</span>
  <span class="nx">subnet_id</span>      <span class="p">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">peter_subnet2</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">route_table_id</span> <span class="p">=</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">peter_rt</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_route"</span> <span class="s2">"peter_defaultroute"</span> <span class="p">{</span>
  <span class="nx">route_table_id</span>         <span class="p">=</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">peter_rt</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">destination_cidr_block</span> <span class="p">=</span> <span class="s2">"0.0.0.0/0"</span>
  <span class="nx">gateway_id</span>             <span class="p">=</span> <span class="nx">aws_internet_gateway</span><span class="p">.</span><span class="nx">peter_igw</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"aws_vpc_id"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>    
</code></pre></div>        </div>
      </li>
      <li>sg.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># sg.tf</span>
<span class="k">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"peter_sg"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>      <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">name</span>        <span class="p">=</span> <span class="s2">"T101 SG"</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"T101 Study SG"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_security_group_rule"</span> <span class="s2">"peter_sginbound"</span> <span class="p">{</span>
  <span class="nx">type</span>              <span class="p">=</span> <span class="s2">"ingress"</span>
  <span class="nx">from_port</span>         <span class="p">=</span> <span class="mi">80</span>
  <span class="nx">to_port</span>           <span class="p">=</span> <span class="mi">80</span>
  <span class="nx">protocol</span>          <span class="p">=</span> <span class="s2">"tcp"</span>
  <span class="nx">cidr_blocks</span>       <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="nx">security_group_id</span> <span class="p">=</span> <span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">peter_sg</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_security_group_rule"</span> <span class="s2">"peter_sgoutbound"</span> <span class="p">{</span>
  <span class="nx">type</span>              <span class="p">=</span> <span class="s2">"egress"</span>
  <span class="nx">from_port</span>         <span class="p">=</span> <span class="mi">0</span>
  <span class="nx">to_port</span>           <span class="p">=</span> <span class="mi">0</span>
  <span class="nx">protocol</span>          <span class="p">=</span> <span class="s2">"-1"</span>
  <span class="nx">cidr_blocks</span>       <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="nx">security_group_id</span> <span class="p">=</span> <span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">peter_sg</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"aws_security_group_id"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">peter_sg</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>    
</code></pre></div>        </div>
      </li>
      <li>ec2.tf
        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ec2.tf</span>
<span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"peter_amazonlinux2"</span> <span class="p">{</span>
  <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">filter</span> <span class="p">{</span>
    <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"owner-alias"</span>
    <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"amazon"</span><span class="p">]</span>
  <span class="p">}</span>
    
  <span class="nx">filter</span> <span class="p">{</span>
    <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
    <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"amzn2-ami-hvm-*-x86_64-ebs"</span><span class="p">]</span>
  <span class="p">}</span>
    
  <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"amazon"</span><span class="p">]</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"peter_ec2"</span> <span class="p">{</span>
    
  <span class="nx">depends_on</span> <span class="p">=</span> <span class="p">[</span>
    <span class="nx">aws_internet_gateway</span><span class="p">.</span><span class="nx">peter_igw</span>
  <span class="p">]</span>
    
  <span class="nx">ami</span>                         <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">peter_amazonlinux2</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">associate_public_ip_address</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">instance_type</span>               <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">vpc_security_group_ids</span>      <span class="p">=</span> <span class="p">[</span><span class="s2">"</span><span class="k">${</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">peter_sg</span><span class="p">.</span><span class="nx">id</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
  <span class="nx">subnet_id</span>                   <span class="p">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">peter_subnet1</span><span class="p">.</span><span class="nx">id</span>
    
  <span class="nx">user_data</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
              #!/bin/bash
              wget https://busybox.net/downloads/binaries/1.31.0-defconfig-multiarch-musl/busybox-x86_64
              mv busybox-x86_64 busybox
              chmod +x busybox
              RZAZ=$(curl http://169.254.169.254/latest/meta-data/placement/availability-zone-id)
              IID=$(curl 169.254.169.254/latest/meta-data/instance-id)
              LIP=$(curl 169.254.169.254/latest/meta-data/local-ipv4)
              echo "&lt; h1&gt;RegionAz($RZAZ) : Instance ID($IID) : Private IP($LIP) : Web Server&lt;/h1&gt;&lt;br/&gt;Greetings commander" &gt; index.html
              nohup ./busybox httpd -f -p 80 &amp;
</span><span class="no">              EOF
    
</span>  <span class="nx">user_data_replace_on_change</span> <span class="p">=</span> <span class="kc">true</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-peter_ec2"</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"peter_ec2_public_ip"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">peter_ec2</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The public IP of the Instance"</span>
<span class="p">}</span>    
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ë°°í¬ í›„ EC2 í™•ì¸
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Outputs:</span>

<span class="c">#    aws_security_group_id = "sg-07761e7b1e39b5af6"</span>
<span class="c">#    aws_vpc_id = "vpc-0e1ad43009a8fe8fa"</span>
<span class="c">#    peter_ec2_public_ip = "54.180.146.116"</span>
  
<span class="c"># ami ë°ì´í„° í™•ì¸</span>
<span class="nv">$ </span>terraform state show data.aws_ami.my_amazonlinux2
  
<span class="c"># EC2 ì¸ìŠ¤í„´ìŠ¤ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>terraform state show aws_instance.myec2
  
<span class="c"># EC2 ì¸ìŠ¤í„´ìŠ¤ IP í™•ì¸</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.peter_ec2.public_ip"</span> | terraform console
<span class="c"># =&gt; "54.180.146.116"</span>
<span class="nv">$ </span>terraform output <span class="nt">-raw</span> peter_ec2_public_ip
<span class="c"># =&gt; 54.180.146.116</span>
  
<span class="c"># curl ë¡œ ì ‘ì† í™•ì¸</span>
<span class="nv">$ PETER_EC2_IP</span><span class="o">=</span><span class="si">$(</span>terraform output <span class="nt">-raw</span> peter_ec2_public_ip<span class="si">)</span>
<span class="nv">$ </span>curl <span class="nv">$PETER_EC2_IP</span>                                      
<span class="c"># =&gt; &lt; h1&gt;RegionAz(apne2-az1) : Instance ID(i-0d4b665d1ce7a4b09) : Private IP(10.10.1.41) : Web Server&lt;/h1&gt;&lt;br/&gt;Greetings commander</span>
</code></pre></div>    </div>
  </li>
  <li>ë¸Œë¼ìš°ì €ë¡œ ì ‘ì† í™•ì¸
<img src="/assets/2024/t101-4th/20240622_terraform_w2_c2_p1_4.png" alt="20240622_terraform_w2_c2_p1_4.png" /></li>
  <li>ê·¸ë˜í”„ í™•ì¸
    <svg width="753pt" height="341pt" viewBox="0.00 0.00 752.75 341.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 337)">
  <polygon fill="white" stroke="none" points="-4,4 -4,-337 748.75,-337 748.75,4 -4,4" />
<!-- data.aws_ami.peter_amazonlinux2 -->
<g id="node1" class="node">
  <polygon fill="none" stroke="black" points="393.5,-252 167.5,-252 167.5,-216 393.5,-216 393.5,-252" />
<text text-anchor="middle" x="280.5" y="-228.2" font-family="sans-serif" font-size="14.00">data.aws_ami.peter_amazonlinux2</text>
</g>
<!-- aws_instance.peter_ec2 -->
<g id="node2" class="node">
  <polygon fill="none" stroke="black" points="667.88,-198 506.38,-198 506.38,-162 667.88,-162 667.88,-198" />
<text text-anchor="middle" x="587.12" y="-174.2" font-family="sans-serif" font-size="14.00">aws_instance.peter_ec2</text>
</g>
<!-- aws_instance.peter_ec2&#45;&gt;data.aws_ami.peter_amazonlinux2 -->
<g id="edge1" class="edge">
  <path fill="none" stroke="black" d="M506.09,-194.19C472.7,-200.11 433.28,-207.09 396.86,-213.55" />
<polygon fill="black" stroke="black" points="396.39,-210.08 387.15,-215.27 397.61,-216.97 396.39,-210.08" />
</g>
<!-- aws_internet_gateway.peter_igw -->
<g id="node3" class="node">
  <polygon fill="none" stroke="black" points="386.38,-198 174.62,-198 174.62,-162 386.38,-162 386.38,-198" />
<text text-anchor="middle" x="280.5" y="-174.2" font-family="sans-serif" font-size="14.00">aws_internet_gateway.peter_igw</text>
</g>
<!-- aws_instance.peter_ec2&#45;&gt;aws_internet_gateway.peter_igw -->
<g id="edge2" class="edge">
  <path fill="none" stroke="black" d="M506.09,-180C473.02,-180 434.03,-180 397.91,-180" />
<polygon fill="black" stroke="black" points="398.31,-176.5 388.31,-180 398.31,-183.5 398.31,-176.5" />
</g>
<!-- aws_security_group.peter_sg -->
<g id="node8" class="node">
  <polygon fill="none" stroke="black" points="376.62,-306 184.38,-306 184.38,-270 376.62,-270 376.62,-306" />
<text text-anchor="middle" x="280.5" y="-282.2" font-family="sans-serif" font-size="14.00">aws_security_group.peter_sg</text>
</g>
<!-- aws_instance.peter_ec2&#45;&gt;aws_security_group.peter_sg -->
<g id="edge3" class="edge">
  <path fill="none" stroke="black" d="M517.9,-198.43C489.7,-207.34 457.2,-219.31 429.5,-234 411.83,-243.37 411.59,-252.48 393.5,-261 390,-262.65 386.39,-264.2 382.71,-265.66" />
<polygon fill="black" stroke="black" points="381.76,-262.28 373.58,-269.03 384.18,-268.85 381.76,-262.28" />
</g>
<!-- aws_subnet.peter_subnet1 -->
<g id="node11" class="node">
  <polygon fill="none" stroke="black" points="369.5,-144 191.5,-144 191.5,-108 369.5,-108 369.5,-144" />
<text text-anchor="middle" x="280.5" y="-120.2" font-family="sans-serif" font-size="14.00">aws_subnet.peter_subnet1</text>
</g>
<!-- aws_instance.peter_ec2&#45;&gt;aws_subnet.peter_subnet1 -->
<g id="edge4" class="edge">
  <path fill="none" stroke="black" d="M506.02,-166.35C481.46,-162.12 454.36,-157.41 429.5,-153 413.83,-150.22 397.23,-147.23 381.04,-144.3" />
<polygon fill="black" stroke="black" points="381.86,-140.89 371.4,-142.54 380.61,-147.78 381.86,-140.89" />
</g>
<!-- aws_vpc.peter_vpc -->
<g id="node13" class="node">
  <polygon fill="none" stroke="black" points="131.5,-144 0,-144 0,-108 131.5,-108 131.5,-144" />
<text text-anchor="middle" x="65.75" y="-120.2" font-family="sans-serif" font-size="14.00">aws_vpc.peter_vpc</text>
</g>
<!-- aws_internet_gateway.peter_igw&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge5" class="edge">
  <path fill="none" stroke="black" d="M201.71,-161.52C190.23,-158.71 178.55,-155.81 167.5,-153 159.51,-150.97 151.17,-148.8 142.86,-146.62" />
<polygon fill="black" stroke="black" points="144.02,-143.3 133.46,-144.13 142.23,-150.07 144.02,-143.3" />
</g>
<!-- aws_route.peter_defaultroute -->
<g id="node4" class="node">
  <polygon fill="none" stroke="black" points="682.88,-144 491.38,-144 491.38,-108 682.88,-108 682.88,-144" />
<text text-anchor="middle" x="587.12" y="-120.2" font-family="sans-serif" font-size="14.00">aws_route.peter_defaultroute</text>
</g>
<!-- aws_route.peter_defaultroute&#45;&gt;aws_internet_gateway.peter_igw -->
<g id="edge6" class="edge">
  <path fill="none" stroke="black" d="M491.26,-142.2C470.88,-145.72 449.47,-149.46 429.5,-153 417.69,-155.1 405.35,-157.31 393.05,-159.53" />
<polygon fill="black" stroke="black" points="392.49,-156.07 383.28,-161.3 393.74,-162.96 392.49,-156.07" />
</g>
<!-- aws_route_table.peter_rt -->
<g id="node5" class="node">
  <polygon fill="none" stroke="black" points="363.12,-90 197.88,-90 197.88,-54 363.12,-54 363.12,-90" />
<text text-anchor="middle" x="280.5" y="-66.2" font-family="sans-serif" font-size="14.00">aws_route_table.peter_rt</text>
</g>
<!-- aws_route.peter_defaultroute&#45;&gt;aws_route_table.peter_rt -->
<g id="edge7" class="edge">
  <path fill="none" stroke="black" d="M491.26,-109.8C470.88,-106.28 449.47,-102.54 429.5,-99 411.72,-95.85 392.74,-92.42 374.52,-89.11" />
<polygon fill="black" stroke="black" points="375.24,-85.69 364.77,-87.34 373.99,-92.57 375.24,-85.69" />
</g>
<!-- aws_route_table.peter_rt&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge8" class="edge">
  <path fill="none" stroke="black" d="M201.71,-90.48C190.23,-93.29 178.55,-96.19 167.5,-99 159.51,-101.03 151.17,-103.2 142.86,-105.38" />
<polygon fill="black" stroke="black" points="142.23,-101.93 133.46,-107.87 144.02,-108.7 142.23,-101.93" />
</g>
<!-- aws_route_table_association.peter_rtassociation1 -->
<g id="node6" class="node">
  <polygon fill="none" stroke="black" points="744.75,-90 429.5,-90 429.5,-54 744.75,-54 744.75,-90" />
<text text-anchor="middle" x="587.12" y="-66.2" font-family="sans-serif" font-size="14.00">aws_route_table_association.peter_rtassociation1</text>
</g>
<!-- aws_route_table_association.peter_rtassociation1&#45;&gt;aws_route_table.peter_rt -->
<g id="edge9" class="edge">
  <path fill="none" stroke="black" d="M429.35,-72C410.7,-72 392.13,-72 374.77,-72" />
<polygon fill="black" stroke="black" points="375.07,-68.5 365.07,-72 375.07,-75.5 375.07,-68.5" />
</g>
<!-- aws_route_table_association.peter_rtassociation1&#45;&gt;aws_subnet.peter_subnet1 -->
<g id="edge10" class="edge">
  <path fill="none" stroke="black" d="M478.26,-90.45C461.92,-93.29 445.26,-96.2 429.5,-99 413.83,-101.78 397.23,-104.77 381.04,-107.7" />
<polygon fill="black" stroke="black" points="380.61,-104.22 371.4,-109.46 381.86,-111.11 380.61,-104.22" />
</g>
<!-- aws_route_table_association.peter_rtassociation2 -->
<g id="node7" class="node">
  <polygon fill="none" stroke="black" points="744.75,-36 429.5,-36 429.5,0 744.75,0 744.75,-36" />
<text text-anchor="middle" x="587.12" y="-12.2" font-family="sans-serif" font-size="14.00">aws_route_table_association.peter_rtassociation2</text>
</g>
<!-- aws_route_table_association.peter_rtassociation2&#45;&gt;aws_route_table.peter_rt -->
<g id="edge11" class="edge">
  <path fill="none" stroke="black" d="M478.26,-36.45C461.92,-39.29 445.26,-42.2 429.5,-45 411.72,-48.15 392.74,-51.58 374.52,-54.89" />
<polygon fill="black" stroke="black" points="373.99,-51.43 364.77,-56.66 375.24,-58.31 373.99,-51.43" />
</g>
<!-- aws_subnet.peter_subnet2 -->
<g id="node12" class="node">
  <polygon fill="none" stroke="black" points="369.5,-36 191.5,-36 191.5,0 369.5,0 369.5,-36" />
<text text-anchor="middle" x="280.5" y="-12.2" font-family="sans-serif" font-size="14.00">aws_subnet.peter_subnet2</text>
</g>
<!-- aws_route_table_association.peter_rtassociation2&#45;&gt;aws_subnet.peter_subnet2 -->
<g id="edge12" class="edge">
  <path fill="none" stroke="black" d="M429.35,-18C412.93,-18 396.57,-18 381.05,-18" />
<polygon fill="black" stroke="black" points="381.42,-14.5 371.42,-18 381.42,-21.5 381.42,-14.5" />
</g>
<!-- aws_security_group.peter_sg&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge13" class="edge">
  <path fill="none" stroke="black" d="M184.02,-270C178.24,-267.4 172.68,-264.41 167.5,-261 126.88,-234.21 96.5,-185.22 80.21,-154.2" />
<polygon fill="black" stroke="black" points="83.39,-152.72 75.73,-145.39 77.15,-155.89 83.39,-152.72" />
</g>
<!-- aws_security_group_rule.peter_sginbound -->
<g id="node9" class="node">
  <polygon fill="none" stroke="black" points="722.25,-333 452,-333 452,-297 722.25,-297 722.25,-333" />
<text text-anchor="middle" x="587.12" y="-309.2" font-family="sans-serif" font-size="14.00">aws_security_group_rule.peter_sginbound</text>
</g>
<!-- aws_security_group_rule.peter_sginbound&#45;&gt;aws_security_group.peter_sg -->
<g id="edge14" class="edge">
  <path fill="none" stroke="black" d="M451.63,-303.08C430.38,-301.2 408.66,-299.27 388.16,-297.45" />
<polygon fill="black" stroke="black" points="388.68,-293.99 378.41,-296.59 388.07,-300.96 388.68,-293.99" />
</g>
<!-- aws_security_group_rule.peter_sgoutbound -->
<g id="node10" class="node">
  <polygon fill="none" stroke="black" points="726.38,-279 447.88,-279 447.88,-243 726.38,-243 726.38,-279" />
<text text-anchor="middle" x="587.12" y="-255.2" font-family="sans-serif" font-size="14.00">aws_security_group_rule.peter_sgoutbound</text>
</g>
<!-- aws_security_group_rule.peter_sgoutbound&#45;&gt;aws_security_group.peter_sg -->
<g id="edge15" class="edge">
  <path fill="none" stroke="black" d="M447.63,-273.28C427.75,-275.04 407.56,-276.83 388.42,-278.52" />
<polygon fill="black" stroke="black" points="388.12,-275.04 378.47,-279.4 388.74,-282.01 388.12,-275.04" />
</g>
<!-- aws_subnet.peter_subnet1&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge16" class="edge">
  <path fill="none" stroke="black" d="M191.12,-126C175.14,-126 158.59,-126 142.99,-126" />
<polygon fill="black" stroke="black" points="143.34,-122.5 133.34,-126 143.34,-129.5 143.34,-122.5" />
</g>
<!-- aws_subnet.peter_subnet2&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge17" class="edge">
  <path fill="none" stroke="black" d="M191.07,-35.39C182.93,-38.15 174.95,-41.34 167.5,-45 139.2,-58.91 111.62,-81.94 92.49,-99.9" />
<polygon fill="black" stroke="black" points="90.21,-97.25 85.42,-106.7 95.06,-102.29 90.21,-97.25" />
</g>
</g>
</svg>
  </li>
</ul>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>
<ul>
  <li>ì‹¤ìŠµì„ í†µí•´ ë¦¬ì†ŒìŠ¤ ìœ í˜•ê³¼ ë¦¬ì†ŒìŠ¤ ì´ë¦„ì˜ ì‚¬ìš©ë²•, ë¦¬ì†ŒìŠ¤ ì†ì„± ë“±ì— ëŒ€í•´ ì´í•´ë¥¼ ë†’ì¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 
ìƒˆì‚¼ìŠ¤ëŸ½ì§€ë§Œ ì´ë ‡ê²Œ ì‰½ê²Œ ê°ì¢… ë¦¬ì†ŒìŠ¤ë“¤ì´ ìƒì„±ë˜ê³ , ì„œë¹„ìŠ¤ê°€ ìš´ì˜ëœë‹¤ëŠ”ê²Œ ì‹ ê¸°í•©ë‹ˆë‹¤.</li>
  <li>ì•…ë¶„ë‹˜ ì‹¤ìŠµë„ í•´ë³´ê³  ì‹¶ì—ˆì§€ë§Œ ìƒê°ë³´ë‹¤ ì—¬ê¸°ê¹Œì§€ ì‹œê°„ì´ ë§ì´ ì†Œìš”ë˜ì–´ ë‹¤ìŒë²ˆìœ¼ë¡œ ë¯¸ë£¨ì–´ì•¼ê² ìŠµë‹ˆë‹¤. :cry:</li>
  <li>ë”°ë¼ê°€ê¸° ë²„ê±°ìš´ ë§Œí¼ ë‚¨ëŠ”ê²ƒì´ ë§ì€ ìŠ¤í„°ë””ê°€ ë ê²ƒ ê°™ìŠµë‹ˆë‹¤. ëê¹Œì§€ ìƒì¡´í•´ì„œ ì™„ì£¼ í•  ìˆ˜ ìˆê¸¸ ë°”ë¼ë©° ì˜¤ëŠ˜ì˜ í¬ìŠ¤íŒ…ì„ ë§ˆì¹©ë‹ˆë‹¤.</li>
</ul>]]></content><author><name></name></author><category term="terraform" /><category term="terraform," /><category term="cloud," /><category term="aws" /><summary type="html"><![CDATA[í…Œë¼í¼ ê¸°ì´ˆ ì…ë¬¸ ì‹¤ìŠµ ìŠ¤í„°ë”” 2ì£¼ì°¨ ì…ë‹ˆë‹¤. 1ì£¼ì°¨ì— ì´ì–´ í…Œë¼í¼ì˜ ê¸°ë³¸ ì‚¬ìš©ë²•ì— ëŒ€í•´ ì‹¤ìŠµí•´ë³´ë ¤ í•©ë‹ˆë‹¤. ì´ë²ˆ ì£¼ì—ë„ â€œí…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaCâ€ ì±…ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.]]></summary></entry><entry><title type="html">[T101 4ê¸°] í…Œë¼í¼ ê¸°ë³¸ ì‚¬ìš©ë²• 1/3</title><link href="https://sweetlittlebird.github.io/posts/2024-06-11-T101-Study-Terraform-Week-1/" rel="alternate" type="text/html" title="[T101 4ê¸°] í…Œë¼í¼ ê¸°ë³¸ ì‚¬ìš©ë²• 1/3" /><published>2024-06-11T23:41:18+09:00</published><updated>2024-06-11T23:41:18+09:00</updated><id>https://sweetlittlebird.github.io/posts/T101%20Study%20-%20Terraform%20Week%201</id><content type="html" xml:base="https://sweetlittlebird.github.io/posts/2024-06-11-T101-Study-Terraform-Week-1/"><![CDATA[<h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì•ìœ¼ë¡œ ëª‡ ì£¼ê°„ì— ê±¸ì³ í…Œë¼í¼ ê¸°ì´ˆ ì…ë¬¸ ì‹¤ìŠµ ìŠ¤í„°ë””ì— ì°¸ì—¬í•˜ë©´ì„œ ë°°ìš´ ë‚´ìš©ì„ ì •ë¦¬í•˜ë ¤ í•©ë‹ˆë‹¤.
ì´ë²ˆ ê¸€ì˜ ì£¼ì œëŠ” í…Œë¼í¼ì˜ ê¸°ë³¸ ì‚¬ìš©ë²•ì´ë©° â€œí…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaCâ€ ì±…ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" /></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC</a></p>
</blockquote>

<h2 id="iac-ì™€-í…Œë¼í¼">IaC ì™€ í…Œë¼í¼</h2>

<p>í•˜ë‚˜ì˜ ì„œë²„ë¥¼ ìš´ì˜í•˜ê¸° ìœ„í•´ì„œëŠ” ìˆ˜ ë§ì€ ì„¤ì¹˜ì™€ ì„¤ì •ì˜ ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
ì„œë²„ì— ìš´ì˜ì²´ì œë¥¼ ì„¤ì¹˜í•˜ê³ , íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ê³ , ì„¤ì •ì„ í•˜ëŠ” ê¸°ë‚˜ê¸´ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.
ì´ê²ƒìœ¼ë¡œ ëë‚˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë°©í™”ë²½ì„ ë¹„ë¡¯í•œ ë„¤íŠ¸ì›Œí¬ ì„¤ì •, ë³´ì•ˆ ì„¤ì •, ëª¨ë‹ˆí„°ë§ ì„¤ì • ë“± ë‹¤ì–‘í•œ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
ì´ëŸ¬í•œ ì‘ì—…ì„ ìˆ˜ë™ìœ¼ë¡œ ì§„í–‰í•˜ë‹¤ ë³´ë©´ ì‹œê°„ë„ ë§ì´ ì†Œìš”ë˜ê³  ì‹¤ìˆ˜í•  ê°€ëŠ¥ì„±ë„ ë†’ì•„ì§‘ë‹ˆë‹¤.</p>

<p>í•˜ë‚˜ì˜ ì„œë²„ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œë„ ì´ëŸ¬í•œ ì‘ì—…ì´ í•„ìš”í•œë°, ìˆ˜ëŒ€, ìˆ˜ì‹­ëŒ€, ìˆ˜ë°±ëŒ€ì˜ ì„œë²„ë¥¼ ìš´ì˜í•œë‹¤ë©´ ì‹œê°„ê³¼ ì‹¤ìˆ˜í•  ê°€ëŠ¥ì„±ì€
ì—„ì²­ ë‚˜ê²Œ ëŠ˜ì–´ë‚©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë‚˜ì˜¨ ê²ƒì´ <code class="language-plaintext highlighter-rouge">IaC(Infrastructure as Code)</code>ì…ë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">IaC(Infrastructure as Code)</code>ëŠ” ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•˜ëŠ” ë°©ì‹ì„ ë§í•˜ë©°, ì½”ë“œë¥¼ <code class="language-plaintext highlighter-rouge">git</code>ì„ ì´ìš©í•˜ì—¬ ë²„ì „ ê´€ë¦¬ë„ í•  ìˆ˜ ìˆê³ 
ì½”ë“œ ë¦¬ë·°ë„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì½”ë“œë¥¼ í†µí•´ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•˜ë©´ ì¸í”„ë¼ë¥¼ ì¬ì‚¬ìš©í•˜ê¸°ë„ ì‰½ê³ , í™•ì¥í•˜ê¸°ë„ ì‰½ìŠµë‹ˆë‹¤.</p>

<p>ì´ <code class="language-plaintext highlighter-rouge">IaC</code>ì— ëŒ€í‘œì ì¸ ë„êµ¬ë¡œëŠ” <code class="language-plaintext highlighter-rouge">í…Œë¼í¼(Terraform)</code>ì´ ìˆìŠµë‹ˆë‹¤. 
í…Œë¼í¼ì€ ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë¡œ, ë‹¤ì–‘í•œ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ë©°, ì½”ë“œë¥¼ í†µí•´ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì„œë²„ë§Œì„ ì˜ˆì‹œë¡œ ë“¤ì—ˆì§€ë§Œ í…Œë¼í¼ì€ ì„œë²„ ë¿ë§Œ ì•„ë‹ˆë¼ AWSì™€ ê°™ì€ í´ë¼ìš°ë“œ ìƒì˜ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>í…Œë¼í¼ì€ í¬ê²Œ 3ê°€ì§€ í˜•íƒœë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>On-premise : Terraform ì´ë¼ ë¶ˆë¦¬ëŠ” í˜•íƒœë¡œ, ì‚¬ìš©ìì˜ ì»´í“¨íŒ… í™˜ê²½ì— ì˜¤í”ˆì†ŒìŠ¤ ë²„ì „ì˜ í…Œë¼í¼ì„ ì‚¬ìš©í•˜ëŠ” í˜•íƒœì…ë‹ˆë‹¤.</li>
  <li>Hosted SaaS : Terraform Cloud ë¼ ë¶ˆë¦¬ë©°, HashiCorp ì—ì„œ ì œê³µí•˜ëŠ” SaaS ì„œë¹„ìŠ¤ë¡œ, HashiCorp ê°€ ê´€ë¦¬í•˜ëŠ” ì„œë²„ í™˜ê²½ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>Private Install : Terraform Enterprise ë¼ ë¶ˆë¦¬ëŠ” ì„œë²„ ì„¤ì¹˜í˜• êµ¬ì„± í™˜ê²½ìœ¼ë¡œ, ê¸°ì—… ë‚´ë¶€ì— ì„¤ì¹˜í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” í˜•íƒœì…ë‹ˆë‹¤. ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì™€ ê²©ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
</ul>

<h2 id="ì‹¤í–‰-í™˜ê²½-êµ¬ì„±">ì‹¤í–‰ í™˜ê²½ êµ¬ì„±</h2>

<p>ì œê°€ ì‚¬ìš©ì¤‘ì¸ macOSë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.
macOSì—ì„œ í…Œë¼í¼ì„ ì„¤ì¹˜í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">Homebrew</code>ë¥¼ ì´ìš©í•˜ì—¬ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>(í™ˆë¸Œë£¨ ì„¤ì¹˜ ë°©ë²•ì€ <a href="https://whalec.io/homebrew-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95/">https://whalec.io/homebrew-ì„¤ì¹˜-ë°-ì‚¬ìš©-ë°©ë²•</a> ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># tfenv ì„¤ì¹˜</span>
brew <span class="nb">install </span>tfenv

<span class="c"># í…Œë¼í¼ 1.8.5 ì„¤ì¹˜</span>
tfenv <span class="nb">install </span>1.8.5

<span class="c"># í…Œë¼í¼ 1.8.5 ë²„ì „ì„ ì‚¬ìš©</span>
tfenv use 1.8.5

<span class="c"># ë²„ì „ í™•ì¸</span>
terraform version

<span class="c"># ìë™ì™„ì„± ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€</span>
terraform <span class="nt">-install-autocomplete</span>

<span class="c"># ìë™ì™„ì„± ìŠ¤í¬ë¦½íŠ¸ ì ìš© (zshì˜ ê²½ìš°)</span>
<span class="nb">source</span> ~/.zshrc
</code></pre></div></div>

<h2 id="terraform-ëª…ë ¹ì˜-ì£¼ìš”-ì„œë¸Œ-ì»¤ë§¨ë“œ">terraform ëª…ë ¹ì˜ ì£¼ìš” ì„œë¸Œ ì»¤ë§¨ë“œ</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">terraform init</code> : í˜„ì¬ ë””ë ‰í† ë¦¬ì— terraform ì„¤ì • íŒŒì¼ë“¤ì„ ìƒì„±í•˜ê³  ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“ ë‹¤ëŠ” ëŠë‚Œì…ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">terraform validate</code> : terraform ì„¤ì • íŒŒì¼ë“¤ì„ ê²€ì¦í•©ë‹ˆë‹¤. ì„¤ì • íŒŒì¼ë“¤ì´ ì˜¬ë°”ë¥´ê²Œ ì‘ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">terraform plan</code> : terraform ì„¤ì • íŒŒì¼ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ì‹¤í–‰í•  ê³„íšì„ í™•ì¸í•©ë‹ˆë‹¤. <strong>ì‹¤ì œë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.</strong>
ì–´ë–¤ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë˜ê³ , ì‚­ì œë˜ë©°, ë³€ê²½ë˜ëŠ”ì§€ ë“±ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">terraform plan -out=tfplan</code> : ì‹¤í–‰í•  ê³„íšì„ íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤. ì´í›„ <code class="language-plaintext highlighter-rouge">terraform apply plan.out</code>ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">terraform apply</code> : terraform ì„¤ì • íŒŒì¼ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ <strong>ì‹¤ì œ</strong> ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ì‚¬ì „ì— <code class="language-plaintext highlighter-rouge">terraform plan</code>ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ì„ í™•ì¸í•˜ê³  ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">terraform apply -replace=ë¦¬ì†ŒìŠ¤</code> : í”„ë¡œë¹„ì €ë‹ì´ ì™„ë£Œëœ í›„ íŠ¹ì • ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œ í›„ ë‹¤ì‹œ ìƒì„± í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">plan</code>, <code class="language-plaintext highlighter-rouge">apply</code> ëª¨ë‘ ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">terraform state list</code> : ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ë“¤ì˜ ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">terraform destroy</code> : terraform ì„¤ì • íŒŒì¼ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ë“¤ì„ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">terraform fmt</code> : terraform ì„¤ì • íŒŒì¼ë“¤ì„ í‘œì¤€ í˜•ì‹ê³¼ í‘œì¤€ ìŠ¤íƒ€ì¼ë¡œ ì •ë ¬í•˜ì—¬ ê°€ë…ì„±ì„ ë†’ì…ë‹ˆë‹¤.</li>
</ul>

<h2 id="terraform-ëª…ë ¹ì˜-ì£¼ìš”-ì˜µì…˜">terraform ëª…ë ¹ì˜ ì£¼ìš” ì˜µì…˜</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-auto-approve</code> : <code class="language-plaintext highlighter-rouge">terraform apply</code> ì‹œ Y/Nì„ ë¬»ì§€ ì•Šê³  ìë™ìœ¼ë¡œ ìŠ¹ì¸í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">-help</code> : ë„ì›€ë§ì„ í™•ì¸í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">terraform apply -help</code>ì™€ ê°™ì´ ëª…ë ì–´ì™€ í•¨ê»˜ ì‚¬ìš©ì‹œ í•´ë‹¹ ëª…ë ¹ì–´ì˜ ì˜µì…˜ì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">-no-color</code> : <code class="language-plaintext highlighter-rouge">&lt;-[0m&lt;[1m</code> ê³¼ ê°™ì€ ë¬¸ìê°€ í‘œì‹œë˜ëŠ” ê²½ìš° ìƒ‰ìƒ ì •ë³´ë¥¼ ì•ˆ ë‚˜ì˜¤ê²Œí•˜ì—¬ ì •ìƒì ìœ¼ë¡œ ë‚˜ì˜¤ê²Œ í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">terraform validate -no-color</code>ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<h2 id="hcl">HCL</h2>

<p>HCLì€ <strong>H</strong>ashiCorp <strong>C</strong>onfiguration <strong>L</strong>anguageì˜ ì•½ìë¡œ, HashiCorpì—ì„œ ë§Œë“  IaCì™€ êµ¬ì„±ì •ë³´ë¥¼ ëª…ì‹œí•˜ê¸° ìœ„í•œ ì–¸ì–´ì…ë‹ˆë‹¤.
HCLì€ ë„¤ì´í‹°ë¸Œ ë¬¸ë²•ê³¼ json í˜¸í™˜ ë¬¸ë²•ì„ ì§€ì›í•©ë‹ˆë‹¤. ë„¤ì´í‹°ë¸Œ ë¬¸ë²•ì˜ ê²½ìš° ë³´í†µ <code class="language-plaintext highlighter-rouge">.tf</code> í™•ì¥ìë¥¼, json í˜¸í™˜ ë¬¸ë²•ì˜ ê²½ìš° <code class="language-plaintext highlighter-rouge">.tf.json</code> í™•ì¥ìë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p>ë„¤ì´í‹°ë¸Œ ë¬¸ë²•ì´ ë” ê°€ë…ì„±ì´ ì¢‹ê³  ì‘ì„±í•˜ê¸° í¸í•˜ê¸° ë•Œë¬¸ì— ë³´í†µ ë„¤ì´í‹°ë¸Œ ë¬¸ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
ì£¼ìš” ë¬¸ë²• ì ì¸ íŠ¹ì§•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ì¿ ë²„ë„¤í‹°ìŠ¤ ì²˜ëŸ¼ ì„ ì–¸ì ì¸ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì¦‰, ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ì ˆì°¨ë¥¼ ê¸°ë¡í•˜ëŠ”ê²ƒì´ ì•„ë‹Œ, ìµœì¢… ê²°ê³¼ë¥¼ ì •í•˜ë©´ Terraformì´ ì ì ˆí•œ ì ˆì°¨ì˜ ê³„íš(plan)ì„ ì„¸ì›Œì„œ ì ìš©í•©ë‹ˆë‹¤..</li>
  <li>ë³€ìˆ˜ì™€ ë¬¸ìì—´ ê°’ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ì¸í„°í´ë ˆì´ì…˜(interpolation)ì„ ì§€ì›í•©ë‹ˆë‹¤.
    <ul>
      <li>ì˜ˆ) <code class="language-plaintext highlighter-rouge">name = "Hello~ {$var.name}!"</code></li>
    </ul>
  </li>
  <li>HCLì€ ì½”ë“œì˜ ëª¨ë“ˆí™”ì™€ ì¬ì‚¬ìš©ì„±ì„ ìœ„í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
</ul>

<h3 id="hcl-ë„¤ì´í‹°ë¸Œ-ë¬¸ë²•-ì˜ˆì‹œ">HCL ë„¤ì´í‹°ë¸Œ ë¬¸ë²• ì˜ˆì‹œ</h3>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// í•œì¤„ ì£¼ì„ ë°©ë²•1</span>
<span class="c1"># í•œì¤„ ì£¼ì„ ë°©ë²•2</span>

<span class="cm">/*
ë¼ì¸
ì£¼ì„
*/</span>

<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">key1</span>     <span class="p">=</span> <span class="s2">"value1"</span>     <span class="c1"># = ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í‚¤ì™€ ê°’ì´ êµ¬ë¶„ë˜ë©°</span>
  <span class="nx">myStr</span>    <span class="p">=</span> <span class="s2">"TF â™¡ UTF-8"</span> <span class="c1"># UTF-8 ë¬¸ìë¥¼ ì§€ì›í•œë‹¤.</span>
  <span class="nx">multiStr</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
  Multi
  Line
  String
  with anytext
</span><span class="no">EOF

</span>  <span class="nx">boolean1</span>    <span class="p">=</span> <span class="kc">true</span>   <span class="c1"># boolean true</span>
  <span class="nx">boolean2</span>    <span class="p">=</span> <span class="kc">false</span>  <span class="c1"># boolean falseë¥¼ ì§€ì›í•œë‹¤.</span>
  <span class="nx">deciaml</span>     <span class="p">=</span> <span class="mi">123</span>    <span class="c1"># ê¸°ë³¸ì ìœ¼ë¡œ ìˆ«ìëŠ” 10ì§„ìˆ˜,</span>
  <span class="nx">octal</span>       <span class="p">=</span> <span class="mi">0123</span>   <span class="c1"># 0ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìˆ«ìëŠ” 8ì§„ìˆ˜,</span>
  <span class="nx">hexadecimal</span> <span class="p">=</span> <span class="s2">"0xD5"</span> <span class="c1"># 0x ê°’ì„ í¬í•¨í•˜ëŠ” ìŠ¤íŠ¸ë§ì€ 16ì§„ìˆ˜,</span>
  <span class="nx">scientific</span>  <span class="p">=</span> <span class="mi">1</span><span class="nx">e10</span>   <span class="c1"># ê³¼í•™í‘œê¸° ë²•ë„ ì§€ì›í•œë‹¤.</span>

  <span class="c1"># funtion í˜¸ì¶œ ì˜ˆ</span>
  <span class="nx">myprojectname</span> <span class="p">=</span> <span class="nx">format</span><span class="p">(</span><span class="s2">"%s is myproject name"</span><span class="p">,</span> <span class="kd">var</span><span class="p">.</span><span class="nx">project</span><span class="p">)</span>

  <span class="c1"># 3í•­ ì—°ì‚°ì ì¡°ê±´ë¬¸ì„ ì§€ì›í•œë‹¤.</span>
  <span class="nx">credentials</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">credentials</span> <span class="p">==</span> <span class="s2">""</span> <span class="err">?</span> <span class="nx">file</span><span class="p">(</span><span class="kd">var</span><span class="p">.</span><span class="nx">credentials_file</span><span class="p">)</span> <span class="err">:</span> <span class="kd">var</span><span class="p">.</span><span class="nx">credentials</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>HCLì€ ì£¼ì„ ë¶€í„° ë³€ìˆ˜ ì •ì˜, ì—°ì‚°, ì¡°ê±´ë¬¸ ë“± í”„ë¡œê·¸ë˜ë°ì ì¸ ìš”ì†Œë¥¼ ê°€ì§€ê³  ìˆê³ , êµ¬ì„± í¸ì˜ì„±ì„ ë†’ì´ê¸° ìœ„í•œ functionì„ ì œê³µí•©ë‹ˆë‹¤.
    <ul>
      <li><a href="https://developer.hashicorp.com/terraform/language/functions">built in function ì†Œê°œ</a></li>
    </ul>
  </li>
  <li>í…Œë¼í¼ìœ¼ë¡œ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•œ terraform, resource, data, variable, local, output ê³¼ ê°™ì€ ì„ ì–¸ ë¸”ë¡ë„ ë‹¤ìˆ˜ ì¡´ì¬í•©ë‹ˆë‹¤.</li>
</ul>

<h3 id="í…Œë¼í¼-ë¸”ë¡">í…Œë¼í¼ ë¸”ë¡</h3>

<p>í…Œë¼í¼ì€ ë‹¤ì–‘í•œ ë¸”ë¡ì„ ì œê³µí•˜ë©°, ê° ë¸”ë¡ì€ íŠ¹ì •í•œ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>

<h4 id="terraform-ë¸”ë¡">terraform ë¸”ë¡</h4>

<ul>
  <li>Terraformì˜ ë²„ì „ì´ë‚˜ í”„ë¡œë°”ì´ë” ë²„ì „ ë“±ì„ ì§€ì • í•  ìˆ˜ ìˆê³ , ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ì„¤ì •ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë²„ì „ì„ ì§€ì •í•¨ìœ¼ë¡œì¨ <strong>ì˜¤ëŠ˜ ì‹¤í–‰í•˜ë˜, 3ë…„ í›„ì— ì‹¤í–‰í•˜ë˜</strong> ê°™ì€ ê²°ê³¼ë¥¼ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">terraform</code> ë¸”ë¡ ì˜ˆì‹œ</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_version</span> <span class="p">=</span> <span class="s2">"~&gt; 1.3.0"</span> <span class="c1"># í…Œë¼í¼ ë²„ì „</span>
  
  <span class="nx">required_providers</span> <span class="p">{</span> <span class="c1"># í”„ë¡œë°”ì´ë” ë²„ì „ì„ ë‚˜ì—´</span>
    <span class="nx">random</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"&gt;= 3.0.0, &lt; 3.1.0"</span>
    <span class="p">}</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"4.2.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">cloud</span> <span class="p">{</span> <span class="c1"># Cloud/Enterprise ê°™ì€ ì›ê²© ì‹¤í–‰ì„ ìœ„í•œ ì •ë³´</span>
    <span class="nx">organization</span> <span class="p">=</span> <span class="s2">"&lt;MY_ORG_NAME&gt;"</span>
    <span class="nx">workspaces</span> <span class="p">{</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="s2">"my-first-workspace"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">backend</span> <span class="s2">"local"</span> <span class="p">{</span> <span class="c1"># stateë¥¼ ë³´ê´€í•˜ëŠ” ìœ„ì¹˜ë¥¼ ì§€ì •</span>
    <span class="nx">path</span> <span class="p">=</span> <span class="s2">"relative/path/to/terraform.tfstate"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>ë²„ì „ í‘œí˜„ ë°©ë²•
    <ul>
      <li>ë²„ì „ì€ Semantic Versioningì„ ë”°ë¦…ë‹ˆë‹¤. Semantic Versioningì€ <code class="language-plaintext highlighter-rouge">Major.Minor.Patch</code> í˜•íƒœë¡œ ë²„ì „ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
        <ul>
          <li><code class="language-plaintext highlighter-rouge">Major</code> ë²„ì „ : í•˜ìœ„ í˜¸í™˜ì„±ì´ ì—†ëŠ” ë³€ê²½ ì‚¬í•­</li>
          <li><code class="language-plaintext highlighter-rouge">Minor</code> ë²„ì „ : í•˜ìœ„ í˜¸í™˜ì„±ì´ ìˆëŠ” ë³€ê²½ ì‚¬í•­</li>
          <li><code class="language-plaintext highlighter-rouge">Patch</code> ë²„ì „ : í•˜ìœ„ í˜¸í™˜ì„±ì´ ìˆëŠ” ë²„ê·¸ ìˆ˜ì •</li>
        </ul>
      </li>
      <li>ë˜í•œ ë²„ì „ì€ ì œì•½ ì¡°ê±´ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        <ul>
          <li><code class="language-plaintext highlighter-rouge">=</code> ë˜ëŠ” ì—°ì‚°ì ì—†ìŒ : ì •í™•íˆ í•´ë‹¹ ë²„ì „</li>
          <li><code class="language-plaintext highlighter-rouge">!=</code> : ì§€ì •ëœ ë²„ì „ì„ ì œì™¸</li>
          <li><code class="language-plaintext highlighter-rouge">&gt;, &gt;=, &lt;, &lt;=</code> : ê°ê° í•´ë‹¹ ë²„ì „ë³´ë‹¤ ë†’ì€ ë²„ì „, ë†’ê±°ë‚˜ ê°™ì€ ë²„ì „, ì‘ì€ ë²„ì „, ì‘ê±°ë‚˜ ê°™ì€ ë²„ì „ ì‚¬ìš©</li>
          <li><code class="language-plaintext highlighter-rouge">~&gt;</code> : ì§€ì •ëœ ë²„ì „ì—ì„œ ê°€ì¥ ìë¦¬ìˆ˜ê°€ ë‚®ì€ êµ¬ì„±ìš”ì†Œë§Œ ë³€ê²½ë˜ëŠ”ê²ƒì„ í—ˆìš©
            <ul>
              <li>ì˜ˆ) <code class="language-plaintext highlighter-rouge">~&gt; x.y</code> ì¸ ê²½ìš° <code class="language-plaintext highlighter-rouge">y</code> ë²„ì „ì— ëŒ€í•´ì„œë§Œ, <code class="language-plaintext highlighter-rouge">~&gt; x.y.z</code> ì¸ ê²½ìš° <code class="language-plaintext highlighter-rouge">z</code> ë²„ì „ì— ëŒ€í•´ì„œë§Œ ë³€ê²½ì„ í—ˆìš©</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="terraform-ë²„ì „-ì§€ì •">Terraform ë²„ì „ ì§€ì •</h5>

<p>ìœ„ì˜ ì˜ˆì œì—ì„œ ë³¸ê²ƒ ì²˜ëŸ¼ <code class="language-plaintext highlighter-rouge">required_version</code>ì„ í†µí•´ í…Œë¼í¼ ë²„ì „ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì§€ì •ëœ ë²„ì „ì˜ ì¡°ê±´ì— ë§ì„ë•Œë§Œ í…Œë¼í¼ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>

<ul>
  <li>Terraform ë²„ì „ í™•ì¸</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform version

<span class="c"># Terraform v1.8.5</span>
<span class="c"># on darwin_arm64</span>
<span class="c"># + provider registry.terraform.io/hashicorp/local v2.5.1</span>
</code></pre></div></div>

<ul>
  <li>main.tf ìˆ˜ì •</li>
</ul>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="c1"># í˜„ì¬ ì„¤ì¹˜ëœ terraform ë²„ì „ì¸ 1.8.5 ë¯¸ë§Œìœ¼ë¡œ ì§€ì •</span>
  <span class="nx">required_version</span> <span class="p">=</span> <span class="s2">"&lt; 1.8.5"</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>terraform plan ì‹¤í–‰</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform plan

<span class="c"># Error: Unsupported Terraform Core version</span>
<span class="c"># </span>
<span class="c">#   on main.tf line 3, in terraform:</span>
<span class="c">#    3:   required_version = "&lt; 1.8.5"</span>
<span class="c"># </span>
<span class="c"># This configuration does not support Terraform version 1.8.5. To proceed, either choose another supported Terraform version or update this version constraint. Version constraints</span>
<span class="c"># are normally set for good reason, so updating the constraint may lead to other errors or unexpected behavior.</span>
</code></pre></div></div>

<p>í˜„ì¬ ì„¤ì¹˜ëœ ë²„ì „ë³´ë‹¤ ì´ì „ìœ¼ë¡œ ì§€ì •ë˜ì–´ì„œ ì—ëŸ¬ê°€ ë‚˜ê³  ì¢…ë£Œë˜ëŠ”ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h5 id="í”„ë¡œë°”ì´ë”-ë²„ì „">í”„ë¡œë°”ì´ë” ë²„ì „</h5>

<p><code class="language-plaintext highlighter-rouge">terraform { required_providers { ... } }</code> ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡œë°”ì´ë” ë²„ì „ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 4.2.0"</span>
    <span class="p">}</span>
    <span class="nx">azurerm</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"hashicorp/azurerm"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"&gt;= 2.99.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì•„ë˜ì˜ ì£¼ì†Œì—ì„œ í”„ë¡œë°”ì´ë”ë“¤ì˜ ëª©ë¡ê³¼ ë²„ì „ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li><a href="https://registry.terraform.io/browse/providers">Terraform Provider Registry</a></li>
</ul>

<p>ì‚¬ì´íŠ¸ ì ‘ì† í›„ ì›í•˜ëŠ” í”„ë¡œë°”ì´ë”ë¥¼ ì„ íƒí•˜ê³  ìš°ì¸¡ ìƒë‹¨ì˜ â€œUSE PROVIDERâ€ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ í”„ë¡œë°”ì´ë”ì˜ ì‚¬ìš©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h5 id="cloud-ë¸”ë¡">cloud ë¸”ë¡</h5>

<p><code class="language-plaintext highlighter-rouge">terraform { cloud { ... } }</code> ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ Terraform Cloudë‚˜ Terraform Enterprise í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„¤ì •ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">cloud</span> <span class="p">{</span>
    <span class="nx">hostname</span> <span class="p">=</span> <span class="s2">"app.terraform.io"</span>        
    <span class="nx">organization</span> <span class="p">=</span> <span class="s2">"my-org"</span>  
    <span class="nx">workspaces</span> <span class="p">{</span>              
      <span class="nx">name</span> <span class="p">=</span> <span class="s2">"my-app-prod"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="backend-ë¸”ë¡">backend ë¸”ë¡</h5>

<p><code class="language-plaintext highlighter-rouge">terraform { backend { ... } }</code> ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ state íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ìœ„ì¹˜ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>Local íŒŒì¼ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°</li>
</ul>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"local"</span> <span class="p">{</span>
    <span class="nx">path</span> <span class="p">=</span> <span class="s2">"relative/path/to/terraform.tfstate"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>AWS S3ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°</li>
</ul>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">bucket</span> <span class="p">=</span> <span class="s2">"mybucket"</span>
    <span class="nx">key</span>    <span class="p">=</span> <span class="s2">"path/to/my/key"</span>
    <span class="nx">region</span> <span class="p">=</span> <span class="s2">"us-west-2"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="resource-ë¸”ë¡">resource ë¸”ë¡</h4>

<p>resource ë¸”ë¡ì€ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤, ë„¤íŠ¸ì›Œí¬, ìŠ¤í† ë¦¬ì§€ ë“±ê³¼ ê°™ì€ êµ¬ì„±ìš”ì†Œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</p>

<ul>
  <li>resourceëŠ” <code class="language-plaintext highlighter-rouge">resource "&lt;í”„ë¡œë°”ì´ë”ì´ë¦„_ë¦¬ì†ŒìŠ¤ìœ í˜•&gt;" "&lt;ì‚¬ìš©ì ì§€ì • ë¦¬ì†ŒìŠ¤ëª…&gt;" { ... }</code> í˜•íƒœë¡œ ì •ì˜í•©ë‹ˆë‹¤.</li>
  <li>
    <p>local í”„ë¡œë°”ì´ë”ì˜ file ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"123"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>AWS í”„ë¡œë°”ì´ë”ì˜ ec2 ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="nx">ami</span> <span class="p">=</span> <span class="s2">"ami-a1b2c3d4"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>  
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>ë¦¬ì†ŒìŠ¤ ë™ì‘ ë³´ì¡° ì¶”ê°€ <strong>ë©”íƒ€ì¸ìˆ˜</strong>ë¥¼ ì •ì˜ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">depends_on</code> : ì¢…ì†ì„±ì„ ì„ ì–¸í•˜ë©°, ì„ ì–¸ëœ êµ¬ì„±ìš”ì†Œì™€ì˜ ìƒì„± ì‹œì ì— ëŒ€í•´ ì •ì˜</li>
      <li><code class="language-plaintext highlighter-rouge">count</code> : ì„ ì–¸ëœ ê°œìˆ˜ì— ë”°ë¼ ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±</li>
      <li><code class="language-plaintext highlighter-rouge">for_each</code> : map ë˜ëŠ” set íƒ€ì…ì˜ ë°ì´í„° ë°°ì—´ì˜ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±</li>
      <li><code class="language-plaintext highlighter-rouge">provider</code> : ë™ì¼í•œ í”„ë¡œë°”ì´ë”ê°€ ë‹¤ìˆ˜ ì •ì˜ë˜ì–´ ìˆëŠ” ê²½ìš° ì§€ì •</li>
      <li><code class="language-plaintext highlighter-rouge">lifecycle</code> : ë¦¬ì†ŒìŠ¤ì˜ ìˆ˜ëª…ì£¼ê¸° ê´€ë¦¬</li>
      <li><code class="language-plaintext highlighter-rouge">provisioner</code> : ë¦¬ì†ŒìŠ¤ ìƒì„± í›„ ì¶”ê°€ ì‘ì—… ì •ì˜</li>
      <li><code class="language-plaintext highlighter-rouge">timeouts</code> : í”„ë¡œë°”ì´ë”ì—ì„œ ì •ì˜í•œ ì¼ë¶€ ë¦¬ì†ŒìŠ¤ ìœ í˜•ì—ì„œëŠ” create, update, deleteì— ëŒ€í•œ í—ˆìš© ì‹œê°„ ì •ì˜ ê°€ëŠ¥</li>
    </ul>
  </li>
</ul>

<h5 id="resource-ì˜-ì¢…ì†ì„±">resource ì˜ ì¢…ì†ì„±</h5>

<ul>
  <li>í…Œë¼í¼ì˜ ì¢…ì†ì„±ì€ resourceì™€ module ì„ ì–¸ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹ ë˜ëŠ” ê° ìš”ì†Œì˜ ìƒì„± ìˆœì„œë¥¼ ì •í•©ë‹ˆë‹¤.</li>
  <li>ì¢…ì†ì„±ì˜ ì¢…ë¥˜
    <ul>
      <li>implicit (ì•”ì‹œì ) ì¢…ì†ì„± : ë¦¬ì†ŒìŠ¤ê°€ ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë“±ì˜ ì˜ì¡´ì„±ì´ ìˆëŠ” ê²½ìš°, í…Œë¼í¼ì´ ìë™ìœ¼ë¡œ ì¢…ì†ì„±ì„ ì„¤ì •í•©ë‹ˆë‹¤.</li>
      <li>explicit (ëª…ì‹œì ) ì¢…ì†ì„± : <code class="language-plaintext highlighter-rouge">depends_on</code> ë©”íƒ€ì¸ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª…ì‹œì ìœ¼ë¡œ ì¢…ì†ì„±ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì¢…ì†ì„±ì€ <code class="language-plaintext highlighter-rouge">terraform graph</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>
    <p>ì¢…ì†ì„±ì´ ì—†ëŠ” ìƒíƒœ í™•ì¸</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"123!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"456!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/def.txt"</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>ìœ„ì™€ê°™ì€ íŒŒì¼ì„ ë§Œë“¤ê³  <code class="language-plaintext highlighter-rouge">terraform graph &gt; graph-1.dot</code> ì„ ì‹¤í–‰í•˜ê³  vscodeì˜ graphviz í™•ì¥ì„ ì„¤ì¹˜í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê·¸ë˜í”„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <svg width="102pt" height="98pt" viewBox="0.00 0.00 102.00 98.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 94)">
  <polygon fill="white" stroke="none" points="-4,4 -4,-94 98,-94 98,4 -4,4" />
<!-- local_file.abc -->
<g id="node1" class="node">
  <polygon fill="none" stroke="black" points="94,-36 0,-36 0,0 94,0 94,-36" />
<text text-anchor="middle" x="47" y="-12.2" font-family="sans-serif" font-size="14.00">local_file.abc</text>
</g>
<!-- local_file.def -->
<g id="node2" class="node">
  <polygon fill="none" stroke="black" points="92.5,-90 1.5,-90 1.5,-54 92.5,-54 92.5,-90" />
<text text-anchor="middle" x="47" y="-66.2" font-family="sans-serif" font-size="14.00">local_file.def</text>
</g>
</g>
</svg>
  </li>
  <li>
    <p>ì•”ì‹œì  ì¢…ì†ì„±ì´ ìˆëŠ” ìƒíƒœ í™•ì¸</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"123!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span><span class="p">.</span><span class="nx">content</span> <span class="err">+</span> <span class="s2">"456!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/def.txt"</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <svg width="229pt" height="44pt" viewBox="0.00 0.00 229.00 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
  <polygon fill="white" stroke="none" points="-4,4 -4,-40 225,-40 225,4 -4,4" />
<!-- local_file.abc -->
<g id="node1" class="node">
  <polygon fill="none" stroke="black" points="94,-36 0,-36 0,0 94,0 94,-36" />
<text text-anchor="middle" x="47" y="-12.2" font-family="sans-serif" font-size="14.00">local_file.abc</text>
</g>
<!-- local_file.def -->
<g id="node2" class="node">
  <polygon fill="none" stroke="black" points="221,-36 130,-36 130,0 221,0 221,-36" />
<text text-anchor="middle" x="175.5" y="-12.2" font-family="sans-serif" font-size="14.00">local_file.def</text>
</g>
<!-- local_file.def&#45;&gt;local_file.abc -->
<g id="edge1" class="edge">
  <path fill="none" stroke="black" d="M129.54,-18C121.73,-18 113.5,-18 105.4,-18" />
<polygon fill="black" stroke="black" points="105.61,-14.5 95.61,-18 105.61,-21.5 105.61,-14.5" />
</g>
</g>
</svg>
  </li>
  <li>
    <p>ëª…ì‹œì  ì¢…ì†ì„±ì´ ìˆëŠ” ìƒíƒœ í™•ì¸</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">depends_on</span> <span class="p">=</span> <span class="p">[</span>  <span class="c1"># ëª…ì‹œì  ì¢…ì†ì„± ì„ ì–¸</span>
    <span class="nx">local_file</span><span class="p">.</span><span class="nx">def</span>
  <span class="p">]</span>
  
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"123!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"456!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/def.txt"</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <svg width="229pt" height="44pt" viewBox="0.00 0.00 229.00 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
  <polygon fill="white" stroke="none" points="-4,4 -4,-40 225,-40 225,4 -4,4" />
<!-- local_file.abc -->
<g id="node1" class="node">
  <polygon fill="none" stroke="black" points="221,-36 127,-36 127,0 221,0 221,-36" />
<text text-anchor="middle" x="174" y="-12.2" font-family="sans-serif" font-size="14.00">local_file.abc</text>
</g>
<!-- local_file.def -->
<g id="node2" class="node">
  <polygon fill="none" stroke="black" points="91,-36 0,-36 0,0 91,0 91,-36" />
<text text-anchor="middle" x="45.5" y="-12.2" font-family="sans-serif" font-size="14.00">local_file.def</text>
</g>
<!-- local_file.abc&#45;&gt;local_file.def -->
<g id="edge1" class="edge">
  <path fill="none" stroke="black" d="M126.61,-18C118.75,-18 110.52,-18 102.45,-18" />
<polygon fill="black" stroke="black" points="102.71,-14.5 92.71,-18 102.71,-21.5 102.71,-14.5" />
</g>
</g>
</svg>
  </li>
</ul>

<h5 id="ë¦¬ì†ŒìŠ¤-ì†ì„±-ì°¸ì¡°">ë¦¬ì†ŒìŠ¤ ì†ì„± ì°¸ì¡°</h5>

<ul>
  <li>ë¦¬ì†ŒìŠ¤ êµ¬ì„±ì—ì„œ ì°¸ì¡° ê°€ëŠ¥í•œ ì¸ìˆ˜ì™€ ì†ì„±ì´ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>ì¸ìˆ˜ (arguments) : ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©ìê°€ ì„ ì–¸ í•˜ëŠ” ê°’</li>
      <li>ì†ì„± (attributes) : ì‚¬ìš©ìê°€ ì„¤ì •í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë˜ë©´ ì½ì„ ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤ì˜ ê³ ìœ  ê°’</li>
    </ul>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"&lt;í”„ë¡œë°”ì´ë”_ìœ í˜•&gt;"</span> <span class="s2">"&lt;ì´ë¦„&gt;"</span> <span class="p">{</span>
  <span class="err">&lt;ì¸ìˆ˜&gt;</span>           <span class="p">=</span> <span class="err">&lt;ê°’&gt;</span>
<span class="p">}</span>
  
<span class="c1"># ë¦¬ì†ŒìŠ¤ ì°¸ì¡°</span>
<span class="err">&lt;í”„ë¡œë°”ì´ë”</span><span class="nx">_</span><span class="err">ìœ í˜•&gt;.&lt;ì´ë¦„&gt;.&lt;ì¸ìˆ˜&gt;</span>
<span class="err">&lt;í”„ë¡œë°”ì´ë”</span><span class="nx">_</span><span class="err">ìœ í˜•&gt;.&lt;ì´ë¦„&gt;.&lt;ì†ì„±&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë ë•Œ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì¸ìˆ˜ë¥¼ ë°›ì•„ì„œ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë˜ë©´, ì¼ë¶€ ë¦¬ì†ŒìŠ¤ëŠ” ìë™ìœ¼ë¡œ ê¸°ë³¸ê°’ì´ë‚˜ ì¶”ê°€ë˜ëŠ” ì†ì„±ì´ ë¶€ì—¬ë©ë‹ˆë‹¤.
    <ul>
      <li>ì˜ˆ) <code class="language-plaintext highlighter-rouge">aws_instance</code> ë¦¬ì†ŒìŠ¤ì˜ ê²½ìš° <code class="language-plaintext highlighter-rouge">ami</code>, <code class="language-plaintext highlighter-rouge">instance_type</code> ë“±ì˜ ì¸ìˆ˜ë¥¼ ë°›ì•„ì„œ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë˜ë©´ <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">public_ip</code> ë“±ì˜ ì†ì„±ì´ ë¶€ì—¬ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h5 id="ë¦¬ì†ŒìŠ¤ì˜-ìˆ˜ëª…-ì£¼ê¸°">ë¦¬ì†ŒìŠ¤ì˜ ìˆ˜ëª… ì£¼ê¸°</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">lifecycle</code>ì€ ë¦¬ì†ŒìŠ¤ì˜ ê¸°ë³¸ ìˆ˜ëª… ì£¼ê¸°ë¥¼ ì‚¬ìš©ìê°€ ì œì–´í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">create_before_destroy</code> (bool) : ë¦¬ì†ŒìŠ¤ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ê¸° ì „ì— ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">prevent_destroy</code> (bool) : ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ì§€ ì•Šë„ë¡ ë°©ì§€í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">ignore_changes</code> (list) : íŠ¹ì • ì¸ìˆ˜ì˜ ë³€ê²½ì„ ë¬´ì‹œí•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">precondition</code> : ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ì „ì— íŠ¹ì • ì¡°ê±´ì„ ê²€ì¦í•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">postcondition</code> : Plan ê³¼ Apply ì´í›„ì˜ ê²°ê³¼ë¥¼ ì†ì„±ê°’ìœ¼ë¡œ ê²€ì¦í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">create_before_destroy</code>
    <ul>
      <li>í…Œë¼í¼ì€ ê¸°ë³¸ ìˆ˜ëª… ì£¼ê¸°ê°€ <strong>ì‚­ì œ í›„ ìƒì„±</strong>ì…ë‹ˆë‹¤. ì¦‰, ë¦¬ì†ŒìŠ¤ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ê¸° ì „ì— ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.</li>
      <li>
        <p>ì˜ë„ì ìœ¼ë¡œ ìƒì„± í›„ ì‚­ì œë¥¼ ì›í• ë•Œ <code class="language-plaintext highlighter-rouge">create_before_destroy = true</code>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"lifecycle - step 1"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
  
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">create_before_destroy</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>í•˜ì§€ë§Œ ì´ ìƒíƒœì—ì„œ <code class="language-plaintext highlighter-rouge">terraform apply</code>ë¥¼ ì‹¤í–‰í•˜ë©´ íŒŒì¼ì´ ì‚­ì œ ë©ë‹ˆë‹¤. ì´ëŠ” abc.txt ë¼ëŠ” íŒŒì¼ì„ ìƒì„± í•œ ë‹¤ìŒ ì‚­ì œí•˜ê¸° ë•Œë¬¸ì—, 
ë§ˆì§€ë§‰ ë™ì‘ì´ ì‚­ì œì´ê¸° ë•Œë¬¸ì— íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">prevent_destroy</code>
    <ul>
      <li>
        <p>ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ì§€ ì•Šë„ë¡ ë°©ì§€í•©ë‹ˆë‹¤. ì´ ì†ì„±ì€ íŠ¹ì • ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ì§€ ì•Šë„ë¡ ë°©ì§€í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"lifecycle - step 1"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
  
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">prevent_destroy</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>ì´ ìƒíƒœì—ì„œ <code class="language-plaintext highlighter-rouge">terraform destroy</code>ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>

        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform destroy
    
<span class="c"># Error: Instance cannot be destroyed</span>
<span class="c">#  </span>
<span class="c">#  on main.tf line 1:</span>
<span class="c">#   1: resource "local_file" "abc" {</span>
<span class="c">#  </span>
<span class="c"># Resource local_file.abc has lifecycle.prevent_destroy set, but the plan calls for this resource to be destroyed. To avoid this error and continue with the plan, either disable</span>
<span class="c"># lifecycle.prevent_destroy or reduce the scope of the plan using the -target option.    </span>
</code></pre></div>        </div>
      </li>
      <li>í•˜ì§€ë§Œ ë¦¬ì†ŒìŠ¤ë¥¼ ìˆ˜ì •í•œ ë‹¤ìŒ <code class="language-plaintext highlighter-rouge">terraform apply -auto-approve</code>ë¥¼ ì‹¤í–‰í•´ë„ ìˆ˜ì •ì‹œ ë™ì¼í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.</li>
      <li><code class="language-plaintext highlighter-rouge">destroy</code> í–ˆì„ë•ŒëŠ” ì´í•´ê°€ ê°€ì§€ë§Œ <code class="language-plaintext highlighter-rouge">apply</code> ì‹œì—ë„ ë™ì¼í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ìˆ˜ì • ë™ì‘ì´ <strong>ì‚­ì œ</strong> í›„ ìƒì„±ìœ¼ë¡œ ì¸ì‹ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ì¦‰ <code class="language-plaintext highlighter-rouge">apply</code> ì‹œì—ë„ ë¦¬ì†ŒìŠ¤ê°€ ìˆ˜ì •ë˜ë©´ ì‚­ì œ ë‹¨ê³„ê°€ ìˆê¸° ë•Œë¬¸ì— <code class="language-plaintext highlighter-rouge">prevent_destroy</code>ê°€ ì ìš©ë˜ì–´ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">ignore_changes</code>
    <ul>
      <li>
        <p>íŠ¹ì • ì¸ìˆ˜ì˜ ë³€ê²½ì„ ë¬´ì‹œí•©ë‹ˆë‹¤. ì´ ì†ì„±ì€ íŠ¹ì • ì¸ìˆ˜ì˜ ë³€ê²½ì„ ë¬´ì‹œí•˜ê³  ë¦¬ì†ŒìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"lifecycle - step 1"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
  
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">ignore_changes</span> <span class="p">=</span> <span class="p">[</span>
      <span class="nx">content</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>ëª¨ë“  ë³€ê²½ìš¸ ë¬´ì‹œí•˜ê³  ì‹¶ë‹¤ë©´ <code class="language-plaintext highlighter-rouge">ignore_changes = all</code>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">precondition</code>
    <ul>
      <li>ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ì „ì— íŠ¹ì • ì¡°ê±´ì„ ê²€ì¦í•©ë‹ˆë‹¤.</li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">condition</code>ì´ <code class="language-plaintext highlighter-rouge">true</code>ì¸ì§€ í™•ì¸ í•˜ê³ , ì¡°ê±´ì´ ë§ì§€ ì•ŠëŠ” ê²½ìš° <code class="language-plaintext highlighter-rouge">error_message</code>ë¡œ ì§€ì •ëœ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">variable</span> <span class="s2">"file_name"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="s2">"step0.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"lifecycle - step 6"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">file_name</span><span class="k">}</span><span class="s2">"</span>
  
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">precondition</span> <span class="p">{</span>
      <span class="nx">condition</span>     <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">file_name</span> <span class="p">==</span> <span class="s2">"step6.txt"</span>
      <span class="nx">error_message</span> <span class="p">=</span> <span class="s2">"file name is not </span><span class="se">\"</span><span class="s2">step6.txt</span><span class="se">\"</span><span class="s2">"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>  
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">postcondition</code>
    <ul>
      <li>í”„ë¡œë¹„ì €ë‹ ì´í›„ì˜ ê²°ê³¼ë¥¼ ì†ì„±ê°’ìœ¼ë¡œ ê²€ì¦í•©ë‹ˆë‹¤.</li>
      <li>
        <p>ë§ˆì°¬ê°€ì§€ë¡œ <code class="language-plaintext highlighter-rouge">condition</code> ì¸ìˆ˜ë¡œ ê²€ì¦í•˜ê³ , ì¡°ê±´ì´ ë§ì§€ ì•ŠëŠ” ê²½ìš° <code class="language-plaintext highlighter-rouge">error_message</code>ë¡œ ì§€ì •ëœ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>

        <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">""</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/step7.txt"</span>

  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">postcondition</span> <span class="p">{</span>
      <span class="nx">condition</span>     <span class="p">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">content</span> <span class="err">!</span><span class="p">=</span> <span class="s2">""</span>
      <span class="nx">error_message</span> <span class="p">=</span> <span class="s2">"content cannot empty"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">output</span> <span class="s2">"step7_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ì‹¤ìŠµ">ì‹¤ìŠµ</h2>

<h3 id="awsì—-ë°°í¬í•˜ê¸°">AWSì— ë°°í¬í•˜ê¸°</h3>

<ul>
  <li>
    <p>AWSë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ awscli ì„¤ì¹˜</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>awscli 
</code></pre></div>    </div>
  </li>
  <li>
    <p>AWS CLIì˜ ë¡œê·¸ì¸ credentials ì„¤ì •</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure

<span class="c"># access key, secret key, ê¸°ë³¸ region ì…ë ¥</span>
</code></pre></div>    </div>

    <p>ì„œìš¸ ë¦¬ì „ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">ap-northeast-2</code>ë¥¼ ì…ë ¥í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>AWS CLIë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì‹  ubuntu 22.04 AMI ì´ë¯¸ì§€ ì–»ê¸°</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws ec2 describe-images <span class="nt">--owners</span> 099720109477 <span class="se">\</span>
  <span class="nt">--filters</span> <span class="s2">"Name=name,Values=ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"</span> <span class="s2">"Name=state,Values=available"</span> <span class="se">\</span>
  <span class="nt">--query</span> <span class="s1">'Images|sort_by(@, &amp;CreationDate)[-1].[ImageId, Name]'</span> <span class="nt">--output</span> text
  
<span class="c"># (ê²°ê³¼)</span>
<span class="c"># ami-0bcdae8006538619a   ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-20240614</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>í™˜ê²½ ë³€ìˆ˜ì— AMI ID ì €ì¥</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TF_VAR_ami_id</span><span class="o">=</span><span class="s2">"ami-0bcdae8006538619a"</span>
</code></pre></div>    </div>

    <p>ì´ë ‡ê²Œ <code class="language-plaintext highlighter-rouge">TF_VAR_</code>ë¥¼ ë¶™ì—¬ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì…‹íŒ…í•˜ë©´ .tf íŒŒì¼ì—ì„œ í•´ë‹¹ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>main.tf íŒŒì¼ ìƒì„±</p>

    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
  
<span class="c1"># TF_VAR_ami_id í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„ ì–¸. var.ami_id ì™€ ê°™ì´ ì‚¬ìš© ê°€ëŠ¥</span>
<span class="k">variable</span> <span class="s2">"ami_id"</span> <span class="p">{</span> <span class="p">}</span>  
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">ami_id</span><span class="k">}</span><span class="s2">"</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">vpc_security_group_ids</span> <span class="p">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
  
  <span class="nx">user_data</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
              #!/bin/bash
              echo "Hello, T101 Study 9090" &gt; index.html
              nohup busybox httpd -f -p 9090 &amp;
</span><span class="no">              EOF
  
</span>  <span class="nx">user_data_replace_on_change</span> <span class="p">=</span> <span class="kc">true</span>
  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"Single-WebSrv"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"instance"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">security_group_name</span>
  
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">9090</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">9090</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">variable</span> <span class="s2">"security_group_name"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The name of the security group"</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"terraform-example-instance"</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"public_ip"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The public IP of the Instance"</span>
<span class="p">}</span> 
</code></pre></div>    </div>
  </li>
  <li>
    <p>plan í™•ì¸ í›„ apply</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform plan
<span class="c"># plan í™•ì¸</span>
terraform apply <span class="nt">-auto-approve</span>
</code></pre></div>    </div>

    <p>ë‹¤ìŒê³¼ ê°™ì´ 32ì´ˆ ê°€ëŸ‰ ì†Œìš” í›„ ìµœì¢…ì ìœ¼ë¡œ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ì˜ public ipë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <p><img src="/assets/2024/t101-4th/20240616_terraform_apply_1.png" alt="terraform apply í™”ë©´" /></p>

    <p>AWS ì½˜ì†”ì—ì„œë„ ì•„ë˜ì™€ ê°™ì´ ì˜ ìƒì„±ëœ EC2 ì¸ìŠ¤í„´ìŠ¤ì™€ ë³´ì•ˆ ê·¸ë£¹ì´ ìƒì„±ëœê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

    <p><img src="/assets/2024/t101-4th/20240616_terraform_apply_2.png" alt="AWS ì½˜ì†”ì—ì„œ EC2 ì¸ìŠ¤í„´ìŠ¤ í™•ì¸" /></p>

    <p>ë¬¼ë¡  ì ‘ì†ë„ ì˜ ë©ë‹ˆë‹¤.</p>

    <p><img src="/assets/2024/t101-4th/20240616_terraform_apply_3.png" alt="í¬ë¡¬ì—ì„œ ì ‘ì† í™•ì¸" /></p>
  </li>
  <li>
    <p>destroy ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform destroy 
</code></pre></div>    </div>

    <p>ì‚­ì œë„ ì˜ ë˜ì—ˆìŠµë‹ˆë‹¤. :)</p>

    <p><img src="/assets/2024/t101-4th/20240616_terraform_destroy.png" alt="destroy í™•ì¸" /></p>
  </li>
</ul>

<h3 id="ë„ì „ê³¼ì œ-3-lifecycleì˜-precondition">ë„ì „ê³¼ì œ 3 <strong>lifecycleì˜ precondition</strong></h3>
<ul>
  <li>ë„ì „ê³¼ì œ : lifecycleì˜ precondition ì‹¤ìŠµ ë‚´ìš©ì—ì„œ step<strong>0</strong>.txt ~ step<strong>6</strong>.txt ì´ <strong>7ê°œì˜ íŒŒì¼ ì´ë¦„ ì¤‘ í•˜ë‚˜ê°€ ì¼ì¹˜ ì‹œ</strong> <strong>ê²€ì¦ ì¡°ê±´ ë§Œì¡±</strong>ìœ¼ë¡œ <strong>ì½”ë“œ ì‘ì„±</strong></li>
  <li>
    <p>ë‹µì•ˆ : ì •ê·œí‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

    <div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"file_name"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="s2">"step0.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"lifecycle - step 6"</span> <span class="c1"># ìˆ˜ì •</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">file_name</span><span class="k">}</span><span class="s2">"</span>
  
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">precondition</span> <span class="p">{</span>
      <span class="nx">condition</span>     <span class="p">=</span> <span class="nx">length</span><span class="p">(</span><span class="nx">regex</span><span class="p">(</span><span class="s2">"^step[0-6]</span><span class="se">\\</span><span class="s2">.txt</span><span class="err">$</span><span class="s2">"</span><span class="p">,</span> <span class="kd">var</span><span class="p">.</span><span class="nx">file_name</span><span class="p">))</span> <span class="err">&gt;</span> <span class="mi">0</span>
      <span class="nx">error_message</span> <span class="p">=</span> <span class="s2">"file name is not </span><span class="se">\"</span><span class="s2">step6.txt</span><span class="se">\"</span><span class="s2">"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div>    </div>
  </li>
  <li>
    <p>ì‹¤í–‰ ê²°ê³¼</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform plan <span class="nt">-var</span><span class="o">=</span><span class="s1">'file_name=step0.txt'</span>
terraform plan <span class="nt">-var</span><span class="o">=</span><span class="s1">'file_name=step1.txt'</span>
terraform plan <span class="nt">-var</span><span class="o">=</span><span class="s1">'file_name=step2.txt'</span>
terraform plan <span class="nt">-var</span><span class="o">=</span><span class="s1">'file_name=step3.txt'</span>
terraform plan <span class="nt">-var</span><span class="o">=</span><span class="s1">'file_name=step4.txt'</span>
terraform plan <span class="nt">-var</span><span class="o">=</span><span class="s1">'file_name=step5.txt'</span>
terraform plan <span class="nt">-var</span><span class="o">=</span><span class="s1">'file_name=step6.txt'</span>

<span class="c"># ì•„ë˜ì™€ ê°™ì´ preconditionì´ trueì—¬ì„œ ê³„íšì´ ì„±ë¦½ë¨</span>
<span class="c">#</span>
<span class="c"># Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:</span>
<span class="c"># -/+ destroy and then create replacement</span>
<span class="c">#</span>
<span class="c"># Terraform will perform the following actions:</span>
<span class="c"># (ì´í•˜ ìƒëµ)  </span>

terraform plan <span class="nt">-var</span><span class="o">=</span><span class="s1">'file_name=step7.txt'</span>
  
<span class="c"># step0.txt ~ step6.txt ì´ì™¸ì˜ íŒŒì¼ëª…ì¸ step7.txtê°€ ì…ë ¥ë˜ì–´ì„œ ì•„ë˜ì™€ ê°™ì´ ì—ëŸ¬ê°€ ë°œìƒí•¨</span>
<span class="c">#</span>
<span class="c"># Planning failed. Terraform encountered an error while generating this plan.</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì´ìƒê³¼ ê°™ì´ ì²«ì£¼ì°¨ì—ëŠ” í…Œë¼í¼ ì„¤ì¹˜ì—ì„œ ë¶€í„° <code class="language-plaintext highlighter-rouge">lifecycle</code> ê¹Œì§€ ìŠ¤í„°ë”” í•˜ì˜€ìŠµë‹ˆë‹¤. 
ìƒê°ë³´ë‹¤ ì™¸ì›Œì•¼ í•˜ëŠ” ë¶€ë¶„ì´ ë§ì•„ì„œ ë‚˜ì¤‘ì— ë‹¤ì‹œ í™•ì¸í•˜ê¸° ìœ„í•´ í‚¤ì›Œë“œ ìœ„ì£¼ë¡œ ì •ë¦¬í•˜ì—¬ ë³´ì•˜ìŠµë‹ˆë‹¤.
HCLì„ í†µí•´ ì„ ì–¸ì ìœ¼ë¡œ .tf íŒŒì¼ì„ ë§Œë“¤ë©´ ì•Œì•„ì„œ ê³„íšì„ ë§Œë“¤ê³  í”„ë¡œë¹„ì €ë‹ í•´ì¤€ë‹¤ë‹ˆ ì°¸ ë˜‘ë˜‘í•œ ë„êµ¬ì¸ê²ƒ ê°™ìŠµë‹ˆë‹¤. 
ì•ìœ¼ë¡œ ë°°ìš°ëŠ” ë‚´ìš©ë“¤ë„ ì¬ë°Œì„ê²ƒ ê°™ì•„ ê¸°ëŒ€ë©ë‹ˆë‹¤.</p>]]></content><author><name></name></author><category term="terraform" /><category term="terraform," /><category term="cloud," /><category term="aws" /><summary type="html"><![CDATA[ì•ìœ¼ë¡œ ëª‡ ì£¼ê°„ì— ê±¸ì³ í…Œë¼í¼ ê¸°ì´ˆ ì…ë¬¸ ì‹¤ìŠµ ìŠ¤í„°ë””ì— ì°¸ì—¬í•˜ë©´ì„œ ë°°ìš´ ë‚´ìš©ì„ ì •ë¦¬í•˜ë ¤ í•©ë‹ˆë‹¤. ì´ë²ˆ ê¸€ì˜ ì£¼ì œëŠ” í…Œë¼í¼ì˜ ê¸°ë³¸ ì‚¬ìš©ë²•ì´ë©° "í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC" ì±…ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.]]></summary></entry></feed>