<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[T101 4기] 테라폼 기본 사용법 3/3 | Sweet Little Bird</title>
<meta name="generator" content="Jekyll v4.3.3">
<meta property="og:title" content="[T101 4기] 테라폼 기본 사용법 3/3">
<meta property="og:locale" content="ko">
<meta name="description" content="테라폼 기초 입문 실습 스터디 3주차이고, 기본 사용법 마지막 주차입니다. 이번 주에도 학습해야 하는 내용이 많아서 부지런히 달려보겠습니다. “테라폼으로 시작하는 IaC” 책을 기준으로 정리하였습니다.">
<meta property="og:description" content="테라폼 기초 입문 실습 스터디 3주차이고, 기본 사용법 마지막 주차입니다. 이번 주에도 학습해야 하는 내용이 많아서 부지런히 달려보겠습니다. “테라폼으로 시작하는 IaC” 책을 기준으로 정리하였습니다.">
<link rel="canonical" href="https://sweetlittlebird.github.io/posts/2024-06-30-T101-Study-Terraform-Week-3/">
<meta property="og:url" content="https://sweetlittlebird.github.io/posts/2024-06-30-T101-Study-Terraform-Week-3/">
<meta property="og:site_name" content="Sweet Little Bird">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-06-30T02:08:00+09:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="[T101 4기] 테라폼 기본 사용법 3/3">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-06-30T02:08:00+09:00","datePublished":"2024-06-30T02:08:00+09:00","description":"테라폼 기초 입문 실습 스터디 3주차이고, 기본 사용법 마지막 주차입니다. 이번 주에도 학습해야 하는 내용이 많아서 부지런히 달려보겠습니다. “테라폼으로 시작하는 IaC” 책을 기준으로 정리하였습니다.","headline":"[T101 4기] 테라폼 기본 사용법 3/3","mainEntityOfPage":{"@type":"WebPage","@id":"https://sweetlittlebird.github.io/posts/2024-06-30-T101-Study-Terraform-Week-3/"},"url":"https://sweetlittlebird.github.io/posts/2024-06-30-T101-Study-Terraform-Week-3/"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/dist/photoswipe.min.css">
  <link rel="stylesheet" href="/assets/dist/main.min.css">
  <link rel="stylesheet" href="/assets/dist/main_dark.min.css" media="(prefers-color-scheme: dark)">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pretendard/1.3.9/static/pretendard.css" integrity="sha512-NzqTHTrO48HsIamogmIaVhTXoSgRF24Cn+ynrNYrFuKrY0AdDbmcNieiOHsQARS/r0Gax9VwV3/rVMHs3ipUlg==" crossorigin="anonymous" referrerpolicy="no-referrer">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!--  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&display=swap" rel="stylesheet">-->
  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&amp;family=Milonga&amp;display=swap" rel="stylesheet">

  <link rel="shortcut icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
<link type="application/atom+xml" rel="alternate" href="https://sweetlittlebird.github.io/feed.xml" title="Sweet Little Bird">
</head>
<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Sweet Little Bird</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/about/">소개</a><a class="page-link" href="/posts/">글 목록</a>
</div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[T101 4기] 테라폼 기본 사용법 3/3</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-06-30T02:08:00+09:00" itemprop="datePublished">2024년 06월 30일에 작성
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="table-of-content">
      <header>목차</header>
      <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">들어가며</a></li>
<li class="toc-entry toc-h2">
<a href="#hcl-%EA%B3%84%EC%86%8D">HCL (계속)</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#%EB%B0%98%EB%B3%B5%EB%AC%B8-22">반복문 (2/2)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#for_each">for_each</a></li>
<li class="toc-entry toc-h4"><a href="#for-expression">for Expression</a></li>
<li class="toc-entry toc-h4"><a href="#dynamic">dynamic</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#%EC%A1%B0%EA%B1%B4%EB%AC%B8-conditional-expression">조건문 (Conditional Expression)</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%95%A8%EC%88%98-function">함수 (Function)</a></li>
<li class="toc-entry toc-h3">
<a href="#%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%84%88-provisioner">프로비저너 (provisioner)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#local-exec-%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%84%88">local-exec 프로비저너</a></li>
<li class="toc-entry toc-h4"><a href="#%EC%9B%90%EA%B2%A9%EC%A7%80-%EC%97%B0%EA%B2%B0">원격지 연결</a></li>
<li class="toc-entry toc-h4"><a href="#file-%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%84%88">file 프로비저너</a></li>
<li class="toc-entry toc-h4"><a href="#remote_exec-%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%84%88">remote_exec 프로비저너</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#null_resource%EC%99%80-terraform_data">null_resource와 terraform_data</a>
<ul>
<li class="toc-entry toc-h4"><a href="#null_resource">null_resource</a></li>
<li class="toc-entry toc-h4"><a href="#terraform_data">terraform_data</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#moved-%EB%B8%94%EB%A1%9D">moved 블록</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#cli%EB%A5%BC-%EC%9C%84%ED%95%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%ED%99%98%EA%B2%BD-%EB%B3%80%EC%88%98">CLI를 위한 시스템 환경 변수</a></li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">마치며</a></li>
</ul>
    </div>
    <ul id="toc" class="section-nav">
</ul>

<h2 id="들어가며">들어가며</h2>

<p>테라폼 기초 입문 실습 스터디 3주차이고, 기본 사용법 마지막 주차입니다.
이번 주에도 학습해야 하는 내용이 많아서 부지런히 달려보겠습니다.
“테라폼으로 시작하는 IaC” 책을 기준으로 정리하였습니다.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="테라폼으로 시작하는 IaC" loading="lazy" width="458" height="589"></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">테라폼으로 시작하는 IaC</a></p>
</blockquote>

<h2 id="hcl-계속">HCL (계속)</h2>

<p>이번주에도 HCL(HashiCorp Configuration Language) 의 문법에 대해 알아보겠습니다.</p>

<h3 id="반복문-22">반복문 (2/2)</h3>

<h4 id="for_each">for_each</h4>

<ul>
  <li>반복문이며 선언된 key 값 개수만큼 리소스를 생성합니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">for_each</code> 는 <code class="language-plaintext highlighter-rouge">count</code> 와 비슷하지만, <code class="language-plaintext highlighter-rouge">count</code> 는 인덱스를 사용하고 <code class="language-plaintext highlighter-rouge">for_each</code> 는 키를 사용합니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">each</code> object 를 사용하여 <code class="language-plaintext highlighter-rouge">key</code> 와 <code class="language-plaintext highlighter-rouge">value</code> 를 사용할 수 있습니다.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">each.key</code> : <code class="language-plaintext highlighter-rouge">key</code> 값</li>
      <li>
<code class="language-plaintext highlighter-rouge">each.value</code> : <code class="language-plaintext highlighter-rouge">value</code> 값 (<code class="language-plaintext highlighter-rouge">set</code> 타입을 사용하면 <code class="language-plaintext highlighter-rouge">each.key</code> 와 같습니다.)</li>
    </ul>
  </li>
  <li>for_each 는 <strong><code class="language-plaintext highlighter-rouge">map</code>과 <code class="language-plaintext highlighter-rouge">set</code> 타입만을 허용</strong>합니다. 따라서 <code class="language-plaintext highlighter-rouge">map</code>과 <code class="language-plaintext highlighter-rouge">set</code> 타입이 아닌 표현식은 <code class="language-plaintext highlighter-rouge">tomap()</code>, <code class="language-plaintext highlighter-rouge">toset()</code> 등을 통해 변환해서 사용할 수 있습니다.</li>
  <li>실습 1. <code class="language-plaintext highlighter-rouge">for_each</code> 사용하기
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="c1"># map 타입으로 선언</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">tomap</span><span class="p">({</span>
    <span class="nx">a</span> <span class="p">=</span> <span class="s2">"content a"</span>
    <span class="nx">b</span> <span class="p">=</span> <span class="s2">"content b"</span>
  <span class="p">})</span>
  
  <span class="c1"># 파일 제목은 key 값으로 설정 (a, b)</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>

  <span class="c1"># 파일 내용은 value 값으로 설정 (content a, content b)</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="c1"># toset() 함수를 사용하여 set 타입으로 변환</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">toset</span><span class="p">([</span><span class="s2">"ccc"</span><span class="p">,</span> <span class="s2">"ddd"</span><span class="p">,</span> <span class="s2">"eee"</span><span class="p">])</span>
  
  <span class="c1"># 파일 제목은 key 값으로 설정</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
  
  <span class="c1"># 파일 내용은 value 값으로 설정 (set의 경우 value와 key가 같음)</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>실행 결과
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; local_file.abc["a"]</span>
<span class="c">#    local_file.abc["b"]</span>
<span class="c">#    local_file.def["ccc"]</span>
<span class="c">#    local_file.def["ddd"]</span>
<span class="c">#    local_file.def["eee"]</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'local_file.abc["a"]'</span> | terraform console
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'local_file.abc["a"].content'</span> | terraform console
<span class="c"># =&gt; "content a"</span>
    
<span class="nv">$ </span><span class="nb">cat </span>a.txt
<span class="c"># =&gt; content a</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'local_file.def["ccc"].content'</span> | terraform console
<span class="nv">$ </span><span class="nb">cat </span>ccc.txt
<span class="c"># =&gt; "ccc"   # key와 value가 같음을 확인할 수 있음  </span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>실습 2. <code class="language-plaintext highlighter-rouge">variable</code> 블록을 사용해 선언된 변수를 사용하여 <code class="language-plaintext highlighter-rouge">local_file.abc</code> 리소스를 생성하고, <code class="language-plaintext highlighter-rouge">local_file.abc</code> 리소스를 사용하여 <code class="language-plaintext highlighter-rouge">local_file.def</code> 리소스를 생성합니다.
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"names"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="p">=</span> <span class="s2">"content a"</span>
    <span class="nx">b</span> <span class="p">=</span> <span class="s2">"content b"</span>
    <span class="nx">c</span> <span class="p">=</span> <span class="s2">"content c"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">names</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc-</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="c1"># 앞에서 만든 local_file.abc 리소스를 사용</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span>  
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">content</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/def-</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>결과
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; local_file.abc["a"]</span>
<span class="c">#    local_file.abc["b"]</span>
<span class="c">#    local_file.abc["c"]</span>
<span class="c">#    local_file.def["a"]</span>
<span class="c">#    local_file.def["b"]</span>
<span class="c">#    local_file.def["c"]</span>
    
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-1</span> <span class="k">*</span>.txt
<span class="c"># =&gt; abc-a.txt</span>
<span class="c">#    abc-b.txt    </span>
<span class="c">#    abc-c.txt    </span>
<span class="c">#    def-a.txt    </span>
<span class="c">#    def-b.txt    </span>
<span class="c">#    def-c.txt</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'local_file.abc["a"].content'</span> | terraform console
<span class="c"># =&gt; "content a"    </span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>실습 3. “실습 2”에서 <code class="language-plaintext highlighter-rouge">names</code> 변수의 b 값을 삭제하고 <code class="language-plaintext highlighter-rouge">terraform apply</code> 명령어를 실행합니다. 
<code class="language-plaintext highlighter-rouge">count</code>와는 달리 중간의 항목이 삭제되어도 제대로 동작하는것을 확인할 수 있습니다.</p>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"names"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="p">=</span> <span class="s2">"content a"</span>
    <span class="nx">c</span> <span class="p">=</span> <span class="s2">"content c"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">names</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc-</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"def"</span> <span class="p">{</span>
  <span class="c1"># 앞에서 만든 local_file.abc 리소스를 사용</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">abc</span>  
  <span class="nx">content</span>  <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">content</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/def-</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="k">}</span><span class="s2">.txt"</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>결과
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#      # local_file.abc["b"] will be destroyed</span>
<span class="c">#    ...</span>
<span class="c">#      # local_file.def["b"] will be destroyed</span>
<span class="c">#    ...</span>
<span class="c">#    Apply complete! Resources: 0 added, 0 changed, 2 destroyed.</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; local_file.abc["a"]</span>
<span class="c">#    local_file.abc["c"]</span>
<span class="c">#    local_file.def["a"]</span>
<span class="c">#    local_file.def["c"]</span>
    
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-1</span> <span class="k">*</span>.txt
<span class="c"># =&gt; abc-a.txt</span>
<span class="c">#    abc-c.txt</span>
<span class="c">#    def-a.txt</span>
<span class="c">#    def-c.txt    </span>
</code></pre></div>        </div>
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">count</code>와는 다르게 중간의 항목이 삭제되어도 제대로 동작하여 키가 <code class="language-plaintext highlighter-rouge">b</code>인 것에 관련된 항목이 삭제되었음을 확인할 수 있습니다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="for-expression">for Expression</h4>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">for</code> Expression은 <code class="language-plaintext highlighter-rouge">for</code> 문을 사용하여 <code class="language-plaintext highlighter-rouge">set</code>이나 <code class="language-plaintext highlighter-rouge">list</code>, <code class="language-plaintext highlighter-rouge">map</code>의 항목들에 대해 반복적으로 작업을 수행할 수 있습니다.</li>
  <li>python의 <code class="language-plaintext highlighter-rouge">list comprehension</code>과 비슷한 기능을 제공합니다.</li>
  <li>기본적인 사용법은 아래와 같습니다.
    <ul>
      <li>리턴 타입이 tuple 인 경우
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nx">for</span> <span class="err">&lt;항목의</span> <span class="err">변수명&gt;</span> <span class="nx">in</span> <span class="err">&lt;</span><span class="nx">set</span><span class="p">,</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">map</span> <span class="err">등의</span> <span class="err">콜렉션&gt;</span> <span class="err">:</span> <span class="err">&lt;항목의</span> <span class="err">변수명을</span> <span class="err">가공하는</span> <span class="err">표현식&gt;</span><span class="p">]</span>
</code></pre></div>        </div>
      </li>
      <li>리턴 타입이 object 인 경우
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nx">for</span> <span class="err">&lt;항목의</span> <span class="err">변수명&gt;</span> <span class="nx">in</span> <span class="err">&lt;</span><span class="nx">set</span><span class="p">,</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">map</span> <span class="err">등의</span> <span class="err">콜렉션&gt;</span> <span class="err">:</span> <span class="err">&lt;결과</span> <span class="err">키&gt;</span> <span class="p">=</span><span class="err">&gt;</span> <span class="err">&lt;결과</span> <span class="err">값&gt;</span><span class="p">}</span>
</code></pre></div>        </div>
        <p>리턴되는 키와 값은 <code class="language-plaintext highlighter-rouge">=&gt;</code> 로 구분합니다.</p>
      </li>
      <li>콜렉션이 <code class="language-plaintext highlighter-rouge">list</code> 유형인 경우 <code class="language-plaintext highlighter-rouge">&lt;항목의 변수명&gt;</code>이 <strong>하나인 경우 값</strong>을, <strong>두개인 경우 “,” (쉼표)로 구분하여, 앞의 인수가 인덱스, 뒤의 인수가 값</strong>을 반환합니다.
        <ul>
          <li>관용적으로 인덱스는 <code class="language-plaintext highlighter-rouge">i</code>, 값은 <code class="language-plaintext highlighter-rouge">v</code>로 표현합니다.
            <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
      
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tolist</span><span class="p">([</span><span class="s2">"aa"</span><span class="p">,</span> <span class="s2">"bb"</span><span class="p">,</span> <span class="s2">"cc"</span><span class="p">,</span> <span class="s2">"dd"</span><span class="p">])</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [ "Aa", "Bb", "Cc", "Dd" ]    </span>
      
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tolist</span><span class="p">([</span><span class="s2">"aa"</span><span class="p">,</span> <span class="s2">"bb"</span><span class="p">,</span> <span class="s2">"cc"</span><span class="p">,</span> <span class="s2">"dd"</span><span class="p">])</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">i</span><span class="k">}</span><span class="s2"> =&gt; </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [ "0 =&gt; Aa", "1 =&gt; Bb", "2 =&gt; Cc", "3 =&gt; Dd" ]    </span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>콜렉션이 <code class="language-plaintext highlighter-rouge">map</code> 유형인 경우 <code class="language-plaintext highlighter-rouge">&lt;항목의 변수명&gt;</code>이 <strong>하나인 경우 값</strong>을, <strong>두개인 경우 “,” (쉼표)로 구분하여, 앞의 인수가 키, 뒤의 인수가 값</strong>을 반환합니다.
        <ul>
          <li>관용적으로 키는 <code class="language-plaintext highlighter-rouge">k</code>, 값은 <code class="language-plaintext highlighter-rouge">v</code>로 표현합니다.
            <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>

<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">upper</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      "234",</span>
<span class="c1">#      "GILDONG"</span>
<span class="c1">#    ]</span>
            
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">upper</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span><span class="k">}</span><span class="s2"> =&gt; </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      "AGE =&gt; 234",</span>
<span class="c1">#      "NAME =&gt; Gildong",</span>
<span class="c1">#    ]</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">if</code> 를 통해 특정 조건을 만족하는 값만 가공하여 리턴 할 수 있습니다.
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
    
<span class="c1"># 짝수인 경우만 제곱한 값을 리턴</span>
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tolist</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">pow</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span> <span class="nx">if</span> <span class="nx">v</span> <span class="err">%</span> <span class="mi">2</span> <span class="err">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># =&gt; [ 4, 16 ]</span>
    
<span class="c1"># 키가 "age"인 경우 제외하고 가공</span>
<span class="err">&gt;</span> <span class="p">{</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="nx">upper</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">title</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="nx">if</span> <span class="nx">k</span> <span class="err">!</span><span class="p">=</span> <span class="s2">"age"</span><span class="p">}</span>
<span class="c1"># =&gt; { "NAME" = "Gildong" }</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>실습
    <ul>
      <li>간단한 for 표현식 실습
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
    
<span class="c1"># 1. tuple 타입을 사용하여 for 표현식 사용</span>
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">value</span> <span class="nx">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="err">:</span> <span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">value</span> <span class="p">*</span> <span class="nx">value</span><span class="p">)</span> <span class="p">]</span>
<span class="c1"># =&gt; [ 1, 2, 16, 512 ]</span>
    
<span class="c1"># 2. set 타입을 사용하여 for 표현식 사용</span>
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">name</span> <span class="nx">in</span> <span class="nx">toset</span><span class="p">([</span><span class="s2">"gildong"</span><span class="p">,</span> <span class="s2">"sejong"</span><span class="p">])</span> <span class="err">:</span> <span class="s2">"Hi, </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="k">}</span><span class="s2">!"</span> <span class="p">]</span>
<span class="c1"># =&gt; [ "Hi, Gildong!", "Hi, Sejong!", ]</span>
    
<span class="c1"># 3. map 타입을 사용하여 for 표현식 사용</span>
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">upper</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="k">}</span><span class="s2"> =&gt; </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span>
<span class="c1"># =&gt; [</span>
<span class="c1">#      "AGE =&gt; 234",</span>
<span class="c1">#      "NAME =&gt; Gildong",</span>
<span class="c1">#    ]</span>
    
<span class="c1"># 4. 타입 확인</span>
<span class="err">&gt;</span> <span class="nx">type</span><span class="err">(</span><span class="p">[</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="nx">in</span> <span class="nx">tomap</span><span class="p">({</span> <span class="nx">name</span> <span class="p">=</span> <span class="s2">"gildong"</span><span class="p">,</span> <span class="nx">age</span> <span class="p">=</span> <span class="mi">234</span> <span class="p">})</span> <span class="err">:</span> <span class="s2">"</span><span class="k">${</span><span class="nx">upper</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="k">}</span><span class="s2"> =&gt; </span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span><span class="p">]</span><span class="err">)</span>
<span class="c1"># =&gt; tuple([</span>
<span class="c1">#      string,</span>
<span class="c1">#      string,</span>
<span class="c1">#    ])</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>악분님 for expression 실습</p>

        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="c1"># main.tf </span>
 <span class="k">variable</span> <span class="s2">"fruits_set"</span> <span class="p">{</span>
   <span class="nx">type</span>        <span class="p">=</span> <span class="nx">set</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
   <span class="nx">default</span>     <span class="p">=</span> <span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">]</span>
   <span class="nx">description</span> <span class="p">=</span> <span class="s2">"fruit example"</span>
 <span class="p">}</span>
      
 <span class="k">variable</span> <span class="s2">"fruits_list"</span> <span class="p">{</span>
   <span class="nx">type</span>        <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
   <span class="nx">default</span>     <span class="p">=</span> <span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">]</span>
   <span class="nx">description</span> <span class="p">=</span> <span class="s2">"fruit example"</span>
 <span class="p">}</span>
      
 <span class="k">variable</span> <span class="s2">"fruits_map"</span> <span class="p">{</span>
   <span class="nx">type</span>        <span class="p">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
   <span class="nx">default</span>     <span class="p">=</span> <span class="p">{</span><span class="s2">"first"</span><span class="err">:</span> <span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"second"</span><span class="err">:</span> <span class="s2">"banana"</span><span class="p">}</span>
   <span class="nx">description</span> <span class="p">=</span> <span class="s2">"fruit example"</span>
 <span class="p">}</span>  
</code></pre></div>        </div>

        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
      
 <span class="kd">var</span><span class="err">.</span><span class="nx">fruits_set</span>                                        <span class="c1"># =&gt; toset(["apple", "banana"]) </span>
 <span class="kd">var</span><span class="err">.</span><span class="nx">fruits_list</span>                                       <span class="c1"># =&gt; tolist(["apple", "banana"]) </span>
 <span class="kd">var</span><span class="err">.</span><span class="nx">fruits_map</span>                                        <span class="c1"># =&gt; tomap({"first" = "apple", "second" = "banana"})</span>
                                                            
 <span class="nx">type</span><span class="err">(</span><span class="kd">var</span><span class="err">.</span><span class="nx">fruits_set</span><span class="err">)</span>                                  <span class="c1"># =&gt; set(string)</span>
 <span class="nx">type</span><span class="err">(</span><span class="kd">var</span><span class="err">.</span><span class="nx">fruits_list</span><span class="err">)</span>                                 <span class="c1"># =&gt; list(string)</span>
 <span class="nx">type</span><span class="err">(</span><span class="kd">var</span><span class="err">.</span><span class="nx">fruits_map</span><span class="err">)</span>                                  <span class="c1"># =&gt; map(string)</span>
      
 <span class="c1"># for item in var.fruits_set: item                    # 오류 발생! []로 감싸야함 </span>
 <span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_set</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span>                    <span class="c1"># =&gt; ["apple", "banana"]</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_set</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span><span class="err">)</span>              <span class="c1"># =&gt; tuple([string, string])</span>
      
 <span class="c1"># {for item in var.fruits_set: item}                  # 오류 발생! {}로 감싸졌으나 결과 값이 key, value 형태가 아님</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_set</span><span class="err">:</span> <span class="nx">key</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">value</span><span class="p">}</span>       <span class="c1"># =&gt; { "apple" = "apple", "banana" = "banana" }</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">{</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_set</span><span class="err">:</span> <span class="nx">key</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">value</span><span class="p">}</span><span class="err">)</span> <span class="c1"># =&gt; object({apple: string, banana: string})</span>
      
 <span class="c1"># for item in var.fruits_list: item                   # 오류 발생! []로 감싸야함</span>
 <span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span>                   <span class="c1"># =&gt; ["apple", "banana"]</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span><span class="err">)</span>             <span class="c1"># =&gt; tuple([string, string])</span>
      
 <span class="c1"># {for item in var.fruits_list: item}                 # 오류 발생! {}로 감싸졌으나 결과 값이 key, value 형태가 아님</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">key</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">value</span><span class="p">}</span>      <span class="c1"># =&gt; { "0" = "apple", "1" = "banana" }</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">i</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">v</span><span class="p">}</span>                 <span class="c1"># =&gt; { "0" = "apple", "1" = "banana" }</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">{</span><span class="nx">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_list</span><span class="err">:</span> <span class="nx">i</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">v</span><span class="p">}</span><span class="err">)</span>           <span class="c1"># =&gt; object({0: string, 1: string})</span>
          
 <span class="c1"># for item in var.fruits_map: item                    # 오류 발생! []로 감싸야함</span>
 <span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span>                    <span class="c1"># =&gt; ["apple", "banana"]</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">[</span><span class="nx">for</span> <span class="nx">item</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">item</span><span class="p">]</span><span class="err">)</span>              <span class="c1"># =&gt; tuple([string, string])</span>
          
 <span class="c1"># {for item in var.fruits_map: item}                  # 오류 발생! {}로 감싸졌으나 결과 값이 key, value 형태가 아님</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">key</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">value</span><span class="p">}</span>       <span class="c1"># =&gt; { "first" = "apple", "second" = "banana" }</span>
 <span class="p">{</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">k</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">v</span><span class="p">}</span>                  <span class="c1"># =&gt; { "first" = "apple", "second" = "banana" }</span>
 <span class="nx">type</span><span class="err">(</span><span class="p">{</span><span class="nx">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="nx">in</span> <span class="kd">var</span><span class="p">.</span><span class="nx">fruits_map</span><span class="err">:</span> <span class="nx">k</span> <span class="p">=</span><span class="err">&gt;</span> <span class="nx">v</span><span class="p">}</span><span class="err">)</span>            <span class="c1"># =&gt; object({first: string, second: string}) </span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="dynamic">dynamic</h4>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">count</code>나 <code class="language-plaintext highlighter-rouge">for_each</code>를 사용하여 리소스 전체를 여러개 생성하는것 외에도 리소스 내부의 속성 블록을 동적으로 생성할 수 있습니다.</li>
  <li>예를 들어 archive 프로바이더의 <code class="language-plaintext highlighter-rouge">archive_file</code> 리소스의 <code class="language-plaintext highlighter-rouge">source</code> 속성에 여러 파일을 동적으로 지정할 수 있습니다.
    <ul>
      <li>dynamic을 사용하지 않았을 때
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">data</span> <span class="s2">"archive_file"</span> <span class="s2">"files"</span> <span class="p">{</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="s2">"zip"</span>
  <span class="nx">output_path</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/files.zip"</span>
    
  <span class="nx">source</span> <span class="p">{</span>
    <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"hello a"</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"a.txt"</span>
  <span class="p">}</span>
    
  <span class="nx">source</span> <span class="p">{</span>
    <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"hello b"</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"b.txt"</span>
  <span class="p">}</span>
    
  <span class="nx">source</span> <span class="p">{</span>
    <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"hello c"</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"c.txt"</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div>        </div>
        <ul>
          <li>실행 후 확인
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show data.archive_file.files

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"tolist(data.archive_file.files.source)[0].filename"</span> | terraform console
<span class="c"># =&gt; "a.txt"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"tolist(data.archive_file.files.source)[0].content"</span> | terraform console
<span class="c"># =&gt; "hello a"      </span>
<span class="nv">$ </span>unzip files.zip
<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.txt
<span class="c"># =&gt; a.txt b.txt c.txt</span>
<span class="nv">$ </span><span class="nb">cat </span>a.txt
<span class="c"># =&gt; hello a</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>dynamic을 사용했을 때
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"files"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">object</span><span class="p">({</span> <span class="nx">content</span>  <span class="p">=</span> <span class="nx">string</span> <span class="p">}))</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"a.txt"</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">content</span> <span class="p">=</span> <span class="s2">"hello a"</span> <span class="p">}</span>
    <span class="s2">"b.txt"</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">content</span> <span class="p">=</span> <span class="s2">"hello b"</span> <span class="p">}</span>
    <span class="s2">"c.txt"</span> <span class="p">=</span> <span class="p">{</span> <span class="nx">content</span> <span class="p">=</span> <span class="s2">"hello c"</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">data</span> <span class="s2">"archive_file"</span> <span class="s2">"files"</span> <span class="p">{</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="s2">"zip"</span>
  <span class="nx">output_path</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/files.zip"</span>
    
  <span class="nx">dynamic</span> <span class="s2">"source"</span> <span class="p">{</span>
    <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">files</span>
    
    <span class="nx">content</span> <span class="p">{</span>
      <span class="nx">filename</span> <span class="p">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">key</span>
      <span class="nx">content</span>  <span class="p">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">content</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>실행 후 확인
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show data.archive_file.files

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"tolist(data.archive_file.files.source)[0].filename"</span> | terraform console
<span class="c"># =&gt; "a.txt"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"tolist(data.archive_file.files.source)[0].content"</span> | terraform console
<span class="c"># =&gt; "hello a"      </span>
<span class="nv">$ </span>unzip files.zip
<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.txt
<span class="c"># =&gt; a.txt b.txt c.txt</span>
<span class="nv">$ </span><span class="nb">cat </span>a.txt
<span class="c"># =&gt; hello a</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>이와 같이 <code class="language-plaintext highlighter-rouge">dynamic</code>을 사용하면 반복되는 수가 많아져도 데이터만 바꾸면 되니 코드 중복을 줄일 수 있고, 유지보수가 용이해집니다.
    <ul>
      <li>또한 <code class="language-plaintext highlighter-rouge">dynamic</code>은 다음과 같이 <code class="language-plaintext highlighter-rouge">dynamic</code>안에 또 <code class="language-plaintext highlighter-rouge">dynamic</code>을 사용하여 중첩할 수 있어서 상당히 편리합니다.
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="err">...</span>
  <span class="nx">dynamic</span> <span class="s2">"origin_group"</span> <span class="p">{</span>
    <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">load_balancer_origin_groups</span>
    <span class="nx">content</span> <span class="p">{</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="nx">origin_group</span><span class="p">.</span><span class="nx">key</span>
  
      <span class="nx">dynamic</span> <span class="s2">"origin"</span> <span class="p">{</span>
        <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">origin_group</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">origins</span>
        <span class="nx">content</span> <span class="p">{</span>
          <span class="nx">hostname</span> <span class="p">=</span> <span class="nx">origin</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">hostname</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> 
  <span class="err">...</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h3 id="조건문-conditional-expression">조건문 (Conditional Expression)</h3>
<ul>
  <li>조건문은 테라폼에서는 다음과 같이 3항 연산자 형태로 사용할 수 있습니다.
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="err">&lt;</span><span class="nx">condition</span><span class="err">&gt;</span> <span class="err">?</span> <span class="err">&lt;</span><span class="nx">condition</span><span class="err">이</span> <span class="err">참일때</span> <span class="err">값&gt;</span> <span class="err">:</span> <span class="err">&lt;</span><span class="nx">condition</span><span class="err">이</span> <span class="err">거짓일때</span> <span class="err">값&gt;</span>
</code></pre></div>    </div>
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">?</code>를 기준으로 좌측에는 조건이며, 우측에는 <code class="language-plaintext highlighter-rouge">:</code> 기호룰 기준으로 좌측은 조건에 대해 참일 때의 값, 우측은 거짓일 때의 값을 나타냅니다.</li>
      <li>즉 <code class="language-plaintext highlighter-rouge">?</code> 좌측의 조건이 참일때는 <code class="language-plaintext highlighter-rouge">:</code> 앞의 참 값을, 거짓 일때는 <code class="language-plaintext highlighter-rouge">:</code> 뒤의 거짓 값을 반환합니다.</li>
      <li>다음의 예에서 var.a 가 빈 문자열이 아니면 var.a를, 빈 문자열이면 “default”를 반환합니다.
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">!=</span> <span class="s2">""</span> <span class="err">?</span> <span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">:</span> <span class="s2">"default"</span>
<span class="err">...</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>실습
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
  
<span class="err">&gt;</span> <span class="mi">1</span> <span class="err">==</span> <span class="mi">1</span> <span class="err">?</span> <span class="s2">"1과 1은 같다"</span> <span class="err">:</span> <span class="s2">"1과 1은 다르다"</span>
<span class="c1"># =&gt; "1과 1은 같다" </span>

<span class="err">&gt;</span> <span class="mi">1</span> <span class="err">==</span> <span class="mi">2</span> <span class="err">?</span> <span class="s2">"1과 2는 같다"</span> <span class="err">:</span> <span class="s2">"1과 2는 다르다"</span>
<span class="c1"># =&gt; "1과 2는 다르다"</span>
</code></pre></div>    </div>
  </li>
  <li>조건이 참일때의 값과 거짓일때의 값의 타입이 다를 경우, 테라폼은 자동으로 문자열 타입으로 변환하여 반환합니다.
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>

<span class="err">&gt;</span> <span class="mi">3</span> <span class="err">==</span> <span class="mi">4</span> <span class="err">?</span> <span class="mi">3</span> <span class="err">:</span> <span class="mi">4</span>
<span class="c1"># =&gt; 4</span>
  
<span class="err">&gt;</span> <span class="mi">1</span> <span class="err">==</span> <span class="mi">1</span> <span class="err">?</span> <span class="mi">1</span> <span class="err">:</span> <span class="s2">"two"</span>
<span class="c1"># =&gt; "1"</span>
  
<span class="err">&gt;</span> <span class="mi">1</span> <span class="err">==</span> <span class="mi">2</span> <span class="err">?</span> <span class="mi">1</span> <span class="err">:</span> <span class="s2">"two"</span>
<span class="c1"># =&gt; "two"</span>
</code></pre></div>    </div>
    <p>위의 예제와 같이 1 == 1 일때 값이 숫자 1이지만 문자열 “1”을 반환함을 확인할 수 있습니다.</p>
  </li>
  <li>가능하면 명시적으로 타입을 지정하여 사용하는 것이 좋습니다.
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
  
<span class="err">&gt;</span> <span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">?</span> <span class="mi">1</span> <span class="err">:</span> <span class="s2">"two"</span>            <span class="c1"># 비권장</span>
<span class="err">&gt;</span> <span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">?</span> <span class="s2">"1"</span> <span class="err">:</span> <span class="s2">"two"</span>          <span class="c1"># 권장</span>
<span class="err">&gt;</span> <span class="kd">var</span><span class="err">.</span><span class="nx">a</span> <span class="err">?</span> <span class="nx">tostring</span><span class="err">(</span><span class="mi">1</span><span class="err">)</span> <span class="err">:</span> <span class="s2">"two"</span>  <span class="c1"># 권장</span>
</code></pre></div>    </div>
  </li>
  <li>조건문을 사용하여 리소스 생성 여부를 결정할 수 있습니다.
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">variable</span> <span class="s2">"enable"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"abc"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">enable</span> <span class="err">?</span> <span class="mi">1</span> <span class="err">:</span> <span class="mi">0</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/abc.txt"</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"content abc"</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <ul>
      <li>실행 결과
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; local_file.abc[0]</span>
<span class="nv">$ </span><span class="nb">cat </span>abc.txt
<span class="c"># =&gt; content abc</span>
    
<span class="c"># 변수의 default 보다 우선순위가 높은 환경변수를 통해 enable 변수를 false로 변경</span>
    
<span class="nv">$ </span><span class="nb">export </span><span class="nv">TF_VAR_enable</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; 없음</span>
<span class="nv">$ </span><span class="nb">cat </span>abc.txt
<span class="c"># =&gt; cat: abc.txt: No such file or directory </span>
</code></pre></div>        </div>
        <p>위와 같이 var.enable 변수 값에 따라 true 일때는 파일이 생성되고, false 일때는 파일이 생성되지 않음을 확인할 수 있습니다.</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="함수-function">함수 (Function)</h3>

<ul>
  <li>테라폼에서는 프로그래밍 언어 처럼 값의 유형을 변경하거나 가공할 수 있는 다양한 내장 함수를 제공합니다.</li>
  <li>전체 함수 목록은 <a href="https://www.terraform.io/docs/language/functions/index.html">공식문서</a>에서 확인할 수 있습니다.</li>
  <li>사용자 정의 함수는 지원하지 않으며, 숫자, 문자열, 컬렉션, 인코딩, 날짜, 파일, 네트워크 등 다양한 함수를 제공합니다.</li>
  <li>실습
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="k">terraform</span> <span class="nx">console</span>
  
<span class="err">&gt;</span> <span class="nx">upper</span><span class="err">(</span><span class="s2">"hello"</span><span class="err">)</span>                          <span class="c1"># =&gt; "HELLO"</span>
<span class="err">&gt;</span> <span class="nx">title</span><span class="err">(</span><span class="s2">"hello world"</span><span class="err">)</span>                    <span class="c1"># =&gt; "Hello World"</span>
<span class="err">&gt;</span> <span class="nx">max</span><span class="err">(</span><span class="mi">1</span><span class="err">,</span> <span class="mi">20</span><span class="err">,</span> <span class="mi">3</span><span class="err">,</span> <span class="mi">40</span><span class="err">,</span> <span class="mi">5</span><span class="err">)</span>                    <span class="c1"># =&gt; 40</span>
<span class="err">&gt;</span> <span class="nx">cidrnetmask</span><span class="err">(</span><span class="s2">"172.16.0.0/12"</span><span class="err">)</span>            <span class="c1"># =&gt; "255.240.0.0"</span>
<span class="err">&gt;</span> <span class="nx">cidrsubnet</span><span class="err">(</span><span class="s2">"1.1.1.0/24"</span><span class="err">,</span> <span class="mi">1</span><span class="err">,</span> <span class="mi">0</span><span class="err">)</span>          <span class="c1"># =&gt; "1.1.1.0/25"</span>
<span class="err">&gt;</span> <span class="nx">cidrsubnet</span><span class="err">(</span><span class="s2">"1.1.1.0/24"</span><span class="err">,</span> <span class="mi">1</span><span class="err">,</span> <span class="mi">1</span><span class="err">)</span>          <span class="c1"># =&gt; "1.1.1.128/25"</span>
<span class="err">&gt;</span> <span class="nx">cidrsubnets</span><span class="err">(</span><span class="s2">"10.1.0.0/16"</span><span class="err">,</span> <span class="mi">4</span><span class="err">,</span> <span class="mi">4</span><span class="err">,</span> <span class="mi">8</span><span class="err">,</span> <span class="mi">4</span><span class="err">)</span>  <span class="c1"># =&gt; tolist([</span>
                                          <span class="c1">#      "10.1.0.0/20",</span>
                                          <span class="c1">#      "10.1.16.0/20",</span>
                                          <span class="c1">#      "10.1.32.0/24",</span>
                                          <span class="c1">#      "10.1.48.0/20",</span>
                                          <span class="c1">#    ])  </span>
<span class="err">&gt;</span> <span class="nx">timestamp</span><span class="err">()</span>                             <span class="c1"># =&gt; "2024-06-27T14:00:00Z"</span>
<span class="err">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nx">title</span><span class="p">(</span><span class="s2">"hello world again"</span><span class="p">)</span><span class="k">}</span><span class="s2">!!"</span>       <span class="c1"># =&gt; "Hello World Again!!"</span>
  
<span class="err">&gt;</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">a</span> <span class="nx">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="err">:</span> <span class="nx">cidrsubnet</span><span class="p">(</span><span class="s2">"1.1.1.0/24"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">a</span><span class="p">)]</span>  <span class="c1"># =&gt; [</span>
                                                         <span class="c1">#      "1.1.1.0/26",</span>
                                                         <span class="c1">#      "1.1.1.64/26",</span>
                                                         <span class="c1">#      "1.1.1.128/26",</span>
                                                         <span class="c1">#      "1.1.1.192/26",</span>
                                                         <span class="c1">#    ]</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="프로비저너-provisioner">프로비저너 (provisioner)</h3>
<ul>
  <li>프로비저너는 리소스가 생성된 후에 리소스에 대한 추가적인 설정이나 초기화 작업을 수행하는 기능입니다.</li>
  <li>프로바이더로 실행되지 않는 명령어 실행과 파일 복사 같은 역할을 수행할 수 있습니다.</li>
  <li>단, 프로비저너를 통한 작업은 <strong>상태(state)가 관리 되지 않으며</strong>, <strong>프로비저닝에 대한 결과가 항상 같다고 보장할 수 없기에</strong>
다른 방안이 없을때 최후의 수단으로만 사용해야 합니다.
    <ul>
      <li>프로비저너의 대안
        <ul>
          <li>AWS EC2의 경우 테라폼 코드 <code class="language-plaintext highlighter-rouge">user_data</code> 사용
            <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="err">...</span>
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"..."</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
      
  <span class="nx">user_data</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
  #!/bin/bash
  echo "Hello, World" &gt; index.html
  nohup busybox httpd -f -p 8080 &amp;
</span><span class="no">  EOF
</span><span class="p">}</span>   
</code></pre></div>            </div>
          </li>
          <li>
<a href="https://developer.hashicorp.com/terraform/tutorials/provision/cloud-init">cloud-init</a>,
<a href="https://developer.hashicorp.com/terraform/tutorials/provision/packer">packer</a>,
<a href="https://developer.hashicorp.com/terraform/language/resources/provisioners/connection">provisioner connections</a> 등을 사용</li>
          <li>별도의 설정 관리툴 사용 (Ansible, Chef, Puppet 등)</li>
        </ul>
      </li>
      <li>이전에는 <code class="language-plaintext highlighter-rouge">local-exec</code> 프로비저너를 통해서 ansible과 연동하여 인프라 프로비저닝 후 구성을 관리하였으나, 
최근에는 이를 개선하여 <a href="https://registry.terraform.io/providers/ansible/ansible/latest/docs">terraform-provider-ansible</a>을 사용합니다.</li>
    </ul>
  </li>
</ul>

<h4 id="local-exec-프로비저너">local-exec 프로비저너</h4>
<ul>
  <li>테라폼이 실행되는 로컬에서 실행되는 명령어를 실행할 수 있습니다.</li>
  <li>리눅스나 윈도우 등 실행 환경에 맞게 커맨드를 정의해야 하며, 다음의 인수 값을 사용합니다.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">command</code> (필수) : 실행할 명령어를 정의합니다. «EOF를 사용하여 여러줄로 정의할 수 있습니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">working_dir</code> (선택) : 명령어를 실행할 디렉토리를 지정합니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">interpreter</code> (선택) : 배열로 명령어를 실행할 인터프리터를 지정합니다. 첫번째 인수는 인터프리터 명령어 이름이고, 두번째 부터는 인수 값입니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">environment</code> (선택) : 실행시의 환경 변수에 추가적인 환경 변수를 설정합니다. key = value 형태로 정의합니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">on_failure</code> (선택) : 명령어 실행이 실패했을 때 실행할 명령어를 정의합니다.</li>
    </ul>
  </li>
  <li>예시
    <ul>
      <li>Unix/Linux/macOS
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="k">provisioner</span> <span class="s2">"local-exec"</span> <span class="p">{</span>
    <span class="nx">command</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
      echo "Hello, World $FOO"
</span><span class="no">      EOF
</span>    <span class="nx">interpreter</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"bash"</span><span class="p">,</span> <span class="s2">"-c"</span><span class="p">]</span>
    <span class="nx">working_dir</span> <span class="p">=</span> <span class="s2">"/tmp"</span>
    <span class="nx">environment</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">FOO</span> <span class="p">=</span> <span class="s2">"bar"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>실행결과
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    null_resource.example: Provisioning with 'local-exec'...</span>
<span class="c">#    null_resource.example (local-exec): Executing: ["bash" "-c" "          echo \"Hello, World $FOO\"\n"]</span>
<span class="c">#    null_resource.example (local-exec): Hello, World bar</span>
      
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show null_resource.example
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate 
</code></pre></div>            </div>
            <p>명령이 실행은 되나 상태 파일에는 프로비저닝에 대한 정보가 저장되지 않음을 확안 할 수 있습니다.</p>
          </li>
        </ul>
      </li>
      <li>Windows
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="k">provisioner</span> <span class="s2">"local-exec"</span> <span class="p">{</span>
    <span class="nx">command</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
      echo "Hello, World %FOO%"
</span><span class="no">      EOF
</span>    <span class="nx">interpreter</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"PowerShell"</span><span class="p">,</span> <span class="s2">"-Command"</span><span class="p">]</span>
    <span class="nx">working_dir</span> <span class="p">=</span> <span class="s2">"C:</span><span class="se">\\</span><span class="s2">windows</span><span class="se">\\</span><span class="s2">temp"</span>
    <span class="nx">environment</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">FOO</span> <span class="p">=</span> <span class="s2">"bar"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="원격지-연결">원격지 연결</h4>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">remote-exec</code>와 <code class="language-plaintext highlighter-rouge">file</code> 프로비저너를 사용하여 원격지 서버에 명령어를 실행하거나 파일을 복사하려면 원격지 연결할 SSH 또는 WinRM (windows 서버의 경우) 연결 정의가 필요합니다.
    <ul>
      <li><a href="https://developer.hashicorp.com/terraform/language/resources/provisioners/connection">참조 문서 링크</a></li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">connection</code> 블록은 리소스 내에서 선언시 해당 블록 내의 프로비저너에서 공통으로 사용가능하며, 프로비저너 내에서 선언 되는 경우 해당 프로비저너에서만 사용 가능합니다.
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="c1"># connection 블록으로 원격지 연결 정의</span>
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"example1"</span> <span class="p">{</span>
    
  <span class="nx">connection</span> <span class="p">{</span>
    <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"ssh"</span>
    <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"root"</span>
    <span class="nx">password</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">root_password</span>
    <span class="nx">host</span>     <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">host</span>
  <span class="p">}</span>
    
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"conf/myapp.conf"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/etc/myapp.conf"</span>
  <span class="p">}</span>
    
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"conf/myapp.conf"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"C:/App/myapp.conf"</span>
      
    <span class="nx">connection</span> <span class="p">{</span>
        <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"winrm"</span>
        <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"Administrator"</span>
        <span class="nx">password</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">admin_password</span>
        <span class="nx">host</span>     <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">host</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>   
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">connection</code> 적용 인수와 설명</p>

    <table>
      <thead>
        <tr>
          <th>인수</th>
          <th>연결 타입</th>
          <th>설명</th>
          <th>기본값</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>type</td>
          <td>SSH/WinRM</td>
          <td>연결 유형으로 ssh 또는 winrm</td>
          <td>ssh</td>
        </tr>
        <tr>
          <td>user</td>
          <td>SSH/WinRM</td>
          <td>연결에 사용되는 사용자</td>
          <td>ssh: root, winrm: Administrator</td>
        </tr>
        <tr>
          <td>password</td>
          <td>SSH/WinRM</td>
          <td>연결에 사용되는 비밀번호</td>
          <td> </td>
        </tr>
        <tr>
          <td>host</td>
          <td>SSH/WinRM</td>
          <td>(필수) 연결 대상 주소</td>
          <td> </td>
        </tr>
        <tr>
          <td>port</td>
          <td>SSH/WinRM</td>
          <td>연결 대상의 타입별 사용 포트</td>
          <td>ssh: 22, winrm: 5985</td>
        </tr>
        <tr>
          <td>timeout</td>
          <td>SSH/WinRM</td>
          <td>연결 시도에 대한 대기 값</td>
          <td>5m</td>
        </tr>
        <tr>
          <td>script_path</td>
          <td>SSH/WinRM</td>
          <td>스크립트 복제 시 생성되는 경로</td>
          <td> </td>
        </tr>
        <tr>
          <td>private_key</td>
          <td>SSH</td>
          <td>연결 시 사용할 SSH key를 지정하며, password 인수보다 우선함</td>
          <td> </td>
        </tr>
        <tr>
          <td>certificate</td>
          <td>SSH</td>
          <td>서명된 CA 인증서로 사용 시 private_key와 함께 사용</td>
          <td> </td>
        </tr>
        <tr>
          <td>agent</td>
          <td>SSH</td>
          <td>ssh-agent를 사용해 인증하지 않는 경 우 false로 설정하며 Windows의 경우 Pageant만 사용 가능</td>
          <td> </td>
        </tr>
        <tr>
          <td>agent_identity</td>
          <td>SSH</td>
          <td>인증을 위한 ssh-agent의 기본 사용자</td>
          <td> </td>
        </tr>
        <tr>
          <td>host_key</td>
          <td>SSH</td>
          <td>원격 호스트 또는 서명된 CA의 연결을 확인 하는 데 사용되는 공개키</td>
          <td> </td>
        </tr>
        <tr>
          <td>target_platform</td>
          <td>SSH</td>
          <td>연결 대상 플랫폼으로 windows 또는 unix</td>
          <td>unix</td>
        </tr>
        <tr>
          <td>https</td>
          <td>WinRM</td>
          <td>true인 경우 HTTPS로 연결</td>
          <td>false</td>
        </tr>
        <tr>
          <td>insecure</td>
          <td>WinRM</td>
          <td>true인 경우 HTTPS 유효성 무시</td>
          <td>false</td>
        </tr>
        <tr>
          <td>use_ntlm</td>
          <td>WinRM</td>
          <td>true인 경우 NTLM 인증을 사용</td>
          <td>false</td>
        </tr>
        <tr>
          <td>cacert</td>
          <td>WinRM</td>
          <td>유효성 검증을 위한 CA 인증서</td>
          <td> </td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>원격연결이 요구되는 프로비저너의 경우 스크립트 파일을 원격 시스템에 업로드하여 해당 시스템의 기본 쉘에서 실행하도록 하므로 
<code class="language-plaintext highlighter-rouge">script_path</code>에 적절한 위치를 지정해야 합니다. 경로는 난수인 %RAND% 경로가 포함되어 생성됩니다.
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>Unix/Linux/macOS : /tmp/terraform_%RAND%.sh
Windows(cmd) : C:/windows/temp/terraform_%RAND%.cmd
Windows(PowerShell) : C:/windows/temp/terraform_%RAND%.ps1
</code></pre></div>    </div>
  </li>
  <li>
    <p>베스천 호스트를 통한 연결의 경우 관련 인수를 제공합니다. <a href="https://developer.hashicorp.com/terraform/language/resources/provisioners/connection#connecting-through-a-bastion-host-with-ssh">참고자료 링크</a></p>

    <table>
      <thead>
        <tr>
          <th>인수</th>
          <th>설명</th>
          <th>기본값</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>bastion_host</td>
          <td>설정하게 되면 배스천 호스트 연결이 활성화되며, 연결 대상 호스트를 지정</td>
          <td> </td>
        </tr>
        <tr>
          <td>bastion_host_key</td>
          <td>호스트 연결을 위한 공개키</td>
          <td> </td>
        </tr>
        <tr>
          <td>bastion_port</td>
          <td>배스천 호스트에 연결할 포트</td>
          <td>port 인수 값</td>
        </tr>
        <tr>
          <td>bastion_user</td>
          <td>배스천 호스트에 연결할 사용자</td>
          <td>user 인수 값</td>
        </tr>
        <tr>
          <td>bastion_password</td>
          <td>배스천 호스트 연결에 사용할 비밀번호</td>
          <td>password 인수 값</td>
        </tr>
        <tr>
          <td>bastion_private key</td>
          <td>배스천 호스트 연결에 사용할 SSH 키파일</td>
          <td>private key 인수 값</td>
        </tr>
        <tr>
          <td>bastion_certificate</td>
          <td>서명된 CA 인증서 내용으로 bastion_private_key와 함께 사용</td>
          <td> </td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<h4 id="file-프로비저너">file 프로비저너</h4>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">file</code> 프로비저너는 로컬 파일이나 디렉터리를 원격지 서버로 복사하는 기능을 제공합니다.</li>
  <li>사용되는 인수
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">source</code> (선택) : 로컬 파일 또는 디렉터리의 경로를 지정하며 <strong>상대 경로 또는 절대 경로</strong>로 지정할 수 있습니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">content</code> (선택) : 파일의 내용을 직접 지정할 수 있으며, <code class="language-plaintext highlighter-rouge">source</code>와 <code class="language-plaintext highlighter-rouge">content</code> 중 하나만 사용할 수 있습니다. 대상이 디렉터리인 경우 tf-file-content 파일로 생성되고, 대상이 파일인 경우 해당 파일에 내용이 기록됩니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">destination</code> (필수) : 원격지 서버에 복사될 파일 또는 디렉터리의 경로를 지정합니다. 항상 <strong>절대 경로</strong>를 지정해야 합니다.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">destination</code> 지정시 주의할 점은 ssh 연결의 경우 디렉터리가 존재해야 하며, WinRM 연결의 경우 디렉터리가 존재하지 않으면 자동으로 생성합니다.</li>
  <li>또한 디렉터리를 대상으로 할 경우 <code class="language-plaintext highlighter-rouge">source</code> 경로에 따라 파일 또는 디렉터리로 복사됩니다.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">destination</code>이 /tmp 일 때 <code class="language-plaintext highlighter-rouge">source</code>가 디렉터리로 <code class="language-plaintext highlighter-rouge">/foo</code> 처럼 마지막에 <code class="language-plaintext highlighter-rouge">/</code> 가 없는 경우 대상 디렉터리에 지정된 디렉터리가 업로드 되어 /tmp/foo 형태로 업로드 됩니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">destination</code>이 /tmp 일 때 <code class="language-plaintext highlighter-rouge">source</code>가 디렉터리로 <code class="language-plaintext highlighter-rouge">/foo/</code> 처럼 마지막에 <code class="language-plaintext highlighter-rouge">/</code> 가 있는 경우 대상 디렉터리에 지정된 디렉터리가 업로드 되어 /tmp/foo 형태로 업로드 됩니다.</li>
    </ul>
  </li>
  <li>예제
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"foo"</span> <span class="p">{</span>    
  <span class="c1"># connection 블록으로 원격지 정의</span>
  <span class="nx">connection</span> <span class="p">{</span>
    <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"ssh"</span>
    <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"root"</span>
    <span class="nx">password</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">root_password</span>
    <span class="nx">host</span>     <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">host</span>
  <span class="p">}</span>
  
  <span class="c1"># myapp.conf 파일이 /etc/myapp.conf 로 업로드</span>
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"conf/myapp.conf"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/etc/myapp.conf"</span>
  <span class="p">}</span>
    
  <span class="c1"># content의 내용이 /tmp/file.log 파일로 생성</span>
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">content</span>     <span class="p">=</span> <span class="s2">"ami used: ami"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/tmp/file.log"</span>
  <span class="p">}</span>
    
  <span class="c1"># configs.d 디렉터리가 /etc/configs.d 로 업로드</span>
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"conf/configs.d"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/etc"</span>
  <span class="p">}</span>
    
  <span class="c1"># apps/app1 디렉터리 내의 파일들만 D:/IIS/webapp1 디렉터리 내에 업로드</span>
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"apps/app1/"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"D:/IIS/webapp1"</span>
  <span class="p">}</span>
<span class="p">}</span>  
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="remote_exec-프로비저너">remote_exec 프로비저너</h4>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">remote-exec</code> 프로비저너는 원격지 서버에 명령어를 실행하는 기능을 제공합니다. 예를들어 AWS의 EC2 인스턴스를 생성하고 해당 VM에서 명령을 실행할 때 사용합니다.</li>
  <li>사용하는 인수는 다음과 같고, 상호 배타적으로 하나만 사용 가능합니다.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">inline</code> : 명령어에 대한 목록으로 [ ] 블록 내에 “ “ 로 묶인 다수의 명령을 , 로 구분하여 지정합니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">script</code> : 실행할 스크립트 파일의 경로를 지정합니다. 스크립트 파일은 로컬 파일로 지정하며, 원격지 서버로 복사되어 실행됩니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">scripts</code> : 실행할 스크립트 파일의 목록으로 [ ] 블록 내에 “ “ 로 묶인 다수의 파일을 , 로 구분하여 지정합니다. 마찬가지로 로컬 파일로 지정하며, 원격지 서버로 복사되어 실행됩니다.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">script</code>나 <code class="language-plaintext highlighter-rouge">scripts</code>는 인수를 지정할 수 없으므로, 인수가 필요한 경우 <code class="language-plaintext highlighter-rouge">file</code> 프로바이더로 스크립트를 업로드하고 <code class="language-plaintext highlighter-rouge">inline</code> 인수로 스크립트에 인수를 추가하여 실행합니다.</li>
  <li>예제
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="c1"># ...</span>
  
  <span class="c1"># Establishes connection to be used by all</span>
  <span class="c1"># generic remote provisioners (i.e. file/remote-exec)</span>
  <span class="nx">connection</span> <span class="p">{</span>
    <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"ssh"</span>
    <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"root"</span>
    <span class="nx">password</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">root_password</span>
    <span class="nx">host</span>     <span class="p">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="p">}</span>
  
  <span class="k">provisioner</span> <span class="s2">"file"</span> <span class="p">{</span>
    <span class="nx">source</span>      <span class="p">=</span> <span class="s2">"script.sh"</span>
    <span class="nx">destination</span> <span class="p">=</span> <span class="s2">"/tmp/script.sh"</span>
  <span class="p">}</span>
  
  <span class="k">provisioner</span> <span class="s2">"remote-exec"</span> <span class="p">{</span>
    <span class="nx">inline</span> <span class="p">=</span> <span class="p">[</span>
      <span class="s2">"chmod +x /tmp/script.sh"</span><span class="p">,</span>
      <span class="s2">"/tmp/script.sh args"</span><span class="p">,</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="null_resource와-terraform_data">null_resource와 terraform_data</h3>
<h4 id="null_resource">null_resource</h4>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">null_resource</code> 블록은 자체적으로는 아무것도 수행하지 않는 리소스를 생성할 때 사용합니다.
    <ul>
      <li>이런 리소스가 필요한 이유는 사용자가 의도적으로 프로비저닝 동작을 조율해야 하는 상황에서, 프로바이더가 제공하는 리소스 수명주기관리만으로는 해결하기 어려울 때 사용합니다.</li>
      <li>주로 사용되는 시나리오는 다음과 같습니다.
        <ul>
          <li>프로비저닝 수행 과정에서 명령어 실행</li>
          <li>프로비저너와 함께 사용</li>
          <li>모듈, 반복문, 데이터 소스, 로컬 변수와 함께 사용</li>
          <li>출력을 위한 데이터 가공</li>
        </ul>
      </li>
      <li>예제
        <ul>
          <li>다음 상황을 가정
            <ul>
              <li>AWS EC2 인스턴스를 프로비저닝하면서 웹서비스를 실행시키고 싶다.</li>
              <li>웹서비스 설정에는 노출되어야 하는 고정된 외부 IP가 포함된 구성이 필요하다. 따라서 aws_eip 리소스를 생성해야 한다.</li>
            </ul>
          </li>
          <li>AWS EC2 인스턴스를 프로비저닝하기 위해 aws_instance 리소스 구성 시 앞서 확인한 프로비저너를 활용하여 웹서비스를 실행하고자 한다</li>
          <li>1차 시도
            <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
      
<span class="k">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"instance"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"t101sg"</span>
      
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
      
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
      
<span class="p">}</span>
      
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="s2">"ami-0c9c942bd7bf113a2"</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">subnet_id</span>              <span class="p">=</span> <span class="s2">"subnet-dbc571b0"</span>  <span class="c1"># 각자 default VPC에 subnet ID 아무거나</span>
  <span class="nx">private_ip</span>             <span class="p">=</span> <span class="s2">"172.31.1.100"</span>
  <span class="nx">vpc_security_group_ids</span> <span class="p">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
      
  <span class="nx">user_data</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
              #!/bin/bash
              echo "Hello, T101 Study" &gt; index.html
              nohup busybox httpd -f -p 80 &amp;
</span><span class="no">              EOF
      
</span>  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"Single-WebSrv"</span>
  <span class="p">}</span>
      
  <span class="k">provisioner</span> <span class="s2">"remote-exec"</span> <span class="p">{</span>
    <span class="nx">inline</span> <span class="p">=</span> <span class="p">[</span>
      <span class="s2">"echo </span><span class="k">${</span><span class="nx">aws_eip</span><span class="p">.</span><span class="nx">myeip</span><span class="p">.</span><span class="nx">public_ip</span><span class="k">}</span><span class="s2">"</span>
     <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
      
<span class="k">resource</span> <span class="s2">"aws_eip"</span> <span class="s2">"myeip"</span> <span class="p">{</span>
  <span class="c1">#vpc = true</span>
  <span class="nx">instance</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">associate_with_private_ip</span> <span class="p">=</span> <span class="s2">"172.31.1.100"</span>
<span class="p">}</span>
      
<span class="k">output</span> <span class="s2">"public_ip"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The public IP of the Instance"</span>
<span class="p">}</span>      
</code></pre></div>            </div>
            <ul>
              <li>aws_eip가 생성되는 고정된 IP를 할당하기 위해서는 대상인 aws_instance의 id값이 필요합니다.</li>
              <li>aws_instance의 프로비저너 동작에서는 aws_eip가 생성하는 속성 값인 public_ip가 필요합니다.</li>
              <li>apply시 aws_eip와 aws_instance가 서로를 참조하여 순환 참조 오류가 발생합니다.
                <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="nv">$ </span>terraform plan 
<span class="c"># =&gt; Error: Cycle: aws_eip.myeip, aws_instance.example</span>
</code></pre></div>                </div>
              </li>
            </ul>
          </li>
          <li>2차 시도
            <ul>
              <li>둘중의 하나의 실행 시점을 뒤로 미뤄야 합니다.</li>
              <li>이럴때 null_resource를 사용하여 둘 중 하나의 리소스를 뒤로 미뤄 순환 참조를 막을 수 있습니다.
                <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
        
<span class="k">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"instance"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">peter_vpc</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"t101sg"</span>
        
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
        
  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">22</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>
        
<span class="p">}</span>
        
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>                    <span class="p">=</span> <span class="s2">"ami-0c9c942bd7bf113a2"</span>
  <span class="nx">instance_type</span>          <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">subnet_id</span>              <span class="p">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">peter_subnet</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">private_ip</span>             <span class="p">=</span> <span class="s2">"172.31.0.100"</span>
  <span class="nx">key_name</span>               <span class="p">=</span> <span class="s2">"aws-ec2"</span> <span class="c1"># 각자 자신의 EC2 SSH Keypair 이름 지정</span>
  <span class="nx">vpc_security_group_ids</span> <span class="p">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
        
  <span class="nx">user_data</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
              #!/bin/bash
              echo "Hello, T101 4th Study" &gt; index.html
              nohup busybox httpd -f -p 80 &amp;
</span><span class="no">              EOF
        
</span>  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"Single-WebSrv"</span>
  <span class="p">}</span>
        
<span class="p">}</span>
        
<span class="k">resource</span> <span class="s2">"aws_eip"</span> <span class="s2">"myeip"</span> <span class="p">{</span>
  <span class="c1">#vpc = true</span>
  <span class="nx">instance</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">associate_with_private_ip</span> <span class="p">=</span> <span class="s2">"172.31.0.100"</span>
<span class="p">}</span>
        
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"echomyeip"</span> <span class="p">{</span>
  <span class="k">provisioner</span> <span class="s2">"remote-exec"</span> <span class="p">{</span>
    <span class="nx">connection</span> <span class="p">{</span>
      <span class="nx">host</span> <span class="p">=</span> <span class="nx">aws_eip</span><span class="p">.</span><span class="nx">myeip</span><span class="p">.</span><span class="nx">public_ip</span>
      <span class="nx">type</span> <span class="p">=</span> <span class="s2">"ssh"</span>
      <span class="nx">user</span> <span class="p">=</span> <span class="s2">"ubuntu"</span>
      <span class="nx">private_key</span> <span class="p">=</span>  <span class="nx">file</span><span class="p">(</span><span class="s2">"/Users/admin/.ssh/aws-ec2-key.cer"</span><span class="p">)</span> <span class="c1"># 각자 자신의 EC2 SSH Keypair 파일 위치 지정</span>
      <span class="c1">#password = "qwe123"</span>
    <span class="p">}</span>
    <span class="nx">inline</span> <span class="p">=</span> <span class="p">[</span>
      <span class="s2">"echo </span><span class="k">${</span><span class="nx">aws_eip</span><span class="p">.</span><span class="nx">myeip</span><span class="p">.</span><span class="nx">public_ip</span><span class="k">}</span><span class="s2">;"</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
        
<span class="k">output</span> <span class="s2">"public_ip"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The public IP of the Instance"</span>
<span class="p">}</span>
        
<span class="k">output</span> <span class="s2">"eip"</span> <span class="p">{</span>
  <span class="nx">value</span>       <span class="p">=</span> <span class="nx">aws_eip</span><span class="p">.</span><span class="nx">myeip</span><span class="p">.</span><span class="nx">public_ip</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"The EIP of the Instance"</span>
<span class="p">}</span>
</code></pre></div>                </div>
              </li>
              <li>위와 같이 null_resource를 사용하여 aws_eip 리소스를 뒤로 미루고, aws_instance 리소스가 먼저 생성되도록 하여 순환 참조 오류를 해결할 수 있습니다.</li>
              <li>실행 결과
                <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Outputs:</span>
<span class="c">#    </span>
<span class="c">#    eip = "43.202.208.93"</span>
<span class="c">#    public_ip = "43.202.208.93"</span>
        
<span class="nv">$ </span>terraform state list

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_eip.myeip.private_ip"</span> | terraform console
<span class="c"># =&gt; "172.31.0.100"</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_eip.myeip.public_ip"</span> | terraform console
<span class="c"># =&gt; "43.202.208.93"</span>

<span class="nv">$ </span>terraform output
<span class="c"># =&gt; eip = "43.202.208.93"</span>
<span class="c">#    public_ip = "43.202.208.93" </span>
        
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div>                </div>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<svg width="1076pt" height="206pt" viewbox="0.00 0.00 1075.75 206.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 202)">
<polygon fill="white" stroke="none" points="-4,4 -4,-202 1071.75,-202 1071.75,4 -4,4"></polygon>
<!-- aws_eip.myeip -->
<g id="node1" class="node">
<polygon fill="none" stroke="black" points="865,-36 759,-36 759,0 865,0 865,-36"></polygon>
<text text-anchor="middle" x="812" y="-12.2" font-family="sans-serif" font-size="14.00">aws_eip.myeip</text>
</g>
<!-- aws_instance.example -->
<g id="node2" class="node">
<polygon fill="none" stroke="black" points="645.75,-36 492.5,-36 492.5,0 645.75,0 645.75,-36"></polygon>
<text text-anchor="middle" x="569.12" y="-12.2" font-family="sans-serif" font-size="14.00">aws_instance.example</text>
</g>
<!-- aws_eip.myeip&#45;&gt;aws_instance.example -->
<g id="edge1" class="edge">
<path fill="none" stroke="black" d="M758.73,-18C729.15,-18 691.38,-18 657.42,-18"></path>
<polygon fill="black" stroke="black" points="657.58,-14.5 647.58,-18 657.58,-21.5 657.58,-14.5"></polygon>
</g>
<!-- aws_security_group.instance -->
<g id="node7" class="node">
<polygon fill="none" stroke="black" points="368.38,-36 178.38,-36 178.38,0 368.38,0 368.38,-36"></polygon>
<text text-anchor="middle" x="273.38" y="-12.2" font-family="sans-serif" font-size="14.00">aws_security_group.instance</text>
</g>
<!-- aws_instance.example&#45;&gt;aws_security_group.instance -->
<g id="edge2" class="edge">
<path fill="none" stroke="black" d="M492.1,-18C457.97,-18 417.14,-18 380.1,-18"></path>
<polygon fill="black" stroke="black" points="380.26,-14.5 370.26,-18 380.26,-21.5 380.26,-14.5"></polygon>
</g>
<!-- aws_subnet.peter_subnet -->
<g id="node8" class="node">
<polygon fill="none" stroke="black" points="358.62,-90 188.12,-90 188.12,-54 358.62,-54 358.62,-90"></polygon>
<text text-anchor="middle" x="273.38" y="-66.2" font-family="sans-serif" font-size="14.00">aws_subnet.peter_subnet</text>
</g>
<!-- aws_instance.example&#45;&gt;aws_subnet.peter_subnet -->
<g id="edge3" class="edge">
<path fill="none" stroke="black" d="M492.1,-31.98C454.88,-38.82 409.69,-47.12 370.15,-54.39"></path>
<polygon fill="black" stroke="black" points="369.58,-50.94 360.37,-56.19 370.84,-57.83 369.58,-50.94"></polygon>
</g>
<!-- aws_internet_gateway.peter_igw -->
<g id="node3" class="node">
<polygon fill="none" stroke="black" points="379.25,-198 167.5,-198 167.5,-162 379.25,-162 379.25,-198"></polygon>
<text text-anchor="middle" x="273.38" y="-174.2" font-family="sans-serif" font-size="14.00">aws_internet_gateway.peter_igw</text>
</g>
<!-- aws_vpc.peter_vpc -->
<g id="node9" class="node">
<polygon fill="none" stroke="black" points="131.5,-117 0,-117 0,-81 131.5,-81 131.5,-117"></polygon>
<text text-anchor="middle" x="65.75" y="-93.2" font-family="sans-serif" font-size="14.00">aws_vpc.peter_vpc</text>
</g>
<!-- aws_internet_gateway.peter_igw&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge4" class="edge">
<path fill="none" stroke="black" d="M192.43,-161.56C183.92,-158.97 175.47,-156.11 167.5,-153 146.54,-144.82 124.38,-133.3 106.2,-122.99"></path>
<polygon fill="black" stroke="black" points="107.99,-119.98 97.58,-118.02 104.49,-126.05 107.99,-119.98"></polygon>
</g>
<!-- aws_route.peter_defaultroute -->
<g id="node4" class="node">
<polygon fill="none" stroke="black" points="664.88,-184 473.38,-184 473.38,-148 664.88,-148 664.88,-184"></polygon>
<text text-anchor="middle" x="569.12" y="-160.2" font-family="sans-serif" font-size="14.00">aws_route.peter_defaultroute</text>
</g>
<!-- aws_route.peter_defaultroute&#45;&gt;aws_internet_gateway.peter_igw -->
<g id="edge5" class="edge">
<path fill="none" stroke="black" d="M473.16,-170.53C446.93,-171.78 418.18,-173.15 390.88,-174.45"></path>
<polygon fill="black" stroke="black" points="391.03,-170.94 381.21,-174.91 391.36,-177.93 391.03,-170.94"></polygon>
</g>
<!-- aws_route_table.peter_rt -->
<g id="node5" class="node">
<polygon fill="none" stroke="black" points="356,-144 190.75,-144 190.75,-108 356,-108 356,-144"></polygon>
<text text-anchor="middle" x="273.38" y="-120.2" font-family="sans-serif" font-size="14.00">aws_route_table.peter_rt</text>
</g>
<!-- aws_route.peter_defaultroute&#45;&gt;aws_route_table.peter_rt -->
<g id="edge6" class="edge">
<path fill="none" stroke="black" d="M473.16,-153.07C439.27,-148.45 401.16,-143.26 367.44,-138.67"></path>
<polygon fill="black" stroke="black" points="368.06,-135.22 357.68,-137.34 367.12,-142.16 368.06,-135.22"></polygon>
</g>
<!-- aws_route_table.peter_rt&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge7" class="edge">
<path fill="none" stroke="black" d="M190.52,-115.25C174.83,-113.19 158.47,-111.04 142.98,-109.01"></path>
<polygon fill="black" stroke="black" points="143.74,-105.58 133.37,-107.75 142.83,-112.52 143.74,-105.58"></polygon>
</g>
<!-- aws_route_table_association.peter_rtassociation -->
<g id="node6" class="node">
<polygon fill="none" stroke="black" points="723,-117 415.25,-117 415.25,-81 723,-81 723,-117"></polygon>
<text text-anchor="middle" x="569.12" y="-93.2" font-family="sans-serif" font-size="14.00">aws_route_table_association.peter_rtassociation</text>
</g>
<!-- aws_route_table_association.peter_rtassociation&#45;&gt;aws_route_table.peter_rt -->
<g id="edge8" class="edge">
<path fill="none" stroke="black" d="M414.8,-113.09C398.72,-114.57 382.75,-116.04 367.66,-117.43"></path>
<polygon fill="black" stroke="black" points="367.44,-113.93 357.8,-118.33 368.08,-120.9 367.44,-113.93"></polygon>
</g>
<!-- aws_route_table_association.peter_rtassociation&#45;&gt;aws_subnet.peter_subnet -->
<g id="edge9" class="edge">
<path fill="none" stroke="black" d="M414.8,-84.91C399.65,-83.51 384.59,-82.13 370.27,-80.81"></path>
<polygon fill="black" stroke="black" points="370.75,-77.34 360.47,-79.91 370.11,-84.31 370.75,-77.34"></polygon>
</g>
<!-- aws_security_group.instance&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge10" class="edge">
<path fill="none" stroke="black" d="M192.43,-36.44C183.92,-39.03 175.47,-41.89 167.5,-45 146.54,-53.18 124.38,-64.7 106.2,-75.01"></path>
<polygon fill="black" stroke="black" points="104.49,-71.95 97.58,-79.98 107.99,-78.02 104.49,-71.95"></polygon>
</g>
<!-- aws_subnet.peter_subnet&#45;&gt;aws_vpc.peter_vpc -->
<g id="edge11" class="edge">
<path fill="none" stroke="black" d="M187.85,-83.1C172.93,-85.06 157.48,-87.09 142.82,-89.01"></path>
<polygon fill="black" stroke="black" points="142.73,-85.49 133.27,-90.26 143.64,-92.43 142.73,-85.49"></polygon>
</g>
<!-- null_resource.echomyeip -->
<g id="node10" class="node">
<polygon fill="none" stroke="black" points="1067.75,-36 901,-36 901,0 1067.75,0 1067.75,-36"></polygon>
<text text-anchor="middle" x="984.38" y="-12.2" font-family="sans-serif" font-size="14.00">null_resource.echomyeip</text>
</g>
<!-- null_resource.echomyeip&#45;&gt;aws_eip.myeip -->
<g id="edge12" class="edge">
<path fill="none" stroke="black" d="M900.68,-18C892.59,-18 884.48,-18 876.62,-18"></path>
<polygon fill="black" stroke="black" points="876.84,-14.5 866.84,-18 876.84,-21.5 876.84,-14.5"></polygon>
</g>
</g>
</svg>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">null_resource</code>는 정의된 속성이 <code class="language-plaintext highlighter-rouge">id</code>가 전부이므로, 선언된 내부의 구성이 변경되더라도 새로운 Plan 과정에서 실행 계획에 포함되지 못합니다.</li>
  <li>따라서 사용자가 <code class="language-plaintext highlighter-rouge">null_resource에</code> 정의된 내용을 강제로 다시 실행하기 위한 인수로 <code class="language-plaintext highlighter-rouge">trigger</code>가 제공됩니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger</code>는 임의의 <code class="language-plaintext highlighter-rouge">string</code> 형태의 <code class="language-plaintext highlighter-rouge">map</code> 데이터를 정의하는데, 정의된 값이 변경되면 <code class="language-plaintext highlighter-rouge">null_resource</code> 내부에 정의된 행위를 다시 실행합니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger</code> 정의와 동작 예제
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"foo"</span> <span class="p">{</span>
  <span class="nx">triggers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">ec2_id</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">bar</span><span class="p">.</span><span class="nx">id</span> <span class="c1"># instance의 id가 변경되는 경우 재실행</span>
  <span class="p">}</span>
  <span class="p">...</span><span class="err">생략</span><span class="p">...</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"bar"</span> <span class="p">{</span>
  <span class="nx">triggers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">ec2_id</span> <span class="p">=</span> <span class="nx">time</span><span class="p">()</span> <span class="c1"># 테라폼으로 실행 계획을 생성할 떄마다 재실행</span>
  <span class="p">}</span>
  <span class="p">...</span><span class="err">생략</span><span class="p">...</span>
<span class="p">}</span>  
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="terraform_data">terraform_data</h4>
<ul>
  <li>테라폼 1.4 이후에는 <code class="language-plaintext highlighter-rouge">null_resource</code> 대신 <code class="language-plaintext highlighter-rouge">terraform_data</code>를 사용하여 아무 작업도 수행하지 않는 리소스 구현이 가능합니다.</li>
  <li>이후에는 가능한 <code class="language-plaintext highlighter-rouge">null_resource</code> 대신 <code class="language-plaintext highlighter-rouge">terraform_data</code>를 사용하는 것이 좋습니다.</li>
  <li>이 리소스 또한 자체적으로 아무것도 수행하지 않지만 <code class="language-plaintext highlighter-rouge">null_resource</code>는 <strong>별도의 프로바이더 구성이 필요</strong>하다는 점과 비교하여 추가 프로바이더 없이 테라폼 자체에 포함된 <strong>기본 수명주기 관리자</strong>가 제공된다는 것이 장점입니다.</li>
  <li>사용 시나리오는 기본 null_resourcr와 동일하며 강제 재실행을 위한 <code class="language-plaintext highlighter-rouge">trigger_replace</code>와 상태 저장을 위한 <code class="language-plaintext highlighter-rouge">input</code> 인수와 <code class="language-plaintext highlighter-rouge">input</code>에 저장된 값을 출력하는 <code class="language-plaintext highlighter-rouge">output</code> 속성이 제공됩니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">triggers_replace</code>에 정의되는 값이 기존 <code class="language-plaintext highlighter-rouge">map</code> 형태에서 <code class="language-plaintext highlighter-rouge">tuple</code>로 변경되어 쓰임이 더 간단해졌습니다.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">terraform_data</code> 리소스의 <code class="language-plaintext highlighter-rouge">trigger_replace</code> 정의와 동작 예제</p>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="c1"># ...</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"database"</span> <span class="p">{</span>
  <span class="c1"># ...</span>
<span class="p">}</span>
  
<span class="c1"># A use-case for terraform_data is as a do-nothing container</span>
<span class="c1"># for arbitrary actions taken by a provisioner.</span>
<span class="k">resource</span> <span class="s2">"terraform_data"</span> <span class="s2">"bootstrap"</span> <span class="p">{</span>
  <span class="nx">triggers_replace</span> <span class="p">=</span> <span class="p">[</span>
    <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">database</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">]</span>
  
  <span class="k">provisioner</span> <span class="s2">"local-exec"</span> <span class="p">{</span>
    <span class="nx">command</span> <span class="p">=</span> <span class="s2">"bootstrap-hosts.sh"</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"terraform_data"</span> <span class="s2">"foo"</span> <span class="p">{</span>
  <span class="nx">triggers_replace</span> <span class="p">=</span> <span class="p">[</span>
    <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">bar</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">]</span>
  
  <span class="nx">input</span> <span class="p">=</span> <span class="s2">"world"</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"terraform_data_output"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">terraform_data</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="k">output</span>  <span class="c1"># 출력 결과는 "world"</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="moved-블록">moved 블록</h3>

<ul>
  <li>테라폼은 state에 기록되는 리소스의 이름이 변경되면 기존 리소스는 삭제되고, 새로운 리소스를 생성합니다.</li>
  <li>테라폼 리소스를 선언하다보면 이름을 변경해야 하는 상황이 발생되며 다음과 같은 예들이 있습니다.
    <ul>
      <li>리소스 이름 변경</li>
      <li>
<code class="language-plaintext highlighter-rouge">count</code>로 처리하던 반복문을 <code class="language-plaintext highlighter-rouge">for_each</code>로 변경</li>
      <li>리소스가 모듈로 이동하여 참조되는 주소가 변경</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">moved</code> 블록은 리소스의 이동을 표현하는 블록으로, 실제 리소스는 변경이 없으면서 테라폼에서 관리되는 이름만 변경되는것을 테라폼에게 알려주고
불필요한 리소스의 재생성을 방지합니다.</li>
  <li>예제
    <ul>
      <li>main.tf 생성
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"a"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"foo!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/foo.bar"</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"file_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>실행
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span><span class="nb">cat </span>foo.bar
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.a"</span> | terraform console
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.a.id"</span> | terraform console
<span class="c"># =&gt; "4bf3e335199107182c6f7638efaad377acc7f452"</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>main.tf의 local_file의 이름을 a =&gt; b 로 변경
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"b"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"foo!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/foo.bar"</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"file_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">b</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>plan 확인시 기존 리소스 a를 제거하고 새로운 리소스 b를 생성하는 것을 확인할 수 있습니다.
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform plan
<span class="c"># =&gt; ...</span>
<span class="c">#      # local_file.a will be destroyed</span>
<span class="c">#    ...</span>
<span class="c">#      # local_file.b will be created</span>
<span class="c">#    ...</span>
<span class="c">#    Plan: 1 to add, 0 to change, 1 to destroy.</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">moved</code> 블록을 사용하여 리소스의 이름 변경을 표현
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"b"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"foo!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/foo.bar"</span>
<span class="p">}</span>

<span class="nx">moved</span> <span class="p">{</span>
  <span class="nx">from</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">a</span>
  <span class="nx">to</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">b</span>
<span class="p">}</span>
    
<span class="k">output</span> <span class="s2">"file_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">b</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>plan 과 apply시 제거나 생성이 없고 <code class="language-plaintext highlighter-rouge">id</code>도 <code class="language-plaintext highlighter-rouge">local_file.a</code> 일때와 동일합니다.
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform plan
<span class="c"># =&gt; ... </span>
     Plan: 0 to add, 0 to change, 0 to destroy.
      
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"local_file.b.id"</span> | terraform console 
<span class="c"># =&gt; "4bf3e335199107182c6f7638efaad377acc7f452"</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">local_file.a</code>일때와 <code class="language-plaintext highlighter-rouge">local_file.b</code>일때의 <code class="language-plaintext highlighter-rouge">terraform.tfstate</code> 파일을 비교해보면 아래와 같습니다.
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff terraform.tfstate.a terraform.tfstate 
</code></pre></div>        </div>

        <div class="language-diff highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">4c4
</span><span class="gd">&lt;   "serial": 1,
</span><span class="p">---
</span><span class="gi">&gt;   "serial": 2,
</span><span class="p">16c16
</span><span class="gd">&lt;       "name": "a",
</span><span class="p">---
</span><span class="gi">&gt;       "name": "b",    
</span></code></pre></div>        </div>
        <p><code class="language-plaintext highlighter-rouge">name</code>만 <code class="language-plaintext highlighter-rouge">a</code>에서 <code class="language-plaintext highlighter-rouge">b</code>로 변경되었음을 확인할 수 있습니다.</p>
      </li>
      <li>마지막으로 <code class="language-plaintext highlighter-rouge">moved</code> 블록이 적용되면, <code class="language-plaintext highlighter-rouge">moved</code> 블록은 더이상 필요가 없기 때문에 삭제해서 리팩토링을 완료합니다.
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf  </span>
<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"b"</span> <span class="p">{</span>
  <span class="nx">content</span>  <span class="p">=</span> <span class="s2">"foo!"</span>
  <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">path</span><span class="p">.</span><span class="k">module}</span><span class="s2">/foo.bar"</span>
<span class="p">}</span>

<span class="c1"># moved {</span>
<span class="c1">#   from = local_file.a</span>
<span class="c1">#   to = local_file.b</span>
<span class="c1"># }</span>
    
<span class="k">output</span> <span class="s2">"file_content"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">local_file</span><span class="p">.</span><span class="nx">b</span><span class="p">.</span><span class="nx">content</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h2 id="cli를-위한-시스템-환경-변수">CLI를 위한 시스템 환경 변수</h2>
<ul>
  <li>테라폼은 다양한 환경 변수를 사용하여 동작을 제어할 수 있습니다.</li>
  <li>로컬 작업환경 별 환경변수 지정 방법
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>Mac/리눅스/유닉스: <span class="nb">export</span> &lt;환경 변수 이름&gt;<span class="o">=</span>&lt;값&gt;
Windows CMD: <span class="nb">set</span> &lt;환경 변수 이름&gt;<span class="o">=</span>&lt;값&gt;
Windows PowerShell: <span class="nv">$Env</span>:&lt;환경 변수 이름&gt;<span class="o">=</span><span class="s1">'&lt;값&gt;'</span>
</code></pre></div>    </div>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">TF_LOG</code> : 테라폼의 stderr 로그에 대한 레벨을 정의 합니다.
    <ul>
      <li>trace, debug, info, warn, error, off를 설정할 수 있고 관련 환경 변수가 없는 경우 off와 동일합니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">TF_LOG</code>를 info로 설정하고 <code class="language-plaintext highlighter-rouge">terraform plan</code> 동작을 하면 테라폼 출력에 관련 로그가 출력됩니다.
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">TF_LOG</span><span class="o">=</span>info
<span class="nv">$ </span>terraform plan
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">TF_LOG_PATH</code> : 로그 출력 파일 위치 지정합니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">TF_LOG_CORE</code> : TF_LOG와 별도로 테라폼 자체 코어에 대한 로깅 레벨 지정 또는 해제합니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">TF_LOG_PROVIDER</code> : TF_LOG와 별도로 테라폼에서 사용하는 프로바이더에 대한 로깅 레벨 지정 또는 해제합니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">TF_INPUT</code> : 값을 false 또는 0으로 설정하면 테라폼 실행 시 인수에 -input=false 를 추가한 것과 동일한 수행 결과를 얻을 수 있습니다.
    <ul>
      <li>단, <code class="language-plaintext highlighter-rouge">TF_INPUT=0</code>으로 하고 <code class="language-plaintext highlighter-rouge">terraform plan</code>을 실행했을때 입력변수를 반드시 입력 받아야 하는 경우 오류가 발생합니다.
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ TF_INPUT</span><span class="o">=</span>0  terraform plan
<span class="c"># =&gt; Error: No value for required variable</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">TF_VAR_name</code> : <code class="language-plaintext highlighter-rouge">TF_VAR_&lt;변수이름&gt;</code>을 사용하면 입력시 또는 <code class="language-plaintext highlighter-rouge">default</code>로 선언된 변수값을 대체합니다. (2주차 “변수 입력 방식과 우선 순위” 부분 참고)</li>
  <li>
<code class="language-plaintext highlighter-rouge">TF_CLI_ARGS</code> / <code class="language-plaintext highlighter-rouge">TF_CLI_ARGS_subcommand</code> : 테라폼 실행 시 추가할 인수를 정의합니다.
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># TF_CLI_ARGS="-input=false" terraform apply -auto-approve 는 terraform apply -input=false -auto-approve 와 같습니다.</span>
<span class="nv">$ TF_CLI_ARGS</span><span class="o">=</span><span class="s2">"-input=false"</span> terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Error: No value for required variable</span>
  
<span class="c"># TF_CLI_ARGS_apply로 인수를 정의하면 terraform apply 커맨드 수행 시에만 동작합니다.</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">TF_CLI_ARGS_apply</span><span class="o">=</span><span class="s2">"-input=false"</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; &lt;에러&gt;</span>
  
<span class="nv">$ </span>terraform plan
<span class="c"># =&gt; &lt;정상 계획 예측 출력&gt; </span>
</code></pre></div>    </div>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">TF_DATA_DIR</code> : <code class="language-plaintext highlighter-rouge">State</code> 저장 백엔드 설정과 같은 작업 디렉터리별 데이터를 보관하는 위치를 지정합니다.
    <ul>
      <li>이 데이터는 <code class="language-plaintext highlighter-rouge">.terraform</code> 디렉터리 위치에 기록되지만 <code class="language-plaintext highlighter-rouge">TF_DATA_DIR</code>에 경로가 정의되면 기본 경로를 대체하여 사용됩니다.</li>
      <li>일관된 테라폼 사용을 위해서 해당 변수는 실행 시마다 일관되게 적용될 수 있도록 설정하는 것이 중요합니다.</li>
      <li>설정 값이 이전 실행 시에만 적용되는 경우 init 명령으로 수행된 모듈, 아티팩트 등의 파일을 찾지 못합니다.</li>
    </ul>
  </li>
</ul>

<h2 id="마치며">마치며</h2>
<p>지금까지 3주간에 걸처 테라폼 HCL의 기본 문법과 기능을 알아보았습니다.
내용도 많고 실습해볼것도 많고, 블로그도 써야하고 다소 힘들었지만 <img class="emoji" title=":cry:" alt=":cry:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f622.png" height="20" width="20" loading="lazy">, 다음 주차 수업부터 실제 응용을 배울 생각을 하니 두근 거립니다.</p>

<p>이번 주도 과제가 무사히 통과되길 기도<img class="emoji" title=":pray:" alt=":pray:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f64f.png" height="20" width="20" loading="lazy">하며 이번 블로그를 마칩니다.</p>

  </div>

  <div id="toc-minimap" class="toc-minimap collapsed">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">들어가며</a></li>
<li class="toc-entry toc-h2">
<a href="#hcl-%EA%B3%84%EC%86%8D">HCL (계속)</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#%EB%B0%98%EB%B3%B5%EB%AC%B8-22">반복문 (2/2)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#for_each">for_each</a></li>
<li class="toc-entry toc-h4"><a href="#for-expression">for Expression</a></li>
<li class="toc-entry toc-h4"><a href="#dynamic">dynamic</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#%EC%A1%B0%EA%B1%B4%EB%AC%B8-conditional-expression">조건문 (Conditional Expression)</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%95%A8%EC%88%98-function">함수 (Function)</a></li>
<li class="toc-entry toc-h3">
<a href="#%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%84%88-provisioner">프로비저너 (provisioner)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#local-exec-%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%84%88">local-exec 프로비저너</a></li>
<li class="toc-entry toc-h4"><a href="#%EC%9B%90%EA%B2%A9%EC%A7%80-%EC%97%B0%EA%B2%B0">원격지 연결</a></li>
<li class="toc-entry toc-h4"><a href="#file-%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%84%88">file 프로비저너</a></li>
<li class="toc-entry toc-h4"><a href="#remote_exec-%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%84%88">remote_exec 프로비저너</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#null_resource%EC%99%80-terraform_data">null_resource와 terraform_data</a>
<ul>
<li class="toc-entry toc-h4"><a href="#null_resource">null_resource</a></li>
<li class="toc-entry toc-h4"><a href="#terraform_data">terraform_data</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#moved-%EB%B8%94%EB%A1%9D">moved 블록</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#cli%EB%A5%BC-%EC%9C%84%ED%95%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%ED%99%98%EA%B2%BD-%EB%B3%80%EC%88%98">CLI를 위한 시스템 환경 변수</a></li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">마치며</a></li>
</ul>
  </div>
<a class="u-url" href="/posts/2024-06-30-T101-Study-Terraform-Week-3/" hidden></a>
</article>



<div class="PageNavigation">
  
  <a class="prev" href="/posts/2024-06-23-T101-Study-Terraform-Week-2/">« [T101 4기] 테라폼 기본 사용법 2/3</a>
  
  
  <a class="next" href="/posts/2024-07-06-T101-Study-Terraform-Week-4/">[T101 4기] Provider &amp; State »</a>
  
</div>

<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = "https://sweetlittlebird.github.io/posts/2024-06-30-T101-Study-Terraform-Week-3/";
this.page.identifier = "/posts/T101 Study - Terraform Week 3";
};
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Sweet Little Bird</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Sweet Little Bird</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/sweetlittlebird"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sweetlittlebird</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>공부 기록과 개발 이야기를 담은 블로그입니다.</p>
      </div>
    </div>

  </div>

</footer>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
      <!-- Background of PhotoSwipe. 
           It's a separate element as animating opacity is faster than rgba(). -->
      <div class="pswp__bg"></div>
      <!-- Slides wrapper with overflow:hidden. -->
      <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
          <div class="pswp__top-bar">
            <!--  Controls are self-explanatory. Order can be changed. -->
            <div class="pswp__counter"></div>
            <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
            <button class="pswp__button pswp__button--share" title="Share"></button>
            <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
            <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
            <!-- element will get class pswp__preloader--active when preloader is running -->
            <div class="pswp__preloader">
              <div class="pswp__preloader__icn">
                <div class="pswp__preloader__cut">
                  <div class="pswp__preloader__donut"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
            <div class="pswp__share-tooltip"></div>
          </div>
          <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
          </button>
          <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
          </button>
          <div class="pswp__caption">
            <div class="pswp__caption__center"></div>
          </div>
        </div>
      </div>
    </div>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EWGY9N8QXY"></script>

    
    <script async src="/assets/dist/app.min.js"></script>
    
  
    <a href="#" id="back-to-top"><span>Back to Top</span></a>
  </body>

</html>
