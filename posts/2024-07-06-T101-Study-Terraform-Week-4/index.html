<!DOCTYPE html>
<html lang="ko"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[T101 4기] Provider &amp; State | Sweet Little Bird</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="[T101 4기] Provider &amp; State" />
<meta property="og:locale" content="ko" />
<meta name="description" content="드디어 HCL 기본 문법 스터디가 끝나고 다른 주제로 넘어가게 되었습니다. 물론 HCL 문법을 계속 사용해야 하는 이상 지속적인 공부와 추가/변경되는 문법을 계속 팔로우 해야겠지만, 한 단계를 넘겼다는 느낌에 뿌듯합니다." />
<meta property="og:description" content="드디어 HCL 기본 문법 스터디가 끝나고 다른 주제로 넘어가게 되었습니다. 물론 HCL 문법을 계속 사용해야 하는 이상 지속적인 공부와 추가/변경되는 문법을 계속 팔로우 해야겠지만, 한 단계를 넘겼다는 느낌에 뿌듯합니다." />
<link rel="canonical" href="https://sweetlittlebird.github.io/posts/2024-07-06-T101-Study-Terraform-Week-4/" />
<meta property="og:url" content="https://sweetlittlebird.github.io/posts/2024-07-06-T101-Study-Terraform-Week-4/" />
<meta property="og:site_name" content="Sweet Little Bird" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-06T02:08:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="[T101 4기] Provider &amp; State" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-07-06T02:08:00+09:00","datePublished":"2024-07-06T02:08:00+09:00","description":"드디어 HCL 기본 문법 스터디가 끝나고 다른 주제로 넘어가게 되었습니다. 물론 HCL 문법을 계속 사용해야 하는 이상 지속적인 공부와 추가/변경되는 문법을 계속 팔로우 해야겠지만, 한 단계를 넘겼다는 느낌에 뿌듯합니다.","headline":"[T101 4기] Provider &amp; State","mainEntityOfPage":{"@type":"WebPage","@id":"https://sweetlittlebird.github.io/posts/2024-07-06-T101-Study-Terraform-Week-4/"},"url":"https://sweetlittlebird.github.io/posts/2024-07-06-T101-Study-Terraform-Week-4/"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/dist/main.min.css">
  <link rel="stylesheet" href="/assets/dist/main_dark.min.css" media="(prefers-color-scheme: dark)">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pretendard/1.3.9/static/pretendard.css" integrity="sha512-NzqTHTrO48HsIamogmIaVhTXoSgRF24Cn+ynrNYrFuKrY0AdDbmcNieiOHsQARS/r0Gax9VwV3/rVMHs3ipUlg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="shortcut icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/favicon/favicon.ico" type="image/x-icon"><link type="application/atom+xml" rel="alternate" href="https://sweetlittlebird.github.io/feed.xml" title="Sweet Little Bird" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Sweet Little Bird</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/about/">소개</a><a class="page-link" href="/posts/">글 목록</a>
</div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[T101 4기] Provider &amp; State</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-07-06T02:08:00+09:00" itemprop="datePublished">2024년 07월 06일에 작성
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="table-of-content">
      <header>목차</header>
      <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">들어가며</a></li>
<li class="toc-entry toc-h2">
<a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-provider">프로바이더 (Provider)</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#provider-%EC%84%A4%EC%A0%95">Provider 설정</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EB%A1%9C%EC%BB%AC-%EC%9D%B4%EB%A6%84%EA%B3%BC-%EB%AA%85%EC%8B%9C%EC%A0%81-%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EC%A7%80%EC%A0%95">로컬 이름과 명시적 프로바이더 지정</a></li>
<li class="toc-entry toc-h4"><a href="#%EB%8B%A8%EC%9D%BC-%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94%EC%9D%98-%EB%8B%A4%EC%A4%91-%EC%A0%95%EC%9D%98">단일 프로바이더의 다중 정의</a></li>
<li class="toc-entry toc-h4"><a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EC%A0%95%EC%9D%98">프로바이더 요구사항 정의</a></li>
<li class="toc-entry toc-h4"><a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EC%84%A4%EC%B9%98">프로바이더 설치</a></li>
<li class="toc-entry toc-h4"><a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EA%B0%84-%EC%A0%84%ED%99%98-%EC%97%AC%EB%B6%80">프로바이더 간 전환 여부</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EC%97%90%EC%BD%94-%EC%8B%9C%EC%8A%A4%ED%85%9C">프로바이더 에코 시스템</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#%EC%83%81%ED%83%9C-state">상태 (State)</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#state%EC%9D%98-%EB%AA%A9%EC%A0%81%EA%B3%BC-%EC%9D%98%EB%AF%B8">State의 목적과 의미</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EB%A9%B1%EB%93%B1%EC%84%B1-idempotency">멱등성 (Idempotency)</a></li>
<li class="toc-entry toc-h4"><a href="#%EC%83%81%ED%83%9C-%ED%8C%8C%EC%9D%BC%EC%9D%84-%ED%8C%80-%EB%8B%A8%EC%9C%84%EC%97%90%EC%84%9C-%ED%85%8C%EB%9D%BC%ED%8F%BC-%EC%9A%B4%EC%98%81%EC%8B%9C-%EB%AC%B8%EC%A0%9C%EC%A0%90">상태 파일을 팀 단위에서 테라폼 운영시 문제점</a></li>
<li class="toc-entry toc-h4"><a href="#%EC%9B%90%EA%B2%A9%EC%A7%80%EC%9B%90-%EB%B0%B1%EC%97%94%EB%93%9C">원격지원 백엔드</a></li>
<li class="toc-entry toc-h4"><a href="#state-%EB%8F%99%EA%B8%B0%ED%99%94">State 동기화</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#terraform-backend--aws-s3--dynamodb">Terraform Backend : AWS S3 + DynamoDB</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EC%95%85%EB%B6%84%EB%8B%98-%EC%8B%A4%EC%8A%B5-%EB%94%B0%EB%9D%BC%ED%95%98%EA%B8%B0">악분님 실습 따라하기</a></li>
<li class="toc-entry toc-h4"><a href="#%ED%85%8C%EB%9D%BC%ED%8F%BC-%EB%B0%B1%EC%97%94%EB%93%9C%EC%9D%98-%EB%8B%A8%EC%A0%90">테라폼 백엔드의 단점</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#%EC%9B%8C%ED%81%AC%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4">워크스페이스</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">마치며</a></li>
</ul>
    </div>
    <h2 id="들어가며">들어가며</h2>

<p>드디어 HCL 기본 문법 스터디가 끝나고 다른 주제로 넘어가게 되었습니다.
물론 HCL 문법을 계속 사용해야 하는 이상 지속적인 공부와 추가/변경되는 문법을 계속
팔로우 해야겠지만, 한 단계를 넘겼다는 느낌에 뿌듯합니다. <img class="emoji" title=":thumbsup:" alt=":thumbsup:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png" height="20" width="20"></p>

<p>이번 주에는 계속 사용은 해왔지만 잘은 모르고 있던 <code class="language-plaintext highlighter-rouge">Provider</code>와 <code class="language-plaintext highlighter-rouge">State</code>에 대해
<a href="https://product.kyobobook.co.kr/detail/S000202478097">테라폼으로 시작하는 IaC</a>를 통해 알아 보겠습니다.</p>

<blockquote>
  <p><img src="/assets/2024/20240614_terraform_book.jpg" alt="테라폼으로 시작하는 IaC"></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">테라폼으로 시작하는 IaC</a></p>
</blockquote>

<h2 id="프로바이더-provider">프로바이더 (Provider)</h2>

<ul>
  <li>테라폼은 다양한 클라우드 서비스와 SaaS 등을 지원합니다. 이를 위해 사용하는 것이 <code class="language-plaintext highlighter-rouge">Provider</code>입니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Provider</code>는 클라우드 서비스나 SaaS를 지원하는 테라폼의 플러그인이며 각 서비스의 API 와 통신하여 리소스를 관리합니다.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Provider</code>는 다음의 3가지 등급으로 나뉩니다.</p>

    <table>
      <thead>
        <tr>
          <th>등급</th>
          <th>설명</th>
          <th>네임스페이스</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Official</td>
          <td>테라폼 팀에서 제공하는 공식 플러그인입니다.</td>
          <td>hashicorp</td>
        </tr>
        <tr>
          <td>Partner</td>
          <td>테라폼과 파트너십을 맺은 회사에서 제공하는 플러그인으로 주로 해당 파트너의 클라우드/SaaS 제품에 대한 관리 기능을 제공합니다.<br>Partner 프로바이더가 되려면 HarshiCorp Technology Partnet Program 에 가입되어야 합니다.</td>
          <td>게시한 조직 이름<br>(mongodb/mongodbatlas)</td>
        </tr>
        <tr>
          <td>Community</td>
          <td>커뮤니티에서 제공하는 플러그인으로 개별 관리자와 그룹에서 등록한 프로바이더 입니다.<br>사용시 주의가 필요합니다.</td>
          <td>개인 및 조적 계정 이름<br>(DeviaVir/gsuite)</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>추가적으로 <code class="language-plaintext highlighter-rouge">Archived</code> 등급이 있을 수 있으며, 더이상 유지보수 되지 않는 이전 버전을 의미합니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Community</code> 제공 <code class="language-plaintext highlighter-rouge">Provider</code>는 <strong>충분히 검증되지 않거나, 신뢰성이 충분히 입증되지 않은</strong> 개인(또는 조직)이
등록한 경우도 있기 때문에 사용시 주의가 필요합니다. 특히 보안에 민감한 정보를 다루는 경우에는 특히 <strong>주의해야</strong> 합니다.
github의 star 수, issue, PR 등을 확인하여 신뢰성을 판단한 다음 사용하는 것이 좋습니다.</li>
  <li>사용가능한 <code class="language-plaintext highlighter-rouge">Provider</code>의 목록은 다음의 링크에서 확인할 수 있습니다.
    <ul>
      <li><a href="https://registry.terraform.io/browse/providers">Terraform Providers</a></li>
    </ul>
  </li>
</ul>

<h3 id="provider-설정">Provider 설정</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Provider</code> 설정은 다음과 같이 <code class="language-plaintext highlighter-rouge">provider</code> 블록을 사용하여 설정합니다. (1주차 참조)
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_version</span> <span class="p">=</span> <span class="s2">"~&gt; 1.3.0"</span> <span class="c1"># 테라폼 버전</span>
  
  <span class="nx">required_providers</span> <span class="p">{</span> <span class="c1"># 프로바이더 버전을 나열</span>
    <span class="nx">random</span> <span class="p">=</span> <span class="p">{</span>
      <span class="c1"># Official Tier는 source를 생략할 수 있습니다.</span>
    <span class="p">}</span>
    <span class="nx">architech-http</span> <span class="p">=</span> <span class="p">{</span>
      <span class="c1"># Official Tier 가 아닌 경우 source를 명시해야 합니다.</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"architect-team/http"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 3.0"</span>
    <span class="p">}</span>
    <span class="nx">my-peter-aws</span> <span class="p">=</span> <span class="p">{</span>   <span class="c1"># 프로바이더의 로컬 이름은 임의로 지정 가능합니다.</span>
                       <span class="c1"># 원래는 aws = { version = "~&gt; 5.56.1" } 과 같이</span>
                       <span class="c1"># 사용했겠지만 이렇게 이름을 바꿀 수 있습니다.</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 5.56.1"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">...</span> 
<span class="p">}</span> 
<span class="err">...</span>
</code></pre></div>    </div>
    <ul>
      <li>위의 예제에서 <code class="language-plaintext highlighter-rouge">random</code>은 Official Tier 이므로 <code class="language-plaintext highlighter-rouge">source</code>를 생략할 수 있습니다.</li>
      <li>하지만 <code class="language-plaintext highlighter-rouge">architech-team/http</code>는 Official Tier가 아니므로 <code class="language-plaintext highlighter-rouge">source</code>를 명시해야 합니다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">my-peter-aws</code> 처럼 provider는 로컬 이름을 임의로 지정할 수 있습니다. 하지만 특별한 이유가 없다면 <code class="language-plaintext highlighter-rouge">aws</code>와 같은 기본 이름을 사용하는 것이 좋습니다.</li>
    </ul>
  </li>
</ul>

<h4 id="로컬-이름과-명시적-프로바이더-지정">로컬 이름과 명시적 프로바이더 지정</h4>
<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">architect-http</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"architect-team/http"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 3.0"</span>
    <span class="p">}</span>
    <span class="nx">http</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"hashicorp/http"</span>
    <span class="p">}</span>
    <span class="nx">aws-http</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"terraform-aws-modules/http"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">data</span> <span class="s2">"http"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="k">provider</span> <span class="p">=</span> <span class="nx">aws-http</span>
  <span class="nx">url</span> <span class="p">=</span> <span class="s2">"https://checkpoint-api.hashicorp.com/v1/check/terraform"</span>

  <span class="nx">request_headers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Accept</span> <span class="p">=</span> <span class="s2">"application/json"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li>로컬이름
    <ul>
      <li>위의 예제에서 <code class="language-plaintext highlighter-rouge">architect-http = { ... }</code>의 <code class="language-plaintext highlighter-rouge">architect-http</code>, 
<code class="language-plaintext highlighter-rouge">http = { ... }</code>의 <code class="language-plaintext highlighter-rouge">http</code>, <code class="language-plaintext highlighter-rouge">aws-http = { ... }</code>의 <code class="language-plaintext highlighter-rouge">aws-http</code>는 로컬 이름입니다.</li>
      <li>앞서 말씀드린것 처럼 로컬이름은 임의로 지정할 수 있으나 특별한 이유가 없다면 “use provider”에서 권장하는 기본 이름을 사용하는 것이 좋습니다.</li>
    </ul>
  </li>
  <li>명시적 프로바이더 지정
    <ul>
      <li>위의 예제처럼 <code class="language-plaintext highlighter-rouge">http</code>라는 동일한 이름의 리소스를 가진 경우 <code class="language-plaintext highlighter-rouge">data</code> 나 <code class="language-plaintext highlighter-rouge">resource</code> 블록에서 <code class="language-plaintext highlighter-rouge">provider</code>를 명시적으로 지정할 수 있습니다.
        <ul>
          <li>위의 예제에서 <code class="language-plaintext highlighter-rouge">data.http.example</code>은 <code class="language-plaintext highlighter-rouge">aws-http</code>로 지정된 <code class="language-plaintext highlighter-rouge">provider</code>를 사용합니다.</li>
          <li>만약 <code class="language-plaintext highlighter-rouge">data "http" "example" {</code>에서 <code class="language-plaintext highlighter-rouge">provider = aws-http</code>를 생략했다면, 위의 <code class="language-plaintext highlighter-rouge">required_providers</code>에서 
<code class="language-plaintext highlighter-rouge">http</code>라는 로컬 이름을 지정한 <code class="language-plaintext highlighter-rouge">hashicorp/http</code> 프로바이더가 사용됩니다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="단일-프로바이더의-다중-정의">단일 프로바이더의 다중 정의</h4>

<ul>
  <li>동일한 프로바이더를 사용하지만 다른 설정을 필요로 하는 경우, 
리소스마다 별도로 선언된 프로바이더를 지정해야 하는 경우가 있습니다.</li>
  <li>예를들어서 <code class="language-plaintext highlighter-rouge">aws</code> 프로바이더를 사용할때 두개 이상의 <code class="language-plaintext highlighter-rouge">region</code>이나
<code class="language-plaintext highlighter-rouge">access_key</code>, <code class="language-plaintext highlighter-rouge">secret_key</code> 등이 다른 환경을 사용하는 경우가 있는데 이때 아래와 같이 정의 할 수 있습니다.
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-southeast-1"</span>
<span class="p">}</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">alias</span>  <span class="p">=</span> <span class="s2">"seoul"</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"app_server1"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-06b79cf2aee0d5c92"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"app_server2"</span> <span class="p">{</span>
  <span class="k">provider</span>      <span class="p">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">seoul</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-0ea4d4b8dc1e46212"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
<span class="p">}</span>  
</code></pre></div>    </div>
    <p>첫 aws 프로바이더는 <code class="language-plaintext highlighter-rouge">alias</code> 없이 사용되고
두번째 aws 프로바이더는 “seoul”이라는 <code class="language-plaintext highlighter-rouge">alias</code>를 사용하였고, <code class="language-plaintext highlighter-rouge">aws.seoul</code>과 같이 사용할 수 있습니다.</p>
    <ul>
      <li>실행 결과
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply
<span class="nv">$ </span>terraform state list 
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.app_server1.public_ip"</span> | terraform console
<span class="c"># =&gt; "13.215.47.148"</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.app_server1.availability_zone"</span> | terraform console
<span class="c"># =&gt; "ap-southeast-1b"</span>
     
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.app_server2.public_ip"</span> | terraform console
<span class="c"># =&gt; "43.203.243.238"</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_instance.app_server2.availability_zone"</span> | terraform console    
<span class="c"># =&gt; "ap-northeast-2a"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="프로바이더-요구사항-정의">프로바이더 요구사항 정의</h4>

<ul>
  <li>테라폼 실행시 요구되는 프로바이더 요구사항은 <code class="language-plaintext highlighter-rouge">terraform</code>블록의 <code class="language-plaintext highlighter-rouge">required_providers</code> 블록에 여러개를 정의할 수 있습니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">source</code>에는 프로바이더 다운로드 경로를 지정하고 <code class="language-plaintext highlighter-rouge">version</code>은 버전 제약을 명시합니다.</li>
  <li>프로바이더 요구사항 정의 블록
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="err">&lt;프로바이더</span> <span class="err">로컬</span> <span class="err">이름&gt;</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="p">[</span><span class="err">&lt;호스트</span> <span class="err">주소&gt;</span><span class="p">/]</span><span class="err">&lt;네임스페이스&gt;</span><span class="p">/</span><span class="err">&lt;유형&gt;</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="err">&lt;버전</span> <span class="err">제약&gt;</span>
    <span class="p">}</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div>    </div>
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">source</code> : 프로바이더가 호스팅되는 주소와 네임스페이스, 유형을 지정합니다.
        <ul>
          <li>호스트 주소 : 프로바이더가 호스팅되는 주소로, 필수는 아니며 기본값은 <code class="language-plaintext highlighter-rouge">registry.terraform.io</code> 입니다.</li>
          <li>네임스페이스 : 프로바이더의 네임스페이스로, 공개된 레지스트리 및 Terraform Cloud의 비공개 레지스트리의 프로바이더를 게시하는 조직을 나타냅니다..</li>
          <li>유형 : 프로바이더에서 관리되는 플랫폼이나 서비스 이름입니다.</li>
          <li>예제)
            <ul>
              <li>
<code class="language-plaintext highlighter-rouge">source = "hashicorp/aws"</code> 는 <code class="language-plaintext highlighter-rouge">hashicorp</code> 네임스페이스의 <code class="language-plaintext highlighter-rouge">aws</code> 프로바이더를 의미합니다. 호스트 주소가 생략되어 <code class="language-plaintext highlighter-rouge">registry.terraform.io</code>로 간주됩니다.</li>
              <li>
<code class="language-plaintext highlighter-rouge">source = "mycorp.com/myns/mytype"</code> 는 <code class="language-plaintext highlighter-rouge">mycorp.com</code> 호스트 주소의 <code class="language-plaintext highlighter-rouge">myns</code> 네임스페이스의 <code class="language-plaintext highlighter-rouge">mytype</code>라는 프로바이더를 의미합니다.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">version</code> : 버전 제약은 <a href="/posts/2024-06-11-T101-Study-Terraform-Week-1/#terraform-%EB%B8%94%EB%A1%9D">1주차</a>에서 설명한 것과 동일합니다.</li>
    </ul>
  </li>
</ul>

<h4 id="프로바이더-설치">프로바이더 설치</h4>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">terraform init</code> 명령을 실행시 지정된 <code class="language-plaintext highlighter-rouge">source</code>에서 <code class="language-plaintext highlighter-rouge">version</code>의 버전 제약에 맞는 프로바이더를 다운로드 합니다.</li>
  <li>항상 지정한 특정 버전을 사용하려면 <code class="language-plaintext highlighter-rouge">terraform</code> 블록에서 정의하거나 <code class="language-plaintext highlighter-rouge">.terraform.lock.hcl</code> 잠금파일을 코드 저장소에 공유하는 등의 방법이 있습니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">required_providers</code> 블록을 사용하면 실제로 리소스를 사용하지 않더라도 설치가 되며, <code class="language-plaintext highlighter-rouge">required_providers</code> 블록을 사용하지 않으면 리소스를 사용할 때 테라폼이 추론해서 최신 버전의 프로바이더를 설치가 진행됩니다.</li>
</ul>

<h4 id="프로바이더-간-전환-여부">프로바이더 간 전환 여부</h4>

<ul>
  <li>AWS, GCP 같은 클라우드 서비스와 같이 유사한 서비스들을 제공하는 경우 프로바이더를 바꿔서 쉽게 사용할 수 있을까요? 불가능합니다.</li>
  <li>각 프로바이더 별로 리소스 이름도 다르고 설정도 다르기 때문에 프로바이더를 바꾸는 것은 쉽지 않습니다.</li>
  <li>하지만 1:1로 매칭 되지는 않지만, 유사 프로바이더 간에는 리소스 명이나 옵션에도 유사점이 있기 때문에
이점은 있습니다.</li>
</ul>

<h3 id="프로바이더-에코-시스템">프로바이더 에코 시스템</h3>

<ul>
  <li>테라폼의 에코시스템은 사용자가 사용하는 방식과 구조에 따라 테라폼을 적용할 수 있도록 설계되었습니다.
<img src="/assets/2024/20240704_terraform_w4_provider_ecosystem.png" alt="img.png">
</li>
  <li>테라폼의 에코시스템을 구성하는 파트너는 크게 워크플로우 파트너와 인프라스트럭쳐 파트너로 나뉩니다.
    <ul>
      <li>워크플로우 파트너 : 테라폼 클라우드와 테라폼 엔터프라이즈에 대한 지원을 제공하는 파트너로, 주로 자신들의
기존 플랫폼을 테라폼에서 사용할 수 있도록 돕는 파트너입니다.
대표적으로 Github, Gitlab, Jenkins, CircleCI, TravisCI, Datadog, NewRelic 등이 있습니다.
        <ul>
          <li>워크 플로우 파트너의 유형
            <ul>
              <li>
<strong>코드 스캐닝</strong> : IaC 구성을 검토하여 오류나 보안 문제를 방지하는 도구를 제공하는 파트너</li>
              <li>
<strong>비용 관리</strong> : 새로운 인프라의 비용 영향을 분석하고 비용 관리를 적용하는 파트너</li>
              <li>
<strong>관찰성/모니터링</strong> : 성능의 가시성을 제공하거나 인프라 변경을 자동으로 감지하여 최적의 관찰성을 보장하는 데 중점을 둔 파트너</li>
              <li>
<strong>보안</strong> : 보안 및 준수 정책에 맞지 않는 Terraform 구성 오류를 감지하는 파트너</li>
              <li>
<strong>감사</strong> : 멀티 클라우드 인프라 자원을 관리하여 서비스 중단을 방지하고, 거버넌스를 개선하며, 효율성을 높이는 데 도움을 주는 파트너</li>
              <li>
<strong>노 코드/로우 코드</strong> : IT, 공급망, 운영 관리, 비즈니스 관리 및 기타 워크플로우의 구현, 배포 및 전달에 중점을 둔 파트너</li>
              <li>
<strong>SSO(Single Sign On)</strong> : 최종 사용자가 안전하게 로그인할 수 있도록 인증에 중점을 둔 파트너</li>
              <li>
<strong>CI/CD</strong> : 지속적 통합 및 지속적 전달/배포에 중점을 둔 파트너</li>
              <li>
<strong>VCS</strong> : 소프트웨어 코드 변경을 추적하고 관리하는 데 중점을 둔 파트너</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>인프라스트럭처 파트너 : 모든 테라폼 에디션을 지원하며, 자신들의 플랫폼의 API를 통해 리소스를 활용할 수 있게
하는 파트너입니다. 대표적으로 퍼블릭 클라우드 서비스 업체인 AWS, Azure, GCP와 PaaS 인 Heroku, SaaS 서비스인
DNSimple, CloudFlare 등이 있습니다.
        <ul>
          <li>워크 플로우 파트너의 유형
            <ul>
              <li>
<strong>퍼블릭 클라우드</strong> : 대규모 글로벌 클라우드 제공업체로 IaaS, SaaS, PaaS를 포함한 다양한 서비스를 제공</li>
              <li>
<strong>컨테이너 오케스트레이션</strong> : 컨테이너 프로비저닝 및 배포를 관리</li>
              <li>
<strong>IaaS(Infrastructure-as-a-Service)</strong> : 스토리지, 네트워킹, 가상화와 같은 솔루션을 제공하는 인프라 및 IaaS 제공</li>
              <li>
<strong>보안 및 인증</strong> : 인증 및 보안 모니터링 플랫폼을 제공</li>
              <li>
<strong>자산 관리</strong> : 소프트웨어 라이선스, 하드웨어 자산, 클라우드 리소스를 포함한 주요 조직 및 IT 리소스의 자산 관리를 제공</li>
              <li>
<strong>CI/CD</strong> : 지속적 통합 및 지속적 전달/배포</li>
              <li>
<strong>로깅 및 모니터링</strong> : 로거, 메트릭 도구, 모니터링 서비스와 같은 서비스를 구성하고 관리</li>
              <li>
<strong>유틸리티</strong> : 랜덤 값 생성, 파일 생성, http 상호작용, 시간 기반 리소스와 같은 도움 기능을 제공</li>
              <li>
<strong>클라우드 자동화</strong> : 구성 관리와 같은 특수 클라우드 인프라 자동화 관리</li>
              <li>
<strong>데이터 관리</strong> : 데이터 센터 저장소, 백업, 복구 솔루션 제공</li>
              <li>
<strong>네트워킹</strong> : 라우팅, 스위칭, 방화벽, SD-WAN 솔루션과 같은 네트워크 특정 하드웨어 및 가상화 제품과 통합</li>
              <li>
<strong>VCS(Version Control System)</strong> : Terraform 내에서 VCS 프로젝트, 팀, 저장소에 중점을 둠</li>
              <li>
<strong>통신 및 메시징</strong> : 통신, 이메일, 메시징 플랫폼과 통합</li>
              <li>
<strong>데이터베이스</strong> : 데이터베이스 리소스를 프로비저닝하고 구성할 수 있는 기능을 제공</li>
              <li>
<strong>PaaS(Platform-as-a-Service)</strong> : 이들은 하드웨어, 소프트웨어, 애플리케이션 개발 도구를 포함한 다양한 범위를 제공하는 플랫폼 및 PaaS 제공</li>
              <li>
<strong>웹 서비스</strong> : 웹 호스팅, 웹 성능, CDN 및 DNS 서비스</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="상태-state">상태 (State)</h2>

<h3 id="state의-목적과-의미">State의 목적과 의미</h3>

<p>테라폼의 <code class="language-plaintext highlighter-rouge">State</code>는 테라폼이 관리하는 인프라의 현재 상태를 저장하는 파일입니다.
그 동작의 특징을 알아 보기위해서 다음과 같이 <code class="language-plaintext highlighter-rouge">State</code>의 목적과 의미를 알아보겠습니다.
기본적으로 `terraform.tfstate 파일에 저장되며, 이 파일은 JSON 형식으로 저장됩니다.</p>
<ul>
  <li>실습
    <ul>
      <li>main.tf 생성
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span>  <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span>       <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-study"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>실행
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
    
<span class="c"># 상태 파일 확인</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate  
<span class="c"># =&gt; ...</span>
<span class="c">#    "serial": 1,</span>
<span class="c">#    ...</span>
<span class="c">#    "instances": [ </span>
<span class="c">#       { "id": "vpc-0bebcf57eff3753a3",</span>
<span class="c">#         "tags": { "Name": "t101-study" }, </span>
<span class="c">#    ...</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.id"</span> | terraform console
<span class="c"># =&gt; "vpc-0bebcf57eff3753a3"</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.tags.Name"</span> | terraform console
<span class="c"># =&gt; "t101-study"</span>
</code></pre></div>        </div>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">main.tf</code>의 태그 수정 수정
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span>  <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"peter_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span>       <span class="p">=</span> <span class="s2">"10.10.0.0/16"</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"Warmachine Rox"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>실행
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
    
<span class="c"># 상태 파일 확인</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate  
<span class="c"># =&gt; ...</span>
<span class="c">#    "serial": 1,</span>
<span class="c">#    ...</span>
<span class="c">#    "instances": [ </span>
<span class="c">#       { "id": "vpc-0bebcf57eff3753a3",</span>
<span class="c">#         "tags": { "Name": "Warmachine Rox" }, </span>
<span class="c">#    ...</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.id"</span> | terraform console
<span class="c"># =&gt; "vpc-0bebcf57eff3753a3"</span>
    
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"aws_vpc.peter_vpc.tags.Name"</span> | terraform console
<span class="c"># =&gt; "Warmachine Rox"</span>
</code></pre></div>        </div>
      </li>
      <li>상태비교
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff terraform.tfstate terraform.tfstate.backup
4c4
&lt;   <span class="s2">"serial"</span>: 3,
<span class="nt">---</span>
<span class="o">&gt;</span>   <span class="s2">"serial"</span>: 1,
39c39
&lt;               <span class="s2">"Name"</span>: <span class="s2">"Warmachine Rox"</span>
<span class="nt">---</span>
<span class="o">&gt;</span>               <span class="s2">"Name"</span>: <span class="s2">"t101-study"</span>
42c42
&lt;               <span class="s2">"Name"</span>: <span class="s2">"Warmachine Rox"</span>
<span class="nt">---</span>
<span class="o">&gt;</span>               <span class="s2">"Name"</span>: <span class="s2">"t101-study"</span> 
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>위와 같이 상태가 관리되는 파일인 <code class="language-plaintext highlighter-rouge">terraform.tfstate</code>에 최근 적용 상태가 적용됩니다.</li>
</ul>

<h4 id="멱등성-idempotency">멱등성 (Idempotency)</h4>
<ul>
  <li>이렇게 저장된 상태는 멱등성를 제공하는데 활용됩니다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">terraform plan</code>이나 <code class="language-plaintext highlighter-rouge">terraform apply</code>를 했을때, 프로비저닝된 리소스와 <code class="language-plaintext highlighter-rouge">.tf</code> 파일의 리소스가 일치하지 않으면
테라폼은 <code class="language-plaintext highlighter-rouge">.tf</code> 파일의 리소스를 프로비저닝된 리소스와 일치하도록 변경합니다.
이때 프로비저닝된 리소스와 <code class="language-plaintext highlighter-rouge">.tf</code> 파일의 리소스가 같은 리소스를 가리키고 있는지 아는데
<code class="language-plaintext highlighter-rouge">id</code>값 등을 사용합니다.</li>
  <li>즉, 상태 파일에 문제가 생길 경우 기존에 생성된 리소스에 대한 추적이 불가능해져서
실제로는 리소스가 존재해도 테라폼 입장에서는 없는것과 마찬가지가 됩니다.</li>
  <li>이렇게 중요하기 때문에 상태 파일은 테라폼에서만 관리되도록 하고,
<strong>직접 편집하거나 작성하거나 삭제하면 안됩</strong>니다.</li>
</ul>

<h4 id="상태-파일을-팀-단위에서-테라폼-운영시-문제점">상태 파일을 팀 단위에서 테라폼 운영시 문제점</h4>
<ul>
  <li>로컬의 상태 파일은 팀 단위에서 운영시 다음과 같은 어려움이 있습니다.
    <ul>
      <li>상태 파일은 최종 상태를 갖고 있어야 하기 때문에 모든 팀원들이 동일한 상태 파일을 갖고 있어야 합니다.</li>
      <li>두명이상이 동시에 적용하는것을 막기 위해 상태 파일을 잠그는 기능이 필요합니다.</li>
      <li>개발 단계, 스테이징 단계, 프로덕션 단계 등 다양한 환경에서 각 환경별로 상태파일을 격리할 필요가 있습니다.</li>
      <li>상태파일에는 <code class="language-plaintext highlighter-rouge">sensitive=true</code>인 민감한 값도 평문으로 저장됩니다.</li>
    </ul>
  </li>
  <li>상태파일을 VCS로 관리하는 것의 문제점
    <ul>
      <li>수동 오류
        <ul>
          <li>상태 파일의 최신 변경 사항을 가져오거나, 변경 되었을때 push 하는것을 잊기 쉽습니다.</li>
          <li>상태 파일을 잘못 병합하거나, 잘못된 상태 파일을 사용하는 경우가 발생할 수 있습니다.</li>
        </ul>
      </li>
      <li>잠금
        <ul>
          <li>VCS 사용시 잠금 기능을 사용할 수 없습니다.</li>
        </ul>
      </li>
      <li>민감한 정보
        <ul>
          <li>민감한 정보가 평문으로 저장되어 VCS 에 권한이 있는 사람은 누구나 볼 수 있어서 노출 위협이 있습니다.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>이러한 문제점을 해결하기 위해 테라폼 클라우드에서는 안전하게 상태를 관리하는 기능을 제공합니다.</li>
</ul>

<h4 id="원격지원-백엔드">원격지원 백엔드</h4>
<ul>
  <li>테라폼 클라우드를 사용하지 않는 경우는 원격 백엔드를 사용하면 어느정도 해결이 가능합니다.
    <ul>
      <li>수동 오류 해결 : plan/apply 시 백엔드에 최신의 상태가 저장 됩니다.</li>
      <li>잠금 : 백엔드에서 잠금 기능을 제공합니다. <code class="language-plaintext highlighter-rouge">-lock-timeout=&lt;TIME&gt;</code>로 잠금 대기 시간을 설정할 수 있습니다.</li>
      <li>민감한 정보 : 대부분의 백엔드는 민감한 정보를 암호화하여 저장합니다. 또한 권한관리 기능으로 상태 파일에 대한 접근을 차단할 수 있습니다.</li>
    </ul>
  </li>
  <li>원격 백엔드 종류 : AWS S3, Azure Blob Storage, Google Cloud Storage, HashiCorp Consul 등</li>
</ul>

<h4 id="state-동기화">State 동기화</h4>

<ul>
  <li>테라폼은 구성 파일과 기존 State와 실제 리소스 구성을 비교하여 변경 사항을 찾아내고 적용합니다.
    <ul>
      <li>테라폼 구성과 State 흐름
<img src="/assets/2024/20240704_terraform_w4_state_sync.png" alt="img.png">
출처 : <a href="https://kschoi728.tistory.com/135">https://kschoi728.tistory.com/135</a>
        <ul>
          <li>plan과 apply 중 리소스에 발생할 수 있는 네 가지 변경 사항이 있고, 아래의 출력 기호로 표시 되었습니다.
            <ul>
              <li>
<code class="language-plaintext highlighter-rouge">+ create</code> : 리소스의 생성</li>
              <li>
<code class="language-plaintext highlighter-rouge">- destroy</code> : 리소스의 삭제</li>
              <li>
<code class="language-plaintext highlighter-rouge">-/+ replace</code> : 삭제 후 생성 (<code class="language-plaintext highlighter-rouge">lifecycle</code>의 <code class="language-plaintext highlighter-rouge">create_before_destroy</code> 설정시 생성 후 삭제 설정이 가능합니다.)</li>
              <li>
<code class="language-plaintext highlighter-rouge">~ update in-place</code> : 리소스가 있는 상태에서 일부 상태만 업데이트</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>유형별 실습 + 문제사항 -&gt; 복구 import
    <ul>
      <li>
        <p>테라폼 구성에 추가된 리소스와 State에 따라 어떤 동작이 발생하는지 표로 정리하였습니다.</p>

        <table>
          <thead>
            <tr>
              <th>유형</th>
              <th>구성 리소스 정의(.tf)</th>
              <th>State 구성 데이터</th>
              <th>실제 리소스</th>
              <th>기본 예상 동작</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>있음</td>
              <td> </td>
              <td> </td>
              <td>리소스 생성</td>
            </tr>
            <tr>
              <td>2</td>
              <td>있음</td>
              <td>있음</td>
              <td> </td>
              <td>리소스 생성</td>
            </tr>
            <tr>
              <td>3</td>
              <td>있음</td>
              <td>있음</td>
              <td>있음</td>
              <td>동작 없음</td>
            </tr>
            <tr>
              <td>4</td>
              <td> </td>
              <td>있음</td>
              <td>있음</td>
              <td>리소스 삭제</td>
            </tr>
            <tr>
              <td>5</td>
              <td> </td>
              <td> </td>
              <td>있음</td>
              <td>동작 없음</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>유형 1 : 신규 리소스 정의 -&gt; Apply -&gt; 리소스 생성
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"peter_test"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_iam_user"</span> <span class="s2">"peter_iamuser1"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">1"</span>
<span class="p">}</span>
    
<span class="k">resource</span> <span class="s2">"aws_iam_user"</span> <span class="s2">"peter_iamuser2"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">2"</span>
<span class="p">}</span>     
</code></pre></div>        </div>
        <ul>
          <li>실행
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># 첫번째 실행. 기존에 iam 이 없기 때문에 리소스가 생성됩니다.</span>
      
<span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span>
      
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> terraform.tfstate
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq 
      
<span class="c"># main.tf 수정없이 두번째 실행. 변경사항이 없기 때문에 아무런 동작을 하지 않습니다. (유형 3)</span>
      
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; No changes. Your infrastructure matches the configuration.</span>
<span class="c">#    ...</span>
<span class="c">#    Apply complete! Resources: 0 added, 0 changed, 0 destroyed.</span>
      
<span class="c"># iam 사용자 리스트 확인</span>
<span class="nv">$ </span>aws iam list-users | jq
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>유형 2 : 실제 리소스 수동제거 -&gt; Apply =&gt; 리소스 생성
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># 실제 리소스 수동 제거</span>
<span class="nv">$ </span>aws iam delete-user <span class="nt">--user-name</span> peter_test1
<span class="nv">$ </span>aws iam delete-user <span class="nt">--user-name</span> peter_test2
    
<span class="c"># iam 사용자 리스트에서 실제 삭제됨을 확인 </span>
<span class="nv">$ </span>aws iam list-users | jq
    
<span class="nv">$ </span>terraform plan
<span class="c"># =&gt; ...</span>
<span class="c">#    Plan: 2 to add, 0 to change, 0 to destroy.</span>
</code></pre></div>        </div>
        <p>이와 같이 리소스 구성정의(main.tf)을 수정하지 않고 실제 리소스가 제거되면
테라폼이 실제 리소스와 상태 파일을 비교해서 차이를 인지하고 동일하게 상태를 만들기위해 
리소스를 생성하려 합니다.</p>
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform plan <span class="nt">-refresh</span><span class="o">=</span><span class="nb">false</span>
<span class="c"># =&gt; No changes. Your infrastructure matches the configuration.</span>
</code></pre></div>        </div>
        <p>하지만 <code class="language-plaintext highlighter-rouge">-refresh=false</code> 옵션을 주어 강제로 실제 리소스를 refresh 하지 않도록 하면
리소스 구성정의와 상태 파일만을 비교하게 됩니다.
<code class="language-plaintext highlighter-rouge">-refresh=false</code> 을 준 상태에서는 상태파일과 리소스 구성정의가 일치하므로 변경사항이 없습니다.</p>

        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Apply complete! Resources: 2 added, 0 changed, 0 destroyed. </span>
</code></pre></div>        </div>
        <p><code class="language-plaintext highlighter-rouge">-refresh=false</code> 옵션을 주지 않고 <code class="language-plaintext highlighter-rouge">apply</code> 시키면 테라폼이 똑똑하게 실제 리소스와의 차이를 인식하여
수동 제거된 리소스를 생성합니다.</p>
      </li>
      <li>유형 3 : 코드, 상태, 실제 리소스가 일치하는 경우
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq .serial
<span class="c"># =&gt; 8 </span>

<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq .serial
<span class="c"># =&gt; 8 </span>

<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq .serial
<span class="c"># =&gt; 8 </span>
</code></pre></div>        </div>
        <p>코드, 상태, 실제 리소스가 일치하는 경우 아무 동작을 하지 않으며 상태파일의 <code class="language-plaintext highlighter-rouge">serial</code>도 변하지 않습니다.</p>
      </li>
      <li>유형 4 : 리소스 구성정의에서 일부 리소스 삭제 -&gt; Apply
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf </span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"peter_test"</span>
<span class="p">}</span>
      
<span class="k">resource</span> <span class="s2">"aws_iam_user"</span> <span class="s2">"peter_iamuser1"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="kd">local</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">1"</span>
<span class="p">}</span>
      
<span class="c1"># peter_test2 리소스를 구성정의에서 삭제</span>
</code></pre></div>        </div>
        <ul>
          <li>실행
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Apply complete! Resources: 0 added, 0 changed, 1 destroyed.</span>
        
<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.tfstate
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
             
<span class="c"># iam 사용자 리스트에서 삭제됨을 확인</span>
<span class="nv">$ </span>aws iam list-users | jq
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>유형 5 : 실제 리소스만 존재하는 경우
상태파일에는 리소스가 존재하지 않지만 실제 리소스는 존재하는 경우
테라폼과 연결고리가 없기 때문에, 실제 존재하는 리소스는 테라폼에서는 없는 것으로 보입니다.
또한 리소스 구성정의 파일에도 없기 때문에 아무런 동작을 하지 않습니다.</li>
      <li>유형 6 : 실수로 tfstate 파일이 삭제 된 경우
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform state list
<span class="c"># =&gt; aws_iam_user.peter_iamuser1</span>
    
<span class="c"># 상태 파일 삭제</span>
<span class="nv">$ </span><span class="nb">rm </span>terraform.tfstate<span class="k">*</span>
    
<span class="c"># terraform plan시 실제 리소스에 연결고리가 없기 때문에, 실제 리소스가 없다고 판한하고 리소스를 생성하려 합니다.</span>
<span class="nv">$ </span>terraform plan
<span class="c"># =&gt; Plan: 1 to add, 0 to change, 0 to destroy.</span>
    
<span class="c"># 실제 리소스를 확인해보면 존재합니다.</span>
<span class="nv">$ </span>aws iam list-users | jq 
    
<span class="c"># 현재 상태에서 적용시 이미 존재하는 IAM을 만들려한다고 오류가 발생합니다.</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Error: creating IAM User (peter_test1): operation error IAM: CreateUser, ...</span>
    
<span class="c"># 상태 보기를 하면 상태 파일이 없는것을 확인할 수 있습니다.</span>
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; No state file was found!</span>
</code></pre></div>        </div>
        <p>상태 파일이 삭제되면 연결고리가 없어지면서 리소스를 생성하려 하지만, 실제 리소스에 동일한 이름의 IAM이 존재하여 실패하게 됩니다.</p>
        <ul>
          <li>해결 방법 : <code class="language-plaintext highlighter-rouge">import</code> 명령을 사용하여 state 파일을 복구합니다.</li>
        </ul>
      </li>
      <li>유형 7 : 실수로 삭제된 tfstate를 import로 복구
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">terraform import</code> 명령은 기존에 생성된 리소스를 테라폼의 상태 파일에 추가하는 명령입니다.
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># 실제 IAM 사용자 리스트 확인</span>
<span class="nv">$ </span>aws iam list-users | jq
      
<span class="c"># 실제 IAM 사용자의 이름을 가져와서 import 명령을 실행합니다.</span>
<span class="nv">$ </span>terraform import aws_iam_user.peter_iamuser1 peter_test1
<span class="c"># =&gt; aws_iam_user.peter_iamuser1: Importing from ID "peter_test1"...</span>
<span class="c">#    aws_iam_user.peter_iamuser1: Import prepared!</span>
<span class="c">#    Prepared aws_iam_user for import</span>
<span class="c">#    aws_iam_user.peter_iamuser1: Refreshing state... [id=peter_test1]</span>
<span class="c">#    </span>
<span class="c">#    Import successful!</span>
<span class="c">#    </span>
<span class="c">#    The resources that were imported are shown above. These resources are now in</span>
<span class="c">#    your Terraform state and will henceforth be managed by Terraform.</span>
      
<span class="c"># 상태 파일 확인하면 상태파일이 있고, aws_iam_user 리소스가 추가된것을 확인할 수 있습니다.</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq
      
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; aws_iam_user.peter_iamuser1</span>
      
<span class="c"># 실제 리소스와 상태 파일이 일치하여 변경사항이 없습니다.</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
</code></pre></div>            </div>
            <p>이와 같이 <code class="language-plaintext highlighter-rouge">terraform import</code> 명령을 사용하여 실수로 삭제된 상태 파일을 복구할 수 있습니다.
하지만 <code class="language-plaintext highlighter-rouge">import</code> 명령은 지정한 리소스만 복구할 수 있기 때문에, <strong>여러 리소스를 복구할 경우 어려움</strong>이 따릅니다.</p>
          </li>
          <li>따라서 상태파일을 S3의 버전관리 기능을 사용하는 등 <strong>잃어버리지 않도록 주의</strong>해야 합니다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="terraform-backend--aws-s3--dynamodb">Terraform Backend : AWS S3 + DynamoDB</h3>

<ul>
  <li>앞서 언급한것 처럼 로컬에서 상태파일을 관리할 경우 여러 문제점이 있어서 그것을 해결하기 위해 AWS S3 백엔드를 사용하여 
모든 팀원들이 하나의 상태를 공유하도록 할 수 있습니다.</li>
  <li>단, AWS <strong>S3만 사용시 동시성 잠금 관리가 되지 않기</strong> 때문에, <strong>DynamoDB 를 사용하여 잠금을 수행하여 보완</strong>할 수 있습니다.</li>
</ul>

<h4 id="악분님-실습-따라하기">악분님 실습 따라하기</h4>

<p>AWS S3와 DynamoDB를 사용한 상태 파일 관리를 악분님이 정리해주신 실습을 따라하며 살펴보겠습니다.
<a href="https://malwareanalysis.tistory.com/633#8.-state-%EB%B0%B1%EC%97%94%EB%93%9C">악분님 블로그 링크</a></p>

<ul>
  <li>사전준비 리모트 공용 저장소 AWS S3 생성
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/sungwook-practice/t101-study.git example
<span class="nv">$ </span><span class="nb">cd </span>example/state/step3_remote_backend/s3_backend 
  
<span class="c"># terraform.tfvars 파일을 수정하여 버킷명을 bucket_name = "&lt;닉네임&gt;-hello-tf1014-remote-backend" 로 수정합니다.</span>
<span class="c"># 저의 경우는 bucket_name = "peter-hello-tf1014-remote-backend" 가 되겠습니다.</span>
  
<span class="c"># S3 버킷 생성</span>
<span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
  
<span class="c"># 확인</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>aws s3 <span class="nb">ls</span>
<span class="c"># =&gt; 2024-07-XX 01:07:50 peter-hello-tf1014-remote-backend </span>
</code></pre></div>    </div>
  </li>
  <li>테라폼 백엔드를 AWS S3로 설정
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> ../vpc
<span class="nv">$ </span><span class="nb">ls</span>
<span class="nv">$ </span><span class="nb">cat </span>provider.tf
</code></pre></div>    </div>
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">provider.tf</code> 파일을 수정하여 백엔드를 S3로 설정합니다.
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
  <span class="c1"># bucket       = "&lt;닉네임&gt;-hello-tf1014-remote-backend"</span>
  <span class="nx">bucket</span>         <span class="p">=</span> <span class="s2">"peter-hello-tf1014-remote-backend"</span>
  <span class="nx">key</span>            <span class="p">=</span> <span class="s2">"terraform/state-test/terraform.tfstate"</span>
  <span class="nx">region</span>         <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
  <span class="c1"># dynamodb_table = "terraform-lock"</span>
<span class="p">}</span>
<span class="err">...</span>
</code></pre></div>        </div>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">terraform init</code> 명령을 실행하면 백엔드 설정이 적용됩니다.
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="c"># =&gt; Initializing the backend...</span>
<span class="c">#    Successfully configured the backend "s3"! Terraform will automatically</span>
<span class="c">#    ...    </span>
    
<span class="c"># 리소스 생성 </span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
    
<span class="nv">$ </span>terraform state list
    
<span class="c"># 상태는 있지만 상태파일(terraform.tfstate)이 없음을 확인</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.tfstate
<span class="c"># =&gt; 파일이 없습니다.</span>
    
<span class="c"># AWS S3 버킷 내에 tfstate 파일 확인</span>
<span class="nv">$ MYBUCKET</span><span class="o">=</span>peter-hello-tf1014-remote-backend
<span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://<span class="nv">$MYBUCKET</span> <span class="nt">--recursive</span> <span class="nt">--human-readable</span> <span class="nt">--summarize</span>
<span class="c"># =&gt; 2024-07-07 01:23:35    1.7 KiB terraform/state-test/terraform.tfstate</span>
<span class="c">#    Total Objects: 1</span>
<span class="c">#    Total Size: 1.7 KiB</span>
</code></pre></div>        </div>
        <p>상태가 로컬 파일이 아닌 S3에 저장됨을 확인하였습니다. 하지만 이 상태에서는 동시성 문제가 발생할 수 있기 때문에 DynamoDB를 추가하여 잠금을 설정하겠습니다.</p>
      </li>
    </ul>
  </li>
  <li>DynamoDB 생성
    <ul>
      <li>테라폼에서 DynamoDB 잠금을 사용하기 위해서는 LockID 라는 기본 키가 있는 테이블을 생성해야 됩니다.
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> ../dynamodb
<span class="nv">$ </span><span class="nb">ls</span> 
<span class="nv">$ </span><span class="nb">cat </span>main.tf  
  
<span class="c"># DynamoDB 생성</span>
<span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
  
<span class="c"># 확인</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show aws_dynamodb_table.terraform_state_lock
  
<span class="c"># DynamoDB 테이블 확인</span>
<span class="nv">$ </span>aws dynamodb list-tables <span class="nt">--output</span> text
<span class="c"># =&gt; TABLENAMES   terraform-lock</span>
<span class="nv">$ </span>aws dynamodb describe-table <span class="nt">--table-name</span> terraform-lock | jq
<span class="nv">$ </span>aws dynamodb describe-table <span class="nt">--table-name</span> terraform-lock <span class="nt">--output</span> table
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>테라폼 백엔드 설정에 dynamodb_table 속성을 적용
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> ../vpc 
  
<span class="c"># vscode에서 provider.tf 수정</span>
<span class="nv">$ </span>code provider.tf 
</code></pre></div>    </div>
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">provider.tf</code> 파일을 수정하여 <code class="language-plaintext highlighter-rouge">dynamodb_table = "terraform-lock"</code>을 추가합니다.
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
  <span class="nx">bucket</span>         <span class="p">=</span> <span class="s2">"peter-hello-tf1014-remote-backend"</span>
  <span class="nx">key</span>            <span class="p">=</span> <span class="s2">"terraform/state-test/terraform.tfstate"</span>
  <span class="nx">region</span>         <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>
  <span class="nx">dynamodb_table</span> <span class="p">=</span> <span class="s2">"terraform-lock"</span>   <span class="c1"># 추가</span>
<span class="p">}</span>
<span class="err">...</span>
</code></pre></div>        </div>
      </li>
      <li>백엔드 설정이 바꼈으므로 <code class="language-plaintext highlighter-rouge">terraform init</code> 명령을 실행합니다.
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="nt">-migrate-state</span>
<span class="c"># =&gt; Initializing the backend...</span>
<span class="c">#    Backend configuration changed!</span>
<span class="c">#    ...</span>
</code></pre></div>        </div>
      </li>
      <li>VPC의 tag 수정 후 apply와 Locking 확인
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf 수정 </span>
<span class="k">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">vpc_cidr</span>
    
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="c1"># Name = "terraform VPC"</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"terraform VPC 2"</span> <span class="c1"># 2추가</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">apply</code>를 실행하고 “Enter a value:”에서 대기하면서 Dynamo DB 테이블을 확인합니다.
            <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform apply
<span class="c"># =&gt; ...</span>
<span class="c">#    Enter a value: &lt;입력하지 않고 대기&gt;</span>
</code></pre></div>            </div>
          </li>
          <li>
            <p>AWS Console에서 DynamoDB의 lock 테이블을 확인합니다.
<img src="/assets/2024/20240704_terraform_w4_dynamo_lock.png" alt="20240704_terraform_w4_dynamo_lock.png"></p>

            <div class="language-json highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ID"</span><span class="p">:</span><span class="s2">"d210a853-3361-527a-dc34-8f6b310ba77b"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Operation"</span><span class="p">:</span><span class="s2">"OperationTypeApply"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Info"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Who"</span><span class="p">:</span><span class="s2">"peter"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"1.8.5"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Created"</span><span class="p">:</span><span class="s2">"2024-07-XXT16:38:55.21022Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Path"</span><span class="p">:</span><span class="s2">"peter-hello-tf1014-remote-backend/terraform/state-test/terraform.tfstate"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>            </div>
          </li>
          <li>
<code class="language-plaintext highlighter-rouge">apply</code>의 “Enter a value:”에 <code class="language-plaintext highlighter-rouge">yes</code>를 입력하여 apply하면 락이 해제됩니다. 이 상태에서 dynamodb를 확인하면 lock이 해제된것을 확인할 수 있습니다.
<img src="/assets/2024/20240704_terraform_w4_dynamo_unlock.png" alt="20240704_terraform_w4_dynamo_unlock.png">
</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>S3 버저닝 정보 확인
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># S3 버킷의 파일 확인</span>
<span class="nv">$ </span>aws s3 <span class="nb">ls </span>s3://<span class="nv">$MYBUCKET</span> <span class="nt">--recursive</span> <span class="nt">--human-readable</span> <span class="nt">--summarize</span>
<span class="c"># =&gt; 2024-07-07 01:50:50    1.7 KiB terraform/state-test/terraform.tfstate</span>
<span class="c"># </span>
<span class="c">#    Total Objects: 1</span>
<span class="c">#    Total Size: 1.7 KiB</span>
  
<span class="c"># 버저닝된 파일 확인</span>
<span class="nv">$ </span>aws s3api list-object-versions <span class="nt">--bucket</span> <span class="nv">$MYBUCKET</span> | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "Versions": [</span>
<span class="c">#        {</span>
<span class="c">#          "ETag": "\"f223f4da33dcd26ee1ee736212d57604\"",</span>
<span class="c">#          ...</span>
<span class="c">#          "Key": "terraform/state-test/terraform.tfstate",</span>
<span class="c">#          "VersionId": "wMK8alO1E2luobYHL1Bqj4RdbV1rLrv3",</span>
<span class="c">#          "IsLatest": true,</span>
<span class="c">#          "LastModified": "2024-07-XXT16:50:50+00:00",</span>
<span class="c">#          ...</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "ETag": "\"16bd360e57c83dee7ad657086cc8fc49\"",</span>
<span class="c">#          ...</span>
<span class="c">#          "Key": "terraform/state-test/terraform.tfstate",</span>
<span class="c">#          "VersionId": "8iagh8nWNMXeI.Ax5oEZJ38N684s5N3D",</span>
<span class="c">#          "IsLatest": false,</span>
<span class="c">#          "LastModified": "2024-07-XXT16:23:35+00:00",</span>
<span class="c">#          ...</span>
<span class="c">#        }</span>
<span class="c">#      ],</span>
<span class="c">#      "RequestCharged": null</span>
<span class="c">#    }</span>
</code></pre></div>    </div>
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">apply</code> 되어 상태가 변경 되면 S3에 버저닝된 파일이 생성됨을 확인 할 수 있습니다.</li>
      <li>S3 콘솔의 버킷에서도 버전 표시를 확인할 수 있습니다.
<img src="/assets/2024/20240704_terraform_w4_backend_s3.png" alt="20240704_terraform_w4_backend_s3">
</li>
    </ul>
  </li>
  <li>실습 리소스 삭제 : 리소스를 삭제하지 않으면 비용이 발생할 수 있습니다. 꼼꼼하게 잘 삭제하여 요금 폭탄을 막읍시다.
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># vpc 삭제 : 현재 vpc 디렉터리</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
  
<span class="c"># dynamoDB 삭제</span>
<span class="nv">$ </span><span class="nb">cd</span> ../dynamodb
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
  
<span class="c"># S3 삭제</span>
<span class="nv">$ </span><span class="nb">cd</span> ../s3_backend
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Error : (버킷이 비어있지 않다며 오류 발생합니다.)</span>
  
<span class="c"># 버킷 내용을 먼저 삭제 합니다.</span>
<span class="nv">$ </span>aws s3api delete-objects <span class="se">\</span>
    <span class="nt">--bucket</span> <span class="nv">$MYBUCKET</span> <span class="se">\</span>
    <span class="nt">--delete</span> <span class="s2">"</span><span class="si">$(</span>aws s3api list-object-versions <span class="se">\</span>
    <span class="nt">--bucket</span> <span class="s2">"</span><span class="nv">$MYBUCKET</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">--output</span><span class="o">=</span>json <span class="se">\</span>
    <span class="nt">--query</span><span class="o">=</span><span class="s1">'{Objects: Versions[].{Key:Key,VersionId:VersionId}}'</span><span class="si">)</span><span class="s2">"</span>
  
<span class="c"># S3 버킷에 삭제마커 삭제</span>
<span class="nv">$ </span>aws s3api delete-objects <span class="nt">--bucket</span> <span class="nv">$MYBUCKET</span> <span class="se">\</span>
    <span class="nt">--delete</span> <span class="s2">"</span><span class="si">$(</span>aws s3api list-object-versions <span class="nt">--bucket</span> <span class="s2">"</span><span class="nv">$MYBUCKET</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">--query</span><span class="o">=</span><span class="s1">'{Objects: DeleteMarkers[].{Key:Key,VersionId:VersionId}}'</span><span class="si">)</span><span class="s2">"</span>
  
<span class="c"># S3 삭제</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="테라폼-백엔드의-단점">테라폼 백엔드의 단점</h4>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">backend</code> 블록에는 변수나 참조를 사용할 수 없습니다.</li>
  <li>따라서 S3 버킷 이름, 리전, DynamoDB 테이블 이름을 하드코딩해야 합니다. 심지어 key 값은 중복이 되면 안 되며 고유해야 합니다.</li>
  <li>하지만 partial configuration 을 사용하여 일부 매개 변수를 전달하여 사용할 수 있습니다.
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># backend.hcl</span>
<span class="nx">bucket</span> <span class="err">=</span> <span class="s2">"terraform-up-and-running-state"</span>
<span class="nx">region</span> <span class="err">=</span> <span class="s2">"us-east-2"</span>
<span class="nx">dynamodb_table</span> <span class="err">=</span> <span class="s2">"terraform-Up-and-running-locks"</span>
<span class="nx">encrypt</span> <span class="err">=</span> <span class="kc">true</span> 
</code></pre></div>    </div>
    <ul>
      <li>이 경우에도 모듈마다 다른 key 값을 가져야 하므로 key 매개 변수는 테라폼 코드에 있어야 합니다.
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">key</span> <span class="p">=</span> <span class="s2">"example/terraform.tfstate"</span>
  <span class="p">}</span>
<span class="p">}</span>   
</code></pre></div>        </div>
      </li>
      <li>부분적으로 구성한 것을 사용하려면 <code class="language-plaintext highlighter-rouge">terraform init -backend-config=backend.hcl</code> 명령을 사용합니다.
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="nt">-backend-config</span><span class="o">=</span>backend.hcl
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>이러한 단점을 보완해주는 오픈 소스 테라그런트(Terragrunt)가 있습니다. 다음 <a href="https://terragrunt.gruntwork.io/">링크</a>를 참고하십시오.</li>
</ul>

<h3 id="워크스페이스">워크스페이스</h3>

<ul>
  <li>인프라를 구축할때는 dev(개발), stage(스테이지), prod(프로덕션) 등 개발 단계별로 각각 다른 환경을 구축해야 할 필요가 있습니다.</li>
  <li>이러한 환경을 구분하기 위해서는 파일 레이아웃을 사용하여 격리하거나 테라폼의 워크스페이스 기능을 사용할 수 있습니다.</li>
  <li>파일 레이아웃을 이용한 격리 (Isolation via file layout)
    <ul>
      <li>파일 레이아웃을 사용하여 각 환경별로 디렉터리를 나누어 구성하면 각 환경별로 구성을 분리할 수 있습니다.
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tree
<span class="c"># =&gt; .</span>
<span class="c">#    ├── common</span>
<span class="c">#    │   └── variables.tf</span>
<span class="c">#    ├── dev</span>
<span class="c">#    │   ├── vpc</span>
<span class="c">#    │   │   ├── main.tf</span>
<span class="c">#    │   │   └── variables.tf</span>
<span class="c">#    │   ├── main.tf</span>
<span class="c">#    │   └── variables.tf</span>
<span class="c">#    ├── prod</span>
<span class="c">#    │   ├── vpc</span>
<span class="c">#    │   │   ├── main.tf</span>
<span class="c">#    │   │   └── variables.tf</span>
<span class="c">#    │   ├── main.tf</span>
<span class="c">#    │   └── variables.tf</span>
<span class="c">#    └── stage</span>
<span class="c">#        ├── vpc</span>
<span class="c">#        │   ├── main.tf</span>
<span class="c">#        │   └── variables.tf</span>
<span class="c">#        ├── main.tf</span>
<span class="c">#        └── variables.tf</span>
</code></pre></div>        </div>
      </li>
      <li>환경별로 완전히 독립시켜 원하는 데로 구성할 수 있는 강력한 방법이지만, 
동일한 파일도 환경별로 복사해야 할 수 있으며, 따라서 리소스 수가 많아지면 관리가 어려울 수 있습니다.</li>
      <li>공용 .tf 파일을 만들어서 각 환경별로 사용하면 중복을 줄일 수 있습니다.</li>
    </ul>
  </li>
  <li>테라폼 워크스페이스 기능을 통한 격리 (Isolation via workspaces)
    <ul>
      <li>동일한 구성에서 빠르고 격리된 환경을 만들 수 있습니다.</li>
      <li>실습
        <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># 현재 워크스페이스 목록 확인</span>
<span class="nv">$ </span>terraform workspace list 
<span class="c"># =&gt; * default</span>
</code></pre></div>        </div>
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">main.tf</code> 생성
            <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"peter_srv1"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-0ea4d4b8dc1e46212"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"t101-study"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>            </div>
          </li>
          <li>실행
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
      
<span class="nv">$ </span>terraform state list 
      
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 43.201.149.141</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.private_ip'</span>
<span class="c"># =&gt; 172.31.8.91</span>
      
<span class="c"># 워크스페이스 확인</span>
<span class="nv">$ </span>terraform workspace list
<span class="c"># =&gt; * default</span>
      
<span class="c"># graph 확인</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>            </div>

            <svg width="173pt" height="44pt" viewbox="0.00 0.00 173.25 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-40 169.25,-40 169.25,4 -4,4"></polygon>
<!-- aws_instance.peter_srv1 -->
<g id="node1" class="node">
<title>aws_instance.peter_srv1</title>
<polygon fill="none" stroke="black" points="165.25,-36 0,-36 0,0 165.25,0 165.25,-36"></polygon>
<text text-anchor="middle" x="82.62" y="-12.2" font-family="sans-serif" font-size="14.00">aws_instance.peter_srv1</text>
</g>
</g>
</svg>
          </li>
          <li>신규 워크스페이스 생성
            <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># 새 작업 공간 workspace 생성 : mywork1</span>
<span class="nv">$ </span>terraform workspace new mywork1
<span class="nv">$ </span>terraform workspace show               
<span class="c"># =&gt; mywork1</span>
      
<span class="c"># 서브 디렉터리 확인</span>
<span class="nv">$ </span>tree terraform.tfstate.d
<span class="c"># =&gt; terraform.tfstate.d</span>
<span class="c">#    └── mywork1</span>
      
<span class="c"># plan 시 새로운 작업공간이라서 별도의 상태파일을 사용하여 리소스를 생성하는 계획이 만들어집니다.</span>
<span class="nv">$ </span>terraform plan
<span class="c"># =&gt; ...</span>
<span class="c">#    Plan: 1 to add, 0 to change, 0 to destroy.</span>
      
<span class="c"># apply 해보겠습니다.</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
            
<span class="c"># 워크스페이스 확인</span>
<span class="nv">$ </span>terraform workspace list
<span class="c"># =&gt;   default</span>
<span class="c">#    * mywork1</span>
      
<span class="c"># 상태 파일을 확인합니다.</span>
<span class="c"># default(기본) 워크스페이스의 상태 파일은 terraform.tfstate이고, mywork1 워크스페이스의 상태 파일은 terraform.tfstate.d/mywork1/terraform.tfstate 로 생성됩니다.</span>
      
<span class="c"># default 워크스페이스의 상태 파일에서 ip 확인</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 43.201.149.141          </span>
      
<span class="c"># mywork1 워크스페이스의 상태 파일에서 ip 확인</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate.d/mywork1/terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 13.125.64.96</span>
      
<span class="c"># graph 확인</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
            
<span class="c"># 새 작업 공간 workspace 생성 : mywork2</span>
<span class="nv">$ </span>terraform workspace new mywork2
      
<span class="c"># 서브 디렉터리 확인</span>
<span class="nv">$ </span>tree terraform.tfstate.d
<span class="c"># =&gt; terraform.tfstate.d</span>
<span class="c">#    ├── mywork1</span>
<span class="c">#    │   └── terraform.tfstate</span>
<span class="c">#    └── mywork2</span>
      
<span class="c"># plan &amp; apply</span>
<span class="nv">$ </span>terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
      
<span class="c"># mywork2에서 apply 후 서브 디렉터리 확인</span>
<span class="nv">$ </span>tree terraform.tfstate.d
<span class="c"># =&gt; terraform.tfstate.d</span>
<span class="c">#    ├── mywork1</span>
<span class="c">#    │   └── terraform.tfstate</span>
<span class="c">#    └── mywork2</span>
<span class="c">#        └── terraform.tfstate</span>
      
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 43.201.149.141</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate.d/mywork1/terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 13.125.64.96</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate.d/mywork2/terraform.tfstate | jq <span class="nt">-r</span> <span class="s1">'.resources[0].instances[0].attributes.public_ip'</span>
<span class="c"># =&gt; 13.124.42.129</span>
      
<span class="c"># workspace 정보 확인</span>
<span class="nv">$ </span>terraform workspace show
<span class="c"># =&gt; mywork2</span>
<span class="nv">$ </span>terraform workspace list
<span class="c"># =&gt;   default</span>
<span class="c">#      mywork1</span>
<span class="c">#    * mywork2</span>
      
<span class="c"># 실습 리소스 삭제</span>
<span class="nv">$ </span>terraform workspace <span class="k">select </span>default
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
      
<span class="nv">$ </span>terraform workspace <span class="k">select </span>mywork1
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
      
<span class="nv">$ </span>terraform workspace <span class="k">select </span>mywork2
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>      
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>
<strong>장점</strong>
        <ul>
          <li>하나의 <strong>루트 모듈</strong>에서 다른 환경을 위한 리소스를 동일한 <strong>테라폼 구성</strong>으로 프로비저닝하고 관리합니다.</li>
          <li>기존 프로비저닝된 환경에 영향을 주지 않고 변경 사항 실험 가능합니다.</li>
          <li>깃의 브랜치 전략처럼 동일한 구성에서 서로 다른 리소스 결과 관리 가능합니다.</li>
        </ul>
      </li>
      <li>
<strong>단점</strong>
        <ul>
          <li>State가 동일한 저장소(로컬 또는 백엔드)에 저장되어 State 접근 권한 관리가 불가능합니다.</li>
          <li>모든 환경이 동일한 리소스를 요구하지 않을 수 있으므로 테라폼 구성에 분기 처리가 다수 발생 가능이 있습니다.</li>
          <li>프로비저닝 대상에 대한 인증 요소를 완벽히 분리할 수 없습니다.</li>
          <li>가장 <strong>큰 단점은 완벽한 격리가 불가능</strong>하다는 것입니다.
            <ul>
              <li>보완 방법
                <ol>
                  <li>해결하기 위해 루트 모듈을 별도로 구성하는 디렉터리 기반의 레이아웃을 사용</li>
                  <li>Terraform Cloud 환경의 워크스페이스를 활용</li>
                </ol>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="마치며">마치며</h2>

<p>이번 주에는 프로바이더와 상태에 대해 보다 자세히 살펴보았습니다.
3주 동안 막연하게 사용하던 프로바이더와 상태에 대해 좀더 명확하게 이해할 수 있었습니다.</p>

<p>상태 관리에 대해서는 실무에서 팀, 회사 단위에서 테라폼을 사용할때 어려움을 많이 겪을 수 있겠다 라는 생각이 들었습니다.
반복된 교육과 사용으로 내제화 되기전에는 시행 착오를 많이 거쳐야할 것 같습니다. 
이번 스터디를 통해서 상당수의 시행 착오는 단축할 수 있었던거 같습니다.</p>

<p>정말 좋은 스터디를 진행해 주시는 Gasida님과 실습을 만들어주신 악분님께 감사드립니다. <img class="emoji" title=":pray:" alt=":pray:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f64f.png" height="20" width="20"></p>

  </div>

  <div id="toc-minimap" class="toc-minimap collapsed">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">들어가며</a></li>
<li class="toc-entry toc-h2">
<a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-provider">프로바이더 (Provider)</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#provider-%EC%84%A4%EC%A0%95">Provider 설정</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EB%A1%9C%EC%BB%AC-%EC%9D%B4%EB%A6%84%EA%B3%BC-%EB%AA%85%EC%8B%9C%EC%A0%81-%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EC%A7%80%EC%A0%95">로컬 이름과 명시적 프로바이더 지정</a></li>
<li class="toc-entry toc-h4"><a href="#%EB%8B%A8%EC%9D%BC-%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94%EC%9D%98-%EB%8B%A4%EC%A4%91-%EC%A0%95%EC%9D%98">단일 프로바이더의 다중 정의</a></li>
<li class="toc-entry toc-h4"><a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EC%A0%95%EC%9D%98">프로바이더 요구사항 정의</a></li>
<li class="toc-entry toc-h4"><a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EC%84%A4%EC%B9%98">프로바이더 설치</a></li>
<li class="toc-entry toc-h4"><a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EA%B0%84-%EC%A0%84%ED%99%98-%EC%97%AC%EB%B6%80">프로바이더 간 전환 여부</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94-%EC%97%90%EC%BD%94-%EC%8B%9C%EC%8A%A4%ED%85%9C">프로바이더 에코 시스템</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#%EC%83%81%ED%83%9C-state">상태 (State)</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#state%EC%9D%98-%EB%AA%A9%EC%A0%81%EA%B3%BC-%EC%9D%98%EB%AF%B8">State의 목적과 의미</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EB%A9%B1%EB%93%B1%EC%84%B1-idempotency">멱등성 (Idempotency)</a></li>
<li class="toc-entry toc-h4"><a href="#%EC%83%81%ED%83%9C-%ED%8C%8C%EC%9D%BC%EC%9D%84-%ED%8C%80-%EB%8B%A8%EC%9C%84%EC%97%90%EC%84%9C-%ED%85%8C%EB%9D%BC%ED%8F%BC-%EC%9A%B4%EC%98%81%EC%8B%9C-%EB%AC%B8%EC%A0%9C%EC%A0%90">상태 파일을 팀 단위에서 테라폼 운영시 문제점</a></li>
<li class="toc-entry toc-h4"><a href="#%EC%9B%90%EA%B2%A9%EC%A7%80%EC%9B%90-%EB%B0%B1%EC%97%94%EB%93%9C">원격지원 백엔드</a></li>
<li class="toc-entry toc-h4"><a href="#state-%EB%8F%99%EA%B8%B0%ED%99%94">State 동기화</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#terraform-backend--aws-s3--dynamodb">Terraform Backend : AWS S3 + DynamoDB</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EC%95%85%EB%B6%84%EB%8B%98-%EC%8B%A4%EC%8A%B5-%EB%94%B0%EB%9D%BC%ED%95%98%EA%B8%B0">악분님 실습 따라하기</a></li>
<li class="toc-entry toc-h4"><a href="#%ED%85%8C%EB%9D%BC%ED%8F%BC-%EB%B0%B1%EC%97%94%EB%93%9C%EC%9D%98-%EB%8B%A8%EC%A0%90">테라폼 백엔드의 단점</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#%EC%9B%8C%ED%81%AC%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4">워크스페이스</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">마치며</a></li>
</ul>
  </div>
<a class="u-url" href="/posts/2024-07-06-T101-Study-Terraform-Week-4/" hidden></a>
</article>



<div class="PageNavigation">
  
  <a class="prev" href="/posts/2024-06-30-T101-Study-Terraform-Week-3/">« [T101 4기] 테라폼 기본 사용법 3/3</a>
  
  
  <a class="next" href="/posts/2024-07-10-T101-Study-Terraform-Week-5/">[T101 4기] Module »</a>
  
</div>

<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = "https://sweetlittlebird.github.io/posts/2024-07-06-T101-Study-Terraform-Week-4/";
this.page.identifier = "/posts/T101 Study - Terraform Week 4";
};
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Sweet Little Bird</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Sweet Little Bird</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/sweetlittlebird"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sweetlittlebird</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>공부 기록과 개발 이야기를 담은 블로그입니다.</p>
      </div>
    </div>

  </div>

</footer>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EWGY9N8QXY"></script>

    
    <script src="/assets/dist/app.min.js"></script>
    
  
    <a href="#" id="back-to-top"><span>Back to Top</span></a>
  </body>

</html>
