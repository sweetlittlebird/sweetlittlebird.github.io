<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[T101 4기] Module | Sweet Little Bird</title>
<meta name="generator" content="Jekyll v4.3.3">
<meta property="og:title" content="[T101 4기] Module">
<meta property="og:locale" content="ko">
<meta name="description" content="이번 주에는 Module과 Runner에 대해 테라폼으로 시작하는 IaC를 통해 알아 보겠습니다.">
<meta property="og:description" content="이번 주에는 Module과 Runner에 대해 테라폼으로 시작하는 IaC를 통해 알아 보겠습니다.">
<link rel="canonical" href="https://sweetlittlebird.github.io/posts/2024-07-10-T101-Study-Terraform-Week-5/">
<meta property="og:url" content="https://sweetlittlebird.github.io/posts/2024-07-10-T101-Study-Terraform-Week-5/">
<meta property="og:site_name" content="Sweet Little Bird">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-07-10T02:08:00+09:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="[T101 4기] Module">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-07-10T02:08:00+09:00","datePublished":"2024-07-10T02:08:00+09:00","description":"이번 주에는 Module과 Runner에 대해 테라폼으로 시작하는 IaC를 통해 알아 보겠습니다.","headline":"[T101 4기] Module","mainEntityOfPage":{"@type":"WebPage","@id":"https://sweetlittlebird.github.io/posts/2024-07-10-T101-Study-Terraform-Week-5/"},"url":"https://sweetlittlebird.github.io/posts/2024-07-10-T101-Study-Terraform-Week-5/"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/dist/photoswipe.min.css">
  <link rel="stylesheet" href="/assets/dist/main.min.css">
  <link rel="stylesheet" href="/assets/dist/main_dark.min.css" media="(prefers-color-scheme: dark)">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pretendard/1.3.9/static/pretendard.css" integrity="sha512-NzqTHTrO48HsIamogmIaVhTXoSgRF24Cn+ynrNYrFuKrY0AdDbmcNieiOHsQARS/r0Gax9VwV3/rVMHs3ipUlg==" crossorigin="anonymous" referrerpolicy="no-referrer">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!--  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&display=swap" rel="stylesheet">-->
  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&amp;family=Milonga&amp;display=swap" rel="stylesheet">

  <link rel="shortcut icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
<link type="application/atom+xml" rel="alternate" href="https://sweetlittlebird.github.io/feed.xml" title="Sweet Little Bird">
</head>
<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Sweet Little Bird</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/about/">소개</a><a class="page-link" href="/posts/">글 목록</a>
</div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[T101 4기] Module</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-07-10T02:08:00+09:00" itemprop="datePublished">2024년 07월 10일에 작성
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="table-of-content">
      <header>목차</header>
      <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">들어가며</a></li>
<li class="toc-entry toc-h2">
<a href="#module">Module</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#module%EC%9D%98-%EA%B0%9C%EC%9A%94">Module의 개요</a>
<ul>
<li class="toc-entry toc-h4"><a href="#module%EC%9D%98-%EA%B5%AC%EC%84%B1">Module의 구성</a></li>
<li class="toc-entry toc-h4"><a href="#module%EC%9D%98-%EC%9E%A5%EC%A0%90">Module의 장점</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#%EB%AA%A8%EB%93%88-%EC%9E%91%EC%84%B1%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EC%9B%90%EC%B9%99">모듈 작성의 기본 원칙</a></li>
<li class="toc-entry toc-h3">
<a href="#%EB%AA%A8%EB%93%88%ED%99%94-%ED%95%B4%EB%B3%B4%EA%B8%B0">모듈화 해보기</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EC%8B%A4%EC%8A%B5-1-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0">실습 1. 비밀번호 생성하기</a></li>
<li class="toc-entry toc-h4"><a href="#%EC%8B%A4%EC%8A%B5-2-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EC%83%9D%EC%84%B1%ED%95%98%EB%8A%94-%EB%AA%A8%EB%93%88%EC%9D%84-%EB%A3%A8%ED%8A%B8-%EB%AA%A8%EB%93%88%EC%97%90%EC%84%9C-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0">실습 2. 비밀번호 생성하는 모듈을 루트 모듈에서 호출하기</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#%EB%AA%A8%EB%93%88-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EC%8B%9D">모듈 사용 방식</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EB%AA%A8%EB%93%88%EA%B3%BC-%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94">모듈과 프로바이더</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#%EB%AA%A8%EB%93%88-%EC%86%8C%EC%8A%A4-%EA%B4%80%EB%A6%AC">모듈 소스 관리</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EC%B0%B8%EC%A1%B0-%EC%98%88%EC%A0%9C">참조 예제</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">마치며</a></li>
</ul>
    </div>
    <h2 id="들어가며">들어가며</h2>

<p>이번 주에는 <code class="language-plaintext highlighter-rouge">Module</code>과 <code class="language-plaintext highlighter-rouge">Runner</code>에 대해
<a href="https://product.kyobobook.co.kr/detail/S000202478097">테라폼으로 시작하는 IaC</a>를 통해 알아 보겠습니다.</p>

<blockquote>
  <p><img src="/assets/2024/t101-4th/20240614_terraform_book.jpg" alt="테라폼으로 시작하는 IaC" loading="lazy" width="458" height="589"></p>

  <p><a href="https://product.kyobobook.co.kr/detail/S000202478097">테라폼으로 시작하는 IaC</a></p>
</blockquote>

<h2 id="module">Module</h2>

<h3 id="module의-개요">Module의 개요</h3>

<p>테라폼으로 인프라와 서비스를 오랜 기간 관리하다보면 시간이 지날수록 관리하는 리소스가 늘어나면서 구성이 복잡해집니다. 마치 함수 하나가 수천줄 코드로 구성된 C 코드처럼, 다음과 같은 문제점이 발생합니다.</p>
<ol>
  <li>원하는 항목을 찾기 어렵고, 수정하기 어려워짐</li>
  <li>리소스간의 연관 관계가 복잡해져서 수정하기 어려워짐</li>
  <li>개발/스테이징/프로덕션 환경등으로 구분된 경우 코드 중복으로 업무효율이 줄어듬</li>
  <li>새로운 프로젝트를 구성할 경우 기존 코드를 복사하여 수정하는 방식으로 진행되어 코드 중복이 발생하고 종속성 파악이 어려움</li>
</ol>

<p>모듈은 테라폼 코드를 <strong>구조화</strong>하고 <strong>재사용 가능</strong>한 코드를 만들 수 있게 하여 이러한 <strong>문제점들을 해소</strong>해줍니다.</p>

<p><img src="/assets/2024/t101-4th/20240711_terraform_w5_module.png" alt="모듈과 모듈간 정의를 통한 프로비저닝 과정" class="image-center" loading="lazy" width="467" height="312">
<em class="image-caption">모듈과 모듈간 정의를 통한 프로비저닝 과정</em></p>

<p>모듈을 통한 프로비저닝 과정은 위와 같으며, 루트 모듈이 자식 모듈을 사용하여 프로비저닝을 하게 되는데 이 구조에 대해 살펴 보겠습니다.</p>

<h4 id="module의-구성">Module의 구성</h4>

<p>모듈은 크게 루트 모듈과 자식 모듈로 나뉩니다.</p>

<ul>
  <li>루트 모듈 (Root Module) : 테라폼 코드를 실행하는 최상위 모듈</li>
  <li>자식 모듈 (Child Module) : 루트 모듈에서 호출되는 모듈</li>
</ul>

<p>모듈은 루트 모듈과 자식 모듈은 모두 <strong>입력 변수</strong>를 받아서 Provider를 통해 리소스를 생성하는 등의 작업을 하고 <strong>결과를 출력</strong>하는 구조로 구성됩니다.</p>

<p><img src="/assets/2024/t101-4th/20240711_terraform_w5_module_root_module.png" alt="20240711_terraform_w5_module_root_module.png" class="image-center" loading="lazy" width="434" height="227">
<em class="image-caption">모듈의 기본 구조</em></p>

<p>위의 그림처럼 모듈은 레고 블럭같이 여러개를 조합하여 사용할 수 있습니다. 루트 모듈은 자식 모듈을 호출하고, 자식 모듈은 다른 자식 모듈을 호출할 수 있습니다.
이렇게 모듈로 만드는것을 <strong>모듈화</strong>라고 하며, 이를 통해 재사용성과 표준화된 구조를 구성할 수 있습니다.</p>

<p><img src="/assets/2024/t101-4th/20240711_terraform_w5_module_composite.png" alt="20240711_terraform_w5_module_composite.png" class="image-center" loading="lazy" width="574" height="324">
<em class="image-caption">루트 모듈과 자식 모듈</em></p>

<p>또한  기존에 작성된 모듈을 다른 모듈에서 참조해 사용할 수 있으며, 리소스와 유사하게 사용할 수 있습니다.</p>

<h4 id="module의-장점">Module의 장점</h4>

<p>모듈을 사용하면 다음과 같은 장점이 있습니다.</p>

<ul>
  <li>관리성 : 코드를 구조화하여 모듈 단위로 추가하거나 삭제하기 쉬워 관리가 용이해집니다.</li>
  <li>재사용성 : 모듈을 통해 코드를 재사용할 수 있어 개발 시간을 단축할 수 있습니다. 또한 parameter와 output 값을 통해 다양한 목적으로 재활용 가능합니다.</li>
  <li>캡슐화 : 각 모듈은 논리적으로 묶여져 독립적으로 프로비저닝 및 관리되며, 필요한 항목만 외부에 노출 시켜서 다른 모듈과 의존성을 줄일 수 있습니다.</li>
  <li>일관성과 표준화 : 모듈을 사용함으로써 중복을 줄이고, 구성을 일관성 있게 유지할 수 있습니다. 또한 검증된 모듈을 사용함으로써 표준화된 구성을 유지하고 보안 사고를 방지할 수 있습니다.</li>
</ul>

<h3 id="모듈-작성의-기본-원칙">모듈 작성의 기본 원칙</h3>

<p>모듈을 제대로 사용하기 위해서는 다음과 같은 기본 원칙을 지키길 추천합니다.</p>

<ul>
  <li>
<strong>모듈 디렉터리 형식을 <code class="language-plaintext highlighter-rouge">terraform-&lt;프로바이더 이름&gt;-&lt;모듈 이름&gt;</code> 형식으로 사용하기</strong> :
이 형식은 Terraform Cloud, Terraform Enterprise에서도 사용되는 방식으로, 
테라폼을 위한 것임을 밝히고, 어떤 프로바이더 리소스를 사용하는지, 어떤 모듈인지 쉽게 파악할 수 있습니다.</li>
  <li>
<strong>모듈을 독립적으로 관리하기</strong> : 리모트 모듈을 사용하지 않더라도 하위 모듈을 서브 디렉터리에 담지 않고,
독립된 모듈로 존재할 수 있도록 하는것을 추천합니다. 이렇게 하면 다른 프로젝트에서도 쉽게 사용할 수 있고,
VCS를 통해 버전관리하기도 수월합니다.</li>
  <li>
<strong>모듈 디렉터리 내에 <code class="language-plaintext highlighter-rouge">main.tf</code>, <code class="language-plaintext highlighter-rouge">variables.tf</code>, <code class="language-plaintext highlighter-rouge">outputs.tf</code> 파일을 포함하기</strong> :
이 파일들은 테라폼 코드를 작성할 때 필수적으로 사용되는 파일들로, 모듈을 사용하는 사람이 쉽게 파악할 수 있도록 구성합니다.</li>
  <li>
<strong>언제나 모듈화가 가능한 구조로 작성하기</strong> : 테라폼 리소스 구성 파일을 작성시 항상 모듈화 할 가능성을 염두해두고<br>
작성합니다. 이렇게 하면 리소스 구성 파일을 모듈화 할 때 추가적인 작업이 줄어들고, 일관성을 유지할 수 있게 도와줍니다.</li>
</ul>

<p>이외에도 <strong>공개된 테라폼 레지스트리의 모듈 참고하기</strong>, <strong>작성된 모듈을 팀 또는 커뮤니티와 공유하기</strong>도 추천합니다.</p>

<p>모듈을 독립적으로 관리하기 위해 루트 모듈의 하위 디렉터리에 두기 보다는,
루트 모듈과 같은 레벨에 <code class="language-plaintext highlighter-rouge">modules</code> 디렉터리를 두고, 아래에 각각의 모듈을 관리하기를 추천합니다.
다음과 같이 표현 할 수 있습니다.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 06-module-training
 ├── modules                    <span class="c"># child module home</span>
 │   └── terraform-random-pwgen
 │       ├── main.tf
 │       ├── outputs.tf
 │       └── variables.tf
 └── 06-01-basic                <span class="c"># root-module</span>
     └── main.tf
</code></pre></div></div>

<h3 id="모듈화-해보기">모듈화 해보기</h3>

<h4 id="실습-1-비밀번호-생성하기">실습 1. 비밀번호 생성하기</h4>

<p>모듈을 만드는 것을 실습하기 위해 비밀번호를 생성하는 모듈을 만들어 보겠습니다.</p>

<ul>
  <li>06-module-training/modules/terraform-random-pwgen/ 디렉터리에 main.tf, variable.tf, output.tf 파일을 생성
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">resource</span> <span class="s2">"random_pet"</span> <span class="s2">"name"</span> <span class="p">{</span>
  <span class="nx">keepers</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">ami_id</span> <span class="p">=</span> <span class="nx">timestamp</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"random_password"</span> <span class="s2">"password"</span> <span class="p">{</span>
  <span class="nx">length</span>           <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">isDB</span> <span class="err">?</span> <span class="mi">16</span> <span class="err">:</span> <span class="mi">10</span>
  <span class="nx">special</span>          <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">isDB</span> <span class="err">?</span> <span class="kc">true</span> <span class="err">:</span> <span class="kc">false</span>
  <span class="nx">override_special</span> <span class="p">=</span> <span class="s2">"!#</span><span class="err">$</span><span class="s2">%*?"</span>
<span class="p">}</span> 
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># variable.tf</span>
<span class="k">variable</span> <span class="s2">"isDB"</span> <span class="p">{</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="nx">bool</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="kc">false</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"패스워드 대상의 DB 여부"</span>
<span class="p">}</span>  
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># output.tf</span>
<span class="k">output</span> <span class="s2">"id"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">random_pet</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"pw"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">nonsensitive</span><span class="p">(</span><span class="nx">random_password</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span> 
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>자식 모듈 테스트
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan
  
<span class="c"># 변수 지정없이 apply</span>
  
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    id = "awaited-dodo"</span>
<span class="c">#    pw = "1tz5Cf4cuL"        # var.isDB가 기본값 false 여서 10자리 비밀번호가 생성됨</span>
  
<span class="c"># var.isDB=true 로 하여 apply</span>
  
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span> <span class="nt">-var</span><span class="o">=</span><span class="nv">isDB</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># =&gt; Apply complete! Resources: 2 added, 0 changed, 2 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    id = "flying-gorilla"</span>
<span class="c">#    pw = "8LMyxla5fK$WP8x?"  # var.isDB를 true로 주어 16자리 비밀번호가 생성됨</span>
  
<span class="c"># 상태 확인</span>
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show random_pet.name
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"random_pet.name.id"</span> | terraform console
<span class="c"># =&gt; "flying-gorilla"</span>
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"random_pet.name.keepers"</span> | terraform console
<span class="c"># =&gt; tomap({</span>
<span class="c">#      "ami_id" = "2024-07-11T15:04:58Z"</span>
<span class="c">#    })</span>
  
<span class="nv">$ </span>terraform state show random_password.password
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"random_password.password.length"</span> | terraform console
<span class="c"># =&gt; 16</span>
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"random_password.password.special"</span> | terraform console
<span class="c"># =&gt; true</span>
  
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate| <span class="nb">grep </span>result
  
<span class="c"># 상태파일에는 현재 module 에 대한 내용이 없습니다.</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module
  
<span class="c"># graph 확인</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>    </div>
  </li>
</ul>
<div class="graphviz max-w-100 image-center"><svg width="970pt" viewbox="0.00 0.00 970.18 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<polygon fill="white" stroke="none" points="-4,4 -4,-256 966.18,-256 966.18,4 -4,4"></polygon>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="node1" class="node">
<title>[root] provider["registry.terraform.io/hashicorp/random"]</title>
<polygon fill="none" stroke="black" points="353.04,-36 68.35,-18 353.04,0 637.74,-18 353.04,-36"></polygon>
<text text-anchor="middle" x="353.04" y="-12.95" font-family="Times,serif" font-size="14.00">provider["registry.terraform.io/hashicorp/random"]</text>
</g>
<!-- [root] random_password.password (expand) -->
<g id="node2" class="node">
<title>[root] random_password.password (expand)</title>
<polygon fill="none" stroke="black" points="686.29,-108 515.79,-108 515.79,-72 686.29,-72 686.29,-108"></polygon>
<text text-anchor="middle" x="601.04" y="-84.95" font-family="Times,serif" font-size="14.00">random_password.password</text>
</g>
<!-- [root] random_password.password (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge5" class="edge">
<title>[root] random_password.password (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M539.1,-71.52C500.97,-60.75 452.3,-47.02 414.3,-36.29"></path>
<polygon fill="black" stroke="black" points="415.41,-32.97 404.83,-33.62 413.51,-39.7 415.41,-32.97"></polygon>
</g>
<!-- [root] var.isDB -->
<g id="node4" class="node">
<title>[root] var.isDB</title>
<polygon fill="none" stroke="black" points="714.04,-36 656.04,-36 656.04,0 720.04,0 720.04,-30 714.04,-36"></polygon>
<polyline fill="none" stroke="black" points="714.04,-36 714.04,-30"></polyline>
<polyline fill="none" stroke="black" points="720.04,-30 714.04,-30"></polyline>
<text text-anchor="middle" x="688.04" y="-12.95" font-family="Times,serif" font-size="14.00">var.isDB</text>
</g>
<!-- [root] random_password.password (expand)&#45;&gt;[root] var.isDB -->
<g id="edge6" class="edge">
<title>[root] random_password.password (expand)-&gt;[root] var.isDB</title>
<path fill="none" stroke="black" d="M622.55,-71.7C633.11,-63.2 646.02,-52.81 657.58,-43.51"></path>
<polygon fill="black" stroke="black" points="659.71,-46.29 665.31,-37.3 655.32,-40.84 659.71,-46.29"></polygon>
</g>
<!-- [root] random_pet.name (expand) -->
<g id="node3" class="node">
<title>[root] random_pet.name (expand)</title>
<polygon fill="none" stroke="black" points="410.54,-108 295.54,-108 295.54,-72 410.54,-72 410.54,-108"></polygon>
<text text-anchor="middle" x="353.04" y="-84.95" font-family="Times,serif" font-size="14.00">random_pet.name</text>
</g>
<!-- [root] random_pet.name (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge7" class="edge">
<title>[root] random_pet.name (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M353.04,-71.7C353.04,-64.41 353.04,-55.73 353.04,-47.54"></path>
<polygon fill="black" stroke="black" points="356.54,-47.62 353.04,-37.62 349.54,-47.62 356.54,-47.62"></polygon>
</g>
<!-- [root] output.id (expand) -->
<g id="node5" class="node">
<title>[root] output.id (expand)</title>
<ellipse fill="none" stroke="black" cx="103.04" cy="-162" rx="103.04" ry="18"></ellipse>
<text text-anchor="middle" x="103.04" y="-156.95" font-family="Times,serif" font-size="14.00">[root] output.id (expand)</text>
</g>
<!-- [root] output.id (expand)&#45;&gt;[root] random_pet.name (expand) -->
<g id="edge1" class="edge">
<title>[root] output.id (expand)-&gt;[root] random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M156.06,-146.15C193.48,-135.68 243.95,-121.55 284.44,-110.21"></path>
<polygon fill="black" stroke="black" points="285.16,-113.64 293.85,-107.57 283.28,-106.9 285.16,-113.64"></polygon>
</g>
<!-- [root] output.pw (expand) -->
<g id="node6" class="node">
<title>[root] output.pw (expand)</title>
<ellipse fill="none" stroke="black" cx="855.04" cy="-162" rx="107.14" ry="18"></ellipse>
<text text-anchor="middle" x="855.04" y="-156.95" font-family="Times,serif" font-size="14.00">[root] output.pw (expand)</text>
</g>
<!-- [root] output.pw (expand)&#45;&gt;[root] random_password.password (expand) -->
<g id="edge2" class="edge">
<title>[root] output.pw (expand)-&gt;[root] random_password.password (expand)</title>
<path fill="none" stroke="black" d="M800.87,-146.07C764.24,-135.98 715.42,-122.52 675.2,-111.44"></path>
<polygon fill="black" stroke="black" points="676.13,-108.06 665.56,-108.78 674.27,-114.81 676.13,-108.06"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close) -->
<g id="node7" class="node">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)</title>
<ellipse fill="none" stroke="black" cx="477.04" cy="-162" rx="252.49" ry="18"></ellipse>
<text text-anchor="middle" x="477.04" y="-156.95" font-family="Times,serif" font-size="14.00">[root] provider["registry.terraform.io/hashicorp/random"] (close)</text>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] random_password.password (expand) -->
<g id="edge3" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] random_password.password (expand)</title>
<path fill="none" stroke="black" d="M507.7,-143.7C523.64,-134.69 543.35,-123.57 560.53,-113.87"></path>
<polygon fill="black" stroke="black" points="562.01,-117.05 569,-109.09 558.57,-110.96 562.01,-117.05"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] random_pet.name (expand) -->
<g id="edge4" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M446.39,-143.7C430.45,-134.69 410.74,-123.57 393.55,-113.87"></path>
<polygon fill="black" stroke="black" points="395.52,-110.96 385.09,-109.09 392.08,-117.05 395.52,-110.96"></polygon>
</g>
<!-- [root] root -->
<g id="node8" class="node">
<title>[root] root</title>
<ellipse fill="none" stroke="black" cx="477.04" cy="-234" rx="49.3" ry="18"></ellipse>
<text text-anchor="middle" x="477.04" y="-228.95" font-family="Times,serif" font-size="14.00">[root] root</text>
</g>
<!-- [root] root&#45;&gt;[root] output.id (expand) -->
<g id="edge8" class="edge">
<title>[root] root-&gt;[root] output.id (expand)</title>
<path fill="none" stroke="black" d="M433.78,-224.9C372.47,-213.43 259.27,-192.24 182.58,-177.89"></path>
<polygon fill="black" stroke="black" points="183.5,-174.5 173.03,-176.1 182.21,-181.38 183.5,-174.5"></polygon>
</g>
<!-- [root] root&#45;&gt;[root] output.pw (expand) -->
<g id="edge9" class="edge">
<title>[root] root-&gt;[root] output.pw (expand)</title>
<path fill="none" stroke="black" d="M520.41,-224.97C582.05,-213.55 696.13,-192.43 773.78,-178.05"></path>
<polygon fill="black" stroke="black" points="774.28,-181.52 783.48,-176.25 773.01,-174.63 774.28,-181.52"></polygon>
</g>
<!-- [root] root&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close) -->
<g id="edge10" class="edge">
<title>[root] root-&gt;[root] provider["registry.terraform.io/hashicorp/random"] (close)</title>
<path fill="none" stroke="black" d="M477.04,-215.7C477.04,-208.41 477.04,-199.73 477.04,-191.54"></path>
<polygon fill="black" stroke="black" points="480.54,-191.62 477.04,-181.62 473.54,-191.62 480.54,-191.62"></polygon>
</g>
</g>
</svg></div>
<p><em class="image-caption">모듈 그래프</em></p>

<h4 id="실습-2-비밀번호-생성하는-모듈을-루트-모듈에서-호출하기">실습 2. 비밀번호 생성하는 모듈을 루트 모듈에서 호출하기</h4>

<ul>
  <li>자식 모듈을 호출하는 Root Module 생성하기 위해 06-module-training/06-01-basic/main.tf 파일을 생성
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># 06-module-training/06-01-basic/main.tf</span>
<span class="k">module</span> <span class="s2">"mypw1"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-random-pwgen"</span>
<span class="p">}</span>
  
<span class="k">module</span> <span class="s2">"mypw2"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-random-pwgen"</span>
  <span class="nx">isDB</span>   <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"mypw1"</span> <span class="p">{</span>
  <span class="nx">value</span>  <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">mypw1</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"mypw2"</span> <span class="p">{</span>
  <span class="nx">value</span>  <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">mypw2</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>실행
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># 실행</span>
  
<span class="nv">$ </span>terraform init <span class="o">&amp;&amp;</span> terraform plan <span class="o">&amp;&amp;</span> terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 4 added, 0 changed, 0 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    mypw1 = {</span>
<span class="c">#      "id" = "absolute-goat"</span>
<span class="c">#      "pw" = "yntpOjuyqm"</span>
<span class="c">#    }</span>
<span class="c">#    mypw2 = {</span>
<span class="c">#      "id" = "intense-imp"</span>
<span class="c">#      "pw" = "0IlU7A?uqfKR0P81"</span>
<span class="c">#    } </span>
  
<span class="c"># 상태 확인</span>
<span class="nv">$ </span>terraform state list
  
<span class="c"># 모듈정보 확인. </span>
  
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module
<span class="c"># =&gt; "module": "module.mypw1",   # 하위 모듈의 정보가 출력됩니다.	</span>
<span class="c">#    "module": "module.mypw1",</span>
<span class="c">#    "module": "module.mypw2",</span>
<span class="c">#    "module": "module.mypw2",</span>
  
<span class="c"># terraform init 시 생성되는 module.json 확인</span>
  
<span class="nv">$ </span>tree .terraform
<span class="c"># =&gt; .terraform</span>
<span class="c">#    ├── modules</span>
<span class="c">#    │   └── modules.json</span>
<span class="c">#    └── ...</span>
  
<span class="c"># module.json 내용 확인. 모듈 사용 정보가 출력됩니다.</span>
  
<span class="nv">$ </span><span class="nb">cat</span> .terraform/modules/modules.json | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "Modules": [</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "",</span>
<span class="c">#          "Source": "",</span>
<span class="c">#          "Dir": "."</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "mypw1",</span>
<span class="c">#          "Source": "../modules/terraform-random-pwgen",</span>
<span class="c">#          "Dir": "../modules/terraform-random-pwgen"</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "mypw2",</span>
<span class="c">#          "Source": "../modules/terraform-random-pwgen",</span>
<span class="c">#          "Dir": "../modules/terraform-random-pwgen"</span>
<span class="c">#        }</span>
<span class="c">#      ]</span>
<span class="c">#    }</span>
  
<span class="c"># 자식 모듈의 output 값은 module.&lt;모듈 이름&gt;.&lt;output 이름&gt;으로 조회 할 수 있습니다.</span>
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"module.mypw1.id"</span> | terraform console
<span class="c"># =&gt; "absolute-goat"</span>
  
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"module.mypw2.pw"</span> | terraform console
<span class="c"># =&gt; "0IlU7A?uqfKR0P81"</span>
  
<span class="c"># graph 확인</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>    </div>
  </li>
</ul>

<div class="graphviz"><svg width="1917pt" viewbox="0.00 0.00 1917.02 476.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 472)">
<polygon fill="white" stroke="none" points="-4,4 -4,-472 1913.02,-472 1913.02,4 -4,4"></polygon>
<!-- [root] module.mypw1.random_password.password (expand) -->
<g id="node1" class="node">
<title>[root] module.mypw1.random_password.password (expand)</title>
<polygon fill="none" stroke="black" points="656.81,-180 396.31,-180 396.31,-144 656.81,-144 656.81,-180"></polygon>
<text text-anchor="middle" x="526.56" y="-156.95" font-family="Times,serif" font-size="14.00">module.mypw1.random_password.password</text>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="node5" class="node">
<title>[root] provider["registry.terraform.io/hashicorp/random"]</title>
<polygon fill="none" stroke="black" points="1030.56,-108 745.86,-90 1030.56,-72 1315.25,-90 1030.56,-108"></polygon>
<text text-anchor="middle" x="1030.56" y="-84.95" font-family="Times,serif" font-size="14.00">provider["registry.terraform.io/hashicorp/random"]</text>
</g>
<!-- [root] module.mypw1.random_password.password (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge6" class="edge">
<title>[root] module.mypw1.random_password.password (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M652.44,-143.52C739.32,-131.45 853.15,-115.64 933.13,-104.53"></path>
<polygon fill="black" stroke="black" points="933.26,-108.05 942.68,-103.2 932.3,-101.11 933.26,-108.05"></polygon>
</g>
<!-- [root] module.mypw1.var.isDB (expand) -->
<g id="node9" class="node">
<title>[root] module.mypw1.var.isDB (expand)</title>
<ellipse fill="none" stroke="black" cx="525.56" cy="-90" rx="163.95" ry="18"></ellipse>
<text text-anchor="middle" x="525.56" y="-84.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1.var.isDB (expand)</text>
</g>
<!-- [root] module.mypw1.random_password.password (expand)&#45;&gt;[root] module.mypw1.var.isDB (expand) -->
<g id="edge5" class="edge">
<title>[root] module.mypw1.random_password.password (expand)-&gt;[root] module.mypw1.var.isDB (expand)</title>
<path fill="none" stroke="black" d="M526.31,-143.7C526.2,-136.41 526.08,-127.73 525.96,-119.54"></path>
<polygon fill="black" stroke="black" points="529.46,-119.57 525.82,-109.62 522.46,-119.67 529.46,-119.57"></polygon>
</g>
<!-- [root] module.mypw1.random_pet.name (expand) -->
<g id="node2" class="node">
<title>[root] module.mypw1.random_pet.name (expand)</title>
<polygon fill="none" stroke="black" points="881.06,-180 676.06,-180 676.06,-144 881.06,-144 881.06,-180"></polygon>
<text text-anchor="middle" x="778.56" y="-156.95" font-family="Times,serif" font-size="14.00">module.mypw1.random_pet.name</text>
</g>
<!-- [root] module.mypw1.random_pet.name (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge8" class="edge">
<title>[root] module.mypw1.random_pet.name (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M841.5,-143.52C880.41,-132.71 930.13,-118.9 968.81,-108.15"></path>
<polygon fill="black" stroke="black" points="969.26,-111.66 977.95,-105.61 967.38,-104.92 969.26,-111.66"></polygon>
</g>
<!-- [root] module.mypw1 (expand) -->
<g id="node10" class="node">
<title>[root] module.mypw1 (expand)</title>
<ellipse fill="none" stroke="black" cx="621.56" cy="-18" rx="128.63" ry="18"></ellipse>
<text text-anchor="middle" x="621.56" y="-12.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1 (expand)</text>
</g>
<!-- [root] module.mypw1.random_pet.name (expand)&#45;&gt;[root] module.mypw1 (expand) -->
<g id="edge7" class="edge">
<title>[root] module.mypw1.random_pet.name (expand)-&gt;[root] module.mypw1 (expand)</title>
<path fill="none" stroke="black" d="M765.18,-143.83C750.1,-125.06 724.31,-94.62 698.56,-72 686.41,-61.33 672.06,-50.94 659.06,-42.23"></path>
<polygon fill="black" stroke="black" points="660.98,-39.31 650.7,-36.75 657.14,-45.16 660.98,-39.31"></polygon>
</g>
<!-- [root] module.mypw2.random_password.password (expand) -->
<g id="node3" class="node">
<title>[root] module.mypw2.random_password.password (expand)</title>
<polygon fill="none" stroke="black" points="1251.81,-180 991.31,-180 991.31,-144 1251.81,-144 1251.81,-180"></polygon>
<text text-anchor="middle" x="1121.56" y="-156.95" font-family="Times,serif" font-size="14.00">module.mypw2.random_password.password</text>
</g>
<!-- [root] module.mypw2.random_password.password (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge15" class="edge">
<title>[root] module.mypw2.random_password.password (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M1099.06,-143.7C1087.37,-134.7 1072.93,-123.6 1060.33,-113.9"></path>
<polygon fill="black" stroke="black" points="1062.8,-111.39 1052.74,-108.07 1058.54,-116.94 1062.8,-111.39"></polygon>
</g>
<!-- [root] module.mypw2.var.isDB (expand) -->
<g id="node14" class="node">
<title>[root] module.mypw2.var.isDB (expand)</title>
<ellipse fill="none" stroke="black" cx="1497.56" cy="-90" rx="163.95" ry="18"></ellipse>
<text text-anchor="middle" x="1497.56" y="-84.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2.var.isDB (expand)</text>
</g>
<!-- [root] module.mypw2.random_password.password (expand)&#45;&gt;[root] module.mypw2.var.isDB (expand) -->
<g id="edge14" class="edge">
<title>[root] module.mypw2.random_password.password (expand)-&gt;[root] module.mypw2.var.isDB (expand)</title>
<path fill="none" stroke="black" d="M1215.47,-143.52C1273.48,-132.72 1347.6,-118.92 1405.31,-108.17"></path>
<polygon fill="black" stroke="black" points="1405.94,-111.62 1415.13,-106.34 1404.66,-104.73 1405.94,-111.62"></polygon>
</g>
<!-- [root] module.mypw2.random_pet.name (expand) -->
<g id="node4" class="node">
<title>[root] module.mypw2.random_pet.name (expand)</title>
<polygon fill="none" stroke="black" points="1679.06,-180 1474.06,-180 1474.06,-144 1679.06,-144 1679.06,-180"></polygon>
<text text-anchor="middle" x="1576.56" y="-156.95" font-family="Times,serif" font-size="14.00">module.mypw2.random_pet.name</text>
</g>
<!-- [root] module.mypw2.random_pet.name (expand)&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] -->
<g id="edge17" class="edge">
<title>[root] module.mypw2.random_pet.name (expand)-&gt;[root] provider["registry.terraform.io/hashicorp/random"]</title>
<path fill="none" stroke="black" d="M1473.86,-147.83C1376.39,-135.34 1230.71,-116.66 1133.25,-104.17"></path>
<polygon fill="black" stroke="black" points="1133.77,-100.7 1123.41,-102.9 1132.88,-107.65 1133.77,-100.7"></polygon>
</g>
<!-- [root] module.mypw2 (expand) -->
<g id="node15" class="node">
<title>[root] module.mypw2 (expand)</title>
<ellipse fill="none" stroke="black" cx="1593.56" cy="-18" rx="128.63" ry="18"></ellipse>
<text text-anchor="middle" x="1593.56" y="-12.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2 (expand)</text>
</g>
<!-- [root] module.mypw2.random_pet.name (expand)&#45;&gt;[root] module.mypw2 (expand) -->
<g id="edge16" class="edge">
<title>[root] module.mypw2.random_pet.name (expand)-&gt;[root] module.mypw2 (expand)</title>
<path fill="none" stroke="black" d="M1628.7,-143.72C1645.02,-135.57 1661.2,-124.01 1670.56,-108 1678.63,-94.18 1678,-86.16 1670.56,-72 1664.07,-59.66 1653.26,-49.63 1641.76,-41.75"></path>
<polygon fill="black" stroke="black" points="1643.63,-38.79 1633.3,-36.44 1639.91,-44.72 1643.63,-38.79"></polygon>
</g>
<!-- [root] module.mypw1 (close) -->
<g id="node6" class="node">
<title>[root] module.mypw1 (close)</title>
<ellipse fill="none" stroke="black" cx="519.56" cy="-306" rx="120.96" ry="18"></ellipse>
<text text-anchor="middle" x="519.56" y="-300.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1 (close)</text>
</g>
<!-- [root] module.mypw1.output.id (expand) -->
<g id="node7" class="node">
<title>[root] module.mypw1.output.id (expand)</title>
<ellipse fill="none" stroke="black" cx="519.56" cy="-234" rx="164.46" ry="18"></ellipse>
<text text-anchor="middle" x="519.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1.output.id (expand)</text>
</g>
<!-- [root] module.mypw1 (close)&#45;&gt;[root] module.mypw1.output.id (expand) -->
<g id="edge1" class="edge">
<title>[root] module.mypw1 (close)-&gt;[root] module.mypw1.output.id (expand)</title>
<path fill="none" stroke="black" d="M519.56,-287.7C519.56,-280.41 519.56,-271.73 519.56,-263.54"></path>
<polygon fill="black" stroke="black" points="523.06,-263.62 519.56,-253.62 516.06,-263.62 523.06,-263.62"></polygon>
</g>
<!-- [root] module.mypw1.output.pw (expand) -->
<g id="node8" class="node">
<title>[root] module.mypw1.output.pw (expand)</title>
<ellipse fill="none" stroke="black" cx="168.56" cy="-234" rx="168.56" ry="18"></ellipse>
<text text-anchor="middle" x="168.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] module.mypw1.output.pw (expand)</text>
</g>
<!-- [root] module.mypw1 (close)&#45;&gt;[root] module.mypw1.output.pw (expand) -->
<g id="edge2" class="edge">
<title>[root] module.mypw1 (close)-&gt;[root] module.mypw1.output.pw (expand)</title>
<path fill="none" stroke="black" d="M449.37,-291C394.11,-279.98 316.75,-264.56 257.22,-252.68"></path>
<polygon fill="black" stroke="black" points="257.92,-249.25 247.42,-250.73 256.55,-256.12 257.92,-249.25"></polygon>
</g>
<!-- [root] module.mypw1.output.id (expand)&#45;&gt;[root] module.mypw1.random_pet.name (expand) -->
<g id="edge3" class="edge">
<title>[root] module.mypw1.output.id (expand)-&gt;[root] module.mypw1.random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M579.3,-216.85C616.17,-206.89 663.79,-194.02 703.23,-183.36"></path>
<polygon fill="black" stroke="black" points="703.92,-186.8 712.66,-180.81 702.1,-180.04 703.92,-186.8"></polygon>
</g>
<!-- [root] module.mypw1.output.pw (expand)&#45;&gt;[root] module.mypw1.random_password.password (expand) -->
<g id="edge4" class="edge">
<title>[root] module.mypw1.output.pw (expand)-&gt;[root] module.mypw1.random_password.password (expand)</title>
<path fill="none" stroke="black" d="M247.12,-217.64C299.7,-207.36 369.38,-193.73 426,-182.66"></path>
<polygon fill="black" stroke="black" points="426.52,-186.13 435.66,-180.77 425.17,-179.26 426.52,-186.13"></polygon>
</g>
<!-- [root] module.mypw1.var.isDB (expand)&#45;&gt;[root] module.mypw1 (expand) -->
<g id="edge9" class="edge">
<title>[root] module.mypw1.var.isDB (expand)-&gt;[root] module.mypw1 (expand)</title>
<path fill="none" stroke="black" d="M549.29,-71.7C561.26,-62.97 575.97,-52.24 588.98,-42.75"></path>
<polygon fill="black" stroke="black" points="590.86,-45.72 596.88,-37 586.73,-40.06 590.86,-45.72"></polygon>
</g>
<!-- [root] module.mypw2 (close) -->
<g id="node11" class="node">
<title>[root] module.mypw2 (close)</title>
<ellipse fill="none" stroke="black" cx="1393.56" cy="-306" rx="120.96" ry="18"></ellipse>
<text text-anchor="middle" x="1393.56" y="-300.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2 (close)</text>
</g>
<!-- [root] module.mypw2.output.id (expand) -->
<g id="node12" class="node">
<title>[root] module.mypw2.output.id (expand)</title>
<ellipse fill="none" stroke="black" cx="1744.56" cy="-234" rx="164.46" ry="18"></ellipse>
<text text-anchor="middle" x="1744.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2.output.id (expand)</text>
</g>
<!-- [root] module.mypw2 (close)&#45;&gt;[root] module.mypw2.output.id (expand) -->
<g id="edge10" class="edge">
<title>[root] module.mypw2 (close)-&gt;[root] module.mypw2.output.id (expand)</title>
<path fill="none" stroke="black" d="M1463.74,-291C1519.19,-279.95 1596.88,-264.45 1656.5,-252.56"></path>
<polygon fill="black" stroke="black" points="1657.18,-255.99 1666.31,-250.61 1655.81,-249.13 1657.18,-255.99"></polygon>
</g>
<!-- [root] module.mypw2.output.pw (expand) -->
<g id="node13" class="node">
<title>[root] module.mypw2.output.pw (expand)</title>
<ellipse fill="none" stroke="black" cx="1393.56" cy="-234" rx="168.56" ry="18"></ellipse>
<text text-anchor="middle" x="1393.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] module.mypw2.output.pw (expand)</text>
</g>
<!-- [root] module.mypw2 (close)&#45;&gt;[root] module.mypw2.output.pw (expand) -->
<g id="edge11" class="edge">
<title>[root] module.mypw2 (close)-&gt;[root] module.mypw2.output.pw (expand)</title>
<path fill="none" stroke="black" d="M1393.56,-287.7C1393.56,-280.41 1393.56,-271.73 1393.56,-263.54"></path>
<polygon fill="black" stroke="black" points="1397.06,-263.62 1393.56,-253.62 1390.06,-263.62 1397.06,-263.62"></polygon>
</g>
<!-- [root] module.mypw2.output.id (expand)&#45;&gt;[root] module.mypw2.random_pet.name (expand) -->
<g id="edge12" class="edge">
<title>[root] module.mypw2.output.id (expand)-&gt;[root] module.mypw2.random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M1704.32,-216.23C1681.74,-206.83 1653.31,-194.98 1629,-184.85"></path>
<polygon fill="black" stroke="black" points="1630.49,-181.68 1619.91,-181.07 1627.8,-188.14 1630.49,-181.68"></polygon>
</g>
<!-- [root] module.mypw2.output.pw (expand)&#45;&gt;[root] module.mypw2.random_password.password (expand) -->
<g id="edge13" class="edge">
<title>[root] module.mypw2.output.pw (expand)-&gt;[root] module.mypw2.random_password.password (expand)</title>
<path fill="none" stroke="black" d="M1330.81,-216.85C1291.93,-206.85 1241.65,-193.91 1200.13,-183.22"></path>
<polygon fill="black" stroke="black" points="1201.24,-179.89 1190.68,-180.79 1199.5,-186.67 1201.24,-179.89"></polygon>
</g>
<!-- [root] module.mypw2.var.isDB (expand)&#45;&gt;[root] module.mypw2 (expand) -->
<g id="edge18" class="edge">
<title>[root] module.mypw2.var.isDB (expand)-&gt;[root] module.mypw2 (expand)</title>
<path fill="none" stroke="black" d="M1521.29,-71.7C1533.26,-62.97 1547.97,-52.24 1560.98,-42.75"></path>
<polygon fill="black" stroke="black" points="1562.86,-45.72 1568.88,-37 1558.73,-40.06 1562.86,-45.72"></polygon>
</g>
<!-- [root] output.mypw1 (expand) -->
<g id="node16" class="node">
<title>[root] output.mypw1 (expand)</title>
<ellipse fill="none" stroke="black" cx="661.56" cy="-378" rx="124.03" ry="18"></ellipse>
<text text-anchor="middle" x="661.56" y="-372.95" font-family="Times,serif" font-size="14.00">[root] output.mypw1 (expand)</text>
</g>
<!-- [root] output.mypw1 (expand)&#45;&gt;[root] module.mypw1 (close) -->
<g id="edge19" class="edge">
<title>[root] output.mypw1 (expand)-&gt;[root] module.mypw1 (close)</title>
<path fill="none" stroke="black" d="M627.54,-360.23C608.31,-350.75 584.05,-338.8 563.41,-328.62"></path>
<polygon fill="black" stroke="black" points="565.16,-325.58 554.65,-324.3 562.07,-331.86 565.16,-325.58"></polygon>
</g>
<!-- [root] output.mypw2 (expand) -->
<g id="node17" class="node">
<title>[root] output.mypw2 (expand)</title>
<ellipse fill="none" stroke="black" cx="1250.56" cy="-378" rx="124.03" ry="18"></ellipse>
<text text-anchor="middle" x="1250.56" y="-372.95" font-family="Times,serif" font-size="14.00">[root] output.mypw2 (expand)</text>
</g>
<!-- [root] output.mypw2 (expand)&#45;&gt;[root] module.mypw2 (close) -->
<g id="edge20" class="edge">
<title>[root] output.mypw2 (expand)-&gt;[root] module.mypw2 (close)</title>
<path fill="none" stroke="black" d="M1284.81,-360.23C1304.18,-350.75 1328.6,-338.8 1349.4,-328.62"></path>
<polygon fill="black" stroke="black" points="1350.78,-331.84 1358.22,-324.3 1347.7,-325.55 1350.78,-331.84"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close) -->
<g id="node18" class="node">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)</title>
<ellipse fill="none" stroke="black" cx="954.56" cy="-234" rx="252.49" ry="18"></ellipse>
<text text-anchor="middle" x="954.56" y="-228.95" font-family="Times,serif" font-size="14.00">[root] provider["registry.terraform.io/hashicorp/random"] (close)</text>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] module.mypw1.random_password.password (expand) -->
<g id="edge21" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] module.mypw1.random_password.password (expand)</title>
<path fill="none" stroke="black" d="M856.63,-216.98C793.52,-206.66 711.1,-193.18 644.4,-182.27"></path>
<polygon fill="black" stroke="black" points="645.34,-178.88 634.91,-180.72 644.21,-185.79 645.34,-178.88"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] module.mypw1.random_pet.name (expand) -->
<g id="edge22" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] module.mypw1.random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M911.5,-215.88C887.81,-206.46 858.19,-194.67 832.92,-184.62"></path>
<polygon fill="black" stroke="black" points="834.38,-181.44 823.79,-180.99 831.79,-187.94 834.38,-181.44"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] module.mypw2.random_password.password (expand) -->
<g id="edge23" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] module.mypw2.random_password.password (expand)</title>
<path fill="none" stroke="black" d="M995.41,-215.88C1017.78,-206.5 1045.74,-194.78 1069.65,-184.76"></path>
<polygon fill="black" stroke="black" points="1070.7,-188.11 1078.57,-181.02 1067.99,-181.66 1070.7,-188.11"></polygon>
</g>
<!-- [root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close)&#45;&gt;[root] module.mypw2.random_pet.name (expand) -->
<g id="edge24" class="edge">
<title>[root] provider["registry.terraform.io/hashicorp/random"] (close)-&gt;[root] module.mypw2.random_pet.name (expand)</title>
<path fill="none" stroke="black" d="M1086.09,-218.2C1197.71,-205.64 1356.22,-187.8 1462.54,-175.83"></path>
<polygon fill="black" stroke="black" points="1462.9,-179.31 1472.44,-174.72 1462.11,-172.36 1462.9,-179.31"></polygon>
</g>
<!-- [root] root -->
<g id="node19" class="node">
<title>[root] root</title>
<ellipse fill="none" stroke="black" cx="954.56" cy="-450" rx="49.3" ry="18"></ellipse>
<text text-anchor="middle" x="954.56" y="-444.95" font-family="Times,serif" font-size="14.00">[root] root</text>
</g>
<!-- [root] root&#45;&gt;[root] output.mypw1 (expand) -->
<g id="edge25" class="edge">
<title>[root] root-&gt;[root] output.mypw1 (expand)</title>
<path fill="none" stroke="black" d="M914.12,-439.34C868.06,-428.33 791.83,-410.12 735.15,-396.58"></path>
<polygon fill="black" stroke="black" points="736.1,-393.21 725.56,-394.29 734.48,-400.02 736.1,-393.21"></polygon>
</g>
<!-- [root] root&#45;&gt;[root] output.mypw2 (expand) -->
<g id="edge26" class="edge">
<title>[root] root-&gt;[root] output.mypw2 (expand)</title>
<path fill="none" stroke="black" d="M995.09,-439.41C1041.63,-428.41 1118.92,-410.13 1176.32,-396.56"></path>
<polygon fill="black" stroke="black" points="1177.12,-399.96 1186.04,-394.26 1175.51,-393.15 1177.12,-399.96"></polygon>
</g>
<!-- [root] root&#45;&gt;[root] provider[&quot;registry.terraform.io/hashicorp/random&quot;] (close) -->
<g id="edge27" class="edge">
<title>[root] root-&gt;[root] provider["registry.terraform.io/hashicorp/random"] (close)</title>
<path fill="none" stroke="black" d="M954.56,-431.85C954.56,-395.14 954.56,-308.66 954.56,-263.53"></path>
<polygon fill="black" stroke="black" points="958.06,-263.75 954.56,-253.75 951.06,-263.75 958.06,-263.75"></polygon>
</g>
</g>
</svg></div>

<h3 id="모듈-사용-방식">모듈 사용 방식</h3>

<h4 id="모듈과-프로바이더">모듈과 프로바이더</h4>

<ul>
  <li>모듈에서 사용되는 모든 리소스는 관련 프로바이더의 정의가 필요합니다. 프로바이더의 정의를 모듈 안에 두느냐, 루트 모듈에서 정의하느냐에 따라 모듈의 재사용성이 달라집니다.</li>
</ul>

<h5 id="유형-1-자식-모듈에서-프로바이더-정의">유형 1. 자식 모듈에서 프로바이더 정의</h5>

<ul>
  <li>모듈에서 사용하는 프로바이더의 버전과 상세 구성을 자식 모듈에 고정하는 방법입니다.
    <ul>
      <li>프로바이더 버전과 구성에 민감하거나, 루트 모듈과 관계없이 독립적인 구조일때 사용합니다.</li>
      <li>하지만 동일 프로바이더가 루트 모듈과 자식 모듈 양쪽, 또는 서로 다른 자식 모듈에 버전 조건 합의가 안 되면,
오류가 발생하고 모듈에서 반복문을 사용할 수 없다는 단점이 있어 잘 사용하지 않습니다.</li>
    </ul>
  </li>
</ul>

<h5 id="유형-2-루트-모듈에서-프로바이더-정의-추천">유형 2. 루트 모듈에서 프로바이더 정의 (추천)</h5>

<ul>
  <li>자식 모듈은 루트 모듈의 프로바이더에 종속되는 방식입니다.</li>
  <li>디렉터리 구조는 분리되어 있지만, 실행 단계에서는 동일 계층으로 해석되어서 <strong>프로바이더 버전과 구성은 루트 모듈의 설정이 적용</strong>됩니다.</li>
  <li>프로바이더를 모듈 내 리소스와 데이터 소스에 일괄 적용하고, 자식 모듈에 대한 반복문을 자유롭게 사용할 수 있는것이 장점입니다.</li>
</ul>

<h5 id="루트-모듈에서-프로바이더-정의-실습">루트 모듈에서 프로바이더 정의 실습</h5>

<ul>
  <li>실습을 위한 디렉터리 구성
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> 06-module-training
 ├── modules                    <span class="c"># child module home</span>
 │   └── terraform-aws-ec2
 │       ├── main.tf
 │       ├── outputs.tf
 │       └── variables.tf
 └── multi_provider_for_module 	<span class="c"># root-module</span>
     ├── main.tf
     └── outputs.tf
</code></pre></div>    </div>
  </li>
  <li>06-module-traning/modules/terraform-aws-ec2/main.tf, variable.tf, output.tf 파일 생성
    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_default_vpc"</span> <span class="s2">"default"</span> <span class="p">{}</span>
  
<span class="k">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"default"</span> <span class="p">{</span>
  <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="nx">owners</span>      <span class="p">=</span> <span class="p">[</span><span class="s2">"amazon"</span><span class="p">]</span>
  
  <span class="nx">filter</span> <span class="p">{</span>
    <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"owner-alias"</span>
    <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"amazon"</span><span class="p">]</span>
  <span class="p">}</span>
  
  <span class="nx">filter</span> <span class="p">{</span>
    <span class="nx">name</span>   <span class="p">=</span> <span class="s2">"name"</span>
    <span class="nx">values</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"amzn2-ami-hvm*"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"default"</span> <span class="p">{</span>
  <span class="nx">depends_on</span>    <span class="p">=</span> <span class="p">[</span><span class="nx">aws_default_vpc</span><span class="p">.</span><span class="nx">default</span><span class="p">]</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">default</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_type</span>
  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">instance_name</span>
  <span class="p">}</span>
<span class="p">}</span>  
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># variable.tf</span>
<span class="k">variable</span> <span class="s2">"instance_type"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"vm 인스턴스 타입 정의"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"t2.micro"</span>
<span class="p">}</span>
  
<span class="k">variable</span> <span class="s2">"instance_name"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"vm 인스턴스 이름 정의"</span>
  <span class="nx">default</span>     <span class="p">=</span> <span class="s2">"my_ec2"</span>
<span class="p">}</span> 
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># output.tf</span>
<span class="k">output</span> <span class="s2">"private_ip"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="p">.</span><span class="nx">default</span><span class="p">.</span><span class="nx">private_ip</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>작성된 모듈을 사용할 루트모듈 06-module-traning/multi_provider_for_module/main.tf, output.tf 파일 생성</p>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1"># main.tf</span>
  <span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
      <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-southeast-1"</span>  
  <span class="p">}</span>
	
  <span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
      <span class="nx">alias</span>  <span class="p">=</span> <span class="s2">"seoul"</span>
      <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>  
  <span class="p">}</span>
	
  <span class="k">module</span> <span class="s2">"ec2_singapore"</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
  <span class="p">}</span>
	
  <span class="k">module</span> <span class="s2">"ec2_seoul"</span> <span class="p">{</span>
      <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
      <span class="nx">providers</span> <span class="p">=</span> <span class="p">{</span>
          <span class="nx">aws</span> <span class="p">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">seoul</span>
      <span class="p">}</span>
      <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t3.small"</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1"># output.tf</span>
  <span class="k">output</span> <span class="s2">"module_output_singapore"</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">ec2_singapore</span><span class="p">.</span><span class="nx">private_ip</span>
  <span class="p">}</span>
	
  <span class="k">output</span> <span class="s2">"module_output_seoul"</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">ec2_seoul</span><span class="p">.</span><span class="nx">private_ip</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>실행</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="nv">$ </span><span class="nb">cat</span> .terraform/modules/modules.json | jq
<span class="c"># =&gt; {</span>
<span class="c">#      "Modules": [</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "",</span>
<span class="c">#          "Source": "",</span>
<span class="c">#          "Dir": "."</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "ec2_seoul",</span>
<span class="c">#          "Source": "../modules/terraform-aws-ec2",</span>
<span class="c">#          "Dir": "../modules/terraform-aws-ec2"</span>
<span class="c">#        },</span>
<span class="c">#        {</span>
<span class="c">#          "Key": "ec2_singapore",</span>
<span class="c">#          "Source": "../modules/terraform-aws-ec2",</span>
<span class="c">#          "Dir": "../modules/terraform-aws-ec2"</span>
<span class="c">#        }</span>
<span class="c">#      ]</span>
<span class="c">#    }  </span>
  
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 4 added, 0 changed, 0 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    module_output_seoul = "172.31.0.75"</span>
<span class="c">#    module_output_singapore = "172.31.17.130"</span>
  
<span class="nv">$ </span>terraform output
<span class="nv">$ </span>terraform state list
<span class="nv">$ </span>terraform state show module.ec2_seoul.data.aws_ami.default
  
<span class="c"># 상태파일에서 모듈 정보 확인</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module
<span class="c"># =&gt; "module_output_seoul": {</span>
<span class="c">#    "module_output_singapore": {</span>
<span class="c">#      "module": "module.ec2_seoul",</span>
<span class="c">#      "module": "module.ec2_seoul",</span>
<span class="c">#      "module": "module.ec2_seoul",</span>
<span class="c">#            "module.ec2_seoul.aws_default_vpc.default",</span>
<span class="c">#            "module.ec2_seoul.data.aws_ami.default"</span>
<span class="c">#      "module": "module.ec2_singapore",</span>
<span class="c">#      "module": "module.ec2_singapore",</span>
<span class="c">#      "module": "module.ec2_singapore",</span>
<span class="c">#            "module.ec2_singapore.aws_default_vpc.default",</span>
<span class="c">#            "module.ec2_singapore.data.aws_ami.default"</span>
  
<span class="c"># 그래프 확인</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>    </div>
  </li>
</ul>

<div class="graphviz image-center"><svg width="379pt" viewbox="0.00 0.00 378.75 290.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 286)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-286 374.75,-286 374.75,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_module.ec2_seoul</title>
<polygon fill="none" stroke="black" points="8,-8 8,-137 362.75,-137 362.75,-8 8,-8"></polygon>
<text text-anchor="middle" x="185.38" y="-119.7" font-family="sans-serif" font-size="14.00">module.ec2_seoul</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_module.ec2_singapore</title>
<polygon fill="none" stroke="black" points="8,-145 8,-274 362.75,-274 362.75,-145 8,-145"></polygon>
<text text-anchor="middle" x="185.38" y="-256.7" font-family="sans-serif" font-size="14.00">module.ec2_singapore</text>
</g>
<!-- module.ec2_seoul.data.aws_ami.default -->
<g id="node1" class="node">
<title>module.ec2_seoul.data.aws_ami.default</title>
<polygon fill="none" stroke="black" points="168.5,-52 24.25,-52 24.25,-16 168.5,-16 168.5,-52"></polygon>
<text text-anchor="middle" x="96.38" y="-28.2" font-family="sans-serif" font-size="14.00">data.aws_ami.default</text>
</g>
<!-- module.ec2_seoul.aws_default_vpc.default -->
<g id="node2" class="node">
<title>module.ec2_seoul.aws_default_vpc.default</title>
<polygon fill="none" stroke="black" points="176.75,-106 16,-106 16,-70 176.75,-70 176.75,-106"></polygon>
<text text-anchor="middle" x="96.38" y="-82.2" font-family="sans-serif" font-size="14.00">aws_default_vpc.default</text>
</g>
<!-- module.ec2_seoul.aws_instance.default -->
<g id="node3" class="node">
<title>module.ec2_seoul.aws_instance.default</title>
<polygon fill="none" stroke="black" points="354.75,-79 212.75,-79 212.75,-43 354.75,-43 354.75,-79"></polygon>
<text text-anchor="middle" x="283.75" y="-55.2" font-family="sans-serif" font-size="14.00">aws_instance.default</text>
</g>
<!-- module.ec2_seoul.aws_instance.default&#45;&gt;module.ec2_seoul.data.aws_ami.default -->
<g id="edge1" class="edge">
<title>module.ec2_seoul.aws_instance.default-&gt;module.ec2_seoul.data.aws_ami.default</title>
<path fill="none" stroke="black" d="M212.4,-50.75C201.84,-49.21 190.86,-47.62 180.06,-46.04"></path>
<polygon fill="black" stroke="black" points="180.8,-42.61 170.4,-44.64 179.79,-49.54 180.8,-42.61"></polygon>
</g>
<!-- module.ec2_seoul.aws_instance.default&#45;&gt;module.ec2_seoul.aws_default_vpc.default -->
<g id="edge2" class="edge">
<title>module.ec2_seoul.aws_instance.default-&gt;module.ec2_seoul.aws_default_vpc.default</title>
<path fill="none" stroke="black" d="M212.4,-71.25C204.54,-72.39 196.44,-73.57 188.36,-74.75"></path>
<polygon fill="black" stroke="black" points="187.87,-71.28 178.48,-76.19 188.88,-78.21 187.87,-71.28"></polygon>
</g>
<!-- module.ec2_singapore.data.aws_ami.default -->
<g id="node4" class="node">
<title>module.ec2_singapore.data.aws_ami.default</title>
<polygon fill="none" stroke="black" points="168.5,-189 24.25,-189 24.25,-153 168.5,-153 168.5,-189"></polygon>
<text text-anchor="middle" x="96.38" y="-165.2" font-family="sans-serif" font-size="14.00">data.aws_ami.default</text>
</g>
<!-- module.ec2_singapore.aws_default_vpc.default -->
<g id="node5" class="node">
<title>module.ec2_singapore.aws_default_vpc.default</title>
<polygon fill="none" stroke="black" points="176.75,-243 16,-243 16,-207 176.75,-207 176.75,-243"></polygon>
<text text-anchor="middle" x="96.38" y="-219.2" font-family="sans-serif" font-size="14.00">aws_default_vpc.default</text>
</g>
<!-- module.ec2_singapore.aws_instance.default -->
<g id="node6" class="node">
<title>module.ec2_singapore.aws_instance.default</title>
<polygon fill="none" stroke="black" points="354.75,-216 212.75,-216 212.75,-180 354.75,-180 354.75,-216"></polygon>
<text text-anchor="middle" x="283.75" y="-192.2" font-family="sans-serif" font-size="14.00">aws_instance.default</text>
</g>
<!-- module.ec2_singapore.aws_instance.default&#45;&gt;module.ec2_singapore.data.aws_ami.default -->
<g id="edge3" class="edge">
<title>module.ec2_singapore.aws_instance.default-&gt;module.ec2_singapore.data.aws_ami.default</title>
<path fill="none" stroke="black" d="M212.4,-187.75C201.84,-186.21 190.86,-184.62 180.06,-183.04"></path>
<polygon fill="black" stroke="black" points="180.8,-179.61 170.4,-181.64 179.79,-186.54 180.8,-179.61"></polygon>
</g>
<!-- module.ec2_singapore.aws_instance.default&#45;&gt;module.ec2_singapore.aws_default_vpc.default -->
<g id="edge4" class="edge">
<title>module.ec2_singapore.aws_instance.default-&gt;module.ec2_singapore.aws_default_vpc.default</title>
<path fill="none" stroke="black" d="M212.4,-208.25C204.54,-209.39 196.44,-210.57 188.36,-211.75"></path>
<polygon fill="black" stroke="black" points="187.87,-208.28 178.48,-213.19 188.88,-215.21 187.87,-208.28"></polygon>
</g>
</g>
</svg></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># aws cli로 ec2 확인</span>
<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--region</span> ap-northeast-2 <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text
<span class="c"># =&gt; my_ec2  43.202.2.105    running</span>

<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--region</span> ap-southeast-1 <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text
<span class="c"># =&gt; my_ec2  18.139.217.84   running</span>

<span class="c"># 실습 완료 후 리소스 삭제</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div></div>

<h5 id="모듈의-반복문">모듈의 반복문</h5>

<ul>
  <li>모듈도 리소스에서 반복문을 사용할 수 있습니다.</li>
  <li>모듈이라는 잘 정의되고 테스트된 단위로 원하는 수량으로 프로비저닝을 할 수 있으므로, 모듈없이 구성하는것과 대비해서 리소스 종속성 관리와 유지보수에 장점이 있습니다. 
<code class="language-plaintext highlighter-rouge">count</code>를 사용한 반복문은 리소스와 유사하게 <code class="language-plaintext highlighter-rouge">module</code> 블록 내에 선언합니다.</li>
</ul>

<h6 id="count를-사용한-모듈-반복문-실습">count를 사용한 모듈 반복문 실습</h6>

<ul>
  <li>
    <p>06-module-traning/module_loop_count/main.tf 파일 생성</p>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-northeast-2"</span>  
<span class="p">}</span>
  
<span class="k">module</span> <span class="s2">"ec2_seoul"</span> <span class="p">{</span>
  <span class="nx">count</span>  <span class="p">=</span> <span class="mi">2</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t3.small"</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"module_output"</span> <span class="p">{</span>
  <span class="nx">value</span>  <span class="p">=</span> <span class="k">module</span><span class="p">.</span><span class="nx">ec2_seoul</span><span class="p">[*].</span><span class="nx">private_ip</span>   
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>실행 : 모듈의 반복문 테스트</p>

    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init 
<span class="nv">$ </span><span class="nb">cat</span> .terraform/modules/modules.json | jq
  
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; Apply complete! Resources: 4 added, 0 changed, 0 destroyed.</span>
<span class="c">#    Outputs:</span>
<span class="c">#    module_output = [</span>
<span class="c">#      "172.31.4.243",</span>
<span class="c">#      "172.31.8.11",</span>
<span class="c">#    ]  </span>
<span class="c"># count = 2 한만큼 2개의 EC2 인스턴스가 생성됨</span>
  
<span class="nv">$ </span>terraform output
<span class="nv">$ </span>terraform state list
  
<span class="c"># 상태파일에서 모듈정보 확인 </span>
<span class="c"># (앞서 살펴본 cat .terraform/modules/modules.json | jq 에서는 모듈이 1개만 나오지만, </span>
<span class="c">#  여기에서는 count 만큼 보여짐)</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module
  
<span class="c"># 그래프 확인</span>
<span class="nv">$ </span>terraform graph <span class="o">&gt;</span> graph.dot
</code></pre></div>    </div>
  </li>
</ul>

<div class="graphviz image-center"><svg width="379pt" viewbox="0.00 0.00 378.75 153.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 149)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-149 374.75,-149 374.75,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_module.ec2_seoul</title>
<polygon fill="none" stroke="black" points="8,-8 8,-137 362.75,-137 362.75,-8 8,-8"></polygon>
<text text-anchor="middle" x="185.38" y="-119.7" font-family="sans-serif" font-size="14.00">module.ec2_seoul</text>
</g>
<!-- module.ec2_seoul.data.aws_ami.default -->
<g id="node1" class="node">
<title>module.ec2_seoul.data.aws_ami.default</title>
<polygon fill="none" stroke="black" points="168.5,-52 24.25,-52 24.25,-16 168.5,-16 168.5,-52"></polygon>
<text text-anchor="middle" x="96.38" y="-28.2" font-family="sans-serif" font-size="14.00">data.aws_ami.default</text>
</g>
<!-- module.ec2_seoul.aws_default_vpc.default -->
<g id="node2" class="node">
<title>module.ec2_seoul.aws_default_vpc.default</title>
<polygon fill="none" stroke="black" points="176.75,-106 16,-106 16,-70 176.75,-70 176.75,-106"></polygon>
<text text-anchor="middle" x="96.38" y="-82.2" font-family="sans-serif" font-size="14.00">aws_default_vpc.default</text>
</g>
<!-- module.ec2_seoul.aws_instance.default -->
<g id="node3" class="node">
<title>module.ec2_seoul.aws_instance.default</title>
<polygon fill="none" stroke="black" points="354.75,-79 212.75,-79 212.75,-43 354.75,-43 354.75,-79"></polygon>
<text text-anchor="middle" x="283.75" y="-55.2" font-family="sans-serif" font-size="14.00">aws_instance.default</text>
</g>
<!-- module.ec2_seoul.aws_instance.default&#45;&gt;module.ec2_seoul.data.aws_ami.default -->
<g id="edge1" class="edge">
<title>module.ec2_seoul.aws_instance.default-&gt;module.ec2_seoul.data.aws_ami.default</title>
<path fill="none" stroke="black" d="M212.4,-50.75C201.84,-49.21 190.86,-47.62 180.06,-46.04"></path>
<polygon fill="black" stroke="black" points="180.8,-42.61 170.4,-44.64 179.79,-49.54 180.8,-42.61"></polygon>
</g>
<!-- module.ec2_seoul.aws_instance.default&#45;&gt;module.ec2_seoul.aws_default_vpc.default -->
<g id="edge2" class="edge">
<title>module.ec2_seoul.aws_instance.default-&gt;module.ec2_seoul.aws_default_vpc.default</title>
<path fill="none" stroke="black" d="M212.4,-71.25C204.54,-72.39 196.44,-73.57 188.36,-74.75"></path>
<polygon fill="black" stroke="black" points="187.87,-71.28 178.48,-76.19 188.88,-78.21 187.87,-71.28"></polygon>
</g>
</g>
</svg></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># aws cli로 ec2 확인</span>
  <span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--region</span> ap-northeast-2 <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text
  
  <span class="c"># 실습 완료 후 리소스 삭제</span>
  <span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div></div>

<h6 id="for_each를-사용한-모듈-반복문-실습">for_each를 사용한 모듈 반복문 실습</h6>

<ul>
  <li>
    <p>06-module-traning/module_loop_for_each/main.tf 파일 생성</p>

    <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf </span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">env</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">dev</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">type</span> <span class="p">=</span> <span class="s2">"t3.nano"</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="s2">"dev_ec2"</span>
    <span class="p">}</span>
    <span class="nx">prod</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">type</span> <span class="p">=</span> <span class="s2">"t3.micro"</span>
      <span class="nx">name</span> <span class="p">=</span> <span class="s2">"prod_ec2"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
  
<span class="k">module</span> <span class="s2">"ec2_seoul"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">local</span><span class="p">.</span><span class="nx">env</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">type</span>
  <span class="nx">instance_name</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">name</span>
<span class="p">}</span>
  
<span class="k">output</span> <span class="s2">"module_output"</span> <span class="p">{</span>
  <span class="nx">value</span>  <span class="p">=</span> <span class="p">[</span>
    <span class="nx">for</span> <span class="nx">k</span> <span class="nx">in</span> <span class="k">module</span><span class="p">.</span><span class="nx">ec2_seoul</span><span class="err">:</span> <span class="nx">k</span><span class="p">.</span><span class="nx">private_ip</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>실행 : for_each를 사용한 모듈 반복문 테스트</p>
  </li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="nv">$ </span>terraform output
<span class="c"># =&gt; module_output = [</span>
<span class="c">#      "172.31.13.57",</span>
<span class="c">#      "172.31.12.95",</span>
<span class="c">#    ]</span>

<span class="nv">$ </span>terraform state list

<span class="c"># 상태파일에서 모듈정보 확인</span>
<span class="nv">$ </span><span class="nb">cat </span>terraform.tfstate | <span class="nb">grep </span>module

<span class="c"># aws cli로 ec2 확인</span>
<span class="nv">$ </span>aws ec2 describe-instances <span class="nt">--region</span> ap-northeast-2 <span class="nt">--query</span> <span class="s2">"Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}"</span> <span class="nt">--filters</span> <span class="nv">Name</span><span class="o">=</span>instance-state-name,Values<span class="o">=</span>running <span class="nt">--output</span> text
<span class="c"># =&gt; dev_ec2    3.36.76.84      running</span>
<span class="c">#    prod_ec2   52.79.44.76     running</span>

<span class="c"># 실습 완료 후 리소스 삭제</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div></div>

<h3 id="모듈-소스-관리">모듈 소스 관리</h3>

<ul>
  <li>모듈 소스 관리 방법은 크게 다음과 같이 나눌 수 있습니다.
    <ul>
      <li>로컬 디렉터리 경로</li>
      <li>테라폼 레지스트리 (Terraform Registry)</li>
      <li>VCS (Git, GitHub, GitLab, Bitbucket 등)</li>
      <li>HTTP urls</li>
      <li>Object Storage (S3 Bucket, GCS Bucket 등)</li>
    </ul>
  </li>
</ul>

<h4 id="참조-예제">참조 예제</h4>

<ul>
  <li>로컬 디렉터리
    <ul>
      <li>대상 모듈이 같은 로컬 파일 시스템에 있으므로 다운로드 없이 바로 사용할 수 있습니다.</li>
      <li>재사용성을 고려한다면 앞서 실습에서 처럼 상위 디렉터리에 modules 디렉터리를 만들고 별도로 관리하는것을 권장하며,<br>
항상 루트모듈과 함께 동작하는 경우 하위 디렉터리에 모듈을 정의해도 좋습니다.</li>
      <li>예시
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># 상위 디렉터리에 별도 관리시 예제 </span>
<span class="k">module</span> <span class="s2">"local_dir_module"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/terraform-aws-ec2"</span>
<span class="p">}</span>
    
<span class="c1"># 하위 디렉터리에 관리시 예제</span>
<span class="k">module</span> <span class="s2">"local_subdir_module"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"./terraform-aws-ec2"</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>테라폼 레지스트리
    <ul>
      <li>테라폼 레지스트리에 등록된 모듈을 사용하는 방법으로 공개 모듈과 Terraform Cloud, Terraform Enterprise의 비공개 모듈을 사용할 수 있습니다.</li>
      <li>공개된 모듈은 <a href="https://registry.terraform.io/browse/modules">https://registry.terraform.io/browse/modules</a> 에서 확인할 수 있습니다.</li>
      <li>모듈 명은 <code class="language-plaintext highlighter-rouge">&lt;네임스페이스&gt;/&lt;이름&gt;/&lt;프로바이더&gt;</code>의 형태를 따릅니다.</li>
      <li>예시
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"terraform-aws-modules/vpc/aws"</span>
  <span class="nx">version</span> <span class="p">=</span> <span class="s2">"5.1.0"</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>VCS 사용 (github 예시)
    <ul>
      <li>Git의 원격 저장소로 유명한 깃허브는 테라폼 구성에 대한 CI 로도 사용할 수 있고, 모듈 소스를 업로드 하여 사용 할 수 있습니다.</li>
      <li>앞서 만든 06-module-traning/modules/terraform-aws-ec2/ 를 깃허브에 업로드하는 과정
        <ol>
          <li>깃허브에 로그인</li>
          <li>새로운 깃허브 저장소 생성 [New repository]
            <ul>
              <li>Owner : 원하는 소유자 선택</li>
              <li>Repository name : 예시) <strong>terraform-module-repo</strong>
</li>
              <li>Public 선택</li>
              <li>Add .gitignore의 드롭박스에서 [Terraform]을 선택</li>
            </ul>
          </li>
          <li>맨 아래 [Create repository] 클릭</li>
          <li>해당 저장소에 예시) ‘<strong>terraform-aws-ec2</strong>’ 디렉터리 생성 후 main.tf , variable.tf, output.tf 추가 후 업로드</li>
        </ol>
      </li>
      <li>모듈 사용 예시
        <div class="language-tf highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># main.tf</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"ap-southeast-1"</span>  
<span class="p">}</span>
    
<span class="k">module</span> <span class="s2">"ec2_seoul"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"github.com/sweetlittlebird/terraform-module-repo/terraform-aws-ec2"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t3.small"</span>
<span class="p">}</span>     
</code></pre></div>        </div>
      </li>
      <li>실행
        <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform init
    
<span class="c"># 상태 확인</span>
<span class="nv">$ </span>tree .terraform/modules
.terraform/modules
├── ec2_seoul
│   └── terraform-aws-ec2
│       ├── main.tf
│       ├── output.tf
│       └── variable.tf
└── modules.json
    
<span class="c"># 배포</span>
<span class="nv">$ </span>terraform apply <span class="nt">-auto-approve</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    Downloading git::https://github.com/sweetlittlebird/terraform-module-repo.git for ec2_seoul...</span>
<span class="c">#    ...</span>
<span class="c">#    Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span>
    
<span class="nv">$ </span>terraform state list
<span class="c"># =&gt; module.ec2_seoul.data.aws_ami.default</span>
<span class="c">#    module.ec2_seoul.aws_default_vpc.default</span>
<span class="c">#    module.ec2_seoul.aws_instance.default</span>
    
<span class="c"># 실습 완료 후 삭제</span>
<span class="nv">$ </span>terraform destroy <span class="nt">-auto-approve</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h2 id="마치며">마치며</h2>

<p>5주차는 두편으로 이어집니다. 첫번째 편에서는 모듈화에 대해 알아보고, 모듈을 만들고 사용하는 방법을 실습해 보았습니다.
두번째 편에서는 Terraform Runner에 대해 알아보겠습니다.</p>

<p><a href="/posts/2024-07-13-T101-Study-Terraform-Week-5b/">[T101 4기] Runner 바로가기</a></p>

  </div>

  <div id="toc-minimap" class="toc-minimap collapsed">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">들어가며</a></li>
<li class="toc-entry toc-h2">
<a href="#module">Module</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#module%EC%9D%98-%EA%B0%9C%EC%9A%94">Module의 개요</a>
<ul>
<li class="toc-entry toc-h4"><a href="#module%EC%9D%98-%EA%B5%AC%EC%84%B1">Module의 구성</a></li>
<li class="toc-entry toc-h4"><a href="#module%EC%9D%98-%EC%9E%A5%EC%A0%90">Module의 장점</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#%EB%AA%A8%EB%93%88-%EC%9E%91%EC%84%B1%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EC%9B%90%EC%B9%99">모듈 작성의 기본 원칙</a></li>
<li class="toc-entry toc-h3">
<a href="#%EB%AA%A8%EB%93%88%ED%99%94-%ED%95%B4%EB%B3%B4%EA%B8%B0">모듈화 해보기</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EC%8B%A4%EC%8A%B5-1-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0">실습 1. 비밀번호 생성하기</a></li>
<li class="toc-entry toc-h4"><a href="#%EC%8B%A4%EC%8A%B5-2-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EC%83%9D%EC%84%B1%ED%95%98%EB%8A%94-%EB%AA%A8%EB%93%88%EC%9D%84-%EB%A3%A8%ED%8A%B8-%EB%AA%A8%EB%93%88%EC%97%90%EC%84%9C-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0">실습 2. 비밀번호 생성하는 모듈을 루트 모듈에서 호출하기</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#%EB%AA%A8%EB%93%88-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EC%8B%9D">모듈 사용 방식</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EB%AA%A8%EB%93%88%EA%B3%BC-%ED%94%84%EB%A1%9C%EB%B0%94%EC%9D%B4%EB%8D%94">모듈과 프로바이더</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#%EB%AA%A8%EB%93%88-%EC%86%8C%EC%8A%A4-%EA%B4%80%EB%A6%AC">모듈 소스 관리</a>
<ul>
<li class="toc-entry toc-h4"><a href="#%EC%B0%B8%EC%A1%B0-%EC%98%88%EC%A0%9C">참조 예제</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">마치며</a></li>
</ul>
  </div>
<a class="u-url" href="/posts/2024-07-10-T101-Study-Terraform-Week-5/" hidden></a>
</article>



<div class="PageNavigation">
  
  <a class="prev" href="/posts/2024-07-06-T101-Study-Terraform-Week-4/">« [T101 4기] Provider &amp; State</a>
  
  
  <a class="next" href="/posts/2024-07-13-T101-Study-Terraform-Week-5b/">[T101 4기] Runner »</a>
  
</div>

<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = "https://sweetlittlebird.github.io/posts/2024-07-10-T101-Study-Terraform-Week-5/";
this.page.identifier = "/posts/T101 Study - Terraform Week 5";
};
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Sweet Little Bird</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Sweet Little Bird</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/sweetlittlebird"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sweetlittlebird</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>공부 기록과 개발 이야기를 담은 블로그입니다.</p>
      </div>
    </div>

  </div>

</footer>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
      <!-- Background of PhotoSwipe. 
           It's a separate element as animating opacity is faster than rgba(). -->
      <div class="pswp__bg"></div>
      <!-- Slides wrapper with overflow:hidden. -->
      <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
          <div class="pswp__top-bar">
            <!--  Controls are self-explanatory. Order can be changed. -->
            <div class="pswp__counter"></div>
            <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
            <button class="pswp__button pswp__button--share" title="Share"></button>
            <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
            <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
            <!-- element will get class pswp__preloader--active when preloader is running -->
            <div class="pswp__preloader">
              <div class="pswp__preloader__icn">
                <div class="pswp__preloader__cut">
                  <div class="pswp__preloader__donut"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
            <div class="pswp__share-tooltip"></div>
          </div>
          <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
          </button>
          <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
          </button>
          <div class="pswp__caption">
            <div class="pswp__caption__center"></div>
          </div>
        </div>
      </div>
    </div>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EWGY9N8QXY"></script>

    
    <script async src="/assets/dist/app.min.js"></script>
    
  
    <a href="#" id="back-to-top"><span>Back to Top</span></a>
  </body>

</html>
