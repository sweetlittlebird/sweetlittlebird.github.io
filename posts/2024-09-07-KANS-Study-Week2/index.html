<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[KANS 3ê¸°] K8S Flannel CNI &amp; PAUSE | Sweet Little Bird</title>
<meta name="generator" content="Jekyll v4.3.3">
<meta property="og:title" content="[KANS 3ê¸°] K8S Flannel CNI &amp; PAUSE">
<meta property="og:locale" content="ko">
<meta name="description" content="ì§€ë‚œì£¼ì— ì´ì–´ ì´ë²ˆì£¼ì—ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ëŒ€í•´ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ê³  KIND, PAUSE ì»¨í…Œì´ë„ˆì™€ Flannel CNIì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.">
<meta property="og:description" content="ì§€ë‚œì£¼ì— ì´ì–´ ì´ë²ˆì£¼ì—ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ëŒ€í•´ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ê³  KIND, PAUSE ì»¨í…Œì´ë„ˆì™€ Flannel CNIì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.">
<link rel="canonical" href="https://sweetlittlebird.github.io/posts/2024-09-07-KANS-Study-Week2/">
<meta property="og:url" content="https://sweetlittlebird.github.io/posts/2024-09-07-KANS-Study-Week2/">
<meta property="og:site_name" content="Sweet Little Bird">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-09-07T17:40:18+09:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="[KANS 3ê¸°] K8S Flannel CNI &amp; PAUSE">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-09-07T17:40:18+09:00","datePublished":"2024-09-07T17:40:18+09:00","description":"ì§€ë‚œì£¼ì— ì´ì–´ ì´ë²ˆì£¼ì—ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ëŒ€í•´ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ê³  KIND, PAUSE ì»¨í…Œì´ë„ˆì™€ Flannel CNIì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.","headline":"[KANS 3ê¸°] K8S Flannel CNI &amp; PAUSE","mainEntityOfPage":{"@type":"WebPage","@id":"https://sweetlittlebird.github.io/posts/2024-09-07-KANS-Study-Week2/"},"url":"https://sweetlittlebird.github.io/posts/2024-09-07-KANS-Study-Week2/"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/dist/photoswipe.min.css">
  <link rel="stylesheet" href="/assets/dist/main.min.css">
  <link rel="stylesheet" href="/assets/dist/main_dark.min.css" media="(prefers-color-scheme: dark)">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pretendard/1.3.9/static/pretendard.css" integrity="sha512-NzqTHTrO48HsIamogmIaVhTXoSgRF24Cn+ynrNYrFuKrY0AdDbmcNieiOHsQARS/r0Gax9VwV3/rVMHs3ipUlg==" crossorigin="anonymous" referrerpolicy="no-referrer">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!--  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&display=swap" rel="stylesheet">-->
  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&amp;family=Milonga&amp;display=swap" rel="stylesheet">

  <link rel="shortcut icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
<link type="application/atom+xml" rel="alternate" href="https://sweetlittlebird.github.io/feed.xml" title="Sweet Little Bird">
</head>
<body class="body--contents">
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Sweet Little Bird</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/about/">ì†Œê°œ</a><a class="page-link" href="/posts/">ê¸€ ëª©ë¡</a>
</div>
      </nav>
</div>
  
  <span id="scroll-indicator"></span>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[KANS 3ê¸°] K8S Flannel CNI &amp; PAUSE</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-09-07T17:40:18+09:00" itemprop="datePublished">2024ë…„ 09ì›” 07ì¼ì— ì‘ì„±
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="table-of-content">
      <header>ëª©ì°¨</header>
      <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">ë“¤ì–´ê°€ë©°</a></li>
<li class="toc-entry toc-h2"><a href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EC%86%8C%EA%B0%9C">ì¿ ë²„ë„¤í‹°ìŠ¤ ì†Œê°œ</a></li>
<li class="toc-entry toc-h2">
<a href="#kind-%EC%86%8C%EA%B0%9C-%EB%B0%8F-%EC%84%A4%EC%B9%98">kind ì†Œê°œ ë° ì„¤ì¹˜</a>
<ul>
<li class="toc-entry toc-h3"><a href="#%EC%84%A4%EC%B9%98">ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h3"><a href="#1-node-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8">1-Node í´ëŸ¬ìŠ¤í„° êµ¬ì„± í…ŒìŠ¤íŠ¸</a></li>
<li class="toc-entry toc-h3"><a href="#2-node-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8">2-Node í´ëŸ¬ìŠ¤í„° êµ¬ì„± í…ŒìŠ¤íŠ¸</a></li>
<li class="toc-entry toc-h3"><a href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B4%80%EB%A0%A8-%EC%A0%95%EB%B3%B4-%EC%A1%B0%EC%82%AC">ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì •ë³´ ì¡°ì‚¬</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%8C%8C%EB%93%9C-%EC%83%9D%EC%84%B1-%EB%B0%8F-%ED%99%95%EC%9D%B8">íŒŒë“œ ìƒì„± ë° í™•ì¸</a></li>
<li class="toc-entry toc-h3"><a href="#%EC%BB%A8%ED%8A%B8%EB%A1%A4-%ED%94%8C%EB%A0%88%EC%9D%B8-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8">ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì»¨í…Œì´ë„ˆ ì •ë³´ í™•ì¸</a></li>
<li class="toc-entry toc-h3"><a href="#multi-node-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-with-kube-ops-view--mapping-ports">Multi-Node í´ëŸ¬ìŠ¤í„° with kube-ops-view &amp; mapping ports</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#%ED%8C%8C%EB%93%9C--pause-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88">íŒŒë“œ &amp; PAUSE ì»¨í…Œì´ë„ˆ</a>
<ul>
<li class="toc-entry toc-h3"><a href="#k8s-cri-container-runtime-interface">K8S CRI (Container Runtime Interface)</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%8C%8C%EB%93%9C-pod">íŒŒë“œ (Pod)</a></li>
<li class="toc-entry toc-h3">
<a href="#pause-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88">PAUSE ì»¨í…Œì´ë„ˆ</a>
<ul>
<li class="toc-entry toc-h4"><a href="#pause-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%8B%A4%EC%8A%B5">Pause ì»¨í…Œì´ë„ˆ ì‹¤ìŠµ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#cni-container-network-interface">CNI (Container Network Interface)</a>
<ul>
<li class="toc-entry toc-h3"><a href="#4%EA%B0%80%EC%A7%80-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD%EA%B3%BC-4%EA%B0%80%EC%A7%80-%EB%AC%B8%EC%A0%9C">4ê°€ì§€ ìš”êµ¬ì‚¬í•­ê³¼ 4ê°€ì§€ ë¬¸ì œ</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#flannel">Flannel</a>
<ul>
<li class="toc-entry toc-h3"><a href="#kind-%EC%99%80-flannel-%EC%84%A4%EC%B9%98">Kind ì™€ Flannel ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h3"><a href="#flannel-%EC%84%A4%EC%B9%98-%ED%99%95%EC%9D%B8">Flannel ì„¤ì¹˜ í™•ì¸</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%86%B5%EC%8B%A0-%ED%9D%90%EB%A6%84-%EC%9D%B4%ED%95%B4">í†µì‹  íë¦„ ì´í•´</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">ë§ˆì¹˜ë©°</a></li>
</ul>
    </div>
    <h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì§€ë‚œì£¼ì— ì´ì–´ ì´ë²ˆì£¼ì—ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ëŒ€í•´ ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ê³  KIND, PAUSE ì»¨í…Œì´ë„ˆì™€ Flannel CNIì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
KANS 3ê¸° 2ì£¼ì°¨ ìŠ¤í„°ë””ë¥¼ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ì¿ ë²„ë„¤í‹°ìŠ¤-ì†Œê°œ">ì¿ ë²„ë„¤í‹°ìŠ¤ ì†Œê°œ</h2>

<ul>
  <li>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” êµ¬ê¸€ì—ì„œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê³µê°œí•œ ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìë™ìœ¼ë¡œ ë°°í¬, ìŠ¤ì¼€ì¼ë§ ë° ê´€ë¦¬í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼ì…ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_1.gif" alt="20240907_kans_w2_1.gif" class="image-center" loading="lazy" width="693" height="359">
<em class="image-caption">ì¶œì²˜: <a href="https://blog.naver.com/love_tolty/222167051615">https://blog.naver.com/love_tolty/222167051615</a></em></p>

<ul>
  <li>
    <p>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™ì´ ë‹¤ì–‘í•œ ì»´í¬ë„ŒíŠ¸ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤. ê° ìš”ì†Œë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
<strong>Control Plane(ë§ˆìŠ¤í„° ë…¸ë“œ)</strong> : ë§ˆìŠ¤í„°ëŠ” ë‹¨ì¼ ì„œë²„ í˜¹ì€ ê³ ê°€ìš©ì„±ì„ ìœ„í•œ í´ëŸ¬ìŠ¤í„° ë§ˆìŠ¤í„°ë¡œ êµ¬ì¶•
    <ul>
      <li>kube-<strong>apiserver</strong> : <strong>ëª¨ë“  ìš”ì²­</strong>ì„ ë°›ì•„ ë“œë¦¬ëŠ” <strong>API ì„œë²„</strong>
</li>
      <li>etcd : í´ëŸ¬ìŠ¤í„°ë‚´ ëª¨ë“  ë©”íƒ€ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” key/value DB ì„œë¹„ìŠ¤</li>
      <li>kube-scheduler : ì»¨í…Œì´ë„ˆë¥¼ ì›Œì»¤ ë…¸ë“œì— ë°°ì¹˜í•˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬</li>
      <li>kube-controller-manager : í˜„ì¬ ìƒíƒœì™€ ë°”ë¼ëŠ” ìƒíƒœë¥¼ ì§€ì†ì ìœ¼ë¡œ í™•ì¸í•˜ë©° íŠ¹ì • ì´ë²¤íŠ¸ì— ë”°ë¼ íŠ¹ì • ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ - <a href="https://kubernetes.io/docs/concepts/architecture/controller/">ë§í¬</a>
</li>
      <li>cloud-controller-manager : (AWS, GCP, Azure ë“± í´ë¼ìš°ë“œ í”Œë«í¼ì— íŠ¹í™”ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ì œì–´í•˜ëŠ” í´ë¼ìš°ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ - <a href="https://kubernetes.io/docs/concepts/architecture/cloud-controller/">ë§í¬</a>
</li>
    </ul>
  </li>
  <li>
<strong>Worker Node(ì›Œì»¤ ë…¸ë“œ)</strong> - <a href="https://kubernetes.io/docs/concepts/architecture/nodes/">ë§í¬</a>
    <ul>
      <li>kubelet : ë§ˆìŠ¤í„°ì˜ ëª…ë ¹ì— ë”°ë¼ ì»¨í…Œì´ë„ˆì˜ ë¼ì´í”„ ì‚¬ì´í´ì„ ê´€ë¦¬í•˜ëŠ” ë…¸ë“œ ê´€ë¦¬ì</li>
      <li>kube-proxy : ì»¨í…Œì´ë„ˆì˜ ë„¤íŠ¸ì›Œí‚¹ì„ ì±…ì„ì§€ëŠ” í”„ë¡ì‹œ, ë„¤íŠ¸ì›Œí¬ ê·œì¹™ì„ ìœ ì§€ ê´€ë¦¬</li>
      <li>Container Runtime : ì‹¤ì œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í™˜ê²½, (ContainerD, CRI-O, â€¦) - <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/">ë§í¬</a>
</li>
    </ul>
  </li>
  <li>
<strong>Addon(ì• ë“œì˜¨)</strong>
    <ul>
      <li>CNI : Container Network Interface ëŠ” k8s ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ êµ¬ì„±í•´ì¤ë‹ˆë‹¤.
        <ul>
          <li>ì˜ˆ) Flannel, Calico, Weave Net, Cilium, â€¦</li>
        </ul>
      </li>
      <li>DNS : í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ DNS ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
        <ul>
          <li>ì˜ˆ) CoreDNS, Kube-DNS, â€¦</li>
        </ul>
      </li>
      <li>ê¸°íƒ€ : ëª¨ë‹ˆí„°ë§, ëŒ€ì‹œë³´ë“œ, ë¡œê¹… ë“±ë“±</li>
    </ul>
  </li>
</ul>

<hr>

<h2 id="kind-ì†Œê°œ-ë°-ì„¤ì¹˜">kind ì†Œê°œ ë° ì„¤ì¹˜</h2>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_2.png" alt="img.png" class="w-30 image-center" loading="lazy" width="985" height="594"></p>

<p>kindëŠ” <strong>K</strong>ubernetes <strong>IN</strong> <strong>D</strong>ockerì˜ ì•½ìë¡œ, ë¡œì»¬ í™˜ê²½ì—ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ Kubernetesë¥¼ Docker ì•ˆì—ì„œ DIND(Docker in Docker) ë°©ì‹ìœ¼ë¡œ êµ¬ë™ì‹œì¼œì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
minikubeë‚˜ k3s ë“±ê³¼ ë‹¬ë¦¬ <strong>Dockerë§Œ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì†ì‰½ê²Œ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>kindì˜ êµ¬ì¡°ë¥¼ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
<img src="/assets/2024/kans-3th/w2/20240907_kans_w2_3.png" alt="img.png" class="image-center" loading="lazy" width="2560" height="1440">
<em class="image-caption">ì¶œì²˜ : <a href="[https://kind.sigs.k8s.io/docs/design/initial/">https://kind.sigs.k8s.io/docs/design/initial/</a></em>
</li>
</ul>

<h3 id="ì„¤ì¹˜">ì„¤ì¹˜</h3>

<p>ì œê°€ ì‚¬ìš©ì¤‘ì¸ macOSë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. macOSì—ì„œ í…Œë¼í¼ì„ ì„¤ì¹˜í•˜ë ¤ë©´ Homebrewë¥¼ ì´ìš©í•˜ì—¬ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
(í™ˆë¸Œë£¨ ì„¤ì¹˜ ë°©ë²•ì€ <a href="https://whalec.io/homebrew-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95">https://whalec.io/homebrew-ì„¤ì¹˜-ë°-ì‚¬ìš©-ë°©ë²•</a> ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.)</p>

<ul>
  <li>kind ì„¤ì¹˜ ë° í•„ìˆ˜ íˆ´ ì„¤ì¹˜</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install Kind</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kind
<span class="nv">$ </span>kind <span class="nt">--version</span>
<span class="c"># =&gt; kind version 0.24.0</span>

<span class="c"># Install kubectl</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kubernetes-cli
<span class="nv">$ </span>kubectl version <span class="nt">--client</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># =&gt; Client Version: v1.31.0</span>
<span class="c">#    Kustomize Version: v5.4.2</span>

<span class="c"># Install Helm</span>
<span class="nv">$ </span>brew <span class="nb">install </span>helm
<span class="nv">$ </span>helm version
<span class="c"># =&gt; version.BuildInfo{Version:&amp;quot;v3.15.4&amp;quot;, GitCommit:&amp;quot;fa9efb07d9d8debbb4306d72af76a383895aa8c4&amp;quot;, GitTreeState:&amp;quot;clean&amp;quot;, GoVersion:&amp;quot;go1.22.6&amp;quot;}</span>

<span class="c"># Install Wireshark : ìº¡ì²˜ëœ íŒ¨í‚· í™•ì¸</span>
<span class="nv">$ </span>brew <span class="nb">install</span> <span class="nt">--cask</span> wireshark

<span class="c"># (ì„ íƒ) kubectl ì¶œë ¥ ì‹œ í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kubecolor
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"alias kubectl=kubecolor"</span> <span class="o">&gt;&gt;</span> ~/.zshrc
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"compdef kubecolor=kubectl"</span> <span class="o">&gt;&gt;</span> ~/.zshrc
</code></pre></div></div>

<h3 id="1-node-í´ëŸ¬ìŠ¤í„°-êµ¬ì„±-í…ŒìŠ¤íŠ¸">1-Node í´ëŸ¬ìŠ¤í„° êµ¬ì„± í…ŒìŠ¤íŠ¸</h3>

<ul>
  <li>ê°„ë‹¨í•œ í´ëŸ¬ìŠ¤í„°ë¥¼ ë§Œë“¤ê³  í…ŒìŠ¤íŠ¸ í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ ì „ í™•ì¸</span>
<span class="nv">$ </span>docker ps

<span class="c"># Create a cluster with kind</span>
<span class="nv">$ </span>kind create cluster
<span class="c"># =&gt; Creating cluster &amp;quot;kind&amp;quot; ...</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Ensuring node image (kindest/node:v1.31.0) ğŸ–¼</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Preparing nodes ğŸ“¦ </span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Writing configuration ğŸ“œ</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Starting control-plane ğŸ•¹ï¸</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Installing CNI ğŸ”Œ</span>
<span class="c">#    &lt;span style="color:green;"&gt;âœ“&lt;/span&gt; Installing StorageClass ğŸ’¾</span>
<span class="c">#    Set kubectl context to &amp;quot;kind-kind&amp;quot;</span>
<span class="c">#    You can now use your cluster with:</span>
<span class="c">#    </span>
<span class="c">#    kubectl cluster-info --context kind-kind </span>
<span class="c">#    </span>
<span class="c">#    Not sure what to do next? ğŸ˜…  Check out https://kind.sigs.k8s.io/docs/user/quick-start/</span>

<span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>kind get clusters
<span class="nv">$ </span>kind get nodes
<span class="nv">$ </span>kubectl cluster-info

<span class="c"># ë…¸ë“œ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-o</span> wide

<span class="c"># íŒŒë“œ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span>
<span class="nv">$ </span>kubectl get componentstatuses

<span class="c"># ì»¨íŠ¸ë¡¤í”Œë ˆì¸ (ì»¨í…Œì´ë„ˆ) ë…¸ë“œ 1ëŒ€ê°€ ì‹¤í–‰</span>
<span class="nv">$ </span>docker ps
<span class="nv">$ </span>docker images

<span class="c"># kube config íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config

<span class="c"># nginx íŒŒë“œ ë°°í¬ ë° í™•ì¸ : ì»¨íŠ¸ë¡¤í”Œë ˆì¸ ë…¸ë“œì¸ë° íŒŒë“œê°€ ë°°í¬ ë ê¹Œìš”?</span>
<span class="nv">$ </span>kubectl run nginx <span class="nt">--image</span><span class="o">=</span>nginx:alpine
<span class="nv">$ </span>kubectl get pod <span class="nt">-owide</span>

<span class="c"># ë…¸ë“œì— Taints ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe node | <span class="nb">grep </span>Taints
<span class="c"># =&gt; Taints:             &lt;none&gt;</span>

<span class="c"># í´ëŸ¬ìŠ¤í„° ì‚­ì œ</span>
<span class="nv">$ </span>kind delete cluster

<span class="c"># kube config ì‚­ì œ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config
</code></pre></div></div>

<ul>
  <li>í…ŒìŠ¤íŠ¸ ì¤‘ì— ë…¸ë“œê°€ ì»¤íŠ¸ë¡¤ í”Œë ˆì¸ í•˜ë‚˜ ë¿ì¸ë°ë„ íŒŒë“œê°€ ë°°í¬ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>
<code class="language-plaintext highlighter-rouge">kubectl describe node | grep Taints</code>ë¥¼ í†µí•´ í™•ì¸í•´ë³¸ ê²°ê³¼ <code class="language-plaintext highlighter-rouge">=&gt; Taints: &lt;none&gt;</code>ë¡œ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì— ë³´í†µ ê±¸ë ¤ìˆëŠ” taintê°€ ì—†ì–´ì„œ íŒŒë“œê°€ ë°°í¬ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_4.png" alt="img.png" loading="lazy" width="1334" height="1256"></p>

<h3 id="2-node-í´ëŸ¬ìŠ¤í„°-êµ¬ì„±-í…ŒìŠ¤íŠ¸">2-Node í´ëŸ¬ìŠ¤í„° êµ¬ì„± í…ŒìŠ¤íŠ¸</h3>

<ul>
  <li>ì´ë²ˆì—ëŠ” ì¢€ ë” ë‚˜ì•„ê°€ì„œ control-planeê³¼ workerì˜ 2ê°œì˜ ë…¸ë“œë¡œ êµ¬ì„±ëœ KIND í´ëŸ¬ìŠ¤í„°ë¥¼ ë§Œë“¤ê³ , í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ ì „ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span>

<span class="c"># kind ëŠ” ë³„ë„ ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ìƒì„± í›„ ì‚¬ìš© : ê¸°ë³¸ê°’ 172.18.0.0/16</span>
<span class="nv">$ </span>docker network <span class="nb">ls</span>
<span class="c"># =&gt; NETWORK ID     NAME                     DRIVER    SCOPE</span>
<span class="c">#    ...</span>
<span class="c">#    3bbcc6aa8f38   kind                     bridge    local</span>
<span class="c">#    ...</span>

<span class="nv">$ </span>docker inspect kind | jq
<span class="c"># =&gt; [</span>
<span class="c">#      {</span>
<span class="c">#        &amp;quot;Name&amp;quot;: &amp;quot;kind&amp;quot;,</span>
<span class="c">#        &amp;quot;Driver&amp;quot;: &amp;quot;bridge&amp;quot;,</span>
<span class="c">#        ...</span>
<span class="c">#        &amp;quot;IPAM&amp;quot;: {</span>
<span class="c">#          &amp;quot;Driver&amp;quot;: &amp;quot;default&amp;quot;,</span>
<span class="c">#          &amp;quot;Options&amp;quot;: {},</span>
<span class="c">#          &amp;quot;Config&amp;quot;: [</span>
<span class="c">#            {</span>
<span class="c">#              &amp;quot;Subnet&amp;quot;: &amp;quot;172.20.0.0/16&amp;quot;,</span>
<span class="c">#              &amp;quot;Gateway&amp;quot;: &amp;quot;172.20.0.1&amp;quot;</span>
<span class="c">#            }</span>
<span class="c">#          ]</span>
<span class="c">#        },</span>
<span class="c">#       ...</span>
<span class="c">#      }</span>
<span class="c">#    ]</span>

<span class="c"># KINDë¡œ control-plane, workerë¼ëŠ” 2ê°œì˜ ë…¸ë“œë¥¼ ê°€ì§„ í´ëŸ¬ìŠ¤í„° ë§Œë“¤ê¸°</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOT</span><span class="sh"> &gt; kind-2node.yaml 
# two node (one workers) cluster config
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
</span><span class="no">EOT
</span><span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-2node.yaml <span class="nt">--name</span> myk8s

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kind get nodes <span class="nt">--name</span> myk8s
<span class="c"># =&gt; myk8s-worker</span>
<span class="c">#    myk8s-control-plane</span>

<span class="c"># k8s api ì£¼ì†Œ í™•ì¸</span>
<span class="nv">$ </span>kubectl cluster-info
<span class="c"># =&gt; &lt;span style="color:green;"&gt;Kubernetes control plane&lt;/span&gt; is running at &lt;span style="color:olive;"&gt;https://127.0.0.1:58638&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:green;"&gt;CoreDNS&lt;/span&gt; is running at &lt;span style="color:olive;"&gt;https://127.0.0.1:58638/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy&lt;/span&gt;</span>
<span class="c">#    </span>
<span class="c">#    To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>

<span class="c"># í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì† í…ŒìŠ¤íŠ¸ </span>
<span class="nv">$ </span>curl <span class="nt">-k</span> https://localhost:58638
<span class="c"># =&gt; {</span>
<span class="c">#      &amp;quot;kind&amp;quot;: &amp;quot;Status&amp;quot;,</span>
<span class="c">#      &amp;quot;apiVersion&amp;quot;: &amp;quot;v1&amp;quot;,</span>
<span class="c">#      &amp;quot;metadata&amp;quot;: {},</span>
<span class="c">#      &amp;quot;status&amp;quot;: &amp;quot;Failure&amp;quot;,</span>
<span class="c">#      &amp;quot;message&amp;quot;: &amp;quot;forbidden: User \&amp;quot;system:anonymous\&amp;quot; cannot get path \&amp;quot;/\&amp;quot;&amp;quot;,</span>
<span class="c">#      &amp;quot;reason&amp;quot;: &amp;quot;Forbidden&amp;quot;,</span>
<span class="c">#      &amp;quot;details&amp;quot;: {},</span>
<span class="c">#      &amp;quot;code&amp;quot;: 403</span>
<span class="c">#    } # í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì†ì´ ë©ë‹ˆë‹¤! ì™œ ê·¸ëŸ´ê¹Œìš”?</span>

<span class="nv">$ </span>docker ps <span class="c"># í¬íŠ¸ í¬ì›Œë”© ì •ë³´ í™•ì¸</span>
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                  NAMES</span>
<span class="c">#    6228f280b992   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   3 minutes ago   Up 3 minutes   0.0.0.0:30000-30001-&amp;gt;30000-30001/tcp   myk8s-worker</span>
<span class="c">#    219113c36204   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   3 minutes ago   Up 3 minutes   127.0.0.1:58638-&amp;gt;6443/tcp              myk8s-control-plane</span>

<span class="c"># ë„ì»¤ì—ì„œ 127.0.0.1:58638-&amp;gt;6443/tcp ë¡œ í¬íŠ¸í¬ì›Œë”©ì„ í•˜ê¸° ë•Œë¬¸ì¸ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </span>

<span class="c"># apiserver í”„ë¡œì„¸ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane ss <span class="nt">-tnlp</span> | <span class="nb">grep </span>6443
<span class="c"># =&gt; LISTEN 0      4096               *:6443             *:*    users:((&amp;quot;kube-apiserver&amp;quot;,pid=584,fd=3)) </span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> <span class="nv">component</span><span class="o">=</span>kube-apiserver <span class="nt">-owide</span> <span class="c"># íŒŒë“œ IP í™•ì¸</span>
<span class="c"># =&gt; NAME                                 READY   STATUS    RESTARTS   AGE     IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    kube-apiserver-myk8s-control-plane   1/1     Running   0          5m39s   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c"># kube-apiserver íŒŒë“œ ìƒì„¸ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe  pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> <span class="nv">component</span><span class="o">=</span>kube-apiserver

<span class="c"># health check ì£¼ì†Œ ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane curl <span class="nt">-k</span> https://localhost:6443/livez <span class="p">;</span><span class="nb">echo</span>
<span class="c"># =&gt; ok</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane curl <span class="nt">-k</span> https://localhost:6443/readyz <span class="p">;</span><span class="nb">echo</span>
<span class="c"># =&gt; ok</span>

<span class="c"># ë…¸ë“œ ì •ë³´ í™•ì¸ : CRI ëŠ” containerd ì‚¬ìš©</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME                  STATUS   ROLES           AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION     CONTAINER-RUNTIME</span>
<span class="c">#    myk8s-control-plane   Ready    control-plane   7m15s   v1.31.0   172.20.0.2    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>
<span class="c">#    myk8s-worker          Ready    &amp;lt;none&amp;gt;          7m1s    v1.31.0   172.20.0.3    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>

<span class="c"># íŒŒë“œ ì •ë³´ í™•ì¸ : CNI ëŠ” kindnet ì‚¬ìš©</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>
<span class="c"># =&gt; NAMESPACE            NAME                                          READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    kube-system          coredns-6f6b679f8f-9gxnw                      1/1     Running   0          10m   10.244.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          etcd-myk8s-control-plane                      1/1     Running   0          10m   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kindnet-b5brb                                 1/1     Running   0          10m   172.20.0.3   myk8s-worker          &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-apiserver-myk8s-control-plane            1/1     Running   0          10m   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-controller-manager-myk8s-control-plane   1/1     Running   0          10m   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-proxy-tbh7b                              1/1     Running   0          10m   172.20.0.3   myk8s-worker          &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-scheduler-myk8s-control-plane            1/1     Running   0          10m   172.20.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    local-path-storage   local-path-provisioner-57c5987fd4-nfcv8       1/1     Running   0          10m   10.244.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    ...</span>

<span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸ </span>
<span class="nv">$ </span>kubectl get namespaces
<span class="c"># =&gt; NAME                 STATUS   AGE</span>
<span class="c">#    default              Active   11m</span>
<span class="c">#    kube-node-lease      Active   11m</span>
<span class="c">#    kube-public          Active   11m</span>
<span class="c">#    kube-system          Active   11m</span>
<span class="c">#    local-path-storage   Active   10m</span>

<span class="c"># ë””ë²„ê·¸ìš© ë‚´ìš© ì¶œë ¥ì— ~/.kube/config ê¶Œí•œ ì¸ì¦ ë¡œë“œ</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-v6</span>
<span class="c"># =&gt; I0907 21:08:08.698472   40997 loader.go:395] Config loaded from file:  /Users/psyche/.kube/config</span>
<span class="c">#    I0907 21:08:08.709347   40997 round_trippers.go:553] GET https://127.0.0.1:58638/api/v1/namespaces/default/pods?limit=500 200 OK in 8 milliseconds</span>
<span class="c">#    No resources found in default namespace.</span>

<span class="c"># kube config íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config

<span class="c"># local-path ë¼ëŠ” StorageClass ê°€ ì„¤ì¹˜, local-path ëŠ” ë…¸ë“œì˜ ë¡œì»¬ ì €ì¥ì†Œë¥¼ í™œìš©í•¨</span>
<span class="c"># ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì˜ path ë¥¼ ì§€ì •í•  í•„ìš” ì—†ì´ local-path provisioner ì´ ë³¼ë¥¨ì„ ê´€ë¦¬</span>
<span class="nv">$ </span>kubectl get sc
<span class="c"># =&gt; NAME                 PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span>
<span class="c">#    standard (default)   rancher.io/local-path   Delete          WaitForFirstConsumer   false                  12m</span>
<span class="nv">$ </span>kubectl get deploy <span class="nt">-n</span> local-path-storage
</code></pre></div></div>

<h3 id="ì¿ ë²„ë„¤í‹°ìŠ¤-ê´€ë ¨-ì •ë³´-ì¡°ì‚¬">ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì •ë³´ ì¡°ì‚¬</h3>

<p>ì´ë²ˆì—ëŠ” KIND ë‚´ë¶€ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì •ë³´ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
ì›í™œí•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í•„ìš”í•œ íˆ´ì„ ì„¤ì¹˜í•˜ê³ , KIND ë‚´ë¶€ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì •ë³´ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íˆ´ ì„¤ì¹˜</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump htop git nano -y'</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump htop git nano -y'</span>

<span class="c"># static pod manifest ìœ„ì¹˜ ì°¾ê¸°</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane <span class="nb">grep </span>staticPodPath /var/lib/kubelet/config.yaml
<span class="c"># =&gt; staticPodPath: /etc/kubernetes/manifests</span>

<span class="c"># static pod ì •ë³´ í™•ì¸ : kubectl ë° control plane ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•Šê³  kubelet ì„ í†µí•´ ì§€ì •í•œ ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane tree /etc/kubernetes/manifests/
<span class="c"># =&gt; /etc/kubernetes/manifests/</span>
<span class="c">#    |-- etcd.yaml</span>
<span class="c">#    |-- kube-apiserver.yaml</span>
<span class="c">#    |-- kube-controller-manager.yaml</span>
<span class="c">#    `-- kube-scheduler.yaml</span>

<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker tree /etc/kubernetes/manifests/
<span class="c"># =&gt; /etc/kubernetes/manifests/</span>

<span class="c"># ì›Œì»¤ ë…¸ë“œ(ì»¨í…Œì´ë„ˆ) bash ì§„ì…</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker bash
<span class="c"># ---------------------------------</span>
<span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; root</span>

<span class="c"># kubelet ìƒíƒœ í™•ì¸</span>
<span class="nv">$ </span>systemctl status kubelet
<span class="c"># =&gt; â— kubelet.service - kubelet: The Kubernetes Node Agent</span>
<span class="c">#         Loaded: loaded (/etc/systemd/system/kubelet.service; enabled; preset: enabled)</span>
<span class="c">#        Drop-In: /etc/systemd/system/kubelet.service.d</span>
<span class="c">#                 â””â”€10-kubeadm.conf, 11-kind.conf</span>
<span class="c">#         Active: active (running) since Sat 2024-09-07 11:56:44 UTC; 48min ago</span>
<span class="c">#           Docs: http://kubernetes.io/docs/</span>
<span class="c">#       Main PID: 236 (kubelet)</span>
<span class="c">#          Tasks: 15 (limit: 2254)</span>
<span class="c">#         Memory: 32.9M</span>
<span class="c">#            CPU: 1min 7.074s</span>
<span class="c">#         CGroup: /kubelet.slice/kubelet.service</span>
<span class="c">#                 â””â”€236 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/conf&gt;</span>
<span class="c">#    ...</span>

<span class="c"># ì»¨í…Œì´ë„ˆ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; bash: docker: command not found</span>
<span class="nv">$ </span>crictl ps
<span class="c"># =&gt; CONTAINER           IMAGE               CREATED             STATE               NAME                ATTEMPT             POD ID              POD</span>
<span class="c">#    dd7ff0509e335       6a23fa8fd2b78       49 minutes ago      Running             kindnet-cni         0                   99f981aced025       kindnet-b5brb</span>
<span class="c">#    41b224e66bc3c       c573e1357a14e       49 minutes ago      Running             kube-proxy          0                   8880634c13ba5       kube-proxy-tbh7b</span>
</code></pre></div></div>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">docker ps</code>í–ˆì„ë•ŒëŠ” <code class="language-plaintext highlighter-rouge">command not found</code>ê°€ ë‚˜ì˜¤ê³  <code class="language-plaintext highlighter-rouge">crictl ps</code>ë¡œ í–ˆì„ë•Œ ì»¨í…Œì´ë„ˆ ì •ë³´ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³´ë©´, KINDëŠ” ì´ë¦„ê³¼ëŠ” ë‹¤ë¥´ê²Œ Docker ëŒ€ì‹  CRI(Container Runtime Interface)ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— <code class="language-plaintext highlighter-rouge">docker</code> ëª…ë ¹ì–´ ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">crictl</code> ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kube-proxy í™•ì¸</span>
<span class="nv">$ </span>pstree
<span class="c"># =&gt; systemd-+-containerd---15*[{containerd}]</span>
<span class="c">#            |-containerd-shim-+-kube-proxy---8*[{kube-proxy}]</span>
<span class="c">#            |                 |-pause</span>
<span class="c">#            |                 `-12*[{containerd-shim}]</span>
<span class="c">#            |-containerd-shim-+-kindnetd---11*[{kindnetd}]</span>
<span class="c">#            |                 |-pause</span>
<span class="c">#            |                 `-12*[{containerd-shim}]</span>
<span class="c">#            |-kubelet---14*[{kubelet}]</span>
<span class="c">#            `-systemd-journal</span>
<span class="nv">$ </span>pstree <span class="nt">-p</span>
<span class="c"># kube-proxy í”„ë¡œì„¸ìŠ¤ ì •ë³´</span>
<span class="nv">$ </span>ps afxuwww |grep proxy 
<span class="c"># =&gt; root         387  0.0  1.1 1290144 24112 ?       Ssl  11:56   0:02  \_ /usr/local/bin/kube-proxy --config=/var/lib/kube-proxy/config.conf --hostname-override=myk8s-worker</span>
<span class="c"># ë°©í™”ë²½ ì„¤ì • í™•ì¸</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> mangle <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> raw <span class="nt">-S</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> security <span class="nt">-S</span>

<span class="c"># tcp listen í¬íŠ¸ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ss <span class="nt">-tnlp</span>

<span class="c"># ë¹ ì ¸ë‚˜ì˜¤ê¸°</span>
<span class="nv">$ </span><span class="nb">exit</span>
<span class="c"># ---------------------------------</span>
</code></pre></div></div>

<h3 id="íŒŒë“œ-ìƒì„±-ë°-í™•ì¸">íŒŒë“œ ìƒì„± ë° í™•ì¸</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íŒŒë“œ ìƒì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl create -f -
apiVersion: v1
kind: Pod
metadata:
  name: netpod
spec:
  containers:
  - name: netshoot-pod
    image: nicolaka/netshoot
    command: ["tail"]
    args: ["-f", "/dev/null"]
  terminationGracePeriodSeconds: 0
---
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx-pod
    image: nginx:alpine
  terminationGracePeriodSeconds: 0
</span><span class="no">EOF
</span><span class="c"># =&gt; pod/netpod created</span>
<span class="c">#    pod/nginx created</span>

<span class="c"># íŒŒë“œ í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-owide</span>
<span class="c"># =&gt; NAME     READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES</span>
<span class="c">#    netpod   1/1     Running   0          52s   10.244.1.3   myk8s-worker   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    nginx    1/1     Running   0          52s   10.244.1.2   myk8s-worker   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>

<span class="c"># netpod íŒŒë“œì—ì„œ nginx ì›¹ ì ‘ì†</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> netpod <span class="nt">--</span> curl <span class="nt">-s</span> <span class="si">$(</span>kubectl get pod nginx <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.status.podIP<span class="o">}</span><span class="si">)</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"&lt;title&gt;.*&lt;/title&gt;"</span>
<span class="c"># =&gt; &lt;title&gt;Welcome to nginx!&lt;/title&gt;</span>
</code></pre></div></div>

<h3 id="ì»¨íŠ¸ë¡¤-í”Œë ˆì¸-ì»¨í…Œì´ë„ˆ-ì •ë³´-í™•ì¸">ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì»¨í…Œì´ë„ˆ ì •ë³´ í™•ì¸</h3>

<p>ì´ë²ˆì—ëŠ” ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì»¨í…Œì´ë„ˆì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. kindëŠ” Docker IN Docker ë°©ì‹ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì„ êµ¬ì„±í•˜ê¸° ë•Œë¬¸ì—
ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì—ì„œ ì •ë³´ë¥¼ í™•ì¸í•  ë•Œì™€ í˜¸ìŠ¤íŠ¸ì—ì„œ docker ì •ë³´ë¥¼ í™•ì¸í• ë•Œì™€ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë„ì»¤ ì»¨í…Œì´ë„ˆ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED       STATUS       PORTS                                  NAMES</span>
<span class="c">#    6228f280b992   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   2 hours ago   Up 2 hours   0.0.0.0:30000-30001-&amp;gt;30000-30001/tcp   myk8s-worker</span>
<span class="c">#    219113c36204   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   2 hours ago   Up 2 hours   127.0.0.1:58638-&amp;gt;6443/tcp              myk8s-control-plane</span>

<span class="nv">$ </span>docker inspect myk8s-control-plane | jq
...
      <span class="s2">"Entrypoint"</span>: <span class="o">[</span>
        <span class="s2">"/usr/local/bin/entrypoint"</span>,
        <span class="s2">"/sbin/init"</span>
      <span class="o">]</span>,
...

<span class="c"># ì»¨íŠ¸ë¡¤í”Œë ˆì¸ ì»¨í…Œì´ë„ˆ bash ì ‘ì† í›„ í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane bash
<span class="nt">-------------------------------------------</span>
<span class="c"># CPU ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">arch</span>
<span class="c"># =&gt; aarch64      # intel í˜¸í™˜ CPUì¸ ê²½ìš° x86_64ê°€ í‘œì‹œë©ë‹ˆë‹¤.</span>

<span class="c"># ê¸°ë³¸ ì‚¬ìš©ì í™•ì¸</span>
<span class="nv">$ </span><span class="nb">whoami</span>
<span class="c"># =&gt; root</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="c"># =&gt; lo               UNKNOWN        127.0.0.1/8</span>
<span class="c">#    vethfbd4a037@if4 UP             10.244.0.1/32</span>
<span class="c">#    veth50a51781@if4 UP             10.244.0.1/32</span>
<span class="c">#    veth1822edcc@if4 UP             10.244.0.1/32</span>
<span class="c">#    eth0@if17        UP             172.20.0.2/16</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> route
<span class="c"># =&gt; 10.244.0.2 dev vethfbd4a037 scope host</span>
<span class="c">#    10.244.0.3 dev veth50a51781 scope host</span>
<span class="c">#    10.244.0.4 dev veth1822edcc scope host</span>
<span class="c">#    10.244.1.0/24 via 172.20.0.3 dev eth0</span>
<span class="c">#    172.20.0.0/16 dev eth0 proto kernel scope link src 172.20.0.2</span>
<span class="nv">$ </span><span class="nb">cat</span> /etc/resolv.conf
<span class="c"># =&gt; nameserver 192.168.65.2</span>
<span class="c">#    options ndots:0</span>

<span class="c"># Entrypoint ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> /usr/local/bin/entrypoint

<span class="c"># í”„ë¡œì„¸ìŠ¤ í™•ì¸ : PID 1 ì€ /sbin/init</span>
<span class="nv">$ </span>ps <span class="nt">-ef</span>
<span class="c"># =&gt; UID          PID    PPID  C STIME TTY          TIME CMD</span>
<span class="c">#    root           1       0  0 11:56 ?        00:00:01 /sbin/init</span>
<span class="c">#    ...</span>

<span class="c"># kindëŠ” docker ì•ˆì—ì„œ dockerë¥¼ ìš´ì˜í•˜ê¸° ìœ„í•´ OSë¥¼ í‰ë‚´ë‚´ê¸° ìœ„í•´ ìì²´ì ìœ¼ë¡œ systemdë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—</span>
<span class="c"># ìœ„ì™€ ê°™ì´ PID 1ì´ /sbin/init ê°€ ë˜ê³ , systemctl ëª…ë ¹ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
 
<span class="c"># ì»¨í…Œì´í„° ëŸ°íƒ€ì„ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>systemctl status containerd

<span class="c"># DinD ì»¨í…Œì´ë„ˆ í™•ì¸ : crictl ì‚¬ìš©</span>
<span class="nv">$ </span>crictl version
<span class="c"># =&gt; Version:  0.1.0</span>
<span class="c">#    RuntimeName:  containerd</span>
<span class="c">#    RuntimeVersion:  v1.7.18</span>
<span class="c">#    RuntimeApiVersion:  v1</span>
<span class="nv">$ </span>crictl info
<span class="nv">$ </span>crictl ps <span class="nt">-o</span> json | jq <span class="nt">-r</span> <span class="s1">'.containers[] | {NAME: .metadata.name, POD: .labels["io.kubernetes.pod.name"]}'</span>
<span class="nv">$ </span>crictl ps
<span class="c"># =&gt; CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID              POD</span>
<span class="c">#    075e7a9f5f7a3       2437cf7621777       2 hours ago         Running             coredns                   0                   5e7c18501fc65       coredns-6f6b679f8f-9gxnw</span>
<span class="c">#    6f61738127a55       2437cf7621777       2 hours ago         Running             coredns                   0                   3b69c8d195b5d       coredns-6f6b679f8f-fk27q</span>
<span class="c">#    ...</span>

<span class="c"># íŒŒë“œ ì´ë¯¸ì§€ í™•ì¸</span>
<span class="nv">$ </span>crictl images
<span class="c"># =&gt; IMAGE                                           TAG                  IMAGE ID            SIZE</span>
<span class="c">#    docker.io/library/nginx                         alpine               9d6767b714bf1       20.2MB</span>
<span class="c">#    docker.io/nicolaka/netshoot                     latest               eead9e442471d       178MB</span>
<span class="c">#    ...</span>

<span class="c"># kubectl í™•ì¸</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-v6</span>
<span class="nv">$ </span><span class="nb">cat</span> /etc/kubernetes/admin.conf

<span class="nv">$ </span><span class="nb">exit</span>
<span class="nt">-------------------------------------------</span>

<span class="c"># ë„ì»¤ ì»¨í…Œì´ë„ˆ í™•ì¸ : ë‹¤ì‹œ í•œë²ˆ ìì‹ ì˜ í˜¸ìŠ¤íŠ¸PCì—ì„œ ë„ì»¤ ì»¨í…Œì´ë„ˆ í™•ì¸, DinD ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ì—ì„œ ë³´ì´ëŠ”ì§€ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED       STATUS       PORTS                                  NAMES</span>
<span class="c">#    6228f280b992   kindest/node:v1.31.0   "/usr/local/bin/entrâ€¦"   2 hours ago   Up 2 hours   0.0.0.0:30000-30001-&gt;30000-30001/tcp   myk8s-worker</span>
<span class="c">#    219113c36204   kindest/node:v1.31.0   "/usr/local/bin/entrâ€¦"   2 hours ago   Up 2 hours   127.0.0.1:58638-&gt;6443/tcp              myk8s-control-plane</span>
<span class="nv">$ </span>docker port myk8s-control-plane

<span class="c"># kubectl í™•ì¸ : k8s api í˜¸ì¶œ ì£¼ì†Œ í™•ì¸</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-v6</span> 
</code></pre></div></div>

<ul>
  <li>KINDì˜ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì—ì„œ <code class="language-plaintext highlighter-rouge">crictl ps</code>ë¡œ ì»¨í…Œì´ë„ˆë¥¼ í™•ì¸í• ë•Œì™€ í˜¸ìŠ¤íŠ¸ì—ì„œ <code class="language-plaintext highlighter-rouge">docker ps</code>ë¡œ í™•ì¸í• ë•Œì˜ ì°¨ì´ê°€ ë‚˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>
    <p>ì´ê²ƒì€ ì•ì—ì„œë„ docker ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ docker (ì •í™•íˆëŠ” containerd)ë¥¼ ë³„ë„ë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” í˜„ìƒì…ë‹ˆë‹¤. ì´ê²ƒì´ DIND(Docker IN Docker)ì…ë‹ˆë‹¤.
â€”ë§Œì•½ ê°™ì€ ì»¨í…Œì´ë„ˆê°€ ë‚˜ì˜¨ë‹¤ë©´ Docker OUT Dockerë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì¼ê²ƒì…ë‹ˆë‹¤â€”</p>
  </li>
  <li>í´ëŸ¬ìŠ¤í„°ë¥¼ ì‚­ì œí•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ì‚­ì œ</span>
<span class="nv">$ </span>kind delete cluster <span class="nt">--name</span> myk8s
<span class="c"># =&gt; Deleting cluster "myk8s" ...</span>
<span class="c">#    Deleted nodes: ["myk8s-worker" "myk8s-control-plane"]</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span>
</code></pre></div></div>

<h3 id="multi-node-í´ëŸ¬ìŠ¤í„°-with-kube-ops-view--mapping-ports">Multi-Node í´ëŸ¬ìŠ¤í„° with kube-ops-view &amp; mapping ports</h3>

<p>ì´ë²ˆì—ëŠ” KINDë¡œ Multi-Node í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ê³ , kube-ops-viewë¥¼ ì„¤ì¹˜í•˜ì—¬ í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ ì‹œê°í™”í•˜ê³ , í¬íŠ¸ ë§¤í•‘ì„ í†µí•´ í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>í´ëŸ¬ìŠ¤í„° êµ¬ì„± ë° ë…¸ë“œ ì •ë³´ í™•ì¸</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 'ì»¨íŠ¸ë¡¤í”Œë ˆì¸, ì›Œì»¤ ë…¸ë“œ 1ëŒ€' í´ëŸ¬ìŠ¤í„° ë°°í¬ : íŒŒë“œì— ì ‘ì†í•˜ê¸° ìœ„í•œ í¬íŠ¸ ë§µí•‘ ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh">&gt; kind-2node.yaml
# two node (one workers) cluster config
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
  extraPortMappings:
  - containerPort: 31000
    hostPort: 31000
    listenAddress: "0.0.0.0" # Optional, defaults to "0.0.0.0"
    protocol: tcp # Optional, defaults to tcp
  - containerPort: 31001
    hostPort: 31001
</span><span class="no">EOT

</span><span class="nv">$ CLUSTERNAME</span><span class="o">=</span>myk8s
<span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-2node.yaml <span class="nt">--name</span> <span class="nv">$CLUSTERNAME</span>
<span class="c"># =&gt; Creating cluster "myk8s" ...</span>
<span class="c">#     âœ“ Ensuring node image (kindest/node:v1.31.0) ğŸ–¼</span>
<span class="c">#     âœ“ Preparing nodes ğŸ“¦ ğŸ“¦</span>
<span class="c">#     âœ“ Writing configuration ğŸ“œ</span>
<span class="c">#     âœ“ Starting control-plane ğŸ•¹ï¸</span>
<span class="c">#     âœ“ Installing CNI ğŸ”Œ</span>
<span class="c">#     âœ“ Installing StorageClass ğŸ’¾</span>
<span class="c">#     âœ“ Joining worker nodes ğŸšœ</span>
<span class="c">#    Set kubectl context to "kind-myk8s"</span>
<span class="c">#    You can now use your cluster with:</span>
<span class="c">#    </span>
<span class="c">#    kubectl cluster-info --context kind-myk8s</span>
<span class="c">#    </span>
<span class="c">#    Have a nice day! ğŸ‘‹</span>

<span class="c"># ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>kind get clusters
<span class="c"># =&gt; myk8s</span>
<span class="nv">$ </span>kind get nodes <span class="nt">--name</span> <span class="nv">$CLUSTERNAME</span>
<span class="c"># =&gt; myk8s-control-plane</span>
<span class="c">#    myk8s-worker</span>

<span class="c"># ë…¸ë“œ í™•ì¸</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME                  STATUS   ROLES           AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION     CONTAINER-RUNTIME</span>
<span class="c">#    myk8s-control-plane   Ready    control-plane   2m12s   v1.31.0   172.20.0.2    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>
<span class="c">#    myk8s-worker          Ready    &amp;lt;none&amp;gt;          119s    v1.31.0   172.20.0.3    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>

<span class="c"># ë…¸ë“œì— Taints ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe node <span class="nv">$CLUSTERNAME</span><span class="nt">-control-plane</span> | <span class="nb">grep </span>Taints
<span class="c"># =&gt; Taints:             node-role.kubernetes.io/control-plane:NoSchedule</span>

<span class="nv">$ </span>kubectl describe node <span class="nv">$CLUSTERNAME</span><span class="nt">-worker</span> | <span class="nb">grep </span>Taints
<span class="c"># =&gt; Taints:             &amp;lt;none&amp;gt;</span>

<span class="c"># control-plane ë…¸ë“œì—ëŠ” taintsê°€ ê±¸ë ¤ìˆì–´ì„œ ìŠ¤ì¼€ì¥´ë§ì´ ë˜ì§€ ì•Šê³  </span>
<span class="c"># worker ë…¸ë“œì—ëŠ” taintsê°€ ì—†ì–´ì„œ ìŠ¤ì¼€ì¥´ë§ì´ ë  ê²ƒì„ ì˜ˆìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>

<span class="c"># ì»¨í…Œì´ë„ˆ í™•ì¸ : ì»¨í…Œì´ë„ˆ ê°¯ìˆ˜, ì»¨í…Œì´ë„ˆ ì´ë¦„ í™•ì¸</span>
<span class="c"># kind yaml ì— í¬íŠ¸ ë§µí•‘ ì •ë³´ ì²˜ëŸ¼, ìì‹ ì˜ PC í˜¸ìŠ¤íŠ¸ì— 31000 í¬íŠ¸ ì ‘ì† ì‹œ, ì›Œì»¤ë…¸ë“œ(ì‹¤ì œë¡œëŠ” ì»¨í…Œì´ë„ˆ)ì— TCP 31000 í¬íŠ¸ë¡œ ì—°ê²°</span>
<span class="c"># ì¦‰, ì›Œì»¤ë…¸ë“œì— NodePort TCP 31000 ì„¤ì • ì‹œ ìì‹ ì˜ PC í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì† ê°€ëŠ¥!</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                  NAMES</span>
<span class="c">#    7724a7ff92bb   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   6 minutes ago   Up 6 minutes   127.0.0.1:58498-&amp;gt;6443/tcp              myk8s-control-plane</span>
<span class="c">#    5b7fa2f98703   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   6 minutes ago   Up 6 minutes   0.0.0.0:31000-31001-&amp;gt;31000-31001/tcp   myk8s-worker</span>
<span class="nv">$ </span>docker port <span class="nv">$CLUSTERNAME</span><span class="nt">-worker</span>
<span class="c"># =&gt; 31000/tcp -&amp;gt; 0.0.0.0:31000</span>
<span class="c">#    31001/tcp -&amp;gt; 0.0.0.0:31001</span>

<span class="c"># ê° ë…¸ë“œë“¤ì˜ ì •ë³´ í™•ì¸ì„ dockerë¥¼ í†µí•´ì„œ í™•ì¸í•´ ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$CLUSTERNAME</span><span class="nt">-control-plane</span> ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$CLUSTERNAME</span><span class="nt">-worker</span>  ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
</code></pre></div></div>

<ul>
  <li>
    <p>ì´ë²ˆì— KINDë¥¼ í†µí•´ ë§Œë“  í´ëŸ¬ìŠ¤í„°ëŠ” í˜¸ìŠ¤íŠ¸ì—ì„œ 31000, 31001 í¬íŠ¸ë¡œ ì ‘ì†ì‹œ ì›Œì»¤ë…¸ë“œ(ì»¨í…Œì´ë„ˆ)ì˜ 31000, 31001 í¬íŠ¸ë¡œ 
ì—°ê²°ë˜ë„ë¡ ì„¤ì •ë˜ëŠ”ë°, ê·¸ ì´ìœ ëŠ” KIND í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í• ë•Œ ì•„ë˜ì™€ ê°™ì´ í¬íŠ¸ë¥¼ ì—´ê²ƒì„ ì§€ì •í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>

    <div class="language-yml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nn">...</span>
<span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
  <span class="na">extraPortMappings</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">31000</span>
    <span class="na">hostPort</span><span class="pi">:</span> <span class="m">31000</span>
    <span class="na">listenAddress</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0"</span> <span class="c1"># Optional, defaults to "0.0.0.0"</span>
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">tcp</span> <span class="c1"># Optional, defaults to tcp</span>
  <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">31001</span>
    <span class="na">hostPort</span><span class="pi">:</span> <span class="m">31001</span>
<span class="nn">...</span>
</code></pre></div>    </div>
    <p>ì¶”ê°€ì ì¸ í¬íŠ¸ ë§¤í•‘ì´ í•„ìš”í•œ ê²½ìš° ìœ„ì™€ ê°™ì´ <code class="language-plaintext highlighter-rouge">extraPortMappings</code>ì— ì¶”ê°€í•˜ì—¬ í¬íŠ¸ë¥¼ ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>Kube-ops-view ì„¤ì¹˜ : Node port 31000</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kube-ops-view</span>
<span class="c"># helm show values geek-cookbook/kube-ops-view</span>
<span class="nv">$ </span>helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
<span class="nv">$ </span>helm <span class="nb">install </span>kube-ops-view geek-cookbook/kube-ops-view <span class="nt">--version</span> 1.2.2 <span class="nt">--set</span> service.main.type<span class="o">=</span>NodePort,service.main.ports.http.nodePort<span class="o">=</span>31000 <span class="nt">--set</span> env.TZ<span class="o">=</span><span class="s2">"Asia/Seoul"</span> <span class="nt">--namespace</span> kube-system

<span class="c"># ì„¤ì¹˜ í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,pod,svc,ep <span class="nt">-n</span> kube-system <span class="nt">-l</span> app.kubernetes.io/instance<span class="o">=</span>kube-ops-view
<span class="c"># =&gt; NAME                            READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    deployment.apps/kube-ops-view   0/1     1            0           18s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                 READY   STATUS              RESTARTS   AGE</span>
<span class="c">#    pod/kube-ops-view-657dbc6cd8-tmkl5   0/1     ContainerCreating   0          18s</span>
<span class="c">#    </span>
<span class="c">#    NAME                    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span>
<span class="c">#    service/kube-ops-view   NodePort   10.96.212.51   &amp;lt;none&amp;gt;        8080:31000/TCP   18s</span>
<span class="c">#    </span>
<span class="c">#    NAME                      ENDPOINTS   AGE</span>
<span class="c">#    endpoints/kube-ops-view   &amp;lt;none&amp;gt;      18s</span>

<span class="c"># kube-ops-view ì ‘ì† URL í™•ì¸ (1.5 , 2 ë°°ìœ¨)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:31000/#scale=1.5"</span>
<span class="c"># =&gt; KUBE-OPS-VIEW URL = http://localhost:31000/#scale=1.5</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:31000/#scale=2"</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_5.png" alt="img.png" loading="lazy" width="997" height="475"></p>

<p>í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì‹œ ë…¸ë“œì˜ 31000í¬íŠ¸ë¥¼ í˜¸ìŠ¤íŠ¸ì˜ 31000ì— ë§¤í•‘ì‹œì¼œì„œ í˜¸ìŠ¤íŠ¸ì—ì„œ ìœ„ì™€ ê°™ì´ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>nginx ì„¤ì¹˜ : NodePort 31001</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë””í”Œë¡œì´ë¨¼íŠ¸ì™€ ì„œë¹„ìŠ¤ ë°°í¬</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl create -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deploy-websrv
spec:
  replicas: 2
  selector:
    matchLabels:
      app: deploy-websrv
  template:
    metadata:
      labels:
        app: deploy-websrv
    spec:
      terminationGracePeriodSeconds: 0
      containers:
      - name: deploy-websrv
        image: nginx:alpine
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: deploy-websrv
spec:
  ports:
    - name: svc-webport
      port: 80
      targetPort: 80
      nodePort: 31001
  selector:
    app: deploy-websrv
  type: NodePort
</span><span class="no">EOF

</span><span class="c"># í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS                                  NAMES</span>
<span class="c">#    5b7fa2f98703   kindest/node:v1.31.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   15 minutes ago   Up 15 minutes   0.0.0.0:31000-31001-&amp;gt;31000-31001/tcp   myk8s-worker</span>
<span class="c">#    ...</span>

<span class="nv">$ </span>kubectl get deploy,svc,ep deploy-websrv
<span class="c"># =&gt; ...</span>
<span class="c">#    NAME                    TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span>
<span class="c">#    service/deploy-websrv   NodePort   10.96.115.233   &amp;lt;none&amp;gt;        80:31001/TCP   47s</span>
<span class="c">#    ...</span>

<span class="c"># ìì‹ ì˜ PCì— í˜¸ìŠ¤íŠ¸ í¬íŠ¸ 31001 ì ‘ì† ì‹œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ì— ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>open http://localhost:31001
<span class="nv">$ </span>curl <span class="nt">-s</span> localhost:31001 | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"&lt;title&gt;.*&lt;/title&gt;"</span>
<span class="c"># =&gt; &lt;title&gt;Welcome to nginx!&lt;/title&gt;</span>

<span class="c"># ë””í”Œë¡œì´ë¨¼íŠ¸ì™€ ì„œë¹„ìŠ¤ ì‚­ì œ</span>
<span class="nv">$ </span>kubectl delete deploy,svc deploy-websrv
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_6.png" alt="img.png" class="image-center" loading="lazy" width="997" height="475">
<em class="image-caption">31001 í¬íŠ¸ë¡œ ì ‘ì†ì‹œ nginx í˜ì´ì§€ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</em></p>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_7.png" alt="img_1.png" loading="lazy" width="997" height="475">
<em class="image-caption">kube-ops-viewì—ì„œ deployëœ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</em></p>

<hr>

<h2 id="íŒŒë“œ--pause-ì»¨í…Œì´ë„ˆ">íŒŒë“œ &amp; PAUSE ì»¨í…Œì´ë„ˆ</h2>

<p><strong>íŒŒë“œ(pod)</strong>ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ <strong>ë°°í¬í•˜ëŠ” ìµœì†Œ ë‹¨ìœ„</strong>ì´ë©°, íŒŒë“œ ë‚´ë¶€ì—ëŠ” <strong>ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆê°€ í¬í•¨ë  ìˆ˜</strong> ìˆìŠµë‹ˆë‹¤. 
íŒŒë“œ ë‚´ë¶€ì—ëŠ” PAUSE ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬í•˜ë©°, <strong>PAUSE ì»¨í…Œì´ë„ˆ</strong>ëŠ” <strong>Network/IPC/UTS ë„¤ì„ìŠ¤í˜ì´ìŠ¤</strong>ë¥¼ <strong>ìƒì„±</strong>í•˜ê³  <strong>ìœ ì§€</strong>/<strong>ê³µìœ </strong>í•˜ëŠ” ì—­í• ìš¸ í•©ë‹ˆë‹¤. 
ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ ë„¤íŠ¸ì›Œí¬ ë“±ì— ëŒ€í•´ì„œëŠ” 1ì£¼ì°¨ì—ì„œ í•™ìŠµí•œ ë‚´ìš©ì´ ë§ì´ ë„ì›€ë˜ì—ˆìŠµë‹ˆë‹¤. <a href="https://sweetlittlebird.github.io/posts/2024-08-27-KANS-Study-Week1/">1ì£¼ì°¨ ë§í¬</a></p>

<h3 id="k8s-cri-container-runtime-interface">K8S CRI (Container Runtime Interface)</h3>

<p>ë¨¼ì € íŒŒë“œì™€ PAUSE ì»¨í…Œì´ë„ˆì— ëŒ€í•´ ì•Œì•„ë³´ê¸°ì „ì— ì•ì„  ì‹¤ìŠµì—ì„œ ë³´ì•˜ë˜ CRI(Container Runtime Interface)ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ <strong>CRI(Container Runtime Interface)</strong>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p>CRIì˜ íƒ„ìƒ ë°°ê²½ì€ ë¨¼ì € Dockerì—ì„œ ë¶€í„° ì°¾ì•„ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
Dockerê°€ ëŒ€ì„±ê³µí•˜ê³  ì»¨í…Œì´ë„ˆ ê¸°ìˆ ì´ í™•ì‚°ë˜ë©´ì„œ, ì¿ ë²„ë„¤í‹°ìŠ¤ë„ Dockerë¥¼ ê¸°ë³¸ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ Docker Incë¼ëŠ” íšŒì‚¬ì— ì¢…ì†ë˜ëŠ”ê²ƒì„ ìš°ë ¤í•˜ì—¬, í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ë‹¤ì–‘í•œ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì„ ì§€ì›í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ CRIê°€ íƒ„ìƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. CRIë¼ëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ë§Œ ì§€í‚¤ë©´ ì–´ë–¤ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì´ë¼ë„ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
ì´ ê³¼ì •ì—ì„œ ì•„ì‰¬ìš´ê±´ DockerëŠ” CRIë¥¼ ì§€ì›í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, Dockerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” Docker shimì´ë¼ëŠ” í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•´ì•¼ í–ˆì—ˆìŠµë‹ˆë‹¤.</p>

<h3 id="íŒŒë“œ-pod">íŒŒë“œ (Pod)</h3>

<p>ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ë³¸ ë‹¨ìœ„ë¥¼ íŒŒë“œ(Pod)ë¼ê³  ë¶€ë¥´ë©°, íŒŒë“œëŠ” 1ê°œ ì´ìƒì˜ ì»¨í…Œì´ë„ˆë¡œ êµ¬ì„±ëœ ì»¨í…Œì´ë„ˆì˜ ì§‘í•©ì…ë‹ˆë‹¤.</p>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_8.png" alt="img.png" loading="lazy" width="2000" height="995"></p>

<ul>
  <li>PodëŠ” 1ê°œ ì´ìƒì˜ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>Podë‚´ì— ì‹¤í–‰ë˜ëŠ” ì»¨í…Œì´ë„ˆë“¤ì€ ë™ì¼í•œ ë…¸ë“œì— í• ë‹¹ë˜ë©° ë™ì¼í•œ ìƒëª… ì£¼ê¸°(Life-cycle)ë¥¼ ê°–ìŠµë‹ˆë‹¤.</li>
  <li>PodëŠ” ë…¸ë“œ IP ì™€ ë³„ê°œë¡œ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ IPë¥¼ í• ë‹¹ ë°›ìœ¼ë©°, ë‹¤ë¥¸ ë…¸ë“œì— ìœ„ì¹˜í•œ Pod ë„ <strong>CNIë¥¼ í†µí•´</strong> NAT ì—†ì´ Pod IPë¡œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
  <li>Podë‚´ì— ìˆëŠ” ì»¨í…Œì´ë„ˆë“¤ì€ ì„œë¡œ IPë¥¼ ê³µìœ í•©ë‹ˆë‹¤. ê°™ì€ Podë‚´ì˜ ì»¨í…Œì´ë„ˆë¼ë¦¬ëŠ” localhost í†µí•´ ì„œë¡œ ì ‘ê·¼ê°€ëŠ¥ í•©ë‹ˆë‹¤.
    <ul>
      <li>
<strong>pause</strong> ì»¨í…Œì´ë„ˆê°€ network ns ë¥¼ ë§Œë“¤ì–´ ì£¼ê³ , ë‚´ë¶€ì˜ ì»¨í…Œì´ë„ˆë“¤ì€ í•´ë‹¹ net ns ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— IPë¥¼ ê³µìœ í•˜ê²Œ ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Pod ì•ˆì˜ ì»¨í…Œì´ë„ˆë“¤ì€ ë™ì¼í•œ ë³¼ë¥¨ê³¼ ì—°ê²°ì´ ê°€ëŠ¥í•˜ì—¬ íŒŒì¼ ì‹œìŠ¤í…œì„ ê¸°ë°˜ìœ¼ë¡œ ì„œë¡œ íŒŒì¼ì„ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>PodëŠ” ë¦¬ì†ŒìŠ¤ ì œì•½ì´ ìˆëŠ” ê²©ë¦¬ëœ í™˜ê²½ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ ê·¸ë£¹ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.</li>
  <li>í¬ë“œë¥¼ ì‹œì‘í•˜ê¸° ì „ì— kubeletì€ RuntimeService.RunPodSandboxë¥¼ í˜¸ì¶œí•˜ì—¬ í™˜ê²½ì„ ë§Œë“­ë‹ˆë‹¤.</li>
  <li>Kubeletì€ RPCë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆì˜ ìˆ˜ëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ê³ , ì»¨í…Œì´ë„ˆ ìˆ˜ëª… ì£¼ê¸° í›„í¬ì™€ í™œì„±/ì¤€ë¹„ í™•ì¸ì„ ì‹¤í–‰í•˜ë©°, Podì˜ ì¬ì‹œì‘ ì •ì±…ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤</li>
</ul>

<h3 id="pause-ì»¨í…Œì´ë„ˆ">PAUSE ì»¨í…Œì´ë„ˆ</h3>

<ul>
  <li>ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ <strong>pause</strong> ì»¨í…Œì´ë„ˆëŠ” í¬ë“œì˜ ëª¨ë“  ì»¨í…Œì´ë„ˆì— ëŒ€í•œ â€œ<strong>ë¶€ëª¨ ì»¨í…Œì´ë„ˆ</strong>â€ ì—­í• ì„ í•©ë‹ˆë‹¤. - <a href="https://sklar.rocks/what-is-a-pod-sandbox/">Link</a>
</li>
  <li>
<strong>pause</strong> ì»¨í…Œì´ë„ˆì—ëŠ” ë‘ ê°€ì§€ í•µì‹¬ ì±…ì„ì´ ìˆìŠµë‹ˆë‹¤.
    <ol>
      <li>íŒŒë“œì—ì„œ Linux <strong>ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê³µìœ ì˜ ê¸°ë°˜</strong> ì—­í• ì„ í•©ë‹ˆë‹¤. (Network, IPC, UTS ë„¤ì„ìŠ¤í˜ì´ìŠ¤)</li>
      <li>PID(í”„ë¡œì„¸ìŠ¤ ID) ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê³µìœ ê°€ í™œì„±í™”ë˜ë©´ ê° í¬ë“œì— ëŒ€í•œ <strong>PID 1 ì—­í• </strong>ì„ í•˜ë©° <strong>ì¢€ë¹„ í”„ë¡œì„¸ìŠ¤ë¥¼ ê±°ë‘¡</strong>ë‹ˆë‹¤.</li>
    </ol>
  </li>
  <li>pauseì˜ í•µì‹¬ ì†ŒìŠ¤ì½”ë“œëŠ” <a href="https://github.com/kubernetes/kubernetes/blob/master/build/pause/linux/pause.c">ì—¬ê¸°</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ë§¤ìš° ì§§ì§€ë§Œ ì¤‘ìš”í•œ ì½”ë“œì…ë‹ˆë‹¤. ìƒì„¸í•˜ê²Œ ì½”ë“œë¶„ì„í•œ ë¶„ì´ ìˆì–´ì„œ ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ì‹  ë¶„ì€ ë‹¤ìŒ ë§í¬ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
<a href="https://mateon.tistory.com/127">í•œê¸€ ë§í¬</a>
<a href="https://www.ianlewis.org/en/almighty-pause-container">ì˜ë¬¸ ë§í¬</a>
</li>
</ul>

<h4 id="pause-ì»¨í…Œì´ë„ˆ-ì‹¤ìŠµ">Pause ì»¨í…Œì´ë„ˆ ì‹¤ìŠµ</h4>

<ul>
  <li>Pause ì»¨í…Œì´ë„ˆì˜ ë™ì‘ì— ëŒ€í•´ ì‹¤ìŠµí•˜ê¸° ìœ„í•œ í™˜ê²½ì„ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 'ì»¨íŠ¸ë¡¤í”Œë ˆì¸, ì›Œì»¤ ë…¸ë“œ 1ëŒ€' í´ëŸ¬ìŠ¤í„° ë°°í¬ : íŒŒë“œì— ì ‘ì†í•˜ê¸° ìœ„í•œ í¬íŠ¸ ë§µí•‘ ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh">&gt; kind-2node.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
</span><span class="no">EOT
</span><span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-2node.yaml <span class="nt">--name</span> myk8s

<span class="c"># íˆ´ ì„¤ì¹˜</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump htop git nano -y'</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker        sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump htop -y'</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-o</span> wide
<span class="nv">$ </span>docker ps
<span class="nv">$ </span>docker port myk8s-worker
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr

<span class="c"># kube-ops-view</span>
<span class="nv">$ </span>helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
<span class="nv">$ </span>helm <span class="nb">install </span>kube-ops-view geek-cookbook/kube-ops-view <span class="nt">--version</span> 1.2.2 <span class="nt">--set</span> service.main.type<span class="o">=</span>NodePort,service.main.ports.http.nodePort<span class="o">=</span>30000 <span class="nt">--set</span> env.TZ<span class="o">=</span><span class="s2">"Asia/Seoul"</span> <span class="nt">--namespace</span> kube-system

<span class="c"># ì„¤ì¹˜ í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,pod,svc,ep <span class="nt">-n</span> kube-system <span class="nt">-l</span> app.kubernetes.io/instance<span class="o">=</span>kube-ops-view

<span class="c"># kube-ops-view ì ‘ì† URL í™•ì¸ (1.5 , 2 ë°°ìœ¨)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:30000/#scale=1.5"</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"KUBE-OPS-VIEW URL = http://localhost:30000/#scale=2"</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_9.png" alt="img.png" loading="lazy" width="1362" height="798"></p>

<ul>
  <li>worker ë…¸ë“œì— ì§„ì… í›„ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê²©ë¦¬ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [í„°ë¯¸ë„1] myk8s-worker bash ì§„ì… í›„ ì‹¤í–‰ ë° í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker bash
<span class="nt">----------------------------------</span>
<span class="nv">$ </span>systemctl list-unit-files | <span class="nb">grep</span> <span class="s1">'enabled         enabled'</span>
<span class="c"># =&gt; containerd.service                                                                    enabled         enabled</span>
<span class="c">#    kubelet.service                                                                       enabled         enabled</span>
<span class="c">#    ...</span>

<span class="c"># í™•ì¸ : kubeletì— --container-runtime-endpoint=unix:///run/containerd/containerd.sock</span>
<span class="nv">$ </span>pstree <span class="nt">-aln</span>
<span class="c"># =&gt; systemd</span>
<span class="c">#      |-systemd-journal</span>
<span class="c">#      |-containerd</span>
<span class="c">#      |   `-15*[{containerd}]</span>
<span class="c">#      |-kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --container-runtime-endpoint=unix:///run/containerd/containerd.sock --node-ip=172.20.0.3 --node-labels= --pod-infra-container-image=registry.k8s.io/pause:3.10 --provider-id=kind://docker/myk8s/myk8s-worker --runtime-cgroups=/system.slice/containerd.service</span>
<span class="c">#      |   `-13*[{kubelet}]</span>
<span class="c">#      |-containerd-shim -namespace k8s.io -id 3368a087d8af3e241201257993e178d6a7d8ea23d3148cdf2ec5392f9db49832 -address /run/containerd/containerd.sock</span>
<span class="c">#      |   |-11*[{containerd-shim}]</span>
<span class="c">#      |   |-pause</span>
<span class="c">#      |   `-kindnetd</span>
<span class="c">#      |       `-11*[{kindnetd}]</span>
<span class="c">#      |-containerd-shim -namespace k8s.io -id e983e9fcff0162dec6128e014ae9092454fe0fd748ba237320aec17fa85fb17b -address /run/containerd/containerd.sock</span>
<span class="c">#      |   |-11*[{containerd-shim}]</span>
<span class="c">#      |   |-pause</span>
<span class="c">#      |   `-kube-proxy --config=/var/lib/kube-proxy/config.conf --hostname-override=myk8s-worker</span>
<span class="c">#      |       `-8*[{kube-proxy}]</span>
<span class="c">#      `-containerd-shim -namespace k8s.io -id 9cdabafac520e373ff0efdbbbe8b87bdfd7a0d02bd897863b609eefc4ae21b36 -address /run/containerd/containerd.sock</span>
<span class="c">#          |-12*[{containerd-shim}]</span>
<span class="c">#          |-pause</span>
<span class="c">#          `-python3 /usr/local/bin/python3 -m kube_ops_view</span>
<span class="c">#              `-2*[{python3}]</span>
          
<span class="c"># í™•ì¸ : íŒŒë“œë‚´ì— pause ì»¨í…Œì´ë„ˆì™€ kube_ops_view ì»¨í…Œì´ë„ˆ, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì •ë³´</span>
<span class="nv">$ </span>pstree <span class="nt">-aclnpsS</span>
<span class="c"># =&gt; ...</span>
<span class="c">#      `-containerd-shim,1089 -namespace k8s.io -id 9cdabafac520e373ff0efdbbbe8b87bdfd7a0d02bd897863b609eefc4ae21b36 -address /run/containerd/contai</span>
<span class="c">#    nerd.sock</span>
<span class="c">#          |-{containerd-shim},1090</span>
<span class="c">#          ...</span>
<span class="c">#          |-pause,1110,ipc,mnt,net,pid,uts</span>
<span class="c">#          |-python3,1173,cgroup,ipc,mnt,net,pid,uts /usr/local/bin/python3 -m kube_ops_view</span>
<span class="c">#          ...</span>
<span class="c">#    ...</span>
      
<span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸ : lsns - List system namespaces</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="nv">$$</span>
<span class="c"># =&gt;         NS TYPE   NPROCS PID USER COMMAND</span>
<span class="c">#    4026531834 time       15   1 root /sbin/init</span>
<span class="c">#    4026531837 user       15   1 root /sbin/init</span>
<span class="c">#    4026532329 mnt         9   1 root /sbin/init</span>
<span class="c">#    4026532330 uts        13   1 root /sbin/init</span>
<span class="c">#    4026532338 ipc         9   1 root /sbin/init</span>
<span class="c">#    4026532339 pid         9   1 root /sbin/init</span>
<span class="c">#    4026532341 net        13   1 root /sbin/init</span>
<span class="c">#    4026532417 cgroup     13   1 root /sbin/init</span>

<span class="c"># íŒŒë“œì˜ pause ì»¨í…Œì´ë„ˆëŠ” ë…¸ë“œì˜ NSì™€ ë‹¤ë¥¸ 5ê°œì˜ NSë¥¼ ê°€ì§ : mnt/pid ëŠ” pasue ìì‹ ë§Œ ì‚¬ìš©, net/uts/ipcëŠ” app ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•´ì„œ ë¨¼ì € ìƒì„±í•´ë‘ </span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1797  <span class="c"># kube_ops_view íŒŒë“œì˜ pause ì»¨í…Œì´ë„ˆ</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    4026531834 time       15     1 root  /sbin/init</span>
<span class="c">#    4026531837 user       15     1 root  /sbin/init</span>
<span class="c">#    4026532417 cgroup     13     1 root  /sbin/init </span>
<span class="c">#    4026532805 net         2  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„  </span>
<span class="c">#    4026532883 mnt         1  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„</span>
<span class="c">#    4026532884 uts         2  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„</span>
<span class="c">#    4026532885 ipc         2  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„</span>
<span class="c">#    4026532886 pid         1  1110 65535 /pause      # Node NSì™€ ë‹¤ë¦„</span>

<span class="c"># app ì»¨í…Œì´ë„ˆ(kube_ops_view)ëŠ” í˜¸ìŠ¤íŠ¸NSì™€ ë‹¤ë¥¸ 6ê°œì˜ NSë¥¼ ê°€ì§ : mnt/pid/cgroup ëŠ” ìì‹ ë§Œ ì‚¬ìš©, net/uts/ipcëŠ” pause ì»¨í…Œì´ë„ˆê°€ ìƒì„±í•œ ê²ƒì„ ê³µìœ  ì‚¬ìš©í•¨</span>
<span class="nv">$ </span>pgrep <span class="nt">-f</span> kube_ops_view
<span class="c"># =&gt; 1173</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="si">$(</span>pgrep <span class="nt">-f</span> kube_ops_view<span class="si">)</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    4026531834 time       15     1 root  /sbin/init</span>
<span class="c">#    4026531837 user       15     1 root  /sbin/init</span>
<span class="c">#    4026532805 net         2  1110 65535 /pause      # pause ì»¨í…Œì´ë„ˆì™€ ê³µìœ </span>
<span class="c">#    4026532884 uts         2  1110 65535 /pause      # pause ì»¨í…Œì´ë„ˆì™€ ê³µìœ </span>
<span class="c">#    4026532885 ipc         2  1110 65535 /pause      # pause ì»¨í…Œì´ë„ˆì™€ ê³µìœ </span>
<span class="c">#    4026532887 mnt         1  1173 1000  /usr/bin/qemu-x86_64 /usr/local/bin/python3 -m kube_ops_view  # ìì‹ ë§Œ ì‚¬ìš©</span>
<span class="c">#    4026532888 pid         1  1173 1000  /usr/bin/qemu-x86_64 /usr/local/bin/python3 -m kube_ops_view  # ìì‹ ë§Œ ì‚¬ìš©</span>
<span class="c">#    4026532889 cgroup      1  1173 1000  /usr/bin/qemu-x86_64 /usr/local/bin/python3 -m kube_ops_view  # ìì‹ ë§Œ ì‚¬ìš©</span>
</code></pre></div></div>

<ul>
  <li>ìœ„ì™€ ê°™ì´ íŒŒë“œ ë‚´ë¶€ì˜ pause ì»¨í…Œì´ë„ˆì™€ kube_ops_view ì»¨í…Œì´ë„ˆëŠ” net, uts, ipc ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ê³µìœ í•˜ê³ , mnt, pid, cgroup ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ê°ê°ì˜ ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ë ‡ê²Œ pause ì»¨í…Œì´ë„ˆê°€ íŒŒë“œ ë‚´ë¶€ì˜ ì»¨í…Œì´ë„ˆë“¤ì´ ê³µìœ í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ìœ ì§€í•˜ëŠ” ì—­í• ì„ í•˜ëŠ”ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</li>
  <li>ë§ˆì§€ë§‰ìœ¼ë¡œ DINDë¥¼ ìœ„í•œ containerd.sock ê³¼ cgroup2fs, sys, proc ë“±ì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># containerd.sock ì •ë³´ í™•ì¸ (docker.sockê³¼ ë¹„ìŠ·í•œ ì—­í• )</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /run/containerd/containerd.sock
<span class="c"># =&gt; srw-rw---- 1 root root 0 Sep  7 15:20 /run/containerd/containerd.sock</span>

<span class="c"># íŠ¹ì • ì†Œì¼“ íŒŒì¼ì„ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ í™•ì¸</span>
<span class="nv">$ </span>lsof /run/containerd/containerd.sock
<span class="c"># =&gt; COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF   NODE NAME</span>
<span class="c">#    container 106 root    9u  unix 0x0000000000000000      0t0 726698 /run/containerd/containerd.sock type=STREAM (LISTEN)</span>
<span class="c">#    container 106 root   11u  unix 0x0000000000000000      0t0 734691 /run/containerd/containerd.sock type=STREAM (CONNECTED)</span>
<span class="c">#    container 106 root   12u  unix 0x0000000000000000      0t0 738482 /run/containerd/containerd.sock type=STREAM (CONNECTED)</span>
<span class="c">#    container 106 root   14u  unix 0x0000000000000000      0t0 736712 /run/containerd/containerd.sock type=STREAM (CONNECTED)</span>

<span class="c"># /sys ë””ë ‰í„°ë¦¬ í™•ì¸</span>
<span class="nv">$ </span>findmnt <span class="nt">-A</span>
<span class="c"># =&gt; TARGET                                                  SOURCE                 FSTYPE    OPTIONS</span>
<span class="c">#    /                                                       overlay                overlay   rw,relatime,lowerdir=/var/lib/docker/overlay2/l/5UMBJJ</span>
<span class="c">#    ...</span>
<span class="c">#    |-/sys                                                  sysfs                  sysfs     ro,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | |-/sys/kernel/tracing                                 tracefs                tracefs   rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | |-/sys/kernel/debug                                   debugfs                debugfs   rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | |-/sys/fs/fuse/connections                            fusectl                fusectl   rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | |-/sys/kernel/config                                  configfs               configfs  rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    | `-/sys/fs/cgroup                                      cgroup                 cgroup2   rw,nosuid,nodev,noexec,relatime</span>
<span class="c">#    ...</span>

<span class="c"># cgroup ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>findmnt <span class="nt">-t</span> cgroup2
<span class="c"># =&gt; TARGET         SOURCE FSTYPE  OPTIONS</span>
<span class="c">#    /sys/fs/cgroup cgroup cgroup2 rw,nosuid,nodev,noexec,relatime</span>
<span class="nv">$ </span><span class="nb">grep </span>cgroup /proc/filesystems
<span class="c"># =&gt; nodev	cgroup</span>
<span class="c">#    nodev	cgroup2</span>
<span class="nv">$ </span><span class="nb">stat</span> <span class="nt">-fc</span> %T /sys/fs/cgroup/
<span class="c"># =&gt; cgroup2fs</span>

<span class="nv">$ </span><span class="nb">exit</span>
<span class="nt">----------------------------------</span>
</code></pre></div></div>

<ul>
  <li>ì‹ ê·œíŒŒë“œë¥¼ ë°°í¬í•˜ê³  í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [í„°ë¯¸ë„2] kubectl ëª…ë ¹ ì‹¤í–‰ ë° í™•ì¸</span>

<span class="c"># Pod ìƒì„± : YAML íŒŒì¼ì— ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•  í¬íŠ¸(TCP 80)ì„ ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: myweb
spec:
  containers:
  - image: nginx:alpine
    name: myweb-container
    ports:
    - containerPort: 80
      protocol: TCP
  terminationGracePeriodSeconds: 0
</span><span class="no">EOF

</span><span class="c"># Pod ì •ë³´ í™•ì¸ : pause ì»¨í…Œì´ë„ˆ ì •ë³´ê°€ ë³´ì´ëŠ”ì§€ í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME    READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES</span>
<span class="c">#    myweb   1/1     Running   0          15s   10.244.1.3   myk8s-worker   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="nv">$ </span>kubectl describe pod myweb | <span class="nb">grep</span> <span class="nt">-i</span> pause
<span class="nv">$ </span>kubectl get pod myweb <span class="nt">-o</span> json | <span class="nb">grep</span> <span class="nt">-i</span> pause

<span class="nt">---</span>

<span class="c"># [í„°ë¯¸ë„1] myk8s-worker bash ì§„ì… í›„ ì‹¤í–‰ ë° í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker bash
<span class="nt">----------------------------------</span>
<span class="nv">$ </span>crictl ps
<span class="nv">$ </span>pstree <span class="nt">-aln</span>
<span class="nv">$ </span>pstree <span class="nt">-aclnpsS</span> <span class="c"># íŒŒë“œë‚´ì— pause ì»¨í…Œì´ë„ˆì™€ app ì»¨í…Œì´ë„ˆ, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì •ë³´</span>
<span class="c"># =&gt;   `-containerd-shim,1673 -namespace k8s.io -id 482ba93ecf76d46938d60e58f363e63e681d8a779439f270ff9c8417ad25a641 -address /run/containerd/containerd.sock</span>
<span class="c">#          |-{containerd-shim},1674</span>
<span class="c">#          ...</span>
<span class="c">#          |-pause,1693,ipc,mnt,net,pid,uts</span>
<span class="c">#          |-nginx,1754,cgroup,ipc,mnt,net,pid,uts</span>

<span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸ : lsns - List system namespaces</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="nv">$$</span>
<span class="c"># =&gt;         NS TYPE   NPROCS PID USER COMMAND</span>
<span class="c">#    4026531834 time       25   1 root /sbin/init</span>
<span class="c">#    4026531837 user       25   1 root /sbin/init</span>
<span class="c">#    4026532329 mnt        10   1 root /sbin/init</span>
<span class="c">#    4026532330 uts        14   1 root /sbin/init</span>
<span class="c">#    4026532338 ipc        10   1 root /sbin/init</span>
<span class="c">#    4026532339 pid        10   1 root /sbin/init</span>
<span class="c">#    4026532341 net        14   1 root /sbin/init</span>
<span class="c">#    4026532417 cgroup     15   1 root /sbin/init</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1693 
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    4026531834 time       25     1 root  /sbin/init</span>
<span class="c">#    4026531837 user       25     1 root  /sbin/init</span>
<span class="c">#    4026532417 cgroup     15     1 root  /sbin/init</span>
<span class="c">#    4026532891 net         9  1693 65535 /pause</span>
<span class="c">#    4026532969 mnt         1  1693 65535 /pause</span>
<span class="c">#    4026532970 uts         9  1693 65535 /pause</span>
<span class="c">#    4026532971 ipc         9  1693 65535 /pause</span>
<span class="c">#    4026532972 pid         1  1693 65535 /pause</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="si">$(</span>pgrep <span class="nt">-n</span> nginx<span class="si">)</span> <span class="c"># app ì»¨í…Œì´ë„ˆ(nginx)</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    4026531834 time       25     1 root  /sbin/init</span>
<span class="c">#    4026531837 user       25     1 root  /sbin/init</span>
<span class="c">#    4026532891 net         9  1693 65535 /pause</span>
<span class="c">#    4026532970 uts         9  1693 65535 /pause</span>
<span class="c">#    4026532971 ipc         9  1693 65535 /pause</span>
<span class="c">#    4026532973 mnt         8  1754 root  nginx: master process nginx -g daemon off;</span>
<span class="c">#    4026532974 pid         8  1754 root  nginx: master process nginx -g daemon off;</span>
<span class="c">#    4026532975 cgroup      8  1754 root  nginx: master process nginx -g daemon off;</span>
<span class="nt">----------------------------------</span>
<span class="c"># [í„°ë¯¸ë„2] kubectl ëª…ë ¹ ì‹¤í–‰ ë° í™•ì¸</span>
<span class="nv">$ </span>kubectl delete pod myweb
</code></pre></div></div>

<ul>
  <li>ìœ„ì™€ ê°™ì´ <code class="language-plaintext highlighter-rouge">kubectl</code>ê³¼ ê°™ì€ high-levelì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">pause</code> ì»¨í…Œì´ë„ˆê°€ ë³´ì´ì§€ ì•Šì§€ë§Œ, <code class="language-plaintext highlighter-rouge">ps</code>ë‚˜ <code class="language-plaintext highlighter-rouge">lsns</code>ì™€ ê°™ì€ OSì— ì ‘ê·¼ ê°€ëŠ¥í•œ ëª…ë ¹ìœ¼ë¡œëŠ” 
<code class="language-plaintext highlighter-rouge">pause</code> ì»¨í…Œì´ë„ˆê°€ í™•ì¸ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ëŠ” pause ì»¨í…Œì´ë„ˆëŠ” ê³µê¸°ì™€ ê°™ì´ í•­ìƒ íŒŒë“œì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— êµ³ì´ ë³´ì—¬ì¤˜ì„œ í™”ë©´ë§Œ ë³µì¡í•˜ê²Œ í•  ë¿ ë³´ì—¬ì¤„ í•„ìš”ê°€ ì—†ë‹¤ íŒë‹¨í•œê²ƒ ê°™ìŠµë‹ˆë‹¤.</li>
  <li>PAUSE Containerê°€ nsë¥¼ ê³µìœ í•˜ëŠ” íŠ¹ì„±ì„ ì´ìš©í•˜ì—¬,
ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ëŸ°íƒ€ì„ ì˜ì¡´ì„±ë§Œ í¬í•¨í•˜ëŠ” ìµœì†Œí™”ëœ ì´ë¯¸ì§€ê¸°ë°˜ ì»¨í…Œì´ë„ˆì¸ Distroless Containerë¥¼ ëŒ€ìƒìœ¼ë¡œ
Ephemeral Containersì™€ ê°™ì€ í˜•íƒœë¡œ ë””ë²„ê¹…ì— í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://kubernetes.io/docs/concepts/workloads/pods/ephemeral-containers/">Link</a>
</li>
</ul>

<h2 id="cni-container-network-interface">CNI (Container Network Interface)</h2>

<ul>
  <li>ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” CNI(Container Network Interface)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. 
CNIëŠ” ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ê³¼ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì„ ì—°ê²°í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , IP ì£¼ì†Œë¥¼ í• ë‹¹í•˜ë©°,
ë„¤íŠ¸ì›Œí¬ ì •ì±…ì„ ì ìš©í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li>
  <li>CNIì˜ ì£¼ìš” ê¸°ëŠ¥
    <ul>
      <li>
<strong>ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ìƒì„±</strong>: CNI í”ŒëŸ¬ê·¸ì¸ì€ ì»¨í…Œì´ë„ˆì— ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(ì˜ˆ: ê°€ìƒ ì´ë”ë„· ì¥ì¹˜)ë¥¼ ìƒì„±í•˜ê³  ì»¨í…Œì´ë„ˆ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì´ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.</li>
      <li>
<strong>IP ì£¼ì†Œ í• ë‹¹</strong>: í”ŒëŸ¬ê·¸ì¸ì€ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì— IP ì£¼ì†Œë¥¼ í• ë‹¹í•˜ê³ , í•„ìš”ì— ë”°ë¼ IP ì£¼ì†Œ ê´€ë¦¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</li>
      <li>
<strong>ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš©</strong>: ë„¤íŠ¸ì›Œí¬ ì •ì±…ì„ í†µí•´ íŠ¸ë˜í”½ì„ ì œì–´í•  ìˆ˜ ìˆìœ¼ë©°, CNI í”ŒëŸ¬ê·¸ì¸ì€ ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
      <li>
<strong>ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ ì§€ì›</strong>: ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ì™€ ìš”êµ¬ ì‚¬í•­ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ(ì˜ˆ: ë¸Œë¦¬ì§€, VLAN, ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ ë“±)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>CNIì˜ ì‘ë™ ë°©ì‹
    <ul>
      <li>CNIëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í”ŒëŸ¬ê·¸ì¸ ê¸°ë°˜ êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë„êµ¬ëŠ” íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ CNI í”ŒëŸ¬ê·¸ì¸ì„ í˜¸ì¶œí•˜ì—¬ í•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ê° CNI í”ŒëŸ¬ê·¸ì¸ì€ JSON í˜•ì‹ì˜ êµ¬ì„± íŒŒì¼ë¡œ ì •ì˜ë˜ë©°, ì´ë¥¼ í†µí•´ í”ŒëŸ¬ê·¸ì¸ì˜ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>CNI í”ŒëŸ¬ê·¸ì¸ì˜ ì¢…ë¥˜ : CNI í”ŒëŸ¬ê·¸ì¸ì€ ë‹¤ì–‘í•œ ì¢…ë¥˜ê°€ ìˆìœ¼ë©°, ê°ê¸° ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí‚¹ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚µë‹ˆë‹¤. ëŒ€í‘œì ì¸ CNI í”ŒëŸ¬ê·¸ì¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
    <ul>
      <li>
<strong>Flannel</strong>: ê°„ë‹¨í•˜ê³  ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
      <li>
<strong>Calico</strong>: ë„¤íŠ¸ì›Œí¬ ì •ì±…ê³¼ ë³´ì•ˆì„ ê°•ì¡°í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ, ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬ ë° ì •ì±… ì ìš©ì— ê°•ì ì´ ìˆìŠµë‹ˆë‹¤.</li>
      <li>
<strong>Weave</strong>: ìë™ ë©”ì‰¬ ë„¤íŠ¸ì›Œí¬ì™€ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ ì œê³µí•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
      <li>
<strong>Cilium</strong>: ê³ ì„±ëŠ¥ BPF ê¸°ë°˜ ë„¤íŠ¸ì›Œí‚¹ ë° ë³´ì•ˆì„ ì œê³µí•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
      <li>
<strong>Multus</strong>: ì—¬ëŸ¬ CNI í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆì— ì—¬ëŸ¬ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§€ì›í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h3 id="4ê°€ì§€-ìš”êµ¬ì‚¬í•­ê³¼-4ê°€ì§€-ë¬¸ì œ">4ê°€ì§€ ìš”êµ¬ì‚¬í•­ê³¼ 4ê°€ì§€ ë¬¸ì œ</h3>

<p>ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ ëª¨ë¸ì€ 4ê°€ì§€ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•´ì•„í•˜ë©° 4ê°€ì§€ ë¬¸ì œë¥¼ í•´ê²°í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<ul>
  <li>4ê°€ì§€ ìš”êµ¬ì‚¬í•­
    <ol>
      <li>íŒŒë“œì™€ íŒŒë“œ ê°„ í†µì‹  ì‹œ NAT(Network Address Translation) ì—†ì´ í†µì‹ ì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>ë…¸ë“œì˜ ì—ì´ì „íŠ¸(ì˜ˆ) kubelet, ì‹œìŠ¤í…œ ë°ëª¬)ëŠ” Podì™€ í†µì‹ ì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” íŒŒë“œëŠ” NAT ì—†ì´ íŒŒë“œì™€ í†µì‹ ì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>ì„œë¹„ìŠ¤ í´ëŸ¬ìŠ¤í„° IP ëŒ€ì—­ê³¼ íŒŒë“œê°€ ì‚¬ìš©í•˜ëŠ” IP ëŒ€ì—­ì€ ì¤‘ë³µë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.</li>
    </ol>
  </li>
  <li>í•´ê²°í•´ì•¼ í•˜ëŠ” ë¬¸ì œ
    <ol>
      <li>íŒŒë“œ ë‚´ ì»¨í…Œì´ë„ˆëŠ” Loopbackì„ í†µí•œ í†µì‹ ì„ í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>íŒŒë“œ ê°„ í†µì‹ ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ Serviceë¥¼ í†µí•œ í†µì‹ ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
      <li>í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œ Serviceë¥¼ í†µí•œ í†µì‹ ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li>
    </ol>
  </li>
</ul>

<p>ìœ„ì™€ ê°™ì€ ìš”êµ¬ì‚¬í•­ê³¼ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì›í™œí•œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ìœ„í•´ CNI(Container Network Interface)ë¥¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤.
CNI í”ŒëŸ¬ê·¸ì¸ë“¤ì€ ì´ëŸ¬í•œ ìš”êµ¬ì‚¬í•­ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_10.png" alt="img.png" class="image-center" loading="lazy" width="392" height="164">
<em class="image-caption">CNI í”ŒëŸ¬ê·¸ì¸ ë™ì‘ (ì¶œì²˜: ì¶”ê°€ì˜ˆì •)</em></p>

<p>Kubeletì„ í†µí•´ íŒŒë“œê°€ ì‹ ê·œ ìƒì„±ë  ë•Œ ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì„¤ì • ì¶”ê°€ í•„ìš”í•©ë‹ˆë‹¤. 
CNI í”ŒëŸ¬ê·¸ì¸ì€ ì „ë‹¬ë˜ëŠ” ì„¤ì • ì •ì˜ì„œë¥¼ ë³´ê³  ì‹¤ì œ íŒŒë“œê°€ í†µì‹ í•˜ê¸° ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ë“¤ì„ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.
ë˜í•œ CNI í”ŒëŸ¬ê·¸ì¸ì€ IPAM(IP Address Management), 
ì¦‰ IP í• ë‹¹ ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•´ì•¼ í•˜ë©°, íŒŒë“œ ê°„ í†µì‹ ì„ ìœ„í•œ ë¼ìš°íŒ… ì„¤ì •ì„ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<h2 id="flannel">Flannel</h2>

<ul>
  <li>Flannelì€ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•˜ê³  ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.</li>
  <li>Flannelì€ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ë¥¼ ìƒì„±í•˜ì—¬ íŒŒë“œ ê°„ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ë©°, VXLAN, UDP, Host-GW ë“±ì˜ ë°±ì—”ë“œë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ VXLAN ì‚¬ìš©ì´ ê¶Œì¥ë©ë‹ˆë‹¤.</li>
  <li>VXLANì€ Virtual eXtensible Local Area Networkì˜ ì•½ìë¡œ, ë¬¼ë¦¬ì ì¸ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œ  ë…¼ë¦¬ì ì¸ ê°€ìƒì˜ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ ë§Œë“¤ì–´ ì£¼ëŠ” ê²ƒìœ¼ë¡œ, UDP 8472Â  í¬íŠ¸ë¥¼ í†µí•´ ë…¸ë“œ ê°„ í„°ë„ë§ ê¸°ë²•ìœ¼ë¡œ í†µì‹ í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.Â </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_11.png" alt="img.png" class="image-center" loading="lazy" width="495" height="241">
<em class="image-caption">Flannel êµ¬ì¡° (ì¶œì²˜: ì¶”ê°€ì˜ˆì •)</em></p>

<ul>
  <li>ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™ì´ íŒŒë“œì˜ eth0 ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ëŠ” í˜¸ìŠ¤íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ veth ì¸í„°í˜ì´ìŠ¤ì™€ ì—°ê²°ë˜ê³ ,
vethëŠ” cni0ì™€ ì—°ê²°ë©ë‹ˆë‹¤.</li>
  <li>ì´ë¥¼ í†µí•´ ê°™ì€ ë…¸ë“œì—ì„œ í†µì‹ ì‹œ cni0 ë¸Œë¦¿ì§€ë¥¼ í†µí•´ì„œ í†µì‹ í•˜ê³ , ë‹¤ë¥¸ ë…¸ë“œì™€ í†µì‹ ì‹œ VXLANì„ í†µí•´ í†µì‹ í•©ë‹ˆë‹¤.</li>
  <li>VXLANìœ¼ë¡œ ê°€ëŠ” ê³¼ì •ì€ cni0 ë¸Œë¦¿ì§€ë¥¼ í†µí•´ flannel.1 ì¸í„°í˜ì´ìŠ¤ë¡œ ê°€ê³ , flannel.1ì€ í˜¸ìŠ¤íŠ¸ì˜ eth0ì„ í†µí•´ ë‹¤ë¥¸ ë…¸ë“œì— ì „ì†¡ì„ í•©ë‹ˆë‹¤.
ì´ë•Œ <strong>flannel.1ì€ VTEP(Vxlan Tunnel End Point)</strong>ë¼ê³  í•˜ë©° íŒ¨í‚·ì„ ê°ì‹¸ì„œ ëª©í‘œ nodeì˜ IPë¡œ ì „ì†¡í•˜ë©´, ëª©í‘œ nodeì—ì„œ ê°ì‹¼ íŒ¨í‚·ì„ í’€ì–´ì„œ 
í•´ë‹¹ íŒŒë“œì˜ IPë¡œ ë‹¤ì‹œ ë³´ë‚´ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li>
  <li>ê° ë…¸ë“œë§ˆë‹¤ íŒŒë“œì— í• ë‹¹í•  ìˆ˜ ìˆëŠ” IP ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ì´ ìˆê³ , flannelì„ í†µí•˜ì—¬ ETCDë‚˜ Kubernetes APIì— ì „ë‹¬ë˜ì–´, ëª¨ë“  ë…¸ë“œëŠ” í•´ë‹¹ ì •ë³´ë¥¼ ìì‹ ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì— ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
ì´ë¥¼ í†µí•´ ê°ê° ë‹¤ë¥¸ ë…¸ë“œì˜ íŒŒë“œë¼ë¦¬ë„ ë‚´ë¶€ IP ì£¼ì†Œë¥¼ í†µí•´ í†µì‹ ì´ ê°€ëŠ¥í•˜ê²Œ ë©ë‹ˆë‹¤.</li>
</ul>

<h3 id="kind-ì™€-flannel-ì„¤ì¹˜">Kind ì™€ Flannel ì„¤ì¹˜</h3>

<ul>
  <li>Kind í´ëŸ¬ìŠ¤í„°ì— Flannelì„ ì„¤ì¹˜í•´ë³´ê² ìŠµë‹ˆë‹¤. kindëŠ” ê¸°ë³¸ CNIë¡œ kindnetì„ ì‚¬ìš©í•˜ëŠ”ë° ì‹¤ìŠµì„ ìœ„í•´ kindnetì„ ë„ê³  í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">&gt; kind-cni.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  labels:
    mynode: control-plane
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
  - containerPort: 30002
    hostPort: 30002
  kubeadmConfigPatches:
  - |
    kind: ClusterConfiguration
    controllerManager:
      extraArgs:
        bind-address: 0.0.0.0
    etcd:
      local:
        extraArgs:
          listen-metrics-urls: http://0.0.0.0:2381
    scheduler:
      extraArgs:
        bind-address: 0.0.0.0
  - |
    kind: KubeProxyConfiguration
    metricsBindAddress: 0.0.0.0
- role: worker
  labels:
    mynode: worker
- role: worker
  labels:
    mynode: worker2
networking:
  disableDefaultCNI: true
</span><span class="no">EOF
</span><span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-cni.yaml <span class="nt">--name</span> myk8s <span class="nt">--image</span> kindest/node:v1.30.4

<span class="c"># ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>kind get clusters
<span class="nv">$ </span>kind get nodes <span class="nt">--name</span> myk8s
<span class="nv">$ </span>kubectl cluster-info

<span class="c"># ë„¤íŠ¸ì›Œí¬ í™•ì¸</span>
<span class="nv">$ </span>kubectl cluster-info dump | <span class="nb">grep</span> <span class="nt">-m</span> 2 <span class="nt">-E</span> <span class="s2">"cluster-cidr|service-cluster-ip-range"</span>

<span class="c"># ë…¸ë“œ í™•ì¸ : CRI</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-o</span> wide

<span class="c"># ë…¸ë“œ ë¼ë²¨ í™•ì¸</span>
<span class="nv">$ </span>kubectl get nodes myk8s-control-plane <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.metadata.labels<span class="o">}</span> | jq
...
<span class="s2">"mynode"</span>: <span class="s2">"control-plane"</span>,
...

<span class="nv">$ </span>kubectl get nodes myk8s-worker <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.metadata.labels<span class="o">}</span> | jq
<span class="nv">$ </span>kubectl get nodes myk8s-worker2 <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.metadata.labels<span class="o">}</span> | jq

<span class="c"># ì»¨í…Œì´ë„ˆ í™•ì¸ : ì»¨í…Œì´ë„ˆ ê°¯ìˆ˜, ì»¨í…Œì´ë„ˆ ì´ë¦„ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="nv">$ </span>docker port myk8s-control-plane
<span class="nv">$ </span>docker port myk8s-worker
<span class="nv">$ </span>docker port myk8s-worker2

<span class="c"># ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2  ip <span class="nt">-br</span> <span class="nt">-c</span> <span class="nt">-4</span> addr

<span class="c">#</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump iputils-ping htop git nano -y'</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump iputils-ping -y'</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 sh <span class="nt">-c</span> <span class="s1">'apt update &amp;&amp; apt install tree jq psmisc lsof wget bridge-utils tcpdump iputils-ping -y'</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_12.png" alt="img.png" loading="lazy" width="1397" height="1280"></p>

<ul>
  <li>ë‹¤ìŒ ëª…ë ¹ì„ í†µí•´ bridge ì‹¤í–‰íŒŒì¼ì„ ìƒì„±í•´ì„œ ê° ì¸ìŠ¤í„´ìŠ¤ë§ˆë‹¤ ë°°í¬í•´ì•¼í•©ë‹ˆë‹¤. ë¨¼ì € ë‹¤ìŒê³¼ ê°™ì´ bridge íŒŒì¼ì„ ìƒí— í›„ ë¡œì»¬ì— ë³µì‚¬í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane bash
<span class="nt">---------------------------------------</span>
<span class="c"># ë¹Œë“œí™˜ê²½ êµ¬ì„±</span>
<span class="nv">$ </span>apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install </span>golang git <span class="nt">-y</span>
<span class="nv">$ </span>git clone https://github.com/containernetworking/plugins
<span class="nv">$ </span><span class="nb">cd </span>plugins
<span class="nv">$ </span><span class="nb">chmod</span> +x build_linux.sh

<span class="c"># ë¹Œë“œ</span>
<span class="nv">$ </span>./build_linux.sh

<span class="c"># íŒŒì¼ ê¶Œí•œ í™•ì¸ 755</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> bin
<span class="c"># =&gt; -rwxr-xr-x 1 root root  4471145 Sep  7 16:53 bridge</span>
<span class="c">#    ...</span>

<span class="nv">$ </span><span class="nb">exit</span>
<span class="nt">---------------------------------------</span>

<span class="c"># ìì‹ ì˜ PCì— ë³µì‚¬ : -a ê¶Œí•œ ë³´ì¡´í•˜ì—¬ ë³µì‚¬(755)</span>
<span class="nv">$ </span>docker <span class="nb">cp</span> <span class="nt">-a</span> myk8s-control-plane:/plugins/bin/bridge <span class="nb">.</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> bridge
<span class="c"># =&gt; .rwxr-xr-x root staff 4.3 MB Sun Sep  0 00:00:00 2024 bridge</span>
</code></pre></div></div>

<ul>
  <li>ì´ì œ Flannelì„ ì„¤ì¹˜í•˜ê² ìŠµë‹ˆë‹¤. í˜„ì¬ ê¸°ë³¸ CNI ì¸ kindnet ì—†ì´ ì„¤ì¹˜í–ˆê¸° ë•Œë¬¸ì— nodeê°€ not ready ìƒíƒœì—¬ì„œ ìŠ¤ì¼€ì¥´ë§ì´ ì•ˆ ë˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>watch <span class="nt">-d</span> kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>

<span class="c">#</span>
<span class="nv">$ </span>kubectl describe pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> k8s-app<span class="o">=</span>kube-dns | <span class="nb">grep </span>Events: <span class="nt">-A</span> 6
<span class="c"># =&gt; Events:</span>
<span class="c">#      Type     Reason            Age                  From               Message</span>
<span class="c">#      ----     ------            ----                 ----               -------</span>
<span class="c">#      Warning  FailedScheduling  19m                  default-scheduler  0/1 nodes are available: 1 node(s) had untolerated taint {node.kubernetes.io/not-ready: }. preemption: 0/1 nodes are available: 1 Preemption is not helpful for scheduling.</span>

<span class="c"># ê¸°ë³¸ CNI ì¸ kindnet ì—†ì´ ì„¤ì¹˜í–ˆê¸° ë•Œë¬¸ì— nodeê°€ not ready ìƒíƒœì—¬ì„œ ìŠ¤ì¼€ì¥´ë§ì´ ì•ˆ ë˜ê³  ìˆìŠµë‹ˆë‹¤.</span>

<span class="c"># Flannel cni ì„¤ì¹˜</span>
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
<span class="c"># =&gt; namespace/kube-flannel created</span>
<span class="c">#    clusterrole.rbac.authorization.k8s.io/flannel created</span>
<span class="c">#    clusterrolebinding.rbac.authorization.k8s.io/flannel created</span>
<span class="c">#    serviceaccount/flannel created</span>
<span class="c">#    configmap/kube-flannel-cfg created</span>
<span class="c">#    daemonset.apps/kube-flannel-ds created</span>

<span class="c"># namespace ì— pod-security.kubernetes.io/enforce=privileged Label í™•ì¸ </span>
<span class="nv">$ </span>kubectl get ns <span class="nt">--show-labels</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    kube-flannel         Active   60s   k8s-app=flannel,kubernetes.io/metadata.name=kube-flannel,pod-security.kubernetes.io/enforce=privileged</span>
<span class="nv">$ </span>kubectl get ds,pod,cm <span class="nt">-n</span> kube-flannel <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE    CONTAINERS     IMAGES                              SELECTOR</span>
<span class="c">#    daemonset.apps/kube-flannel-ds   3         3         3       3            3           &amp;lt;none&amp;gt;          100s   kube-flannel   docker.io/flannel/flannel:v0.25.6   app=flannel</span>
<span class="c">#    </span>
<span class="c">#    NAME                        READY   STATUS    RESTARTS   AGE    IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    pod/kube-flannel-ds-2l9p6   1/1     Running   0          100s   172.20.0.2   myk8s-worker2         &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    pod/kube-flannel-ds-67ftf   1/1     Running   0          100s   172.20.0.3   myk8s-worker          &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    pod/kube-flannel-ds-87wv8   1/1     Running   0          100s   172.20.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    </span>
<span class="c">#    NAME                         DATA   AGE</span>
<span class="c">#    configmap/kube-flannel-cfg   2      100s</span>
<span class="c">#    configmap/kube-root-ca.crt   1      100s</span>

<span class="c"># kube-flannel-dsê°€ daemonsetìœ¼ë¡œ ë…¸ë“œë§ˆë‹¤ ì‹¤í–‰ì¤‘ì¸ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>

<span class="nv">$ </span>kubectl describe cm <span class="nt">-n</span> kube-flannel kube-flannel-cfg

<span class="nv">$ </span>kubectl describe ds <span class="nt">-n</span> kube-flannel kube-flannel-ds

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> ds/kube-flannel-ds <span class="nt">-n</span> kube-flannel <span class="nt">-c</span> kube-flannel <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-l</span> /etc/kube-flannel


<span class="c"># failed to find plugin "bridge" in path [/opt/cni/bin]</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>
<span class="nv">$ </span>kubectl describe pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> k8s-app<span class="o">=</span>kube-dns
<span class="c"># =&gt; Warning  FailedCreatePodSandBox  2m16s                   kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox "b0023dea7d730b58cfea0163318641ff1d000d368f8ad3b552c53040b371388c": plugin type="flannel" failed (add): failed to delegate add: failed to find plugin "bridge" in path [/opt/cni/bin]</span>
<span class="c">#    Warning  FailedCreatePodSandBox  2m15s                   kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox "0454cbf9ae3c434f163865f6cd261ef2fa298a2de107471600195ebffa0b44cc": plugin type="flannel" failed (add): failed to delegate add: failed to find plugin "bridge" in path [/opt/cni/bin]</span>
</code></pre></div></div>

<ul>
  <li>í˜„ì¬ /opt/cni/bin/bridge íŒŒì¼ì´ ì—†ì–´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ bridge íŒŒì¼ì„ ë³µì‚¬í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># bridge íŒŒì¼ ë³µì‚¬</span>
<span class="nv">$ </span>docker <span class="nb">cp </span>bridge myk8s-control-plane:/opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">cp </span>bridge myk8s-worker:/opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">cp </span>bridge myk8s-worker2:/opt/cni/bin/bridge

<span class="c"># ê¶Œí•œ ë¶€ì—¬</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane  <span class="nb">chmod </span>755 /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker         <span class="nb">chmod </span>755 /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2        <span class="nb">chmod </span>755 /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane  <span class="nb">chown </span>root:root /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker         <span class="nb">chown </span>root:root /opt/cni/bin/bridge
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2        <span class="nb">chown </span>root:root /opt/cni/bin/bridge

<span class="c"># bridge íŒŒì¼ì´ ì˜ ë³µì‚¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane  <span class="nb">ls</span> <span class="nt">-l</span> /opt/cni/bin/
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  <span class="nb">ls</span> <span class="nt">-l</span> /opt/cni/bin/
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 <span class="nb">ls</span> <span class="nt">-l</span> /opt/cni/bin/
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>myk8s-control-plane myk8s-worker myk8s-worker2<span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; node </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$i</span> <span class="nb">ls</span> /opt/cni/bin/<span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done
</span>bridge	flannel  host-local  loopback  portmap	ptp

<span class="c">#</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span> <span class="nt">-owide</span>
<span class="c"># =&gt; NAMESPACE            NAME                                          READY   STATUS    RESTARTS   AGE     IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    ...</span>
<span class="c">#    kube-system          coredns-7db6d8ff4d-hjmjf                      1/1     Running   0          29m     10.244.1.4   myk8s-worker2         &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          coredns-7db6d8ff4d-lfmzj                      1/1     Running   0          29m     10.244.1.3   myk8s-worker2         &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    ...</span>
</code></pre></div></div>

<h3 id="flannel-ì„¤ì¹˜-í™•ì¸">Flannel ì„¤ì¹˜ í™•ì¸</h3>

<ul>
  <li>Flannel ì„¤ì¹˜ í›„ corednsê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ Flannelì´ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl get ds,pod,cm <span class="nt">-n</span> kube-flannel <span class="nt">-owide</span>
<span class="c"># =&gt; &lt;span style="font-weight:bold;"&gt;NAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE   CONTAINERS     IMAGES                              SELECTOR&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;daemonset.apps/kube-flannel-ds&lt;/span&gt;   &lt;span style="color:teal;"&gt;3&lt;/span&gt;         &lt;span style="color:gray;"&gt;3&lt;/span&gt;         &lt;span style="color:teal;"&gt;3&lt;/span&gt;       &lt;span style="color:gray;"&gt;3&lt;/span&gt;            &lt;span style="color:teal;"&gt;3&lt;/span&gt;           &lt;span style="color:gray;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;          &lt;span style="color:teal;"&gt;13m&lt;/span&gt;   &lt;span style="color:gray;"&gt;kube-flannel&lt;/span&gt;   &lt;span style="color:teal;"&gt;docker.io/flannel/flannel:v0.25.6&lt;/span&gt;   &lt;span style="color:gray;"&gt;app=flannel&lt;/span&gt;</span>
<span class="c">#    </span>
<span class="c">#    &lt;span style="font-weight:bold;"&gt;NAME                        READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;pod/kube-flannel-ds-2l9p6&lt;/span&gt;   &lt;span style="color:teal;"&gt;1/1&lt;/span&gt;     &lt;span style="color:green;"&gt;Running&lt;/span&gt;   &lt;span style="color:teal;"&gt;0&lt;/span&gt;          &lt;span style="color:gray;"&gt;13m&lt;/span&gt;   &lt;span style="color:teal;"&gt;172.20.0.2&lt;/span&gt;   &lt;span style="color:gray;"&gt;myk8s-worker2&lt;/span&gt;         &lt;span style="color:teal;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;           &lt;span style="color:gray;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;pod/kube-flannel-ds-67ftf&lt;/span&gt;   &lt;span style="color:teal;"&gt;1/1&lt;/span&gt;     &lt;span style="color:green;"&gt;Running&lt;/span&gt;   &lt;span style="color:teal;"&gt;0&lt;/span&gt;          &lt;span style="color:gray;"&gt;13m&lt;/span&gt;   &lt;span style="color:teal;"&gt;172.20.0.3&lt;/span&gt;   &lt;span style="color:gray;"&gt;myk8s-worker&lt;/span&gt;          &lt;span style="color:teal;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;           &lt;span style="color:gray;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;pod/kube-flannel-ds-87wv8&lt;/span&gt;   &lt;span style="color:teal;"&gt;1/1&lt;/span&gt;     &lt;span style="color:green;"&gt;Running&lt;/span&gt;   &lt;span style="color:teal;"&gt;0&lt;/span&gt;          &lt;span style="color:gray;"&gt;13m&lt;/span&gt;   &lt;span style="color:teal;"&gt;172.20.0.4&lt;/span&gt;   &lt;span style="color:gray;"&gt;myk8s-control-plane&lt;/span&gt;   &lt;span style="color:teal;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;           &lt;span style="color:gray;"&gt;&amp;lt;none&amp;gt;&lt;/span&gt;</span>
<span class="c">#    </span>
<span class="c">#    &lt;span style="font-weight:bold;"&gt;NAME                         DATA   AGE&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;configmap/kube-flannel-cfg&lt;/span&gt;   &lt;span style="color:teal;"&gt;2&lt;/span&gt;      &lt;span style="color:gray;"&gt;13m&lt;/span&gt;</span>
<span class="c">#    &lt;span style="color:gray;"&gt;configmap/kube-root-ca.crt&lt;/span&gt;   &lt;span style="color:teal;"&gt;1&lt;/span&gt;      &lt;span style="color:gray;"&gt;13m&lt;/span&gt;</span>

<span class="nv">$ </span>kubectl describe cm <span class="nt">-n</span> kube-flannel kube-flannel-cfg

<span class="c"># iptables ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>filter nat mangle raw <span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; IPTables Type : </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane  iptables <span class="nt">-t</span> <span class="nv">$i</span> <span class="nt">-S</span> <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>filter nat mangle raw <span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; IPTables Type : </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  iptables <span class="nt">-t</span> <span class="nv">$i</span> <span class="nt">-S</span> <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>filter nat mangle raw <span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; IPTables Type : </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 iptables <span class="nt">-t</span> <span class="nv">$i</span> <span class="nt">-S</span> <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>

<span class="c"># flannel ì •ë³´ í™•ì¸ : ëŒ€ì—­, MTU</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>myk8s-control-plane myk8s-worker myk8s-worker2<span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; node </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$i</span> <span class="nb">cat</span> /run/flannel/subnet.env <span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; &gt;&gt; node myk8s-control-plane &lt;&lt;</span>
<span class="c">#    FLANNEL_NETWORK=10.244.0.0/16</span>
<span class="c">#    FLANNEL_SUBNET=10.244.0.1/24</span>
<span class="c">#    FLANNEL_MTU=1450</span>
<span class="c">#    FLANNEL_IPMASQ=true</span>
<span class="c">#    ...</span>

<span class="c"># ë…¸ë“œë§ˆë‹¤ í• ë‹¹ëœ dedicated subnet (podCIDR) í™•ì¸</span>
<span class="nv">$ </span>kubectl get nodes <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[*].spec.podCIDR}'</span> <span class="p">;</span><span class="nb">echo</span>
<span class="c"># =&gt; 10.244.0.0/24 10.244.2.0/24 10.244.1.0/24</span>

<span class="c"># ë…¸ë“œ ì •ë³´ ì¤‘ flannel ê´€ë ¨ ì •ë³´ í™•ì¸ : VXLAN ëª¨ë“œ ì •ë³´ì™€, VTEP ì •ë³´(ë…¸ë“œ IP, VtepMac) ë¥¼ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe node | <span class="nb">grep</span> <span class="nt">-A3</span> Annotations
<span class="c"># =&gt; Annotations:        flannel.alpha.coreos.com/backend-data: {&amp;quot;VNI&amp;quot;:1,&amp;quot;VtepMAC&amp;quot;:&amp;quot;6e:0e:72:1e:72:1d&amp;quot;}</span>
<span class="c">#                        flannel.alpha.coreos.com/backend-type: vxlan</span>
<span class="c">#                        flannel.alpha.coreos.com/kube-subnet-manager: true</span>
<span class="c">#                        flannel.alpha.coreos.com/public-ip: 172.20.0.4</span>
<span class="c">#    --</span>
<span class="c">#    Annotations:        flannel.alpha.coreos.com/backend-data: {&amp;quot;VNI&amp;quot;:1,&amp;quot;VtepMAC&amp;quot;:&amp;quot;ca:de:a3:b8:65:d8&amp;quot;}</span>
<span class="c">#                        flannel.alpha.coreos.com/backend-type: vxlan</span>
<span class="c">#                        flannel.alpha.coreos.com/kube-subnet-manager: true</span>
<span class="c">#                        flannel.alpha.coreos.com/public-ip: 172.20.0.3</span>
<span class="c">#    --</span>
<span class="c">#    Annotations:        flannel.alpha.coreos.com/backend-data: {&amp;quot;VNI&amp;quot;:1,&amp;quot;VtepMAC&amp;quot;:&amp;quot;1e:1e:b1:15:9e:d3&amp;quot;}</span>
<span class="c">#                        flannel.alpha.coreos.com/backend-type: vxlan</span>
<span class="c">#                        flannel.alpha.coreos.com/kube-subnet-manager: true</span>
<span class="c">#                        flannel.alpha.coreos.com/public-ip: 172.20.0.2</span>

<span class="c"># ê° ë…¸ë“œ(?) ë§ˆë‹¤ bash ì§„ì… í›„ ì•„ë˜ ê¸°ë³¸ ì •ë³´ í™•ì¸ : ë¨¼ì € worker ë¶€í„° bash ì§„ì… í›„ í™•ì¸í•˜ì</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker        bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2       bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-control-plane bash
<span class="nt">----------------------------------------</span>
<span class="c"># í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ NSì™€ flannel, kube-proxy ì»¨í…Œì´ë„ˆì˜ ë„¤íŠ¸ì›Œí¬ NS ë¹„êµ =&gt; ëª¨ë‘ ë™ì¼í•œ NSë¥¼ ê°€ì§‘ë‹ˆë‹¤. </span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> 1
<span class="c"># =&gt;         NS TYPE   NPROCS PID USER COMMAND</span>
<span class="c">#    ...</span>
<span class="c">#    4026532344 net        12   1 root /sbin/init</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="si">$(</span>pgrep flanneld<span class="si">)</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    ...</span>
<span class="c">#    4026532344 net        12     1 root  /sbin/init</span>
<span class="nv">$ </span>lsns <span class="nt">-p</span> <span class="si">$(</span>pgrep kube-proxy<span class="si">)</span>
<span class="c"># =&gt;         NS TYPE   NPROCS   PID USER  COMMAND</span>
<span class="c">#    ...</span>
<span class="c">#    4026532344 net        12     1 root  /sbin/init</span>

<span class="c"># ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nt">-br</span> addr
<span class="c"># =&gt; lo               UNKNOWN        127.0.0.1/8 ::1/128</span>
<span class="c">#    flannel.1        UNKNOWN        10.244.2.0/32</span>
<span class="c">#    eth0@if37        UP             172.20.0.3/16 fc00:f853:ccd:e793::3/64 fe80::42:acff:fe14:3/64</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nb">link</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'flannel|cni|veth'</span> <span class="nt">-A1</span>
<span class="c"># =&gt; 4: flannel.1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN mode DEFAULT group default</span>
<span class="c">#       link/ether ca:de:a3:b8:65:d8 brd ff:ff:ff:ff:ff:ff</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> addr
<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nt">-d</span> addr show cni0     <span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê²©ë¦¬ íŒŒë“œê°€ 1ê°œ ì´ìƒ ë°°ì¹˜ ì‹œ í™•ì¸ë¨</span>
<span class="c"># =&gt; (ê³µë°±)</span>

<span class="c"># í˜„ì¬ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê²©ë¦¬ëœ íŒŒë“œê°€ ì—†ì–´ì„œ cni0 ì¸í„°í˜ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</span>

<span class="nv">$ </span>ip <span class="nt">-c</span> <span class="nt">-d</span> addr show flannel.1
<span class="c"># =&gt; 4: flannel.1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN group default</span>
<span class="c">#        link/ether ca:de:a3:b8:65:d8 brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535</span>
<span class="c">#        vxlan id 1 local 172.20.0.3 dev eth0 srcport 0 0 dstport 8472 nolearning ttl auto ageing 300 udpcsum noudp6zerocsumtx noudp6zerocsumrx numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535</span>
<span class="c">#        inet 10.244.2.0/32 scope global flannel.1</span>
<span class="c">#           valid_lft forever preferred_lft forever</span>
    
<span class="nv">$ </span>brctl show
<span class="c"># =&gt; (ê³µë°±)</span>

<span class="c"># ë¼ìš°íŒ… ì •ë³´ í™•ì¸ : ë‹¤ë¥¸ ë…¸ë“œì˜ íŒŒë“œ ëŒ€ì—­(podCIDR)ì˜ ë¼ìš°íŒ… ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì–´ ìˆìŒì„ í™•ì¸		</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> route
<span class="c"># =&gt; default via 172.20.0.1 dev eth0</span>
<span class="c">#    10.244.0.0/24 via 10.244.0.0 dev flannel.1 onlink</span>
<span class="c">#    10.244.1.0/24 via 10.244.1.0 dev flannel.1 onlink</span>
<span class="c">#    172.20.0.0/16 dev eth0 proto kernel scope link src 172.20.0.3</span>

<span class="c"># flannel.1 ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ARP í…Œì´ë¸” ì •ë³´ í™•ì¸ : ë‹¤ë¥¸ ë…¸ë“œì˜ flannel.1 IPì™€ MAC ì •ë³´ë¥¼ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> neigh show dev flannel.1
<span class="c"># =&gt; 10.244.1.0 lladdr 1e:1e:b1:15:9e:d3 PERMANENT</span>
<span class="c">#    10.244.0.0 lladdr 6e:0e:72:1e:72:1d PERMANENT</span>

<span class="c"># ë¸Œë¦¬ì§€ fdb ì •ë³´ì—ì„œ í•´ë‹¹ MAC ì£¼ì†Œì™€ í†µì‹  ì‹œ ê° ë…¸ë“œì˜ enp0s8 </span>
<span class="nv">$ </span>bridge fdb show dev flannel.1
<span class="c"># =&gt; 6e:0e:72:1e:72:1d dst 172.20.0.4 self permanent</span>
<span class="c">#    1e:1e:b1:15:9e:d3 dst 172.20.0.2 self permanent</span>

<span class="c"># ë‹¤ë¥¸ ë…¸ë“œì˜ flannel.1 ì¸í„°í˜ì´ìŠ¤ë¡œ ping í†µì‹  : VXLAN ì˜¤ë²„ë ˆì´ë¥¼ í†µí•´ì„œ í†µì‹ </span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 10.244.0.0
<span class="c"># =&gt; ...</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 10.244.1.0
<span class="c"># =&gt; ...</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 10.244.2.0
<span class="c"># =&gt; ...</span>
<span class="c">#    1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>

<span class="c"># ë‹¤ë¥¸ ë…¸ë“œì™€ VXLANì„ í†µí•´ì„œ ì˜ í†µì‹  ë©ë‹ˆë‹¤.</span>

<span class="c"># iptables í•„í„° í…Œì´ë¸” ì •ë³´ í™•ì¸ : íŒŒë“œì˜ 10.244.0.0/16 ëŒ€ì—­ ë¼ë¦¬ëŠ” ëª¨ë“  ë…¸ë“œì—ì„œ ì „ë‹¬ì´ ê°€ëŠ¥</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> filter <span class="nt">-S</span> | <span class="nb">grep </span>10.244.0.0
<span class="c"># =&gt; -A FLANNEL-FWD -s 10.244.0.0/16 -m comment --comment "flanneld forward" -j ACCEPT</span>
<span class="c">#    -A FLANNEL-FWD -d 10.244.0.0/16 -m comment --comment "flanneld forward" -j ACCEPT</span>

<span class="c"># iptables NAT í…Œì´ë¸” ì •ë³´ í™•ì¸ : 10.244.0.0/16 ëŒ€ì—­ ë¼ë¦¬ í†µì‹ ì€ ë§ˆìŠ¤ì»¤ë ˆì´ë”© ì—†ì´ í†µì‹ ì„ í•˜ë©°,</span>
<span class="c"># 10.244.0.0/16 ëŒ€ì—­ì—ì„œ ë™ì¼ ëŒ€ì—­(10.244.0.0/16)ê³¼ ë©€í‹°ìºìŠ¤íŠ¸ ëŒ€ì—­(224.0.0.0/4) ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ (ì™¸ë¶€) í†µì‹  ì‹œì—ëŠ” ë§ˆìŠ¤ì»¤ë ˆì´ë”©ì„ ìˆ˜í–‰</span>
<span class="nv">$ </span>iptables <span class="nt">-t</span> nat <span class="nt">-S</span> | <span class="nb">grep</span> <span class="s1">'flanneld masq'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'! -s'</span>
<span class="c"># =&gt; -A POSTROUTING -m comment --comment "flanneld masq" -j FLANNEL-POSTRTG</span>
<span class="c">#    -A FLANNEL-POSTRTG -m mark --mark 0x4000/0x4000 -m comment --comment "flanneld masq" -j RETURN</span>
<span class="c">#    -A FLANNEL-POSTRTG -s 10.244.2.0/24 -d 10.244.0.0/16 -m comment --comment "flanneld masq" -j RETURN</span>
<span class="c">#    -A FLANNEL-POSTRTG -s 10.244.0.0/16 -d 10.244.2.0/24 -m comment --comment "flanneld masq" -j RETURN</span>
<span class="c">#    -A FLANNEL-POSTRTG -s 10.244.0.0/16 ! -d 224.0.0.0/4 -m comment --comment "flanneld masq" -j MASQUERADE --random-fully</span>

<span class="nt">----------------------------------------</span>
</code></pre></div></div>

<ul>
  <li>íŒŒë“œ 2ê°œë¥¼ ìƒì„±í•´ì„œ CNI ë„¤íŠ¸ì›Œí¬ ë¸Œë¦¬ì§€ì˜ ì •ë³´ë¥¼  í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [í„°ë¯¸ë„1,2] ì›Œì»¤ ë…¸ë“œ1,2 - ëª¨ë‹ˆí„°ë§</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 bash
<span class="nt">-----------------------------</span>
<span class="nv">$ </span>watch <span class="nt">-d</span> <span class="s2">"ip link | egrep 'cni|veth' ;echo; brctl show cni0"</span>
<span class="nt">-----------------------------</span>

<span class="c"># [í„°ë¯¸ë„3] cat &amp; here document ëª…ë ¹ ì¡°í•©ìœ¼ë¡œ ì¦‰ì„(?) ë¦¬ì†ŒìŠ¤ ìƒì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl create -f -
apiVersion: v1
kind: Pod
metadata:
  name: pod-1
  labels:
    app: pod
spec:
  nodeSelector:
    kubernetes.io/hostname: myk8s-worker
  containers:
  - name: netshoot-pod
    image: nicolaka/netshoot
    command: ["tail"]
    args: ["-f", "/dev/null"]
  terminationGracePeriodSeconds: 0
---
apiVersion: v1
kind: Pod
metadata:
  name: pod-2
  labels:
    app: pod
spec:
  nodeSelector:
    kubernetes.io/hostname: myk8s-worker2
  containers:
  - name: netshoot-pod
    image: nicolaka/netshoot
    command: ["tail"]
    args: ["-f", "/dev/null"]
  terminationGracePeriodSeconds: 0
</span><span class="no">EOF

</span><span class="c"># íŒŒë“œ í™•ì¸ : IP í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-o</span> wide
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_13.png" alt="img.png" loading="lazy" width="1334" height="835"></p>

<ul>
  <li>CNI ê°€ ì—†ì—ˆëŠ”ë° íŒŒë“œ íŒ¨í¬í›„ CNI ë„¤íŠ¸ì›Œí¬ ë¸Œë¦¬ì§€ê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë³´ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 bash
<span class="nt">-----------------------------</span>
<span class="c"># ë¸Œë¦¬ì§€ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>brctl show cni0

<span class="c"># ë¸Œë¦¬ì§€ ì—°ê²° ë§í¬(veth) í™•ì¸</span>
<span class="nv">$ </span>bridge <span class="nb">link</span>

<span class="c"># ë¸Œë¦¬ì§€ VLAN ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>bridge vlan

<span class="c"># cbr(custom bridge) ì •ë³´ : kubenet CNIì˜ bridge - ë§í¬</span>
<span class="nv">$ </span>tree /var/lib/cni/networks/cbr0

<span class="c"># ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì •ë³´ë“¤ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> addr | <span class="nb">grep </span>veth <span class="nt">-A3</span>
<span class="nt">-----------------------------</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_14.png" alt="img.png" loading="lazy" width="1012" height="1150"></p>

<h3 id="í†µì‹ -íë¦„-ì´í•´">í†µì‹  íë¦„ ì´í•´</h3>

<ul>
  <li>Flannel ê¸°ë°˜ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì¶•í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¸ê°€ì§€ì˜ í†µì‹  ì‹œë‚˜ë¦¬ì˜¤ê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ol>
      <li>ë™ì¼ ë…¸ë“œì—ì„œ íŒŒë“œê°„ í†µì‹ í•˜ëŠ” ê²½ìš°
  <img src="/assets/2024/kans-3th/w2/20240907_kans_w2_15.png" alt="img.png" class="image-center" loading="lazy" width="365" height="253">
</li>
      <li>íŒŒë“œì—ì„œ ì™¸ë¶€ì™€ í†µì‹ í•˜ëŠ” ê²½ìš°
  <img src="/assets/2024/kans-3th/w2/20240907_kans_w2_16.png" alt="img_1.png" class="image-center" loading="lazy" width="344" height="305">
</li>
      <li>ì„œë¡œë‹¤ë¥¸ ë…¸ë“œì—ì„œ íŒŒë“œê°„ í†µì‹ í•˜ëŠ” ê²½ìš°
  <img src="/assets/2024/kans-3th/w2/20240907_kans_w2_17.png" alt="img_2.png" class="image-center" loading="lazy" width="1209" height="568">
</li>
    </ol>
  </li>
</ul>

<p>íŒŒë“œ ê°„ í†µì‹ , ì„œë¡œë‹¤ë¥¸ ë…¸ë“œì˜ íŒŒë“œê°„ í†µì‹ , ì™¸ë¶€ í†µì‹  ì—¬ë¶€ì— ëŒ€í•´ ì‚´í´ë³´ê³ , í†µì‹ ì´ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì˜ íŒ¨í‚·ì„ ìº¡ì²˜í•˜ë©´ì„œ Flannel networkì— ëŒ€í•´ ì´í•´í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> pod-1 <span class="nt">--</span> zsh
<span class="nt">-----------------------------</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> addr show eth0

<span class="c"># GW IPëŠ” ì–´ë–¤ ì¸í„°í˜ì´ìŠ¤ì¸ê°€? =&gt; cni0</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> route
<span class="nv">$ </span>route <span class="nt">-n</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 &lt;GW IP&gt;
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 &lt;pod-2 IP&gt;  <span class="c"># ë‹¤ë¥¸ ë…¸ë“œì— ë°°í¬ëœ íŒŒë“œ í†µì‹  í™•ì¸</span>
<span class="nv">$ </span>ping <span class="nt">-c</span> 1 8.8.8.8     <span class="c"># ì™¸ë¶€ ì¸í„°ë„· IP   ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>curl <span class="nt">-s</span> wttr.in/Seoul <span class="c"># ì™¸ë¶€ ì¸í„°ë„· ë„ë©”ì¸ ì ‘ì† í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> neigh
<span class="nv">$ </span><span class="nb">exit</span>
</code></pre></div></div>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_18.png" alt="img.png" loading="lazy" width="887" height="1464"></p>

<ul>
  <li>ì„œë¡œë‹¤ë¥¸ ë…¸ë“œê°„ íŒŒë“œì˜ í†µì‹ , ì™¸ë¶€ì™€ì˜ í†µì‹  ë“±ì´ ëª¨ë‘ ì˜ í†µì‹  ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ë²ˆì—ëŠ” ê° ë…¸ë“œì˜ cni0ì—ì„œ íŒ¨í‚· ìº¡ì³ë¥¼ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [í„°ë¯¸ë„1,2] ì›Œì»¤ ë…¸ë“œ1,2</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker  bash
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> myk8s-worker2 bash
<span class="nt">-----------------------------</span>
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> cni0 <span class="nt">-nn</span> icmp
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> flannel.1 <span class="nt">-nn</span> icmp
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> eth0 <span class="nt">-nn</span> icmp
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> eth0 <span class="nt">-nn</span> udp port 8472 <span class="nt">-w</span> /root/vxlan.pcap 
<span class="c"># CTRL+C ì·¨ì†Œ í›„ í™•ì¸ : ls -l /root/vxlan.pcap</span>

<span class="nv">$ </span>conntrack <span class="nt">-L</span> | <span class="nb">grep</span> <span class="nt">-i</span> icmp
<span class="nt">-----------------------------</span>

<span class="c"># [í„°ë¯¸ë„3]</span>
<span class="nv">$ </span>docker <span class="nb">cp </span>myk8s-worker:/root/vxlan.pcap <span class="nb">.</span>
<span class="nv">$ </span>wireshark vxlan.pcap
</code></pre></div></div>

<ul>
  <li>Pod-1 =&gt; Pod-2 (cni0 ê´€ì )
    <ul>
      <li>ë¸Œë¦¿ì§€ë¥¼ í†µí•´ ê°ê° ì˜¤ê°€ëŠ” íŒ¨í‚·ì´ ì˜ ë³´ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_19.png" alt="img.png" loading="lazy" width="1481" height="625"></p>

<ul>
  <li>Pod-1 =&gt; ì™¸ë¶€ (cni0 ê´€ì )
    <ul>
      <li>ê°™ì€ ë…¸ë“œì—ì„œëŠ” íŒ¨í‚·ì´ ì™¸ë¶€ë¡œ ë‚˜ê°”ë‹¤ ì˜¤ëŠ”ê²ƒì´ ì˜ ë³´ì…ë‹ˆë‹¤.</li>
      <li>í•˜ì§€ë§Œ ë‹¤ë¥¸ ë…¸ë“œ (worker2)ì—ì„œëŠ” ì™¸ë¶€ì™€ ì˜¤ê°€ëŠ” íŒ¨í‚·ì´ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_20.png" alt="img.png" loading="lazy" width="1481" height="625"></p>

<ul>
  <li>Pod-1 =&gt; Pod-2 (flannel.1 ê´€ì )
    <ul>
      <li>flannel.1ì„ í†µí•´ ê°ê° ì˜¤ê°€ëŠ” íŒ¨í‚·ì´ ì˜ ë³´ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_21.png" alt="img.png" loading="lazy" width="1481" height="625"></p>

<ul>
  <li>Pod-1 -&gt; ì™¸ë¶€ (flannel.1 ê´€ì )
    <ul>
      <li>ì•ì„  ê·¸ë¦¼ì—ì„œ ë³´ì•˜ë“¯ ì™¸ë¶€ì™€ í†µì‹ ì‹œ VTEPì¸ flannel.1ì„ ê±°ì¹˜ì§€ ì•Šê³  cni0ì—ì„œ í˜¸ìŠ¤íŠ¸ì˜ eth0ë¡œ ë°”ë¡œ ë‚˜ê°€ê¸° ë•Œë¬¸ì— íŒ¨í‚·ì´ ìº¡ì³ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_22.png" alt="img.png" loading="lazy" width="1481" height="625"></p>

<ul>
  <li>Pod 1 -&gt; Pod 2 (eth0 ê´€ì )
    <ul>
      <li>eth0ì—ì„œ ë´¤ì„ë•ŒëŠ” ìº¡ì³ê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ìœ ëŠ” flannel.1ì„ í†µí•´ tcp íŒ¨í‚·ì´ ìº¡ìŠí™” ë˜ì–´ udp 8472ë¡œ eth0ë¥¼ í†µí•´ ì „ë‹¬ë˜ê¸° ë•Œë¬¸ì—
<code class="language-plaintext highlighter-rouge">-nn icmp</code> ì˜µì…˜ìœ¼ë¡œ icmp íŒ¨í‚· (ping)ë§Œ ìº¡ì³í• ë•ŒëŠ” ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_23.png" alt="img.png" loading="lazy" width="1481" height="625"></p>

<ul>
  <li>Pod 1 -&gt; Pod 2 (eth0 ê´€ì , udp port 8472 ë¤í”„)
    <ul>
      <li>udp íŒ¨í‚·ì„ ìº¡ì³í•˜ì—¬ wiresharkë¡œ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_25.png" alt="img.png" loading="lazy" width="1437" height="581"></p>

<ul>
  <li>udp 8472 í¬íŠ¸ë¥¼ í†µí•´ icmp (ping)ì´ ì˜¤ê°€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (8472ëŠ” VXLAN í¬íŠ¸ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì˜µì…˜ì—ì„œ VXLANì„ ì§€ì •í•´ì•¼ ë³´ì…ë‹ˆë‹¤.)</li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_26.png" alt="img_1.png" loading="lazy" width="1482" height="701"></p>

<ul>
  <li>Pod 1 -&gt; 8.8.8.8(ì™¸ë¶€) (eth0 ê´€ì )
    <ul>
      <li>eth0ì—ì„œ ì™¸ë¶€ì™€ í†µì‹ í•˜ëŠ” íŒ¨í‚·ì´ ê°™ì€ ë…¸ë“œì—ì„œëŠ” ë³´ì´ê³ , ë‹¤ë¥¸ ë…¸ë“œì—ì„œëŠ” ì•ˆ ë³´ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/kans-3th/w2/20240907_kans_w2_24.png" alt="img.png" loading="lazy" width="1481" height="625"></p>

<hr>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì´ë²ˆì£¼ì—ë„ ë§ì€ ë‚´ìš©ë“¤ì„ ìŠ¤í„°ë””í•´ë³´ì•˜ìŠµë‹ˆë‹¤. 
KINDë¥¼ ì•Œê²Œë˜ì–´ì„œ ì°¸ ì¢‹ì•˜ë˜ê²ƒ ê°™ìŠµë‹ˆë‹¤. 
ê¸°ì¡´ì— ì‚¬ë‚´ êµìœ¡ì„ ìœ„í•´ì„œ kubernetesë¥¼ ì„¤ì¹˜í•˜ë ¤ë©´ ê°–ì€ ì–´ë ¤ì›€ì´ ìˆì—ˆëŠ”ë°
dockerë§Œ ìˆìœ¼ë©´ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ ì°¸ ì¢‹ì€ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ë§‰ì—°í•˜ê²Œ ì•Œê³  ìˆì—ˆë˜ ë…¸ë“œê°„ì˜ íŒŒë“œì˜ í†µì‹ ì— ëŒ€í•´ì„œ ì•Œê²Œë˜ì—ˆê³ ,
ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ìš´ì˜ì¤‘ ë„¤íŠ¸ì›Œí¬ ì¥ì• ì— ëŒ€í•´ 1ì£¼ì°¨ ìŠ¤í„°ë””ì™€ ì´ë²ˆ ìŠ¤í„°ë””ë¥¼ í†µí•´
ìì‹ ê°ì´ ì¡°ê¸ˆ ìƒê²¼ìŠµë‹ˆë‹¤.
ë‚¨ì€ ìŠ¤í„°ë””ë„ ì—´ì‹¬íˆí•´ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´ ì¡°ê¸ˆ ì•„ëŠ” ì‚¬ëŒì´ ë˜ì–´ë³´ê² ìŠµë‹ˆë‹¤.</p>

  </div>

  <div id="toc-minimap" class="toc-minimap collapsed">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">ë“¤ì–´ê°€ë©°</a></li>
<li class="toc-entry toc-h2"><a href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EC%86%8C%EA%B0%9C">ì¿ ë²„ë„¤í‹°ìŠ¤ ì†Œê°œ</a></li>
<li class="toc-entry toc-h2">
<a href="#kind-%EC%86%8C%EA%B0%9C-%EB%B0%8F-%EC%84%A4%EC%B9%98">kind ì†Œê°œ ë° ì„¤ì¹˜</a>
<ul>
<li class="toc-entry toc-h3"><a href="#%EC%84%A4%EC%B9%98">ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h3"><a href="#1-node-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8">1-Node í´ëŸ¬ìŠ¤í„° êµ¬ì„± í…ŒìŠ¤íŠ¸</a></li>
<li class="toc-entry toc-h3"><a href="#2-node-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8">2-Node í´ëŸ¬ìŠ¤í„° êµ¬ì„± í…ŒìŠ¤íŠ¸</a></li>
<li class="toc-entry toc-h3"><a href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B4%80%EB%A0%A8-%EC%A0%95%EB%B3%B4-%EC%A1%B0%EC%82%AC">ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì •ë³´ ì¡°ì‚¬</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%8C%8C%EB%93%9C-%EC%83%9D%EC%84%B1-%EB%B0%8F-%ED%99%95%EC%9D%B8">íŒŒë“œ ìƒì„± ë° í™•ì¸</a></li>
<li class="toc-entry toc-h3"><a href="#%EC%BB%A8%ED%8A%B8%EB%A1%A4-%ED%94%8C%EB%A0%88%EC%9D%B8-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8">ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì»¨í…Œì´ë„ˆ ì •ë³´ í™•ì¸</a></li>
<li class="toc-entry toc-h3"><a href="#multi-node-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-with-kube-ops-view--mapping-ports">Multi-Node í´ëŸ¬ìŠ¤í„° with kube-ops-view &amp; mapping ports</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#%ED%8C%8C%EB%93%9C--pause-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88">íŒŒë“œ &amp; PAUSE ì»¨í…Œì´ë„ˆ</a>
<ul>
<li class="toc-entry toc-h3"><a href="#k8s-cri-container-runtime-interface">K8S CRI (Container Runtime Interface)</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%8C%8C%EB%93%9C-pod">íŒŒë“œ (Pod)</a></li>
<li class="toc-entry toc-h3">
<a href="#pause-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88">PAUSE ì»¨í…Œì´ë„ˆ</a>
<ul>
<li class="toc-entry toc-h4"><a href="#pause-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%8B%A4%EC%8A%B5">Pause ì»¨í…Œì´ë„ˆ ì‹¤ìŠµ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#cni-container-network-interface">CNI (Container Network Interface)</a>
<ul>
<li class="toc-entry toc-h3"><a href="#4%EA%B0%80%EC%A7%80-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD%EA%B3%BC-4%EA%B0%80%EC%A7%80-%EB%AC%B8%EC%A0%9C">4ê°€ì§€ ìš”êµ¬ì‚¬í•­ê³¼ 4ê°€ì§€ ë¬¸ì œ</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#flannel">Flannel</a>
<ul>
<li class="toc-entry toc-h3"><a href="#kind-%EC%99%80-flannel-%EC%84%A4%EC%B9%98">Kind ì™€ Flannel ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h3"><a href="#flannel-%EC%84%A4%EC%B9%98-%ED%99%95%EC%9D%B8">Flannel ì„¤ì¹˜ í™•ì¸</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%86%B5%EC%8B%A0-%ED%9D%90%EB%A6%84-%EC%9D%B4%ED%95%B4">í†µì‹  íë¦„ ì´í•´</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">ë§ˆì¹˜ë©°</a></li>
</ul>
  </div>
<a class="u-url" href="/posts/2024-09-07-KANS-Study-Week2/" hidden></a>
</article>



<div class="PageNavigation">
  
  <a class="prev" href="/posts/2024-08-27-KANS-Study-Week1/">Â« [KANS 3ê¸°] ì»¨í…Œì´ë„ˆ ê²©ë¦¬</a>
  
  
  <a class="next" href="/posts/2024-09-22-KANS-Study-Week3/">[KANS 3ê¸°] K8S Calico CNI Â»</a>
  
</div>

<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = "https://sweetlittlebird.github.io/posts/2024-09-07-KANS-Study-Week2/";
this.page.identifier = "/posts/KANS Study - Week2";
};
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
      </div>

<!--      <div class="adsbygoogle-side">-->
<!--        &lt;!&ndash; ad_side &ndash;&gt;-->
<!--        <ins class="adsbygoogle "-->
<!--             style="display: block"-->
<!--             data-ad-client="ca-pub-6564723532026864"-->
<!--             data-ad-slot="1339398797"-->
<!--             data-ad-format="auto"-->
<!--             data-full-width-responsive="true"></ins>-->
<!--      </div>-->
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Sweet Little Bird</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Sweet Little Bird</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/sweetlittlebird"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sweetlittlebird</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>ê³µë¶€ ê¸°ë¡ê³¼ ê°œë°œ ì´ì•¼ê¸°ë¥¼ ë‹´ì€ ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.</p>
      </div>
    </div>

  </div>

</footer>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
      <!-- Background of PhotoSwipe. 
           It's a separate element as animating opacity is faster than rgba(). -->
      <div class="pswp__bg"></div>
      <!-- Slides wrapper with overflow:hidden. -->
      <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
          <div class="pswp__top-bar">
            <!--  Controls are self-explanatory. Order can be changed. -->
            <div class="pswp__counter"></div>
            <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
            <button class="pswp__button pswp__button--share" title="Share"></button>
            <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
            <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
            <!-- element will get class pswp__preloader--active when preloader is running -->
            <div class="pswp__preloader">
              <div class="pswp__preloader__icn">
                <div class="pswp__preloader__cut">
                  <div class="pswp__preloader__donut"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
            <div class="pswp__share-tooltip"></div>
          </div>
          <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
          </button>
          <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
          </button>
          <div class="pswp__caption">
            <div class="pswp__caption__center"></div>
          </div>
        </div>
      </div>
    </div>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EWGY9N8QXY"></script>

    
    <script async src="/assets/dist/app.min.js"></script>
    
  
    <a href="#" id="back-to-top"><span>Back to Top</span></a>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6564723532026864" crossorigin="anonymous"></script>
    <!--<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>-->
  </body>

</html>
