<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[CI/CD] Jenkins CI/ArgoCD + K8S | Sweet Little Bird</title>
<meta name="generator" content="Jekyll v4.3.3">
<meta property="og:title" content="[CI/CD] Jenkins CI/ArgoCD + K8S">
<meta property="og:locale" content="ko">
<meta name="description" content="ì´ë²ˆ ì£¼ì—ëŠ” ArgoCDì™€ Jenkinsë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetesë¡œì˜ ë°°í¬ë¥¼ í•˜ëŠ” CI/CDë¥¼ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.">
<meta property="og:description" content="ì´ë²ˆ ì£¼ì—ëŠ” ArgoCDì™€ Jenkinsë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetesë¡œì˜ ë°°í¬ë¥¼ í•˜ëŠ” CI/CDë¥¼ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.">
<link rel="canonical" href="https://sweetlittlebird.github.io/posts/2024-12-22-CICD-Lite-Week3/">
<meta property="og:url" content="https://sweetlittlebird.github.io/posts/2024-12-22-CICD-Lite-Week3/">
<meta property="og:site_name" content="Sweet Little Bird">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-12-22T00:01:18+09:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="[CI/CD] Jenkins CI/ArgoCD + K8S">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-22T00:01:18+09:00","datePublished":"2024-12-22T00:01:18+09:00","description":"ì´ë²ˆ ì£¼ì—ëŠ” ArgoCDì™€ Jenkinsë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetesë¡œì˜ ë°°í¬ë¥¼ í•˜ëŠ” CI/CDë¥¼ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.","headline":"[CI/CD] Jenkins CI/ArgoCD + K8S","mainEntityOfPage":{"@type":"WebPage","@id":"https://sweetlittlebird.github.io/posts/2024-12-22-CICD-Lite-Week3/"},"url":"https://sweetlittlebird.github.io/posts/2024-12-22-CICD-Lite-Week3/"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/dist/photoswipe.min.css">
  <link rel="stylesheet" href="/assets/dist/main.min.css">
  <link rel="stylesheet" href="/assets/dist/main_dark.min.css" media="(prefers-color-scheme: dark)">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pretendard/1.3.9/static/pretendard.css" integrity="sha512-NzqTHTrO48HsIamogmIaVhTXoSgRF24Cn+ynrNYrFuKrY0AdDbmcNieiOHsQARS/r0Gax9VwV3/rVMHs3ipUlg==" crossorigin="anonymous" referrerpolicy="no-referrer">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!--  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&display=swap" rel="stylesheet">-->
  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&amp;family=Milonga&amp;display=swap" rel="stylesheet">

  <link rel="shortcut icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
<link type="application/atom+xml" rel="alternate" href="https://sweetlittlebird.github.io/feed.xml" title="Sweet Little Bird">
</head>
<body class="body--contents">
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Sweet Little Bird</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/about/">ì†Œê°œ</a><a class="page-link" href="/posts/">ê¸€ ëª©ë¡</a>
</div>
      </nav>
</div>
  
  <span id="scroll-indicator"></span>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[CI/CD] Jenkins CI/ArgoCD + K8S</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-12-22T00:01:18+09:00" itemprop="datePublished">2024ë…„ 12ì›” 22ì¼ì— ì‘ì„±
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="table-of-content">
      <header>ëª©ì°¨</header>
      <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">ë“¤ì–´ê°€ë©°</a></li>
<li class="toc-entry toc-h2">
<a href="#jenkins-ciargocd--k8s">Jenkins CI/ArgoCD + K8S</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#%EC%8B%A4%EC%8A%B5%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1">ì‹¤ìŠµí™˜ê²½ êµ¬ì„±</a>
<ul>
<li class="toc-entry toc-h4"><a href="#jenkins-gogs-%EC%84%A4%EC%B9%98">Jenkins, Gogs ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h4"><a href="#jenkins-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%B4%88%EA%B8%B0%EC%84%A4%EC%A0%95">Jenkins ì»¨í…Œì´ë„ˆ ì´ˆê¸°ì„¤ì •</a></li>
<li class="toc-entry toc-h4"><a href="#gogs-%EC%B4%88%EA%B8%B0-%EC%84%A4%EC%A0%95">Gogs ì´ˆê¸° ì„¤ì •</a></li>
<li class="toc-entry toc-h4"><a href="#%EB%8F%84%EC%BB%A4-%ED%97%88%EB%B8%8C--%EC%84%A4%EC%A0%95">ë„ì»¤ í—ˆë¸Œ  ì„¤ì •</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#jenkins-ci--k8s-kind">Jenkins CI + K8S (Kind)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#kind-%EC%86%8C%EA%B0%9C-%EB%B0%8F-%EC%84%A4%EC%B9%98">Kind ì†Œê°œ ë° ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h4"><a href="#kind%EB%A1%9C-kubernetes-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EB%B0%B0%ED%8F%AC---3%EB%85%B8%EB%93%9C">Kindë¡œ Kubernetes í´ëŸ¬ìŠ¤í„° ë°°í¬ - 3ë…¸ë“œ</a></li>
<li class="toc-entry toc-h4"><a href="#jenkins-%EC%84%A4%EC%A0%95--plugin-%EC%84%A4%EC%B9%98-%EC%9E%90%EA%B2%A9%EC%A6%9D%EB%AA%85-%EC%84%A4%EC%A0%95">Jenkins ì„¤ì • : Plugin ì„¤ì¹˜, ìê²©ì¦ëª… ì„¤ì •</a></li>
<li class="toc-entry toc-h4"><a href="#kubernetes-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%EC%97%90-%EC%9D%91%EC%9A%A9%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0">Kubernetes í´ëŸ¬ìŠ¤í„°ì— ì‘ìš©í”„ë¡œê·¸ë¨ ë°°í¬í•˜ê¸°</a></li>
<li class="toc-entry toc-h4"><a href="#k8s%EC%97%90-docker-hub-%EC%9D%B8%EC%A6%9D%ED%86%A0%ED%81%B0-%EB%93%B1%EB%A1%9D-%ED%9B%84-%EB%8B%A4%EC%8B%9C-%EB%B0%B0%ED%8F%AC">K8Sì— Docker Hub ì¸ì¦í† í° ë“±ë¡ í›„ ë‹¤ì‹œ ë°°í¬</a></li>
<li class="toc-entry toc-h4"><a href="#gogs-webhook%EC%9D%84-%ED%86%B5%ED%95%B4-jenkins-pipeline-%EC%9E%90%EB%8F%99%ED%99%94">Gogs Webhookì„ í†µí•´ Jenkins Pipeline ìë™í™”</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#jenkins-cicd--k8s-kind">Jenkins CI/CD + K8S (Kind)</a></li>
<li class="toc-entry toc-h3">
<a href="#jenkins-ci--argocd--k8s-kind">Jenkins CI + ArgoCD + K8S (Kind)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#argocd-%EC%86%8C%EA%B0%9C">ArgoCD ì†Œê°œ</a></li>
<li class="toc-entry toc-h4"><a href="#argocd-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EA%B8%B0%EB%B3%B8%EC%84%A4%EC%A0%95">ArgoCD ì„¤ì¹˜ ë° ê¸°ë³¸ì„¤ì •</a></li>
<li class="toc-entry toc-h4"><a href="#helm-chart%EB%A5%BC-%ED%86%B5%ED%95%9C-%EB%B0%B0%ED%8F%AC-%EC%8B%A4%EC%8A%B5">Helm chartë¥¼ í†µí•œ ë°°í¬ ì‹¤ìŠµ</a></li>
<li class="toc-entry toc-h4"><a href="#argocd-declarative-setup%EC%9C%BC%EB%A1%9C-%EB%B0%B0%ED%8F%AC-%EC%8B%A4%EC%8A%B5">ArgoCD Declarative Setupìœ¼ë¡œ ë°°í¬ ì‹¤ìŠµ</a></li>
<li class="toc-entry toc-h4"><a href="#argocd%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-full-cicd-%EA%B5%AC%EC%84%B1">ArgoCDë¥¼ ì´ìš©í•œ Full CI/CD êµ¬ì„±</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#argo-rollout--k8skind">Argo Rollout + K8S(Kind)</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">ë§ˆì¹˜ë©°</a></li>
</ul>
    </div>
    <h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì´ë²ˆ ì£¼ì—ëŠ” ArgoCDì™€ Jenkinsë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetesë¡œì˜ ë°°í¬ë¥¼ í•˜ëŠ” CI/CDë¥¼ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="jenkins-ciargocd--k8s">Jenkins CI/ArgoCD + K8S</h2>

<h3 id="ì‹¤ìŠµí™˜ê²½-êµ¬ì„±">ì‹¤ìŠµí™˜ê²½ êµ¬ì„±</h3>

<ul>
  <li>ì´ë²ˆì—ëŠ” ê°œë°œ PCì— Jenkinsì™€ Gogsë¥¼ ì„¤ì¹˜í•˜ê³ , Kindë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ê³  ArgoCDë¥¼ ì„¤ì¹˜í•˜ì—¬ CI/CDë¥¼ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<h4 id="jenkins-gogs-ì„¤ì¹˜">Jenkins, Gogs ì„¤ì¹˜</h4>

<ul>
  <li>Jenkinsì˜ ê²½ìš° 1ì£¼ì°¨ì—ì„œ ì„¤ì¹˜í•˜ì˜€ì§€ë§Œ ë‹¤ì‹œ í•œë²ˆ ë˜ì§šì–´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ë˜í•œ ì´ë²ˆì—ëŠ” Gitlab í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ëŒ€ì‹ , ìì²´ PCì— Gogsë¥¼ ì„¤ì¹˜í•˜ì—¬ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„± í›„ ì´ë™</span>
<span class="nv">$ </span><span class="nb">mkdir </span>cicd-labs
<span class="nv">$ </span><span class="nb">cd </span>cicd-labs

<span class="c"># </span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh"> &gt; docker-compose.yaml
services:

  jenkins:
    container_name: jenkins
    image: jenkins/jenkins
    restart: unless-stopped
    networks:
      - cicd-network
    ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - jenkins_home:/var/jenkins_home

  gogs:
    container_name: gogs
    image: gogs/gogs
    restart: unless-stopped
    networks:
      - cicd-network
    ports:
      - "10022:22"
      - "3000:3000"
    volumes:
      - gogs-data:/data

volumes:
  jenkins_home:
  gogs-data:

networks:
  cicd-network:
    driver: bridge
</span><span class="no">EOT


</span><span class="c"># ë°°í¬</span>
<span class="nv">$ </span>docker compose up <span class="nt">-d</span>
<span class="c"># =&gt; [+] Running 2/2</span>
<span class="c">#     â ¿ Container jenkins  Started  0.5s</span>
<span class="c">#     â ¿ Container gogs     Started  0.5s</span>
<span class="nv">$ </span>docker compose ps
<span class="c"># =&gt; NAME                COMMAND                  SERVICE             STATUS              PORTS</span>
<span class="c">#    gogs                &amp;quot;/app/gogs/docker/stâ€¦&amp;quot;   gogs                running (healthy)   0.0.0.0:10022-&amp;gt;22/tcp, 0.0.0.0:3000-&amp;gt;3000/tcp</span>
<span class="c">#    jenkins             &amp;quot;/usr/bin/tini -- /uâ€¦&amp;quot;   jenkins             running             0.0.0.0:8080-&amp;gt;8080/tcp, 0.0.0.0:50000-&amp;gt;50000/tcp</span>

<span class="c"># ê¸°ë³¸ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in </span>gogs jenkins <span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"&gt;&gt; container : </span><span class="nv">$i</span><span class="s2"> &lt;&lt;"</span><span class="p">;</span> docker compose <span class="nb">exec</span> <span class="nv">$i</span> sh <span class="nt">-c</span> <span class="s2">"whoami &amp;&amp; pwd"</span><span class="p">;</span> <span class="nb">echo</span><span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; &amp;gt;&amp;gt; container : gogs &amp;lt;&amp;lt;</span>
<span class="c">#    root</span>
<span class="c">#    /app/gogs</span>
<span class="c">#    </span>
<span class="c">#    &amp;gt;&amp;gt; container : jenkins &amp;lt;&amp;lt;</span>
<span class="c">#    jenkins</span>
<span class="c">#    /</span>

<span class="c"># ë„ì»¤ë¥¼ ì´ìš©í•˜ì—¬ ê° ì»¨í…Œì´ë„ˆë¡œ ì ‘ì†</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>jenkins bash
<span class="nv">$ </span><span class="nb">exit</span>

<span class="nv">$ </span>docker compose <span class="nb">exec </span>gogs bash
<span class="nv">$ </span><span class="nb">exit</span>
</code></pre></div></div>

<h4 id="jenkins-ì»¨í…Œì´ë„ˆ-ì´ˆê¸°ì„¤ì •">Jenkins ì»¨í…Œì´ë„ˆ ì´ˆê¸°ì„¤ì •</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Jenkins ì´ˆê¸° ì•”í˜¸ í™•ì¸</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>jenkins <span class="nb">cat</span> /var/jenkins_home/secrets/initialAdminPassword
<span class="c"># =&gt; 3da38dccc7d14d1a8bee4b02c4e09da8</span>

<span class="c"># Jenkins ì›¹ ì ‘ì† ì£¼ì†Œ í™•ì¸ : ê³„ì • / ì•”í˜¸ ì…ë ¥ &gt;&gt; **admin / qwe123**</span>
<span class="nv">$ </span>open <span class="s2">"http://127.0.0.1:8080"</span> <span class="c"># macOS</span>

<span class="c"># (ì°¸ê³ ) ë¡œê·¸ í™•ì¸ : í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ê³¼ì • í™•ì¸</span>
<span class="nv">$ </span>docker compose logs jenkins <span class="nt">-f</span>

<span class="c"># IP í™•ì¸ (MacOS ê¸°ì¤€)</span>
<span class="nv">$ </span>ifconfig | <span class="nb">grep</span> <span class="s2">"inet "</span> | <span class="nb">grep</span> <span class="nt">-v</span> 127.0.0
<span class="c"># =&gt; inet &lt;span style="color: red;"&gt;10.0.4.3&lt;/span&gt; netmask 0xffffff00 broadcast 10.0.4.255</span>
<span class="c"># ë˜ëŠ”</span>
<span class="nv">$ </span>ipconfig getifaddr en0
<span class="c"># =&gt; &lt;span style="color: red;"&gt;10.0.4.3&lt;/span&gt;</span>
</code></pre></div></div>

<ul>
  <li>Jenkins URL ì„¤ì •</li>
</ul>

<p>ì•ì„œ í™•ì¸í•œ IP ì£¼ì†Œë¥¼ ì´ìš©í•˜ì—¬ Jenkins URLì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_1.png" alt="img.png" loading="lazy" width="1078" height="636"></p>

<ul>
  <li>1ì£¼ì°¨ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ Docker-out-of-Dockerë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ <a href="https://sweetlittlebird.github.io/posts/2024-12-08-CICD-Lite-Week1/#jenkins-%EC%86%8C%EA%B0%9C">1ì£¼ì°¨ ë‚´ìš©</a>ì„ ì°¸ê³ í•˜ì„¸ìš”.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ë„ì»¤ ì‹¤í–‰ íŒŒì¼ ì„¤ì¹˜</span>
<span class="nv">$ </span>docker compose <span class="nb">exec</span> <span class="nt">--privileged</span> <span class="nt">-u</span> root jenkins bash
<span class="nt">-----------------------------------------------------</span>
<span class="nv">$ </span><span class="nb">id</span>

<span class="nv">$ </span>curl <span class="nt">-fsSL</span> https://download.docker.com/linux/debian/gpg <span class="nt">-o</span> /etc/apt/keyrings/docker.asc
<span class="c"># =&gt; uid=0(root) gid=0(root) groups=0(root)</span>
<span class="nv">$ </span><span class="nb">chmod </span>a+r /etc/apt/keyrings/docker.asc
<span class="nv">$ </span><span class="nb">echo</span> <span class="se">\</span>
  <span class="s2">"deb [arch=</span><span class="si">$(</span>dpkg <span class="nt">--print-architecture</span><span class="si">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian </span><span class="se">\</span><span class="s2">
  </span><span class="si">$(</span><span class="nb">.</span> /etc/os-release <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$VERSION_CODENAME</span><span class="s2">"</span><span class="si">)</span><span class="s2"> stable"</span> | <span class="se">\</span>
  <span class="nb">tee</span> /etc/apt/sources.list.d/docker.list <span class="o">&gt;</span> /dev/null
<span class="nv">$ </span>apt-get update <span class="o">&amp;&amp;</span> apt <span class="nb">install </span>docker-ce-cli curl tree jq yq <span class="nt">-y</span>

<span class="nv">$ </span>docker info
<span class="c"># =&gt; Client: Docker Engine - Community</span>
<span class="c">#     Version:    27.4.1</span>
<span class="c">#     Context:    default</span>
<span class="c">#     Debug Mode: false</span>
<span class="c">#     Plugins:</span>
<span class="c">#      buildx: Docker Buildx (Docker Inc.)</span>
<span class="c">#        Version:  v0.19.3</span>
<span class="c">#        Path:     /usr/libexec/docker/cli-plugins/docker-buildx</span>
<span class="c">#      compose: Docker Compose (Docker Inc.)</span>
<span class="c">#        Version:  v2.32.1</span>
<span class="c">#        Path:     /usr/libexec/docker/cli-plugins/docker-compose</span>
<span class="c">#    </span>
<span class="c">#    Server:</span>
<span class="c">#     Containers: 29</span>
<span class="c">#      Running: 2</span>
<span class="c">#      Paused: 0</span>
<span class="c">#      Stopped: 27</span>
<span class="c">#     Images: 42</span>
<span class="c">#     Server Version: 20.10.12</span>
<span class="c">#     Storage Driver: overlay2</span>
<span class="c">#      Backing Filesystem: extfs</span>
<span class="c">#      Supports d_type: true</span>
<span class="c">#      Native Overlay Diff: true</span>
<span class="c">#      userxattr: false</span>
<span class="c">#     Logging Driver: json-file</span>
<span class="c">#     Cgroup Driver: cgroupfs</span>
<span class="c">#     Cgroup Version: 2</span>
<span class="c">#     ...</span>
<span class="c">#     Insecure Registries:</span>
<span class="c">#      hubproxy.docker.internal:5000</span>
<span class="c">#      127.0.0.0/8</span>
<span class="c">#     Live Restore Enabled: false</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE             COMMAND                  CREATED        STATUS                    PORTS                                              NAMES</span>
<span class="c">#    110494b9ca48   gogs/gogs         &amp;quot;/app/gogs/docker/stâ€¦&amp;quot;   14 hours ago   Up 37 minutes (healthy)   0.0.0.0:3000-&amp;gt;3000/tcp, 0.0.0.0:10022-&amp;gt;22/tcp      gogs</span>
<span class="c">#    8b7c591c828d   jenkins/jenkins   &amp;quot;/usr/bin/tini -- /uâ€¦&amp;quot;   14 hours ago   Up 37 minutes             0.0.0.0:8080-&amp;gt;8080/tcp, 0.0.0.0:50000-&amp;gt;50000/tcp   jenkins</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ DooDì´ê¸° ë•Œë¬¸ì— í˜¸ìŠ¤íŠ¸ì—ì„œ ë™ì‘ì¤‘ì¸ ì»¨í…Œì´ë„ˆê°€ ë³´ì…ë‹ˆë‹¤.&lt;/span&gt;</span>
<span class="nv">$ </span>which docker
<span class="c"># =&gt; /usr/bin/docker</span>

<span class="c"># Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ rootê°€ ì•„ë‹Œ jenkins ìœ ì €ë„ dockerë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ë¶€ì—¬</span>
<span class="nv">$ </span>groupadd <span class="nt">-g</span> 2000 <span class="nt">-f</span> docker  <span class="c"># macOS(Container)</span>
<span class="c"># $ groupadd -g 1001 -f docker  # Windows WSL2(Container) &gt;&gt; cat /etc/group ì—ì„œ docker ê·¸ë£¹IDë¥¼ ì§€ì •</span>

<span class="nv">$ </span><span class="nb">chgrp </span>docker /var/run/docker.sock
<span class="nv">$ </span><span class="nb">chmod </span>g+w /var/run/docker.sock
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /var/run/docker.sock
<span class="c"># =&gt; srwxrwxr-x 1 root docker 0 Oct 01 06:03 /var/run/docker.sock</span>
<span class="nv">$ </span>usermod <span class="nt">-aG</span> docker jenkins
<span class="nv">$ </span><span class="nb">cat</span> /etc/group | <span class="nb">grep </span>docker
<span class="c"># =&gt; docker:x:2000:jenkins</span>

<span class="nb">exit</span>
<span class="nt">--------------------------------------------</span>

<span class="c"># jenkins item ì‹¤í–‰ ì‹œ docker ëª…ë ¹ ì‹¤í–‰ ê¶Œí•œ ì—ëŸ¬ ë°œìƒ : Jenkins ì»¨í…Œì´ë„ˆ ì¬ê¸°ë™ìœ¼ë¡œ ìœ„ ì„¤ì • ë‚´ìš©ì„ Jenkins app ì—ë„ ì ìš© í•„ìš”</span>
<span class="nv">$ </span>docker compose restart jenkins
<span class="c"># =&gt; [+] Running 1/1</span>
<span class="c">#     â ¿ Container jenkins  Started    0.9s</span>
<span class="c"># $ sudo docker compose restart jenkins  # Windows ê²½ìš° ì´í›„ë¶€í„° sudo ë¶™ì—¬ì„œ ì‹¤í–‰í•˜ì</span>

<span class="c"># jenkins userë¡œ docker ëª…ë ¹ ì‹¤í–‰ í™•ì¸</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>jenkins <span class="nb">id</span>
<span class="c"># =&gt; uid=1000(jenkins) gid=1000(jenkins) groups=1000(jenkins),2000(docker)</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>jenkins docker info
<span class="c"># =&gt; Client: Docker Engine - Community</span>
<span class="c">#     Version:    27.4.1</span>
<span class="c">#     ...</span>
<span class="c">#    </span>
<span class="c">#    Server:</span>
<span class="c">#     Containers: 29</span>
<span class="c">#      Running: 2</span>
<span class="c">#      Paused: 0</span>
<span class="c">#      Stopped: 27</span>
<span class="c">#     Images: 42</span>
<span class="c">#     Server Version: 20.10.12</span>
<span class="c">#     ...</span>
<span class="c">#     Live Restore Enabled: false</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>jenkins docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE             COMMAND                  CREATED        STATUS                    PORTS                                              NAMES</span>
<span class="c">#    110494b9ca48   gogs/gogs         &amp;quot;/app/gogs/docker/stâ€¦&amp;quot;   14 hours ago   Up 41 minutes (healthy)   0.0.0.0:3000-&amp;gt;3000/tcp, 0.0.0.0:10022-&amp;gt;22/tcp      gogs</span>
<span class="c">#    8b7c591c828d   jenkins/jenkins   &amp;quot;/usr/bin/tini -- /uâ€¦&amp;quot;   14 hours ago   Up 57 seconds             0.0.0.0:8080-&amp;gt;8080/tcp, 0.0.0.0:50000-&amp;gt;50000/tcp   jenkins</span>
</code></pre></div></div>

<ul>
  <li>OS ì¬ë¶€íŒ…ì‹œì— jenkins ì»¨í…Œì´ë„ˆì—ì„œ docker ì‹¤í–‰ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ ìˆëŠ”ë°, ê·¸ëŸ´ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ docker ê·¸ë£¹ì„ ë‹¤ì‹œ ì§€ì •í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì†Œì¼“ íŒŒì¼ì˜ ê¶Œí•œ í™•ì¸</span>
<span class="nv">$ </span>docker compose <span class="nb">exec</span> <span class="nt">--privileged</span> <span class="nt">-u</span> root jenkins <span class="nb">ls</span> <span class="nt">-l</span> /var/run/docker.sock
<span class="c"># =&gt; srwxr-xr-x 1 root root 0 Oct 01 05:22 /var/run/docker.sock</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ê·¸ë£¹ì´ rootë¡œ ë³µêµ¬ë˜ì–´ìˆìŠµë‹ˆë‹¤. docker ê·¸ë£¹ìœ¼ë¡œ ë‹¤ì‹œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.&lt;/span&gt;</span>

<span class="c"># ì†Œì¼“ íŒŒì¼ì— docker ê·¸ë£¹ì„ ë‹¤ì‹œ ì§€ì •</span>
<span class="nv">$ </span>docker compose <span class="nb">exec</span> <span class="nt">--privileged</span> <span class="nt">-u</span> root jenkins <span class="nb">chgrp </span>docker /var/run/docker.sock

<span class="c"># ì†Œì¼“ íŒŒì¼ì— docker ê·¸ë£¹ ì“°ê¸°ê¶Œí•œ ë‹¤ì‹œ ì§€ì •</span>
<span class="nv">$ </span>docker compose <span class="nb">exec</span> <span class="nt">--privileged</span> <span class="nt">-u</span> root jenkins <span class="nb">chmod </span>g+w /var/run/docker.sock

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>docker compose <span class="nb">exec</span> <span class="nt">--privileged</span> <span class="nt">-u</span> root jenkins <span class="nb">ls</span> <span class="nt">-l</span> /var/run/docker.sock
<span class="c"># =&gt; srwxrwxr-x 1 root docker 0 Oct 01 05:22 /var/run/docker.sock</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>jenkins docker info
</code></pre></div></div>

<h4 id="gogs-ì´ˆê¸°-ì„¤ì •">Gogs ì´ˆê¸° ì„¤ì •</h4>

<ul>
  <li>ì´ˆê¸°ì„¤ì •ì„ ìœ„í•´ ì›¹ ì ‘ì†ì„ í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì´ˆê¸° ì„¤ì • ì›¹ ì ‘ì†</span>
<span class="nv">$ </span>open <span class="s2">"http://127.0.0.1:3000/install"</span> <span class="c"># macOS</span>
<span class="c"># ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ http://127.0.0.1:3000/install ì ‘ì† # Windows</span>
</code></pre></div></div>

<ul>
  <li>ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •ê°’ì„ ë³€ê²½í•©ë‹ˆë‹¤.
    <ul>
      <li>Database Type : SQLite3</li>
      <li>Application URL : <code class="language-plaintext highlighter-rouge">http://&lt;ì•ì—ì„œ í™•ì¸í•œ IP&gt;:3000/</code>
</li>
      <li>Default Branch : main</li>
      <li>ê´€ë¦¬ì ê³„ì • ì„¤ì • í´ë¦­ : username : devops, password : qwe123, emailì…ë ¥
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_2.png" alt="img.png" loading="lazy" width="1078" height="974">
</li>
    </ul>
  </li>
  <li>Install Gogs ë²„íŠ¼ í´ë¦­ =&gt; ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</li>
</ul>

<h5 id="access-token-ë°œí–‰">Access Token ë°œí–‰</h5>

<ul>
  <li>ë¡œê·¸ì¸ í›„ Your Settings &gt; Applications &gt; Generate New Token í´ë¦­ &gt; Token Name(devops) &gt; Generate Token í´ë¦­í•˜ì—¬ í† í°ì„ ë°œí–‰í•©ë‹ˆë‹¤.</li>
  <li>ë°œí–‰ëœ í† í°(<code class="language-plaintext highlighter-rouge">a85f33b7fd28ac1ed83c3233fc4ca3a67c04c296</code>)ì„ ë³µì‚¬í•˜ì—¬ ì•ˆì „í•œ ê³³ì— ê¸°ë¡í•´ë‘¡ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_3.png" alt="img.png" loading="lazy" width="1302" height="717"></p>

<h5 id="repository-ìƒì„±">Repository ìƒì„±</h5>

<ul>
  <li>ìš°ì¸¡ìƒë‹¨ì˜ <code class="language-plaintext highlighter-rouge">+</code> ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‚˜ì˜¤ëŠ” ë©”ë‰´ì—ì„œ New Repositoryë¥¼ í´ë¦­í•´ì„œ ìƒˆë¡œìš´ Repositoryë¥¼ ë‹¤ìŒê³¼ ê°™ì´ 2ê°œ ìƒì„±í•©ë‹ˆë‹¤.</li>
  <li>
<strong>ê°œë°œíŒ€ìš©</strong>
    <ul>
      <li>Repository Name : <strong>dev-app</strong>
</li>
      <li>Visibility : (<strong>Check</strong>) This repository is <strong>Private</strong>
</li>
      <li>.gitignore : <strong>Python</strong>
</li>
      <li>Readme : Default â†’ (Check) initialize this repository with selected files and template</li>
    </ul>

    <p>â‡’ Create Repository í´ë¦­ =&gt; Repo ì£¼ì†Œ í™•ì¸ (<code class="language-plaintext highlighter-rouge">http://10.0.4.3:3000/devops/dev-apps.git</code>)</p>
  </li>
  <li>
<strong>ë°ë¸Œì˜µìŠ¤íŒ€ìš©</strong>
    <ul>
      <li>Repository Name : <strong>ops-deploy</strong>
</li>
      <li>Visibility : (<strong>ì²´í¬</strong>) This repository is <strong>Private</strong>
</li>
      <li>Readme : Default â†’ (ì²´í¬) initialize this repository with selected files and template</li>
    </ul>

    <p>â‡’ Create Repository í´ë¦­ =&gt; Repo ì£¼ì†Œ í™•ì¸ (<code class="language-plaintext highlighter-rouge">http://10.0.4.3:3000/devops/ops-deploy.git</code>)</p>
  </li>
</ul>

<h5 id="gogs-ì‹¤ìŠµì„-ìœ„í•´-í˜¸ìŠ¤íŠ¸-pcì˜-git-ì„¤ì •">Gogs ì‹¤ìŠµì„ ìœ„í•´ í˜¸ìŠ¤íŠ¸ PCì˜ git ì„¤ì •</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># (ì˜µì…˜) GIT ì¸ì¦ ì •ë³´ ì´ˆê¸°í™”</span>
<span class="nv">$ </span>git credential-cache <span class="nb">exit</span>

<span class="c">#</span>
<span class="c"># $ git clone &lt;ê°ì Gogs dev-app repo ì£¼ì†Œ&gt;</span>
<span class="nv">$ </span>git clone http://10.0.4.3:3000/devops/dev-app.git
<span class="c"># =&gt; Cloning into 'dev-app'...</span>
<span class="c">#    Username for 'http://10.0.4.3:3000': devops</span>
<span class="c">#    Password for 'http://a@10.0.4.3:3000': # &lt;span style="color: green;"&gt;ì•ì„œ ë°œê¸‰ë°›ì€ access key ì…ë ¥&lt;/span&gt;</span>

<span class="c">#    remote: Enumerating objects: 4, done.</span>
<span class="c">#    remote: Counting objects: 100% (4/4), done.</span>
<span class="c">#    remote: Compressing objects: 100% (3/3), done.</span>
<span class="c">#    remote: Total 4 (delta 0), reused 0 (delta 0), pack-reused 0</span>
<span class="c">#    Unpacking objects: 100% (4/4), 705 bytes | 352.00 KiB/s, done.</span>

<span class="c">#</span>
<span class="nv">$ </span><span class="nb">cd </span>dev-app

<span class="c">#</span>
<span class="nv">$ </span>git config user.name <span class="s2">"devops"</span>
<span class="nv">$ </span>git config user.email <span class="s2">"a@a.com"</span>
<span class="nv">$ </span>git config init.defaultBranch main
<span class="nv">$ </span>git config credential.helper store

<span class="c">#</span>
<span class="nv">$ </span>git branch
<span class="c"># =&gt; * main</span>
<span class="nv">$ </span>git remote <span class="nt">-v</span>
<span class="c"># =&gt; origin  http://10.0.4.3:3000/devops/dev-app.git (fetch)</span>
<span class="c">#    origin  http://10.0.4.3:3000/devops/dev-app.git (push)</span>

<span class="c"># server.py íŒŒì¼ ì‘ì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> server.py <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
from http.server import ThreadingHTTPServer, BaseHTTPRequestHandler
from datetime import datetime
import socket

class RequestHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header('Content-type', 'text/plain')
        self.end_headers()
        
        now = datetime.now()
        hostname = socket.gethostname()
        response_string = now.strftime("The time is %-I:%M:%S %p, VERSION 0.0.1</span><span class="se">\n</span><span class="sh">")
        response_string += f"Server hostname: {hostname}</span><span class="se">\n</span><span class="sh">"
        self.wfile.write(bytes(response_string, "utf-8")) 

def startServer():
    try:
        server = ThreadingHTTPServer(('', 80), RequestHandler)
        print("Listening on " + ":".join(map(str, server.server_address)))
        server.serve_forever()
    except KeyboardInterrupt:
        server.shutdown()

if __name__ == "__main__":
    startServer()
</span><span class="no">EOF

</span><span class="c"># Dockerfile ìƒì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> Dockerfile <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
FROM python:3.12
ENV PYTHONUNBUFFERED 1
COPY . /app
WORKDIR /app 
CMD python3 server.py
</span><span class="no">EOF

</span><span class="c"># VERSION íŒŒì¼ ìƒì„±</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"0.0.1"</span> <span class="o">&gt;</span> VERSION

<span class="c">#</span>
<span class="nv">$ </span>git status
<span class="c"># =&gt; On branch main</span>
<span class="c">#    Your branch is up to date with 'origin/main'.</span>
<span class="c">#    </span>
<span class="c">#    Untracked files:</span>
<span class="c">#      (use &amp;quot;git add &amp;lt;file&amp;gt;...&amp;quot; to include in what will be committed)</span>
<span class="c">#            Dockerfile</span>
<span class="c">#            VERSION</span>
<span class="c">#            server.py</span>
<span class="c">#    </span>
<span class="c">#    nothing added to commit but untracked files present (use &amp;quot;git add&amp;quot; to track)</span>
<span class="nv">$ </span>git add <span class="nb">.</span>
<span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"Add dev-app"</span>
<span class="c"># =&gt; [main 3531233] Add dev-app</span>
<span class="c">#     3 files changed, 32 insertions(+)</span>
<span class="c">#     create mode 100644 Dockerfile</span>
<span class="c">#     create mode 100644 VERSION</span>
<span class="c">#     create mode 100644 server.py</span>
<span class="nv">$ </span>git push <span class="nt">-u</span> origin main
<span class="c"># =&gt; Enumerating objects: 6, done.</span>
<span class="c">#    Counting objects: 100% (6/6), done.</span>
<span class="c">#    Delta compression using up to 8 threads</span>
<span class="c">#    Compressing objects: 100% (4/4), done.</span>
<span class="c">#    Writing objects: 100% (5/5), 900 bytes | 900.00 KiB/s, done.</span>
<span class="c">#    Total 5 (delta 0), reused 0 (delta 0), pack-reused 0</span>
<span class="c">#    To http://10.0.4.3:3000/devops/dev-app.git</span>
<span class="c">#       5c906c3..3531233  main -&amp;gt; main</span>
<span class="c">#    branch 'main' set up to track 'origin/main'.</span>
</code></pre></div></div>

<ul>
  <li>Gogs Repoì—ì„œ í™•ì¸
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_4.png" alt="img.png" loading="lazy" width="999" height="304">
</li>
</ul>

<h4 id="ë„ì»¤-í—ˆë¸Œ--ì„¤ì •">ë„ì»¤ í—ˆë¸Œ  ì„¤ì •</h4>

<ul>
  <li>ë„ì»¤ í—ˆë¸Œì— ë¡œê·¸ì¸í•˜ì—¬ dev-appì´ë¼ëŠ” Repositoryë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë„ì»¤í—ˆë¸Œ ì†Œê°œì™€ Repository ìƒì„±ì€ <a href="https://sweetlittlebird.github.io/posts/2024-12-08-CICD-Lite-Week1/#docker-hub-%EC%86%8C%EA%B0%9C">1ì£¼ì°¨ ë‚´ìš©</a>ì„ ì°¸ê³ í•˜ì„¸ìš”.</li>
  <li>ë°°í¬ë¥¼ í¸í•˜ê²Œ í•˜ê¸°ìœ„í•´ Tokenë„ ë°œê¸‰í•˜ì—¬ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.
    <ol>
      <li>ê³„ì • &gt; Account Settings &gt; Security í´ë¦­
  <img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_5.png" alt="img.png" class="image-center" loading="lazy" width="364" height="423">
</li>
      <li>New Access Token í´ë¦­
        <ul>
          <li>Token Name : devops</li>
          <li>Expireation date : ë§Œë£Œì¼ì„ ì ì ˆíˆ ì„ íƒí•©ë‹ˆë‹¤.</li>
          <li>ê¶Œí•œì€ Read, Write, Deleteë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</li>
          <li>Create í´ë¦­í•˜ì—¬ í† í°ì„ ìƒì„±í•˜ê³ , ë°œê¸‰ëœ í† í°ì„ ë³µì‚¬í•˜ì—¬ ì•ˆì „í•œ ê³³ì— ì €ì¥í•©ë‹ˆë‹¤.
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_6.png" alt="img.png" class="image-center" loading="lazy" width="1054" height="283">
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_7.png" alt="img_1.png" class="image-center" loading="lazy" width="648" height="390">
</li>
          <li>ë°œê¸‰ëœ í† í° : <code class="language-plaintext highlighter-rouge">dckr_****</code>
</li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<hr>

<h3 id="jenkins-ci--k8s-kind">Jenkins CI + K8S (Kind)</h3>

<h4 id="kind-ì†Œê°œ-ë°-ì„¤ì¹˜">Kind ì†Œê°œ ë° ì„¤ì¹˜</h4>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_8.png" alt="img.png" class="w-20 image-center" loading="lazy" width="985" height="594"></p>

<ul>
  <li>KindëŠ” Kubernetes in Dockerì˜ ì¤„ì„ë§ë¡œ, ë¡œì»¬ í™˜ê²½ì—ì„œ ì‰½ê²Œ Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.</li>
  <li>ì´ë¦„ì²˜ëŸ¼ Dockerë¥¼ ì´ìš©í•˜ì—¬ Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ë©°, Dockerë¥¼ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>KindëŠ” HAë¥¼ í¬í•¨í•œ ë©€í‹°ë…¸ë“œë¥¼ ì§€ì›í•˜ì§€ë§Œ, í…ŒìŠ¤íŠ¸ì™€ ì‹¤í—˜ì ì¸ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ê¸°ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.</li>
  <li>KindëŠ” í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ kubeadmì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  <li>
<a href="https://sweetlittlebird.github.io/posts/2024-09-07-KANS-Study-Week2/#kind-%EC%86%8C%EA%B0%9C-%EB%B0%8F-%EC%84%A4%EC%B9%98">Kind ì†Œê°œ ë° ì„¤ì¹˜</a>, <a href="https://kind.sigs.k8s.io/docs/user/quick-start/">Kind ê³µì‹ë¬¸ì„œ</a>
</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_9.png" alt="img.png" class="image-center" loading="lazy" width="2048" height="1152">
<em class="image-caption">Kind êµ¬ì„±ë„</em></p>

<h5 id="kind-ë°-íˆ´-ì„¤ì¹˜">Kind ë° íˆ´ ì„¤ì¹˜</h5>

<ul>
  <li>í•„ìˆ˜ íˆ´ ì„¤ì¹˜</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install Kind</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kind
<span class="nv">$ </span>kind <span class="nt">--version</span>
<span class="c"># =&gt; kind version 0.26.0</span>

<span class="c"># Install kubectl</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kubernetes-cli
<span class="nv">$ </span>kubectl version <span class="nt">--client</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># =&gt; Client Version: v1.31.0</span>
<span class="c">#    Kustomize Version: v5.4.2</span>
<span class="c">#    Kubecolor Version: v0.4.0</span>

<span class="c">## kubectl -&gt; k ë‹¨ì¶•í‚¤ ì„¤ì •</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"alias kubectl=kubecolor"</span> <span class="o">&gt;&gt;</span> ~/.zshrc

<span class="c"># Install Helm</span>
<span class="nv">$ </span>brew <span class="nb">install </span>helm
<span class="nv">$ </span>helm version
<span class="c"># =&gt; version.BuildInfo{Version:&amp;quot;v3.15.4&amp;quot;, GitCommit:&amp;quot;fa9efb07d9d8debbb4306d72af76a383895aa8c4&amp;quot;, GitTreeState:&amp;quot;clean&amp;quot;, GoVersion:&amp;quot;go1.22.6&amp;quot;}</span>
</code></pre></div></div>

<ul>
  <li>(ê¶Œì¥) ìœ ìš©í•œ íˆ´ ì„¤ì¹˜</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íˆ´ ì„¤ì¹˜</span>
<span class="nv">$ </span>brew <span class="nb">install </span>krew
<span class="nv">$ </span>brew <span class="nb">install </span>kube-ps1
<span class="nv">$ </span>brew <span class="nb">install </span>kubectx

<span class="c"># kubectl ì¶œë ¥ ì‹œ í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬</span>
<span class="nv">$ </span>brew <span class="nb">install </span>kubecolor
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"alias kubectl=kubecolor"</span> <span class="o">&gt;&gt;</span> ~/.zshrc
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"compdef kubecolor=kubectl"</span> <span class="o">&gt;&gt;</span> ~/.zshrc

<span class="c"># krew í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜</span>
<span class="nv">$ </span>kubectl krew <span class="nb">install </span>neat stren
</code></pre></div></div>

<h5 id="kind-ê¸°ë³¸-ì‚¬ìš©---í´ëŸ¬ìŠ¤í„°-ë°°í¬-ë°-í™•ì¸">Kind ê¸°ë³¸ ì‚¬ìš© - í´ëŸ¬ìŠ¤í„° ë°°í¬ ë° í™•ì¸</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ ì „ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE             COMMAND                  CREATED        STATUS                 PORTS                                              NAMES</span>
<span class="c">#    110494b9ca48   gogs/gogs         &amp;quot;/app/gogs/docker/stâ€¦&amp;quot;   19 hours ago   Up 5 hours (healthy)   0.0.0.0:3000-&amp;gt;3000/tcp, 0.0.0.0:10022-&amp;gt;22/tcp      gogs</span>
<span class="c">#    8b7c591c828d   jenkins/jenkins   &amp;quot;/usr/bin/tini -- /uâ€¦&amp;quot;   19 hours ago   Up 4 hours             0.0.0.0:8080-&amp;gt;8080/tcp, 0.0.0.0:50000-&amp;gt;50000/tcp   jenkins</span>

<span class="c"># Create a cluster with kind</span>
<span class="nv">$ </span>kind create cluster
<span class="c"># =&gt; Creating cluster &amp;quot;kind&amp;quot; ...</span>
<span class="c">#     âœ“ Ensuring node image (kindest/node:v1.32.0) ğŸ–¼</span>
<span class="c">#     âœ“ Preparing nodes ğŸ“¦</span>
<span class="c">#     âœ“ Writing configuration ğŸ“œ</span>
<span class="c">#     âœ“ Starting control-plane ğŸ•¹ï¸</span>
<span class="c">#     âœ“ Installing CNI ğŸ”Œ</span>
<span class="c">#     âœ“ Installing StorageClass ğŸ’¾</span>
<span class="c">#    Set kubectl context to &amp;quot;kind-kind&amp;quot;</span>
<span class="c">#    You can now use your cluster with:</span>
<span class="c">#    </span>
<span class="c">#    kubectl cluster-info --context kind-kind</span>
<span class="c">#    </span>
<span class="c">#    Not sure what to do next? ğŸ˜…  Check out https://kind.sigs.k8s.io/docs/user/quick-start/</span>

<span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>kind get clusters
<span class="c"># =&gt; kind</span>
<span class="nv">$ </span>kind get nodes
<span class="c"># =&gt; kind-control-plane</span>
<span class="nv">$ </span>kubectl cluster-info
<span class="c"># =&gt; Kubernetes control plane is running at https://127.0.0.1:64234</span>
<span class="c">#    CoreDNS is running at https://127.0.0.1:64234/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
<span class="c">#    </span>
<span class="c">#    To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>

<span class="c"># ë…¸ë“œ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME                 STATUS   ROLES           AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION     CONTAINER-RUNTIME</span>
<span class="c">#    kind-control-plane   Ready    control-plane   63s   v1.32.0   172.20.0.2    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.24</span>

<span class="c"># íŒŒë“œ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span>
<span class="c"># =&gt; NAMESPACE            NAME                                         READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    kube-system          coredns-668d6bf9bc-8pqmk                     1/1     Running   0          67s</span>
<span class="c">#    kube-system          coredns-668d6bf9bc-9ngw2                     1/1     Running   0          67s</span>
<span class="c">#    kube-system          etcd-kind-control-plane                      1/1     Running   0          74s</span>
<span class="c">#    kube-system          kindnet-zlwz2                                1/1     Running   0          67s</span>
<span class="c">#    kube-system          kube-apiserver-kind-control-plane            1/1     Running   0          74s</span>
<span class="c">#    kube-system          kube-controller-manager-kind-control-plane   1/1     Running   0          74s</span>
<span class="c">#    kube-system          kube-proxy-nbp2t                             1/1     Running   0          67s</span>
<span class="c">#    kube-system          kube-scheduler-kind-control-plane            1/1     Running   0          74s</span>
<span class="c">#    local-path-storage   local-path-provisioner-58cc7856b6-wl6z8      1/1     Running   0          67s</span>
<span class="nv">$ </span>kubectl get componentstatuses
<span class="c"># =&gt; NAME                 STATUS    MESSAGE   ERROR</span>
<span class="c">#    controller-manager   Healthy   ok</span>
<span class="c">#    scheduler            Healthy   ok</span>
<span class="c">#    etcd-0               Healthy   ok</span>

<span class="c"># ì»¨íŠ¸ë¡¤í”Œë ˆì¸ (ì»¨í…Œì´ë„ˆ) ë…¸ë“œ 1ëŒ€ê°€ ì‹¤í–‰</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED              STATUS                 PORTS                                              NAMES</span>
<span class="c">#    3d4063180754   kindest/node:v1.32.0   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   About a minute ago   Up About a minute      127.0.0.1:64234-&amp;gt;6443/tcp                          kind-control-plane</span>
<span class="c">#    110494b9ca48   gogs/gogs              &amp;quot;/app/gogs/docker/stâ€¦&amp;quot;   19 hours ago         Up 5 hours (healthy)   0.0.0.0:3000-&amp;gt;3000/tcp, 0.0.0.0:10022-&amp;gt;22/tcp      gogs</span>
<span class="c">#    8b7c591c828d   jenkins/jenkins        &amp;quot;/usr/bin/tini -- /uâ€¦&amp;quot;   19 hours ago         Up 4 hours             0.0.0.0:8080-&amp;gt;8080/tcp, 0.0.0.0:50000-&amp;gt;50000/tcp   jenkins</span>
<span class="nv">$ </span>docker images
<span class="c"># =&gt; REPOSITORY                                                                   TAG           IMAGE ID       CREATED         SIZE</span>
<span class="c">#    kindest/node                                                                 &amp;lt;none&amp;gt;        b5a8f8764a3e   7 days ago      1.05GB</span>

<span class="c"># kube config íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config
<span class="c"># í˜¹ì€</span>
<span class="c"># $ cat $KUBECONFIG # KUBECONFIG ë³€ìˆ˜ ì§€ì • ì‚¬ìš© ì‹œ</span>

<span class="c"># nginx íŒŒë“œ ë°°í¬ ë° í™•ì¸ : ì»¨íŠ¸ë¡¤í”Œë ˆì¸ ë…¸ë“œì¸ë° íŒŒë“œê°€ ë°°í¬ ë ê¹Œìš”?</span>
<span class="nv">$ </span>kubectl run nginx <span class="nt">--image</span><span class="o">=</span>nginx:alpine
<span class="c"># =&gt; pod/nginx created</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-owide</span>
<span class="c"># =&gt; NAME    READY   STATUS    RESTARTS   AGE   IP           NODE                 NOMINATED NODE   READINESS GATES</span>
<span class="c">#    nginx   1/1     Running   0          10s   10.244.0.5   kind-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>

<span class="c"># ë…¸ë“œì— Taints ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>kubectl describe node | <span class="nb">grep </span>Taints
<span class="c"># =&gt; Taints:             &amp;lt;none&amp;gt;</span>

<span class="c"># í´ëŸ¬ìŠ¤í„° ì‚­ì œ</span>
<span class="nv">$ </span>kind delete cluster
<span class="c"># =&gt; Deleting cluster &amp;quot;kind&amp;quot; ...</span>
<span class="c">#    Deleted nodes: [&amp;quot;kind-control-plane&amp;quot;]</span>

<span class="c"># kube config ì‚­ì œ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> ~/.kube/config
<span class="c"># í˜¹ì€</span>
<span class="c"># $ cat $KUBECONFIG # KUBECONFIG ë³€ìˆ˜ ì§€ì • ì‚¬ìš© ì‹œ</span>
</code></pre></div></div>

<h4 id="kindë¡œ-kubernetes-í´ëŸ¬ìŠ¤í„°-ë°°í¬---3ë…¸ë“œ">Kindë¡œ Kubernetes í´ëŸ¬ìŠ¤í„° ë°°í¬ - 3ë…¸ë“œ</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ë°°í¬ ì „ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE             COMMAND                  CREATED        STATUS                 PORTS                                              NAMES</span>
<span class="c">#    110494b9ca48   gogs/gogs         &amp;quot;/app/gogs/docker/stâ€¦&amp;quot;   19 hours ago   Up 5 hours (healthy)   0.0.0.0:3000-&amp;gt;3000/tcp, 0.0.0.0:10022-&amp;gt;22/tcp      gogs</span>
<span class="c">#    8b7c591c828d   jenkins/jenkins   &amp;quot;/usr/bin/tini -- /uâ€¦&amp;quot;   19 hours ago   Up 4 hours             0.0.0.0:8080-&amp;gt;8080/tcp, 0.0.0.0:50000-&amp;gt;50000/tcp   jenkins</span>

<span class="c"># ë°©ì•ˆ1 : í™˜ê²½ë³€ìˆ˜ ì§€ì •</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">KUBECONFIG</span><span class="o">=</span><span class="nv">$PWD</span>/kubeconfig

<span class="c"># Create a cluster with kind</span>
<span class="c"># $ MyIP=&lt;ê°ì ìì‹ ì˜ PC IP&gt;</span>
<span class="nv">$ MyIP</span><span class="o">=</span>10.0.4.3

<span class="nv">$ </span><span class="nb">cd</span> ..
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> kind-3node.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
networking:
  apiServerAddress: "</span><span class="nv">$MyIP</span><span class="sh">"
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
  - containerPort: 30002
    hostPort: 30002
  - containerPort: 30003
    hostPort: 30003
- role: worker
- role: worker
</span><span class="no">EOF
</span><span class="nv">$ </span>kind create cluster <span class="nt">--config</span> kind-3node.yaml <span class="nt">--name</span> myk8s <span class="nt">--image</span> kindest/node:v1.30.6
<span class="c"># =&gt; Creating cluster &amp;quot;myk8s&amp;quot; ...</span>
<span class="c">#     âœ“ Ensuring node image (kindest/node:v1.30.6) ğŸ–¼</span>
<span class="c">#     âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦</span>
<span class="c">#     âœ“ Writing configuration ğŸ“œ</span>
<span class="c">#     âœ“ Starting control-plane ğŸ•¹ï¸</span>
<span class="c">#     âœ“ Installing CNI ğŸ”Œ</span>
<span class="c">#     âœ“ Installing StorageClass ğŸ’¾</span>
<span class="c">#     âœ“ Joining worker nodes ğŸšœ</span>
<span class="c">#    Set kubectl context to &amp;quot;kind-myk8s&amp;quot;</span>
<span class="c">#    You can now use your cluster with:</span>
<span class="c">#    </span>
<span class="c">#    kubectl cluster-info --context kind-myk8s</span>
<span class="c">#    </span>
<span class="c">#    Thanks for using kind! ğŸ˜Š</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kind get nodes <span class="nt">--name</span> myk8s
<span class="c"># =&gt; myk8s-control-plane</span>
<span class="c">#    myk8s-worker</span>
<span class="c">#    myk8s-worker2</span>
<span class="nv">$ </span>kubens default
<span class="c"># =&gt; Context &amp;quot;kind-myk8s&amp;quot; modified.</span>
<span class="c">#    Active namespace is &amp;quot;default&amp;quot;.</span>

<span class="c"># kind ëŠ” ë³„ë„ ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ìƒì„± í›„ ì‚¬ìš© : ê¸°ë³¸ê°’ 172.18.0.0/16</span>
<span class="nv">$ </span>docker network <span class="nb">ls</span>
<span class="c"># =&gt; NETWORK ID     NAME                     DRIVER    SCOPE</span>
<span class="c">#    8204a0851463   host                     host      local</span>
<span class="c">#    3bbcc6aa8f38   kind                     bridge    local</span>
<span class="nv">$ </span>docker inspect kind | jq
<span class="c"># =&gt; [</span>
<span class="c">#      {</span>
<span class="c">#        &amp;quot;Name&amp;quot;: &amp;quot;kind&amp;quot;,</span>
<span class="c">#        &amp;quot;Id&amp;quot;: &amp;quot;3bbcc6aa8f388f86f02478f41de1e4dd917e5812b6cf6257972e4af0bedf5021&amp;quot;,</span>
<span class="c">#        &amp;quot;Created&amp;quot;: &amp;quot;2024-10-01T11:37:09.195259833Z&amp;quot;,</span>
<span class="c">#        &amp;quot;Scope&amp;quot;: &amp;quot;local&amp;quot;,</span>
<span class="c">#        &amp;quot;Driver&amp;quot;: &amp;quot;bridge&amp;quot;,</span>
<span class="c">#        &amp;quot;EnableIPv6&amp;quot;: true,</span>
<span class="c">#        &amp;quot;IPAM&amp;quot;: {</span>
<span class="c">#          &amp;quot;Driver&amp;quot;: &amp;quot;default&amp;quot;,</span>
<span class="c">#          &amp;quot;Options&amp;quot;: {},</span>
<span class="c">#          &amp;quot;Config&amp;quot;: [</span>
<span class="c">#            {</span>
<span class="c">#              &amp;quot;Subnet&amp;quot;: &amp;quot;172.20.0.0/16&amp;quot;,</span>
<span class="c">#              &amp;quot;Gateway&amp;quot;: &amp;quot;172.20.0.1&amp;quot;</span>
<span class="c">#            }</span>
<span class="c">#          ]</span>
<span class="c">#        },</span>
<span class="c">#        &amp;quot;Internal&amp;quot;: false,</span>
<span class="c">#        &amp;quot;Attachable&amp;quot;: false,</span>
<span class="c">#        &amp;quot;Ingress&amp;quot;: false,</span>
<span class="c">#        &amp;quot;ConfigFrom&amp;quot;: {</span>
<span class="c">#          &amp;quot;Network&amp;quot;: &amp;quot;&amp;quot;</span>
<span class="c">#        },</span>
<span class="c">#        &amp;quot;ConfigOnly&amp;quot;: false,</span>
<span class="c">#        &amp;quot;Containers&amp;quot;: {</span>
<span class="c">#          &amp;quot;35739bf3542771236d47fd4dcb27da13814184a3de57c7203904f66ecbab4710&amp;quot;: {</span>
<span class="c">#            &amp;quot;Name&amp;quot;: &amp;quot;myk8s-worker&amp;quot;,</span>
<span class="c">#            &amp;quot;EndpointID&amp;quot;: &amp;quot;5de8e9e48e611f2c4cb908649f5dcdf63c82d624b85f85a6573ced7cbd454554&amp;quot;,</span>
<span class="c">#            &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:14:00:03&amp;quot;,</span>
<span class="c">#            &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.20.0.3/16&amp;quot;,</span>
<span class="c">#          },</span>
<span class="c">#          &amp;quot;48023a25d056141b00747f14ff52da2b46c46c0d0edbeb714dedd1f3c71360e4&amp;quot;: {</span>
<span class="c">#            &amp;quot;Name&amp;quot;: &amp;quot;myk8s-control-plane&amp;quot;,</span>
<span class="c">#            &amp;quot;EndpointID&amp;quot;: &amp;quot;9d51136474882d6ca7a4aabe7291e26527f44c3b88c7191b654506fdf1d65c84&amp;quot;,</span>
<span class="c">#            &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:14:00:04&amp;quot;,</span>
<span class="c">#            &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.20.0.4/16&amp;quot;,</span>
<span class="c">#          },</span>
<span class="c">#          &amp;quot;fefdfb00a2228f646119483a24503e1dc8bd74292e462fc9fa2ef3446004b4af&amp;quot;: {</span>
<span class="c">#            &amp;quot;Name&amp;quot;: &amp;quot;myk8s-worker2&amp;quot;,</span>
<span class="c">#            &amp;quot;EndpointID&amp;quot;: &amp;quot;c669ce7940abb8722b7ac41cc533c260838d31881c915a49147829e9d28a746c&amp;quot;,</span>
<span class="c">#            &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:14:00:02&amp;quot;,</span>
<span class="c">#            &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.20.0.2/16&amp;quot;,</span>
<span class="c">#          }</span>
<span class="c">#        },</span>
<span class="c">#        &amp;quot;Options&amp;quot;: {</span>
<span class="c">#          &amp;quot;com.docker.network.bridge.enable_ip_masquerade&amp;quot;: &amp;quot;true&amp;quot;,</span>
<span class="c">#          &amp;quot;com.docker.network.driver.mtu&amp;quot;: &amp;quot;1500&amp;quot;</span>
<span class="c">#        },</span>
<span class="c">#        &amp;quot;Labels&amp;quot;: {}</span>
<span class="c">#      }</span>
<span class="c">#    ]</span>

<span class="c"># k8s api ì£¼ì†Œ í™•ì¸ : ì–´ë–»ê²Œ ë¡œì»¬ì—ì„œ ì ‘ì†ì´ ë˜ëŠ” ê±¸ê¹Œ?</span>
<span class="nv">$ </span>kubectl cluster-info
<span class="c"># =&gt; Kubernetes control plane is running at https://10.0.4.3:51235</span>
<span class="c">#    CoreDNS is running at https://10.0.4.3:51235/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
<span class="c">#    </span>
<span class="c">#    To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ dockerê°€ 10.0.4.3:51235 ì ‘ì†ì‹œ kind ì»¨í…Œì´ë„ˆì˜ 6443 í¬íŠ¸ë¡œ í¬ì›Œë”© í•´ì£¼ê³ &lt;/span&gt;</span>
<span class="c"># &lt;span style="color: green;"&gt;   ~/.kube/config ì—ì„œ 10.0.4.3:51235ë¥¼ apiserver ì£¼ì†Œë¡œ ì§€ì •í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì ‘ì†ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.&lt;/span&gt;</span>

<span class="c"># ë…¸ë“œ ì •ë³´ í™•ì¸ : CRI ëŠ” containerd ì‚¬ìš©</span>
<span class="nv">$ </span>kubectl get node <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME                  STATUS   ROLES           AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION     CONTAINER-RUNTIME</span>
<span class="c">#    myk8s-control-plane   Ready    control-plane   3m8s    v1.30.6   172.20.0.4    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>
<span class="c">#    myk8s-worker          Ready    &amp;lt;none&amp;gt;          2m48s   v1.30.6   172.20.0.3    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>
<span class="c">#    myk8s-worker2         Ready    &amp;lt;none&amp;gt;          2m48s   v1.30.6   172.20.0.2    &amp;lt;none&amp;gt;        Debian GNU/Linux 12 (bookworm)   5.10.76-linuxkit   containerd://1.7.18</span>

<span class="c"># íŒŒë“œ ì •ë³´ í™•ì¸ : CNI ëŠ” kindnet ì‚¬ìš©</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-A</span> <span class="nt">-o</span> wide
<span class="c"># =&gt; NAMESPACE            NAME                                          READY   STATUS    RESTARTS   AGE     IP           NODE                  NOMINATED NODE   READINESS GATES</span>
<span class="c">#    kube-system          coredns-55cb58b774-m7h2c                      1/1     Running   0          3m7s    10.244.0.2   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          coredns-55cb58b774-z88v5                      1/1     Running   0          3m7s    10.244.0.3   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          etcd-myk8s-control-plane                      1/1     Running   0          3m22s   172.20.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kindnet-mp6mj                                 1/1     Running   0          3m7s    172.20.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kindnet-q2k9w                                 1/1     Running   0          3m4s    172.20.0.2   myk8s-worker2         &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kindnet-t99c4                                 1/1     Running   0          3m4s    172.20.0.3   myk8s-worker          &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-apiserver-myk8s-control-plane            1/1     Running   0          3m21s   172.20.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-controller-manager-myk8s-control-plane   1/1     Running   0          3m21s   172.20.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-proxy-f85sx                              1/1     Running   0          3m7s    172.20.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-proxy-ltckc                              1/1     Running   0          3m4s    172.20.0.2   myk8s-worker2         &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-proxy-njr42                              1/1     Running   0          3m4s    172.20.0.3   myk8s-worker          &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    kube-system          kube-scheduler-myk8s-control-plane            1/1     Running   0          3m21s   172.20.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    local-path-storage   local-path-provisioner-7d4d9bdcc5-jhl5h       1/1     Running   0          3m7s    10.244.0.4   myk8s-control-plane   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>

<span class="c"># ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸ &gt;&gt; ë„ì»¤ ì»¨í…Œì´ë„ˆì—ì„œ ë°°ìš´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ ë‹¤ë¦…ë‹ˆë‹¤!</span>
<span class="nv">$ </span>kubectl get namespaces
<span class="c"># =&gt; NAME                 STATUS   AGE</span>
<span class="c">#    default              Active   3m42s</span>
<span class="c">#    kube-node-lease      Active   3m42s</span>
<span class="c">#    kube-public          Active   3m42s</span>
<span class="c">#    kube-system          Active   3m42s</span>
<span class="c">#    local-path-storage   Active   3m35s</span>

<span class="c"># ì»¨íŠ¸ë¡¤í”Œë ˆì¸/ì›Œì»¤ ë…¸ë“œ(ì»¨í…Œì´ë„ˆ) í™•ì¸ : ë„ì»¤ ì»¨í…Œì´ë„ˆ ì´ë¦„ì€ myk8s-control-plane , myk8s-worker/worker-2 ì„ì„ í™•ì¸</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS                 PORTS                                                            NAMES</span>
<span class="c">#    35739bf35427   kindest/node:v1.30.6   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   4 minutes ago   Up 4 minutes                                                                            myk8s-worker</span>
<span class="c">#    48023a25d056   kindest/node:v1.30.6   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   4 minutes ago   Up 4 minutes           0.0.0.0:30000-30003-&amp;gt;30000-30003/tcp, 10.0.4.3:51235-&amp;gt;6443/tcp   myk8s-control-plane</span>
<span class="c">#    fefdfb00a222   kindest/node:v1.30.6   &amp;quot;/usr/local/bin/entrâ€¦&amp;quot;   4 minutes ago   Up 4 minutes                                                                            myk8s-worker2</span>
<span class="nv">$ </span>docker images

<span class="c"># ë””ë²„ê·¸ìš© ë‚´ìš© ì¶œë ¥ì— ~/.kube/config ê¶Œí•œ ì¸ì¦ ë¡œë“œ</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-v6</span>
<span class="c"># =&gt; I1221 20:19:47.265879   56969 loader.go:395] Config loaded from file:  /Users/anonym/Documents/GitHub/cicd-lite/w3/1/dev-app/kubeconfig</span>
<span class="c">#    I1221 20:19:47.354543   56969 round_trippers.go:553] GET https://10.0.4.3:51235/api/v1/namespaces/default/pods?limit=500 200 OK in 79 milliseconds</span>
<span class="c">#    No resources found in default namespace.</span>

<span class="c"># kube config íŒŒì¼ í™•ì¸</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="nv">$KUBECONFIG</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> <span class="nv">$KUBECONFIG</span>
<span class="c"># =&gt; .rw------- anonym staff 5.5 KB Sat Oct 01 20:16:21 2024 ï€– /Users/user/Documents/GitHub/cicd-lite/w3/1/dev-app/kubeconfig</span>
</code></pre></div></div>

<h5 id="kube-ops-view-ì„¤ì¹˜">kube-ops-view ì„¤ì¹˜</h5>

<ul>
  <li>kube-ops-viewëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kube-ops-view</span>
<span class="c"># helm show values geek-cookbook/kube-ops-view</span>
<span class="nv">$ </span>helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
<span class="nv">$ </span>helm <span class="nb">install </span>kube-ops-view geek-cookbook/kube-ops-view <span class="nt">--version</span> 1.2.2 <span class="nt">--set</span> service.main.type<span class="o">=</span>NodePort,service.main.ports.http.nodePort<span class="o">=</span>30001 <span class="nt">--set</span> env.TZ<span class="o">=</span><span class="s2">"Asia/Seoul"</span> <span class="nt">--namespace</span> kube-system

<span class="c"># ì„¤ì¹˜ í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,pod,svc,ep <span class="nt">-n</span> kube-system <span class="nt">-l</span> app.kubernetes.io/instance<span class="o">=</span>kube-ops-view
<span class="c"># =&gt; NAME                            READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    deployment.apps/kube-ops-view   1/1     1            1           25s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                 READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    pod/kube-ops-view-796947d6dc-6b6xx   1/1     Running   0          25s</span>
<span class="c">#    </span>
<span class="c">#    NAME                    TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE</span>
<span class="c">#    service/kube-ops-view   NodePort   10.96.18.59   &amp;lt;none&amp;gt;        8080:30001/TCP   25s</span>
<span class="c">#    </span>
<span class="c">#    NAME                      ENDPOINTS         AGE</span>
<span class="c">#    endpoints/kube-ops-view   10.244.1.2:8080   25s</span>

<span class="c"># kube-ops-view ì ‘ì† URL í™•ì¸ (1.5 , 2 ë°°ìœ¨)</span>
<span class="nv">$ </span>open <span class="s2">"http://127.0.0.1:30001/#scale=1.5"</span>
<span class="nv">$ </span>open <span class="s2">"http://127.0.0.1:30001/#scale=2"</span>
</code></pre></div></div>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_10.png" alt="img.png" class="w-80 image-center" loading="lazy" width="558" height="271"></p>

<h5 id="í´ëŸ¬ìŠ¤í„°-ì‚­ì œ">í´ëŸ¬ìŠ¤í„° ì‚­ì œ</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ëŸ¬ìŠ¤í„° ì‚­ì œ</span>
<span class="nv">$ </span>kind delete cluster <span class="nt">--name</span> myk8s
<span class="c"># =&gt; Deleting cluster &amp;quot;myk8s&amp;quot; ...</span>
<span class="c">#    Deleted nodes: [&amp;quot;myk8s-worker&amp;quot; &amp;quot;myk8s-control-plane&amp;quot; &amp;quot;myk8s-worker2&amp;quot;]</span>
<span class="nv">$ </span>docker ps
<span class="c"># =&gt; CONTAINER ID   IMAGE             COMMAND                  CREATED        STATUS                 PORTS                                              NAMES</span>
<span class="c">#    110494b9ca48   gogs/gogs         &amp;quot;/app/gogs/docker/stâ€¦&amp;quot;   19 hours ago   Up 6 hours (healthy)   0.0.0.0:3000-&amp;gt;3000/tcp, 0.0.0.0:10022-&amp;gt;22/tcp      gogs</span>
<span class="c">#    8b7c591c828d   jenkins/jenkins   &amp;quot;/usr/bin/tini -- /uâ€¦&amp;quot;   19 hours ago   Up 5 hours             0.0.0.0:8080-&amp;gt;8080/tcp, 0.0.0.0:50000-&amp;gt;50000/tcp   jenkins</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="nv">$KUBECONFIG</span>
<span class="nv">$ </span><span class="nb">unset </span>KUBECONFIG
</code></pre></div></div>

<h4 id="jenkins-ì„¤ì •--plugin-ì„¤ì¹˜-ìê²©ì¦ëª…-ì„¤ì •">Jenkins ì„¤ì • : Plugin ì„¤ì¹˜, ìê²©ì¦ëª… ì„¤ì •</h4>

<ul>
  <li>Jenkins Plugin ì„¤ì¹˜ : Dashboard &gt; Manage Jenkins &gt; Plugins &gt; Available plugins íƒ­ì—ì„œ ì„¤ì¹˜
    <ul>
      <li>
<strong>Pipeline Stage View</strong> - <a href="https://plugins.jenkins.io/pipeline-stage-view/">Docs</a>
</li>
      <li>
<strong>Docker Pipeline</strong> : building, testing, and using Docker images from Jenkins Pipeline - <a href="https://plugins.jenkins.io/docker-workflow/">Docs</a>
</li>
      <li>
<strong>Gogs</strong> : Webhook Plugin - <a href="https://plugins.jenkins.io/gogs-webhook/">Docs</a>
        <ul>
          <li>ì˜ˆì‹œ : <code class="language-plaintext highlighter-rouge">http(s)://&lt;&lt; jenkins-server &gt;&gt;/gogs-webhook/?job=&lt;&lt;jobname&gt;&gt;</code>
</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ìê²©ì¦ëª… ì„¤ì • : Dashboard &gt; Manage Jenkins &gt; Credentials &gt; Global &gt; Add Credentials ì—ì„œ ì¶”ê°€
    <ol>
      <li>Gogs Repo ìê²©ì¦ëª… ì„¤ì • : <strong>gogs-crd</strong>
        <ul>
          <li>Kind : Username with password</li>
          <li>Username : <code class="language-plaintext highlighter-rouge">devops</code>
</li>
          <li>Password : <code class="language-plaintext highlighter-rouge">&lt;Gogs í† í°&gt;</code>
</li>
          <li>ID : <code class="language-plaintext highlighter-rouge">gogs-crd</code>
</li>
        </ul>
      </li>
      <li>ë„ì»¤ í—ˆë¸Œ ìê²©ì¦ëª… ì„¤ì • : <strong>dockerhub-crd</strong>
        <ul>
          <li>Kind : Username with password</li>
          <li>Username : <code class="language-plaintext highlighter-rouge">&lt;ë„ì»¤ ê³„ì •ëª…&gt;</code>
</li>
          <li>Password : <code class="language-plaintext highlighter-rouge">&lt;ë„ì»¤ ê³„ì • ì•”í˜¸ í˜¹ì€ í† í°&gt;</code>
</li>
          <li>ID : <code class="language-plaintext highlighter-rouge">dockerhub-crd</code>
</li>
        </ul>
      </li>
      <li>k8s(kind) ìê²©ì¦ëª… ì„¤ì • : <strong>k8s-crd</strong>
        <ul>
          <li>Kind : <code class="language-plaintext highlighter-rouge">Secret file</code>
</li>
          <li>File : <code class="language-plaintext highlighter-rouge">&lt;kubeconfig íŒŒì¼ ì—…ë¡œë“œ&gt;</code>
</li>
          <li>ID : <code class="language-plaintext highlighter-rouge">k8s-crd</code>
</li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_11.png" alt="img.png" class="image-center" loading="lazy" width="1212" height="776">
<em class="image-caption">Jenkins ìê²©ì¦ëª… ì„¤ì • ê²°ê³¼</em></p>

<h5 id="jenkins-item-ìƒì„±-pipeline">Jenkins item ìƒì„± (Pipeline)</h5>

<ul>
  <li>ê°„ë‹¨í•œ Pipeline ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ gogsì™€ ë„ì»¤í—ˆë¸Œì˜ ìê²©ì¦ëª…ì´ ì˜ ì—°ë™ë¨ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ì•„ë˜ì˜ Pipeline ìŠ¤í¬ë¦½íŠ¸ë¥¼ <code class="language-plaintext highlighter-rouge">pipeline-ci</code>ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">environment</span> <span class="o">{</span>
        <span class="n">DOCKER_IMAGE</span> <span class="o">=</span> <span class="s1">'&lt;ìì‹ ì˜ ë„ì»¤ í—ˆë¸Œ ê³„ì •&gt;/dev-app'</span> <span class="c1">// Docker ì´ë¯¸ì§€ ì´ë¦„</span>
    <span class="o">}</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Checkout'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                 <span class="n">git</span> <span class="nl">branch:</span> <span class="s1">'main'</span><span class="o">,</span>
                 <span class="nl">url:</span> <span class="s1">'http://&lt;PCì˜ IP&gt;:3000/devops/dev-app.git'</span><span class="o">,</span>  <span class="c1">// Gitì—ì„œ ì½”ë“œ ì²´í¬ì•„ì›ƒ</span>
                 <span class="nl">credentialsId:</span> <span class="s1">'gogs-crd'</span>  <span class="c1">// Credentials ID</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Read VERSION'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="c1">// VERSION íŒŒì¼ ì½ê¸°</span>
                    <span class="kt">def</span> <span class="n">version</span> <span class="o">=</span> <span class="n">readFile</span><span class="o">(</span><span class="s1">'VERSION'</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span>
                    <span class="n">echo</span> <span class="s2">"Version found: ${version}"</span>
                    <span class="c1">// í™˜ê²½ ë³€ìˆ˜ ì„¤ì •</span>
                    <span class="n">env</span><span class="o">.</span><span class="na">DOCKER_TAG</span> <span class="o">=</span> <span class="n">version</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Docker Build and Push'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="n">docker</span><span class="o">.</span><span class="na">withRegistry</span><span class="o">(</span><span class="s1">'https://index.docker.io/v1/'</span><span class="o">,</span> <span class="s1">'dockerhub-crd'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// DOCKER_TAG ì‚¬ìš©</span>
                        <span class="kt">def</span> <span class="n">appImage</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="s2">"${DOCKER_IMAGE}:${DOCKER_TAG}"</span><span class="o">)</span>
                        <span class="n">appImage</span><span class="o">.</span><span class="na">push</span><span class="o">()</span>
                        <span class="n">appImage</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="s2">"latest"</span><span class="o">)</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">post</span> <span class="o">{</span>
        <span class="n">success</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s2">"Docker image ${DOCKER_IMAGE}:${DOCKER_TAG} has been built and pushed successfully!"</span>
        <span class="o">}</span>
        <span class="n">failure</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s2">"Pipeline failed. Please check the logs."</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>ì§€ê¸ˆ ë¹Œë“œ =&gt; ì½˜ì†” Output í™•ì¸
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_12.png" alt="img.png" class="image-center" loading="lazy" width="1504" height="751">
</li>
  <li>ë„ì»¤ í—ˆë¸Œ í™•ì¸
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_13.png" alt="img.png" class="image-center" loading="lazy" width="1212" height="843">
    <ul>
      <li>ìê²©ì¦ëª…ë“¤ì´ ì˜ ì—°ë™ë˜ì–´, íŒŒì´í”„ë¼ì¸ì—ì„œ ì§€ì •í•œê²ƒ ì²˜ëŸ¼ ë²„ì „ëª…ì˜ íƒœê·¸(0.0.1)ê³¼ latest íƒœê·¸ê°€ ì˜ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</li>
    </ul>
  </li>
</ul>

<h4 id="kubernetes-í´ëŸ¬ìŠ¤í„°ì—-ì‘ìš©í”„ë¡œê·¸ë¨-ë°°í¬í•˜ê¸°">Kubernetes í´ëŸ¬ìŠ¤í„°ì— ì‘ìš©í”„ë¡œê·¸ë¨ ë°°í¬í•˜ê¸°</h4>

<ul>
  <li>Jenkins Pipelineì„ í†µí•´ Kubernetes í´ëŸ¬ìŠ¤í„°ì— ì‘ìš©í”„ë¡œê·¸ë¨ì„ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ë¨¼ì € Kubernetes í´ëŸ¬ìŠ¤í„°ì— ë°°í¬í• ë•Œ ì‚¬ìš©í•˜ëŠ” deploymentì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<h5 id="deployment-ì†Œê°œ">Deployment ì†Œê°œ</h5>

<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<div class="mermaid">
  graph TD
      subgraph Deployment
          subgraph ReplicaSet
              direction TB
              subgraph Pod[Pod]
                  direction LR
                  Container1(Container)
                  Container2(Container)
              end
              subgraph Pod2[Pod]
                  direction LR
                  Container3(Container)
                  Container4(Container)
              end
              subgraph Pod3[Pod]
                  direction LR
                  Container5(Container)
              end
          end
      end
  classDef Pod fill:#fff,stroke:#ccc,stroke-width:2px;
  classDef ReplicaSet fill:#fff,stroke:#ccc,stroke-width:2px;
  classDef Deployment fill:#fff,stroke:#ccc,stroke-width:2px;
  class Pod,Pod2,Pod3 Pod;
  class Deployment Deployment;
  </div>
<p><em class="image-caption">Kubernetes ë°°í¬ êµ¬ì¡°</em></p>

<ul>
  <li>Kubernetesë¥¼ ë°°í¬í•˜ëŠ” ìµœì†Œë‹¨ìœ„ëŠ” <strong>Pod</strong>ì´ë©°, <strong>í•˜ë‚˜ ì´ìƒì˜ ì»¨í…Œì´ë„ˆë¡œ êµ¬ì„±</strong>ë©ë‹ˆë‹¤.</li>
  <li>PodëŠ” <strong>ReplicaSet</strong>ì— ì˜í•´ ê´€ë¦¬ë˜ë©°, ReplicaSetì€ <strong>Podì˜ ìˆ˜ë¥¼ ìœ ì§€í•˜ë„ë¡ ê´€ë¦¬</strong>í•©ë‹ˆë‹¤.</li>
  <li>
    <p><strong>Deployment</strong>ëŠ” <strong>ReplicaSetì„ ê´€ë¦¬í•˜ë©°, Podì˜ ë°°í¬ ë° ì—…ë°ì´íŠ¸ë¥¼ ê´€ë¦¬</strong>í•©ë‹ˆë‹¤.</p>
  </li>
  <li>KubernetesëŠ” manifestë¼ëŠ” yaml íŒŒì¼ì„ í†µí•´ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ì˜í•˜ê³ , ì„ ì–¸í˜• ë°©ì‹ìœ¼ë¡œ ì›í•˜ëŠ” ìƒíƒœë¥¼ ì„ ì–¸ì‹œ í•´ë‹¹ ìƒíƒœë¥¼ ì¶©ì¡±ì‹œí‚¤ê¸° ìœ„í•´ í´ëŸ¬ìŠ¤í„°ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤.</li>
  <li>ì•„ë˜ëŠ” kubernetesì˜ manifestì˜ êµ¬ì¡°ì…ë‹ˆë‹¤.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>apiVersion: ...   <span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ë¦¬ì†ŒìŠ¤ë¥¼ ë§Œë“œëŠ”ë° ì‚¬ìš©í•  Kubernetes API ë²„ì „&lt;/span&gt;</span>
kind: ...         <span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ë§Œë“¤ê³ ì í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì˜ ì¢…ë¥˜&lt;/span&gt;</span>
metadata:
    ...           <span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ë¦¬ì†ŒìŠ¤ë¥¼ ì‹ë³„í•˜ëŠ” ê³ ìœ  ë°ì´í„°ì™€ ìƒíƒœì™€ ê´€ë ¨ì—†ëŠ” ë©”íƒ€ë°ì´í„°&lt;/span&gt;</span>
spec:
    ...           <span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ë¦¬ì†ŒìŠ¤ì˜ ì›í•˜ëŠ” ìƒíƒœë¥¼ ì •ì˜&lt;/span&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<h5 id="deployment-ë°°í¬-ì‹¤ìŠµ">Deployment ë°°í¬ ì‹¤ìŠµ</h5>

<ul>
  <li>
    <p>ì•ì„œ ì‘ì„±í•œ Jenkins Pipelineì„ í†µí•´ ë¹Œë“œëœ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ Kubernetes í´ëŸ¬ìŠ¤í„°ì— ì‘ìš©í”„ë¡œê·¸ë¨ì„ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># ë””í”Œë¡œì´ë¨¼íŠ¸ ì˜¤ë¸Œì íŠ¸ ë°°í¬ : ë¦¬í”Œë¦¬ì¹´(íŒŒë“œ 2ê°œ), ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ &gt;&gt; ì•„ë˜ ë„ì»¤ ê³„ì • ë¶€ë¶„ë§Œ ë³€ê²½í•´ì„œ ë°°í¬í•´ë³´ì</span>
<span class="c">#$ DHUSER=&lt;ë„ì»¤ í—ˆë¸Œ ê³„ì •ëª…&gt;</span>
<span class="nv">$ DHUSER</span><span class="o">=</span>sweetlittlebird
  
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: timeserver
spec:
  replicas: 2
  selector:
    matchLabels:
      pod: timeserver-pod
  template:
    metadata:
      labels:
        pod: timeserver-pod
    spec:
      containers:
      - name: timeserver-container
        image: docker.io/</span><span class="nv">$DHUSER</span><span class="sh">/dev-app:0.0.1
</span><span class="no">EOF
</span><span class="c"># =&gt; deployment.apps/timeserver created</span>
<span class="nv">$ </span>watch <span class="nt">-d</span> kubectl get deploy,pod <span class="nt">-o</span> wide
  
<span class="c"># ë°°í¬ ìƒíƒœ í™•ì¸ : kube-ops-view ì›¹ í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,pod <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME                         READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS             IMAGES                                    SELECTOR</span>
<span class="c">#    deployment.apps/timeserver   0/2     2            0           45s   timeserver-container   docker.io/sweetlittlebird/dev-app:0.0.1   pod=timeserver-pod</span>
<span class="c">#    </span>
<span class="c">#    NAME                              READY   STATUS             RESTARTS   AGE   IP           NODE            NOMINATED NODE   READINESS GATES</span>
<span class="c">#    pod/timeserver-5b5ff6d859-s282p   0/1     &lt;span style="color: red;"&gt;ImagePullBackOff&lt;/span&gt;   0          45s   10.244.2.2   myk8s-worker2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    pod/timeserver-5b5ff6d859-v7gs7   0/1     &lt;span style="color: red;"&gt;ImagePullBackOff&lt;/span&gt;   0          45s   10.244.1.2   myk8s-worker    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ë°°í¬ìƒíƒœê°€ ImagePullBackOffë¡œ ë°°í¬ê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.&lt;/span&gt;</span>
  
<span class="nv">$ </span>kubectl describe pod
<span class="c"># =&gt; Name:             timeserver-5b5ff6d859-s282p</span>
<span class="c">#    ...</span>
<span class="c">#    Events:</span>
<span class="c">#      Type     Reason     Age                    From               Message</span>
<span class="c">#      ----     ------     ----                   ----               -------</span>
<span class="c">#      Normal   Scheduled  5m38s                  default-scheduler  Successfully assigned default/timeserver-5b5ff6d859-s282p to myk8s-worker2</span>
<span class="c">#      Normal   Pulling    4m4s (x4 over 5m37s)   kubelet            Pulling image &amp;quot;docker.io/sweetlittlebird/dev-app:0.0.1&amp;quot;</span>
<span class="c">#      Warning  Failed     4m3s (x4 over 5m35s)   kubelet            Failed to pull image &amp;quot;docker.io/sweetlittlebird/dev-app:0.0.1&amp;quot;: failed to pull and unpack image &amp;quot;docker.io/sweetlittlebird/dev-app:0.0.1&amp;quot;: failed to resolve reference &amp;quot;docker.io/sweetlittlebird/dev-app:0.0.1&amp;quot;: pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed</span>
<span class="c">#      Warning  Failed     4m3s (x4 over 5m35s)   kubelet            Error: ErrImagePull</span>
<span class="c">#      Warning  Failed     3m48s (x6 over 5m35s)  kubelet            Error: ImagePullBackOff</span>
<span class="c">#      Normal   BackOff    22s (x20 over 5m35s)   kubelet            Back-off pulling image &amp;quot;docker.io/sweetlittlebird/dev-app:0.0.1&amp;quot;```</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_14.png" alt="img.png" class="image-center" loading="lazy" width="815" height="553">
<em class="image-caption">Kube-Ops-Viewë¥¼ í†µí•´ ì‚´í´ë³¸ Kubernetes í´ëŸ¬ìŠ¤í„°ì— timeserver ë°°í¬ ì‹¤íŒ¨</em></p>

<ul>
  <li>ìœ„ì™€ ê°™ì´ Image pull errorê°€ ë‚˜ë©´ì„œ ë°°í¬ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</li>
  <li>
<code class="language-plaintext highlighter-rouge">kubectl describe pod</code>ë¥¼ í†µí•´ í™•ì¸í•œ ê²°ê³¼, <code class="language-plaintext highlighter-rouge">pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed</code>ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ê³ 
ì´ëŠ” Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ pullí•  ë•Œ ë„ì»¤ í—ˆë¸Œì— ì¸ì¦ í† í°ì´ ë˜ì–´ìˆì§€ ì•Šì•„ì„œ ë°œìƒí•œ ë¬¸ì œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
  <li>ë„ì»¤ í—ˆë¸Œì˜ ì¸ì¦í† í°ì„ ë“±ë¡í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<h4 id="k8sì—-docker-hub-ì¸ì¦í† í°-ë“±ë¡-í›„-ë‹¤ì‹œ-ë°°í¬">K8Sì— Docker Hub ì¸ì¦í† í° ë“±ë¡ í›„ ë‹¤ì‹œ ë°°í¬</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># k8s secret : ë„ì»¤ ìê²©ì¦ëª… ì„¤ì •</span>
 
<span class="nv">$ </span>kubectl get secret <span class="nt">-A</span>  <span class="c"># ê¸°ì¡´ ì‹œí¬ë¦¿ í™•ì¸</span>
<span class="c"># =&gt; NAMESPACE     NAME                                  TYPE                            DATA   AGE</span>
<span class="c">#    kube-system   bootstrap-token-abcdef                bootstrap.kubernetes.io/token   6      164m</span>
<span class="c">#    kube-system   sh.helm.release.v1.kube-ops-view.v1   helm.sh/release.v1              1      25m</span>

<span class="c">#$ DHUSER=&lt;ë„ì»¤ í—ˆë¸Œ ê³„ì •&gt;</span>
<span class="c">#$ DHPASS=&lt;ë„ì»¤ í—ˆë¸Œ ì•”í˜¸ í˜¹ì€ í† í°&gt;</span>

<span class="nv">$ DHUSER</span><span class="o">=</span>sweetlittlebird
<span class="nv">$ DHPASS</span><span class="o">=</span>dckr_<span class="k">****</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$DHUSER</span> <span class="nv">$DHPASS</span>
<span class="c"># =&gt; sweetlittlebird dckr_****</span>

<span class="c"># ë„ì»¤ í—ˆë¸Œ ì‹œí¬ë¦¿ ìƒì„±</span>
<span class="nv">$ </span>kubectl create secret docker-registry dockerhub-secret <span class="se">\</span>
  <span class="nt">--docker-server</span><span class="o">=</span>https://index.docker.io/v1/ <span class="se">\</span>
  <span class="nt">--docker-username</span><span class="o">=</span><span class="nv">$DHUSER</span> <span class="se">\</span>
  <span class="nt">--docker-password</span><span class="o">=</span><span class="nv">$DHPASS</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get secret
<span class="c"># =&gt; NAME               TYPE                             DATA   AGE</span>
<span class="c">#    dockerhub-secret   kubernetes.io/dockerconfigjson   1      8s</span>
<span class="nv">$ </span>kubectl describe secret
<span class="c"># =&gt; Name:         dockerhub-secret</span>
<span class="c">#    Namespace:    default</span>
<span class="c">#    Labels:       &amp;lt;none&amp;gt;</span>
<span class="c">#    Annotations:  &amp;lt;none&amp;gt;</span>
<span class="c">#    </span>
<span class="c">#    Type:  kubernetes.io/dockerconfigjson</span>
<span class="c">#    </span>
<span class="c">#    Data</span>
<span class="c">#    ====</span>
<span class="c">#    .dockerconfigjson:  205 bytes</span>
<span class="nv">$ </span>kubectl get secrets <span class="nt">-o</span> yaml | kubectl neat  <span class="c"># base64 ì¸ì½”ë”© í™•ì¸</span>
<span class="c"># =&gt; apiVersion: v1</span>
<span class="c">#    items:</span>
<span class="c">#    - apiVersion: v1</span>
<span class="c">#      data:</span>
<span class="c">#        .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJzZWNyZXRsaXR0bGViaXJkIiwicGFzc3dvcmQiOiJkY2tyX3BhdF9QdWNpVTRIMFBPZVpYWGNvV1VNd1ozTVpZVEUiLCJhdXRoIjoiYzJWamNtVjBiR2wwZEd4bFltbHlaRHBrWTJ0eVgzQmhkRjlRZFdOcFZUUklNRkJQWlZwWVdHTnZWMVZOZDFvelRWcFpWRVU9In19fQ==</span>
<span class="c">#      kind: Secret</span>
<span class="c">#      metadata:</span>
<span class="c">#        name: dockerhub-secret</span>
<span class="c">#        namespace: default</span>
<span class="c">#      type: kubernetes.io/dockerconfigjson</span>
<span class="c">#    kind: List</span>
<span class="c">#    metadata: {}</span>

<span class="nv">$ SECRET</span><span class="o">=</span><span class="nv">eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJzZWNyZXRsaXR0bGViaXJkIiwicGFzc3dvcmQiOiJkY2tyX3BhdF9QdWNpVTRIMFBPZVpYWGNvV1VNd1ozTVpZVEUiLCJhdXRoIjoiYzJWamNtVjBiR2wwZEd4bFltbHlaRHBrWTJ0eVgzQmhkRjlRZFdOcFZUUklNRkJQWlZwWVdHTnZWMVZOZDFvelRWcFpWRVU9In19fQ</span><span class="o">==</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$SECRET</span><span class="s2">"</span> | <span class="nb">base64</span> <span class="nt">-d</span> <span class="p">;</span> <span class="nb">echo</span>
<span class="c"># =&gt; {&amp;quot;auths&amp;quot;:{&amp;quot;https://index.docker.io/v1/&amp;quot;:{&amp;quot;username&amp;quot;:&amp;quot;sweetlittlebird&amp;quot;,&amp;quot;password&amp;quot;:&amp;quot;dckr_****&amp;quot;,&amp;quot;auth&amp;quot;:&amp;quot;c2VjcmV0bGl0dGxlYmlyZDpkY2tyX3BhdF9QdWNpVTRIMFBPZVpYWGNvV1VNd1ozTVpZVEU=&amp;quot;}}}</span>

<span class="c"># ë„ì»¤í—ˆë¸Œ ì¸ì¦ í† í°ì´ ë“±ë¡ë˜ì—ˆìœ¼ë‹ˆ ë‹¤ì‹œ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: timeserver
spec:
  replicas: 2
  selector:
    matchLabels:
      pod: timeserver-pod
  template:
    metadata:
      labels:
        pod: timeserver-pod
    spec:
      containers:
      - name: timeserver-container
        image: docker.io/</span><span class="nv">$DHUSER</span><span class="sh">/dev-app:0.0.1
      imagePullSecrets:
      - name: dockerhub-secret
</span><span class="no">EOF
</span><span class="nv">$ </span>watch <span class="nt">-d</span> kubectl get deploy,pod <span class="nt">-o</span> wide

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,pod
<span class="c"># =&gt; NAME                         READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    deployment.apps/timeserver   2/2     2            2           39s</span>
<span class="c">#    </span>
<span class="c">#    NAME                              READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    pod/timeserver-549cc9bc89-k6n6g   1/1     Running   0          39s</span>
<span class="c">#    pod/timeserver-549cc9bc89-kdmgx   1/1     Running   0          39s</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ë°°í¬ê°€ ì˜ ë˜ì—ˆìŠµë‹ˆë‹¤!&lt;/span&gt;</span>

<span class="c"># ì ‘ì†ì„ ìœ„í•œ curl íŒŒë“œ ìƒì„±</span>
<span class="nv">$ </span>kubectl run curl-pod <span class="nt">--image</span><span class="o">=</span>curlimages/curl:latest <span class="nt">--command</span> <span class="nt">--</span> sh <span class="nt">-c</span> <span class="s2">"while true; do sleep 3600; done"</span>
<span class="c"># =&gt; pod/curl-pod created</span>
<span class="nv">$ </span>kubectl get pod <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                          READY   STATUS    RESTARTS   AGE    IP           NODE            NOMINATED NODE   READINESS GATES</span>
<span class="c">#    curl-pod                      1/1     Running   0          22s    10.244.2.6   myk8s-worker2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    timeserver-549cc9bc89-k6n6g   1/1     Running   0          103s   10.244.2.5   myk8s-worker2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    timeserver-549cc9bc89-kdmgx   1/1     Running   0          103s   10.244.1.6   myk8s-worker    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>

<span class="c"># timeserver íŒŒë“œ IP 1ê°œ í™•ì¸ í›„ ì ‘ì† í™•ì¸</span>
<span class="c">#$ PODIP1=&lt;timeserver-Y íŒŒë“œ IP&gt;</span>
<span class="nv">$ PODIP1</span><span class="o">=</span>10.244.2.5

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> curl <span class="nv">$PODIP1</span>
<span class="c"># =&gt; The time is 2:51:54 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-k6n6g</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> curl <span class="nv">$PODIP1</span>
<span class="c"># =&gt; The time is 2:52:03 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-k6n6g</span>

<span class="c"># ë¡œê·¸ í™•ì¸</span>
<span class="nv">$ </span>kubectl logs deploy/timeserver
<span class="nv">$ </span>kubectl logs deploy/timeserver <span class="nt">-f</span>
<span class="nv">$ </span>kubectl stern deploy/timeserver
<span class="nv">$ </span>kubectl stern <span class="nt">-l</span> <span class="nv">pod</span><span class="o">=</span>timeserver-pod
</code></pre></div></div>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_15.png" alt="img.png" class="image-center" loading="lazy" width="815" height="553"></p>

<ul>
  <li>kube-ops-viewë¥¼ í†µí•´ì„œë„ ë°°í¬ê°€ ì˜ ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>íŒŒë“œ 1ê°œ ì‚­ì œ í›„ ë™ì‘ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="c">#$ POD1NAME=&lt;íŒŒë“œ 1ê°œ ì´ë¦„&gt;</span>
<span class="nv">$ POD1NAME</span><span class="o">=</span>timeserver-549cc9bc89-k6n6g

<span class="nv">$ </span>kubectl get pod <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                          READY   STATUS    RESTARTS   AGE    IP           NODE            NOMINATED NODE   READINESS GATES</span>
<span class="c">#    curl-pod                      1/1     Running   0          22s    10.244.2.6   myk8s-worker2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    timeserver-549cc9bc89-k6n6g   1/1     Running   0          103s   10.244.2.5   myk8s-worker2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    timeserver-549cc9bc89-kdmgx   1/1     Running   0          103s   10.244.1.6   myk8s-worker    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="nv">$ </span>kubectl delete pod <span class="nv">$POD1NAME</span> <span class="o">&amp;&amp;</span> kubectl get pod <span class="nt">-w</span>
<span class="c"># =&gt; pod &amp;quot;timeserver-549cc9bc89-k6n6g&amp;quot; deleted              # &lt;span style="color: green;"&gt;ğŸ‘‰ ë¶„ëª…íˆ timeserver íŒŒë“œ 1ê°œë¥¼ ì‚­ì œí•˜ì˜€ëŠ”ë°&lt;/span&gt;</span>
<span class="c">#    NAME                          READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    curl-pod                      1/1     Running   0          115s</span>
<span class="c">#    timeserver-549cc9bc89-kdmgx   1/1     Running   0          7m20s</span>
<span class="c">#    timeserver-549cc9bc89-pvm5k   1/1     Running   0          31s   # &lt;span style="color: green;"&gt;ğŸ‘‰ ë‹¤ì‹œ ìƒˆë¡œìš´ íŒŒë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>

<span class="c"># ì…€í”„ íë§ , íŒŒë“œ IP ë³€ê²½ -&gt; ê³ ì • ì§„ì…ì (ê³ ì • IP/ë„ë©”ì¸ë„¤ì„) í•„ìš” =&gt; Service</span>
<span class="nv">$ </span>kubectl get deploy,rs,pod <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                         READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS             IMAGES                                    SELECTOR</span>
<span class="c">#    deployment.apps/timeserver   2/2     2            2           10m   timeserver-container   docker.io/sweetlittlebird/dev-app:0.0.1   pod=timeserver-pod</span>
<span class="c">#    </span>
<span class="c">#    NAME                                    DESIRED   CURRENT   READY   AGE   CONTAINERS             IMAGES                                    SELECTOR</span>
<span class="c">#    replicaset.apps/timeserver-549cc9bc89   2         2         2       10m   timeserver-container   docker.io/sweetlittlebird/dev-app:0.0.1   pod=timeserver-pod,pod-template-hash=549cc9bc89</span>
<span class="c">#    </span>
<span class="c">#    NAME                              READY   STATUS    RESTARTS   AGE     IP           NODE            NOMINATED NODE   READINESS GATES</span>
<span class="c">#    pod/curl-pod                      1/1     Running   0          4m56s   10.244.2.7   myk8s-worker2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    pod/timeserver-549cc9bc89-kdmgx   1/1     Running   0          10m     10.244.1.6   myk8s-worker    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    pod/timeserver-549cc9bc89-pvm5k   1/1     Running   0          3m32s   10.244.2.8   myk8s-worker2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
</code></pre></div></div>

<ul>
  <li>ìœ„ì™€ ê°™ì´ íŒŒë“œê°€ ì‚­ì œë˜ë©´ ReplicaSetì— ì˜í•´ ìƒˆë¡œìš´ íŒŒë“œê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ë•Œ IPê°€ ë³€ê²½ë˜ì–´ ìƒˆë¡œìš´ íŒŒë“œê°€ ìƒì„±ë˜ëŠ”ë°, ì´ë ‡ê²Œ ë˜ë©´ ë§¤ë²ˆ íŒŒë“œê°€ ìƒì„±ë ë•Œ ë§ˆë‹¤ IPê°€ ë³€ê²½ë˜ì–´ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.</li>
  <li>ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ <strong>Service</strong>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
</ul>

<h5 id="service-ì†Œê°œ">Service ì†Œê°œ</h5>

<ul>
  <li>
<strong>Service</strong>ëŠ” Podì˜ ì§‘í•©ì— ëŒ€í•œ ê³ ì •ëœ ì§„ì…ì ì„ ì œê³µí•©ë‹ˆë‹¤. ì•ì„œ ì‚´í´ë³¸ê²ƒê³¼ ê°™ì´ PodëŠ” ìƒì„±/ì‚­ì œë˜ë©´ IPê°€ ë³€ê²½ë˜ëŠ”ë°, ì´ë¥¼ Serviceë¥¼ í†µí•´ ê³ ì •ëœ IPë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>Deploymentë¥¼ í†µí•´ Podê°€ ì—¬ëŸ¬ ê°œ ìƒì„±ë˜ë©´, ServiceëŠ” ì´ë“¤ì„ í•˜ë‚˜ì˜ ì§‘í•©ìœ¼ë¡œ ë¬¶ì–´ì„œ ë¶€í•˜ë¶„ì‚°(Load Balancing)ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
  <li>ServiceëŠ” Deploymentë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ì§€ì•Šê³ , Podë¥¼ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤. Podì˜ Label Selectorë¥¼ í†µí•´ ServiceëŠ” Podë¥¼ ì„ íƒí•©ë‹ˆë‹¤. 
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_16.png" alt="img.png" class="image-center" loading="lazy" width="702" height="610">
<em class="image-caption">Serviceì™€ Deployment, Pod manifestì˜ ê´€ê³„</em>
</li>
  <li>ServiceëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¢…ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>
<strong>ClusterIP</strong> : í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      <li>
<strong>NodePort</strong> : í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œëŠ” ë¬¼ë¡  ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ë•Œ íŒŒë“œê°€ ë™ì‘í•˜ëŠ” ë…¸ë“œ IPì˜ ì§€ì •ëœ í¬íŠ¸ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      <li>
<strong>LoadBalancer</strong> : í´ë¼ìš°ë“œ ì œê³µìì˜ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h5 id="service-ë°°í¬-ì‹¤ìŠµ">Service ë°°í¬ ì‹¤ìŠµ</h5>

<ul>
  <li>ê°„ë‹¨í•œ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì„œë¹„ìŠ¤ ìƒì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
  name: timeserver
spec:
  selector:
    pod: timeserver-pod
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    nodePort: 30000
  type: NodePort
</span><span class="no">EOF
</span><span class="c"># =&gt; service/timeserver created</span>

<span class="c">#</span>
<span class="nv">$ </span>kubectl get service,ep timeserver <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                 TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span>
<span class="c">#    service/timeserver   NodePort   10.96.204.127   &amp;lt;none&amp;gt;        80:30000/TCP   13s   pod=timeserver-pod</span>
<span class="c">#    </span>
<span class="c">#    NAME                   ENDPOINTS                     AGE</span>
<span class="c">#    endpoints/timeserver   10.244.1.6:80,10.244.2.8:80   13s</span>

<span class="c"># Service(ClusterIP)ë¡œ ì ‘ì† í™•ì¸ : ë„ë©”ì¸ë„¤ì„ ë°©ì‹</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> curl timeserver
<span class="c"># =&gt; The time is 3:29:30 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> curl timeserver.default.svc.cluster.local
<span class="c"># =&gt; The time is 3:29:33 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>

<span class="c"># Service(ClusterIP)ë¡œ ì ‘ì† í™•ì¸ : í´ëŸ¬ìŠ¤í„° IP ë°©ì‹</span>
<span class="nv">$ </span>kubectl get svc timeserver <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.spec.clusterIP<span class="o">}</span>
<span class="c"># =&gt; 10.96.204.127</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> curl <span class="si">$(</span>kubectl get svc timeserver <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">={</span>.spec.clusterIP<span class="o">}</span><span class="si">)</span>
<span class="c"># =&gt; The time is 3:29:40 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>

<span class="c"># Service(NodePort)ë¡œ ì ‘ì† í™•ì¸ "ë…¸ë“œIP:NodePort"</span>
<span class="nv">$ </span>curl http://127.0.0.1:30000
<span class="c"># =&gt; The time is 3:32:43 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-&lt;span style="color: red;"&gt;kdmgx&lt;/span&gt;</span>
<span class="nv">$ </span>curl http://127.0.0.1:30000
<span class="c"># =&gt; The time is 3:32:59 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-&lt;span style="color: red;"&gt;pvm5k&lt;/span&gt;</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ì„œë¹„ìŠ¤ê°€ 2ê°œì˜ Pod ì‚¬ì´ë¥¼ Load balancing í•˜ëŠ”ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>

<span class="c"># ë°˜ë³µ ì ‘ì† í•´ë‘ê¸° : ë¶€í•˜ë¶„ì‚° í™•ì¸</span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 1 http://127.0.0.1:30000 | <span class="nb">grep </span>name <span class="p">;</span> <span class="nb">sleep </span>1 <span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; Server hostname: timeserver-549cc9bc89-kdmgx</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-kdmgx</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#    ...</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..100<span class="o">}</span><span class="p">;</span>  <span class="k">do </span>curl <span class="nt">-s</span> http://127.0.0.1:30000 | <span class="nb">grep </span>name<span class="p">;</span> <span class="k">done</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span>
<span class="c"># =&gt;   54 Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#      46 Server hostname: timeserver-549cc9bc89-kdmgx</span>

<span class="c"># íŒŒë“œ ë³µì œë³µ ì¦ê°€ : service endpoint ëŒ€ìƒì— ìë™ ì¶”ê°€</span>
<span class="nv">$ </span>kubectl scale deployment timeserver <span class="nt">--replicas</span> 4
<span class="c"># =&gt; deployment.apps/timeserver scaled</span>
<span class="nv">$ </span>kubectl get service,ep timeserver <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                 TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span>
<span class="c">#    service/timeserver   NodePort   10.96.204.127   &amp;lt;none&amp;gt;        80:30000/TCP   37m   pod=timeserver-pod</span>
<span class="c">#    </span>
<span class="c">#    NAME                   ENDPOINTS                                               AGE</span>
<span class="c">#    endpoints/timeserver   10.244.1.6:80,10.244.1.7:80,10.244.2.8:80 + 1 more...   37m</span>

<span class="c"># ë°˜ë³µ ì ‘ì† í•´ë‘ê¸° : ë¶€í•˜ë¶„ì‚° í™•ì¸</span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 1 http://127.0.0.1:30000 | <span class="nb">grep </span>name <span class="p">;</span> <span class="nb">sleep </span>1 <span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-h9q6p</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-h9q6p</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-xlbck</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-kdmgx</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-xlbck</span>
<span class="c">#    ...</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..100<span class="o">}</span><span class="p">;</span>  <span class="k">do </span>curl <span class="nt">-s</span> http://127.0.0.1:30000 | <span class="nb">grep </span>name<span class="p">;</span> <span class="k">done</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span>
<span class="c"># =&gt;   29 Server hostname: timeserver-549cc9bc89-xlbck</span>
<span class="c">#      27 Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#      22 Server hostname: timeserver-549cc9bc89-kdmgx</span>
<span class="c">#      22 Server hostname: timeserver-549cc9bc89-h9q6p</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ íŒŒë“œ ìˆ˜ ë§Œí¼ ìë™ìœ¼ë¡œ ë¡œë“œë°¸ëŸ°ì‹± ë˜ëŠ”ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>
</code></pre></div></div>

<h5 id="ì•±-ì—…ë°ì´íŠ¸-í›„-ì¬ë°°í¬">ì•± ì—…ë°ì´íŠ¸ í›„ ì¬ë°°í¬</h5>

<ul>
  <li>ìƒ˜í”Œ ì•±ì˜ server.pyì™€ VERSION íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ê³ , Jenkins Pipelineì„ í†µí•´ ìƒˆë¡œìš´ ë²„ì „ì„ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ë¨¼ì € ìƒ˜í”Œ ì•±ì˜ ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># ì—…ë°ì´íŠ¸</span>
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="nt">-e</span> <span class="s1">'s/0.0.1/0.0.2/g'</span> server.py
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"0.0.2"</span> <span class="o">&gt;</span> VERSION
<span class="nv">$ </span>git add <span class="nb">.</span>
<span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"Update to 0.0.2"</span>
<span class="c"># =&gt; main c17ce89] Update to 0.0.2</span>
<span class="c">#     2 files changed, 2 insertions(+), 2 deletions(-)</span>
<span class="nv">$ </span>git push origin main
<span class="c"># =&gt; Enumerating objects: 7, done.</span>
<span class="c">#    Counting objects: 100% (7/7), done.</span>
<span class="c">#    Delta compression using up to 8 threads</span>
<span class="c">#    Compressing objects: 100% (3/3), done.</span>
<span class="c">#    Writing objects: 100% (4/4), 332 bytes | 332.00 KiB/s, done.</span>
<span class="c">#    Total 4 (delta 2), reused 0 (delta 0), pack-reused 0</span>
<span class="c">#    To http://10.0.4.3:3000/devops/dev-app.git</span>
<span class="c">#       3531233..c17ce89  main -&amp;gt; main</span>
</code></pre></div>    </div>
  </li>
  <li>Jenkinsì—ì„œ Build Nowë¥¼ í´ë¦­í•˜ì—¬ í†µí•´ ìƒˆë¡œìš´ ë²„ì „ì„ docker hubì— ì—…ë¡œë“œ í•©ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_17.png" alt="img.png" loading="lazy" width="1006" height="199"></p>

<ul>
  <li>ìƒˆë¡œìš´ ë²„ì „ì´ docker hubì— ì—…ë¡œë“œ ë˜ì—ˆìœ¼ë‹ˆ, Kubernetes í´ëŸ¬ìŠ¤í„°ì— ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íŒŒë“œ ë³µì œë³µ ì¦ê°€</span>
<span class="nv">$ </span>kubectl scale deployment timeserver <span class="nt">--replicas</span> 4
<span class="c"># =&gt; deployment.apps/timeserver scaled</span>
<span class="nv">$ </span>kubectl get service,ep timeserver <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                 TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span>
<span class="c">#    service/timeserver   NodePort   10.96.204.127   &amp;lt;none&amp;gt;        80:30000/TCP   45m   pod=timeserver-pod</span>
<span class="c">#    </span>
<span class="c">#    NAME                   ENDPOINTS                                               AGE</span>
<span class="c">#    endpoints/timeserver   10.244.1.6:80,10.244.1.7:80,10.244.2.8:80 + 1 more...   45m</span>

<span class="c"># ë°˜ë³µ ì ‘ì† í•´ë‘ê¸° : ë¶€í•˜ë¶„ì‚° í™•ì¸</span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 1 http://127.0.0.1:30000 | <span class="nb">grep </span>name <span class="p">;</span> <span class="nb">sleep </span>1 <span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; Server hostname: timeserver-549cc9bc89-kdmgx</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-h9q6p</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-kdmgx</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-xlbck</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#    ...</span>
<span class="nv">$ </span><span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..100<span class="o">}</span><span class="p">;</span>  <span class="k">do </span>curl <span class="nt">-s</span> http://127.0.0.1:30000 | <span class="nb">grep </span>name<span class="p">;</span> <span class="k">done</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span>
<span class="c"># =&gt;   32 Server hostname: timeserver-549cc9bc89-xlbck</span>
<span class="c">#      27 Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#      25 Server hostname: timeserver-549cc9bc89-kdmgx</span>
<span class="c">#      16 Server hostname: timeserver-549cc9bc89-h9q6p</span>

<span class="c"># ì—…ë°ì´íŠ¸ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•´ì„œ kubectl set imageë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.</span>
<span class="c"># $ kubectl set image deployment timeserver timeserver-container=$DHUSER/dev-app:0.0.Y &amp;&amp; watch -d "kubectl get deploy,ep timeserver; echo; kubectl get rs,pod"</span>
<span class="nv">$ </span>kubectl <span class="nb">set </span>image deployment timeserver timeserver-container<span class="o">=</span><span class="nv">$DHUSER</span>/dev-app:0.0.2 <span class="o">&amp;&amp;</span> watch <span class="nt">-d</span> <span class="s2">"kubectl get deploy,ep timeserver; echo; kubectl get rs,pod"</span>
<span class="c"># =&gt; Every 2.0s: kubectl get deploy,ep timeserver; echo; kubectl get rs,pod                                                                 Balthazar.local: Sun Oct 01 01:17:30 2024</span>
<span class="c">#    ...</span>
<span class="c">#    </span>
<span class="c">#    NAME                              READY   STATUS        RESTARTS   AGE</span>
<span class="c">#    pod/timeserver-549cc9bc89-h9q6p   1/1     Terminating   0          11m</span>
<span class="c">#    pod/timeserver-549cc9bc89-kdmgx   1/1     Terminating   0          88m</span>
<span class="c">#    pod/timeserver-549cc9bc89-pvm5k   1/1     Terminating   0          81m</span>
<span class="c">#    pod/timeserver-549cc9bc89-xlbck   1/1     Terminating   0          11m</span>
<span class="c">#    pod/timeserver-6f476fdbf-f8hw5    1/1     Running       0          9s</span>
<span class="c">#    pod/timeserver-6f476fdbf-k5fsn    1/1     Running       0          9s</span>
<span class="c">#    pod/timeserver-6f476fdbf-qq465    1/1     Running       0          4s</span>
<span class="c">#    pod/timeserver-6f476fdbf-tvrl5    1/1     Running       0          3s</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ê¸°ì¡´ ë²„ì „ì˜ íŒŒë“œê°€ ì¢…ë£Œë˜ê³  ìƒˆë¡œìš´ íŒŒë“œê°€ replica ìˆ˜ ë§Œí¼ ìƒì„± ë˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>

<span class="c"># ë¡¤ë§ì—…ë°ì´íŠ¸ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë³„ë„ì˜ í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒì˜ ëª…ë ¹ì„ ì…ë ¥í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 1 http://127.0.0.1:30000<span class="p">;</span> <span class="nb">sleep </span>1 <span class="p">;</span> <span class="k">done</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    The time is 4:17:24 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#    The time is 4:17:25 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-xlbck</span>
<span class="c">#    The time is 4:17:26 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-xlbck</span>
<span class="c">#    The time is 4:17:27 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-pvm5k</span>
<span class="c">#    The time is 4:17:28 PM, VERSION 0.0.2</span>
<span class="c">#    Server hostname: timeserver-6f476fdbf-k5fsn</span>
<span class="c">#    The time is 4:17:29 PM, VERSION 0.0.2</span>
<span class="c">#    Server hostname: timeserver-6f476fdbf-qq465</span>
<span class="c">#    The time is 4:17:30 PM, VERSION 0.0.2</span>
<span class="c">#    Server hostname: timeserver-6f476fdbf-tvrl5</span>
<span class="c">#    The time is 4:17:31 PM, VERSION 0.0.2</span>
<span class="c">#    Server hostname: timeserver-6f476fdbf-f8hw5</span>
<span class="c">#    The time is 4:17:32 PM, VERSION 0.0.2</span>
<span class="c">#    ...</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ë¡¤ë§ì—…ë°ì´íŠ¸ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ì´ ë°°í¬ê°€ ì˜ ë¨ì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>


<span class="c"># ë¡¤ë§ ì—…ë°ì´íŠ¸ í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,rs,pod,svc,ep <span class="nt">-owide</span>

<span class="c"># kubectl get deploy $DEPLOYMENT_NAME</span>
<span class="nv">$ </span>kubectl get deploy timeserver
<span class="c"># =&gt; NAME         READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    timeserver   4/4     4            4           90m</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ READYëŠ” ì „ì²´ replica ì¤‘ ëª‡ ê°œì˜ íŒŒë“œê°€ ì„œë¹„ìŠ¤ê°€ ê°€ëŠ¥í•œì§€ ì•Œë ¤ì¤ë‹ˆë‹¤.&lt;/span&gt;</span>
<span class="c"># &lt;span style="color: green;"&gt;    UP-TO-DATEëŠ” ëª‡ ê°œì˜ íŒŒë“œê°€ í˜„ì¬ì˜ ë²„ì „(ìƒíƒœ)ì¸ì§€ ì•Œë ¤ì¤ë‹ˆë‹¤.&lt;/span&gt;</span>

<span class="nv">$ </span>kubectl get pods <span class="nt">-l</span> <span class="nv">pod</span><span class="o">=</span>timeserver-pod
<span class="c"># =&gt; NAME                         READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    timeserver-6f476fdbf-f8hw5   1/1     Running   0          3m3s</span>
<span class="c">#    timeserver-6f476fdbf-k5fsn   1/1     Running   0          3m3s</span>
<span class="c">#    timeserver-6f476fdbf-qq465   1/1     Running   0          2m58s</span>
<span class="c">#    timeserver-6f476fdbf-tvrl5   1/1     Running   0          2m57s</span>
</code></pre></div></div>

<h4 id="gogs-webhookì„-í†µí•´-jenkins-pipeline-ìë™í™”">Gogs Webhookì„ í†µí•´ Jenkins Pipeline ìë™í™”</h4>

<ul>
  <li>Jenkins Pipelineì„ í†µí•´ ìƒˆë¡œìš´ ë²„ì „ì„ ë°°í¬í•˜ëŠ” ê³¼ì •ì„ ìë™í™”í•˜ê¸° ìœ„í•´ Gogs Webhookì„ ì„¤ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>git pushë¥¼ í†µí•´ ìƒˆë¡œìš´ ë²„ì „ì„ ì—…ë¡œë“œí•˜ë©´, Gogs Webhookì„ í†µí•´ Jenkins Pipelineì´ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ìƒˆë¡œìš´ ë²„ì „ì˜ ë„ì»¤ ì´ë¯¸ì§€ê°€ docker hubì— ì—…ë¡œë“œë˜ë„ë¡ í•©ë‹ˆë‹¤.</li>
</ul>

<h5 id="gogs-ì„¤ì •-ìˆ˜ì •-ë°-webhook-ì„¤ì •">Gogs ì„¤ì • ìˆ˜ì • ë° Webhook ì„¤ì •</h5>

<ul>
  <li>
    <p>ë¨¼ì € gogs ì»¨í…Œì´ë„ˆì˜ app.ini íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ jenkinsê°€ gogsì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># app.ini íŒŒì¼ ìˆ˜ì •</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>gogs vi /data/gogs/conf/app.ini
</code></pre></div>    </div>

    <div class="language-ini highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># app.ini
</span><span class="err">...</span>
<span class="nn">[security]</span>
<span class="py">INSTALL_LOCK</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">SECRET_KEY</span>   <span class="p">=</span> <span class="s">atxaUPQcbAEwpIu</span>
<span class="py">LOCAL_NETWORK_ALLOWLIST</span> <span class="p">=</span> <span class="s">10.0.4.3 # ê°ì ìì‹ ì˜ PC IP</span>
<span class="err">...</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Gogs ì»¨í…Œì´ë„ˆë¥¼ ì¬ê¸°ë™í•©ë‹ˆë‹¤.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker compose restart gogs
</code></pre></div>    </div>
  </li>
  <li>
    <p>Gogs ì—ì„œ Webhookì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
    <ol>
      <li>Repositoryë¥¼ ì„ íƒí›„ ìš°ì¸¡ì˜ Settings &gt; Webhooks &gt; Add a new webhookì—ì„œ Gogsë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
  <img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_18.png" alt="img.png" loading="lazy" width="1212" height="865">
</li>
      <li>Payload URL : <code class="language-plaintext highlighter-rouge">http://&lt;Jenkinsì˜ IP = PCì˜ IP&gt;:8080/gogs-webhook/?job=SCM-Pipeline/</code>
</li>
      <li>Content Type : <code class="language-plaintext highlighter-rouge">application/json</code>
</li>
      <li>Secret : <code class="language-plaintext highlighter-rouge">qwe123</code>
</li>
      <li>When should this webhook be triggered? : Just the push event</li>
      <li>Active : ì²´í¬</li>
      <li>Add Webhookì„ í´ë¦­í•˜ì—¬ ì›¹í›…ì„ ì €ì¥í•©ë‹ˆë‹¤.</li>
    </ol>
  </li>
</ul>

<h5 id="jenkinsì—ì„œ-gogs-webhookì„-í†µí•œ-pipeline-ìƒì„±">Jenkinsì—ì„œ Gogs Webhookì„ í†µí•œ Pipeline ìƒì„±</h5>

<ul>
  <li>ì´ë²ˆì—ëŠ” Jenkinsì—ì„œ ì•ì„œ ìƒì„±í•œ Gogs Webhookì„ í†µí•´ ìƒˆë¡œìš´ ë²„ì „ì„ ë°°í¬í•˜ëŠ” Pipelineì„ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>Dashboard &gt; New Item ì„ ì„ íƒí•©ë‹ˆë‹¤.
    <ul>
      <li>item name : SCM-Pipeline</li>
      <li>item type : Pipeline</li>
      <li>OKë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Pipeline ì„¤ì •ì„ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
    <ul>
      <li>GitHub project : <code class="language-plaintext highlighter-rouge">http://&lt;PCì˜ IP&gt;:3000/&lt;Gogs ê³„ì •ëª…&gt;/dev-app.git</code>
</li>
      <li>Use Gogs secret : <code class="language-plaintext highlighter-rouge">qwe123</code>
</li>
      <li>Build Triggers : Build when a change is pushed to Gogs ì²´í¬</li>
      <li>Pipeline script from SCM
        <ul>
          <li>SCM : Git
            <ul>
              <li>Repo URL : <code class="language-plaintext highlighter-rouge">http://&lt;PCì˜ IP&gt;:3000/&lt;Gogs ê³„ì •ëª…&gt;/dev-app.git</code>
</li>
              <li>Credentials : <code class="language-plaintext highlighter-rouge">devops/*</code>
</li>
              <li>Branch : <code class="language-plaintext highlighter-rouge">*/main</code>
</li>
            </ul>
          </li>
          <li>Script Path : <code class="language-plaintext highlighter-rouge">Jenkinsfile</code> 
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_19.png" alt="img.png" loading="lazy" width="1034" height="1458">
</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="jenkinsfile-ì‘ì„±-í›„-git-push">Jenkinsfile ì‘ì„± í›„ Git Push</h5>

<ul>
  <li>Jenkinsfileì„ ì‘ì„±í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">environment</span> <span class="o">{</span>
        <span class="n">DOCKER_IMAGE</span> <span class="o">=</span> <span class="s1">'&lt;ìì‹ ì˜ ë„ì»¤ í—ˆë¸Œ ê³„ì •&gt;/dev-app'</span> <span class="c1">// Docker ì´ë¯¸ì§€ ì´ë¦„</span>
    <span class="o">}</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Checkout'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                 <span class="n">git</span> <span class="nl">branch:</span> <span class="s1">'main'</span><span class="o">,</span>
                 <span class="nl">url:</span> <span class="s1">'http://&lt;PCì˜ IP&gt;:3000/devops/dev-app.git'</span><span class="o">,</span>  <span class="c1">// Gitì—ì„œ ì½”ë“œ ì²´í¬ì•„ì›ƒ</span>
                 <span class="nl">credentialsId:</span> <span class="s1">'gogs-crd'</span>  <span class="c1">// Credentials ID</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Read VERSION'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="c1">// VERSION íŒŒì¼ ì½ê¸°</span>
                    <span class="kt">def</span> <span class="n">version</span> <span class="o">=</span> <span class="n">readFile</span><span class="o">(</span><span class="s1">'VERSION'</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span>
                    <span class="n">echo</span> <span class="s2">"Version found: ${version}"</span>
                    <span class="c1">// í™˜ê²½ ë³€ìˆ˜ ì„¤ì •</span>
                    <span class="n">env</span><span class="o">.</span><span class="na">DOCKER_TAG</span> <span class="o">=</span> <span class="n">version</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Docker Build and Push'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="n">docker</span><span class="o">.</span><span class="na">withRegistry</span><span class="o">(</span><span class="s1">'https://index.docker.io/v1/'</span><span class="o">,</span> <span class="s1">'dockerhub-crd'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// DOCKER_TAG ì‚¬ìš©</span>
                        <span class="kt">def</span> <span class="n">appImage</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="s2">"${DOCKER_IMAGE}:${DOCKER_TAG}"</span><span class="o">)</span>
                        <span class="n">appImage</span><span class="o">.</span><span class="na">push</span><span class="o">()</span>
                        <span class="n">appImage</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="s2">"latest"</span><span class="o">)</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">post</span> <span class="o">{</span>
        <span class="n">success</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s2">"Docker image ${DOCKER_IMAGE}:${DOCKER_TAG} has been built and pushed successfully!"</span>
        <span class="o">}</span>
        <span class="n">failure</span> <span class="o">{</span>
            <span class="n">echo</span> <span class="s2">"Pipeline failed. Please check the logs."</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>VERSION íŒŒì¼ê³¼ server.py íŒŒì¼ì„ 0.0.2 =&gt; 0.0.3ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.</li>
  <li>ì‘ì„±ëœ íŒŒì¼ push</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git add <span class="nb">.</span> <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"VERSION </span><span class="si">$(</span><span class="nb">cat </span>VERSION<span class="si">)</span><span class="s2"> Changed"</span> <span class="o">&amp;&amp;</span> git push <span class="nt">-u</span> origin main
</code></pre></div></div>

<ul>
  <li>Pushì™€ ê±°ì˜ ë™ì‹œì— Jenkinsì—ì„œ Buildê°€ ì‹œì‘ë˜ê³  ì„±ê³µì ìœ¼ë¡œ ë¹Œë“œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_20.png" alt="img.png" loading="lazy" width="1392" height="910"></p>

<ul>
  <li>Docker hubì—ë„ 0.0.3 ë²„ì „ì´ ì—…ë¡œë“œ ì˜ ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_21.png" alt="img.png" loading="lazy" width="1052" height="200"></p>

<ul>
  <li>Gogsì—ì„œ Repository &gt; Settings &gt; Webhooks &gt; ì›¹í›… í´ë¦­í•˜ë©´ ì›¹í›… ì „ë‹¬ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
Gogs =&gt; Jenkinsì˜ ë°©í–¥ìœ¼ë¡œ Webhookì´ ì „ë‹¬ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_22.png" alt="img.png" loading="lazy" width="753" height="619"></p>

<ul>
  <li>ë§ˆì§€ë§‰ìœ¼ë¡œ Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ ìƒˆë¡œìš´ ë²„ì „ì„ ë°°í¬í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nb">set </span>image deployment timeserver timeserver-container<span class="o">=</span><span class="nv">$DHUSER</span>/dev-app:0.0.3 <span class="o">&amp;&amp;</span> watch <span class="nt">-d</span> <span class="s2">"kubectl get deploy,ep timeserver; echo; kubectl get rs,pod"</span>
</code></pre></div></div>

<hr>

<h3 id="jenkins-cicd--k8s-kind">Jenkins CI/CD + K8S (Kind)</h3>

<ul>
  <li>ì´ë²ˆì—ëŠ” Jenkinsì—ì„œ ë°”ë¡œ Kubernetes í´ëŸ¬ìŠ¤í„°ì— ë°°í¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì‹¤ìŠµì„ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— í•„ìš”í•œ íˆ´(kubectl, helm)ì„ ì„¤ì¹˜ í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install kubectl, helm</span>
<span class="nv">$ </span>docker compose <span class="nb">exec</span> <span class="nt">--privileged</span> <span class="nt">-u</span> root jenkins bash
<span class="nt">--------------------------------------------</span>
<span class="c">#curl -LO "https://dl.k8s.io/release/v1.31.0/bin/linux/amd64/kubectl" </span>
<span class="nv">$ </span>curl <span class="nt">-LO</span> <span class="s2">"https://dl.k8s.io/release/</span><span class="si">$(</span>curl <span class="nt">-L</span> <span class="nt">-s</span> https://dl.k8s.io/release/stable.txt<span class="si">)</span><span class="s2">/bin/linux/arm64/kubectl"</span>  <span class="c"># macOS</span>
<span class="c"># $ curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"  # WindowOS</span>

<span class="nv">$ </span><span class="nb">install</span> <span class="nt">-o</span> root <span class="nt">-g</span> root <span class="nt">-m</span> 0755 kubectl /usr/local/bin/kubectl
<span class="nv">$ </span>kubectl version <span class="nt">--client</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># =&gt; Client Version: v1.32.0</span>
<span class="c">#    Kustomize Version: v5.5.0</span>

<span class="c">#</span>
<span class="nv">$ </span>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
<span class="nv">$ </span>helm version
<span class="c"># =&gt; version.BuildInfo{Version:&amp;quot;v3.16.4&amp;quot;, GitCommit:&amp;quot;7877b45b63f95635153b29a42c0c2f4273ec45ca&amp;quot;, GitTreeState:&amp;quot;clean&amp;quot;, GoVersion:&amp;quot;go1.22.7&amp;quot;}</span>

<span class="nv">$ </span><span class="nb">exit</span>
<span class="nt">--------------------------------------------</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>jenkins kubectl version <span class="nt">--client</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># =&gt; Client Version: v1.32.0</span>
<span class="c">#    Kustomize Version: v5.5.0</span>
<span class="nv">$ </span>docker compose <span class="nb">exec </span>jenkins helm version
<span class="c"># =&gt; version.BuildInfo{Version:&amp;quot;v3.16.4&amp;quot;, GitCommit:&amp;quot;7877b45b63f95635153b29a42c0c2f4273ec45ca&amp;quot;, GitTreeState:&amp;quot;clean&amp;quot;, GoVersion:&amp;quot;go1.22.7&amp;quot;}</span>
</code></pre></div></div>

<ul>
  <li>Jenkins Item ìƒì„±(Pipeline) : item name(k8s-cmd)</li>
</ul>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    <span class="n">environment</span> <span class="o">{</span>
        <span class="n">KUBECONFIG</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">(</span><span class="s1">'k8s-crd'</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'List Pods'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'''
                # Fetch and display Pods
                kubectl get pods -A --kubeconfig "$KUBECONFIG"
                '''</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_23.png" alt="img.png" loading="lazy" width="1462" height="1415"></p>

<h5 id="jenkinsë¥¼-ì´ìš©í•œ-blue-green-ë°°í¬-ì‹¤ìŠµ">Jenkinsë¥¼ ì´ìš©í•œ blue-green ë°°í¬ ì‹¤ìŠµ</h5>

<ul>
  <li>ë””í”Œë¡œì´ë¨¼íŠ¸ / ì„œë¹„ìŠ¤ yaml íŒŒì¼ ì‘ì„± - http-echo ë° ì½”ë“œ push</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># </span>
<span class="nv">$ </span><span class="nb">cd </span>dev-app

<span class="c">#</span>
<span class="nv">$ </span><span class="nb">mkdir </span>deploy

<span class="c">#</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> deploy/echo-server-blue.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-server-blue
spec:
  replicas: 2
  selector:
    matchLabels:
      app: echo-server
      version: blue
  template:
    metadata:
      labels:
        app: echo-server
        version: blue
    spec:
      containers:
      - name: echo-server
        image: hashicorp/http-echo
        args:
        - "-text=Hello from Blue"
        ports:
        - containerPort: 5678
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> deploy/echo-server-service.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: v1
kind: Service
metadata:
  name: echo-server-service
spec:
  selector:
    app: echo-server
    version: blue
  ports:
  - protocol: TCP
    port: 80
    targetPort: 5678
    nodePort: 30000
  type: NodePort
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> deploy/echo-server-green.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-server-green
spec:
  replicas: 2
  selector:
    matchLabels:
      app: echo-server
      version: green
  template:
    metadata:
      labels:
        app: echo-server
        version: green
    spec:
      containers:
      - name: echo-server
        image: hashicorp/http-echo
        args:
        - "-text=Hello from Green"
        ports:
        - containerPort: 5678
</span><span class="no">EOF

</span><span class="c">#</span>
<span class="nv">$ </span>git add <span class="nb">.</span> <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"Add echo server yaml"</span> <span class="o">&amp;&amp;</span> git push <span class="nt">-u</span> origin main
<span class="c"># =&gt; main 76adc73] Add echo server yaml</span>
<span class="c">#     3 files changed, 60 insertions(+)</span>
<span class="c">#     create mode 100644 deploy/echo-server-blue.yaml</span>
<span class="c">#     create mode 100644 deploy/echo-server-green.yaml</span>
<span class="c">#     create mode 100644 deploy/echo-server-service.yaml</span>
<span class="c">#    Enumerating objects: 7, done.</span>
<span class="c">#    Counting objects: 100% (7/7), done.</span>
<span class="c">#    Delta compression using up to 8 threads</span>
<span class="c">#    Compressing objects: 100% (6/6), done.</span>
<span class="c">#    Writing objects: 100% (6/6), 789 bytes | 789.00 KiB/s, done.</span>
<span class="c">#    Total 6 (delta 2), reused 0 (delta 0), pack-reused 0</span>
<span class="c">#    To http://10.0.4.3:3000/devops/dev-app.git</span>
<span class="c">#       60f336b..76adc73  main -&amp;gt; main</span>
<span class="c">#    branch 'main' set up to track 'origin/main'.</span>
</code></pre></div></div>

<ul>
  <li>Jenkinsì—ì„œ Pipelineì„ ì‘ì„±í•˜ì—¬ ë°°í¬í•´ ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ë¨¼ì €, ì´ì „ ì‹¤ìŠµì—ì„œ ë°°í¬í•œ deploymentì™€ serviceë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl delete deploy,svc timeserver
<span class="c"># =&gt; deployment.apps &amp;quot;timeserver&amp;quot; deleted</span>
<span class="c">#    service &amp;quot;timeserver&amp;quot; deleted</span>
</code></pre></div></div>

<ul>
  <li>ë°˜ë³µì ‘ì†ì„ ë¯¸ë¦¬ ì‹¤í–‰í•´ë‘¡ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë³„ë„ì˜ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰</span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 1 http://127.0.0.1:30000 <span class="p">;</span> <span class="nb">echo</span> <span class="p">;</span> <span class="nb">sleep </span>1  <span class="p">;</span> kubectl get deploy <span class="nt">-owide</span> <span class="p">;</span> <span class="nb">echo</span> <span class="p">;</span> kubectl get svc,ep echo-server-service <span class="nt">-owide</span> <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"------------"</span> <span class="p">;</span> <span class="k">done</span>
<span class="c"># í˜¹ì€ </span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 1 http://127.0.0.1:30000 <span class="p">;</span> <span class="nb">date</span> <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"------------"</span> <span class="p">;</span> <span class="nb">sleep </span>1 <span class="p">;</span> <span class="k">done</span>
</code></pre></div></div>

<ul>
  <li>Jenkinsì—ì„œ Pipeline ìƒì„± : item name(k8s-bluegreen)</li>
</ul>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>

    <span class="n">environment</span> <span class="o">{</span>
        <span class="n">KUBECONFIG</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">(</span><span class="s1">'k8s-crd'</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Checkout'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                 <span class="n">git</span> <span class="nl">branch:</span> <span class="s1">'main'</span><span class="o">,</span>
                 <span class="nl">url:</span> <span class="s1">'http://&lt;PCì˜ IP&gt;:3000/devops/dev-app.git'</span><span class="o">,</span>  <span class="c1">// Gitì—ì„œ ì½”ë“œ ì²´í¬ì•„ì›ƒ</span>
                 <span class="nl">credentialsId:</span> <span class="s1">'gogs-crd'</span>  <span class="c1">// Credentials ID</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'container image build'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s2">"container image build"</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'container image upload'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">echo</span> <span class="s2">"container image upload"</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'k8s deployment blue version'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s2">"kubectl apply -f ./deploy/echo-server-blue.yaml --kubeconfig $KUBECONFIG"</span>
                <span class="n">sh</span> <span class="s2">"kubectl apply -f ./deploy/echo-server-service.yaml --kubeconfig $KUBECONFIG"</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'approve green version'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">input</span> <span class="nl">message:</span> <span class="s1">'approve green version'</span><span class="o">,</span> <span class="nl">ok:</span> <span class="s2">"Yes"</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'k8s deployment green version'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
	        	<span class="n">sh</span> <span class="s2">"kubectl apply -f ./deploy/echo-server-green.yaml --kubeconfig $KUBECONFIG"</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'approve version switching'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="n">returnValue</span> <span class="o">=</span> <span class="n">input</span> <span class="nl">message:</span> <span class="s1">'Green switching?'</span><span class="o">,</span> <span class="nl">ok:</span> <span class="s2">"Yes"</span><span class="o">,</span> <span class="nl">parameters:</span> <span class="o">[</span><span class="n">booleanParam</span><span class="o">(</span><span class="nl">defaultValue:</span> <span class="kc">true</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'IS_SWITCHED'</span><span class="o">)]</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">returnValue</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">sh</span> <span class="s2">"kubectl patch svc echo-server-service -p '{\"spec\": {\"selector\": {\"version\": \"green\"}}}' --kubeconfig $KUBECONFIG"</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">stage</span><span class="o">(</span><span class="s1">'Blue Rollback'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="n">returnValue</span> <span class="o">=</span> <span class="n">input</span> <span class="nl">message:</span> <span class="s1">'Blue Rollback?'</span><span class="o">,</span> <span class="nl">parameters:</span> <span class="o">[</span><span class="n">choice</span><span class="o">(</span><span class="nl">choices:</span> <span class="o">[</span><span class="s1">'done'</span><span class="o">,</span> <span class="s1">'rollback'</span><span class="o">],</span> <span class="nl">name:</span> <span class="s1">'IS_ROLLBACk'</span><span class="o">)]</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">returnValue</span> <span class="o">==</span> <span class="s2">"done"</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">sh</span> <span class="s2">"kubectl delete -f ./deploy/echo-server-blue.yaml --kubeconfig $KUBECONFIG"</span>
                    <span class="o">}</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">returnValue</span> <span class="o">==</span> <span class="s2">"rollback"</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">sh</span> <span class="s2">"kubectl patch svc echo-server-service -p '{\"spec\": {\"selector\": {\"version\": \"blue\"}}}' --kubeconfig $KUBECONFIG"</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Build Nowë¡œ ë°°í¬ í›„ ë™ì‘ì„ í™•ì¸í•©ë‹ˆë‹¤.
    <ul>
      <li>blue ë²„ì „ì´ ë°°í¬ëœ ë‹¤ìŒ green ë²„ì „ì„ ë°°í¬í• ì§€ ìŠ¹ì¸ ì—¬ë¶€ë¥¼ ë¬»ìŠµë‹ˆë‹¤.
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_24.png" alt="img.png" loading="lazy" width="907" height="400">
</li>
      <li>ìŠ¹ì¸í•˜ë©´ green ë²„ì „ì´ ë°°í¬ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì•„ì§ íŠ¸ë˜í”½ì€ Blueë¡œë§Œ íë¦…ë‹ˆë‹¤.
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deploy <span class="nt">-owide</span> <span class="p">;</span> <span class="nb">echo</span> <span class="p">;</span> kubectl get svc,ep echo-server-service <span class="nt">-owide</span>
<span class="c"># =&gt; Hello from Blue</span>
<span class="c">#    </span>
<span class="c">#    NAME                READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS    IMAGES                SELECTOR</span>
<span class="c">#    echo-server-blue    2/2     2            2           3m46s   echo-server   hashicorp/http-echo   app=echo-server,version=blue</span>
<span class="c">#    echo-server-green   2/2     2            2           31s     echo-server   hashicorp/http-echo   app=echo-server,version=green</span>
<span class="c">#    </span>
<span class="c">#    NAME                          TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE     SELECTOR</span>
<span class="c">#    service/echo-server-service   NodePort   10.96.40.148   &amp;lt;none&amp;gt;        80:30000/TCP   3m45s   app=echo-server,version=blue</span>
<span class="c">#    </span>
<span class="c">#    NAME                            ENDPOINTS                         AGE</span>
<span class="c">#    endpoints/echo-server-service   10.244.1.8:5678,10.244.2.8:5678   3m45s</span>
</code></pre></div>        </div>
      </li>
      <li>greenìœ¼ë¡œ ë°°í¬í• ì§€ ìŠ¹ì¸í•˜ë©´ ë§ˆì¹¨ë‚´ greenìœ¼ë¡œ íŠ¸ë˜í”½ì´ ì „ë‹¬ ë©ë‹ˆë‹¤. 
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_25.png" alt="img.png" loading="lazy" width="306" height="312">
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deploy <span class="nt">-owide</span> <span class="p">;</span> <span class="nb">echo</span> <span class="p">;</span> kubectl get svc,ep echo-server-service <span class="nt">-owide</span>
<span class="c"># =&gt; Hello from Green</span>
<span class="c">#    </span>
<span class="c">#    NAME                READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS    IMAGES                SELECTOR</span>
<span class="c">#    echo-server-blue    2/2     2            2           6m14s   echo-server   hashicorp/http-echo   app=echo-server,version=blue</span>
<span class="c">#    echo-server-green   2/2     2            2           2m59s   echo-server   hashicorp/http-echo   app=echo-server,version=green</span>
<span class="c">#    </span>
<span class="c">#    NAME                          TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE     SELECTOR</span>
<span class="c">#    service/echo-server-service   NodePort   10.96.40.148   &amp;lt;none&amp;gt;        80:30000/TCP   6m13s   app=echo-server,version=green</span>
<span class="c">#    </span>
<span class="c">#    NAME                            ENDPOINTS                         AGE</span>
<span class="c">#    endpoints/echo-server-service   10.244.1.9:5678,10.244.2.9:5678   6m13s</span>
</code></pre></div>        </div>
      </li>
      <li>ë§ˆì§€ë§‰ìœ¼ë¡œ blueë¥¼ ë¡¤ë°±í• ì§€ ë¬¼ìœ¼ë©°, ìŠ¹ì¸í•˜ë©´ blueê°€ ì‚­ì œ ë©ë‹ˆë‹¤.
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># =&gt; Hello from Green</span>
<span class="c">#    </span>
<span class="c">#    NAME                READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS    IMAGES                SELECTOR</span>
<span class="c">#    echo-server-green   2/2     2            2           4m55s   echo-server   hashicorp/http-echo   app=echo-server,version=green</span>
<span class="c">#    </span>
<span class="c">#    NAME                          TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE    SELECTOR</span>
<span class="c">#    service/echo-server-service   NodePort   10.96.40.148   &amp;lt;none&amp;gt;        80:30000/TCP   8m9s   app=echo-server,version=green</span>
<span class="c">#    </span>
<span class="c">#    NAME                            ENDPOINTS                         AGE</span>
<span class="c">#    endpoints/echo-server-service   10.244.1.9:5678,10.244.2.9:5678   8m9s</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ ì™„ë£Œ í›„ ì‚­ì œ</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl delete deploy echo-server-blue echo-server-green
<span class="nv">$ </span>kubectl delete svc echo-server-service
</code></pre></div></div>

<h3 id="jenkins-ci--argocd--k8s-kind">Jenkins CI + ArgoCD + K8S (Kind)</h3>

<h4 id="argocd-ì†Œê°œ">ArgoCD ì†Œê°œ</h4>

<ul>
  <li>ArgoCDëŠ” GitOpsë¥¼ ì§€ì›í•˜ëŠ” CD ë„êµ¬ë¡œ, Kubernetes í´ëŸ¬ìŠ¤í„°ì— ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³ ,
Git ì €ì¥ì†Œì— ì •ì˜ëœ ìƒíƒœì™€ ì‹¤ì œ ìƒíƒœê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ê²½ìš° ìë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì›í•˜ëŠ” ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” íˆ´ì…ë‹ˆë‹¤.</li>
  <li>ArgoCDì˜ ì•„í‚¤í…ì³
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_26.png" alt="img.png" loading="lazy" width="743" height="708">
</li>
  <li>ArgoCDëŠ” ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœì¸ Kubernetes manifestë¥¼ ë‹¤ìŒì˜ ë°©ì‹ë“¤ë¡œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>
<a href="https://kustomize.io/">Kustomize</a> ì• í”Œë¦¬ì¼€ì´ì…˜</li>
      <li>
<a href="https://helm.sh/">helm</a> chart</li>
      <li>
<a href="https://jsonnet.org/">jsonnet</a> íŒŒì¼</li>
      <li>yaml/json manifest íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í„°ë¦¬</li>
      <li>ê¸°íƒ€ config management pluginì—ì„œ ì •ì˜í•œ íŒŒì¼</li>
    </ul>
  </li>
  <li>ìì„¸í•œ ì‚¬í•­ì€ <a href="https://argoproj.github.io/">ê³µì‹ í™ˆí˜ì´ì§€</a>ë‚˜ <a href="https://malwareanalysis.tistory.com/tag/ArgoCD">ì•…ë¶„ë‹˜ ArgoCD ì •ë¦¬ ë¸”ë¡œê·¸</a>ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.</li>
</ul>

<h4 id="argocd-ì„¤ì¹˜-ë°-ê¸°ë³¸ì„¤ì •">ArgoCD ì„¤ì¹˜ ë° ê¸°ë³¸ì„¤ì •</h4>

<ul>
  <li>ArgoCDë¥¼ ì„¤ì¹˜í•˜ê³  ê¸°ë³¸ ì„¤ì •ì„ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„± ë° íŒŒë¼ë¯¸í„° íŒŒì¼ ì‘ì„±</span>
<span class="nv">$ </span>kubectl create ns argocd
<span class="c"># =&gt; namespace/argocd created</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt; argocd-values.yaml
dex:
  enabled: false

server:
  service:
    type: NodePort
    nodePortHttps: 30002
</span><span class="no">EOF

</span><span class="c"># ì„¤ì¹˜</span>
<span class="nv">$ </span>helm repo add argo https://argoproj.github.io/argo-helm
<span class="c"># =&gt; &amp;quot;argo&amp;quot; has been added to your repositories</span>
<span class="nv">$ </span>helm <span class="nb">install </span>argocd argo/argo-cd <span class="nt">--version</span> 7.7.10 <span class="nt">-f</span> argocd-values.yaml <span class="nt">--namespace</span> argocd
<span class="c"># =&gt; NAME: argocd</span>
<span class="c">#    LAST DEPLOYED: Sun Oct 01 16:53:42 2024</span>
<span class="c">#    NAMESPACE: argocd</span>
<span class="c">#    STATUS: deployed</span>
<span class="c">#    REVISION: 1</span>
<span class="c">#    TEST SUITE: None</span>
<span class="c">#    NOTES:</span>
<span class="c">#    In order to access the server UI you have the following options:</span>
<span class="c">#    </span>
<span class="c">#    1. kubectl port-forward service/argocd-server -n argocd 8080:443</span>
<span class="c">#        and then open the browser on http://localhost:8080 and accept the certificate</span>
<span class="c">#    </span>
<span class="c">#    2. enable ingress in the values file `server.ingress.enabled` and either</span>
<span class="c">#          - Add the annotation for ssl passthrough: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-1-ssl-passthrough</span>
<span class="c">#          - Set the `configs.params.&amp;quot;server.insecure&amp;quot;` in the values file and terminate SSL at your ingress: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-2-multiple-ingress-objects-and-hosts</span>
<span class="c">#    </span>
<span class="c">#    After reaching the UI the first time you can login with username: admin and the random password generated during the installation. You can find the password by running:</span>
<span class="c">#    kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=&amp;quot;{.data.password}&amp;quot; | base64 -d</span>
<span class="c">#    (You should delete the initial secret afterwards as suggested by the Getting Started Guide: https://argo-cd.readthedocs.io/en/stable/getting_started/#4-login-using-the-cli)</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get pod,svc,ep <span class="nt">-n</span> argocd
<span class="c"># =&gt; NAME                                                    READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    pod/argocd-application-controller-0                     1/1     Running   0          4m55s</span>
<span class="c">#    pod/argocd-applicationset-controller-856f6bd788-zvtd2   1/1     Running   0          4m55s</span>
<span class="c">#    pod/argocd-notifications-controller-764b9d6597-z4mrx    1/1     Running   0          4m55s</span>
<span class="c">#    pod/argocd-redis-5c67786686-qwx8f                       1/1     Running   0          4m55s</span>
<span class="c">#    pod/argocd-repo-server-c9f8b6dbf-jpjcq                  1/1     Running   0          4m55s</span>
<span class="c">#    pod/argocd-server-7bff46b6bd-7n6vx                      1/1     Running   0          4m55s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE</span>
<span class="c">#    service/argocd-applicationset-controller   ClusterIP   10.96.166.245   &amp;lt;none&amp;gt;        7000/TCP                     4m55s</span>
<span class="c">#    service/argocd-redis                       ClusterIP   10.96.46.103    &amp;lt;none&amp;gt;        6379/TCP                     4m55s</span>
<span class="c">#    service/argocd-repo-server                 ClusterIP   10.96.117.132   &amp;lt;none&amp;gt;        8081/TCP                     4m55s</span>
<span class="c">#    service/argocd-server                      NodePort    10.96.75.70     &amp;lt;none&amp;gt;        80:30080/TCP,443:30002/TCP   4m55s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                         ENDPOINTS                           AGE</span>
<span class="c">#    endpoints/argocd-applicationset-controller   10.244.2.13:7000                    4m55s</span>
<span class="c">#    endpoints/argocd-redis                       10.244.2.12:6379                    4m55s</span>
<span class="c">#    endpoints/argocd-repo-server                 10.244.1.11:8081                    4m55s</span>
<span class="c">#    endpoints/argocd-server                      10.244.1.10:8080,10.244.1.10:8080   4m55s</span>
<span class="nv">$ </span>kubectl get crd | <span class="nb">grep </span>argo
<span class="c"># =&gt; applications.argoproj.io      2024-10-01T07:54:01Z</span>
<span class="c">#    applicationsets.argoproj.io   2024-10-01T07:54:01Z</span>
<span class="c">#    appprojects.argoproj.io       2024-10-01T07:54:01Z</span>

<span class="c"># ìµœì´ˆ ì ‘ì† ì•”í˜¸ í™•ì¸</span>
<span class="nv">$ </span>kubectl <span class="nt">-n</span> argocd get secret argocd-initial-admin-secret <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.password}"</span> | <span class="nb">base64</span> <span class="nt">-d</span> <span class="p">;</span><span class="nb">echo</span>
<span class="c"># =&gt; ZaQfvE9xrehyKxvl</span>

<span class="c"># Argo CD ì›¹ ì ‘ì† ì£¼ì†Œ í™•ì¸ : ì´ˆê¸° ì•”í˜¸ ì…ë ¥ (admin ê³„ì •)</span>
<span class="nv">$ </span>open <span class="s2">"https://127.0.0.1:30002"</span> <span class="c"># macOS</span>
<span class="c">## Windows OSê²½ìš° ì§ì ‘ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ https://127.0.0.1:30002 ì ‘ì†</span>
</code></pre></div></div>

<ul>
  <li>Argo CD ì›¹ ì ‘ì† í™•ì¸ - ìœ„ì—ì„œ í™•ì¸í•œ ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_27.png" alt="img.png" class="image-center" loading="lazy" width="1178" height="743">
<em class="image-caption">Argo CD ì›¹ ì´ˆê¸° í™”ë©´</em>
    <ul>
      <li>User Info &gt; Update passwordë¡œ admin ê³„ì • ì•”í˜¸ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. (qwe12345)</li>
    </ul>
  </li>
  <li>Settings &gt; Clusters, Projects, Accounts ë“± ê¸°ë³¸ì •ë³´ë¥¼ í™•ì¸í•´ë´…ë‹ˆë‹¤.</li>
  <li>ì‹¤ìŠµì„ ìœ„í•´ ops-deploy Repoë¥¼ ë“±ë¡í•´ë³´ê² ìŠµë‹ˆë‹¤.
    <ul>
      <li>Settings &gt; Repositories &gt; Connect Repo í´ë¦­
        <ul>
          <li>connection method : VIA HTTPS</li>
          <li>Type : git</li>
          <li>Project : default</li>
          <li>Repo URL : http://<pc ip="">:3000/devops/ops-deploy</pc>
</li>
          <li>Username : devops</li>
          <li>Password : <gogs></gogs>
</li>
        </ul>

        <p>=&gt;  ì…ë ¥ í›„ CONNECT í´ë¦­
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_28.png" alt="img.png" loading="lazy" width="955" height="96"></p>
      </li>
      <li>ëª¨ë“  ì •ë³´ê°€ ì •í™•í•˜ì—¬ ì—°ê²°ì´ ë˜ë©´ ì—°ê²°ìƒíƒœê°€ Successfulë¡œ ë“±ë¡ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h4 id="helm-chartë¥¼-í†µí•œ-ë°°í¬-ì‹¤ìŠµ">Helm chartë¥¼ í†µí•œ ë°°í¬ ì‹¤ìŠµ</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span><span class="nb">mkdir </span>nginx-chart
<span class="nv">$ </span><span class="nb">cd </span>nginx-chart

<span class="nv">$ </span><span class="nb">mkdir </span>templates

<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> templates/configmap.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}
data:
  index.html: |
{{ .Values.indexHtml | indent 4 }}
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> templates/deployment.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Release.Name }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ .Release.Name }}
  template:
    metadata:
      labels:
        app: {{ .Release.Name }}
    spec:
      containers:
      - name: nginx
        image: {{ .Values.image.repository }}:{{ .Values.image.tag }}
        ports:
        - containerPort: 80
        volumeMounts:
        - name: index-html
          mountPath: /usr/share/nginx/html/index.html
          subPath: index.html
      volumes:
      - name: index-html
        configMap:
          name: {{ .Release.Name }}
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> templates/service.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: v1
kind: Service
metadata:
  name: {{ .Release.Name }}
spec:
  selector:
    app: {{ .Release.Name }}
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
    nodePort: 30000
  type: NodePort
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> values.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
indexHtml: |
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to Nginx!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello, Kubernetes!&lt;/h1&gt;
    &lt;p&gt;Nginx version 1.26.1&lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;

image:
  repository: nginx
  tag: 1.26.1

replicaCount: 1
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> Chart.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: v2
name: nginx-chart
description: A Helm chart for deploying Nginx with custom index.html
type: application
version: 1.0.0
appVersion: "1.26.1"
</span><span class="no">EOF

</span><span class="c"># ì´ì „ timeserver/service(nodeport) ì‚­ì œ</span>
<span class="nv">$ </span>kubectl delete deploy,svc <span class="nt">--all</span>

<span class="c"># ì§ì ‘ ë°°í¬ í•´ë³´ê¸°</span>
<span class="nv">$ </span>helm <span class="nb">install </span>dev-nginx <span class="nb">.</span> <span class="nt">-f</span> values.yaml
<span class="c"># =&gt; NAME: dev-nginx</span>
<span class="c">#    LAST DEPLOYED: Sun Oct 01 19:54:23 2024</span>
<span class="c">#    NAMESPACE: default</span>
<span class="c">#    STATUS: deployed</span>
<span class="c">#    REVISION: 1</span>
<span class="c">#    TEST SUITE: None</span>
<span class="nv">$ </span>helm list
<span class="c"># =&gt; NAME       NAMESPACE REVISION  UPDATED                             STATUS    CHART             APP VERSION</span>
<span class="c">#    dev-nginx  default   1         2024-10-01 19:54:23.03644 +0900 KST deployed  nginx-chart-1.0.0 1.26.1     </span>
<span class="nv">$ </span>kubectl get deploy,svc,ep,cm dev-nginx <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                        READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR</span>
<span class="c">#    deployment.apps/dev-nginx   1/1     1            1           4s    nginx        nginx:1.26.1   app=dev-nginx</span>
<span class="c">#    </span>
<span class="c">#    NAME                TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span>
<span class="c">#    service/dev-nginx   NodePort   10.96.79.233   &amp;lt;none&amp;gt;        80:30000/TCP   4s    app=dev-nginx</span>
<span class="c">#    </span>
<span class="c">#    NAME                  ENDPOINTS        AGE</span>
<span class="c">#    endpoints/dev-nginx   10.244.1.16:80   4s</span>
<span class="c">#    </span>
<span class="c">#    NAME                  DATA   AGE</span>
<span class="c">#    configmap/dev-nginx   1      4s</span>

<span class="c">#</span>
<span class="nv">$ </span>curl http://127.0.0.1:30000
<span class="c"># =&gt; &lt;!DOCTYPE html&amp;gt;</span>
<span class="c">#    &amp;lt;html&amp;gt;</span>
<span class="c">#    &amp;lt;head&amp;gt;</span>
<span class="c">#      &amp;lt;title&amp;gt;Welcome to Nginx!&amp;lt;/title&amp;gt;</span>
<span class="c">#    &amp;lt;/head&amp;gt;</span>
<span class="c">#    &amp;lt;body&amp;gt;</span>
<span class="c">#      &amp;lt;h1&amp;gt;Hello, Kubernetes!&amp;lt;/h1&amp;gt;</span>
<span class="c">#      &amp;lt;p&amp;gt;Nginx version 1.26.1&amp;lt;/p&amp;gt;</span>
<span class="c">#    &amp;lt;/body&amp;gt;</span>
<span class="c">#    &amp;lt;/html&amp;gt;</span>
<span class="nv">$ </span>curl <span class="nt">-s</span> http://127.0.0.1:30000 | <span class="nb">grep </span>version
<span class="c"># =&gt;   &amp;lt;p&amp;gt;Nginx version 1.26.1&amp;lt;/p&amp;gt;</span>
<span class="nv">$ </span>open http://127.0.0.1:30000

<span class="c"># value ê°’ ë³€ê²½ í›„ ì ìš© í•´ë³´ê¸° : version/tag, replicaCount</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> values.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
indexHtml: |
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to Nginx!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello, Kubernetes!&lt;/h1&gt;
    &lt;p&gt;Nginx version 1.26.2&lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;

image:
  repository: nginx
  tag: 1.26.2

replicaCount: 2
</span><span class="no">EOF

</span><span class="c"># helm chart ì—…ê·¸ë ˆì´ë“œ ì ìš©</span>
<span class="nv">$ </span>helm upgrade dev-nginx <span class="nb">.</span> <span class="nt">-f</span> values.yaml
<span class="c"># =&gt; Release &amp;quot;dev-nginx&amp;quot; has been upgraded. Happy Helming!</span>
<span class="c">#    NAME: dev-nginx</span>
<span class="c">#    LAST DEPLOYED: Sun Oct 01 19:56:59 2024</span>
<span class="c">#    NAMESPACE: default</span>
<span class="c">#    STATUS: deployed</span>
<span class="c">#    REVISION: 2</span>
<span class="c">#    TEST SUITE: None</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>helm list
<span class="c"># =&gt; NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION</span>
<span class="c">#    dev-nginx       default         2               2024-10-01 19:56:59.30731 +0900 KST     deployed        nginx-chart-1.0.0       1.26.1</span>
<span class="nv">$ </span>kubectl get deploy,svc,ep,cm dev-nginx <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                        READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR</span>
<span class="c">#    deployment.apps/dev-nginx   &lt;span style="color: red;"&gt;2/2     2            2&lt;/span&gt;           38s   nginx        &lt;span style="color: red;"&gt;nginx:1.26.2&lt;/span&gt;   app=dev-nginx</span>
<span class="c">#    ...</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ Replicaê°€ 2ê°œë¡œ ëŠ˜ì–´ë‚˜ì„œ íŒŒë“œê°€ 2ê°œê°€ ë˜ì—ˆê³  ë²„ì „ 1.26.2ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>
<span class="nv">$ </span>curl http://127.0.0.1:30000
<span class="c"># =&gt; &amp;lt;!DOCTYPE html&amp;gt;</span>
<span class="c">#    &amp;lt;html&amp;gt;</span>
<span class="c">#    &amp;lt;head&amp;gt;</span>
<span class="c">#      &amp;lt;title&amp;gt;Welcome to Nginx!&amp;lt;/title&amp;gt;</span>
<span class="c">#    &amp;lt;/head&amp;gt;</span>
<span class="c">#    &amp;lt;body&amp;gt;</span>
<span class="c">#      &amp;lt;h1&amp;gt;Hello, Kubernetes!&amp;lt;/h1&amp;gt;</span>
<span class="c">#      &amp;lt;p&amp;gt;Nginx version 1.26.2&amp;lt;/p&amp;gt;</span>
<span class="c">#    &amp;lt;/body&amp;gt;</span>
<span class="c">#    &amp;lt;/html&amp;gt;</span>
<span class="nv">$ </span>curl <span class="nt">-s</span> http://127.0.0.1:30000 | <span class="nb">grep </span>version
<span class="c"># =&gt;   &amp;lt;p&amp;gt;Nginx version 1.26.2&amp;lt;/p&amp;gt;</span>
<span class="nv">$ </span>open http://127.0.0.1:30000

<span class="c"># í™•ì¸ í›„ ì‚­ì œ</span>
<span class="nv">$ </span>helm uninstall dev-nginx
</code></pre></div></div>

<h5 id="repoops-deploy-ì—-nginx-helm-chart-ë¥¼-argo-cdë¥¼-í†µí•œ-ë°°í¬-1">Repo(ops-deploy) ì— nginx helm chart ë¥¼ Argo CDë¥¼ í†µí•œ ë°°í¬ 1</h5>

<ul>
  <li>git ì‘ì—…</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span><span class="nb">mkdir </span>cicd-labs
<span class="nv">$ </span><span class="nb">cd </span>cicd-labs
<span class="nv">$ </span>git clone http://10.0.4.3:3000/devops/ops-deploy.git
<span class="c"># =&gt; Cloning into 'ops-deploy'...</span>
<span class="c">#    remote: Enumerating objects: 3, done.</span>
<span class="c">#    remote: Counting objects: 100% (3/3), done.</span>
<span class="c">#    remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span>
<span class="c">#    Unpacking objects: 100% (3/3), 228 bytes | 114.00 KiB/s, done.</span>
<span class="nv">$ </span><span class="nb">cd </span>ops-deploy

<span class="c">#</span>
<span class="nv">$ </span>git config user.name <span class="s2">"devops"</span>
<span class="nv">$ </span>git config user.email <span class="s2">"a@a.com"</span>
<span class="nv">$ </span>git config init.defaultBranch main
<span class="nv">$ </span>git config credential.helper store

<span class="c">#</span>
<span class="nv">$ VERSION</span><span class="o">=</span>1.26.1
<span class="nv">$ </span><span class="nb">mkdir </span>nginx-chart
<span class="nv">$ </span><span class="nb">mkdir </span>nginx-chart/templates

<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/VERSION <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
</span><span class="nv">$VERSION</span><span class="sh">
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/templates/configmap.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: v1
kind: ConfigMap
metadata:
  name: 
data:
  index.html: |
</span><span class="no">
EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/templates/deployment.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: apps/v1
kind: Deployment
metadata:
  name: 
spec:
  replicas: 
  selector:
    matchLabels:
      app: 
  template:
    metadata:
      labels:
        app: 
    spec:
      containers:
      - name: nginx
        image: :
        ports:
        - containerPort: 80
        volumeMounts:
        - name: index-html
          mountPath: /usr/share/nginx/html/index.html
          subPath: index.html
      volumes:
      - name: index-html
        configMap:
          name: 
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/templates/service.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: v1
kind: Service
metadata:
  name: 
spec:
  selector:
    app: 
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
    nodePort: 30000
  type: NodePort
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/values-dev.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
indexHtml: |
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to Nginx!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello, Kubernetes!&lt;/h1&gt;
    &lt;p&gt;DEV : Nginx version </span><span class="nv">$VERSION</span><span class="sh">&lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;

image:
  repository: nginx
  tag: </span><span class="nv">$VERSION</span><span class="sh">

replicaCount: 1
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/values-prd.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
indexHtml: |
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to Nginx!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello, Kubernetes!&lt;/h1&gt;
    &lt;p&gt;PRD : Nginx version </span><span class="nv">$VERSION</span><span class="sh">&lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;

image:
  repository: nginx
  tag: </span><span class="nv">$VERSION</span><span class="sh">

replicaCount: 2
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/Chart.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: v2
name: nginx-chart
description: A Helm chart for deploying Nginx with custom index.html
type: application
version: 1.0.0
appVersion: "</span><span class="nv">$VERSION</span><span class="sh">"
</span><span class="no">EOF

</span><span class="nv">$ </span>tree nginx-chart
<span class="c"># =&gt; nginx-chart</span>
<span class="c">#    â”œâ”€â”€ Chart.yaml</span>
<span class="c">#    â”œâ”€â”€ VERSION</span>
<span class="c">#    â”œâ”€â”€ templates</span>
<span class="c">#    â”‚   â”œâ”€â”€ configmap.yaml</span>
<span class="c">#    â”‚   â”œâ”€â”€ deployment.yaml</span>
<span class="c">#    â”‚   â””â”€â”€ service.yaml</span>
<span class="c">#    â”œâ”€â”€ values-dev.yaml</span>
<span class="c">#    â””â”€â”€ values-prd.yaml</span>

<span class="c">#</span>
<span class="nv">$ </span>git status <span class="o">&amp;&amp;</span> git add <span class="nb">.</span> <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"Add nginx helm chart"</span> <span class="o">&amp;&amp;</span> git push <span class="nt">-u</span> origin main
<span class="c"># =&gt; On branch main</span>
<span class="c">#    Your branch is up to date with 'origin/main'.</span>
<span class="c">#    </span>
<span class="c">#    Untracked files:</span>
<span class="c">#      (use &amp;quot;git add &amp;lt;file&amp;gt;...&amp;quot; to include in what will be committed)</span>
<span class="c">#            nginx-chart/</span>
<span class="c">#    </span>
<span class="c">#    nothing added to commit but untracked files present (use &amp;quot;git add&amp;quot; to track)</span>
<span class="c">#    [main 2bcfda2] Add nginx helm chart</span>
<span class="c">#     7 files changed, 88 insertions(+)</span>
<span class="c">#     create mode 100644 nginx-chart/Chart.yaml</span>
<span class="c">#     create mode 100644 nginx-chart/VERSION</span>
<span class="c">#     create mode 100644 nginx-chart/templates/configmap.yaml</span>
<span class="c">#     create mode 100644 nginx-chart/templates/deployment.yaml</span>
<span class="c">#     create mode 100644 nginx-chart/templates/service.yaml</span>
<span class="c">#     create mode 100644 nginx-chart/values-dev.yaml</span>
<span class="c">#     create mode 100644 nginx-chart/values-prd.yaml</span>
<span class="c">#    Enumerating objects: 12, done.</span>
<span class="c">#    Counting objects: 100% (12/12), done.</span>
<span class="c">#    Delta compression using up to 8 threads</span>
<span class="c">#    Compressing objects: 100% (10/10), done.</span>
<span class="c">#    Writing objects: 100% (11/11), 1.44 KiB | 1.44 MiB/s, done.</span>
<span class="c">#    Total 11 (delta 1), reused 0 (delta 0), pack-reused 0</span>
<span class="c">#    To http://10.0.4.3:3000/devops/ops-deploy.git</span>
<span class="c">#       f7dc047..2bcfda2  main -&amp;gt; main</span>
<span class="c">#    branch 'main' set up to track 'origin/main'.</span>
</code></pre></div></div>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_29.png" alt="img.png" loading="lazy" width="996" height="138"></p>

<h5 id="argo-cdì—-app-ë“±ë¡">Argo CDì— App ë“±ë¡</h5>

<ul>
  <li>ArgoCDì—ì„œ Application &gt; New Appì„ í´ë¦­í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë“±ë¡í•©ë‹ˆë‹¤.
    <ul>
      <li>GENERAL
        <ul>
          <li>App Name : dev-nginx</li>
          <li>Project Name : default</li>
          <li>SYNC POLICY : Manual</li>
          <li>SYNC OPTIONS : AUTO-CREATE NAMESPACE(Check)</li>
        </ul>
      </li>
      <li>Source
        <ul>
          <li>Repo URL : <code class="language-plaintext highlighter-rouge">&lt;ì„¤ì •ë˜ì–´ ìˆëŠ” ê²ƒ ì„ íƒ&gt;</code> (http://10.0.4.3:3000/devops/ops-deploy)</li>
          <li>Revision : HEAD</li>
          <li>PATH : nginx-chart</li>
        </ul>
      </li>
      <li>DESTINATION
        <ul>
          <li>Cluster URL : <code class="language-plaintext highlighter-rouge">&lt;ê¸°ë³¸ê°’&gt;</code>
</li>
          <li>NAMESPACE : dev-nginx</li>
        </ul>
      </li>
      <li>HELM
        <ul>
          <li>Values files : values-dev.yaml 
=&gt; ì‘ì„± í›„ ìƒë‹¨ CREATE í´ë¦­</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_30.png" alt="img.png" class="image-center" loading="lazy" width="523" height="340">
<em class="image-caption">Argo CD Application ë“±ë¡ ì§í›„</em></p>

<ul>
  <li>ë“±ë¡ ì§í›„ì—ëŠ” gitì— ë“±ë¡ëœ manifest íŒŒì¼ì˜ ë‚´ìš©ê³¼ í˜„ì¬ k8sì˜ ìƒíƒœê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— <code class="language-plaintext highlighter-rouge">OutOfSync</code> ìƒíƒœë¡œ í‘œì‹œë©ë‹ˆë‹¤.</li>
  <li>dev-nginxë¥¼ í´ë¦­í•´ì„œ ë³´ë©´ ë¦¬ì†ŒìŠ¤ì˜ ë°°ì¹˜ì™€ ì–´ë–¤ ë¦¬ì†ŒìŠ¤ê°€ <code class="language-plaintext highlighter-rouge">OutOfSync</code>ì¸ì§€ í‘œì‹œê°€ ë©ë‹ˆë‹¤.</li>
  <li>ë‹¤ìŒ ëª…ë ¹ì„ ì…ë ¥í•´ì„œ applicationì˜ ë°°í¬ìƒíƒœë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl get applications <span class="nt">-n</span> argocd
<span class="c"># =&gt; NAME        SYNC STATUS   HEALTH STATUS</span>
<span class="c">#    dev-nginx   OutOfSync     Missing</span>

<span class="nv">$ </span>kubectl describe applications <span class="nt">-n</span> argocd dev-nginx
<span class="c"># =&gt; ...</span>
<span class="c">#    Events:</span>
<span class="c">#      Type    Reason           Age    From                           Message</span>
<span class="c">#      ----    ------           ----   ----                           -------</span>
<span class="c">#      Normal  ResourceCreated  7m38s  argocd-server                  admin created application</span>
<span class="c">#      Normal  ResourceUpdated  7m     argocd-application-controller  Updated sync status:  -&amp;gt; Unknown</span>
<span class="c">#      Normal  ResourceUpdated  6m58s  argocd-application-controller  Updated health status:  -&amp;gt; Healthy</span>
<span class="c">#      Normal  ResourceUpdated  3m35s  argocd-application-controller  Updated sync status: Unknown -&amp;gt; OutOfSync</span>
<span class="c">#      Normal  ResourceUpdated  3m35s  argocd-application-controller  Updated health status: Healthy -&amp;gt; Missing</span>

<span class="c"># ë°˜ë³µ ì ‘ì† ì‹œë„</span>
<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 1 http://127.0.0.1:30000 <span class="p">;</span> <span class="nb">date</span> <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"------------"</span> <span class="p">;</span> <span class="nb">sleep </span>1 <span class="p">;</span> <span class="k">done</span>
</code></pre></div></div>

<ul>
  <li>ArgoCDì—ì„œ DIFF ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í˜„ì¬ ìƒíƒœì™€ gitì— ë“±ë¡ëœ ìƒíƒœë¥¼ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_31.png" alt="img.png" class="image-center" loading="lazy" width="1022" height="682">
<em class="image-caption">Argo CD Application DIFF í™”ë©´</em>
</li>
  <li>SYNC ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ gitì˜ manifestì— ì§€ì •ëœ ìƒíƒœì™€ k8sì˜ ìƒíƒœë¥¼ ë™ê¸°í™” í•´ë³´ê² ìŠµë‹ˆë‹¤.
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_32.png" alt="img.png" loading="lazy" width="1092" height="700">
</li>
  <li>ë™ê¸°í™”ê°€ ì™„ë£Œë˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë…¸ë€ìƒ‰ í™”ì‚´í‘œ ì•„ì´ì½˜ ëŒ€ì‹  ë…¹ìƒ‰ ì²´í¬í‘œì‹œê°€ ë‚˜ë©´ì„œ <code class="language-plaintext highlighter-rouge">Synced</code> ìƒíƒœë¡œ ë³€ê²½ë©ë‹ˆë‹¤. 
ë˜í•œ ë™ì‹œì— Kubernetesì— NGINXê°€ ë°°í¬ê°€ ì˜ ë˜ì—ˆìŠµë‹ˆë‹¤.
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_33.png" alt="img.png" class="image-center" loading="lazy" width="1081" height="764">
<em class="image-caption">Argo CD Application ë™ê¸°í™” ì™„ë£Œ</em>
</li>
</ul>

<h5 id="ì½”ë“œ-ìˆ˜ì •-í›„-ë°˜ì˜-í™•ì¸">ì½”ë“œ ìˆ˜ì • í›„ ë°˜ì˜ í™•ì¸</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ VERSION</span><span class="o">=</span>1.26.2

<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/VERSION <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
</span><span class="nv">$VERSION</span><span class="sh">
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/values-dev.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
indexHtml: |
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to Nginx!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello, Kubernetes!&lt;/h1&gt;
    &lt;p&gt;DEV : Nginx version </span><span class="nv">$VERSION</span><span class="sh">&lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;

image:
  repository: nginx
  tag: </span><span class="nv">$VERSION</span><span class="sh">

replicaCount: 2
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> nginx-chart/values-prd.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
indexHtml: |
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to Nginx!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello, Kubernetes!&lt;/h1&gt;
    &lt;p&gt;PRD : Nginx version </span><span class="nv">$VERSION</span><span class="sh">&lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;

image:
  repository: nginx
  tag: </span><span class="nv">$VERSION</span><span class="sh">

replicaCount: 2
</span><span class="no">EOF

</span><span class="c">#</span>
<span class="nv">$ </span>git status <span class="o">&amp;&amp;</span> git add <span class="nb">.</span> <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"Update nginx version </span><span class="si">$(</span><span class="nb">cat </span>nginx-chart/VERSION<span class="si">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> git push <span class="nt">-u</span> origin main
<span class="c"># =&gt; On branch main</span>
<span class="c">#    Your branch is up to date with 'origin/main'.</span>
<span class="c">#    </span>
<span class="c">#    Changes not staged for commit:</span>
<span class="c">#      (use &amp;quot;git add &amp;lt;file&amp;gt;...&amp;quot; to update what will be committed)</span>
<span class="c">#      (use &amp;quot;git restore &amp;lt;file&amp;gt;...&amp;quot; to discard changes in working directory)</span>
<span class="c">#            modified:   nginx-chart/VERSION</span>
<span class="c">#            modified:   nginx-chart/values-dev.yaml</span>
<span class="c">#            modified:   nginx-chart/values-prd.yaml</span>
<span class="c">#    </span>
<span class="c">#    no changes added to commit (use &amp;quot;git add&amp;quot; and/or &amp;quot;git commit -a&amp;quot;)</span>
<span class="c">#    [main e1b02a2] Update nginx version 1.26.2</span>
<span class="c">#     3 files changed, 6 insertions(+), 6 deletions(-)</span>
<span class="c">#    Enumerating objects: 11, done.</span>
<span class="c">#    Counting objects: 100% (11/11), done.</span>
<span class="c">#    Delta compression using up to 8 threads</span>
<span class="c">#    Compressing objects: 100% (5/5), done.</span>
<span class="c">#    Writing objects: 100% (6/6), 589 bytes | 589.00 KiB/s, done.</span>
<span class="c">#    Total 6 (delta 2), reused 0 (delta 0), pack-reused 0</span>
<span class="c">#    To http://10.0.4.3:3000/devops/ops-deploy.git</span>
<span class="c">#       2bcfda2..e1b02a2  main -&amp;gt; main</span>
<span class="c">#    branch 'main' set up to track 'origin/main'.</span>
</code></pre></div></div>

<ul>
  <li>Argo CD ì›¹ í™•ì¸ =&gt; REFRESH í´ë¦­
    <ul>
      <li>ArgoCDëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ë™ê¸°í™” ë˜ë‚˜ ë°”ë¡œ í™•ì¸í•˜ë ¤ë©´ REFRESH ë²„íŠ¼ì„ í´ë¦­í•´ì•¼ í•©ë‹ˆë‹¤. (ê¸°ë³¸ ì£¼ê¸°ëŠ” 3ë¶„)
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_34.png" alt="img.png" class="image-center" loading="lazy" width="886" height="233">
</li>
      <li>DIFFë¡œ í™•ì¸í•˜ë©´ manifest íŒŒì¼ì˜ ë³€ê²½ì‚¬í•­ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_35.png" alt="img.png" class="image-center" loading="lazy" width="1108" height="167">
</li>
    </ul>
  </li>
  <li>SYNC &gt; SYNCHRONIZEë¥¼ í´ë¦­í•˜ì—¬ ë™ê¸°í™” í•´ë³´ê² ìŠµë‹ˆë‹¤.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># ë°°í¬í™•ì¸</span>
<span class="nv">$ </span>kubectl get all <span class="nt">-n</span> dev-nginx <span class="nt">-o</span> wide
<span class="c"># =&gt; NAME                             READY   STATUS    RESTARTS   AGE   IP           NODE            NOMINATED NODE   READINESS GATES</span>
<span class="c">#    pod/dev-nginx-5db658bd4f-nfldn   1/1     Running   0          8s    10.244.1.7   myk8s-worker    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    pod/dev-nginx-5db658bd4f-rxmfz   1/1     Running   0          10s   10.244.2.6   myk8s-worker2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;</span>
<span class="c">#    </span>
<span class="c">#    NAME                TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span>
<span class="c">#    service/dev-nginx   NodePort   10.96.233.99   &amp;lt;none&amp;gt;        80:30000/TCP   16m   app=dev-nginx</span>
<span class="c">#    </span>
<span class="c">#    NAME                        READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR</span>
<span class="c">#    deployment.apps/dev-nginx   2/2     2            2           16m   nginx        &lt;span style="color: red;"&gt;nginx:1.26.2&lt;/span&gt;   app=dev-nginx</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ë³€ê²½ëœ ë²„ì „ì´ ì˜ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>
<span class="c">#    </span>
<span class="c">#    NAME                                   DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES         SELECTOR</span>
<span class="c">#    replicaset.apps/dev-nginx-5db658bd4f   2         2         2       11s   nginx        nginx:1.26.2   app=dev-nginx,pod-template-hash=5db658bd4f</span>
<span class="c">#    replicaset.apps/dev-nginx-77d44dfbf6   0         0         0       16m   nginx        nginx:1.26.1   app=dev-nginx,pod-template-hash=77d44dfbf6</span>
</code></pre></div>    </div>
  </li>
  <li>ì—¬ê¸°ì—ì„œ replicasetì€ ê¸°ì¡´ 1.26.1ì´ ë‚¨ì•„ìˆëŠ”ë° ê·¸ê²ƒì€ ArgoCDê°€ Rollbackì„ ì§€ì›í•˜ê¸° ìœ„í•´ ê¸°ì¡´ replicasetì„ ë‚¨ê²¨ì„œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</li>
  <li>ëª‡ê°œì˜ historyë¥¼ ë‚¨ê¸¸ì§€ëŠ” ì„¤ì •ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ArgoCDì›¹ ì—ì„œ APP ì‚­ì œí•˜ê³  ì•„ë˜ì˜ ëª…ë ¹ìœ¼ë¡œ ì‚­ì œ ì§„í–‰ìƒí™©ì„ í™•ì¸í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>watch <span class="nt">-d</span> kubectl get all <span class="nt">-n</span> dev-nginx <span class="nt">-o</span> wide
</code></pre></div></div>

<h4 id="argocd-declarative-setupìœ¼ë¡œ-ë°°í¬-ì‹¤ìŠµ">ArgoCD Declarative Setupìœ¼ë¡œ ë°°í¬ ì‹¤ìŠµ</h4>

<ul>
  <li>ì´ë²ˆì—ëŠ” ArgoCD ì• í”Œë¦¬ì¼€ì´ì…˜ ìì²´ë¥¼ yamlë¡œ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ê³  ë°°í¬í•˜ëŠ” ê³¼ì •ì„ ìë™í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ìì„¸í•œ ì‚¬í•­ì€ ë‹¤ìŒ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì„¸ìš”. <a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/">ArgoCD Declarative Setup - Project, applications, ArgoCD Settings - Docs</a>
</li>
  <li>dev-nginx App ìƒì„± ë° Auto SYNC</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Declarative ë°©ì‹ìœ¼ë¡œ ArgoCD App ìƒì„±</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: dev-nginx
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    helm:
      valueFiles:
      - values-dev.yaml
    path: nginx-chart
    repoURL: http://10.0.4.3:3000/devops/ops-deploy
    targetRevision: HEAD
  syncPolicy:
    automated:
      prune: true
    syncOptions:
    - CreateNamespace=true
  destination:
    namespace: dev-nginx
    server: https://kubernetes.default.svc
</span><span class="no">EOF
</span><span class="c"># =&gt; application.argoproj.io/dev-nginx created</span>

<span class="c">#</span>
<span class="nv">$ </span>kubectl get applications <span class="nt">-n</span> argocd dev-nginx
<span class="c"># =&gt; NAME        SYNC STATUS   HEALTH STATUS</span>
<span class="c">#    dev-nginx   Synced        Healthy</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ automated sync ì •ì±…ì´ì–´ì„œ ë°°í¬ ì§í›„ ë™ê¸°í™” ëœ ìƒíƒœê°€ ë©ë‹ˆë‹¤.&lt;/span&gt;</span>
<span class="nv">$ </span>kubectl get applications <span class="nt">-n</span> argocd dev-nginx <span class="nt">-o</span> yaml | kubectl neat
<span class="nv">$ </span>kubectl describe applications <span class="nt">-n</span> argocd dev-nginx
<span class="c"># =&gt; ...</span>
<span class="c">#    Events:</span>
<span class="c">#      Type    Reason              Age   From                           Message</span>
<span class="c">#      ----    ------              ----  ----                           -------</span>
<span class="c">#      Normal  ResourceUpdated     80s   argocd-application-controller  Updated sync status:  -&amp;gt; Unknown</span>
<span class="c">#      Normal  ResourceUpdated     80s   argocd-application-controller  Updated health status:  -&amp;gt; Healthy</span>
<span class="c">#      Normal  OperationStarted    57s   argocd-application-controller  Initiated automated sync to 'e1b02a29e47a839ebcc93e46ee9da1f2d5320148'</span>
<span class="c">#      Normal  ResourceUpdated     57s   argocd-application-controller  Updated sync status: Unknown -&amp;gt; OutOfSync</span>
<span class="c">#      Normal  ResourceUpdated     57s   argocd-application-controller  Updated health status: Healthy -&amp;gt; Missing</span>
<span class="c">#      Normal  ResourceUpdated     57s   argocd-application-controller  Updated sync status: OutOfSync -&amp;gt; Synced</span>
<span class="c">#      Normal  ResourceUpdated     57s   argocd-application-controller  Updated health status: Missing -&amp;gt; Progressing</span>
<span class="c">#      Normal  OperationCompleted  57s   argocd-application-controller  Sync operation to e1b02a29e47a839ebcc93e46ee9da1f2d5320148 succeeded</span>
<span class="c">#      Normal  ResourceUpdated     55s   argocd-application-controller  Updated health status: Progressing -&amp;gt; Healthy</span>
<span class="nv">$ </span>kubectl get pod,svc,ep,cm <span class="nt">-n</span> dev-nginx
<span class="c"># =&gt; NAME                             READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    pod/dev-nginx-5db658bd4f-blcr6   1/1     Running   0          74s</span>
<span class="c">#    pod/dev-nginx-5db658bd4f-k984k   1/1     Running   0          74s</span>
<span class="c">#    </span>
<span class="c">#    NAME                TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span>
<span class="c">#    service/dev-nginx   NodePort   10.96.176.134   &amp;lt;none&amp;gt;        80:30000/TCP   74s</span>
<span class="c">#    </span>
<span class="c">#    NAME                  ENDPOINTS                     AGE</span>
<span class="c">#    endpoints/dev-nginx   10.244.1.8:80,10.244.2.8:80   74s</span>
<span class="c">#    </span>
<span class="c">#    NAME                         DATA   AGE</span>
<span class="c">#    configmap/dev-nginx          1      74s</span>
<span class="c">#    configmap/kube-root-ca.crt   1      24m</span>

<span class="c">#</span>
<span class="nv">$ </span>curl http://127.0.0.1:30000
<span class="c"># =&gt; &amp;lt;!DOCTYPE html&amp;gt;</span>
<span class="c">#    &amp;lt;html&amp;gt;</span>
<span class="c">#    &amp;lt;head&amp;gt;</span>
<span class="c">#      &amp;lt;title&amp;gt;Welcome to Nginx!&amp;lt;/title&amp;gt;</span>
<span class="c">#    &amp;lt;/head&amp;gt;</span>
<span class="c">#    &amp;lt;body&amp;gt;</span>
<span class="c">#      &amp;lt;h1&amp;gt;Hello, Kubernetes!&amp;lt;/h1&amp;gt;</span>
<span class="c">#      &amp;lt;p&amp;gt;DEV : Nginx version 1.26.2&amp;lt;/p&amp;gt;</span>
<span class="c">#    &amp;lt;/body&amp;gt;</span>
<span class="c">#    &amp;lt;/html&amp;gt;</span>
<span class="nv">$ </span>open http://127.0.0.1:30000

<span class="c"># Argo CD App ì‚­ì œ</span>
<span class="nv">$ </span>kubectl delete applications <span class="nt">-n</span> argocd dev-nginx
<span class="c"># =&gt; application.argoproj.io &amp;quot;dev-nginx&amp;quot; deleted</span>
</code></pre></div></div>

<ul>
  <li>prd-nginx App ìƒì„± ë° Auto SYNC</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prd-nginx
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    namespace: prd-nginx
    server: https://kubernetes.default.svc
  project: default
  source:
    helm:
      valueFiles:
      - values-prd.yaml
    path: nginx-chart
    repoURL: http://10.0.4.3:3000/devops/ops-deploy
    targetRevision: HEAD
  syncPolicy:
    automated:
      prune: true
    syncOptions:
    - CreateNamespace=true
</span><span class="no">EOF
</span><span class="c"># =&gt; application.argoproj.io/prd-nginx created</span>

<span class="c">#</span>
<span class="nv">$ </span>kubectl get applications <span class="nt">-n</span> argocd prd-nginx
<span class="c"># =&gt; NAME        SYNC STATUS   HEALTH STATUS</span>
<span class="c">#    prd-nginx   Synced        Healthy</span>
<span class="nv">$ </span>kubectl describe applications <span class="nt">-n</span> argocd prd-nginx
<span class="c"># =&gt; ...</span>
<span class="c">#    Events:</span>
<span class="c">#      Type    Reason              Age   From                           Message</span>
<span class="c">#      ----    ------              ----  ----                           -------</span>
<span class="c">#      Normal  ResourceUpdated     28s   argocd-application-controller  Updated sync status:  -&amp;gt; Unknown</span>
<span class="c">#      Normal  ResourceUpdated     28s   argocd-application-controller  Updated health status:  -&amp;gt; Healthy</span>
<span class="c">#      Normal  OperationStarted    18s   argocd-application-controller  Initiated automated sync to 'e1b02a29e47a839ebcc93e46ee9da1f2d5320148'</span>
<span class="c">#      Normal  ResourceUpdated     18s   argocd-application-controller  Updated sync status: Unknown -&amp;gt; OutOfSync</span>
<span class="c">#      Normal  ResourceUpdated     18s   argocd-application-controller  Updated health status: Healthy -&amp;gt; Missing</span>
<span class="c">#      Normal  ResourceUpdated     15s   argocd-application-controller  Updated sync status: OutOfSync -&amp;gt; Synced</span>
<span class="c">#      Normal  ResourceUpdated     15s   argocd-application-controller  Updated health status: Missing -&amp;gt; Progressing</span>
<span class="c">#      Normal  OperationCompleted  15s   argocd-application-controller  Sync operation to e1b02a29e47a839ebcc93e46ee9da1f2d5320148 succeeded</span>
<span class="c">#      Normal  ResourceUpdated     13s   argocd-application-controller  Updated health status: Progressing -&amp;gt; Healthy</span>
<span class="nv">$ </span>kubectl get pod,svc,ep,cm <span class="nt">-n</span> prd-nginx
<span class="c"># =&gt; NAME                             READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    pod/prd-nginx-645b5ffbbf-9jp6g   1/1     Running   0          45s</span>
<span class="c">#    pod/prd-nginx-645b5ffbbf-ch6q2   1/1     Running   0          45s</span>
<span class="c">#    </span>
<span class="c">#    NAME                TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span>
<span class="c">#    service/prd-nginx   NodePort   10.96.206.18   &amp;lt;none&amp;gt;        80:30000/TCP   45s</span>
<span class="c">#    </span>
<span class="c">#    NAME                  ENDPOINTS                     AGE</span>
<span class="c">#    endpoints/prd-nginx   10.244.1.9:80,10.244.2.9:80   45s</span>
<span class="c">#    </span>
<span class="c">#    NAME                         DATA   AGE</span>
<span class="c">#    configmap/kube-root-ca.crt   1      47s</span>
<span class="c">#    configmap/prd-nginx          1      45s</span>

<span class="c">#</span>
<span class="nv">$ </span>curl http://127.0.0.1:30000
<span class="c"># =&gt; &amp;lt;!DOCTYPE html&amp;gt;</span>
<span class="c">#    &amp;lt;html&amp;gt;</span>
<span class="c">#    &amp;lt;head&amp;gt;</span>
<span class="c">#      &amp;lt;title&amp;gt;Welcome to Nginx!&amp;lt;/title&amp;gt;</span>
<span class="c">#    &amp;lt;/head&amp;gt;</span>
<span class="c">#    &amp;lt;body&amp;gt;</span>
<span class="c">#      &amp;lt;h1&amp;gt;Hello, Kubernetes!&amp;lt;/h1&amp;gt;</span>
<span class="c">#      &amp;lt;p&amp;gt;PRD : Nginx version 1.26.2&amp;lt;/p&amp;gt;</span>
<span class="c">#    &amp;lt;/body&amp;gt;</span>
<span class="c">#    &amp;lt;/html&amp;gt;</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ PRD nginxê°€ ì˜ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>
<span class="nv">$ </span>open http://127.0.0.1:30000

<span class="c"># Argo CD App ì‚­ì œ</span>
<span class="nv">$ </span>kubectl delete applications <span class="nt">-n</span> argocd prd-nginx
<span class="c"># =&gt; application.argoproj.io &amp;quot;prd-nginx&amp;quot; deleted</span>
</code></pre></div></div>

<h4 id="argocdë¥¼-ì´ìš©í•œ-full-cicd-êµ¬ì„±">ArgoCDë¥¼ ì´ìš©í•œ Full CI/CD êµ¬ì„±</h4>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_36.png" alt="img.png" loading="lazy" width="2048" height="1049"></p>

<ul>
  <li>ìµœì¢…ì ìœ¼ë¡œ ìœ„ì™€ ê°™ì´ CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span><span class="nb">cd </span>ops-deploy
<span class="nv">$ </span><span class="nb">mkdir </span>dev-app

<span class="c"># ë„ì»¤ ê³„ì • ì •ë³´</span>
<span class="c">#$ DHUSER=&lt;ë„ì»¤ í—ˆë¸Œ ê³„ì •&gt;</span>
<span class="nv">$ DHUSER</span><span class="o">=</span>sweetlittlebird

<span class="c"># ë²„ì „ ì •ë³´ </span>
<span class="nv">$ VERSION</span><span class="o">=</span>0.0.1

<span class="c">#</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> dev-app/VERSION <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
</span><span class="nv">$VERSION</span><span class="sh">
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> dev-app/timeserver.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: apps/v1
kind: Deployment
metadata:
  name: timeserver
spec:
  replicas: 2
  selector:
    matchLabels:
      pod: timeserver-pod
  template:
    metadata:
      labels:
        pod: timeserver-pod
    spec:
      containers:
      - name: timeserver-container
        image: docker.io/</span><span class="nv">$DHUSER</span><span class="sh">/dev-app:</span><span class="nv">$VERSION</span><span class="sh">
      imagePullSecrets:
      - name: dockerhub-secret
</span><span class="no">EOF

</span><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> dev-app/service.yaml <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
apiVersion: v1
kind: Service
metadata:
  name: timeserver
spec:
  selector:
    pod: timeserver-pod
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    nodePort: 30000
  type: NodePort
</span><span class="no">EOF

</span><span class="c">#</span>
<span class="nv">$ </span>git status <span class="o">&amp;&amp;</span> git add <span class="nb">.</span> <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"Add dev-app deployment yaml"</span> <span class="o">&amp;&amp;</span> git push <span class="nt">-u</span> origin main
</code></pre></div></div>

<ul>
  <li>ArgoCDì— app ìƒì„±</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: timeserver
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    path: dev-app
    repoURL: http://10.0.4.3:3000/devops/ops-deploy
    targetRevision: HEAD
  syncPolicy:
    automated:
      prune: true
    syncOptions:
    - CreateNamespace=true
  destination:
    namespace: default
    server: https://kubernetes.default.svc
</span><span class="no">EOF
</span><span class="c"># =&gt; application.argoproj.io/timeserver created</span>

<span class="c">#</span>
<span class="nv">$ </span>kubectl get applications <span class="nt">-n</span> argocd timeserver
<span class="c"># =&gt; NAME         SYNC STATUS   HEALTH STATUS</span>
<span class="c">#    timeserver   Synced        Healthy</span>
<span class="nv">$ </span>kubectl get applications <span class="nt">-n</span> argocd timeserver <span class="nt">-o</span> yaml | kubectl neat
<span class="nv">$ </span>kubectl describe applications <span class="nt">-n</span> argocd timeserver
<span class="c"># =&gt; ...</span>
<span class="c">#    Events:</span>
<span class="c">#      Type    Reason              Age   From                           Message</span>
<span class="c">#      ----    ------              ----  ----                           -------</span>
<span class="c">#      Normal  OperationStarted    23s   argocd-application-controller  Initiated automated sync to 'd64cb772abc1646bd74abbd47b688eeb6d59d65a'</span>
<span class="c">#      Normal  ResourceUpdated     23s   argocd-application-controller  Updated sync status:  -&amp;gt; OutOfSync</span>
<span class="c">#      Normal  ResourceUpdated     23s   argocd-application-controller  Updated health status:  -&amp;gt; Missing</span>
<span class="c">#      Normal  ResourceUpdated     23s   argocd-application-controller  Updated sync status: OutOfSync -&amp;gt; Synced</span>
<span class="c">#      Normal  OperationCompleted  23s   argocd-application-controller  Sync operation to d64cb772abc1646bd74abbd47b688eeb6d59d65a succeeded</span>
<span class="c">#      Normal  ResourceUpdated     23s   argocd-application-controller  Updated health status: Missing -&amp;gt; Progressing</span>
<span class="c">#      Normal  ResourceUpdated     21s   argocd-application-controller  Updated health status: Progressing -&amp;gt; Healthy</span>
<span class="nv">$ </span>kubectl get deploy,rs,pod
<span class="c"># =&gt; NAME                         READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    deployment.apps/timeserver   2/2     2            2           42s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                    DESIRED   CURRENT   READY   AGE</span>
<span class="c">#    replicaset.apps/timeserver-549cc9bc89   2         2         2       42s</span>
<span class="c">#    </span>
<span class="c">#    NAME                              READY   STATUS    RESTARTS      AGE</span>
<span class="c">#    pod/curl-pod                      1/1     Running   2 (51m ago)   21h</span>
<span class="c">#    pod/timeserver-549cc9bc89-5bsfm   1/1     Running   0             42s</span>
<span class="c">#    pod/timeserver-549cc9bc89-rwcsz   1/1     Running   0             42s</span>
<span class="nv">$ </span>kubectl get svc,ep timeserver
<span class="c"># =&gt; NAME                 TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span>
<span class="c">#    service/timeserver   NodePort   10.96.45.219   &amp;lt;none&amp;gt;        80:30000/TCP   50s</span>
<span class="c">#    </span>
<span class="c">#    NAME                   ENDPOINTS                       AGE</span>
<span class="c">#    endpoints/timeserver   10.244.1.10:80,10.244.2.10:80   50s</span>

<span class="c">#</span>
<span class="nv">$ </span>curl http://127.0.0.1:30000
<span class="c"># =&gt; The time is 12:16:57 PM, VERSION 0.0.1</span>
<span class="c">#    Server hostname: timeserver-549cc9bc89-5bsfm</span>
<span class="nv">$ </span>open http://127.0.0.1:30000
</code></pre></div></div>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_37.png" alt="img.png" loading="lazy" width="1545" height="594"></p>

<h5 id="dev-app-repo-ì½”ë“œ-ì‘ì—…">dev-app Repo ì½”ë“œ ì‘ì—…</h5>

<ul>
  <li>dev-app Repoì— VERSION ì—…ë°ì´íŠ¸ ì‹œ =&gt; ops-deploy Repo ì— dev-app ì— íŒŒì¼ì— ë²„ì „ ì •ë³´ ì—…ë°ì´íŠ¸ ì‘ì—… ì¶”ê°€
    <ol>
      <li>ê¸°ì¡´ ë²„ì „ ì •ë³´ëŠ” VERSION íŒŒì¼ ë‚´ì— ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ë³€ìˆ˜ ì§€ì • : <code class="language-plaintext highlighter-rouge">OLDVER=$(cat dev-app/VERSION)</code>
</li>
      <li>ì‹ ê·œ ë²„ì „ ì •ë³´ëŠ” environment ë„ì»¤ íƒœê·¸ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ë³€ìˆ˜ ì§€ì • : <code class="language-plaintext highlighter-rouge">NEWVER=$(echo ${DOCKER_TAG})</code>
</li>
      <li>ì´í›„ sed ë¡œ ops-deploy Repo ì— dev-app/VERSION, timeserver.yaml 2ê°œ íŒŒì¼ì— â€˜ê¸°ì¡´ ë²„ì „â€™ â†’ â€˜ì‹ ê·œ ë²„ì „â€™ìœ¼ë¡œ ê°’ ë³€ê²½</li>
      <li>ì´í›„ ops-deploy Repo ì— git push â‡’ Argo CD app ê°€ ìµœëŒ€ 3ë¶„ ì‚¬ì´ì— ë³€ê²½ í™•ì¸ í›„ AutoSync ë¡œ ì‹ ê·œ ë²„ì „ ì—…ë°ì´íŠ¸ ì§„í–‰</li>
    </ol>
  </li>
  <li>ì•„ë˜ëŠ” dev-app ì— ìœ„ì¹˜í•œ Jenkinsfileë¡œ ì  í‚¨ìŠ¤ì— SCM-Pipeline (SCM:git) ìœ¼ë¡œ ì‚¬ìš©ë˜ê³  ìˆëŠ” íŒŒì¼ì„ ìˆ˜ì •í•´ì„œ ì‹¤ìŠµì— ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Jenkinsfile</span>
pipeline <span class="o">{</span>
    agent any
    environment <span class="o">{</span>
        DOCKER_IMAGE <span class="o">=</span> <span class="s1">'sweetlittlebird/dev-app'</span> // Docker ì´ë¯¸ì§€ ì´ë¦„
        GOGSCRD <span class="o">=</span> credentials<span class="o">(</span><span class="s1">'gogs-crd'</span><span class="o">)</span>
    <span class="o">}</span>
    stages <span class="o">{</span>
        stage<span class="o">(</span><span class="s1">'dev-app Checkout'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                 git branch: <span class="s1">'main'</span>,
                 url: <span class="s1">'http://10.0.4.3:3000/devops/dev-app.git'</span>,  // Gitì—ì„œ ì½”ë“œ ì²´í¬ì•„ì›ƒ
                 credentialsId: <span class="s1">'gogs-crd'</span>  // Credentials ID
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'Read VERSION'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                script <span class="o">{</span>
                    // VERSION íŒŒì¼ ì½ê¸°
                    def version <span class="o">=</span> readFile<span class="o">(</span><span class="s1">'VERSION'</span><span class="o">)</span>.trim<span class="o">()</span>
                    <span class="nb">echo</span> <span class="s2">"Version found: </span><span class="k">${</span><span class="nv">version</span><span class="k">}</span><span class="s2">"</span>
                    // í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
                    env.DOCKER_TAG <span class="o">=</span> version
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'Docker Build and Push'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                script <span class="o">{</span>
                    docker.withRegistry<span class="o">(</span><span class="s1">'https://index.docker.io/v1/'</span>, <span class="s1">'dockerhub-crd'</span><span class="o">)</span> <span class="o">{</span>
                        // DOCKER_TAG ì‚¬ìš©
                        def appImage <span class="o">=</span> docker.build<span class="o">(</span><span class="s2">"</span><span class="k">${</span><span class="nv">DOCKER_IMAGE</span><span class="k">}</span><span class="s2">:</span><span class="k">${</span><span class="nv">DOCKER_TAG</span><span class="k">}</span><span class="s2">"</span><span class="o">)</span>
                        appImage.push<span class="o">()</span>
                        appImage.push<span class="o">(</span><span class="s2">"latest"</span><span class="o">)</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'ops-deploy Checkout'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                 git branch: <span class="s1">'main'</span>,
                 url: <span class="s1">'http://10.0.4.3:3000/devops/ops-deploy.git'</span>,  // Gitì—ì„œ ì½”ë“œ ì²´í¬ì•„ì›ƒ
                 credentialsId: <span class="s1">'gogs-crd'</span>  // Credentials ID
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'ops-deploy version update push'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                sh <span class="s1">'''
                OLDVER=$(cat dev-app/VERSION)
                NEWVER=$(echo ${DOCKER_TAG})
                sed -i -e "s/$OLDVER/$NEWVER/" dev-app/timeserver.yaml
                sed -i -e "s/$OLDVER/$NEWVER/" dev-app/VERSION
                git add ./dev-app
                git config user.name "devops"
                git config user.email "a@a.com"
                git commit -m "version update ${DOCKER_TAG}"
                git push http://${GOGSCRD_USR}:${GOGSCRD_PSW}@10.0.4.3:3000/devops/ops-deploy.git
                '''</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    post <span class="o">{</span>
        success <span class="o">{</span>
            <span class="nb">echo</span> <span class="s2">"Docker image </span><span class="k">${</span><span class="nv">DOCKER_IMAGE</span><span class="k">}</span><span class="s2">:</span><span class="k">${</span><span class="nv">DOCKER_TAG</span><span class="k">}</span><span class="s2"> has been built and pushed successfully!"</span>
        <span class="o">}</span>
        failure <span class="o">{</span>
            <span class="nb">echo</span> <span class="s2">"Pipeline failed. Please check the logs."</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>ì•„ë˜ëŠ” dev-app (Repo) ì—ì„œ VERSIONê³¼ server.py ìˆ˜ì • í›„ git pushë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># VERSION íŒŒì¼ ìˆ˜ì • : 0.0.4</span>
<span class="c"># server.py íŒŒì¼ ìˆ˜ì • : 0.0.4</span>

<span class="c"># git push : VERSION, server.py, Jenkinsfile</span>
git add <span class="nb">.</span> <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"VERSION </span><span class="si">$(</span><span class="nb">cat </span>VERSION<span class="si">)</span><span class="s2"> Changed"</span> <span class="o">&amp;&amp;</span> git push <span class="nt">-u</span> origin main
</code></pre></div></div>
<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_38.png" alt="img.png" loading="lazy" width="976" height="286"></p>

<ul>
  <li>ArgoCD ì›¹ì—ì„œ ë™ì‘ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
  <li>Jenkins Pipelineì´ ì‹¤í–‰ë˜ë©´ì„œ dev-app Repoì˜ ë²„ì „ ì •ë³´ê°€ ë³€ê²½ë˜ê³ , ops-deploy Repoì˜ dev-app/VERSION íŒŒì¼ê³¼ timeserver.yaml íŒŒì¼ì´ 
ë³€ê²½ë˜ì–´ ArgoCDê°€ ë³€ê²½ì‚¬í•­ì„ ê°ì§€í•˜ê³  ìë™ìœ¼ë¡œ ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</li>
  <li>REFRESH ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ArgoCD WebHook ì„¤ì •ì‹œ ì¦‰ì‹œ ë°˜ì˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_39.png" alt="img.png" loading="lazy" width="1451" height="631"></p>

<ul>
  <li>dev-app Repoì—ì„œ ëª‡ë²ˆ ë” ë²„ì „ì„ ì—…ë°ì´íŠ¸ í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># VERSION íŒŒì¼ ìˆ˜ì • : 0.0.5</span>
<span class="c"># server.py íŒŒì¼ ìˆ˜ì • : 0.0.5</span>

<span class="c"># git push : VERSION, server.py, Jenkinsfile</span>
<span class="nv">$ </span>git add <span class="nb">.</span> <span class="o">&amp;&amp;</span> git commit <span class="nt">-m</span> <span class="s2">"VERSION </span><span class="si">$(</span><span class="nb">cat </span>VERSION<span class="si">)</span><span class="s2"> Changed"</span> <span class="o">&amp;&amp;</span> git push <span class="nt">-u</span> origin main
<span class="c"># =&gt; [main 881d051] VERSION 0.0.5 Changed</span>
<span class="c">#     2 files changed, 2 insertions(+), 2 deletions(-)</span>
<span class="c">#    Enumerating objects: 7, done.</span>
<span class="c">#    Counting objects: 100% (7/7), done.</span>
<span class="c">#    Delta compression using up to 8 threads</span>
<span class="c">#    Compressing objects: 100% (3/3), done.</span>
<span class="c">#    Writing objects: 100% (4/4), 329 bytes | 329.00 KiB/s, done.</span>
<span class="c">#    Total 4 (delta 2), reused 0 (delta 0), pack-reused 0</span>
<span class="c">#    To http://10.0.4.3:3000/devops/dev-app.git</span>
<span class="c">#       1d4cec2..881d051  main -&amp;gt; main</span>
<span class="c">#    branch 'main' set up to track 'origin/main'.</span>

<span class="c"># ë°°í¬ ê²°ê³¼ í™•ì¸</span>
<span class="nv">$ </span>curl http://127.0.0.1:30000
<span class="c"># =&gt; The time is 12:34:14 PM, VERSION 0.0.5</span>
<span class="c">#    Server hostname: timeserver-7546694df7-wds9r</span>
</code></pre></div></div>

<ul>
  <li>CI/CDê°€ ì˜ ë™ì‘í•˜ì—¬ ìµœì‹ ë²„ì „ì´ ë°°í¬ë¨ì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<hr>

<h3 id="argo-rollout--k8skind">Argo Rollout + K8S(Kind)</h3>

<ul>
  <li>ArgoëŠ” ArgoCD ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ í”„ë¡œì íŠ¸ë¥¼ ì œê³µí•˜ê³  ìˆìœ¼ë©°, ê·¸ì¤‘ì˜ í•˜ë‚˜ê°€ Argo Rolloutì…ë‹ˆë‹¤.</li>
  <li>Argo Rolloutì€ Kubernetesì˜ Deployment, StatefulSet, DaemonSet, Job, CronJob ë“±ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ëŒ€ì²´í•˜ì—¬ ë¡¤ì•„ì›ƒì„ ê´€ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì…ë‹ˆë‹¤.</li>
  <li>ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. <a href="https://argoproj.github.io/argo-rollouts/concepts/">ë¬¸ì„œ</a>
    <ul>
      <li>Blue-Green ì—…ë°ì´íŠ¸ ì „ëµ
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_40.png" alt="img.png" class="image-center" loading="lazy" width="600" height="776">
</li>
      <li>Canary ì—…ë°ì´íŠ¸ ì „ëµ
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_41.png" alt="img_1.png" class="image-center" loading="lazy" width="600" height="776">
</li>
      <li>ì„¸ë°€í•˜ê³  ê°€ì¤‘ì¹˜ê°€ ë¶€ì—¬ëœ íŠ¸ë˜í”½ ì „í™˜</li>
      <li>ìë™í™”ëœ ë¡¤ë°± ë° í”„ë¡œëª¨ì…˜</li>
      <li>ìˆ˜ë™ íŒë‹¨</li>
      <li>ì‚¬ìš©ì ì •ì˜ ê°€ëŠ¥í•œ ë©”íŠ¸ë¦­ ì¿¼ë¦¬ ë° ë¹„ì¦ˆë‹ˆìŠ¤ KPI ë¶„ì„</li>
      <li>ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ í†µí•©: NGINX, ALB, Apache APISIX</li>
      <li>ì„œë¹„ìŠ¤ ë©”ì‰¬ í†µí•©: Istio, Linkerd, SMI</li>
      <li>ì—¬ëŸ¬ ì œê³µìì˜ ë™ì‹œ ì‚¬ìš©: SMI + NGINX, Istio + ALB ë“±</li>
      <li>ë©”íŠ¸ë¦­ ì œê³µì í†µí•©: Prometheus, Wavefront, Kayenta, Web, Kubernetes Jobs, Datadog, New Relic, Graphite, InfluxDB</li>
    </ul>
  </li>
</ul>

<h5 id="argo-rollout-ì„¤ì¹˜-ë°-ì‹¤ìŠµ">Argo Rollout ì„¤ì¹˜ ë° ì‹¤ìŠµ</h5>

<ul>
  <li>Argo Rolloutì„ ì„¤ì¹˜í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„± ë° íŒŒë¼ë¯¸í„° íŒŒì¼ ì‘ì„±</span>
<span class="nv">$ </span>kubectl create ns argo-rollouts
<span class="c"># =&gt; namespace/argo-rollouts created</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh"> &gt; argorollouts-values.yaml
dashboard:
  enabled: true
  service:
    type: NodePort
    nodePort: 30003
</span><span class="no">EOT

</span><span class="c"># ì„¤ì¹˜</span>
<span class="nv">$ </span>helm <span class="nb">install </span>argo-rollouts argo/argo-rollouts <span class="nt">--version</span> 2.35.1 <span class="nt">-f</span> argorollouts-values.yaml <span class="nt">--namespace</span> argo-rollouts
<span class="c"># =&gt; NAME: argo-rollouts</span>
<span class="c">#    LAST DEPLOYED: Sun Oct 01 23:05:23 2024</span>
<span class="c">#    NAMESPACE: argo-rollouts</span>
<span class="c">#    STATUS: deployed</span>
<span class="c">#    REVISION: 1</span>
<span class="c">#    TEST SUITE: None</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get all <span class="nt">-n</span> argo-rollouts
<span class="c"># =&gt; NAME                                           READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    pod/argo-rollouts-86469b5878-j6p5k             1/1     Running   0          42s</span>
<span class="c">#    pod/argo-rollouts-86469b5878-vlr6z             1/1     Running   0          43s</span>
<span class="c">#    pod/argo-rollouts-dashboard-7c88d965fc-l6lml   1/1     Running   0          43s</span>
<span class="c">#    </span>
<span class="c">#    NAME                              TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span>
<span class="c">#    service/argo-rollouts-dashboard   NodePort   10.96.195.148   &amp;lt;none&amp;gt;        3100:30003/TCP   43s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    deployment.apps/argo-rollouts             2/2     2            2           43s</span>
<span class="c">#    deployment.apps/argo-rollouts-dashboard   1/1     1            1           43s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                                 DESIRED   CURRENT   READY   AGE</span>
<span class="c">#    replicaset.apps/argo-rollouts-86469b5878             2         2         2       43s</span>
<span class="c">#    replicaset.apps/argo-rollouts-dashboard-7c88d965fc   1         1         1       43s</span>
<span class="nv">$ </span>kubectl get crds
<span class="c"># =&gt; NAME                                   CREATED AT</span>
<span class="c">#    analysisruns.argoproj.io               2024-10-01T14:05:24Z</span>
<span class="c">#    analysistemplates.argoproj.io          2024-10-01T14:05:24Z</span>
<span class="c">#    applications.argoproj.io               2024-10-01T07:54:01Z</span>
<span class="c">#    applicationsets.argoproj.io            2024-10-01T07:54:01Z</span>
<span class="c">#    appprojects.argoproj.io                2024-10-01T07:54:01Z</span>
<span class="c">#    clusteranalysistemplates.argoproj.io   2024-10-01T14:05:24Z</span>
<span class="c">#    experiments.argoproj.io                2024-10-01T14:05:24Z</span>
<span class="c">#    rollouts.argoproj.io                   2024-10-01T14:05:24Z</span>

<span class="c"># Argo rollouts ëŒ€ì‹œë³´ë“œ ì ‘ì† ì£¼ì†Œ í™•ì¸</span>
<span class="nv">$ </span>open <span class="s2">"http://127.0.0.1:30003"</span>
</code></pre></div></div>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_42.png" alt="img.png" loading="lazy" width="1050" height="382"></p>

<ul>
  <li>Argo Rolloutì„ ì´ìš©í•´ì„œ ë°°í¬ë¥¼ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run the following command to deploy the initial Rollout and Service:</span>
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/argoproj/argo-rollouts/master/docs/getting-started/basic/rollout.yaml
<span class="c"># =&gt; rollout.argoproj.io/rollouts-demo created</span>
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/argoproj/argo-rollouts/master/docs/getting-started/basic/service.yaml
<span class="c"># =&gt; service/rollouts-demo created</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get rollout
<span class="c"># =&gt; NAME            DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c">#    rollouts-demo   5         5         5            5           16s</span>
<span class="nv">$ </span>kubectl describe rollout
<span class="c"># =&gt; ...</span>
<span class="c">#    Events:</span>
<span class="c">#      Type    Reason                  Age   From                 Message</span>
<span class="c">#      ----    ------                  ----  ----                 -------</span>
<span class="c">#      Normal  RolloutAddedToInformer  25s   rollouts-controller  Rollout resource added to informer: default/rollouts-demo</span>
<span class="c">#      Normal  RolloutNotCompleted     25s   rollouts-controller  Rollout not completed, started update to revision 1 (687d76d795)</span>
<span class="c">#      Normal  RolloutUpdated          25s   rollouts-controller  Rollout updated to revision 1</span>
<span class="c">#      Normal  NewReplicaSetCreated    25s   rollouts-controller  Created ReplicaSet rollouts-demo-687d76d795 (revision 1)</span>
<span class="c">#      Normal  ScalingReplicaSet       25s   rollouts-controller  Scaled up ReplicaSet rollouts-demo-687d76d795 (revision 1) from 0 to 5</span>
<span class="c">#      Normal  RolloutCompleted        25s   rollouts-controller  Rollout completed update to revision 1 (687d76d795): Initial deploy</span>

<span class="nv">$ </span>kubectl get pod <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>rollouts-demo
<span class="c"># =&gt; NAME                             READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    rollouts-demo-687d76d795-7pbl9   1/1     Running   0          46s</span>
<span class="c">#    rollouts-demo-687d76d795-bnl2c   1/1     Running   0          46s</span>
<span class="c">#    rollouts-demo-687d76d795-ggzsq   1/1     Running   0          46s</span>
<span class="c">#    rollouts-demo-687d76d795-vtnlj   1/1     Running   0          46s</span>
<span class="c">#    rollouts-demo-687d76d795-xmk2x   1/1     Running   0          46s</span>
<span class="nv">$ </span>kubectl get svc,ep rollouts-demo
<span class="c"># =&gt; NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span>
<span class="c">#    service/rollouts-demo   ClusterIP   10.96.237.173   &amp;lt;none&amp;gt;        80/TCP    47s</span>
<span class="c">#    </span>
<span class="c">#    NAME                      ENDPOINTS                                                        AGE</span>
<span class="c">#    endpoints/rollouts-demo   10.244.1.14:8080,10.244.1.15:8080,10.244.1.16:8080 + 2 more...   47s</span>
<span class="nv">$ </span>kubectl get rollouts rollouts-demo <span class="nt">-o</span> yaml | kubectl neat
<span class="c"># =&gt; ...</span>
<span class="c">#    spec:</span>
<span class="c">#      replicas: 5</span>
<span class="c">#      revisionHistoryLimit: 2</span>
<span class="c">#      selector:</span>
<span class="c">#        matchLabels:</span>
<span class="c">#          app: rollouts-demo</span>
<span class="c">#      strategy:</span>
<span class="c">#        canary:</span>
<span class="c">#          steps:</span>
<span class="c">#          - setWeight: 20</span>
<span class="c">#          - setWeight: 40</span>
<span class="c">#          - pause:</span>
<span class="c">#              duration: 10</span>
<span class="c">#          - setWeight: 60</span>
<span class="c">#          - pause:</span>
<span class="c">#              duration: 10</span>
<span class="c">#          - setWeight: 80</span>
<span class="c">#          - pause:</span>
<span class="c">#              duration: 10</span>
<span class="c">#      ...</span>
</code></pre></div></div>

<ul>
  <li>
    <p>ìš°ì¸¡ìƒë‹¨ì˜ NAMESPACEë¥¼ defaultë¡œ ë³€ê²½í•˜ê³  rollout-demoë¥¼ í´ë¦­í•˜ë©´ ë‹¤ìŒì˜ rollout í™”ë©´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
<img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_43.png" alt="img.png" loading="lazy" width="1176" height="754"></p>
  </li>
  <li>
    <p>rollouts-demo:blueë¥¼ rollouts-demo:yellowë¡œ ë³€ê²½í•´ì„œ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl edit rollouts rollouts-demo
...
     - image: argoproj/rollouts-demo:yellow
...
<span class="c"># =&gt; rollout.argoproj.io/rollouts-demo edited</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ìœ„ì™€ ê°™ì´ rollouts-demo/blueë¥¼ rollouts-demo/yellowë¡œ ë³€ê²½í•©ë‹ˆë‹¤.&lt;/span&gt;</span>

<span class="c"># íŒŒë“œ label ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>watch <span class="nt">-d</span> kubectl get pod <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>rollouts-demo <span class="nt">-owide</span> <span class="nt">--show-labels</span>
</code></pre></div></div>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_44.png" alt="img.png" loading="lazy" width="1297" height="1120"></p>

<ul>
  <li>ìœ„ì™€ê°™ì´ yellowê°€ 20% ë§Œí¼ canary ë°°í¬ë˜ê³  ì •ì ìƒíƒœì— ìˆìŠµë‹ˆë‹¤.</li>
  <li>Promote ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë³´ê² ìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_45.png" alt="img.png" loading="lazy" width="570" height="144"></p>

<ul>
  <li>ì •í•´ì§„ rollout ruleì— ë”°ë¼ 10ì´ˆì”© ëŒ€ê¸° í›„ 20%ì”© canary ë°°í¬ ë¹„ìœ¨ì„ ë†’ì—¬ì„œ ìµœì¢…ì ìœ¼ë¡œ ì „ì²´ê°€ yellowë¡œ ë°°í¬ë©ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2024/cicd-lite/w3/20241221_cicd_lite_w3_46.png" alt="img.png" loading="lazy" width="1141" height="858"></p>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>ì´ë²ˆì£¼ì—ëŠ” ìƒê°ë³´ë‹¤ ì‹¤ìŠµëŸ‰ì´ ë§ì•„ì„œ ì‹œê°„ì´ ë§ì´ ê±¸ë ¸ìŠµë‹ˆë‹¤. 
í•˜ì§€ë§Œ, K8Sì— CI/CD ë°°í¬í•˜ëŠ”ê²ƒê³¼ ArgoCDì™€ Argo Rolloutì„ ì´ìš©í•œ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì„±ì„ ê²½í—˜í•´ë³¼ ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ìŠµë‹ˆë‹¤.
íŠ¹íˆ ArgoCDì™€ Argo Rolloutì€ ì›¹ UIëŠ” ì¡°ê¸ˆ ë‚ ê²ƒ ëŠë‚Œì´ ë‚¬ì§€ë§Œ,
ê¸°ëŠ¥ì´ë‚˜ ì»¨ì…‰ ìì²´ëŠ” ì¢‹ì€ê²ƒ ê°™ê³ , 
ì„ ì–¸ì ì¸ ë°©ì‹ì´ë‚˜ CLIë¥¼ í†µí•´ì„œ ìë™í™”í•  ìˆ˜ ìˆìœ¼ë‹ˆ ë‹¤ì–‘í•˜ê²Œ í™œìš©í•  ìˆ˜ ìˆì„ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ìŠ¤í„°ë”” ì»¨ì…‰ì´ CI/CD ë§›ë³´ê¸°ì—¬ì„œ ê°€ë²¼ìš´ ë§ˆìŒìœ¼ë¡œ ì‹œì‘í–ˆëŠ”ë°
ì‹¤ì œ ìŠ¤í„°ë””ëŠ” ê°€ë³ì§€ ì•Šì•˜ë˜ê²ƒ ê°™ìŠµë‹ˆë‹¤.<br>
ì´ ë§›ì— ìŠ¤í„°ë””í•©ë‹ˆë‹¤. 
<img class="emoji" title=":sweat_smile:" alt=":sweat_smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f605.png" height="20" width="20" loading="lazy"> ë§›ë³´ê¸°ê°€ ì´ ì •ë„ì´ë‹ˆ ë³¸í¸ì€ ì–¼ë§ˆë‚˜ ê¹Šê³  ë„“ì„ì§€ ê¸°ëŒ€ê°€ ë©ë‹ˆë‹¤.</p>

<p>ì—°ë§ì— ì–´ìˆ˜ì„ í•œ ê°€ìš´ë° ë‹¤ë“¤ ìŠ¤í„°ë”” ì°¸ì—¬í•˜ì‹  ë¶„ë“¤ ëª¨ë‘ ê³ ìƒ ë§ìœ¼ì…¨ê³ , 
ì§„í–‰í•´ì£¼ì‹  ê°€ì‹œë‹¤ë‹˜ê»˜ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.</p>

<p>ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. 
í•œ í•´ ë§ˆë¬´ë¦¬ ì˜ í•˜ì‹œê³ , ê±´ê°•í•œ ëª¨ìŠµìœ¼ë¡œ ë‚´ë…„ì— ë˜ ëµ™ê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤. <img class="emoji" title=":bow:" alt=":bow:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f647.png" height="20" width="20" loading="lazy"><img class="emoji" title=":bowing_woman:" alt=":bowing_woman:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f647-2640.png" height="20" width="20" loading="lazy"></p>

  </div>

  <div id="toc-minimap" class="toc-minimap collapsed">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">ë“¤ì–´ê°€ë©°</a></li>
<li class="toc-entry toc-h2">
<a href="#jenkins-ciargocd--k8s">Jenkins CI/ArgoCD + K8S</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#%EC%8B%A4%EC%8A%B5%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1">ì‹¤ìŠµí™˜ê²½ êµ¬ì„±</a>
<ul>
<li class="toc-entry toc-h4"><a href="#jenkins-gogs-%EC%84%A4%EC%B9%98">Jenkins, Gogs ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h4"><a href="#jenkins-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%B4%88%EA%B8%B0%EC%84%A4%EC%A0%95">Jenkins ì»¨í…Œì´ë„ˆ ì´ˆê¸°ì„¤ì •</a></li>
<li class="toc-entry toc-h4"><a href="#gogs-%EC%B4%88%EA%B8%B0-%EC%84%A4%EC%A0%95">Gogs ì´ˆê¸° ì„¤ì •</a></li>
<li class="toc-entry toc-h4"><a href="#%EB%8F%84%EC%BB%A4-%ED%97%88%EB%B8%8C--%EC%84%A4%EC%A0%95">ë„ì»¤ í—ˆë¸Œ  ì„¤ì •</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#jenkins-ci--k8s-kind">Jenkins CI + K8S (Kind)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#kind-%EC%86%8C%EA%B0%9C-%EB%B0%8F-%EC%84%A4%EC%B9%98">Kind ì†Œê°œ ë° ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h4"><a href="#kind%EB%A1%9C-kubernetes-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EB%B0%B0%ED%8F%AC---3%EB%85%B8%EB%93%9C">Kindë¡œ Kubernetes í´ëŸ¬ìŠ¤í„° ë°°í¬ - 3ë…¸ë“œ</a></li>
<li class="toc-entry toc-h4"><a href="#jenkins-%EC%84%A4%EC%A0%95--plugin-%EC%84%A4%EC%B9%98-%EC%9E%90%EA%B2%A9%EC%A6%9D%EB%AA%85-%EC%84%A4%EC%A0%95">Jenkins ì„¤ì • : Plugin ì„¤ì¹˜, ìê²©ì¦ëª… ì„¤ì •</a></li>
<li class="toc-entry toc-h4"><a href="#kubernetes-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%EC%97%90-%EC%9D%91%EC%9A%A9%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0">Kubernetes í´ëŸ¬ìŠ¤í„°ì— ì‘ìš©í”„ë¡œê·¸ë¨ ë°°í¬í•˜ê¸°</a></li>
<li class="toc-entry toc-h4"><a href="#k8s%EC%97%90-docker-hub-%EC%9D%B8%EC%A6%9D%ED%86%A0%ED%81%B0-%EB%93%B1%EB%A1%9D-%ED%9B%84-%EB%8B%A4%EC%8B%9C-%EB%B0%B0%ED%8F%AC">K8Sì— Docker Hub ì¸ì¦í† í° ë“±ë¡ í›„ ë‹¤ì‹œ ë°°í¬</a></li>
<li class="toc-entry toc-h4"><a href="#gogs-webhook%EC%9D%84-%ED%86%B5%ED%95%B4-jenkins-pipeline-%EC%9E%90%EB%8F%99%ED%99%94">Gogs Webhookì„ í†µí•´ Jenkins Pipeline ìë™í™”</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#jenkins-cicd--k8s-kind">Jenkins CI/CD + K8S (Kind)</a></li>
<li class="toc-entry toc-h3">
<a href="#jenkins-ci--argocd--k8s-kind">Jenkins CI + ArgoCD + K8S (Kind)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#argocd-%EC%86%8C%EA%B0%9C">ArgoCD ì†Œê°œ</a></li>
<li class="toc-entry toc-h4"><a href="#argocd-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EA%B8%B0%EB%B3%B8%EC%84%A4%EC%A0%95">ArgoCD ì„¤ì¹˜ ë° ê¸°ë³¸ì„¤ì •</a></li>
<li class="toc-entry toc-h4"><a href="#helm-chart%EB%A5%BC-%ED%86%B5%ED%95%9C-%EB%B0%B0%ED%8F%AC-%EC%8B%A4%EC%8A%B5">Helm chartë¥¼ í†µí•œ ë°°í¬ ì‹¤ìŠµ</a></li>
<li class="toc-entry toc-h4"><a href="#argocd-declarative-setup%EC%9C%BC%EB%A1%9C-%EB%B0%B0%ED%8F%AC-%EC%8B%A4%EC%8A%B5">ArgoCD Declarative Setupìœ¼ë¡œ ë°°í¬ ì‹¤ìŠµ</a></li>
<li class="toc-entry toc-h4"><a href="#argocd%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-full-cicd-%EA%B5%AC%EC%84%B1">ArgoCDë¥¼ ì´ìš©í•œ Full CI/CD êµ¬ì„±</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#argo-rollout--k8skind">Argo Rollout + K8S(Kind)</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">ë§ˆì¹˜ë©°</a></li>
</ul>
  </div>
<a class="u-url" href="/posts/2024-12-22-CICD-Lite-Week3/" hidden></a>
</article>



<div class="PageNavigation">
  
  <a class="prev" href="/posts/2024-12-14-CICD-Lite-Week2/">Â« [CI/CD] GitHub Actions CI/CD</a>
  
  
  <a class="next" href="/posts/2025-06-28-MacOS-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%ED%9B%84-Magnet%EC%9D%B4-%EC%9E%90%EB%8F%99-%EC%8B%9C%EC%9E%91%EC%9D%B4-%EC%95%88-%EB%90%A0-%EB%95%8C-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95/">MacOS ì—…ë°ì´íŠ¸ í›„ Magnetì´ ìë™ ì‹œì‘ì´ ì•ˆ ë  ë•Œ í•´ê²° ë°©ë²• Â»</a>
  
</div>

<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = "https://sweetlittlebird.github.io/posts/2024-12-22-CICD-Lite-Week3/";
this.page.identifier = "/posts/CICD Lite - Week3";
};
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
      </div>

<!--      <div class="adsbygoogle-side">-->
<!--        &lt;!&ndash; ad_side &ndash;&gt;-->
<!--        <ins class="adsbygoogle "-->
<!--             style="display: block"-->
<!--             data-ad-client="ca-pub-6564723532026864"-->
<!--             data-ad-slot="1339398797"-->
<!--             data-ad-format="auto"-->
<!--             data-full-width-responsive="true"></ins>-->
<!--      </div>-->
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Sweet Little Bird</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Sweet Little Bird</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/sweetlittlebird"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sweetlittlebird</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>ê³µë¶€ ê¸°ë¡ê³¼ ê°œë°œ ì´ì•¼ê¸°ë¥¼ ë‹´ì€ ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.</p>
      </div>
    </div>

  </div>

</footer>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
      <!-- Background of PhotoSwipe. 
           It's a separate element as animating opacity is faster than rgba(). -->
      <div class="pswp__bg"></div>
      <!-- Slides wrapper with overflow:hidden. -->
      <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
          <div class="pswp__top-bar">
            <!--  Controls are self-explanatory. Order can be changed. -->
            <div class="pswp__counter"></div>
            <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
            <button class="pswp__button pswp__button--share" title="Share"></button>
            <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
            <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
            <!-- element will get class pswp__preloader--active when preloader is running -->
            <div class="pswp__preloader">
              <div class="pswp__preloader__icn">
                <div class="pswp__preloader__cut">
                  <div class="pswp__preloader__donut"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
            <div class="pswp__share-tooltip"></div>
          </div>
          <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
          </button>
          <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
          </button>
          <div class="pswp__caption">
            <div class="pswp__caption__center"></div>
          </div>
        </div>
      </div>
    </div>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EWGY9N8QXY"></script>

    
    <script async src="/assets/dist/app.min.js"></script>
    
  
    <a href="#" id="back-to-top"><span>Back to Top</span></a>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6564723532026864" crossorigin="anonymous"></script>
    <!--<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>-->
  </body>

</html>
