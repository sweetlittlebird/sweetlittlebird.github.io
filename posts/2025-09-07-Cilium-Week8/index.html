<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[Cilium] Cilium Security &amp; Tetragon | Sweet Little Bird</title>
<meta name="generator" content="Jekyll v4.3.3">
<meta property="og:title" content="[Cilium] Cilium Security &amp; Tetragon">
<meta property="og:locale" content="ko">
<meta name="description" content="ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Ciliumì˜ Securityì™€ eBPF ê¸°ë°˜ì˜ ëŸ°íƒ€ì„ ë³´ì•ˆ ë° ê´€ì°° ë„êµ¬ì¸ Tetragon ëŒ€í•´ ì‹¤ìŠµì„ í†µí•˜ì—¬ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.">
<meta property="og:description" content="ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Ciliumì˜ Securityì™€ eBPF ê¸°ë°˜ì˜ ëŸ°íƒ€ì„ ë³´ì•ˆ ë° ê´€ì°° ë„êµ¬ì¸ Tetragon ëŒ€í•´ ì‹¤ìŠµì„ í†µí•˜ì—¬ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.">
<link rel="canonical" href="https://sweetlittlebird.github.io/posts/2025-09-07-Cilium-Week8/">
<meta property="og:url" content="https://sweetlittlebird.github.io/posts/2025-09-07-Cilium-Week8/">
<meta property="og:site_name" content="Sweet Little Bird">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-09-07T00:10:18+09:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="[Cilium] Cilium Security &amp; Tetragon">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-09-07T00:10:18+09:00","datePublished":"2025-09-07T00:10:18+09:00","description":"ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Ciliumì˜ Securityì™€ eBPF ê¸°ë°˜ì˜ ëŸ°íƒ€ì„ ë³´ì•ˆ ë° ê´€ì°° ë„êµ¬ì¸ Tetragon ëŒ€í•´ ì‹¤ìŠµì„ í†µí•˜ì—¬ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.","headline":"[Cilium] Cilium Security &amp; Tetragon","mainEntityOfPage":{"@type":"WebPage","@id":"https://sweetlittlebird.github.io/posts/2025-09-07-Cilium-Week8/"},"url":"https://sweetlittlebird.github.io/posts/2025-09-07-Cilium-Week8/"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/dist/photoswipe.min.css">
  <link rel="stylesheet" href="/assets/dist/main.min.css">
  <link rel="stylesheet" href="/assets/dist/main_dark.min.css" media="(prefers-color-scheme: dark)">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pretendard/1.3.9/static/pretendard.css" integrity="sha512-NzqTHTrO48HsIamogmIaVhTXoSgRF24Cn+ynrNYrFuKrY0AdDbmcNieiOHsQARS/r0Gax9VwV3/rVMHs3ipUlg==" crossorigin="anonymous" referrerpolicy="no-referrer">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!--  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&display=swap" rel="stylesheet">-->
  <link href="https://fonts.googleapis.com/css2?family=Elsie+Swash+Caps:wght@400;900&amp;family=Milonga&amp;display=swap" rel="stylesheet">

  <link rel="shortcut icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/favicon/favicon.ico" type="image/x-icon">
<link type="application/atom+xml" rel="alternate" href="https://sweetlittlebird.github.io/feed.xml" title="Sweet Little Bird">
</head>
<body class="body--contents">
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Sweet Little Bird</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/about/">ì†Œê°œ</a><a class="page-link" href="/posts/">ê¸€ ëª©ë¡</a>
</div>
      </nav>
</div>
  
  <span id="scroll-indicator"></span>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[Cilium] Cilium Security &amp; Tetragon</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-09-07T00:10:18+09:00" itemprop="datePublished">2025ë…„ 09ì›” 07ì¼ì— ì‘ì„±
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="table-of-content">
      <header>ëª©ì°¨</header>
      <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">ë“¤ì–´ê°€ë©°</a></li>
<li class="toc-entry toc-h2"><a href="#%EC%8B%A4%EC%8A%B5%ED%99%98%EA%B2%BD-%EB%B0%B0%ED%8F%AC">ì‹¤ìŠµí™˜ê²½ ë°°í¬</a></li>
<li class="toc-entry toc-h2">
<a href="#cilium-security-%EA%B3%B5%EC%8B%9D%EB%AC%B8%EC%84%9C">Cilium Security ê³µì‹ë¬¸ì„œ</a>
<ul>
<li class="toc-entry toc-h3"><a href="#cilium%EC%9D%B4-%EC%A0%9C%EA%B3%B5%ED%95%98%EB%8A%94-%EB%B3%B4%EC%95%88-%EA%B0%9C%EC%9A%94">Ciliumì´ ì œê³µí•˜ëŠ” ë³´ì•ˆ ê°œìš”</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#cilium-security-%EC%8B%A4%EC%8A%B5">Cilium Security ì‹¤ìŠµ</a>
<ul>
<li class="toc-entry toc-h3"><a href="#-lab1-locking-down-external-access-with-dns-based-policies">ğŸ”¬ Lab1. Locking Down External Access with DNS-Based Policies</a></li>
<li class="toc-entry toc-h3"><a href="#transparent-encryption-with-wireguard">Transparent Encryption with WireGuard</a></li>
<li class="toc-entry toc-h3"><a href="#-lab2-wireguard-%EC%84%A4%EC%A0%95-%EB%B0%8F-%EC%8B%A4%EC%8A%B5">ğŸ”¬ Lab2. WireGuard ì„¤ì • ë° ì‹¤ìŠµ</a></li>
<li class="toc-entry toc-h3"><a href="#inspecting-tls-encrypted-connections">Inspecting TLS Encrypted Connections</a></li>
<li class="toc-entry toc-h3"><a href="#-lab3-tls-interception-%EC%8B%A4%EC%8A%B5">ğŸ”¬ Lab3. TLS Interception ì‹¤ìŠµ</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#tetragon">Tetragon</a>
<ul>
<li class="toc-entry toc-h3"><a href="#tetragon-%EC%86%8C%EA%B0%9C">Tetragon ì†Œê°œ</a></li>
<li class="toc-entry toc-h3"><a href="#tetragon-%EC%84%A4%EC%B9%98">Tetragon ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h3"><a href="#%EC%8B%A4%ED%96%89-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81">ì‹¤í–‰ ëª¨ë‹ˆí„°ë§</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%8C%8C%EC%9D%BC-%EC%A0%91%EC%86%8D-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81">íŒŒì¼ ì ‘ì† ëª¨ë‹ˆí„°ë§</a></li>
<li class="toc-entry toc-h3"><a href="#policy-enforcement">Policy Enforcement</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">ë§ˆì¹˜ë©°</a></li>
</ul>
    </div>
    <h2 id="ë“¤ì–´ê°€ë©°">ë“¤ì–´ê°€ë©°</h2>

<p>ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Ciliumì˜ Securityì™€ eBPF ê¸°ë°˜ì˜ ëŸ°íƒ€ì„ ë³´ì•ˆ ë° ê´€ì°° ë„êµ¬ì¸ Tetragon ëŒ€í•´ ì‹¤ìŠµì„ í†µí•˜ì—¬ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>

<hr>

<h2 id="ì‹¤ìŠµí™˜ê²½-ë°°í¬">ì‹¤ìŠµí™˜ê²½ ë°°í¬</h2>

<ul>
  <li>ì‹¤ìŠµ í™˜ê²½ ì†Œê°œ
    <ul>
      <li>ì‹¤ìŠµ í™˜ê²½ : k8s(1.33.4), cilium(1.18.1) - ê¸°ë³¸ ë°°í¬ ê°€ìƒ ë¨¸ì‹  : k8s-ctr, k8s-w1, k8s-w2</li>
      <li>ì´ë²ˆ ì‹¤ìŠµì—ëŠ” ì›Œì»¤ ë…¸ë“œê°„ ë³´ì•ˆ ì •ì±…ì„ ì ìš©í•˜ê³  í†µì‹  ì•”í˜¸í™” ë“±ì„ ì‚´í´ë³´ê¸° ìœ„í•´ì„œ ì›Œì»¤ë…¸ë“œë¥¼ 2ê°œ ë‘ëŠ” êµ¬ì„±ì„ í•˜ì˜€ìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì‹¤ìŠµ í™˜ê²½ ë°°í¬</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>cilium-lab <span class="o">&amp;&amp;</span> <span class="nb">cd </span>cilium-lab
<span class="nv">$ </span>curl <span class="nt">-O</span> https://raw.githubusercontent.com/gasida/vagrant-lab/refs/heads/main/cilium-study/8w/Vagrantfile
<span class="nv">$ </span>vagrant up
<span class="c"># =&gt; ...</span>
<span class="c">#    ==&gt; k8s-w2: Running provisioner: shell...</span>
<span class="c">#        k8s-w2: Running: /var/folders/7k/qy6rsdds57z3tmyn9_7hhd8r0000gn/T/vagrant-shell20250905-16290-5f5n6v.sh</span>
<span class="c">#        k8s-w2: &gt;&gt;&gt;&gt; K8S Node config Start &lt;&lt;&lt;&lt;</span>
<span class="c">#        k8s-w2: [TASK 1] K8S Controlplane Join</span>
<span class="c">#        k8s-w2: &gt;&gt;&gt;&gt; K8S Node config End &lt;&lt;&lt;&lt;</span>
<span class="nv">$ </span>vagrant ssh k8s-ctr
</code></pre></div></div>

<hr>

<h2 id="cilium-security-ê³µì‹ë¬¸ì„œ">Cilium Security ê³µì‹ë¬¸ì„œ</h2>

<h3 id="ciliumì´-ì œê³µí•˜ëŠ”-ë³´ì•ˆ-ê°œìš”">Ciliumì´ ì œê³µí•˜ëŠ” ë³´ì•ˆ ê°œìš”</h3>

<ul>
  <li><a href="https://docs.cilium.io/en/stable/security/network/intro/">ê´€ë ¨ë¬¸ì„œ</a></li>
  <li>Ciliumì€ í¬ê²Œ ë‹¤ìŒì˜ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
    <ul>
      <li>Identity-Based (Layer3)</li>
      <li>Port Level (Layer4)</li>
      <li>Application protocol Level (Layer7)</li>
    </ul>
  </li>
  <li>
<strong>Cilium ë³´ì•ˆ ì •ì±…ì˜ íŠ¹ì§•</strong>
    <ul>
      <li>
<strong>ì •ì±…ì´ ì—†ëŠ” ê²½ìš°</strong>, ê¸°ë³¸ì ìœ¼ë¡œ <strong>ëª¨ë“  íŠ¸ë˜í”½ì´ í—ˆìš©</strong>ë©ë‹ˆë‹¤.</li>
      <li>ì²«ë²ˆì§¸ ì •ì±… <strong>ê·œì¹™ì´ ì ìš©ë˜ë©´</strong>, <strong>í—ˆìš©ëœ íŠ¸ë˜í”½ì„ ì œì™¸í•œ ëª¨ë“  íŠ¸ë˜í”½ì´ ì°¨ë‹¨</strong>ë©ë‹ˆë‹¤.</li>
      <li>ì„¸ì…˜ ê¸°ë°˜ í”„ë¡œí† ì½œì— ëŒ€í•´ <strong>ìƒíƒœì €ì¥ ì •ì±…ì´ ì ìš©</strong>ë˜ë©°, <strong>ì‘ë‹µ íŒ¨í‚·ì€ ìë™ìœ¼ë¡œ í—ˆìš©</strong>ë©ë‹ˆë‹¤. - <a href="https://docs.cilium.io/en/stable/security/network/policyenforcement/#policy-enforcement">ê´€ë ¨ë¬¸ì„œ</a>
</li>
    </ul>
  </li>
  <li>
<strong>Envoy Proxy í†µí•©</strong> - <a href="https://docs.cilium.io/en/stable/security/network/proxy/envoy/">Docs</a>
<img src="/assets/2025/cilium/w8/20250907_cilium_w8_2.png" alt="img.png" class="image-center" loading="lazy" width="1090" height="627">
<em class="image-caption"><a href="https://docs.cilium.io/en/stable/security/network/proxy/envoy/">https://docs.cilium.io/en/stable/security/network/proxy/envoy/</a></em>
    <ul>
      <li>Ciliumì€ Envoy Proxyì™€ í†µí•©ë˜ì–´ Layer7 ë³´ì•ˆ ì •ì±…ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>Envoy ProxyëŠ” L7 í”„ë¡ì‹œë¡œì„œ HTTP, gRPC, Kafka ë“±ì˜ í”„ë¡œí† ì½œì„ ì§€ì›í•©ë‹ˆë‹¤.</li>
      <li>Envoy Proxyë¥¼ í†µí•´ ì„¸ë°€í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì˜ ë³´ì•ˆ ì •ì±…ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
<strong>íˆ¬ëª…í•œ ì•”í˜¸í™”</strong> :
IPSec or WireGuard ë¡œ Cilium ê´€ë¦¬í•˜ëŠ” í˜¸ìŠ¤íŠ¸ íŠ¸ë˜í”½ê³¼ ì—”ë“œí¬ì¸íŠ¸ ê°„ íŠ¸ë˜í”½ì˜ íˆ¬ëª…í•œ ì•”í˜¸í™” ì§€ì›í•©ë‹ˆë‹¤. - <a href="https://docs.cilium.io/en/stable/security/network/encryption/">Docs</a> , <a href="https://www.youtube.com/watch?v=vj7M-t9MK6s">Youtube</a>
<img src="/assets/2025/cilium/w8/20250907_cilium_w8_4.png" alt="img.png" loading="lazy" width="691" height="284">
    <ul>
      <li>ê° ëª¨ë“œì˜ ë‹¨ì 
        <ul>
          <li>IPSec : BPF í˜¸ìŠ¤íŠ¸ ë¼ìš°íŒ…ì—ì„œëŠ” ë¯¸ë™ì‘í•˜ë©°, IPsec í„°ë„ë‹¹ ë‹¨ì¼ CPU ì½”ì–´ë¡œ ì œí•œë©ë‹ˆë‹¤. - <a href="https://docs.cilium.io/en/stable/security/network/encryption-ipsec/">Docs</a>
</li>
          <li>WireGuard : í„°ë„ ëª¨ë“œ(VXLAN, GENEVE)ì—ì„œëŠ” ë‘ ë²ˆ ìº¡ìŠí™”ë©ë‹ˆë‹¤. - <a href="https://docs.cilium.io/en/stable/security/network/encryption-wireguard/">Docs</a> , <a href="https://www.youtube.com/watch?v=-awkPi3D60E">Youtube</a>
</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="identity-ê¸°ë°˜-ë³´ì•ˆ-ì •ì±…---docs">Identity ê¸°ë°˜ ë³´ì•ˆ ì •ì±… - <a href="https://docs.cilium.io/en/stable/gettingstarted/terminology/#identity">Docs</a>
</h5>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_1.png" alt="img.png" class="image-center w-60" loading="lazy" width="1346" height="632">
<em class="image-caption">Identity <a href="https://docs.cilium.io/en/stable/security/network/identity/">https://docs.cilium.io/en/stable/security/network/identity/</a></em></p>
<ul>
  <li>Ciliumì€ Podì— IPì£¼ì†Œê°€ ì•„ë‹Œ Identityë¥¼ ë¶€ì—¬í•˜ê³  Identityë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë³´ì•ˆ ì •ì±…ì„ ì ìš©í•©ë‹ˆë‹¤.</li>
  <li>IdentityëŠ” Namespace, Labels, ServiceAccount ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</li>
  <li>Podì˜ IPì£¼ì†ŒëŠ” ë³€ê²½ë  ìˆ˜ ìˆì§€ë§Œ, IdentityëŠ” ë³€ê²½ë˜ê¸° ë•Œë¬¸ì— ë³´ì•ˆ ì •ì±…ì´ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë˜í•œ ë™ì¼í•œ Security Relevant Labelsë¥¼ ê°€ì§„ Podë“¤ì€ ë™ì¼í•œ Identityë¥¼ ê³µìœ í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get ciliumendpoints.cilium.io <span class="nt">-n</span> kube-system
<span class="c"># =&gt; NAME                              SECURITY IDENTITY   ENDPOINT STATE   IPV4           IPV6</span>
<span class="c">#    coredns-674b8bbfcf-2njqx          &lt;span style="color: green;"&gt;15719&lt;/span&gt;               ready            172.20.0.37</span>
<span class="c">#    coredns-674b8bbfcf-gwsh5          &lt;span style="color: green;"&gt;15719&lt;/span&gt;               ready            172.20.0.1</span>
<span class="c">#    hubble-relay-fdd49b976-t5sms      64548               ready            172.20.0.102</span>
<span class="c">#    hubble-ui-655f947f96-vjkrg        3186                ready            172.20.0.197</span>
<span class="c">#    metrics-server-5dd7b49d79-rbbwk   883                 ready            172.20.0.166 </span>

<span class="nv">$ </span>kubectl get ciliumidentities.cilium.io 
<span class="c"># =&gt; NAME    NAMESPACE            AGE</span>
<span class="c">#    &lt;span style="color: green;"&gt;15719&lt;/span&gt;   kube-system          57m</span>
<span class="c">#    2887    cilium-monitoring    57m</span>
<span class="c">#    3186    kube-system          57m</span>
<span class="c">#    38953   local-path-storage   57m</span>
<span class="c">#    61576   cilium-monitoring    57m</span>
<span class="c">#    64548   kube-system          57m</span>
<span class="c">#    883     kube-system          57m</span>
</code></pre></div></div>

<ul>
  <li>identity ë¶€ì—¬ ê³¼ì •
    <ul>
      <li>Pod ë˜ëŠ” Containerê°€ ìƒì„±ë˜ë©´, Ciliumì€ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ë°ˆì—ì„œ ìˆ˜ì§‘í•œ ì´ë²¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ì—ì„œ Pod ë˜ëŠ” Containerë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
      <li>ì—”ë“œí¬ì¸íŠ¸ì˜ IDëŠ” ì—”ë“œí¬ì¸íŠ¸ì—ì„œ íŒŒìƒëœ Pod ë˜ëŠ” Containerì™€ ì—°ê´€ëœ ë ˆì´ë¸”ì„ ê¸°ë°˜ìœ¼ë¡œ ê²°ì •ë©ë‹ˆë‹¤.</li>
      <li>ë‹¤ìŒ ë‹¨ê³„ë¡œ Ciliumì€ ìƒì„±ëœ ì—”ë“œí¬ì¸íŠ¸ì˜ IDë¥¼ í™•ì¸í•˜ë©°, Pod ë˜ëŠ” Containerì˜ ë ˆì´ë¸”ì´ ë³€ê²½ë˜ë©´ ì—”ë“œí¬ì¸íŠ¸ IDê°€ ì¬í™•ì¸ ë˜ë©° í•„ìš”ì—ë”°ë¼ ë³€ê²½ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h5 id="cilium-identity-ì •ë³´-í™•ì¸-ë°-ë³€ê²½-ì‹¤ìŠµ">Cilium Identity ì •ë³´ í™•ì¸ ë° ë³€ê²½ ì‹¤ìŠµ</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get ciliumidentities.cilium.io 15719 <span class="nt">-o</span> yaml | yq
<span class="c"># =&gt; {</span>
<span class="c">#      "apiVersion": "cilium.io/v2",</span>
<span class="c">#      "kind": "CiliumIdentity",</span>
<span class="c">#      "metadata": {</span>
<span class="c">#        "creationTimestamp": "2025-09-05T14:14:26Z",</span>
<span class="c">#        "generation": 1,</span>
<span class="c">#        "labels": {</span>
<span class="c">#          "io.kubernetes.pod.namespace": "kube-system"</span>
<span class="c">#        },</span>
<span class="c">#        "name": "15719",</span>
<span class="c">#        "resourceVersion": "796",</span>
<span class="c">#        "uid": "e3b7045e-5a91-47fc-abff-0d8f86330dbf"</span>
<span class="c">#      },</span>
<span class="c">#      "security-labels": {</span>
<span class="c">#        "k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name": "kube-system",</span>
<span class="c">#        "k8s:io.cilium.k8s.policy.cluster": "default",</span>
<span class="c">#        "k8s:io.cilium.k8s.policy.serviceaccount": "coredns",</span>
<span class="c">#        "k8s:io.kubernetes.pod.namespace": "kube-system",</span>
<span class="c">#        "k8s:k8s-app": "kube-dns"</span>
<span class="c">#      }</span>
<span class="c">#    }</span>

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium identity list
<span class="c"># =&gt; ...</span>
<span class="c">#    15719   k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name=kube-system</span>
<span class="c">#            k8s:io.cilium.k8s.policy.cluster=default</span>
<span class="c">#            k8s:io.cilium.k8s.policy.serviceaccount=coredns</span>
<span class="c">#            k8s:io.kubernetes.pod.namespace=kube-system</span>
<span class="c">#            k8s:k8s-app=kube-dns</span>
<span class="c">#    ...</span>

<span class="nv">$ </span>kubectl get pod <span class="nt">-n</span> kube-system <span class="nt">-l</span> k8s-app<span class="o">=</span>kube-dns <span class="nt">--show-labels</span>
<span class="c"># =&gt; NAME                       READY   STATUS    RESTARTS   AGE   LABELS</span>
<span class="c">#    coredns-674b8bbfcf-2njqx   1/1     Running   0          65m   k8s-app=kube-dns,pod-template-hash=674b8bbfcf</span>
<span class="c">#    coredns-674b8bbfcf-gwsh5   1/1     Running   0          65m   k8s-app=kube-dns,pod-template-hash=674b8bbfcf</span>

<span class="c"># ê¸°ë™ ì¤‘ì¸ íŒŒë“œì— label ì¶”ê°€ í›„ cilium id(ë³´ì•ˆ label)ì— ë°˜ì˜ ë ì§€? : ë°˜ì˜ë˜ëŠ”ê°€? ì–¼ë§ˆë‚˜ ì‹œê°„ì´ ê±¸ë¦¬ëŠ”ê°€? IDê°€ ë³€ê²½ë˜ì§€ëŠ” ì•ŠëŠ”ê°€?</span>
<span class="nv">$ </span>kubectl label pods <span class="nt">-n</span> kube-system <span class="nt">-l</span> k8s-app<span class="o">=</span>kube-dns <span class="nv">study</span><span class="o">=</span>8w
<span class="c"># =&gt; pod/coredns-674b8bbfcf-2njqx labeled</span>
<span class="c">#    pod/coredns-674b8bbfcf-gwsh5 labeled</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium identity list
<span class="c"># =&gt; ...</span>
<span class="c">#    15719   k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name=kube-system</span>
<span class="c">#            k8s:io.cilium.k8s.policy.cluster=default</span>
<span class="c">#            k8s:io.cilium.k8s.policy.serviceaccount=coredns</span>
<span class="c">#            k8s:io.kubernetes.pod.namespace=kube-system</span>
<span class="c">#            k8s:k8s-app=kube-dns</span>
<span class="c">#    &lt;span style="color: green;"&gt;38787   k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name=kube-system&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:io.cilium.k8s.policy.cluster=default&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:io.cilium.k8s.policy.serviceaccount=coredns&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:io.kubernetes.pod.namespace=kube-system&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:k8s-app=kube-dns&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:study=8w&lt;/span&gt;</span>
<span class="c">#    ...</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ study=8w ë¼ë²¨ì— ëŒ€í•œ ìƒˆë¡œìš´ ID(38787)ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤..&lt;/span&gt;</span>

<span class="c"># (ìœ„ ë‚´ìš© í™•ì¸ í›„ ì•„ë˜ ì§„í–‰) coredns deployment ì— spec.template.metadata.labelsì— ì•„ë˜ ì¶”ê°€ ì‹œ ë°˜ì˜ í™•ì¸</span>
<span class="nv">$ </span>kubectl edit deploy <span class="nt">-n</span> kube-system coredns
<span class="nt">---</span>
...
  template:
    metadata:
      labels:
        app: testing
        k8s-app: kube-dns
...
<span class="nt">---</span>
<span class="c"># =&gt; deployment.apps/coredns edited</span>

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium identity list
<span class="c"># =&gt; ...</span>
<span class="c">#    &lt;span style="color: green;"&gt;30461   k8s:app=testing&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name=kube-system&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:io.cilium.k8s.policy.cluster=default&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:io.cilium.k8s.policy.serviceaccount=coredns&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:io.kubernetes.pod.namespace=kube-system&lt;/span&gt;</span>
<span class="c">#            &lt;span style="color: green;"&gt;k8s:k8s-app=kube-dns&lt;/span&gt;</span>
<span class="c">#    ...</span>
</code></pre></div></div>

<ul>
  <li>Ciliumì€ pod update ì´ë²¤íŠ¸ë¥¼ watchí•˜ë¯€ë¡œ, labels ë³€ê²½ ì‹œ endpointê°€ waiting-for-identity ìƒíƒœë¡œ ì „í™˜ë˜ì–´ ìƒˆë¡œìš´ identityë¥¼ í• ë‹¹ë°›ìŠµë‹ˆë‹¤.
ì´ë¡œ ì¸í•´ security labelsì™€ ê´€ë ¨ëœ ë„¤íŠ¸ì›Œí¬ ì •ì±…ë„ ìë™ìœ¼ë¡œ ì¬ì ìš©ë©ë‹ˆë‹¤.</li>
  <li>ì˜ˆì‹œ:
    <ul>
      <li>ê°„ë‹¨í•œ pod(simple-pod)ë¥¼ ìƒì„±í•˜ë©´ ì´ˆê¸° security identity(ì˜ˆ: 26830)ê°€ í• ë‹¹ë©ë‹ˆë‹¤.</li>
      <li>ì´í›„ <code class="language-plaintext highlighter-rouge">kubectl label pod/simple-pod run=not-simple-pod --overwrite</code>ë¡œ labelsë¥¼ ë³€ê²½í•˜ë©´, <code class="language-plaintext highlighter-rouge">kubectl get ciliumendpoints</code> ëª…ë ¹ì—ì„œ identityê°€ ìƒˆ ê°’(ì˜ˆ: 8710)ìœ¼ë¡œ ì—…ë°ì´íŠ¸ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” policy enforcementì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ë‹¨, ëŒ€ê·œëª¨ í´ëŸ¬ìŠ¤í„°ì—ì„œ ìì£¼ labelsë¥¼ ë³€ê²½í•˜ë©´ identity í• ë‹¹ì´ ë¹ˆë²ˆí•´ì ¸ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, identity-relevant labelsë¥¼ ì œí•œí•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤</li>
</ul>

<h5 id="special-identities">Special Identities</h5>

<ul>
  <li>Ciliumì—ì„œ ê´€ë¦¬í•˜ëŠ” ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ëŠ” IDê°€ í• ë‹¹ ë©ë‹ˆë‹¤.</li>
  <li>Ciliumì—ì„œ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ì—”ë“œí¬ì¸íŠ¸ì˜ í†µì‹ ì„ í—ˆìš©í•˜ê¸° ìœ„í•´ì„œ íŠ¹ìˆ˜ IDë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
  <li>ì˜ˆì•½ëœ íŠ¹ìˆ˜ IDì—ëŠ” <code class="language-plaintext highlighter-rouge">reserved</code>ë¼ëŠ” ì ‘ë‘ì‚¬ê°€ ë¶™ìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì˜ˆì•½ëœ íŠ¹ìˆ˜ ID í™•ì¸ </span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium identity list
<span class="c"># =&gt; ID      LABELS</span>
<span class="c">#    1       reserved:host</span>
<span class="c">#            reserved:kube-apiserver</span>
<span class="c">#    2       reserved:world</span>
<span class="c">#    3       reserved:unmanaged</span>
<span class="c">#    4       reserved:health</span>
<span class="c">#    5       reserved:init</span>
<span class="c">#    6       reserved:remote-node</span>
<span class="c">#    7       reserved:kube-apiserver</span>
<span class="c">#            reserved:remote-node</span>
<span class="c">#    8       reserved:ingress</span>
<span class="c">#    9       reserved:world-ipv4</span>
<span class="c">#    10      reserved:world-ipv6</span>
<span class="c">#    ...</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>Identity</strong></th>
      <th><strong>ìˆ«ìID</strong></th>
      <th><strong>ì„¤ëª…</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:unknown</code></td>
      <td>0</td>
      <td>IDì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:host</code></td>
      <td>1</td>
      <td>ë¡œì»¬ í˜¸ìŠ¤íŠ¸. ë¡œì»¬ í˜¸ìŠ¤íŠ¸ IP ì¤‘ í•˜ë‚˜ì—ì„œ ì‹œì‘ë˜ê±°ë‚˜ ì§€ì •ëœ ëª¨ë“  íŠ¸ë˜í”½ì…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:world</code></td>
      <td>2</td>
      <td>í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì˜ ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì—”ë“œí¬ì¸íŠ¸</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:unmanaged</code></td>
      <td>3</td>
      <td>Ciliumì—ì„œ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ì—”ë“œí¬ì¸íŠ¸, ì˜ˆë¥¼ ë“¤ì–´ Ciliumì´ ì„¤ì¹˜ë˜ê¸° ì „ì— ì‹œì‘ëœ Kubernetes Podì…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:health</code></td>
      <td>4</td>
      <td>Cilium ì—ì´ì „íŠ¸ê°€ ìƒì„±í•œ ìƒíƒœ í™•ì¸ íŠ¸ë˜í”½ì…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:init</code></td>
      <td>5</td>
      <td>IDê°€ ì•„ì§ í™•ì¸ë˜ì§€ ì•Šì€ ì—”ë“œí¬ì¸íŠ¸ì—ëŠ” init IDê°€ í• ë‹¹ë©ë‹ˆë‹¤. ì´ëŠ” ë³´ì•ˆ IDë¥¼ ë„ì¶œí•˜ëŠ” ë° í•„ìš”í•œ ì¼ë¶€ ë©”íƒ€ë°ì´í„°ê°€ ì•„ì§ ì—†ëŠ” ì—”ë“œí¬ì¸íŠ¸ ë‹¨ê³„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë¶€íŠ¸ìŠ¤íŠ¸ë˜í•‘ ë‹¨ê³„ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. init IDëŠ” ì—”ë“œí¬ì¸íŠ¸ ìƒì„± ì‹œì ì— ë ˆì´ë¸”ì„ ì•Œ ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ë§Œ í• ë‹¹ë©ë‹ˆë‹¤. Docker í”ŒëŸ¬ê·¸ì¸ì˜ ê²½ìš°ê°€ ì—¬ê¸°ì— í•´ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:remote-node</code></td>
      <td>6</td>
      <td>ëª¨ë“  ì›ê²© í´ëŸ¬ìŠ¤í„° í˜¸ìŠ¤íŠ¸ì˜ ì§‘í•©ì…ë‹ˆë‹¤. ë¡œì»¬ ë…¸ë“œë¥¼ ì œì™¸í•œ ì—°ê²°ëœ í´ëŸ¬ìŠ¤í„° ë‚´ ëª¨ë“  í˜¸ìŠ¤íŠ¸ì˜ IP ì¤‘ í•˜ë‚˜ì—ì„œ ì‹œì‘ë˜ê±°ë‚˜ í•´ë‹¹ IPë¡œ ì§€ì •ëœ ëª¨ë“  íŠ¸ë˜í”½ì…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:kube-apiserver</code></td>
      <td>7</td>
      <td>kube-apiserverë¥¼ ì‹¤í–‰í•˜ëŠ” ë°±ì—”ë“œê°€ ìˆëŠ” ì›ê²© ë…¸ë“œì…ë‹ˆë‹¤.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">reserved:ingress</code></td>
      <td>8</td>
      <td>Ingress í”„ë¡ì‹œ ì—°ê²°ì— ëŒ€í•œ ì†ŒìŠ¤ ì£¼ì†Œë¡œ ì‚¬ìš©ë˜ëŠ” IPì— ì œê³µë©ë‹ˆë‹¤.</td>
    </tr>
  </tbody>
</table>

<h5 id="í´ëŸ¬ìŠ¤í„°ì—ì„œì˜-identity-ê´€ë¦¬">í´ëŸ¬ìŠ¤í„°ì—ì„œì˜ Identity ê´€ë¦¬</h5>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_5.png" alt="img.png" loading="lazy" width="1450" height="795"></p>

<ul>
  <li>IDëŠ” ì „ì²´ í´ëŸ¬ìŠ¤í„°ì—ì„œ ìœ íš¨í•©ë‹ˆë‹¤.
    <ul>
      <li>ì¦‰, ì—¬ëŸ¬ í´ëŸ¬ìŠ¤í„° ë…¸ë“œì—ì„œ ì—¬ëŸ¬ ê°œì˜ í¬ë“œ ë˜ëŠ” ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë˜ë”ë¼ë„ ID ê´€ë ¨ ë ˆì´ë¸”ì„ ê³µìœ í•˜ëŠ” ê²½ìš° ëª¨ë“  í¬ë“œ ë˜ëŠ” ì»¨í…Œì´ë„ˆê°€ ë‹¨ì¼ IDë¥¼ ê³µìœ í•©ë‹ˆë‹¤.</li>
      <li>ì´ë¥¼ ìœ„í•´ì„œëŠ” í´ëŸ¬ìŠ¤í„° ë…¸ë“œ ê°„ì˜ ì¡°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>ì—”ë“œí¬ì¸íŠ¸ IDë¥¼ í™•ì¸í•˜ëŠ” ì‘ì—…ì€ <strong>ë¶„ì‚° í‚¤-ê°’ ì €ì¥ì†Œ</strong>ë¥¼ í†µí•´ ìˆ˜í–‰ë©ë‹ˆë‹¤.</li>
  <li>ë¶„ì‚° í‚¤-ê°’ ì €ì¥ì†ŒëŠ” <em>ë‹¤ìŒ ê°’ì´ ì´ì „ì— í™•ì¸ë˜ì§€ ì•Šì€ ê²½ìš° ìƒˆë¡œìš´ ê³ ìœ  ì‹ë³„ìë¥¼ ìƒì„±í•˜ëŠ”</em> í˜•íƒœì˜ ì›ìì  ì—°ì‚°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.</li>
  <li>ì´ë¥¼ í†µí•´ ê° í´ëŸ¬ìŠ¤í„° ë…¸ë“œëŠ” ID ê´€ë ¨ ë ˆì´ë¸” í•˜ìœ„ ì§‘í•©ì„ ìƒì„±í•œ ë‹¤ìŒ í‚¤-ê°’ ì €ì¥ì†Œë¥¼ ì¿¼ë¦¬í•˜ì—¬ IDë¥¼ ë„ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë ˆì´ë¸” ì§‘í•©ì´ ì´ì „ì— ì¿¼ë¦¬ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ì— ë”°ë¼ ìƒˆ IDê°€ ìƒì„±ë˜ê±°ë‚˜ ì´ˆê¸° ì¿¼ë¦¬ì˜ IDê°€ ë°˜í™˜ë©ë‹ˆë‹¤.</li>
</ul>

<h5 id="networkpolicy--3ê°€ì§€-í˜•ì‹-ì œê³µ---docs">NetworkPolicy : 3ê°€ì§€ í˜•ì‹ ì œê³µ - <a href="https://docs.cilium.io/en/stable/network/kubernetes/policy/">Docs</a>
</h5>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_6.png" alt="img.png" class="image-center" loading="lazy" width="2048" height="1395">
<em class="image-caption"><a href="https://isovalent.com/blog/post/intro-to-cilium-network-policies/">https://isovalent.com/blog/post/intro-to-cilium-network-policies/</a></em></p>

<ul>
  <li>
<strong>í‘œì¤€ Network Policy</strong> : Podì˜ ingress ë˜ëŠ” egress ì‹œ L3 ë° L4 ì •ì±…ì„ ì§€ì›í•˜ëŠ” <strong>í‘œì¤€</strong> <a href="https://docs.cilium.io/en/stable/network/kubernetes/policy/#networkpolicy">NetworkPolicy ë¦¬ì†ŒìŠ¤ì…ë‹ˆë‹¤.</a>
</li>
  <li>
<strong>í™•ì¥ CiliumNetworkPolicy</strong> : <strong>3~7 ê³„ì¸µ</strong>ì—ì„œ <strong>ìˆ˜ì‹ </strong> ë° <strong>ì†¡ì‹ </strong> ëª¨ë‘ì— ëŒ€í•œ ì •ì±… ì§€ì •ì„ ì§€ì›í•˜ëŠ” <a href="https://docs.cilium.io/en/stable/glossary/#term-CustomResourceDefinition">CustomResourceDefinition</a> ìœ¼ë¡œ ì œê³µë˜ëŠ” í™•ì¥ëœ <a href="https://docs.cilium.io/en/stable/network/kubernetes/policy/#ciliumnetworkpolicy">CiliumNetworkPolicy í˜•ì‹ì…ë‹ˆë‹¤.</a>
</li>
  <li>
<strong>CiliumClusterwideNetworkPolicy</strong> : <a href="https://docs.cilium.io/en/stable/network/kubernetes/policy/#ciliumclusterwidenetworkpolicy">CiliumClusterwideNetworkPolicy</a> í˜•ì‹ ì€ Ciliumì—ì„œ ì ìš©í•  <strong>í´ëŸ¬ìŠ¤í„° ì „ì²´ ì •ì±…ì„ ì§€ì •</strong>í•˜ëŠ” í´ëŸ¬ìŠ¤í„° ë²”ìœ„ <a href="https://docs.cilium.io/en/stable/glossary/#term-CustomResourceDefinition">CustomResourceDefinition</a> ì…ë‹ˆë‹¤. ì´ ì‚¬ì–‘ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ì§€ì •ë˜ì§€ ì•Šì€ <a href="https://docs.cilium.io/en/stable/network/kubernetes/policy/#ciliumnetworkpolicy">CiliumNetworkPolicy</a> ì™€ ë™ì¼í•©ë‹ˆë‹¤ .</li>
</ul>

<h5 id="policy-enforcement-modes-by-cilium-network-policy---docs">Policy Enforcement Modes by Cilium Network Policy - <a href="https://docs.cilium.io/en/stable/security/policy/intro/">Docs</a>
</h5>

<ul>
  <li>
<strong>Policy Enforcement Modes</strong>
    <ul>
      <li>
<strong>default</strong> : ì •ì±…ì´ ì—†ëŠ” ê²½ìš° ëª¨ë“  íŠ¸ë˜í”½ì´ í—ˆìš©ë©ë‹ˆë‹¤. ì •ì±…ì´ ì ìš©ë˜ë©´ í—ˆìš©ëœ íŠ¸ë˜í”½ì„ ì œì™¸í•œ ëª¨ë“  íŠ¸ë˜í”½ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.</li>
      <li>
<strong>always</strong> : ì •ì±…ì´ ì—†ëŠ” ê²½ìš° ëª¨ë“  íŠ¸ë˜í”½ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤. ì •ì±…ì´ ì ìš©ë˜ë©´ í—ˆìš©ëœ íŠ¸ë˜í”½ì„ ì œì™¸í•œ ëª¨ë“  íŠ¸ë˜í”½ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.</li>
      <li>
<strong>never</strong> : ì •ì±…ì´ ì—†ëŠ” ê²½ìš° ëª¨ë“  íŠ¸ë˜í”½ì´ í—ˆìš©ë©ë‹ˆë‹¤. ì •ì±…ì´ ì ìš©ë˜ë”ë¼ë„ ëª¨ë“  íŠ¸ë˜í”½ì´ í—ˆìš©ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
<strong>Endpoint default policy</strong>
    <ul>
      <li>
<strong>ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•´ ëª¨ë“  ì†¡ì‹  ë° ìˆ˜ì‹  íŠ¸ë˜í”½ì´ í—ˆìš©ë©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì •ì±…ì— ë”°ë¼ ì—”ë“œí¬ì¸íŠ¸ê°€ ì„ íƒë˜ë©´ ëª…ì‹œì ìœ¼ë¡œ í—ˆìš©ëœ</strong> íŠ¸ë˜í”½ ë§Œ í—ˆìš©ë˜ëŠ” ê¸°ë³¸ ê±°ë¶€ ìƒíƒœë¡œ ì „í™˜ë©ë‹ˆë‹¤ . ì´ ìƒíƒœëŠ” ë°©í–¥ë³„ë¡œ ì ìš©ë©ë‹ˆë‹¤.
        <ul>
          <li>ê·œì¹™ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì„ íƒ í•˜ê³  í•´ë‹¹ ê·œì¹™ì— ìˆ˜ì‹  ì„¹ì…˜ì´ ìˆëŠ” ê²½ìš°, ì—”ë“œí¬ì¸íŠ¸ëŠ” ìˆ˜ì‹ ì— ëŒ€í•´ ê¸°ë³¸ ê±°ë¶€ ëª¨ë“œë¡œ ì „í™˜ë©ë‹ˆë‹¤.</li>
          <li>ê·œì¹™ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì„ íƒ í•˜ê³  ê·œì¹™ì— ì†¡ì‹  ì„¹ì…˜ì´ ìˆëŠ” ê²½ìš°, ì—”ë“œí¬ì¸íŠ¸ëŠ” ì†¡ì‹ ì— ëŒ€í•´ ê¸°ë³¸ ê±°ë¶€ ëª¨ë“œë¡œ ì „í™˜ë©ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">EnableDefaultDeny</code> <a href="https://docs.cilium.io/en/stable/security/policy/language/#l7-policy">7ê³„ì¸µ ì •ì±…</a> ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        <ul>
          <li>7ê³„ì¸µ ëª¨ë‘ í—ˆìš©ì´ í¬í•¨ë˜ì§€ ì•Šì€ 7ê³„ì¸µ ê·œì¹™ì„ ì¶”ê°€í•˜ë©´ default-denyê°€ ëª…ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™”ëœ ê²½ìš°ì—ë„ ì‚­ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<strong>Rule Basics</strong>
    <ul>
      <li>
<strong>endpointSelector / nodeSelector</strong> : 
ì •ì±… ê·œì¹™ì´ ì ìš©ë  ì—”ë“œí¬ì¸íŠ¸ ë˜ëŠ” ë…¸ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ì •ì±… ê·œì¹™ì€ ì„ íƒê¸°ì— ì§€ì •ëœ ë ˆì´ë¸”ê³¼ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì— ì ìš©ë©ë‹ˆë‹¤.</li>
      <li>
<strong>ingress</strong> : 
ì—”ë“œí¬ì¸íŠ¸ì˜ ìœ ì… ì‹œ, ì¦‰ ì—”ë“œí¬ì¸íŠ¸ì— ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì— ì ìš©í•´ì•¼ í•˜ëŠ” ê·œì¹™ ëª©ë¡ì…ë‹ˆë‹¤.</li>
      <li>
<strong>egress</strong> : 
ì—”ë“œí¬ì¸íŠ¸ì˜ ì¶œêµ¬ì—ì„œ ì ìš©ë˜ì–´ì•¼ í•˜ëŠ” ê·œì¹™ ëª©ë¡, ì¦‰ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë– ë‚˜ëŠ” ëª¨ë“  ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì— ì ìš©ë˜ì–´ì•¼ í•˜ëŠ” ê·œì¹™ ëª©ë¡ì…ë‹ˆë‹¤.</li>
      <li>
<strong>labels</strong> :
ë ˆì´ë¸”ì€ ê·œì¹™ì„ ì‹ë³„í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë ˆì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ ê·œì¹™ì„ ë‚˜ì—´í•˜ê³  ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Kubernetesë¥¼
í†µí•´ ê°€ì ¸ì˜¨ ì •ì±… ê·œì¹™ì—ëŠ” <a href="https://docs.cilium.io/en/stable/network/kubernetes/policy/#networkpolicy">NetworkPolicy</a> 
ë˜ëŠ” <a href="https://docs.cilium.io/en/stable/network/kubernetes/policy/#ciliumnetworkpolicy">CiliumNetworkPolicy</a> ë¦¬ì†ŒìŠ¤ì— 
ì§€ì •ëœ ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” ë ˆì´ë¸”ì´ ìë™ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">io.cilium.k8s.policy.name=NAME</code>ì§€ì •ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h5 id="cilium-endpoint-lifecycle---docs">Cilium Endpoint Lifecycle - <a href="https://docs.cilium.io/en/stable/security/policy/lifecycle/">Docs</a>
</h5>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_7.png" alt="img.png" class="image-center" loading="lazy" width="1455" height="955">
  <em class="image-caption"><a href="https://docs.cilium.io/en/stable/security/policy/lifecycle/">https://docs.cilium.io/en/stable/security/policy/lifecycle/</a></em></p>

<ul>
  <li>
<strong>restoring</strong> : Ciliumì´ ì‹œì‘ë˜ê¸° ì „ì— ì—”ë“œí¬ì¸íŠ¸ê°€ ì‹œì‘ë˜ì—ˆìœ¼ë©° Ciliumì´ ë„¤íŠ¸ì›Œí‚¹ êµ¬ì„±ì„ ë³µì›í•˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
  <li>
<strong>waiting-for-identity</strong> : Ciliumì´ ì—”ë“œí¬ì¸íŠ¸ì— ê³ ìœ í•œ IDë¥¼ í• ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
  <li>
<strong>waiting-to-regenerate</strong> : ì—”ë“œí¬ì¸íŠ¸ê°€ IDë¥¼ ìˆ˜ì‹ í–ˆìœ¼ë©° ë„¤íŠ¸ì›Œí‚¹ êµ¬ì„±ì´ ë‹¤ì‹œ ìƒì„±ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</li>
  <li>
<strong>regenerating</strong> : ì—”ë“œí¬ì¸íŠ¸ì˜ ë„¤íŠ¸ì›Œí‚¹ êµ¬ì„±ì´ ì¬ìƒì„±ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ eBPF í”„ë¡œê·¸ë˜ë°ì´ í¬í•¨ë©ë‹ˆë‹¤.</li>
  <li>
<strong>ready</strong> : ì—”ë“œí¬ì¸íŠ¸ì˜ ë„¤íŠ¸ì›Œí‚¹ êµ¬ì„±ì´ ì„±ê³µì ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
  <li>
<strong>disconnecting</strong> : ì—”ë“œí¬ì¸íŠ¸ê°€ ì‚­ì œë˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
  <li>
<strong>disconnected</strong> : ì—”ë“œí¬ì¸íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</li>
</ul>

<h5 id="ê¸°íƒ€-ì •ë³´">ê¸°íƒ€ ì •ë³´</h5>

<ul>
  <li>
<strong>ì •ì±… ì—ë””í„° ì˜¨ë¼ì¸ ì‚¬ì´íŠ¸</strong> : <a href="https://editor.networkpolicy.io/">https://editor.networkpolicy.io/</a>, 
<a href="https://isovalent.com/blog/post/tutorial-network-policy-editor/">https://isovalent.com/blog/post/tutorial-network-policy-editor/</a>
</li>
  <li>
<strong>Identity Management Mode</strong> : <a href="https://docs.cilium.io/en/stable/network/kubernetes/identity-management-mode/">Docs</a>
</li>
  <li>
<strong>Using Kubernetes Constructs In Policy</strong> : ì •ì±…ì—ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ í™œìš© - <a href="https://docs.cilium.io/en/stable/security/policy/kubernetes/">Docs</a>
</li>
  <li>
<strong>Network Policy Troubleshooting</strong> - <a href="https://docs.cilium.io/en/stable/security/policy/troubleshooting/">Docs</a> &amp; <strong>Caveats</strong> - <a href="https://docs.cilium.io/en/stable/security/policy/caveats/">Docs</a>
</li>
  <li>
<strong>Threat Model</strong> : <a href="https://docs.cilium.io/en/stable/security/threat-model/">Docs</a>
</li>
  <li>
<strong>Tutorial: Cilium Network Policy in Practice (Part 2)</strong> : <a href="https://isovalent.com/blog/post/tutorial-cilium-network-policy/">Blog</a>
</li>
</ul>

<hr>

<h2 id="cilium-security-ì‹¤ìŠµ">Cilium Security ì‹¤ìŠµ</h2>

<h3 id="-lab1-locking-down-external-access-with-dns-based-policies">ğŸ”¬ Lab1. Locking Down External Access with DNS-Based Policies</h3>

<ul>
  <li>DNS ê¸°ë°˜ ë³´ì•ˆ ì •ì±… - <a href="https://docs.cilium.io/en/stable/security/dns/">Docs</a>
    <ul>
      <li>CIDR ë˜ëŠ” IP ê¸°ë°˜ ì •ì±…ì€ ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ ì—°ê²°ëœ IPê°€ ìì£¼ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê´€ë¦¬ê°€ ì–´ë µê³  ë²ˆê±°ë¡­ìŠµë‹ˆë‹¤.</li>
      <li>Ciliumì˜ DNS ê¸°ë°˜ ì •ì±…ì€ DNS-IP ë§¤í•‘ ì¶”ì ê³¼ ê°™ì€ ë³µì¡í•œ ì¸¡ë©´ì„ ê´€ë¦¬í•˜ëŠ” ë™ì‹œì— ì•¡ì„¸ìŠ¤ ì œì–´ë¥¼ ì‰½ê²Œ ì§€ì •í•  ìˆ˜ ìˆëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
      <li>ì´ ê°€ì´ë“œì—ì„œëŠ” ë‹¤ìŒ ì‚¬í•­ì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤.
        <ul>
          <li>DNS ê¸°ë°˜ ì •ì±…ì„ ì‚¬ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì´íƒˆ ì•¡ì„¸ìŠ¤ ì œì–´</li>
          <li>íŒ¨í„´(ë˜ëŠ” ì™€ì¼ë“œì¹´ë“œ)ì„ ì‚¬ìš©í•˜ì—¬ DNS ë„ë©”ì¸ í•˜ìœ„ ì§‘í•©ì„ í—ˆìš© ëª©ë¡ì— ì¶”ê°€</li>
          <li>ì™¸ë¶€ ì„œë¹„ìŠ¤ ì ‘ê·¼ ì œí•œì„ ìœ„í•œ DNS, í¬íŠ¸ ë° L7 ê·œì¹™ ê²°í•©</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="ë°ëª¨-ì• í”Œë¦¬ì¼€ì´ì…˜-ë°°í¬">ë°ëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬</h5>

<ul>
  <li>Empireì˜ mediabot podê°€ Empireì˜ git ì €ì¥ì†Œ ê´€ë¦¬ë¥¼ ìœ„í•´ GitHubì— ì ‘ê·¼í•´ì•¼ í•˜ëŠ” ê°„ë‹¨í•œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</li>
  <li>podëŠ” ë‹¤ë¥¸ ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># hubble ui ì— pod name í‘œê¸°ë¥¼ ìœ„í•´ app labels ì¶”ê°€ &gt;&gt; ë¹¼ê³  ë°°í¬í•´ë³´ê³  ì°¨ì´ì ì„ í™•ì¸í•´ë³´ì.</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; dns-sw-app.yaml
apiVersion: v1
kind: Pod
metadata:
  name: mediabot
  labels:
    org: empire
    class: mediabot
    app: mediabot
spec:
  containers:
  - name: mediabot
    image: quay.io/cilium/json-mock:v1.3.8@sha256:5aad04835eda9025fe4561ad31be77fd55309af8158ca8663a72f6abb78c2603
</span><span class="no">EOF
  
</span><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> dns-sw-app.yaml
<span class="c"># =&gt; pod/mediabot created</span>
<span class="nv">$ </span>kubectl <span class="nb">wait </span>pod/mediabot <span class="nt">--for</span><span class="o">=</span><span class="nv">condition</span><span class="o">=</span>Ready
<span class="c"># =&gt; pod/mediabot condition met</span>
  
<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium identity list
<span class="c"># =&gt; ...</span>
<span class="c">#    23762   k8s:app=mediabot</span>
<span class="c">#            k8s:class=mediabot</span>
<span class="c">#            k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name=default</span>
<span class="c">#            k8s:io.cilium.k8s.policy.cluster=default</span>
<span class="c">#            k8s:io.cilium.k8s.policy.serviceaccount=default</span>
<span class="c">#            k8s:io.kubernetes.pod.namespace=default</span>
<span class="c">#            k8s:org=empire</span>
<span class="c">#    ...</span>
<span class="nv">$ </span>kubectl get pods
<span class="c"># =&gt; NAME       READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    mediabot   1/1     Running   0          86s</span>
  
<span class="c"># ì™¸ë¶€ í†µì‹  í™•ì¸ : hubble ui ì—ì„œ í™•ì¸</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> https://api.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 200</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> <span class="nt">--max-time</span> 5 https://support.github.com | <span class="nb">head</span> <span class="nt">-1</span> 
<span class="c"># =&gt; HTTP/2 302</span>
</code></pre></div></div>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_8.png" alt="img.png" class="image-center w-80" loading="lazy" width="490" height="446"></p>

<h5 id="dns-egress-ì •ì±…-ì ìš©--1--mediabotí¬ë“œê°€-apigithubcomì—ë§Œ-ì•¡ì„¸ìŠ¤í•˜ë„ë¡-í—ˆìš©">DNS Egress ì •ì±… ì ìš©  1 : <code class="language-plaintext highlighter-rouge">mediabot</code>í¬ë“œê°€ <code class="language-plaintext highlighter-rouge">api.github.com</code>ì—ë§Œ ì•¡ì„¸ìŠ¤í•˜ë„ë¡ í—ˆìš©</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: "fqdn"
spec:
  endpointSelector:
    matchLabels:
      org: empire
      class: mediabot
  egress:
  - toFQDNs:
    - matchName: "api.github.com"
  - toEndpoints:
    - matchLabels:
        "k8s:io.kubernetes.pod.namespace": kube-system
        "k8s:k8s-app": kube-dns
    toPorts:
    - ports:
      - port: "53"
        protocol: ANY
      rules:
        dns:
        - matchPattern: "*"
</span><span class="no">EOF
</span><span class="c"># =&gt; ciliumnetworkpolicy.cilium.io/fqdn created</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get cnp
<span class="c"># =&gt; NAME   AGE   VALID</span>
<span class="c">#    fqdn   11s   True</span>

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium policy selectors 
<span class="c"># =&gt; SELECTOR                                                                                                                                                                      LABELS         USERS   IDENTITIES</span>
<span class="c">#    &amp;LabelSelector{MatchLabels:map[string]string{any.class: mediabot,any.org: empire,k8s.io.kubernetes.pod.namespace: default,},MatchExpressions:[]LabelSelectorRequirement{},}   default/fqdn   1       23762 </span>

<span class="nv">$ </span>cilium config view | <span class="nb">grep</span> <span class="nt">-i</span> dns
<span class="c"># =&gt; dnsproxy-enable-transparent-mode                  true</span>
<span class="c">#    dnsproxy-socket-linger-timeout                    10</span>
<span class="c">#    hubble-metrics                                    dns drop tcp flow port-distribution icmp httpV2:exemplars=true;labelsContext=source_ip,source_namespace,source_workload,destination_ip,destination_namespace,destination_workload,traffic_direction</span>
<span class="c">#    tofqdns-dns-reject-response-code                  refused</span>
<span class="c">#    tofqdns-enable-dns-compression                    true</span>
<span class="c">#    tofqdns-endpoint-max-ip-per-hostname              1000</span>
<span class="c">#    tofqdns-idle-connection-grace-period              0s</span>
<span class="c">#    tofqdns-max-deferred-connection-deletes           10000</span>
<span class="c">#    tofqdns-preallocate-identities                    true</span>
<span class="c">#    tofqdns-proxy-response-max-delay                  100ms</span>

<span class="c"># ì™¸ë¶€ í†µì‹  í™•ì¸ : hubble ui ì—ì„œ í™•ì¸</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> https://api.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 200</span>

<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> <span class="nt">--max-time</span> 5 https://support.github.com | <span class="nb">head</span> <span class="nt">-1</span>
</code></pre></div></div>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_9.png" alt="img.png" class="image-center w-80" loading="lazy" width="686" height="501">
<em class="image-caption">api.github.comìœ¼ë¡œë§Œ ì ‘ì†ì´ í—ˆìš©ëœ ìƒíƒœ</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c"># cilium-agent ë‚´ì— go ë¡œ êµ¬í˜„ëœ lightweight proxy ê°€ DNS ì¿¼ë¦¬/ì‘ë‹µ ê°ì‹œì™€ ~~ìºì‹± ì²˜ë¦¬~~ : ê¸°ë³¸ 30ì´ˆ?</span>
<span class="nv">$ </span>cilium hubble port-forward&amp;
<span class="c"># =&gt; â„¹ï¸   Hubble Relay is available at 127.0.0.1:4245</span>
<span class="nv">$ </span>hubble observe <span class="nt">--pod</span> mediabot
<span class="c"># =&gt; ...</span>
<span class="c">#    Sep  6 07:57:02.807: default/mediabot:59702 (ID:23762) &lt;- kube-system/coredns-674b8bbfcf-hcdsq:53 (ID:41039) dns-response proxy FORWARDED (DNS Answer "20.200.245.245" TTL: 30 (Proxy api.github.com. A))</span>
<span class="c">#    ...</span>
<span class="c">#    Sep  6 07:57:02.809: default/mediabot:59458 (ID:23762) -&gt; api.github.com:443 (ID:16777217) policy-verdict:L3-Only EGRESS ALLOWED (TCP Flags: SYN)</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ api.github.com ìœ¼ë¡œì˜ ì ‘ì†ì€ í—ˆìš©ë¨&lt;/span&gt;</span>
<span class="c">#    ...</span>
<span class="c">#    Sep  6 07:48:26.004: default/mediabot:43181 (ID:23762) &lt;- kube-system/coredns-674b8bbfcf-nxkpb:53 (ID:41039) dns-response proxy FORWARDED (DNS Answer  TTL: 4294967295 (Proxy support.github.com. AAAA))</span>
<span class="c">#    ...</span>
<span class="c">#    Sep  6 07:48:26.025: default/mediabot:34138 (ID:23762) &lt;&gt; support.github.com:443 (world) policy-verdict:none EGRESS DENIED (TCP Flags: SYN)</span>
<span class="c"># &lt;span style="color: red;"&gt;ğŸ‘‰ support.github.com ìœ¼ë¡œì˜ ì ‘ì†ì€ ì°¨ë‹¨ë¨&lt;/span&gt;</span>
<span class="c">#    ...</span>

<span class="c"># (ì˜µì…˜) coredns ë¡œê·¸ë¡œ ì§ì ‘ í™•ì¸í•´ë³´ê¸°</span>
<span class="c"># k9s -&gt; configmap (coredns) : log ì¶”ê°€</span>

<span class="c">## ë¡œê¹… í™œì„±í™”</span>
<span class="nv">$ </span>kubectl logs <span class="nt">-n</span> kube-system <span class="nt">-l</span> k8s-app<span class="o">=</span>kube-dns <span class="nt">-f</span>
<span class="c"># =&gt; [INFO] 172.20.1.42:46910 - 17176 "A IN api.github.com.default.svc.cluster.local. udp 58 false 512" NXDOMAIN qr,aa,rd 151 0.001380815s</span>
<span class="c">#    [INFO] 172.20.1.42:46910 - 10271 "AAAA IN api.github.com.default.svc.cluster.local. udp 58 false 512" NXDOMAIN qr,aa,rd 151 0.000691012s</span>
<span class="c">#    [INFO] 172.20.1.42:59040 - 34206 "A IN api.github.com.svc.cluster.local. udp 50 false 512" NXDOMAIN qr,aa,rd 143 0.001186301s</span>
<span class="c">#    [INFO] 172.20.1.42:59040 - 38304 "AAAA IN api.github.com.svc.cluster.local. udp 50 false 512" NXDOMAIN qr,aa,rd 143 0.001266842s</span>
<span class="c">#    [INFO] 172.20.1.42:47633 - 16595 "AAAA IN api.github.com.cluster.local. udp 46 false 512" NXDOMAIN qr,aa,rd 139 0.007288392s</span>
<span class="c">#    [INFO] 172.20.1.42:47633 - 42706 "A IN api.github.com.cluster.local. udp 46 false 512" NXDOMAIN qr,aa,rd 139 0.032957929s</span>
<span class="c">#    [INFO] 172.20.1.42:48160 - 48028 "AAAA IN api.github.com. udp 32 false 512" NOERROR qr,rd,ra 116 0.046812603s</span>
<span class="c">#    [INFO] 172.20.1.42:48160 - 49818 "A IN api.github.com. udp 32 false 512" NOERROR qr,rd,ra 62 0.043482105s</span>
<span class="c">#    ...</span>

<span class="c">## í˜¸ì¶œ</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> https://api.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 200</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> https://api.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 200</span>
<span class="nv">$ </span>hubble observe <span class="nt">--pod</span> mediabot
<span class="c"># =&gt; Sep  6 08:01:46.195: default/mediabot:39968 (ID:23762) -&gt; kube-system/coredns-6c95f59f49-fgbmq:53 (ID:41039) to-endpoint FORWARDED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.197: default/mediabot:39968 (ID:23762) &lt;&gt; kube-system/coredns-6c95f59f49-fgbmq (ID:41039) pre-xlate-rev TRACED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.198: default/mediabot:39968 (ID:23762) &lt;- kube-system/coredns-6c95f59f49-fgbmq:53 (ID:41039) to-network FORWARDED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.198: default/mediabot:39968 (ID:23762) &lt;&gt; kube-system/coredns-6c95f59f49-fgbmq (ID:41039) pre-xlate-rev TRACED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.228: default/mediabot:49139 (ID:23762) -&gt; kube-system/coredns-6c95f59f49-fgbmq:53 (ID:41039) to-endpoint FORWARDED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.230: default/mediabot:49139 (ID:23762) &lt;&gt; kube-system/coredns-6c95f59f49-fgbmq (ID:41039) pre-xlate-rev TRACED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.238: default/mediabot:49139 (ID:23762) &lt;&gt; kube-system/coredns-6c95f59f49-fgbmq (ID:41039) pre-xlate-rev TRACED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.238: default/mediabot:49139 (ID:23762) &lt;- kube-system/coredns-6c95f59f49-fgbmq:53 (ID:41039) to-network FORWARDED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.409: default/mediabot:49139 (ID:23762) &lt;- kube-system/coredns-6c95f59f49-fgbmq:53 (ID:41039) dns-response proxy FORWARDED (DNS Answer  TTL: 4294967295 (Proxy api.github.com. AAAA))</span>
<span class="c">#    Sep  6 08:01:46.410: default/mediabot:49139 (ID:23762) &lt;- kube-system/coredns-6c95f59f49-fgbmq:53 (ID:41039) dns-response proxy FORWARDED (DNS Answer "20.200.245.245" TTL: 1 (Proxy api.github.com. A))</span>
<span class="c">#    Sep  6 08:01:46.410: kube-system/coredns-6c95f59f49-fgbmq:53 (ID:41039) &lt;&gt; default/mediabot (ID:23762) pre-xlate-rev TRACED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.410: kube-system/kube-dns:53 (world) &lt;&gt; default/mediabot (ID:23762) post-xlate-rev TRANSLATED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.410: kube-system/coredns-6c95f59f49-fgbmq:53 (ID:41039) &lt;&gt; default/mediabot (ID:23762) pre-xlate-rev TRACED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.410: kube-system/kube-dns:53 (world) &lt;&gt; default/mediabot (ID:23762) post-xlate-rev TRANSLATED (UDP)</span>
<span class="c">#    Sep  6 08:01:46.412: default/mediabot:46244 (ID:23762) -&gt; api.github.com:443 (ID:16777217) policy-verdict:L3-Only EGRESS ALLOWED (TCP Flags: SYN)</span>
<span class="c">#    Sep  6 08:01:46.412: default/mediabot:46244 (ID:23762) -&gt; api.github.com:443 (ID:16777217) to-network FORWARDED (TCP Flags: SYN)</span>
<span class="c">#    Sep  6 08:01:46.421: default/mediabot:46244 (ID:23762) &lt;- api.github.com:443 (ID:16777217) to-endpoint FORWARDED (TCP Flags: SYN, ACK)</span>
<span class="c">#    Sep  6 08:01:46.422: api.github.com:443 (ID:16777217) &lt;&gt; default/mediabot (ID:23762) pre-xlate-rev TRACED (TCP)</span>
<span class="c">#    Sep  6 08:01:46.422: default/mediabot:46244 (ID:23762) -&gt; api.github.com:443 (ID:16777217) to-network FORWARDED (TCP Flags: ACK)</span>
<span class="c">#    Sep  6 08:01:46.424: default/mediabot:46244 (ID:23762) -&gt; api.github.com:443 (ID:16777217) to-network FORWARDED (TCP Flags: ACK, PSH)</span>
<span class="c">#    Sep  6 08:01:46.433: default/mediabot:46244 (ID:23762) &lt;- api.github.com:443 (ID:16777217) to-endpoint FORWARDED (TCP Flags: ACK, PSH)</span>
<span class="c">#    Sep  6 08:01:46.464: api.github.com:443 (ID:16777217) &lt;&gt; default/mediabot (ID:23762) pre-xlate-rev TRACED (TCP)</span>
<span class="c">#    Sep  6 08:01:46.465: api.github.com:443 (ID:16777217) &lt;&gt; default/mediabot (ID:23762) pre-xlate-rev TRACED (TCP)</span>
<span class="c">#    Sep  6 08:01:46.685: default/mediabot:46244 (ID:23762) -&gt; api.github.com:443 (ID:16777217) to-network FORWARDED (TCP Flags: ACK, FIN)</span>
<span class="c">#    Sep  6 08:01:46.703: default/mediabot:46244 (ID:23762) &lt;- api.github.com:443 (ID:16777217) to-endpoint FORWARDED (TCP Flags: ACK, FIN)</span>
<span class="c">#    Sep  6 08:01:46.703: default/mediabot:46244 (ID:23762) -&gt; api.github.com:443 (ID:16777217) to-network FORWARDED (TCP Flags: RST)</span>
<span class="c">#    Sep  6 08:01:46.703: default/mediabot:46244 (ID:23762) -&gt; api.github.com:443 (ID:16777217) to-network FORWARDED (TCP Flags: RST)</span>
<span class="c">#    Sep  6 08:01:46.705: default/mediabot:46244 (ID:23762) &lt;- api.github.com:443 (ID:16777217) to-endpoint FORWARDED (TCP Flags: ACK, RST)</span>

<span class="c">## cilium íŒŒë“œ ì´ë¦„</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">CILIUMPOD0</span><span class="o">=</span><span class="si">$(</span>kubectl get <span class="nt">-l</span> k8s-app<span class="o">=</span>cilium pods <span class="nt">-n</span> kube-system <span class="nt">--field-selector</span> spec.nodeName<span class="o">=</span>k8s-ctr <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="si">)</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">CILIUMPOD1</span><span class="o">=</span><span class="si">$(</span>kubectl get <span class="nt">-l</span> k8s-app<span class="o">=</span>cilium pods <span class="nt">-n</span> kube-system <span class="nt">--field-selector</span> spec.nodeName<span class="o">=</span>k8s-w1  <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="si">)</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">CILIUMPOD2</span><span class="o">=</span><span class="si">$(</span>kubectl get <span class="nt">-l</span> k8s-app<span class="o">=</span>cilium pods <span class="nt">-n</span> kube-system <span class="nt">--field-selector</span> spec.nodeName<span class="o">=</span>k8s-w2  <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="si">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$CILIUMPOD0</span> <span class="nv">$CILIUMPOD1</span> <span class="nv">$CILIUMPOD2</span>
<span class="c"># =&gt; cilium-p8r4t cilium-vrh7l cilium-rmd6z</span>

<span class="c">## ë‹¨ì¶•í‚¤(alias) ì§€ì •</span>
<span class="nv">$ </span><span class="nb">alias </span><span class="nv">c0</span><span class="o">=</span><span class="s2">"kubectl exec -it </span><span class="nv">$CILIUMPOD0</span><span class="s2"> -n kube-system -c cilium-agent -- cilium"</span>
<span class="nv">$ </span><span class="nb">alias </span><span class="nv">c1</span><span class="o">=</span><span class="s2">"kubectl exec -it </span><span class="nv">$CILIUMPOD1</span><span class="s2"> -n kube-system -c cilium-agent -- cilium"</span>
<span class="nv">$ </span><span class="nb">alias </span><span class="nv">c2</span><span class="o">=</span><span class="s2">"kubectl exec -it </span><span class="nv">$CILIUMPOD2</span><span class="s2"> -n kube-system -c cilium-agent -- cilium"</span>

<span class="c">##</span>
<span class="nv">$ </span>c0 fqdn cache list
<span class="c"># =&gt; Endpoint   Source   FQDN   TTL   ExpirationTime   IPs</span>
<span class="nv">$ </span>c1 fqdn cache list
<span class="c"># =&gt; Endpoint   Source       FQDN                  TTL   ExpirationTime             IPs</span>
<span class="c">#    1039       connection   support.github.com.   0     2025-09-06T08:26:39.259Z   185.199.108.133</span>
<span class="c">#    1039       connection   support.github.com.   0     2025-09-06T08:26:39.259Z   185.199.110.133</span>
<span class="c">#    1039       connection   support.github.com.   0     2025-09-06T08:26:39.259Z   185.199.109.133</span>
<span class="c">#    1039       connection   support.github.com.   0     2025-09-06T08:26:39.259Z   185.199.111.133</span>
<span class="c">#    1039       connection   api.github.com.       0     2025-09-06T08:26:39.259Z   20.200.245.245</span>
<span class="nv">$ </span>c2 fqdn cache list
<span class="c"># =&gt; Endpoint   Source   FQDN   TTL   ExpirationTime   IPs</span>

<span class="nv">$ </span>c0 fqdn names
<span class="c"># =&gt; {</span>
<span class="c">#      "DNSPollNames": null,</span>
<span class="c">#      "FQDNPolicySelectors": []</span>
<span class="c">#    }</span>
<span class="nv">$ </span>c1 fqdn names
<span class="c"># =&gt; {</span>
<span class="c">#      "DNSPollNames": null,</span>
<span class="c">#      "FQDNPolicySelectors": [</span>
<span class="c">#        {</span>
<span class="c">#          "regexString": "^api[.]github[.]com[.]$",</span>
<span class="c">#          "selectorString": "MatchName: api.github.com, MatchPattern: "</span>
<span class="c">#        }</span>
<span class="c">#      ]</span>
<span class="c">#    }</span>
<span class="nv">$ </span>c2 fqdn names
<span class="c"># =&gt; {</span>
<span class="c">#      "DNSPollNames": null,</span>
<span class="c">#      "FQDNPolicySelectors": []</span>
<span class="c">#    }</span>
</code></pre></div></div>

<ul>
  <li>cilium-agent ë‚´ì— go ë¡œ êµ¬í˜„ëœ lightweight proxy ê°€ DNS ì¿¼ë¦¬/ì‘ë‹µ ê°ì‹œì™€ <del>ìºì‹± ì²˜ë¦¬</del> - <a href="https://github.com/cilium/cilium/blob/main/pkg/fqdn/dnsproxy/proxy.go">Code</a>
</li>
</ul>

<h5 id="dns-egress-ì •ì±…-ì ìš©--2--ëª¨ë“ -github-í•˜ìœ„-ë„ë©”ì¸ì˜ˆ-íŒ¨í„´ì—-ì•¡ì„¸ìŠ¤">DNS Egress ì •ì±… ì ìš©  2 : ëª¨ë“  GitHub í•˜ìœ„ ë„ë©”ì¸(ì˜ˆ: íŒ¨í„´)ì— ì•¡ì„¸ìŠ¤.</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># fqdn ìºì‹œ ì´ˆê¸°í™” ë° ì •ì±… ì‚­ì œ</span>
<span class="nv">$ </span>kubectl delete cnp fqdn
<span class="c"># =&gt; ciliumnetworkpolicy.cilium.io "fqdn" deleted</span>
<span class="nv">$ </span>c1 fqdn cache clean <span class="nt">-f</span>
<span class="c"># =&gt; FQDN proxy cache cleared</span>
<span class="nv">$ </span>c2 fqdn cache clean <span class="nt">-f</span>
<span class="c"># =&gt; FQDN proxy cache cleared</span>

<span class="c"># dns-pattern.yaml ë‚´ìš©</span>
apiVersion: <span class="s2">"cilium.io/v2"</span>
kind: CiliumNetworkPolicy
metadata:
  name: <span class="s2">"fqdn"</span>
spec:
  endpointSelector:
    matchLabels:
      org: empire
      class: mediabot
  egress:
  - toFQDNs:
    - matchName: <span class="s2">"*.github.com"</span>
  - toEndpoints:
    - matchLabels:
        <span class="s2">"k8s:io.kubernetes.pod.namespace"</span>: kube-system
        <span class="s2">"k8s:k8s-app"</span>: kube-dns
    toPorts:
    - ports:
      - port: <span class="s2">"53"</span>
        protocol: ANY
      rules:
        dns:
        - matchPattern: <span class="s2">"*"</span>

<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/cilium/1.18.1/examples/kubernetes-dns/dns-pattern.yaml
<span class="c"># =&gt; ciliumnetworkpolicy.cilium.io/fqdn created</span>
<span class="nv">$ </span>c1 fqdn names
<span class="c"># =&gt; {</span>
<span class="c">#      "DNSPollNames": null,</span>
<span class="c">#      "FQDNPolicySelectors": [</span>
<span class="c">#        {</span>
<span class="c">#          "regexString": "^[-a-zA-Z0-9_]*[.]github[.]com[.]$",</span>
<span class="c">#          "selectorString": "MatchName: , MatchPattern: *.github.com"</span>
<span class="c">#        }</span>
<span class="c">#      ]</span>
<span class="c">#    }</span>
<span class="nv">$ </span>c2 fqdn names
<span class="c"># =&gt; {</span>
<span class="c">#      "DNSPollNames": null,</span>
<span class="c">#      "FQDNPolicySelectors": []</span>
<span class="c">#    }</span>
<span class="nv">$ </span>c1 fqdn cache list
<span class="c"># =&gt; Endpoint   Source   FQDN   TTL   ExpirationTime   IPs</span>
<span class="nv">$ </span>c2 fqdn cache list
<span class="c"># =&gt; Endpoint   Source   FQDN   TTL   ExpirationTime   IPs</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get cnp
<span class="c"># =&gt; NAME   AGE   VALID</span>
<span class="c">#    fqdn   59s   True</span>

<span class="c"># ì™¸ë¶€ í†µì‹  í™•ì¸ : hubble ui ì—ì„œ í™•ì¸ &gt;&gt; github.com ì€ ê³µì‹ ë¬¸ì„œ ì„¤ëª…ëŒ€ë¡œë¼ë©´ ì•ˆë˜ì•¼ë¨..</span>
<span class="c">##  It is important to note and test that this doesnâ€™t allow access to github.com because the *. </span>
<span class="c">## in the pattern requires one subdomain to be present in the DNS name</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> https://support.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 302</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> https://gist.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 302</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> <span class="nt">--max-time</span> 5 https://github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 200</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> <span class="nt">--max-time</span> 5 https://cilium.io| <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; command terminated with exit code 28</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ *.github.com ìœ¼ë¡œì˜ ì ‘ì†ë§Œ í—ˆìš©ë˜ê¸° ë•Œë¬¸ì— cilium.io ì ‘ì†ì€ ì°¨ë‹¨ë¨&lt;/span&gt;</span>
</code></pre></div></div>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_10.png" alt="img.png" class="image-center" loading="lazy" width="1282" height="1010"></p>

<h5 id="dns-egress-ì •ì±…-ì ìš©--3--dns-port-ì¡°í•©-ì ìš©">DNS Egress ì •ì±… ì ìš©  3 : DNS, Port ì¡°í•© ì ìš©</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dns-port.yaml ë‚´ìš©</span>
apiVersion: <span class="s2">"cilium.io/v2"</span>
kind: CiliumNetworkPolicy
metadata:
  name: <span class="s2">"fqdn"</span>
spec:
  endpointSelector:
    matchLabels:
      org: empire
      class: mediabot
  egress:
  - toFQDNs:
    - matchPattern: <span class="s2">"*.github.com"</span>
    toPorts:
    - ports:
      - port: <span class="s2">"443"</span>
        protocol: TCP
  - toEndpoints:
    - matchLabels:
        <span class="s2">"k8s:io.kubernetes.pod.namespace"</span>: kube-system
        <span class="s2">"k8s:k8s-app"</span>: kube-dns
    toPorts:
    - ports:
      - port: <span class="s2">"53"</span>
        protocol: ANY
      rules:
        dns:
        - matchPattern: <span class="s2">"*"</span>

<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/cilium/1.18.1/examples/kubernetes-dns/dns-port.yaml
<span class="c"># =&gt; ciliumnetworkpolicy.cilium.io/fqdn configured</span>
<span class="nv">$ </span>c1 fqdn names
<span class="c"># =&gt; {</span>
<span class="c">#      "DNSPollNames": null,</span>
<span class="c">#      "FQDNPolicySelectors": [</span>
<span class="c">#        {</span>
<span class="c">#          "regexString": "^[-a-zA-Z0-9_]*[.]github[.]com[.]$",</span>
<span class="c">#          "selectorString": "MatchName: , MatchPattern: *.github.com"</span>
<span class="c">#        }</span>
<span class="c">#      ]</span>
<span class="c">#    }</span>
<span class="nv">$ </span>c2 fqdn names
<span class="c"># =&gt; {</span>
<span class="c">#      "DNSPollNames": null,</span>
<span class="c">#      "FQDNPolicySelectors": []</span>
<span class="c">#    }</span>
<span class="nv">$ </span>c1 fqdn cache list
<span class="c"># =&gt; Endpoint   Source       FQDN                  TTL   ExpirationTime             IPs</span>
<span class="c">#    1039       connection   support.github.com.   0     2025-09-06T08:26:39.259Z   185.199.110.133</span>
<span class="c">#    1039       connection   support.github.com.   0     2025-09-06T08:26:39.259Z   185.199.109.133</span>
<span class="c">#    1039       connection   support.github.com.   0     2025-09-06T08:26:39.259Z   185.199.111.133</span>
<span class="c">#    1039       connection   gist.github.com.      0     2025-09-06T08:26:39.259Z   20.200.245.247</span>
<span class="c">#    1039       connection   github.com.           0     2025-09-06T08:26:39.259Z   20.200.245.247</span>
<span class="c">#    1039       connection   cilium.io.            0     2025-09-06T08:26:39.259Z   104.198.14.52</span>
<span class="c">#    1039       connection   support.github.com.   0     2025-09-06T08:26:39.259Z   185.199.108.133</span>
<span class="nv">$ </span>c2 fqdn cache list
<span class="c"># =&gt; Endpoint   Source   FQDN   TTL   ExpirationTime   IPs</span>
<span class="nv">$ </span>c1 fqdn cache clean <span class="nt">-f</span>
<span class="c"># =&gt; FQDN proxy cache cleared</span>
<span class="nv">$ </span>c2 fqdn cache clean <span class="nt">-f</span>
<span class="c"># =&gt; FQDN proxy cache cleared</span>

<span class="c"># ì™¸ë¶€ í†µì‹  í™•ì¸ : hubble ui ì—ì„œ í™•ì¸ </span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> https://support.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 302</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> <span class="nt">--max-time</span> 5 http://support.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; command terminated with exit code 28</span>
</code></pre></div></div>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_11.png" alt="img.png" class="image-center w-80" loading="lazy" width="605" height="257">
<em class="image-caption">*.github.comì˜ 443 í¬íŠ¸ë§Œ í—ˆìš©ë˜ëŠ” ìƒíƒœ</em></p>

<h5 id="ì‹¤ìŠµ-ë¦¬ì†ŒìŠ¤-ì‚­ì œ">ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl delete <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/cilium/1.18.1/examples/kubernetes-dns/dns-sw-app.yaml
<span class="c"># =&gt; pod "mediabot" deleted</span>
<span class="nv">$ </span>kubectl delete cnp fqdn
<span class="c"># =&gt; ciliumnetworkpolicy.cilium.io "fqdn" deleted</span>
</code></pre></div></div>

<h5 id="ìƒ˜í”Œ-ì• í”Œë¦¬ì¼€ì´ì…˜-ë°°í¬-ë°-í†µì‹ -ë¬¸ì œ-í™•ì¸">ìƒ˜í”Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ë° í†µì‹  ë¬¸ì œ í™•ì¸</h5>

<ul>
  <li>ìƒ˜í”Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìƒ˜í”Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webpod
spec:
  replicas: 2
  selector:
    matchLabels:
      app: webpod
  template:
    metadata:
      labels:
        app: webpod
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - sample-app
            topologyKey: "kubernetes.io/hostname"
      containers:
      - name: webpod
        image: traefik/whoami
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: webpod
  labels:
    app: webpod
spec:
  selector:
    app: webpod
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
  type: ClusterIP
</span><span class="no">EOF
</span><span class="c"># =&gt; deployment.apps/webpod created</span>
<span class="c">#    service/webpod created</span>

<span class="c"># k8s-ctr ë…¸ë“œì— curl-pod íŒŒë“œ ë°°í¬</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: curl-pod
  labels:
    app: curl
spec:
  nodeName: k8s-ctr
  containers:
  - name: curl
    image: nicolaka/netshoot
    command: ["tail"]
    args: ["-f", "/dev/null"]
  terminationGracePeriodSeconds: 0
</span><span class="no">EOF
</span><span class="c"># =&gt; pod/curl-pod created</span>
</code></pre></div></div>

<ul>
  <li>í†µì‹  í™•ì¸</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë°°í¬ í™•ì¸</span>
<span class="nv">$ </span>kubectl get deploy,svc,ep webpod <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                     READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES           SELECTOR</span>
<span class="c">#    deployment.apps/webpod   2/2     2            2           47s   webpod       traefik/whoami   app=webpod</span>
<span class="c">#    </span>
<span class="c">#    NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE   SELECTOR</span>
<span class="c">#    service/webpod   ClusterIP   10.96.194.188   &lt;none&gt;        80/TCP    47s   app=webpod</span>
<span class="c">#    </span>
<span class="c">#    NAME               ENDPOINTS                         AGE</span>
<span class="c">#    endpoints/webpod   172.20.1.252:80,172.20.2.124:80   47s</span>
<span class="nv">$ </span>kubectl get endpointslices <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>webpod
<span class="c"># =&gt; NAME           ADDRESSTYPE   PORTS   ENDPOINTS                   AGE</span>
<span class="c">#    webpod-mr2xg   IPv4          80      172.20.1.252,172.20.2.124   59s</span>
<span class="nv">$ </span>kubectl get ciliumendpoints <span class="c"># IP í™•ì¸</span>
<span class="c"># =&gt; NAME                      SECURITY IDENTITY   ENDPOINT STATE   IPV4           IPV6</span>
<span class="c">#    curl-pod                  1846                ready            172.20.0.190</span>
<span class="c">#    webpod-697b545f57-p9hhs   4449                ready            172.20.2.124</span>
<span class="c">#    webpod-697b545f57-rcgf8   4449                ready            172.20.1.252</span>

<span class="c"># í†µì‹  ë¬¸ì œ í™•ì¸</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 1 webpod | <span class="nb">grep </span>Hostname
<span class="c"># =&gt; Hostname: webpod-697b545f57-rcgf8</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> sh <span class="nt">-c</span> <span class="s1">'while true; do curl -s --connect-timeout 1 webpod | grep Hostname; echo "---" ; sleep 1; done'</span>
<span class="c"># =&gt; Hostname: webpod-697b545f57-rcgf8</span>
<span class="c">#    ---</span>
<span class="c">#    Hostname: webpod-697b545f57-rcgf8</span>
<span class="c">#    ---</span>
<span class="c">#    Hostname: webpod-697b545f57-rcgf8</span>
<span class="c">#    ---</span>
<span class="c">#    Hostname: webpod-697b545f57-p9hhs</span>
<span class="c">#    ...</span>

<span class="c"># cilium-dbg, map</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg ip list
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg endpoint list
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg service list
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg bpf lb list
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg bpf nat list
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg map list | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'0             0'</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg map get cilium_lb4_services_v2
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg map get cilium_lb4_backends_v3
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg map get cilium_lb4_reverse_nat
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium-dbg map get cilium_ipcache_v2
</code></pre></div></div>

<h3 id="transparent-encryption-with-wireguard">Transparent Encryption with WireGuard</h3>

<ul>
  <li>ê° ë…¸ë“œëŠ” ìì²´ ì•”í˜¸í™” í‚¤ ìŒì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  Kubernetes CiliumNode ì»¤ìŠ¤í…€ ë¦¬ì†ŒìŠ¤ ê°ì²´ì˜ <code class="language-plaintext highlighter-rouge">io.cilium.network.wg-pub-key</code> ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ê³µê°œ í‚¤ë¥¼ ë°°í¬í•©ë‹ˆë‹¤.</li>
  <li>ê° ë…¸ë“œì˜ <strong>ê³µê°œí‚¤</strong>ëŠ” í•´ë‹¹ ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ Cilium ê´€ë¦¬ ì—”ë“œí¬ì¸íŠ¸ì˜ íŠ¸ë˜í”½ì„ ì•”í˜¸í™” ë° ì•”í˜¸ í•´ë…í•˜ëŠ” ë° ë‹¤ë¥¸ ë…¸ë“œì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
  <li>í•œ ë…¸ë“œ ë‚´ì—ì„œ íŒŒë“œ(ì—”ë“œí¬ì¸íŠ¸)ê°„ í†µì‹  ì‹œì—ëŠ” ì•”í˜¸í™” ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
  <li>WireGuard í„°ë„ ì—”ë“œí¬ì¸íŠ¸ëŠ” ê° ë…¸ë“œì˜ UDP í¬íŠ¸ 51871ì—ì„œ ë…¸ì¶œë©ë‹ˆë‹¤.</li>
  <li>ì œí•œ ì‚¬í•­ : L7 ì •ì±… ì‹œí–‰ ë° ê°€ì‹œì„±, eBPF ê¸°ë°˜ í˜¸ìŠ¤íŠ¸ ë¼ìš°íŒ…</li>
</ul>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_12.png" alt="img.png" class="image-center w-80" loading="lazy" width="1008" height="567"></p>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_14.gif" alt="20250907_cilium_w8_14.gif" class="image-center" loading="lazy" width="1500" height="844">
<em class="image-caption">Wireguardë¥¼ ì´ìš©í•œ ì•”í˜¸í™”</em></p>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_15.svg" alt="20250907_cilium_w8_15.svg" class="image-center" loading="lazy" width="1626" height="783"></p>

<h3 id="-lab2-wireguard-ì„¤ì •-ë°-ì‹¤ìŠµ">ğŸ”¬ Lab2. WireGuard ì„¤ì • ë° ì‹¤ìŠµ</h3>

<ul>
  <li>í„°ë„ëª¨ë“œëŠ” ë‘ ë²ˆ ìº¡ìŠí™” ë©ë‹ˆë‹¤. - <a href="https://docs.cilium.io/en/stable/security/network/encryption-wireguard/">Docs</a>, <a href="https://www.youtube.com/watch?v=-awkPi3D60E">Youtube</a>
</li>
  <li>WireGuard í„°ë„ ì—”ë“œí¬ì¸íŠ¸ëŠ” 51871ê° ë…¸ë“œì˜ UDP í¬íŠ¸ì— ë…¸ì¶œë©ë‹ˆë‹¤.</li>
  <li>WireGuard ì„¤ì •</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [ì»¤ë„ êµ¬ì„± ì˜µì…˜] CONFIG_WIREGUARD=m on Linux 5.6 and newe </span>
<span class="nv">$ </span><span class="nb">uname</span> <span class="nt">-ar</span>
<span class="c"># =&gt; Linux k8s-ctr 6.8.0-71-generic #71-Ubuntu SMP PREEMPT_DYNAMIC Tue Jul 22 16:44:45 UTC 2025 aarch64 aarch64 aarch64 GNU/Linux</span>
<span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'CONFIG_WIREGUARD=m'</span> /boot/config-<span class="si">$(</span><span class="nb">uname</span> <span class="nt">-r</span><span class="si">)</span>
<span class="c"># =&gt; CONFIG_WIREGUARD=m</span>

<span class="c"># ì„¤ì • ì „ ê¸°ë³¸ ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>ip <span class="nt">-c</span> addr
<span class="nv">$ </span>ip <span class="nt">-c</span> route
<span class="nv">$ </span>ip rule show

<span class="c"># ì„¤ì •</span>
<span class="nv">$ </span>helm upgrade cilium cilium/cilium <span class="nt">--version</span> 1.18.1 <span class="nt">--namespace</span> kube-system <span class="nt">--reuse-values</span> <span class="se">\</span>
  <span class="nt">--set</span> encryption.enabled<span class="o">=</span><span class="nb">true</span> <span class="nt">--set</span> encryption.type<span class="o">=</span>wireguard
<span class="c"># =&gt; Release "cilium" has been upgraded. Happy Helming!</span>
<span class="c">#    ...</span>

<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system rollout restart ds/cilium
<span class="c"># =&gt; daemonset.apps/cilium restarted</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>cilium config view | <span class="nb">grep</span> <span class="nt">-i</span> wireguard
<span class="c"># =&gt; enable-wireguard                                  true</span>
<span class="c">#    wireguard-persistent-keepalive                    0s</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium encrypt status
<span class="c"># =&gt; Encryption: Wireguard</span>
<span class="c">#    Interface: cilium_wg0</span>
<span class="c">#            Public key: chlVHrcv7vafkretDiAyIn0+1bU4xVDzxhSxEUBx9lw=</span>
<span class="c">#            Number of peers: 2</span>

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium status | <span class="nb">grep </span>Encryption
<span class="c"># =&gt; Encryption:              Wireguard   [NodeEncryption: Disabled, cilium_wg0 (Pubkey: chlVHrcv7vafkretDiAyIn0+1bU4xVDzxhSxEUBx9lw=, Port: 51871, Peers: 2)]   </span>

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium debuginfo <span class="nt">--output</span> json
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium debuginfo <span class="nt">--output</span> json | jq .encryption
<span class="c"># =&gt; {</span>
<span class="c">#      "wireguard": {</span>
<span class="c">#        "interfaces": [</span>
<span class="c">#          {</span>
<span class="c">#            "listen-port": 51871,</span>
<span class="c">#            "name": "cilium_wg0",</span>
<span class="c">#            "peer-count": 2,</span>
<span class="c">#            "peers": [</span>
<span class="c">#              {</span>
<span class="c">#                "allowed-ips": [</span>
<span class="c">#                  "172.20.0.0/24",</span>
<span class="c">#                  "192.168.10.100/32",</span>
<span class="c">#                  "172.20.0.103/32",</span>
<span class="c">#                  "172.20.0.93/32",</span>
<span class="c">#                  "172.20.0.36/32",</span>
<span class="c">#                  "172.20.0.5/32",</span>
<span class="c">#                  "172.20.0.168/32",</span>
<span class="c">#                  "172.20.0.27/32",</span>
<span class="c">#                  "172.20.0.190/32"</span>
<span class="c">#                ],</span>
<span class="c">#                "endpoint": "192.168.10.100:51871",</span>
<span class="c">#                "last-handshake-time": "0001-01-01T00:00:00.000Z",</span>
<span class="c">#                "public-key": "9Pva2PmR3ETq7N/GVRHD4IsmmSYEoJTEFzXg7Qe/FGo="</span>
<span class="c">#              },</span>
<span class="c">#              {</span>
<span class="c">#                "allowed-ips": [</span>
<span class="c">#                  "192.168.10.101/32",</span>
<span class="c">#                  "172.20.1.93/32",</span>
<span class="c">#                  "172.20.1.252/32",</span>
<span class="c">#                  "172.20.1.0/24",</span>
<span class="c">#                  "172.20.1.105/32",</span>
<span class="c">#                  "172.20.1.6/32"</span>
<span class="c">#                ],</span>
<span class="c">#                "endpoint": "192.168.10.101:51871",</span>
<span class="c">#                "last-handshake-time": "0001-01-01T00:00:00.000Z",</span>
<span class="c">#                "public-key": "ZkvKJ95K9Bo6xE6DnkFfRPUHNCsuRAnIejCP7OqObB8="</span>
<span class="c">#              }</span>
<span class="c">#            ],</span>
<span class="c">#            "public-key": "chlVHrcv7vafkretDiAyIn0+1bU4xVDzxhSxEUBx9lw="</span>
<span class="c">#          }</span>
<span class="c">#        ],</span>
<span class="c">#        "node-encryption": "Disabled"</span>
<span class="c">#      }</span>
<span class="c">#    }</span>

<span class="nv">$ </span>ip <span class="nt">-d</span> <span class="nt">-c</span> addr show cilium_wg0
<span class="c"># =&gt; 24: cilium_wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1420 qdisc noqueue state UNKNOWN group default</span>
<span class="c">#        link/none  promiscuity 0  allmulti 0 minmtu 0 maxmtu 2147483552</span>
<span class="c">#        wireguard numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 tso_max_size 65536 tso_max_segs 65535 gro_max_size 65536</span>
<span class="nv">$ </span>ip rule show
<span class="c"># =&gt; 9:      from all fwmark 0x200/0xf00 lookup 2004</span>
<span class="c">#    10:     from all fwmark 0xa00/0xf00 lookup 2005</span>
<span class="c">#    100:    from all lookup local</span>
<span class="c">#    32766:  from all lookup main</span>
<span class="c">#    32767:  from all lookup default </span>

<span class="c"># wg ì •ë³´ í™•ì¸</span>
<span class="nv">$ </span>wg <span class="nt">-h</span>
<span class="nv">$ </span>wg show
<span class="c"># =&gt; interface: cilium_wg0</span>
<span class="c">#      public key: 9Pva2PmR3ETq7N/GVRHD4IsmmSYEoJTEFzXg7Qe/FGo=</span>
<span class="c">#      private key: (hidden)</span>
<span class="c">#      listening port: 51871</span>
<span class="c">#      fwmark: 0xe00</span>
<span class="c">#    </span>
<span class="c">#    peer: chlVHrcv7vafkretDiAyIn0+1bU4xVDzxhSxEUBx9lw=</span>
<span class="c">#      endpoint: 192.168.10.102:51871</span>
<span class="c">#      allowed ips: 192.168.10.102/32, 172.20.2.243/32, 172.20.2.226/32, 172.20.2.125/32, 172.20.2.124/32, 172.20.2.140/32, 172.20.2.0/24, 172.20.2.171/32</span>
<span class="c">#    </span>
<span class="c">#    peer: ZkvKJ95K9Bo6xE6DnkFfRPUHNCsuRAnIejCP7OqObB8=</span>
<span class="c">#      endpoint: 192.168.10.101:51871</span>
<span class="c">#      allowed ips: 172.20.1.0/24, 172.20.1.105/32, 172.20.1.93/32, 172.20.1.6/32, 192.168.10.101/32, 172.20.1.252/32</span>

<span class="nv">$ </span>wg show all public-key
<span class="c"># =&gt; cilium_wg0      9Pva2PmR3ETq7N/GVRHD4IsmmSYEoJTEFzXg7Qe/FGo=</span>
<span class="nv">$ </span>wg show all private-key
<span class="nv">$ </span>wg show all preshared-keys
<span class="nv">$ </span>wg show all endpoints
<span class="c"># =&gt; cilium_wg0      chlVHrcv7vafkretDiAyIn0+1bU4xVDzxhSxEUBx9lw=    192.168.10.102:51871</span>
<span class="c">#    ZkvKJ95K9Bo6xE6DnkFfRPUHNCsuRAnIejCP7OqObB8=    192.168.10.101:51871</span>
<span class="nv">$ </span>wg show all transfer
<span class="c"># =&gt; cilium_wg0      chlVHrcv7vafkretDiAyIn0+1bU4xVDzxhSxEUBx9lw=    0       0</span>
<span class="c">#    cilium_wg0      ZkvKJ95K9Bo6xE6DnkFfRPUHNCsuRAnIejCP7OqObB8=    0       0</span>

<span class="c"># í¼ë¸”ë¦­ í‚¤ í™•ì¸</span>
<span class="nv">$ </span>kubectl get cn <span class="nt">-o</span> yaml | <span class="nb">grep </span>annotations <span class="nt">-A1</span>
<span class="c"># =&gt;     annotations:</span>
<span class="c">#          network.cilium.io/wg-pub-key: 9Pva2PmR3ETq7N/GVRHD4IsmmSYEoJTEFzXg7Qe/FGo=</span>
<span class="c">#    --</span>
<span class="c">#        annotations:</span>
<span class="c">#          network.cilium.io/wg-pub-key: ZkvKJ95K9Bo6xE6DnkFfRPUHNCsuRAnIejCP7OqObB8=</span>
<span class="c">#    --</span>
<span class="c">#        annotations:</span>
<span class="c">#          network.cilium.io/wg-pub-key: chlVHrcv7vafkretDiAyIn0+1bU4xVDzxhSxEUBx9lw=</span>
</code></pre></div></div>

<ul>
  <li>í†µì‹  í™•ì¸</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># curl í˜¸ì¶œ</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> curl webpod
<span class="c"># =&gt; Hostname: webpod-697b545f57-rcgf8</span>
<span class="c">#    ...</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> curl-pod <span class="nt">--</span> curl webpod
<span class="c"># =&gt; Hostname: webpod-697b545f57-p9hhs</span>
<span class="c">#    ...</span>

<span class="c"># tcpdump</span>
<span class="nv">$ </span>tcpdump <span class="nt">-i</span> cilium_wg0 <span class="nt">-n</span>
<span class="nv">$ </span>tcpdump <span class="nt">-eni</span> any udp port 51871
<span class="nv">$ </span>tcpdump <span class="nt">-eni</span> any udp port 51871 <span class="nt">-w</span> /tmp/wg.pcap  <span class="c"># vagrant scp k8s-ctr:/tmp/wg.pcap . &gt; wireshark ë¡œ í™•ì¸</span>

<span class="nv">$ </span>termshark /tmp/wg.pcap
<span class="c"># =&gt; termshark 2.4.0  |  wg.pcap                                                                                                                                      Analysis    Misc</span>
<span class="c">#    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“</span>
<span class="c">#    â”ƒFilter:                                                                                                                                                         &lt;Apply&gt; &lt;Recent&gt; â”ƒ</span>
<span class="c">#    â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›</span>
<span class="c">#     No. -   Time -       Source -              Dest -                Proto -        Length -    Info -                                                                               â–²</span>
<span class="c">#     &lt;span style="background-color: #2080fd; color: #fff;"&gt;1       0.000000     192.168.10.100        192.168.10.102        WireGuard      192         Transport Data, receiver=0x12FBD5BA, counter=28, datalen=112                         â–ˆ&lt;/span&gt;</span>
<span class="c">#     2       0.001455     192.168.10.100        192.168.10.102        WireGuard      192         Transport Data, receiver=0x12FBD5BA, counter=29, datalen=112</span>
<span class="c">#     3       0.026152     192.168.10.102        192.168.10.100        WireGuard      240         Transport Data, receiver=0xF6874881, counter=22, datalen=160</span>
<span class="c">#     4       0.026152     192.168.10.102        192.168.10.100        WireGuard      288         Transport Data, receiver=0xF6874881, counter=23, datalen=208</span>
<span class="c">#    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
<span class="c">#    [+] Frame 1: 192 bytes on wire (1536 bits), 192 bytes captured (1536 bits)</span>
<span class="c">#    [+] Linux cooked capture v2</span>
<span class="c">#    [+] Internet Protocol Version 4, Src: 192.168.10.100, Dst: 192.168.10.102</span>
<span class="c">#    [+] User Datagram Protocol, Src Port: 51871, Dst Port: 51871</span>
<span class="c">#    [-] WireGuard Protocol</span>
<span class="c">#          Type: Transport Data (4)</span>
<span class="c">#          Reserved: 000000</span>
<span class="c">#          Receiver: 0x12fbd5ba</span>
<span class="c">#          Counter: 28</span>
<span class="c">#    &lt;span style="background-color: #2080fd; color: #fff;"&gt;      Encrypted Packet [=]          &lt;/span&gt;</span>
<span class="c">#    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
<span class="c">#     0000   08 00 00 00 00 00 00 03  00 01 04 06 08 00 27 5d   ........ ......']</span>
<span class="c">#     0010   09 97 00 00 45 00 00 ac  70 7e 00 00 40 11 73 a8   ....E... p~..@.s.</span>
<span class="c">#     0020   c0 a8 0a 64 c0 a8 0a 66  ca 9f ca 9f 00 98 96 c4   ...d...f ........</span>
<span class="c">#     0030   04 00 00 00 ba d5 fb 12  1c 00 00 00 00 00 00 00   ........ ........</span>
<span class="c">#     0040   e6 &lt;span style="background-color: #2080fd; color: #fff;"&gt;08 0f da 17 ab 05 18  ad a8 92 a6 53 17 5e 27&lt;/span&gt;   ........ ....S.^'</span>
<span class="c">#     0050   &lt;span style="background-color: #2080fd; color: #fff;"&gt;79 e8 ce 06 41 63 c2 9b  e1 51 3b b7 a1 a9 82 09&lt;/span&gt;   y...Ac.. .Q;.....</span>
<span class="c">#     0060   &lt;span style="background-color: #2080fd; color: #fff;"&gt;f5 71 8a f3 f9 ad aa 78  40 01 cd e6 22 43 cb 6d&lt;/span&gt;   .q.....x @..."C.m</span>
<span class="c">#     0070   &lt;span style="background-color: #2080fd; color: #fff;"&gt;3e 06 60 40 67 27 5e 96  8b 6f 43 87 32 89 bb 54&lt;/span&gt;   &gt;.`@g'^. .oC.2..T</span>
<span class="c">#     0080   &lt;span style="background-color: #2080fd; color: #fff;"&gt;cc dd 61 ff 0b 52 32 31  7a e0 9f 1f de 50 6e d5&lt;/span&gt;   ..a..R21 z....Pn.</span>
<span class="c">#     0090   &lt;span style="background-color: #2080fd; color: #fff;"&gt;0a 69 d4 d3 9c 73 8d a3  60 ff 34 2b 51 40 65 48&lt;/span&gt;   .i...s.. `.4+Q@eH</span>
<span class="c">#     00a0   &lt;span style="background-color: #2080fd; color: #fff;"&gt;19 8d 8c fb e3 41 40 13  63 06 b8 1a 96 64 10 58&lt;/span&gt;   .....A@. c....d.X</span>
<span class="c">#     00b0   &lt;span style="background-color: #2080fd; color: #fff;"&gt;44 3b fa 0c 7d f8 09 98  f3 50 98 7c 64 04 cd 59&lt;/span&gt;   D;..}... .P.|d..Y</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ íŒ¨í‚·ì´ ì•”í˜¸í™” ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>

<span class="c"># query the flow API and look for flows</span>
<span class="nv">$ </span>hubble observe <span class="nt">--pod</span> curl-pod
</code></pre></div></div>

<ul>
  <li>
<strong>Node-to-Node Encryption (beta)</strong> : ì•„ì§ ë² íƒ€ ê¸°ëŠ¥ì´ì§€ë§Œ <code class="language-plaintext highlighter-rouge">--set encryption.nodeEncryption=true</code> ì˜µì…˜ì„ í†µí•´ ë…¸ë“œ - ë…¸ë“œ , ë…¸ë“œ - íŒŒë“œ ê°„ íŠ¸ë˜í”½ë„ ì•”í˜¸í™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì„¤ì • ì›ë³µ</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>helm upgrade cilium cilium/cilium <span class="nt">--version</span> 1.18.1 <span class="nt">--namespace</span> kube-system <span class="nt">--reuse-values</span> <span class="se">\</span>
  <span class="nt">--set</span> encryption.enabled<span class="o">=</span><span class="nb">false</span>
<span class="c"># =&gt; Release "cilium" has been upgraded. Happy Helming!</span>
<span class="c">#    ...</span>

<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system rollout restart ds/cilium
<span class="c"># =&gt; daemonset.apps/cilium restarted</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>cilium config view | <span class="nb">grep</span> <span class="nt">-i</span> wireguard
<span class="c"># =&gt; (ì—†ìŒ)</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium encrypt status
<span class="c"># =&gt; Encryption: Disabled</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">-n</span> kube-system ds/cilium <span class="nt">--</span> cilium status | <span class="nb">grep </span>Encryption
<span class="c"># =&gt; Encryption:              Disabled</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ WireGuard ì¸í„°í˜ì´ìŠ¤ ë° ì„¤ì •ì´ ì œê±°ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>
</code></pre></div></div>

<h3 id="inspecting-tls-encrypted-connections">Inspecting TLS Encrypted Connections</h3>

<ul>
  <li><a href="https://docs.cilium.io/en/stable/security/tls-visibility/">ê´€ë ¨ë¬¸ì„œ</a></li>
</ul>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_16.png" alt="img.png" class="image-center" loading="lazy" width="1204" height="688">
<em class="image-caption"><a href="https://docs.cilium.io/en/stable/security/tls-visibility/">https://docs.cilium.io/en/stable/security/tls-visibility/</a></em></p>

<ul>
  <li>ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì€ ë³´ì•ˆì„ ìœ„í•´ TLS(Transport Layer Security)ë¡œ ì•”í˜¸í™”ë˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.</li>
  <li>ê·¸ëŸ¬ë‚˜ ì•”í˜¸í™”ëœ ì—°ê²°ì€ ì •ì±… ì ìš©ì´ë‚˜ ê°€ì‹œì„± í™•ë³´ ì¸¡ë©´ì—ì„œ ì œì•½ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>Ciliumì€ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ <strong>TLS ì•”í˜¸í™”ëœ ì—°ê²°ë„ íˆ¬ëª…í•˜ê²Œ ê²€ì‚¬í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥</strong>ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
</ul>

<h5 id="ì†Œê°œ">ì†Œê°œ</h5>

<ul>
  <li>Ciliumì€ <strong>HTTPSì™€ ê°™ì€ TLS ë³´í˜¸ ì—°ê²°ì—ì„œë„ API ì¸ì‹ ê°€ì‹œì„±ê³¼ ì •ì±… ì ìš©</strong>ì„ ì§€ì›í•©ë‹ˆë‹¤.</li>
  <li>ê¸°ì¡´ í•˜ë“œì›¨ì–´ ë°©í™”ë²½ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, ì „ì ìœ¼ë¡œ <strong>ì¿ ë²„ë„¤í‹°ìŠ¤ ì›Œì»¤ ë…¸ë“œì˜ ì†Œí”„íŠ¸ì›¨ì–´ ë°©ì‹</strong>ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.</li>
  <li>ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆíŒ€ì€ <strong>ë‚´ë¶€ ì¸ì¦ ê¸°ê´€(CA)</strong>ì„ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ê°€ ì´ë¥¼ ì‹ ë¢°í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.</li>
  <li>Ciliumì€ TLS ì—°ê²°ì„ ì¤‘ê°„ì—ì„œ ì¢…ë£Œí•˜ê³  ë‚´ë¶€ CA ì„œëª… ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ€ìƒ ì„œë¹„ìŠ¤ì™€ <strong>ìƒˆë¡œìš´ TLS ì—°ê²°</strong>ì„ ë§ºìŠµë‹ˆë‹¤.</li>
  <li>ì´ë¥¼ í†µí•´ <strong>ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ ë°ì´í„° ê²€ì‚¬</strong>ì™€ <strong>ì •ì±… ì ìš©</strong>ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.</li>
</ul>

<h5 id="tls-ê²€ì‚¬-êµ¬ì„±-ë‹¨ê³„">TLS ê²€ì‚¬ êµ¬ì„± ë‹¨ê³„</h5>

<p>TLS ê²€ì‚¬ë¥¼ êµ¬í˜„í•˜ë ¤ë©´ CA ê¸°ë°˜ ëª¨ë¸ì„ ë”°ë¼ì•¼ í•˜ë©°, ê¸°ë³¸ ì ˆì°¨ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>

<ol>
  <li>
<strong>ë‚´ë¶€ CA ìƒì„±</strong>: CA ì¸ì¦ì„œë¥¼ ìƒì„±í•˜ì—¬ <strong>ë‚´ë¶€ì¸ì¦ê¸°ê´€</strong>ì„ ë§Œë“­ë‹ˆë‹¤.</li>
  <li>
<strong>ëŒ€ìƒ ì„œë¹„ìŠ¤ ì¸ì¦ì„œ ìš”ì²­</strong>: DNS ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ” ì„œëª… ìš”ì²­(CSR: Certificate Signing Request)ì„ ìƒì„±í•©ë‹ˆë‹¤.</li>
  <li>
<strong>CA ì„œëª… ì¸ì¦ì„œ ë°œê¸‰</strong>: ë‚´ë¶€ CAë¡œ ì„œëª…ëœ ì¸ì¦ì„œë¥¼ ë§Œë“­ë‹ˆë‹¤.</li>
  <li>
<strong>í´ë¼ì´ì–¸íŠ¸ ì‹ ë¢° ì²´ì¸ êµ¬ì„±</strong>: í´ë¼ì´ì–¸íŠ¸ì— CA ì¸ì¦ì„œë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</li>
  <li>
<strong>Cilium êµ¬ì„±</strong>: ìƒˆë¡œìš´ TLS ì—°ê²°ì„ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  ì‹ ë¢°í•  CA ì§‘í•©ì„ ì§€ì •í•©ë‹ˆë‹¤.</li>
</ol>

<blockquote>
  <p>âš ï¸ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” <strong>CA ê°œì¸ í‚¤ ë³´ê´€ì´ ë§¤ìš° ì¤‘ìš”</strong>í•©ë‹ˆë‹¤.<br>
ê°œì¸ í‚¤ê°€ ìœ ì¶œë˜ë©´ TLS íŠ¸ë˜í”½ì„ ëˆ„êµ¬ë‚˜ ê°€ë¡œì±„ì–´ ê²€ì‚¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.<br>
ë°˜ëŒ€ë¡œ ì¸ì¦ì„œëŠ” ê³µê°œ ì •ë³´ì´ë¯€ë¡œ ë¯¼ê°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
</blockquote>

<h5 id="tls-ê²€ì‚¬-ë™ì‘-ë°©ì‹">TLS ê²€ì‚¬ ë™ì‘ ë°©ì‹</h5>

<ul>
  <li>Ciliumì€ í´ë¼ì´ì–¸íŠ¸ì™€ì˜ ì›ë˜ TLS ì—°ê²°ì„ ì¢…ë£Œí•˜ê³ , Envoyë¥¼ í†µí•´ ëŒ€ìƒ ì„œë¹„ìŠ¤ì™€ ìƒˆë¡œìš´ TLS ì—°ê²°ì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤.</li>
  <li>ë„¤íŠ¸ì›Œí¬ ì •ì±…ì—ëŠ” <code class="language-plaintext highlighter-rouge">terminatingTLS</code> ë° <code class="language-plaintext highlighter-rouge">originatingTLS</code> ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
  <li>ì´ ê³¼ì •ì—ì„œ í•µì‹¬ì€ <strong>Envoyì— ì¸ì¦ì„œë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹</strong>ì…ë‹ˆë‹¤.</li>
  <li>
    <p><strong>NPDS</strong>(ì›ë˜ì˜ ë²„ì „)ì™€ <strong>SDS</strong>(ìƒˆë¡­ê³  í–¥ìƒëœ ë²„ì „) ë‘ ê°€ì§€ ë°©ì‹ì„ ì œê³µí•˜ê³  ìˆìœ¼ë©° ê°ê° ì¥ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
<strong>NPDS (Network Policy Discovery Service)</strong>
    <ul>
      <li>ì¸ì¦ì„œì™€ í‚¤ë¥¼ Base64 í…ìŠ¤íŠ¸ë¡œ ì¸ë¼ì¸ ì „ì†¡í•©ë‹ˆë‹¤.</li>
      <li>ë‹¨ìˆœí•˜ì§€ë§Œ ë™ì¼ ì¸ì¦ì„œë¥¼ ì—¬ëŸ¬ ì •ì±…ì—ì„œ ì‚¬ìš©í•  ê²½ìš° <strong>Envoy ë©”ëª¨ë¦¬ì— ì¤‘ë³µ ì €ì¥</strong>ë©ë‹ˆë‹¤.</li>
      <li>ëŒ€ê·œëª¨ í™˜ê²½ì—ì„œëŠ” ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ê¸‰ì¦í•  ìˆ˜ ìˆëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
<strong>SDS (Secret Discovery Service)</strong>
    <ul>
      <li>Cilium 1.17ë¶€í„° ë„ì…ëœ ê°œì„ ëœ ë°©ì‹ì…ë‹ˆë‹¤.</li>
      <li>Kubernetes ì‹œí¬ë¦¿ì„ ì°¸ì¡°í•˜ì—¬ Envoy SDS APIë¥¼ í†µí•´ ì „ë‹¬í•©ë‹ˆë‹¤.</li>
      <li>ì¸ì¦ì„œê°€ <strong>ì°¸ì¡° ê¸°ë°˜ìœ¼ë¡œ ì „ë‹¬</strong>ë˜ë¯€ë¡œ ì¤‘ë³µ ì €ì¥ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</li>
      <li>ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ê³¼ ë³´ì•ˆì´ ë›°ì–´ë‚˜ë©°, <strong>Cilium 1.17 ì´í›„ ê¸°ë³¸ê°’</strong>ìœ¼ë¡œ ê¶Œì¥ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h5 id="tls-interception-êµ¬ì„±-cilium-117">TLS Interception êµ¬ì„± (Cilium 1.17+)</h5>

<ul>
  <li>Ciliumì€ ì„¸ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ TLS Interceptionì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</li>
</ul>

<ol>
  <li>
<strong>SDS (ê¶Œì¥ ë°©ì‹)</strong>
    <ul>
      <li>ì •ì±…ì—ì„œ ì°¸ì¡°í•œ ì‹œí¬ë¦¿ì„ <code class="language-plaintext highlighter-rouge">cilium-secrets</code> ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ë³µì‚¬ í›„ SDSë¡œ ë™ê¸°í™”í•©ë‹ˆë‹¤.</li>
      <li>ê¸°ë³¸ê°’ì´ì ê°€ì¥ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ë°©ì‹ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tls</span><span class="pi">:</span>
  <span class="na">readSecretsOnlyFromSecretsNamespace</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">secretsNamespace</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cilium-secrets</span> <span class="c1"># This setting is optional, as it is the default</span>
  <span class="na">secretSync</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div>

<ol>
  <li>
<strong>NPDS ì¸ë¼ì¸ ë°©ì‹</strong> (ë¹„ê¶Œì¥)
    <ul>
      <li>í´ëŸ¬ìŠ¤í„° ë‚´ ì–´ëŠ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë“  ì‹œí¬ë¦¿ì„ ì €ì¥í•  ìˆ˜ ìˆê³ , Ciliumì´ ì§ì ‘ ì½ì–´ Envoyì— ì „ë‹¬í•©ë‹ˆë‹¤.</li>
      <li>ë³´ì•ˆ ë²”ìœ„ê°€ í¬ê²Œ í™•ì¥ë˜ë¯€ë¡œ ê¶Œì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tls:
  readSecretsOnlyFromSecretsNamespace: <span class="nb">false
  </span>secretSync:
    enabled: <span class="nb">false</span>
</code></pre></div></div>

<ol>
  <li>
<strong>í•˜ìœ„ í˜¸í™˜ ëª¨ë“œ</strong>
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">cilium-secrets</code> ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì§ì ‘ ì°¸ì¡°í•©ë‹ˆë‹¤.</li>
      <li>ì—…ê·¸ë ˆì´ë“œ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€ë˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tls</span><span class="pi">:</span>
  <span class="na">readSecretsOnlyFromSecretsNamespace</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">secretsNamespace</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cilium-secrets</span> <span class="c1"># This setting is optional, as it is the default</span>
  <span class="na">secretSync</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">false</span>
</code></pre></div></div>

<ul>
  <li>Helm ì„¤ì • ì£¼ìš” í•­ëª©
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">tls.secretsNamespace.name</code> : ì •ì±… ë¹„ë°€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (ê¸°ë³¸ê°’: <code class="language-plaintext highlighter-rouge">cilium-secrets</code>)</li>
      <li>
<code class="language-plaintext highlighter-rouge">tls.readSecretsOnlyFromSecretsNamespace</code> : ì§€ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œë§Œ ë¹„ë°€ ì½ê¸° (ê¸°ë³¸ê°’: <code class="language-plaintext highlighter-rouge">true</code>)</li>
      <li>
<code class="language-plaintext highlighter-rouge">tls.secretSync.enabled</code> : sSDS ì‚¬ìš©ì„ ìœ„í•œ ë¹„ë°€ ë™ê¸°í™” í™œì„±í™” (ê¸°ë³¸ê°’: <code class="language-plaintext highlighter-rouge">true</code>)</li>
    </ul>
  </li>
</ul>

<h5 id="cilium-tls-interception-ì„¤ì •-sds-mode">Cilium TLS Interception ì„¤ì • (SDS Mode)</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl get all,secret,cm <span class="nt">-n</span> cilium-secrets
<span class="c"># =&gt; NAME                         DATA   AGE</span>
<span class="c">#    configmap/kube-root-ca.crt   1      3h33m</span>

<span class="c">#</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; tls-config.yaml
tls:
  readSecretsOnlyFromSecretsNamespace: true
  secretsNamespace:
    name: cilium-secrets # This setting is optional, as it is the default
  secretSync:
    enabled: true
</span><span class="no">EOF

</span><span class="nv">$ </span>helm upgrade cilium cilium/cilium <span class="nt">--version</span> 1.18.1 <span class="nt">--namespace</span> kube-system <span class="nt">--reuse-values</span> <span class="se">\</span>
  <span class="nt">-f</span> tls-config.yaml
<span class="c"># =&gt; Release "cilium" has been upgraded. Happy Helming!</span>
<span class="c">#    ...</span>

<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system rollout restart deploy/cilium-operator
<span class="c"># =&gt; deployment.apps/cilium-operator restarted</span>
<span class="nv">$ </span>kubectl <span class="nt">-n</span> kube-system rollout restart ds/cilium
<span class="c"># =&gt; daemonset.apps/cilium restarted</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>cilium config view | <span class="nb">grep</span> <span class="nt">-i</span> secret
<span class="c"># =&gt; enable-ingress-secrets-sync                       true</span>
<span class="c">#    enable-policy-secrets-sync                        true</span>
<span class="c">#    ingress-secrets-namespace                         cilium-secrets</span>
<span class="c">#    policy-secrets-namespace                          cilium-secrets</span>
<span class="c">#    policy-secrets-only-from-secrets-namespace        true</span>
</code></pre></div></div>

<h3 id="-lab3-tls-interception-ì‹¤ìŠµ">ğŸ”¬ Lab3. TLS Interception ì‹¤ìŠµ</h3>

<ul>
  <li>
    <p><a href="https://docs.cilium.io/en/stable/security/tls-visibility/#deploy-the-demo-application">ê´€ë ¨ë¬¸ì„œ</a></p>
  </li>
  <li>TLS ê°€ë¡œì±„ê¸°ë¥¼ ì‹œì—°í•˜ê¸° ìœ„í•´ DNS ì¸ì‹ ì •ì±… ì˜ˆì œì— ì‚¬ìš©í•œ ê²ƒê³¼ ë™ì¼í•œ <code class="language-plaintext highlighter-rouge">mediabot</code>ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤. ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ HTTPSë¥¼ ì‚¬ìš©í•˜ì—¬ Star Wars API ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤. ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ Ciliumê³¼ ê°™ì€ ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ ë©”ì»¤ë‹ˆì¦˜ì´ í†µì‹ ì˜ HTTP ê³„ì¸µ ì„¸ë¶€ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ì—†ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„°ëŠ” ë„¤íŠ¸ì›Œí¬ë¡œ ì „ì†¡ë˜ê¸° ì „ì— TLSë¥¼ ì‚¬ìš©í•˜ì—¬ ì•”í˜¸í™”ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</li>
  <li>ë‹¤ìŒì˜ í•­ëª©ì„ ì‹¤ìŠµí•˜ë©´ì„œ TLS ê°€ë¡œì±„ê¸° ê¸°ëŠ¥ì„ ì´í•´í•´ ë³´ê² ìŠµë‹ˆë‹¤.
    <ul>
      <li>
<strong>TLS ê°€ë¡œì±„ê¸°ë¥¼ í™œì„±í™”</strong>í•˜ê¸° ìœ„í•´ <strong>ë‚´ë¶€ ì¸ì¦ ê¸°ê´€(CA)ê³¼ í•´ë‹¹ CAê°€ ì„œëª…í•œ ê´€ë ¨ ì¸ì¦ì„œ</strong> ìƒì„±</li>
      <li>
<strong>DNS ê¸°ë°˜ ì •ì±… ê·œì¹™</strong>ì„ ì‚¬ìš©í•˜ì—¬ <strong>ê°€ë¡œì±Œ íŠ¸ë˜í”½ì„ ì„ íƒ</strong>í•˜ë ¤ë©´ <strong>Cilium ë„¤íŠ¸ì›Œí¬ ì •ì±…ì„</strong> ì‚¬ìš©</li>
      <li>cilium monitorë¥¼ ì‚¬ìš©í•˜ì—¬ <strong>HTTP ìš”ì²­ì˜ ì„¸ë¶€ ì‚¬í•­ì„ ê²€ì‚¬</strong>
</li>
    </ul>
  </li>
</ul>

<h5 id="ë‹¨ì¼-í¬ë“œ-mediabot-ì• í”Œë¦¬ì¼€ì´ì…˜ì„-ìƒì„±">ë‹¨ì¼ í¬ë“œ mediabot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># </span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; dns-sw-app.yaml
apiVersion: v1
kind: Pod
metadata:
  name: mediabot
  labels:
    org: empire
    class: mediabot
    app: mediabot
spec:
  containers:
  - name: mediabot
    image: quay.io/cilium/json-mock:v1.3.8@sha256:5aad04835eda9025fe4561ad31be77fd55309af8158ca8663a72f6abb78c2603
</span><span class="no">EOF

</span><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> dns-sw-app.yaml
<span class="c"># =&gt; pod/mediabot created</span>
<span class="nv">$ </span>kubectl <span class="nb">wait </span>pod/mediabot <span class="nt">--for</span><span class="o">=</span><span class="nv">condition</span><span class="o">=</span>Ready
<span class="c"># =&gt; pod/mediabot condition met</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get pods
<span class="c"># =&gt; NAME                      READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    mediabot                  1/1     Running   0          16s</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> https://api.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 200</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> curl <span class="nt">-I</span> <span class="nt">-s</span> <span class="nt">--max-time</span> 5 https://support.github.com | <span class="nb">head</span> <span class="nt">-1</span>
<span class="c"># =&gt; HTTP/2 302</span>
</code></pre></div></div>

<h5 id="tls-í‚¤-ë°-ì¸ì¦ì„œ-ìƒì„±-ë°-ì„¤ì¹˜">TLS í‚¤ ë° ì¸ì¦ì„œ ìƒì„± ë° ì„¤ì¹˜</h5>

<ul>
  <li>ì•„ë˜ì˜ ì´ë¯¸ì§€ëŠ” ìƒì„±ë˜ê±°ë‚˜ ë³µì‚¬ë˜ëŠ” ì•”í˜¸í™” ë°ì´í„°ê°€ í¬í•¨ëœ ë‹¤ì–‘í•œ íŒŒì¼ê³¼ ì‹œìŠ¤í…œì˜ ì–´ë–¤ êµ¬ì„± ìš”ì†Œê°€ í•´ë‹¹ íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•´ì•¼ í•˜ëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_17.png" alt="img.png" class="image-center" loading="lazy" width="1204" height="688">
<em class="image-caption">ì•”í˜¸í™” ë°ì´í„°ì™€ ì‹œìŠ¤í…œì˜ êµ¬ì„±ìš”ì†Œê°„ì˜ ì•¡ì„¸ìŠ¤ ê´€ê³„ë„</em></p>

<ul>
  <li>ë¡œì»¬ ì‹œìŠ¤í…œì— opensslì´ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° ê°„ë‹¨í•œ ë‹¨ì¶•í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ cilium í¬ë“œ ë‚´ì—ì„œ ì‹¤í–‰í•œ í›„ ê²°ê³¼ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>Kubernetes ì‹œí¬ë¦¿ì„ ìƒì„±í•˜ê±°ë‚˜ í¬ë“œì— ë³µì‚¬í•  ë•Œ cilium í¬ë“œì—ì„œ ê²°ê³¼ íŒŒì¼ì„ ë³µì‚¬í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ .</li>
</ul>

<h5 id="ë‚´ë¶€-ì¸ì¦-ê¸°ê´€ca-ë§Œë“¤ê¸°">ë‚´ë¶€ ì¸ì¦ ê¸°ê´€(CA) ë§Œë“¤ê¸°</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 'myCA.key'ë¼ëŠ” ì´ë¦„ì˜ CA ê°œì¸ í‚¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>openssl genrsa <span class="nt">-des3</span> <span class="nt">-out</span> myCA.key 2048
<span class="c"># =&gt; Enter PEM pass phrase: qwe123          # &lt;span style="color: green;"&gt;CA ì¸ì¦ì„œì—ì„œ ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸ ì…ë ¥&lt;/span&gt;</span>
<span class="c">#    Verifying - Enter PEM pass phrase: qwe123</span>

<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.key
<span class="c"># =&gt; myCA.key</span>

<span class="c"># ê°œì¸ í‚¤ì—ì„œ CA ì¸ì¦ì„œë¥¼ ìƒì„±</span>
<span class="nv">$ </span>openssl req <span class="nt">-x509</span> <span class="nt">-new</span> <span class="nt">-nodes</span> <span class="nt">-key</span> myCA.key <span class="nt">-sha256</span> <span class="nt">-days</span> 1825 <span class="nt">-out</span> myCA.crt
<span class="c"># =&gt; Enter pass phrase for myCA.key: qwe123   # &lt;span style="color: green;"&gt;ê°œì¸ í‚¤ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥&lt;/span&gt;</span>
<span class="c">#    You are about to be asked to enter information that will be incorporated</span>
<span class="c">#    into your certificate request.</span>
<span class="c">#    What you are about to enter is what is called a Distinguished Name or a DN.</span>
<span class="c">#    There are quite a few fields but you can leave some blank</span>
<span class="c">#    For some fields there will be a default value,</span>
<span class="c">#    If you enter '.', the field will be left blank.</span>
<span class="c">#    -----</span>
<span class="c">#    Country Name (2 letter code) [AU]:KR</span>
<span class="c">#    State or Province Name (full name) [Some-State]:Seoul</span>
<span class="c">#    Locality Name (eg, city) []:Seoul</span>
<span class="c">#    Organization Name (eg, company) [Internet Widgits Pty Ltd]:cloudneta</span>
<span class="c">#    Organizational Unit Name (eg, section) []:study</span>
<span class="c">#    Common Name (e.g. server FQDN or YOUR name) []:cloudneta.net</span>
<span class="c">#    Email Address []:</span>

<span class="nv">$ </span><span class="nb">ls</span> <span class="k">*</span>.crt
<span class="c"># =&gt; myCA.crt</span>

<span class="nv">$ </span>openssl x509 <span class="nt">-in</span> myCA.crt <span class="nt">-noout</span> <span class="nt">-text</span>
<span class="c"># =&gt; ...</span>
<span class="c">#            Issuer: C = KR, ST = Seoul, L = Seoul, O = cloudneta, OU = study, CN = cloudneta.net</span>
<span class="c">#            Validity</span>
<span class="c">#                Not Before: Sep  6 10:55:56 2025 GMT</span>
<span class="c">#                Not After : Sep  5 10:55:56 2030 GMT</span>
<span class="c">#            Subject: C = KR, ST = Seoul, L = Seoul, O = cloudneta, OU = study, CN = cloudneta.net</span>
<span class="c">#    ...</span>
<span class="c">#                X509v3 Basic Constraints: critical</span>
<span class="c">#                    CA:TRUE</span>
<span class="c">#    ...</span>
</code></pre></div></div>

<h5 id="ì§€ì •ëœ-dns-ì´ë¦„ì—-ëŒ€í•œ-ê°œì¸-í‚¤-ë°-ì¸ì¦ì„œ-ì„œëª…-ìš”ì²­-ìƒì„±">ì§€ì •ëœ DNS ì´ë¦„ì— ëŒ€í•œ ê°œì¸ í‚¤ ë° ì¸ì¦ì„œ ì„œëª… ìš”ì²­ ìƒì„±</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ê²€ì‚¬ë¥¼ ìœ„í•´ ê°€ë¡œì±„ë ¤ëŠ” ëŒ€ìƒ ì„œë¹„ìŠ¤ì˜ DNS ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ” ì¼ë°˜ ì´ë¦„ì„ ì‚¬ìš©í•˜ì—¬ ë‚´ë¶€ ê°œì¸ í‚¤ì™€ ì¸ì¦ì„œ ì„œëª…ì„ ìƒì„±í•©ë‹ˆë‹¤</span>
<span class="c">## ì´ ì˜ˆì—ì„œëŠ” httpbin.org</span>

<span class="c"># ë¨¼ì € ê°œì¸ í‚¤ë¥¼ ë§Œë“­ë‹ˆë‹¤.</span>
<span class="nv">$ </span>openssl genrsa <span class="nt">-out</span> internal-httpbin.key 2048
<span class="nv">$ </span><span class="nb">ls </span>internal-httpbin.key
<span class="c"># =&gt; internal-httpbin.key</span>

<span class="c"># ë‹¤ìŒìœ¼ë¡œ, ì¸ì¦ì„œ ì„œëª… ìš”ì²­ì„ ìƒì„±í•˜ê³ , ë©”ì‹œì§€ê°€ í‘œì‹œë˜ë©´ ì¼ë°˜ ì´ë¦„ í•„ë“œì— ëŒ€ìƒ ì„œë¹„ìŠ¤ì˜ DNS ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤. </span>
<span class="c"># ë‹¤ë¥¸ ëª¨ë“  ë©”ì‹œì§€ì—ëŠ” ì›í•˜ëŠ” ê°’ì„ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
<span class="c"># íŠ¹ì • ê°’ì´ì–´ì•¼ í•˜ëŠ” ìœ ì¼í•œ í•„ë“œëŠ” í´ë¼ì´ì–¸íŠ¸ì— ì œê³µë  ì •í™•í•œ DNS ëŒ€ìƒì„ ë³´ì¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. Common Name: httpbin.org</span>
<span class="c"># ì´ ì˜ˆì œ ì›Œí¬í”Œë¡œëŠ” ì •ì±… YAML(ì•„ë˜)ì˜ toFQDNs ê·œì¹™ë„ ì¸ì¦ì„œì˜ DNS ì´ë¦„ê³¼ ì¼ì¹˜í•˜ë„ë¡ ì—…ë°ì´íŠ¸ë˜ëŠ” í•œ ëª¨ë“  DNS ì´ë¦„ì— ì ìš©ë©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>openssl req <span class="nt">-new</span> <span class="nt">-key</span> internal-httpbin.key <span class="nt">-out</span> internal-httpbin.csr
<span class="c"># =&gt; ...</span>
<span class="c">#    Common Name (e.g. server FQDN or YOUR name) []:httpbin.org</span>
<span class="c">#    ...</span>

<span class="nv">$ </span><span class="nb">ls </span>internal-httpbin.csr
<span class="c"># =&gt; internal-httpbin.csr</span>
</code></pre></div></div>

<h5 id="caë¥¼-ì‚¬ìš©í•˜ì—¬-dns-ì´ë¦„ì—-ëŒ€í•œ-ì„œëª…ëœ-ì¸ì¦ì„œ-ìƒì„±">CAë¥¼ ì‚¬ìš©í•˜ì—¬ DNS ì´ë¦„ì— ëŒ€í•œ ì„œëª…ëœ ì¸ì¦ì„œ ìƒì„±</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë‚´ë¶€ CA ê°œì¸ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ httpbin.orgì— ëŒ€í•œ ì„œëª…ëœ ì¸ì¦ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤ internal-httpbin.crt</span>
<span class="nv">$ </span>openssl x509 <span class="nt">-req</span> <span class="nt">-days</span> 360 <span class="nt">-in</span> internal-httpbin.csr <span class="nt">-CA</span> myCA.crt <span class="nt">-CAkey</span> myCA.key <span class="nt">-CAcreateserial</span> <span class="nt">-out</span> internal-httpbin.crt <span class="nt">-sha256</span>
<span class="c"># =&gt; Certificate request self-signature ok</span>
<span class="c">#    subject=C = KR, ST = Seoul, L = Seoul, O = cloudneta, OU = study, CN = httpbin.org</span>
<span class="c">#    Enter pass phrase for myCA.key: qwe123     &lt;span style="color: green;"&gt;CA ê°œì¸ í‚¤ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥&lt;/span&gt;</span>
  
<span class="nv">$ </span><span class="nb">ls </span>internal-httpbin.crt
<span class="c"># =&gt; internal-httpbin.crt</span>
<span class="nv">$ </span>openssl x509 <span class="nt">-in</span> internal-httpbin.crt <span class="nt">-noout</span> <span class="nt">-text</span>
<span class="c"># =&gt; ...</span>
<span class="c">#            Issuer: C = KR, ST = Seoul, L = Seoul, O = cloudneta, OU = study, CN = cloudneta.net   # &lt;span style="color: green;"&gt;ë‚´ë¶€ CA ì¸ì¦ì„œ ì •ë³´&lt;/span&gt;</span>
<span class="c">#            Validity</span>
<span class="c">#                Not Before: Sep  6 11:00:18 2025 GMT</span>
<span class="c">#                Not After : Sep  1 11:00:18 2026 GMT</span>
<span class="c">#            Subject: C = KR, ST = Seoul, L = Seoul, O = cloudneta, OU = study, CN = httpbin.org    # &lt;span style="color: green;"&gt;ëŒ€ìƒ ì„œë¹„ìŠ¤ ì¸ì¦ì„œ ì •ë³´&lt;/span&gt;</span>
  
<span class="c"># ë‹¤ìŒìœ¼ë¡œ ëŒ€ìƒ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê°œì¸ í‚¤ì™€ ì„œëª…ëœ ì¸ì¦ì„œë¥¼ ëª¨ë‘ í¬í•¨í•˜ëŠ” Kubernetes ë¹„ë°€ì„ ìƒì„±í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>kubectl create secret tls httpbin-tls-data <span class="nt">-n</span> kube-system <span class="nt">--cert</span><span class="o">=</span>internal-httpbin.crt <span class="nt">--key</span><span class="o">=</span>internal-httpbin.key
<span class="c"># =&gt; secret/httpbin-tls-data created</span>
<span class="nv">$ </span>kubectl get secret <span class="nt">-n</span> kube-system  httpbin-tls-data
<span class="c"># =&gt; NAME               TYPE                DATA   AGE</span>
<span class="c">#    httpbin-tls-data   kubernetes.io/tls   2      10s  </span>
</code></pre></div></div>

<h5 id="í´ë¼ì´ì–¸íŠ¸-í¬ë“œ-ë‚´ì—ì„œ-ì‹ ë¢°í• -ìˆ˜-ìˆëŠ”-caë¡œ-ë‚´ë¶€-ca-ì¶”ê°€">í´ë¼ì´ì–¸íŠ¸ í¬ë“œ ë‚´ì—ì„œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CAë¡œ ë‚´ë¶€ CA ì¶”ê°€</h5>

<ul>
  <li>CA ì¸ì¦ì„œê°€ í´ë¼ì´ì–¸íŠ¸ í¬ë“œì— ì €ì¥ëœ í›„ì—ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” TLS ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ CA íŒŒì¼ì„ ì¸ì‹í•˜ëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
    <ul>
      <li>ëŒ€ë¶€ë¶„ì˜ Linux ì• í”Œë¦¬ì¼€ì´ì…˜ì€ Linux ë°°í¬íŒê³¼ í•¨ê»˜ ì œê³µë˜ëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CA ì¸ì¦ì„œ ì„¸íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
        <ul>
          <li>ì´ ê°€ì´ë“œì—ì„œëŠ” Ubuntu ì»¨í…Œì´ë„ˆë¥¼ í´ë¼ì´ì–¸íŠ¸ë¡œ ì‚¬ìš©í•˜ë¯€ë¡œ Ubuntuë³„ ì§€ì¹¨ì— ë”°ë¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ë‹¤ë¥¸ Linux ë°°í¬íŒì€ ë‹¤ë¥¸ ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>ê°œë³„ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ OS ì¸ì¦ì„œ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  ìì²´ ì¸ì¦ì„œ ì €ì¥ì†Œë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ëŸ°íƒ€ì„ ì„¤ëª…ì„œë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.</li>
    </ul>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> mediabot <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-l</span> /usr/local/share/ca-certificates/
<span class="c"># =&gt; total 0</span>
  
<span class="c"># Ubuntuì˜ ê²½ìš° ë¨¼ì € ì¶”ê°€ CA ì¸ì¦ì„œë¥¼ í´ë¼ì´ì–¸íŠ¸ Pod íŒŒì¼ ì‹œìŠ¤í…œì— ë³µì‚¬í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>kubectl <span class="nb">cp </span>myCA.crt default/mediabot:/usr/local/share/ca-certificates/myCA.crt
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> mediabot <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-l</span> /usr/local/share/ca-certificates/
<span class="c"># =&gt; total 4</span>
<span class="c">#    -rw-r--r-- 1 root root 1342 Sep  6 11:03 myCA.crt</span>
  
<span class="c"># /etc/ssl/certs/ca-certificates.crtì— ìˆëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¸ì¦ ê¸°ê´€ì˜ ê¸€ë¡œë²Œ ì„¸íŠ¸ì— ì´ ì¸ì¦ì„œë¥¼ ì¶”ê°€í•˜ëŠ” Ubuntu ì „ìš© ìœ í‹¸ë¦¬í‹° ì‹¤í–‰</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> mediabot <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-l</span> /etc/ssl/certs/ca-certificates.crt <span class="c"># ì‚¬ì´ì¦ˆ, ìƒì„±/ìˆ˜ì • ë‚ ì§œ í™•ì¸</span>
<span class="c"># =&gt; -rw-r--r-- 1 root root 213777 Jan  9  2024 /etc/ssl/certs/ca-certificates.crt</span>
<span class="nv">$ </span>kubectl <span class="nb">exec </span>mediabot <span class="nt">--</span> update-ca-certificates
<span class="c"># =&gt; Updating certificates in /etc/ssl/certs...</span>
<span class="c">#    rehash: warning: skipping ca-certificates.crt,it does not contain exactly one certificate or CRL</span>
<span class="c">#    1 added, 0 removed; done.</span>
<span class="c">#    Running hooks in /etc/ca-certificates/update.d...</span>
<span class="c">#    done.</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> mediabot <span class="nt">--</span> <span class="nb">ls</span> <span class="nt">-l</span> /etc/ssl/certs/ca-certificates.crt <span class="c"># ì‚¬ì´ì¦ˆ, ìƒì„±/ìˆ˜ì • ë‚ ì§œ í™•ì¸</span>
<span class="c"># =&gt; -rw-r--r-- 1 root root 215119 Sep  6 11:04 /etc/ssl/certs/ca-certificates.crt</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ì‹ ê·œ CA ì¸ì¦ì„œê°€ ì¶”ê°€ë˜ì–´ íŒŒì¼ í¬ê¸°ì™€ ìˆ˜ì • ë‚ ì§œê°€ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>
</code></pre></div></div>

<h5 id="ciliumì—-ì‹ ë¢°í• -ìˆ˜-ìˆëŠ”-ca-ëª©ë¡-ì œê³µ">Ciliumì— ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CA ëª©ë¡ ì œê³µ</h5>

<ul>
  <li>ë‹¤ìŒìœ¼ë¡œ, Ciliumì´ <strong>ë³´ì¡° TLS ì—°ê²°ì„ ì‹œì‘í• </strong> ë•Œ <strong>ì‹ ë¢°í•´ì•¼ í•˜ëŠ” CA ì„¸íŠ¸ë¥¼ ì œê³µ</strong>í•©ë‹ˆë‹¤. ì´ ëª©ë¡ì€ ì¡°ì§ì—ì„œ ì‹ ë¢°í•˜ëŠ” <strong>í‘œì¤€ ê¸€ë¡œë²Œ CA ì„¸íŠ¸ì™€</strong> ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ë…¼ë¦¬ì ì¸ ì˜µì…˜ ì¤‘ í•˜ë‚˜ëŠ” ìš´ì˜ ì²´ì œì—ì„œ ì‹ ë¢°í•˜ëŠ” í‘œì¤€ CA ì„¸íŠ¸ì…ë‹ˆë‹¤. ì´ëŠ” TLS ê²€ì‚¬ ë„ì… ì´ì „ì— ì‚¬ìš©ë˜ë˜ CA ì„¸íŠ¸ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</li>
  <li>ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ê¸° ìœ„í•´ ì´ ì˜ˆì—ì„œ ìš°ë¦¬ëŠ” m<strong>ediabot í¬ë“œì˜ Ubuntu íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ì´ ëª©ë¡ì„ ë³µì‚¬</strong>í•  ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CA ëª©ë¡ì€ íŠ¹ì • TLS í´ë¼ì´ì–¸íŠ¸ë‚˜ ì„œë²„ì—ë§Œ êµ­í•œë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë”°ë¼ì„œ TLS ê²€ì‚¬ì— ì°¸ì—¬í•˜ëŠ” TLS í´ë¼ì´ì–¸íŠ¸ë‚˜ ì„œë²„ì˜ ìˆ˜ì— ê´€ê³„ì—†ì´ ì´ ë‹¨ê³„ëŠ” í•œ ë²ˆë§Œ ìˆ˜í–‰í•˜ë©´ ë©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl <span class="nb">cp </span>default/mediabot:/etc/ssl/certs/ca-certificates.crt ca-certificates.crt
  
<span class="c">#  ì´ ì¸ì¦ì„œ ë²ˆë“¤ì„ ì‚¬ìš©í•˜ì—¬ Kubernetes ë¹„ë°€ì„ ìƒì„±í•˜ì—¬ Ciliumì´ ì¸ì¦ì„œ ë²ˆë“¤ì„ ì½ê³  ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚˜ê°€ëŠ” TLS ì—°ê²°ì„ ê²€ì¦í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>kubectl create secret generic tls-orig-data <span class="nt">-n</span> kube-system <span class="nt">--from-file</span><span class="o">=</span>ca.crt<span class="o">=</span>./ca-certificates.crt
<span class="c"># =&gt; secret/tls-orig-data created</span>
<span class="nv">$ </span>kubectl get secret <span class="nt">-n</span> kube-system tls-orig-data
<span class="c"># =&gt; NAME            TYPE     DATA   AGE</span>
<span class="c">#    tls-orig-data   Opaque   1      7s  </span>
</code></pre></div></div>

<h5 id="apply-dns-and-tls-aware-egress-policy">Apply DNS and TLS-aware Egress Policy</h5>

<ul>
  <li>ì§€ê¸ˆê¹Œì§€ TLS ê²€ì‚¬ë¥¼ í™œì„±í™”í•˜ê¸° ìœ„í•œ í‚¤ì™€ ì¸ì¦ì„œë¥¼ ìƒì„±í–ˆì§€ë§Œ, Ciliumì— ì–´ë–¤ íŠ¸ë˜í”½ì„ ê°€ë¡œì±„ì„œ ê²€ì‚¬í• ì§€ ì•Œë ¤ì£¼ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ ì‘ì—…ì€ ë‹¤ë¥¸ Cilium ë„¤íŠ¸ì›Œí¬ ì •ì±…ì— ì‚¬ìš©ë˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ Cilium ë„¤íŠ¸ì›Œí¬ ì •ì±… êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜í–‰ë©ë‹ˆë‹¤.</li>
  <li>ë‹¤ìŒ Cilium ë„¤íŠ¸ì›Œí¬ ì •ì±…ì€ Ciliumì´ <code class="language-plaintext highlighter-rouge">mediabot</code>í¬ë“œì™€ . ì‚¬ì´ì˜ í†µì‹ ì— ëŒ€í•´ HTTP ì¸ì‹ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•´ì•¼ í•¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤ <code class="language-plaintext highlighter-rouge">httpbin.org</code>.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">cilium.io/v2"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CiliumNetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">l7-visibility-tls"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">L7 policy with TLS</span>
  <span class="na">endpointSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">org</span><span class="pi">:</span> <span class="s">empire</span>
      <span class="na">class</span><span class="pi">:</span> <span class="s">mediabot</span>
  <span class="na">egress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">toFQDNs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">matchName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">httpbin.org"</span>
    <span class="na">toPorts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">443"</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s2">"</span><span class="s">TCP"</span>
      <span class="na">terminatingTLS</span><span class="pi">:</span>
        <span class="na">secret</span><span class="pi">:</span>
          <span class="na">namespace</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kube-system"</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">httpbin-tls-data"</span>
      <span class="na">originatingTLS</span><span class="pi">:</span>
        <span class="na">secret</span><span class="pi">:</span>
          <span class="na">namespace</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kube-system"</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tls-orig-data"</span>
      <span class="na">rules</span><span class="pi">:</span>
        <span class="na">http</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">toPorts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">53"</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">ANY</span>
      <span class="na">rules</span><span class="pi">:</span>
        <span class="na">dns</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">matchPattern</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
</code></pre></div></div>

<ul>
  <li>ì¦‰ , ì´ ì •ì±…ì€ ì¶œêµ¬ ì ‘ê·¼ ê¶Œí•œì´ ìˆëŠ” <code class="language-plaintext highlighter-rouge">endpointSelector</code>ë¼ë²¨ì´ ìˆëŠ” í¬ë“œì—ë§Œ ì ìš©ë©ë‹ˆë‹¤ .<code class="language-plaintext highlighter-rouge">class: mediabot, org:empire</code>
</li>
  <li>ì²« ë²ˆì§¸ ì¶œêµ¬ ì„¹ì…˜ì—ì„œëŠ” ì‚¬ì–‘ì„ ì‚¬ìš©í•˜ì—¬ TCP í¬íŠ¸ 443 ì¶œêµ¬ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤ .<code class="language-plaintext highlighter-rouge">toFQDNs: matchNamehttpbin.org</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">http</code>toFQDNs ê·œì¹™ ì•„ë˜ì˜ ì„¹ì…˜ì€ ì´ëŸ¬í•œ ì—°ê²°ì´ ëª¨ë“  ìš”ì²­ì„ í—ˆìš©í•˜ëŠ” ì •ì±…ì— ë”°ë¼ HTTPë¡œ êµ¬ë¬¸ ë¶„ì„ë˜ì–´ì•¼ í•¨ì„ ë‚˜íƒ€ ëƒ…ë‹ˆë‹¤ <code class="language-plaintext highlighter-rouge">{}</code>.</li>
  <li>ë° ì„¹ì…˜ì€ <strong>TLS ê°€ë¡œì±„ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ mediabotì—ì„œì˜ ì´ˆê¸° TLS ì—°ê²°ì„ ì¢…ë£Œ</strong>í•˜ê³  .ì— ëŒ€í•œ <strong>ìƒˆë¡œìš´ ì•„ì›ƒë°”ìš´ë“œ TLS ì—°ê²°ì„ ì‹œì‘</strong>í•´ì•¼ í•¨ì„ ë‚˜íƒ€ <code class="language-plaintext highlighter-rouge">terminatingTLS</code>ëƒ…ë‹ˆë‹¤ .<code class="language-plaintext highlighter-rouge">originatingTLShttpbin.org</code>
</li>
  <li>ë‘ ë²ˆì§¸ ì¶œêµ¬ ì„¹ì…˜ì€ <code class="language-plaintext highlighter-rouge">mediabot</code>í¬ë“œê°€ <code class="language-plaintext highlighter-rouge">kube-dns</code>ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. Ciliumì´ ì§€ì •ëœ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” DNS ì¡°íšŒë¥¼ ê²€ì‚¬í•˜ê³  í—ˆìš©í•˜ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤. ì´ ê²½ìš° ëª¨ë“  DNS ì¿¼ë¦¬ë¥¼ ê²€ì‚¬í•˜ê³  í—ˆìš©í•©ë‹ˆë‹¤.<code class="language-plaintext highlighter-rouge">rules: dns</code>
</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ëª¨ë‹ˆí„°ë§ : hubble cli ë‚˜ ui ì—ì„œ https ì´ë‹ˆ L7 ì •ë³´ í™•ì¸ ë¶ˆê°€ëŠ¥</span>
<span class="nv">$ </span>hubble observe <span class="nt">--pod</span> mediabot <span class="nt">-f</span>
  
<span class="c"># </span>
<span class="nv">$ </span>kubectl get pods
<span class="c"># =&gt; NAME                      READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    mediabot                  1/1     Running   0          19m</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> mediabot <span class="nt">--</span> curl <span class="nt">-sL</span> <span class="s1">'https://httpbin.org/anything'</span>
<span class="c"># =&gt; {</span>
<span class="c">#      "args": {},</span>
<span class="c">#      "data": "",</span>
<span class="c">#      "files": {},</span>
<span class="c">#      "form": {},</span>
<span class="c">#      "headers": {</span>
<span class="c">#        "Accept": "*/*",</span>
<span class="c">#        "Host": "httpbin.org",</span>
<span class="c">#        "User-Agent": "curl/7.88.1",</span>
<span class="c">#        "X-Amzn-Trace-Id": "Root=1-68bc1691-6a809d304ab6834b5a89a5ca"</span>
<span class="c">#      },</span>
<span class="c">#      "json": null,</span>
<span class="c">#      "method": "GET",</span>
<span class="c">#      "origin": "211.229.62.113",</span>
<span class="c">#      "url": "https://httpbin.org/anything"</span>
<span class="c">#    }</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> mediabot <span class="nt">--</span> curl <span class="nt">-sL</span> <span class="s1">'https://httpbin.org/headers'</span> <span class="nt">-v</span> <span class="c"># ì„œë²„ ì¸ì¦ì„œ í™•ì¸</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    * Server certificate:</span>
<span class="c">#    *  subject: CN=httpbin.org</span>
<span class="c">#    *  start date: Jul 20 00:00:00 2025 GMT</span>
<span class="c">#    *  expire date: Aug 17 23:59:59 2026 GMT</span>
<span class="c">#    *  subjectAltName: host "httpbin.org" matched cert's "httpbin.org"</span>
<span class="c">#    *  issuer: &lt;span style="color: green;"&gt;C=US; O=Amazon; CN=Amazon RSA 2048 M03&lt;/span&gt; # &lt;span style="color: green;"&gt;ğŸ‘‰ ì›ë˜ì˜ ì¸ì¦ê¸°ê´€(CA)ì—ì„œ ë°œê¸‰í•œ ì¸ì¦ì„œ&lt;/span&gt;</span>
<span class="c">#    *  SSL certificate verify ok.</span>
  
<span class="c"># ì •ì±… ì ìš©</span>
<span class="nv">$ </span>kubectl create <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/cilium/1.18.1/examples/kubernetes-tls-inspection/l7-visibility-tls.yaml
<span class="c"># =&gt; ciliumnetworkpolicy.cilium.io/l7-visibility-tls created</span>
<span class="nv">$ </span>kubectl get cnp
<span class="c"># =&gt; NAME                AGE   VALID</span>
<span class="c">#    l7-visibility-tls   7s    True  </span>
</code></pre></div></div>

<h5 id="demonstrating-tls-inspection">Demonstrating TLS Inspection</h5>

<ul>
  <li>ìš°ë¦¬ê°€ í‘¸ì‹œí•œ ì •ì±…ì€ ì—ì„œ <code class="language-plaintext highlighter-rouge">mediabot</code>ë¡œì˜ ëª¨ë“  HTTPS ìš”ì²­ì„ í—ˆìš© <code class="language-plaintext highlighter-rouge">httpbin.org</code>í•˜ì§€ë§Œ ëª¨ë“  ë°ì´í„°ëŠ” HTTP ê³„ì¸µì—ì„œ êµ¬ë¬¸ ë¶„ì„í•œë‹¤ëŠ” ì ì„ ê¸°ì–µí•˜ì„¸ìš”. ì¦‰, cilium monitorëŠ” ëª¨ë“  HTTP ìš”ì²­ê³¼ ì‘ë‹µì„ ë³´ê³ í•©ë‹ˆë‹¤.</li>
  <li>ì´ë¥¼ í™•ì¸í•˜ë ¤ë©´ ìƒˆ ì°½ì„ ì—´ê³  ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ <code class="language-plaintext highlighter-rouge">mediabot</code>í¬ë“œì™€ ë™ì¼í•œ Kubernetes ì›Œì»¤ ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ cilium í¬ë“œì˜ ì´ë¦„(ì˜ˆ: cilium-97s78)ì„ ì‹ë³„í•©ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ëª¨ë‹ˆí„°ë§ : hubble cli ë‚˜ ui ì—ì„œ https ì´ë‹ˆ L7 ì •ë³´ í™•ì¸ ë¶ˆê°€ëŠ¥</span>
<span class="nv">$ </span>hubble observe <span class="nt">--pod</span> mediabot <span class="nt">-f</span>
  
<span class="c">#</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> mediabot <span class="nt">--</span> curl <span class="nt">-sL</span> <span class="s1">'https://httpbin.org/anything'</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> mediabot <span class="nt">--</span> curl <span class="nt">-sL</span> <span class="s1">'https://httpbin.org/headers'</span> <span class="nt">-v</span> <span class="c"># ì„œë²„ ì¸ì¦ì„œ í™•ì¸</span>
<span class="c"># =&gt; ...</span>
<span class="c">#    * Server certificate:</span>
<span class="c">#    *  subject: C=KR; ST=Seoul; L=Seoul; O=cloudneta; OU=study; CN=httpbin.org</span>
<span class="c">#    *  start date: Sep  6 11:00:18 2025 GMT</span>
<span class="c">#    *  expire date: Sep  1 11:00:18 2026 GMT</span>
<span class="c">#    *  common name: httpbin.org (matched)</span>
<span class="c">#    *  issuer: &lt;span style="color: green;"&gt;C=KR; ST=Seoul; L=Seoul; O=cloudneta; OU=study; CN=cloudneta.net&lt;/span&gt; </span>
<span class="c">#  &lt;span style="color: green;"&gt;ğŸ‘‰ ë‚´ë¶€ ì¸ì¦ê¸°ê´€(CA)ì—ì„œ ë°œê¸‰í•œ ì¸ì¦ì„œë¡œ êµì²´ë˜ì–´ ìˆìŠµë‹ˆë‹¤!&lt;/span&gt;</span>
<span class="c">#  &lt;span style="color: green;"&gt;    ì¦‰, ìš°ë¦¬ê°€ ë§Œë“  CAì—ì„œ ë°œê¸‰í•œ ì¸ì¦ì„œë¡œ TLS ì—°ê²°ì´ ë§ºì–´ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°&lt;/span&gt;</span>
<span class="c">#  &lt;span style="color: green;"&gt;    TLS ê°€ë¡œì±„ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ê²ƒì…ë‹ˆë‹¤.&lt;/span&gt;</span>
<span class="c">#    *  SSL certificate verify ok.</span>
</code></pre></div></div>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_18.png" alt="img.png" class="image-center" loading="lazy" width="1238" height="966"></p>

<ul>
  <li>ì›ë˜ëŠ” ì•Œ ìˆ˜ ì—†ì—ˆë˜ L7 ì •ë³´ê°€ ì¸ì¦ì„œ êµì²´í›„ â€œGET /anythingâ€ ìœ¼ë¡œ í™•ì¸ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<h5 id="ì‹¤ìŠµ-ë¦¬ì†ŒìŠ¤-ì‚­ì œ-1">ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl delete <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/cilium/1.18.1/examples/kubernetes-dns/dns-sw-app.yaml
<span class="c"># =&gt; pod "mediabot" deleted</span>
<span class="nv">$ </span>kubectl delete cnp l7-visibility-tls
<span class="c"># =&gt; ciliumnetworkpolicy.cilium.io "l7-visibility-tls" deleted</span>
<span class="nv">$ </span>kubectl delete secret <span class="nt">-n</span> kube-system tls-orig-data
<span class="c"># =&gt; secret "tls-orig-data" deleted</span>
<span class="nv">$ </span>kubectl delete secret <span class="nt">-n</span> kube-system httpbin-tls-data
<span class="c"># =&gt; secret "httpbin-tls-data" deleted</span>
</code></pre></div></div>

<hr>

<h2 id="tetragon">Tetragon</h2>

<ul>
  <li>
<strong>Tetragon ì†Œê°œ Youtube ì˜ìƒ</strong> : eCHO Episode 194: Tetragon Everywhere
    <iframe width="560" height="315" src="https://www.youtube.com/embed/JDvmlECqYg4?si=uimpIPgm5g-OeRAJ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>
  </li>
  <li>Tetragon Resources - <a href="https://tetragon.io/docs/resources/">Link</a>
</li>
</ul>

<h3 id="tetragon-ì†Œê°œ">Tetragon ì†Œê°œ</h3>

<ul>
  <li>
<strong>Tetragon</strong>ì€ <strong>eBPF ê¸°ë°˜ì˜ ëŸ°íƒ€ì„ ë³´ì•ˆ ë° ê´€ì°° ë„êµ¬</strong>ì…ë‹ˆë‹¤. - <a href="https://tetragon.io/docs/overview/">Docs</a>
</li>
  <li>
<strong>Linux ì»¤ë„ì˜ ëª¨ë“  í•¨ìˆ˜ì— ì—°ê²°</strong>í•˜ì—¬ ì¸ìˆ˜, ë°˜í™˜ ê°’, Tetragonì´ <strong>í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•´ ìˆ˜ì§‘í•˜ëŠ” ê´€ë ¨ ë©”íƒ€ë°ì´í„°</strong>(ì˜ˆ: ì‹¤í–‰ íŒŒì¼ ì´ë¦„), <strong>íŒŒì¼</strong> ë° ê¸°íƒ€ ì†ì„±ì„ <strong>í•„í„°ë§í• </strong> ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>
<strong>Kubernetes í™˜ê²½ì„ ì¸ì‹</strong>í•˜ë©°, ë„¤ì„ìŠ¤í˜ì´ìŠ¤, í¬ë“œ ë“±ì˜ Kubernetes IDë¥¼ ì´í•´í•˜ë¯€ë¡œ ê°œë³„ ì‘ì—… ë¶€í•˜ì™€ ê´€ë ¨í•˜ì—¬ ë³´ì•ˆ ì´ë²¤íŠ¸ ê°ì§€ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_19.png" alt="img.png" loading="lazy" width="1678" height="1188"></p>

<ul>
  <li>
<strong>Tetragon</strong>ì€ ë‹¤ìŒê³¼ ê°™ì€ ë³´ì•ˆì— ì¤‘ìš”í•œ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê³  ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    <ul>
      <li>
<strong>Process</strong> ì‹¤í–‰ ë° ì¢…ë£Œ events</li>
      <li>
<strong>System</strong> ì½œ í˜¸ì¶œ ë° ë°˜í™˜</li>
      <li>ë„¤íŠ¸ì›Œí¬ì™€ íŒŒì¼ ì•¡ì„¸ìŠ¤ë¥¼ í¬í•¨í•œ <strong>I/O</strong> í™œë™</li>
    </ul>
  </li>
  <li>Kubernetes í™˜ê²½ì—ì„œ Tetragonì„ ì‚¬ìš©í•˜ë©´ Kubernetesë¥¼ ì¸ì‹í•©ë‹ˆë‹¤.
    <ul>
      <li>ì¦‰, ë„¤ì„ìŠ¤í˜ì´ìŠ¤, í¬ë“œ ë“±ì˜ Kubernetes IDë¥¼ ì´í•´í•˜ë¯€ë¡œ ê°œë³„ ì‘ì—… ë¶€í•˜ì™€ ê´€ë ¨í•˜ì—¬ ë³´ì•ˆ ì´ë²¤íŠ¸ ê°ì§€ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h5 id="ê¸°ëŠ¥-ê°œìš”">ê¸°ëŠ¥ ê°œìš”</h5>

<ul>
  <li>
<strong>eBPF ì‹¤ì‹œê°„ ì²˜ë¦¬</strong>
    <ul>
      <li>ëª¨ë“  ì •ì±…ê³¼ í•„í„°ë§ì„ <strong>ì»¤ë„ ë‚´ë¶€ eBPF</strong>ì—ì„œ ì§ì ‘ ìˆ˜í–‰í•©ë‹ˆë‹¤.
        <ul>
          <li>ì´ë²¤íŠ¸ë¥¼ ìœ ì € ê³µê°„ìœ¼ë¡œ ë³´ë‚´ì§€ ì•Šê³  ì»¤ë„ì—ì„œ ì°¨ë‹¨/ë°˜ì‘ ì²˜ë¦¬ â†’ ì„±ëŠ¥ í–¥ìƒ.</li>
        </ul>
      </li>
      <li>ê³ ë¹ˆë„ ì´ë²¤íŠ¸(send, read, write ë“±)ë„ ì»¤ë„ì—ì„œ ë°”ë¡œ í•„í„°ë§í•˜ë¯€ë¡œ <strong>ê´€ì¸¡ ì˜¤ë²„í—¤ë“œê°€ ê°ì†Œ</strong>ë©ë‹ˆë‹¤.</li>
      <li>íŒŒì¼, ì†Œì¼“, ë°”ì´ë„ˆë¦¬ ì´ë¦„, ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ê¶Œí•œ(capabilities) ë“± <strong>ì„¸ë¶€ í•„í„°ë§ì„ ì§€ì›</strong>í•©ë‹ˆë‹¤.</li>
      <li>ì´ë ‡ê²Œ ì§€ì •ëœ ì´ë²¤íŠ¸ë§Œ ìœ ì € ê³µê°„ìœ¼ë¡œ ì „ë‹¬í•˜ë¯€ë¡œ ìì› ì‚¬ìš© íš¨ìœ¨ì ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
<strong>eBPF ìœ ì—°í•œ ì¶”ì </strong>
    <ul>
      <li>Tetragonì€ <strong>ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì˜ ëª¨ë“  í•¨ìˆ˜ì— ì—°ê²°(hook)ì´ ê°€ëŠ¥</strong>í•˜ê³ , ì´ë¥¼ í†µí•´
í•¨ìˆ˜ì˜ ì¸ì, ë°˜í™˜ê°’, í”„ë¡œì„¸ìŠ¤/íŒŒì¼ ë©”íƒ€ë°ì´í„° ë“± ë‹¤ì–‘í•œ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§í•©ë‹ˆë‹¤.</li>
      <li>ì‚¬ìš©ìê°€ ì§ì ‘ <strong>íŠ¸ë ˆì´ì‹± ì •ì±…(tracing policy)</strong>ì„ ì‘ì„±í•´ ë³´ì•ˆ/ê´€ì¸¡ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í•´ê²° ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      <li>ì €ì¥ì†Œì—ëŠ” ì—¬ëŸ¬ ì˜ˆì‹œê°€ ì œê³µë˜ë©°, ì‚¬ìš©ìëŠ” ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ <strong>ìì‹ ë§Œì˜ ì •ì±…</strong>ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>íŠ¹ì • ì»¤ë„ í•¨ìˆ˜ ì¶”ì ë„ ê°€ëŠ¥í•˜ë©°, <strong>ì—”ì§„ì— í•˜ë“œì½”ë”©ëœ ì œí•œ ì—†ìŠµë‹ˆë‹¤.</strong>
</li>
      <li>ì‹œìŠ¤í…œì½œ íŠ¸ë ˆì´ì‹±ì—ì„œ í”íˆ ë°œìƒí•˜ëŠ” ë¬¸ì œ(ì˜ëª»ëœ ë°ì´í„° ì½ê¸°, ì•…ì˜ì  ì¡°ì‘, í˜ì´ì§€ í´íŠ¸ ëˆ„ë½ ë“±)ë¥¼ <strong>ì»¤ë„ ê¹Šìˆ™í•œ ê³³ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ í›…í‚¹</strong>í•˜ì—¬ íšŒí”¼í•©ë‹ˆë‹¤.</li>
      <li>ê°œë°œì ë‹¤ìˆ˜ê°€ ì»¤ë„ ê°œë°œ ê²½í—˜ì„ ê°–ê³  ìˆì–´, ë‹¤ì–‘í•œ <strong>ë³´ì•ˆ ë° ê´€ì¸¡ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ ì§€ì›í•˜ëŠ” ì •ì±… ì„¸íŠ¸</strong>ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
<strong>eBPFì„ í†µí•œ ì»¤ë„ ì¸ì‹</strong>
    <ul>
      <li>eBPFë¥¼ í†µí•´ Tetragonì€ <strong>ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ìƒíƒœì— ì§ì ‘ ì ‘ê·¼</strong>í•©ë‹ˆë‹¤.</li>
      <li>ì´ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ ì •ë³´ë‚˜ ì‚¬ìš©ì ì •ì±…ê³¼ ê²°í•©í•´ <strong>ì‹¤ì‹œê°„ ì»¤ë„ ë ˆë²¨ ê·œì¹™ ì ìš©</strong>ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      <li>ì˜ˆë¥¼ ë“¤ì–´, <strong>ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê¶Œí•œì„ ë³€ê²½</strong>í•  ë•Œ, í•´ë‹¹ <strong>í”„ë¡œì„¸ìŠ¤ê°€ ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì™„ë£Œ</strong>í•˜ê³  ì¶”ê°€ ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì‹¤í–‰í•˜ê¸° ì „ì— <strong>ê²½ê³ ë¥¼ ë°œìƒ</strong>ì‹œí‚¤ê±°ë‚˜ <strong>í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ëŠ” ì •ì±…ì„ ìƒì„±</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h3 id="tetragon-ì„¤ì¹˜">Tetragon ì„¤ì¹˜</h3>

<ul>
  <li><a href="https://tetragon.io/docs/getting-started/">ê´€ë ¨ë¬¸ì„œ</a></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /proc íŒŒì¼ ì‹œìŠ¤í…œ ì•¡ì„¸ìŠ¤ í•„ìš”.</span>
<span class="c"># ê¸°ë³¸ì ìœ¼ë¡œ Tetragonì€ ì´ë²¤íŠ¸ ë¡œê·¸ì˜ ë…¸ì´ì¦ˆë¥¼ ì¤„ì´ê¸° ìœ„í•´ kube-system ì´ë²¤íŠ¸ë¥¼ í•„í„°ë§í•©ë‹ˆë‹¤. </span>
<span class="nv">$ </span>helm repo add cilium https://helm.cilium.io
<span class="nv">$ </span>helm repo update
<span class="c"># =&gt; ...Successfully got an update from the "cilium" chart repository</span>
<span class="c">#    Update Complete. âˆHappy Helming!âˆ</span>
<span class="nv">$ </span>helm <span class="nb">install </span>tetragon cilium/tetragon <span class="nt">-n</span> kube-system
<span class="c"># =&gt; NAME: tetragon</span>
<span class="c">#    LAST DEPLOYED: Sat Sep  6 21:14:53 2025</span>
<span class="c">#    NAMESPACE: kube-system</span>
<span class="c">#    STATUS: deployed</span>
<span class="c">#    REVISION: 1</span>
<span class="c">#    TEST SUITE: None</span>
<span class="nv">$ </span>kubectl rollout status <span class="nt">-n</span> kube-system ds/tetragon <span class="nt">-w</span>
<span class="c"># =&gt; daemon set "tetragon" successfully rolled out</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>k <span class="nt">-n</span> kube-system get deploy tetragon-operator <span class="nt">-owide</span>
<span class="c"># =&gt; NAME                READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS          IMAGES                                    SELECTOR</span>
<span class="c">#    tetragon-operator   1/1     1            1           37s   tetragon-operator   quay.io/cilium/tetragon-operator:v1.5.0   app.kubernetes.io/instance=tetragon,app.kubernetes.io/name=tetragon-operator</span>
<span class="nv">$ </span>k <span class="nt">-n</span> kube-system get cm tetragon-operator-config tetragon-config
<span class="c"># =&gt; NAME                       DATA   AGE</span>
<span class="c">#    tetragon-operator-config   9      45s</span>
<span class="c">#    tetragon-config            33     45s</span>

<span class="nv">$ </span>k <span class="nt">-n</span> kube-system get ds tetragon <span class="nt">-owide</span>
<span class="c"># =&gt; NAME       DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE   CONTAINERS               IMAGES                                                                      SELECTOR</span>
<span class="c">#    tetragon   3         3         3       3            3           &lt;none&gt;          54s   export-stdout,tetragon   quay.io/cilium/hubble-export-stdout:v1.1.0,quay.io/cilium/tetragon:v1.5.0   app.kubernetes.io/instance=tetragon,app.kubernetes.io/name=tetragon</span>
<span class="nv">$ </span>k <span class="nt">-n</span> kube-system get svc,ep tetragon
<span class="c"># =&gt; NAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE</span>
<span class="c">#    service/tetragon   ClusterIP   10.96.248.15   &lt;none&gt;        2112/TCP   75s</span>
<span class="c">#    </span>
<span class="c">#    NAME                 ENDPOINTS                                                     AGE</span>
<span class="c">#    endpoints/tetragon   192.168.10.100:2112,192.168.10.101:2112,192.168.10.102:2112   75s</span>
<span class="nv">$ </span>k <span class="nt">-n</span> kube-system get svc,ep tetragon-operator-metrics
<span class="c"># =&gt; NAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span>
<span class="c">#    service/tetragon-operator-metrics   ClusterIP   10.96.105.200   &lt;none&gt;        2113/TCP   83s</span>
<span class="c">#    </span>
<span class="c">#    NAME                                  ENDPOINTS          AGE</span>
<span class="c">#    endpoints/tetragon-operator-metrics   172.20.1.32:2113   83s</span>

<span class="nv">$ </span>k <span class="nt">-n</span> kube-system get pod <span class="nt">-l</span> app.kubernetes.io/part-of<span class="o">=</span>tetragon <span class="nt">-owide</span>
<span class="nv">$ </span>k <span class="nt">-n</span> kube-system get pod <span class="nt">-l</span> app.kubernetes.io/name<span class="o">=</span>tetragon
<span class="nv">$ </span>kc <span class="nt">-n</span> kube-system describe pod <span class="nt">-l</span> app.kubernetes.io/name<span class="o">=</span>tetragon
<span class="c"># =&gt; ...</span>
<span class="c">#    Containers:</span>
<span class="c">#      export-stdout:</span>
<span class="c">#        Container ID:  containerd://eb8abd117200c08e26b7efc02ae15ff14a618d1fa282b30530db973468ad1dcf</span>
<span class="c">#        Image:         quay.io/cilium/hubble-export-stdout:v1.1.0</span>
<span class="c">#    ...</span>
<span class="c">#      tetragon:</span>
<span class="c">#        Container ID:  containerd://7b283b22db614b6288a01c09e302349720d85e64ab85d449173abec9597ddce8</span>
<span class="c">#        Image:         quay.io/cilium/tetragon:v1.5.0</span>
<span class="c">#    ...</span>
</code></pre></div></div>

<ul>
  <li>ë°ëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#</span>
<span class="nv">$ </span>kubectl create <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/cilium/v1.18.1/examples/minikube/http-sw-app.yaml
<span class="c"># =&gt; service/deathstar created</span>
<span class="c">#    deployment.apps/deathstar created</span>
<span class="c">#    pod/tiefighter created</span>
<span class="c">#    pod/xwing created</span>

<span class="c"># í™•ì¸</span>
<span class="nv">$ </span>kubectl get pods
<span class="c"># =&gt; NAME                         READY   STATUS    RESTARTS   AGE</span>
<span class="c">#    deathstar-86f85ffb4d-2z9dv   1/1     Running   0          23s</span>
<span class="c">#    deathstar-86f85ffb4d-djnhm   1/1     Running   0          23s</span>
<span class="c">#    tiefighter                   1/1     Running   0          23s</span>
<span class="c">#    xwing                        1/1     Running   0          23s</span>
</code></pre></div></div>

<h3 id="ì‹¤í–‰-ëª¨ë‹ˆí„°ë§">ì‹¤í–‰ ëª¨ë‹ˆí„°ë§</h3>

<ul>
  <li>ì‹œìŠ¤í…œì˜ ëª¨ë“  ì‹¤í–‰ì„ ì¶”ì í•©ë‹ˆë‹¤. - <a href="https://tetragon.io/docs/getting-started/execution/">Docs</a>, <a href="https://yuki-nakamura.com/2024/05/23/tetragon-process-lifecycle-observation-tetragon-agent-part/">Blog</a>
</li>
</ul>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_20.png" alt="img.png" class="image-center" loading="lazy" width="2048" height="966">
<em class="image-caption"><a href="https://isovalent.com/blog/post/top-tetragon-use-cases/">https://isovalent.com/blog/post/top-tetragon-use-cases/</a></em></p>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_21.png" alt="img_1.png" class="image-center" loading="lazy" width="2041" height="443">
<em class="image-caption"><a href="https://yuki-nakamura.com/2024/05/23/tetragon-process-lifecycle-observation-tetragon-agent-part/">https://yuki-nakamura.com/2024/05/23/tetragon-process-lifecycle-observation-tetragon-agent-part/</a></em></p>

<ul>
  <li>Tetragonì€ ì‹¤í–‰ ì´ë²¤íŠ¸ë¥¼ JSON ë¡œê·¸ì™€ GRPC ìŠ¤íŠ¸ë¦¼ì„ í†µí•´ ê³µê°œí•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì´ë¥¼ í†µí•´ ì‹œìŠ¤í…œì˜ ëª¨ë“  ì‹¤í–‰ ê³¼ì •ì„ ê´€ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì—¬ëŸ¬ ë…¸ë“œê°€ ìˆëŠ” í´ëŸ¬ìŠ¤í„°ì—ì„œëŠ” ì‚¬ìš©í•˜ëŠ” Tetragon Podê°€ "xwing" Podì™€ ë™ì¼í•œ ë…¸ë“œì— ìˆì–´ì•¼ ì‹¤í–‰ ì´ë²¤íŠ¸ë¥¼ ìº¡ì²˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
<span class="c"># ì´ ëª…ë ¹ì„ ì‚¬ìš©í•˜ë©´ "**xwing**" Podì™€ ë™ì¼í•œ Kubernetes **ë…¸ë“œ**ì— ìˆëŠ” **Tetragon Podì˜ ì´ë¦„ì„** ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
<span class="nv">$ POD</span><span class="o">=</span><span class="si">$(</span>kubectl <span class="nt">-n</span> kube-system get pods <span class="nt">-l</span> <span class="s1">'app.kubernetes.io/name=tetragon'</span> <span class="nt">-o</span> name <span class="nt">--field-selector</span> spec.nodeName<span class="o">=</span><span class="si">$(</span>kubectl get pod xwing <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.nodeName}'</span><span class="si">))</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$POD</span>
<span class="c"># =&gt; pod/tetragon-fwccq</span>
  
<span class="c"># í„°ë¯¸ë„1</span>
<span class="c"># ì¼ì¹˜í•˜ëŠ” Podë¥¼ ì‹ë³„í•œ í›„ í•´ë‹¹ Podë¥¼ ëŒ€ìƒìœ¼ë¡œ ì§€ì •í•˜ì—¬ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤ : Tetragonì—ì„œ ìº¡ì²˜í•œ ì‹¤í–‰ ì´ë²¤íŠ¸ë¥¼ ë°˜í™˜</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra <span class="nt">-h</span>
<span class="c"># ì••ì¶• ì‹¤í–‰ ì´ë²¤íŠ¸ì—ëŠ” ì´ë²¤íŠ¸ ìœ í˜•, í¬ë“œ ì´ë¦„, ë°”ì´ë„ˆë¦¬, ì¸ìˆ˜ê°€ í¬í•¨ë©ë‹ˆë‹¤. ì¢…ë£Œ ì´ë²¤íŠ¸ì—ëŠ” ë°˜í™˜ ì½”ë“œê°€ í¬í•¨ë©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">-o</span> compact <span class="nt">--pods</span> xwing
  
<span class="c">## JSON í˜•ì‹ìœ¼ë¡œ ì „ì²´ ì‹¤í–‰ ì´ë²¤íŠ¸ë¥¼ ë³´ë ¤ë©´ ëª…ë ¹ -o compactì—ì„œ ì˜µì…˜ì„ ì œê±°</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">--pods</span> xwing
  
<span class="c"># í„°ë¯¸ë„2</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> xwing <span class="nt">--</span> bash <span class="nt">-c</span> <span class="s1">'curl https://ebpf.io/applications/#tetragon'</span>

<span class="c"># í„°ë¯¸í„¸ 1</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">-o</span> compact <span class="nt">--pods</span> xwing
<span class="c"># =&gt; ğŸš€ process default/xwing /usr/bin/bash -c "curl https://ebpf.io/applications/#tetragon"</span>
<span class="c">#    ğŸš€ process default/xwing /usr/bin/curl https://ebpf.io/applications/#tetragon</span>
<span class="c">#    ğŸ’¥ exit    default/xwing /usr/bin/curl https://ebpf.io/applications/#tetragon 0 </span>

<span class="c"># í„°ë¯¸ë„2</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> xwing <span class="nt">--</span> bash <span class="nt">-c</span> <span class="s1">'curl https://httpbin.org'</span>

<span class="c"># í„°ë¯¸í„¸ 1</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">-o</span> compact <span class="nt">--pods</span> xwing
<span class="c"># =&gt; ğŸš€ process default/xwing /usr/bin/bash -c "curl https://httpbin.org"</span>
<span class="c">#    ğŸš€ process default/xwing /usr/bin/curl https://httpbin.org</span>
<span class="c">#    ğŸ’¥ exit    default/xwing /usr/bin/curl https://httpbin.org 0</span>

<span class="c"># í„°ë¯¸ë„2</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> xwing <span class="nt">--</span> bash <span class="nt">-c</span> <span class="s1">'cat /etc/passwd'</span>

<span class="c"># í„°ë¯¸í„¸ 1</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">-o</span> compact <span class="nt">--pods</span> xwing
<span class="c"># =&gt; ğŸš€ process default/xwing /usr/bin/bash -c "cat /etc/passwd"</span>
<span class="c">#    ğŸš€ process default/xwing /usr/bin/cat /etc/passwd</span>
<span class="c">#    ğŸ’¥ exit    default/xwing /usr/bin/cat /etc/passwd 0</span>
</code></pre></div></div>

<h3 id="íŒŒì¼-ì ‘ì†-ëª¨ë‹ˆí„°ë§">íŒŒì¼ ì ‘ì† ëª¨ë‹ˆí„°ë§</h3>

<ul>
  <li>ì¶”ì  ì •ì±…ìœ¼ë¡œ ë¯¼ê° íŒŒì¼ ëª¨ë‹ˆí„°ë§ - <a href="https://tetragon.io/docs/getting-started/file-events/">Docs</a>, <a href="https://isovalent.com/blog/post/file-monitoring-with-ebpf-and-tetragon-part-1/">Blog</a>
</li>
</ul>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_22.png" alt="img.png" class="image-center" loading="lazy" width="1080" height="608">
<em class="image-caption"><a href="https://isovalent.com/blog/post/file-monitoring-with-ebpf-and-tetragon-part-1/">https://isovalent.com/blog/post/file-monitoring-with-ebpf-and-tetragon-part-1/</a></em></p>

<p><img src="/assets/2025/cilium/w8/20250907_cilium_w8_23.png" alt="img_1.png" class="image-center" loading="lazy" width="2048" height="1065">
<em class="image-caption">Figure 3: In-kernel vs user-space filtering</em></p>

<ul>
  <li>YAML êµ¬ì„± íŒŒì¼ì„ í†µí•´ Tetragonì— <strong>ì¶”ì  ì •ì±…</strong>ì„ ì¶”ê°€í•˜ë©´ Tetragonì˜ ê¸°ë³¸ ì‹¤í–‰ ì¶”ì  ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì´ëŸ¬í•œ ì •ì±…ì€ <strong>ì»¤ë„ì—ì„œ í•„í„°ë§ì„ ìˆ˜í–‰</strong>í•˜ì—¬ ì»¤ë„ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ BPF í”„ë¡œê·¸ë¨ì—ì„œ <strong>ê´€ì‹¬ ìˆëŠ” ì´ë²¤íŠ¸</strong>ë§Œ <strong>ì‚¬ìš©ì ê³µê°„ì— ê²Œì‹œ</strong>ë˜ë„ë¡ í•©ë‹ˆë‹¤.</li>
  <li>ì´ë¥¼ í†µí•´ ì‚¬ìš©ëŸ‰ì´ ë§ì€ ì‹œìŠ¤í…œì—ì„œë„ <strong>ì˜¤ë²„í—¤ë“œë¥¼ ë‚®ê²Œ ìœ ì§€</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì•„ë˜ì˜ ManifestëŠ” <a href="https://tetragon.io/docs/getting-started/execution/">ì‹¤í–‰ ëª¨ë‹ˆí„°ë§</a> ì˜ ì˜ˆì‹œë¥¼ í™•ì¥í•˜ì—¬ Linuxì—ì„œ <strong>ë¯¼ê°í•œ íŒŒì¼ì„ ëª¨ë‹ˆí„°ë§</strong>í•˜ëŠ” ì •ì±…ì„ ì ìš©í•©ë‹ˆë‹¤.</li>
  <li>ë¯¼ê° íŒŒì¼ ëª¨ë‹ˆí„°ë§ ì •ì±… ì ìš©</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># file_monitoring.yaml</span>
apiVersion: cilium.io/v1alpha1
kind: TracingPolicy
metadata:
  name: <span class="s2">"file-monitoring-filtered"</span>
spec:
  kprobes:
  - call: <span class="s2">"security_file_permission"</span>
    syscall: <span class="nb">false
    </span><span class="k">return</span>: <span class="nb">true
    </span>args:
    - index: 0
      <span class="nb">type</span>: <span class="s2">"file"</span> <span class="c"># (struct file *) used for getting the path</span>
    - index: 1
      <span class="nb">type</span>: <span class="s2">"int"</span> <span class="c"># 0x04 is MAY_READ, 0x02 is MAY_WRITE</span>
    returnArg:
      index: 0
      <span class="nb">type</span>: <span class="s2">"int"</span>
    returnArgAction: <span class="s2">"Post"</span>
    selectors:
    - matchArgs:      
      - index: 0
        operator: <span class="s2">"Prefix"</span>
        values:
        - <span class="s2">"/boot"</span>           <span class="c"># Reads to sensitive directories</span>
        - <span class="s2">"/root/.ssh"</span>      <span class="c"># Reads to sensitive files we want to know about</span>
        - <span class="s2">"/etc/shadow"</span>
        - <span class="s2">"/etc/profile"</span>
        - <span class="s2">"/etc/sudoers"</span>
        - <span class="s2">"/etc/pam.conf"</span>   <span class="c"># Reads global shell configs bash/csh supported</span>
        - <span class="s2">"/etc/bashrc"</span>
        - <span class="s2">"/etc/csh.cshrc"</span>
        - <span class="s2">"/etc/csh.login"</span>  <span class="c"># Add additional sensitive files here</span>
      - index: 1
        operator: <span class="s2">"Equal"</span>
        values:
        - <span class="s2">"4"</span> <span class="c"># MAY_READ</span>

<span class="c"># Manifest ì ìš©</span>
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/tetragon/main/examples/quickstart/file_monitoring.yaml
<span class="c"># =&gt; tracingpolicy.cilium.io/file-monitoring-filtered created</span>
<span class="nv">$ </span>kubectl get tracingpolicy
<span class="c"># =&gt; NAME                       AGE</span>
<span class="c">#    file-monitoring-filtered   55s</span>
</code></pre></div></div>

<ul>
  <li><strong>Tetragon íŒŒì¼ ì•¡ì„¸ìŠ¤ ì´ë²¤íŠ¸ ê´€ì°°</strong></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í„°ë¯¸ë„2 : ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ê¸°ìœ„ì•  ì •ì±…ì— ì°¸ì¡°ëœ ì¤‘ìš”í•œ(ë¯¼ê°í•œ) íŒŒì¼ì„ ì½ì–´ë³´ì„¸ìš”</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> xwing <span class="nt">--</span> bash <span class="nt">-c</span> <span class="s1">'cat /etc/shadow'</span>

<span class="c"># í„°ë¯¸ë„1</span>
<span class="nv">$ POD</span><span class="o">=</span><span class="si">$(</span>kubectl <span class="nt">-n</span> kube-system get pods <span class="nt">-l</span> <span class="s1">'app.kubernetes.io/name=tetragon'</span> <span class="nt">-o</span> name <span class="nt">--field-selector</span> spec.nodeName<span class="o">=</span><span class="si">$(</span>kubectl get pod xwing <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.nodeName}'</span><span class="si">))</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">-o</span> compact <span class="nt">--pods</span> xwing
<span class="c"># =&gt; ğŸš€ process default/xwing /usr/bin/bash -c "cat /etc/shadow"</span>
<span class="c">#    ğŸš€ process default/xwing /usr/bin/cat /etc/shadow</span>
<span class="c">#    ğŸ“š read    default/xwing /usr/bin/cat /etc/shadow</span>
<span class="c">#    ğŸ“š read    default/xwing /usr/bin/cat /etc/shadow</span>
<span class="c">#    ğŸ“š read    default/xwing /usr/bin/cat /etc/shadow</span>
<span class="c">#    ğŸ“š read    default/xwing /usr/bin/cat /etc/shadow</span>
<span class="c">#    ğŸ’¥ exit    default/xwing /usr/bin/cat /etc/shadow 0  </span>

<span class="c"># í„°ë¯¸ë„2 : ì¶”ì  ì •ì±…ì— ë”°ë¼ Tetragonì€ ë¯¼ê°í•œ ë””ë ‰í† ë¦¬ì— ì“°ê¸°ë¥¼ ì‹œë„í•˜ëŠ” ê²½ìš°(ì˜ˆ: /etcë””ë ‰í† ë¦¬ì— ì“°ê¸°ë¥¼ ì‹œë„í•˜ëŠ” ê²½ìš°)ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ì“°ê¸° ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> xwing <span class="nt">--</span> bash <span class="nt">-c</span> <span class="s1">'echo foo &gt;&gt; /etc/bar'</span>

<span class="c"># í„°ë¯¸ë„1</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">-o</span> compact <span class="nt">--pods</span> xwing
<span class="c"># =&gt; ğŸš€ process default/xwing /usr/bin/bash -c "echo foo &gt;&gt; /etc/bar"</span>
<span class="c">#    ğŸ“ write   default/xwing /usr/bin/bash /etc/bar</span>
<span class="c">#    ğŸ“ write   default/xwing /usr/bin/bash /etc/bar</span>
<span class="c">#    ğŸ’¥ exit    default/xwing /usr/bin/bash -c "echo foo &gt;&gt; /etc/bar" 0 </span>

<span class="c"># ì •ì±… ì‚­ì œ</span>
<span class="nv">$ </span>kubectl delete <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/tetragon/main/examples/quickstart/file_monitoring.yaml
<span class="c"># =&gt; tracingpolicy.cilium.io "file-monitoring-filtered" deleted</span>
</code></pre></div></div>

<h3 id="policy-enforcement">Policy Enforcement</h3>

<ul>
  <li>ì»¤ë„ ìˆ˜ì¤€ì—ì„œ ì •ì±… ì œí•œì„ ì ìš©ê´€ë ¨ ë‚´ìš©ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. - <a href="https://tetragon.io/docs/getting-started/enforcement/">Docs</a>
</li>
  <li>Tetragonì˜ ì¶”ì  ì •ì±…ì€ íŒŒì¼ ì•¡ì„¸ìŠ¤ ì´ë²¤íŠ¸ë‚˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì´ë²¤íŠ¸ì™€ ê°™ì€ ì´ë²¤íŠ¸ë¥¼ ë³´ê³ í•˜ê¸° ìœ„í•´ ì»¤ë„ í•¨ìˆ˜ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³ , í•´ë‹¹ ì»¤ë„ í•¨ìˆ˜ì— ì œí•œì„ ì ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤.</li>
  <li>Tetragonì—ì„œ ì»¤ë„ ë‚´ í•„í„°ë§ì„ ì‚¬ìš©í•˜ë©´ ì»¤ë„ì—ì„œ ì‚¬ìš©ì ê³µê°„ìœ¼ë¡œ ì „ì†¡ë˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ì œí•œí•˜ì—¬ ì„±ëŠ¥ì„ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ë˜í•œ, ì»¤ë„ ë‚´ í•„í„°ë§ì„ í†µí•´ Tetragonì€ ì»¤ë„ ìˆ˜ì¤€ì—ì„œ ì •ì±… ì œí•œì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ì˜ˆë¥¼ ë“¤ì–´, <code class="language-plaintext highlighter-rouge">SIGKILL</code>ì •ì±… ìœ„ë°˜ì´ ê°ì§€ë˜ì—ˆì„ ë•Œ í”„ë¡œì„¸ìŠ¤ì— ë¥¼ ì‹¤í–‰í•˜ë©´ í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ëŠ” ë” ì´ìƒ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
  <li>ì •ì±… ì ìš©ì´ ì‹œìŠ¤í…œ í˜¸ì¶œì„ í†µí•´ íŠ¸ë¦¬ê±°ë˜ëŠ” ê²½ìš°, ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì‹œìŠ¤í…œ í˜¸ì¶œì—ì„œ ë°˜í™˜ë˜ì§€ ì•Šê³  ì¢…ë£Œë©ë‹ˆë‹¤.</li>
  <li>ì´ ì„¹ì…˜ì—ì„œëŠ” ì´ ì‹œì‘ ê°€ì´ë“œì—ì„œ ì´ë¯¸ ë°°í¬í•œ Tetragon ê¸°ëŠ¥(ì‹¤í–‰, íŒŒì¼ ì¶”ì  ë° ë„¤íŠ¸ì›Œí¬ ì¶”ì  ì •ì±…)ì— ì•„ë˜ì˜ ë„¤íŠ¸ì›Œí¬ ë° íŒŒì¼ ì •ì±… ì ìš©ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
    <ul>
      <li>Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ ë‚˜ê°€ëŠ” <strong>ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ ì œí•œ</strong>í•˜ëŠ” ì •ì±… ì ìš©</li>
      <li>
<strong>ë¯¼ê°í•œ íŒŒì¼ì— ë¸”ë¡ ì“°ê¸° ë° ì½ê¸° ì‘ì—…</strong> ì ìš©</li>
    </ul>
  </li>
  <li>êµ¬ì²´ì ì¸ êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­ì€ <a href="https://tetragon.io/docs/concepts/enforcement/">ì‹œí–‰</a> ê°œë… ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”.</li>
</ul>

<h5 id="íŒŒì¼-ì•¡ì„¸ìŠ¤-ì œí•œ-ì ìš©">íŒŒì¼ ì•¡ì„¸ìŠ¤ ì œí•œ ì ìš©</h5>

<ul>
  <li>
<a href="https://tetragon.io/docs/getting-started/file-events/">ë‹¤ìŒì€ íŒŒì¼ ì•¡ì„¸ìŠ¤ ëª¨ë‹ˆí„°ë§</a> ì˜ ì˜ˆì‹œë¥¼ ì ìš©í•˜ì—¬ ë¯¼ê°í•œ íŒŒì¼ì´ ì½íˆì§€ ì•Šë„ë¡ í™•ì¥í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</li>
  <li>ì‚¬ìš©ë˜ëŠ” ì •ì±…ì€ ì´ë©° <a href="https://github.com/cilium/tetragon/blob/main/examples/quickstart/file_monitoring_enforce.yaml"><code class="language-plaintext highlighter-rouge">file_monitoring_enforce.yaml</code></a>, í•„ìš”ì— ë”°ë¼ ê²€í† í•˜ê³  í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  <li>ê´€ì°° ì •ì±…ê³¼ ì ìš© ì •ì±…ì˜ ìœ ì¼í•œ ì°¨ì´ì ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì‘ì—… ë¸”ë¡ì„ ì¶”ê°€ <code class="language-plaintext highlighter-rouge">SIGKILL</code>í•˜ê³  ì‘ì—… ì‹œ ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># file_monitoring_enforce.yaml : matchaction í™•ì¸</span>
apiVersion: cilium.io/v1alpha1
kind: TracingPolicyNamespaced
metadata:
  name: <span class="s2">"file-monitoring-filtered"</span>
spec:
  kprobes:
  - call: <span class="s2">"security_file_permission"</span>
    syscall: <span class="nb">false
    </span><span class="k">return</span>: <span class="nb">true
    </span>args:
    - index: 0
      <span class="nb">type</span>: <span class="s2">"file"</span> <span class="c"># (struct file *) used for getting the path</span>
    - index: 1
      <span class="nb">type</span>: <span class="s2">"int"</span> <span class="c"># 0x04 is MAY_READ, 0x02 is MAY_WRITE</span>
    returnArg:
      index: 0
      <span class="nb">type</span>: <span class="s2">"int"</span>
    returnArgAction: <span class="s2">"Post"</span>
    selectors:
    - matchArgs:
      - index: 0
        operator: <span class="s2">"Prefix"</span>
        values:
        - <span class="s2">"/boot"</span>           <span class="c"># Reads to sensitive directories</span>
        - <span class="s2">"/root/.ssh"</span>      <span class="c"># Reads to sensitive files we want to know about</span>
        - <span class="s2">"/etc/shadow"</span>
        - <span class="s2">"/etc/profile"</span>
        - <span class="s2">"/etc/sudoers"</span>
        - <span class="s2">"/etc/pam.conf"</span>   <span class="c"># Reads global shell configs bash/csh supported</span>
        - <span class="s2">"/etc/bashrc"</span>
        - <span class="s2">"/etc/csh.cshrc"</span>
        - <span class="s2">"/etc/csh.login"</span>  <span class="c"># Add additional sensitive files here</span>
      - index: 1
        operator: <span class="s2">"Equal"</span>
        values:
        - <span class="s2">"4"</span> <span class="c"># MAY_READ</span>
      matchActions:
      - action: Sigkill
...
<span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/cilium/tetragon/main/examples/quickstart/file_monitoring_enforce.yaml
<span class="c"># =&gt; tracingpolicynamespaced.cilium.io/file-monitoring-filtered created</span>
<span class="nv">$ </span>kubectl get tracingpolicynamespaced
<span class="c"># =&gt; NAME                       AGE</span>
<span class="c">#    file-monitoring-filtered   11s</span>
  
<span class="c"># í„°ë¯¸ë„1</span>
<span class="nv">$ POD</span><span class="o">=</span><span class="si">$(</span>kubectl <span class="nt">-n</span> kube-system get pods <span class="nt">-l</span> <span class="s1">'app.kubernetes.io/name=tetragon'</span> <span class="nt">-o</span> name <span class="nt">--field-selector</span> spec.nodeName<span class="o">=</span><span class="si">$(</span>kubectl get pod xwing <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.nodeName}'</span><span class="si">))</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">-o</span> compact <span class="nt">--pods</span> xwing
<span class="c"># =&gt; ğŸš€ process default/xwing /usr/bin/bash -c "cat /etc/shadow"</span>
<span class="c">#    ğŸš€ process default/xwing /usr/bin/cat /etc/shadow</span>
<span class="c">#    ğŸ“š read    default/xwing /usr/bin/cat /etc/shadow</span>
<span class="c">#    ğŸ“š read    default/xwing /usr/bin/cat /etc/shadow</span>
<span class="c">#    ğŸ’¥ exit    default/xwing /usr/bin/cat /etc/shadow &lt;span style="color: green;"&gt;SIGKILL&lt;/span&gt;</span>
  
<span class="c"># í„°ë¯¸ë„2 : ì •ì˜ëœ ì •ì±…ì— í¬í•¨ëœ íŒŒì¼ ì¤‘ í•˜ë‚˜ì¸ ë¯¼ê°í•œ íŒŒì¼ì„ ì½ì–´ë³´ì„¸ìš”</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> xwing <span class="nt">--</span> bash <span class="nt">-c</span> <span class="s1">'cat /etc/shadow'</span>
<span class="c"># =&gt; command terminated with exit code 137</span>
<span class="c"># &lt;span style="color: green;"&gt;ğŸ‘‰ ì´ë²ˆì—ëŠ” "cat /etc/shadow" ëª…ë ¹ì´ SIGKILLë¡œ ì¸í•´ ì¢…ë£Œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/span&gt;</span>
  
<span class="c"># ì‹œí–‰ëœ íŒŒì¼ ì •ì±…ì— í¬í•¨ë˜ì§€ ì•Šì€ íŒŒì¼ì„ ì½ê±°ë‚˜ ì“°ë ¤ëŠ” ì‹œë„ëŠ” ì˜í–¥ì„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> xwing <span class="nt">--</span> bash <span class="nt">-c</span> <span class="s1">'echo foo &gt; /tmp/test.txt'</span>

<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-ti</span> <span class="nt">-n</span> kube-system <span class="nv">$POD</span> <span class="nt">-c</span> tetragon <span class="nt">--</span> tetra getevents <span class="nt">-o</span> compact <span class="nt">--pods</span> xwing
<span class="c"># =&gt; ğŸš€ process default/xwing /usr/bin/bash -c "echo foo &gt; /tmp/test.txt"</span>
<span class="c">#    ğŸ’¥ exit    default/xwing /usr/bin/bash -c "echo foo &gt; /tmp/test.txt" 0  </span>
</code></pre></div></div>

<hr>

<h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h2>

<p>Cilium Securityì™€ Tetragonì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
Cilium ìì²´ë„ ë‹¤ì–‘í•œ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆëŠ”ë° Tetragonê¹Œì§€ ë”í•´ì§€ë‹ˆ
ë‹¤ì–‘í•œ ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚¬ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
TLS Interception ê¸°ëŠ¥ë„ í¥ë¯¸ë¡œì› ëŠ”ë° ì™„ì „ MITM ê³µê²©ì¸ê²ƒ ê°™ìœ¼ë©´ì„œë„
íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ì— í° ë„ì›€ì´ ë  ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ë²Œì¨ Cilium ìŠ¤í„°ë””ê°€ ëë‚¬ìŠµë‹ˆë‹¤.
Cilium ì„¤ì¹˜ì™€ ê¸°ë³¸ ì„¤ì •ì—ì„œ ë¶€í„°, Hubbleì„ ë¹„ë¡¯í•œ ê´€ì¸¡ì„±ê³¼ íŒŒë“œ ë„¤íŠ¸ì›Œí¬ ìƒì„¸, BGP ë¼ìš°íŒ…, ì„œë¹„ìŠ¤ë©”ì‹œ, Performance, Securityì™€ Tetragon ë“±ë“±
ë”°ë¼ê°€ê¸°ë„ ë²…ì°¼ì§€ë§Œ ë§ì€ ê²ƒì„ ë°°ìš¸ ìˆ˜ ìˆì—ˆë˜ ì‹œê°„ì´ì—ˆìŠµë‹ˆë‹¤.
ë§¤ì£¼ ìŠ¤í„°ë”” ë§ˆë‹¤ ëŠë‚€ ì ì€ Ciliumì˜ ìƒíƒœê³„ëŠ” ì •ë§ ë„“ê³  ê¹Šë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
ì•ìœ¼ë¡œë„ ê¾¸ì¤€íˆ ê³µë¶€í•˜ê³  ì‹¤ìŠµí•˜ë©´ì„œ ìµí˜€ë‚˜ê°€ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ì‹¤ìŠµí• ë•Œ ë³µì¡í•œ Kubernetes êµ¬ì„±ì´ í•„ìš”í•œ ê²½ìš°ë„ ë§ì•˜ëŠ”ë°
ë§¤ë²ˆ í¸ë¦¬í•˜ê²Œ í™˜ê²½ì„ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ì…”ì„œ í™˜ê²½ êµ¬ì„±ì—ëŠ” ì–´ë ¤ì›€ì—†ì´ ì§„í–‰í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ë§¤ì£¼ ì‹¤ìŠµìë£Œ ì¤€ë¹„ì™€ ì§„í–‰ì— ì• ì¨ì£¼ì‹  ê°€ì‹œë‹¤ ë‹˜ê»˜ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. <img class="emoji" title=":bow:" alt=":bow:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f647.png" height="20" width="20" loading="lazy"></p>

  </div>

  <div id="toc-minimap" class="toc-minimap collapsed">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">ë“¤ì–´ê°€ë©°</a></li>
<li class="toc-entry toc-h2"><a href="#%EC%8B%A4%EC%8A%B5%ED%99%98%EA%B2%BD-%EB%B0%B0%ED%8F%AC">ì‹¤ìŠµí™˜ê²½ ë°°í¬</a></li>
<li class="toc-entry toc-h2">
<a href="#cilium-security-%EA%B3%B5%EC%8B%9D%EB%AC%B8%EC%84%9C">Cilium Security ê³µì‹ë¬¸ì„œ</a>
<ul>
<li class="toc-entry toc-h3"><a href="#cilium%EC%9D%B4-%EC%A0%9C%EA%B3%B5%ED%95%98%EB%8A%94-%EB%B3%B4%EC%95%88-%EA%B0%9C%EC%9A%94">Ciliumì´ ì œê³µí•˜ëŠ” ë³´ì•ˆ ê°œìš”</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#cilium-security-%EC%8B%A4%EC%8A%B5">Cilium Security ì‹¤ìŠµ</a>
<ul>
<li class="toc-entry toc-h3"><a href="#-lab1-locking-down-external-access-with-dns-based-policies">ğŸ”¬ Lab1. Locking Down External Access with DNS-Based Policies</a></li>
<li class="toc-entry toc-h3"><a href="#transparent-encryption-with-wireguard">Transparent Encryption with WireGuard</a></li>
<li class="toc-entry toc-h3"><a href="#-lab2-wireguard-%EC%84%A4%EC%A0%95-%EB%B0%8F-%EC%8B%A4%EC%8A%B5">ğŸ”¬ Lab2. WireGuard ì„¤ì • ë° ì‹¤ìŠµ</a></li>
<li class="toc-entry toc-h3"><a href="#inspecting-tls-encrypted-connections">Inspecting TLS Encrypted Connections</a></li>
<li class="toc-entry toc-h3"><a href="#-lab3-tls-interception-%EC%8B%A4%EC%8A%B5">ğŸ”¬ Lab3. TLS Interception ì‹¤ìŠµ</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#tetragon">Tetragon</a>
<ul>
<li class="toc-entry toc-h3"><a href="#tetragon-%EC%86%8C%EA%B0%9C">Tetragon ì†Œê°œ</a></li>
<li class="toc-entry toc-h3"><a href="#tetragon-%EC%84%A4%EC%B9%98">Tetragon ì„¤ì¹˜</a></li>
<li class="toc-entry toc-h3"><a href="#%EC%8B%A4%ED%96%89-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81">ì‹¤í–‰ ëª¨ë‹ˆí„°ë§</a></li>
<li class="toc-entry toc-h3"><a href="#%ED%8C%8C%EC%9D%BC-%EC%A0%91%EC%86%8D-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81">íŒŒì¼ ì ‘ì† ëª¨ë‹ˆí„°ë§</a></li>
<li class="toc-entry toc-h3"><a href="#policy-enforcement">Policy Enforcement</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0">ë§ˆì¹˜ë©°</a></li>
</ul>
  </div>
<a class="u-url" href="/posts/2025-09-07-Cilium-Week8/" hidden></a>
</article>



<div class="PageNavigation">
  
  <a class="prev" href="/posts/2025-08-31-Cilium-Week7/">Â« [Cilium] K8S/Cilium Performance</a>
  
  
</div>

<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = "https://sweetlittlebird.github.io/posts/2025-09-07-Cilium-Week8/";
this.page.identifier = "/posts/Cilium - Week8";
};
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
      </div>

<!--      <div class="adsbygoogle-side">-->
<!--        &lt;!&ndash; ad_side &ndash;&gt;-->
<!--        <ins class="adsbygoogle "-->
<!--             style="display: block"-->
<!--             data-ad-client="ca-pub-6564723532026864"-->
<!--             data-ad-slot="1339398797"-->
<!--             data-ad-format="auto"-->
<!--             data-full-width-responsive="true"></ins>-->
<!--      </div>-->
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Sweet Little Bird</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Sweet Little Bird</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/sweetlittlebird"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sweetlittlebird</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>ê³µë¶€ ê¸°ë¡ê³¼ ê°œë°œ ì´ì•¼ê¸°ë¥¼ ë‹´ì€ ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.</p>
      </div>
    </div>

  </div>

</footer>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
      <!-- Background of PhotoSwipe. 
           It's a separate element as animating opacity is faster than rgba(). -->
      <div class="pswp__bg"></div>
      <!-- Slides wrapper with overflow:hidden. -->
      <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
          <div class="pswp__top-bar">
            <!--  Controls are self-explanatory. Order can be changed. -->
            <div class="pswp__counter"></div>
            <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
            <button class="pswp__button pswp__button--share" title="Share"></button>
            <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
            <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
            <!-- element will get class pswp__preloader--active when preloader is running -->
            <div class="pswp__preloader">
              <div class="pswp__preloader__icn">
                <div class="pswp__preloader__cut">
                  <div class="pswp__preloader__donut"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
            <div class="pswp__share-tooltip"></div>
          </div>
          <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
          </button>
          <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
          </button>
          <div class="pswp__caption">
            <div class="pswp__caption__center"></div>
          </div>
        </div>
      </div>
    </div>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EWGY9N8QXY"></script>

    
    <script async src="/assets/dist/app.min.js"></script>
    
  
    <a href="#" id="back-to-top"><span>Back to Top</span></a>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6564723532026864" crossorigin="anonymous"></script>
    <!--<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>-->
  </body>

</html>
